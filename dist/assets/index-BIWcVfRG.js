(function(){const Y=document.createElement("link").relList;if(Y&&Y.supports&&Y.supports("modulepreload"))return;for(const X of document.querySelectorAll('link[rel="modulepreload"]'))K(X);new MutationObserver(X=>{for(const re of X)if(re.type==="childList")for(const pe of re.addedNodes)pe.tagName==="LINK"&&pe.rel==="modulepreload"&&K(pe)}).observe(document,{childList:!0,subtree:!0});function q(X){const re={};return X.integrity&&(re.integrity=X.integrity),X.referrerPolicy&&(re.referrerPolicy=X.referrerPolicy),X.crossOrigin==="use-credentials"?re.credentials="include":X.crossOrigin==="anonymous"?re.credentials="omit":re.credentials="same-origin",re}function K(X){if(X.ep)return;X.ep=!0;const re=q(X);fetch(X.href,re)}})();function W3(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var D3={exports:{}},KV={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n8;function cK(){if(n8)return KV;n8=1;var x=Symbol.for("react.transitional.element"),Y=Symbol.for("react.fragment");function q(K,X,re){var pe=null;if(re!==void 0&&(pe=""+re),X.key!==void 0&&(pe=""+X.key),"key"in X){re={};for(var Pe in X)Pe!=="key"&&(re[Pe]=X[Pe])}else re=X;return X=re.ref,{$$typeof:x,type:K,key:pe,ref:X!==void 0?X:null,props:re}}return KV.Fragment=Y,KV.jsx=q,KV.jsxs=q,KV}var a8;function dK(){return a8||(a8=1,D3.exports=cK()),D3.exports}var It=dK(),P3={exports:{}},sr={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s8;function lK(){if(s8)return sr;s8=1;var x=Symbol.for("react.transitional.element"),Y=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),K=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),re=Symbol.for("react.consumer"),pe=Symbol.for("react.context"),Pe=Symbol.for("react.forward_ref"),ge=Symbol.for("react.suspense"),de=Symbol.for("react.memo"),Re=Symbol.for("react.lazy"),ye=Symbol.iterator;function Be(me){return me===null||typeof me!="object"?null:(me=ye&&me[ye]||me["@@iterator"],typeof me=="function"?me:null)}var ct={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ke=Object.assign,Ve={};function Fe(me,at,gt){this.props=me,this.context=at,this.refs=Ve,this.updater=gt||ct}Fe.prototype.isReactComponent={},Fe.prototype.setState=function(me,at){if(typeof me!="object"&&typeof me!="function"&&me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,me,at,"setState")},Fe.prototype.forceUpdate=function(me){this.updater.enqueueForceUpdate(this,me,"forceUpdate")};function ht(){}ht.prototype=Fe.prototype;function At(me,at,gt){this.props=me,this.context=at,this.refs=Ve,this.updater=gt||ct}var kt=At.prototype=new ht;kt.constructor=At,ke(kt,Fe.prototype),kt.isPureReactComponent=!0;var Ar=Array.isArray,oi={H:null,A:null,T:null,S:null,V:null},ts=Object.prototype.hasOwnProperty;function tr(me,at,gt,Tt,Ft,xr){return gt=xr.ref,{$$typeof:x,type:me,key:at,ref:gt!==void 0?gt:null,props:xr}}function is(me,at){return tr(me.type,at,void 0,void 0,void 0,me.props)}function ia(me){return typeof me=="object"&&me!==null&&me.$$typeof===x}function ha(me){var at={"=":"=0",":":"=2"};return"$"+me.replace(/[=:]/g,function(gt){return at[gt]})}var Ns=/\/+/g;function Jt(me,at){return typeof me=="object"&&me!==null&&me.key!=null?ha(""+me.key):at.toString(36)}function zo(){}function ir(me){switch(me.status){case"fulfilled":return me.value;case"rejected":throw me.reason;default:switch(typeof me.status=="string"?me.then(zo,zo):(me.status="pending",me.then(function(at){me.status==="pending"&&(me.status="fulfilled",me.value=at)},function(at){me.status==="pending"&&(me.status="rejected",me.reason=at)})),me.status){case"fulfilled":return me.value;case"rejected":throw me.reason}}throw me}function Ds(me,at,gt,Tt,Ft){var xr=typeof me;(xr==="undefined"||xr==="boolean")&&(me=null);var xi=!1;if(me===null)xi=!0;else switch(xr){case"bigint":case"string":case"number":xi=!0;break;case"object":switch(me.$$typeof){case x:case Y:xi=!0;break;case Re:return xi=me._init,Ds(xi(me._payload),at,gt,Tt,Ft)}}if(xi)return Ft=Ft(me),xi=Tt===""?"."+Jt(me,0):Tt,Ar(Ft)?(gt="",xi!=null&&(gt=xi.replace(Ns,"$&/")+"/"),Ds(Ft,at,gt,"",function(mo){return mo})):Ft!=null&&(ia(Ft)&&(Ft=is(Ft,gt+(Ft.key==null||me&&me.key===Ft.key?"":(""+Ft.key).replace(Ns,"$&/")+"/")+xi)),at.push(Ft)),1;xi=0;var _s=Tt===""?".":Tt+":";if(Ar(me))for(var Fn=0;Fn<me.length;Fn++)Tt=me[Fn],xr=_s+Jt(Tt,Fn),xi+=Ds(Tt,at,gt,xr,Ft);else if(Fn=Be(me),typeof Fn=="function")for(me=Fn.call(me),Fn=0;!(Tt=me.next()).done;)Tt=Tt.value,xr=_s+Jt(Tt,Fn++),xi+=Ds(Tt,at,gt,xr,Ft);else if(xr==="object"){if(typeof me.then=="function")return Ds(ir(me),at,gt,Tt,Ft);throw at=String(me),Error("Objects are not valid as a React child (found: "+(at==="[object Object]"?"object with keys {"+Object.keys(me).join(", ")+"}":at)+"). If you meant to render a collection of children, use an array instead.")}return xi}function je(me,at,gt){if(me==null)return me;var Tt=[],Ft=0;return Ds(me,Tt,"","",function(xr){return at.call(gt,xr,Ft++)}),Tt}function tt(me){if(me._status===-1){var at=me._result;at=at(),at.then(function(gt){(me._status===0||me._status===-1)&&(me._status=1,me._result=gt)},function(gt){(me._status===0||me._status===-1)&&(me._status=2,me._result=gt)}),me._status===-1&&(me._status=0,me._result=at)}if(me._status===1)return me._result.default;throw me._result}var ni=typeof reportError=="function"?reportError:function(me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var at=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof me=="object"&&me!==null&&typeof me.message=="string"?String(me.message):String(me),error:me});if(!window.dispatchEvent(at))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",me);return}console.error(me)};function Qr(){}return sr.Children={map:je,forEach:function(me,at,gt){je(me,function(){at.apply(this,arguments)},gt)},count:function(me){var at=0;return je(me,function(){at++}),at},toArray:function(me){return je(me,function(at){return at})||[]},only:function(me){if(!ia(me))throw Error("React.Children.only expected to receive a single React element child.");return me}},sr.Component=Fe,sr.Fragment=q,sr.Profiler=X,sr.PureComponent=At,sr.StrictMode=K,sr.Suspense=ge,sr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=oi,sr.__COMPILER_RUNTIME={__proto__:null,c:function(me){return oi.H.useMemoCache(me)}},sr.cache=function(me){return function(){return me.apply(null,arguments)}},sr.cloneElement=function(me,at,gt){if(me==null)throw Error("The argument must be a React element, but you passed "+me+".");var Tt=ke({},me.props),Ft=me.key,xr=void 0;if(at!=null)for(xi in at.ref!==void 0&&(xr=void 0),at.key!==void 0&&(Ft=""+at.key),at)!ts.call(at,xi)||xi==="key"||xi==="__self"||xi==="__source"||xi==="ref"&&at.ref===void 0||(Tt[xi]=at[xi]);var xi=arguments.length-2;if(xi===1)Tt.children=gt;else if(1<xi){for(var _s=Array(xi),Fn=0;Fn<xi;Fn++)_s[Fn]=arguments[Fn+2];Tt.children=_s}return tr(me.type,Ft,void 0,void 0,xr,Tt)},sr.createContext=function(me){return me={$$typeof:pe,_currentValue:me,_currentValue2:me,_threadCount:0,Provider:null,Consumer:null},me.Provider=me,me.Consumer={$$typeof:re,_context:me},me},sr.createElement=function(me,at,gt){var Tt,Ft={},xr=null;if(at!=null)for(Tt in at.key!==void 0&&(xr=""+at.key),at)ts.call(at,Tt)&&Tt!=="key"&&Tt!=="__self"&&Tt!=="__source"&&(Ft[Tt]=at[Tt]);var xi=arguments.length-2;if(xi===1)Ft.children=gt;else if(1<xi){for(var _s=Array(xi),Fn=0;Fn<xi;Fn++)_s[Fn]=arguments[Fn+2];Ft.children=_s}if(me&&me.defaultProps)for(Tt in xi=me.defaultProps,xi)Ft[Tt]===void 0&&(Ft[Tt]=xi[Tt]);return tr(me,xr,void 0,void 0,null,Ft)},sr.createRef=function(){return{current:null}},sr.forwardRef=function(me){return{$$typeof:Pe,render:me}},sr.isValidElement=ia,sr.lazy=function(me){return{$$typeof:Re,_payload:{_status:-1,_result:me},_init:tt}},sr.memo=function(me,at){return{$$typeof:de,type:me,compare:at===void 0?null:at}},sr.startTransition=function(me){var at=oi.T,gt={};oi.T=gt;try{var Tt=me(),Ft=oi.S;Ft!==null&&Ft(gt,Tt),typeof Tt=="object"&&Tt!==null&&typeof Tt.then=="function"&&Tt.then(Qr,ni)}catch(xr){ni(xr)}finally{oi.T=at}},sr.unstable_useCacheRefresh=function(){return oi.H.useCacheRefresh()},sr.use=function(me){return oi.H.use(me)},sr.useActionState=function(me,at,gt){return oi.H.useActionState(me,at,gt)},sr.useCallback=function(me,at){return oi.H.useCallback(me,at)},sr.useContext=function(me){return oi.H.useContext(me)},sr.useDebugValue=function(){},sr.useDeferredValue=function(me,at){return oi.H.useDeferredValue(me,at)},sr.useEffect=function(me,at,gt){var Tt=oi.H;if(typeof gt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Tt.useEffect(me,at)},sr.useId=function(){return oi.H.useId()},sr.useImperativeHandle=function(me,at,gt){return oi.H.useImperativeHandle(me,at,gt)},sr.useInsertionEffect=function(me,at){return oi.H.useInsertionEffect(me,at)},sr.useLayoutEffect=function(me,at){return oi.H.useLayoutEffect(me,at)},sr.useMemo=function(me,at){return oi.H.useMemo(me,at)},sr.useOptimistic=function(me,at){return oi.H.useOptimistic(me,at)},sr.useReducer=function(me,at,gt){return oi.H.useReducer(me,at,gt)},sr.useRef=function(me){return oi.H.useRef(me)},sr.useState=function(me){return oi.H.useState(me)},sr.useSyncExternalStore=function(me,at,gt){return oi.H.useSyncExternalStore(me,at,gt)},sr.useTransition=function(){return oi.H.useTransition()},sr.version="19.1.1",sr}var o8;function H3(){return o8||(o8=1,P3.exports=lK()),P3.exports}var ve=H3();const uK=W3(ve);var L3={exports:{}},YV={},k3={exports:{}},M3={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c8;function hK(){return c8||(c8=1,(function(x){function Y(je,tt){var ni=je.length;je.push(tt);e:for(;0<ni;){var Qr=ni-1>>>1,me=je[Qr];if(0<X(me,tt))je[Qr]=tt,je[ni]=me,ni=Qr;else break e}}function q(je){return je.length===0?null:je[0]}function K(je){if(je.length===0)return null;var tt=je[0],ni=je.pop();if(ni!==tt){je[0]=ni;e:for(var Qr=0,me=je.length,at=me>>>1;Qr<at;){var gt=2*(Qr+1)-1,Tt=je[gt],Ft=gt+1,xr=je[Ft];if(0>X(Tt,ni))Ft<me&&0>X(xr,Tt)?(je[Qr]=xr,je[Ft]=ni,Qr=Ft):(je[Qr]=Tt,je[gt]=ni,Qr=gt);else if(Ft<me&&0>X(xr,ni))je[Qr]=xr,je[Ft]=ni,Qr=Ft;else break e}}return tt}function X(je,tt){var ni=je.sortIndex-tt.sortIndex;return ni!==0?ni:je.id-tt.id}if(x.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var re=performance;x.unstable_now=function(){return re.now()}}else{var pe=Date,Pe=pe.now();x.unstable_now=function(){return pe.now()-Pe}}var ge=[],de=[],Re=1,ye=null,Be=3,ct=!1,ke=!1,Ve=!1,Fe=!1,ht=typeof setTimeout=="function"?setTimeout:null,At=typeof clearTimeout=="function"?clearTimeout:null,kt=typeof setImmediate<"u"?setImmediate:null;function Ar(je){for(var tt=q(de);tt!==null;){if(tt.callback===null)K(de);else if(tt.startTime<=je)K(de),tt.sortIndex=tt.expirationTime,Y(ge,tt);else break;tt=q(de)}}function oi(je){if(Ve=!1,Ar(je),!ke)if(q(ge)!==null)ke=!0,ts||(ts=!0,Jt());else{var tt=q(de);tt!==null&&Ds(oi,tt.startTime-je)}}var ts=!1,tr=-1,is=5,ia=-1;function ha(){return Fe?!0:!(x.unstable_now()-ia<is)}function Ns(){if(Fe=!1,ts){var je=x.unstable_now();ia=je;var tt=!0;try{e:{ke=!1,Ve&&(Ve=!1,At(tr),tr=-1),ct=!0;var ni=Be;try{t:{for(Ar(je),ye=q(ge);ye!==null&&!(ye.expirationTime>je&&ha());){var Qr=ye.callback;if(typeof Qr=="function"){ye.callback=null,Be=ye.priorityLevel;var me=Qr(ye.expirationTime<=je);if(je=x.unstable_now(),typeof me=="function"){ye.callback=me,Ar(je),tt=!0;break t}ye===q(ge)&&K(ge),Ar(je)}else K(ge);ye=q(ge)}if(ye!==null)tt=!0;else{var at=q(de);at!==null&&Ds(oi,at.startTime-je),tt=!1}}break e}finally{ye=null,Be=ni,ct=!1}tt=void 0}}finally{tt?Jt():ts=!1}}}var Jt;if(typeof kt=="function")Jt=function(){kt(Ns)};else if(typeof MessageChannel<"u"){var zo=new MessageChannel,ir=zo.port2;zo.port1.onmessage=Ns,Jt=function(){ir.postMessage(null)}}else Jt=function(){ht(Ns,0)};function Ds(je,tt){tr=ht(function(){je(x.unstable_now())},tt)}x.unstable_IdlePriority=5,x.unstable_ImmediatePriority=1,x.unstable_LowPriority=4,x.unstable_NormalPriority=3,x.unstable_Profiling=null,x.unstable_UserBlockingPriority=2,x.unstable_cancelCallback=function(je){je.callback=null},x.unstable_forceFrameRate=function(je){0>je||125<je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):is=0<je?Math.floor(1e3/je):5},x.unstable_getCurrentPriorityLevel=function(){return Be},x.unstable_next=function(je){switch(Be){case 1:case 2:case 3:var tt=3;break;default:tt=Be}var ni=Be;Be=tt;try{return je()}finally{Be=ni}},x.unstable_requestPaint=function(){Fe=!0},x.unstable_runWithPriority=function(je,tt){switch(je){case 1:case 2:case 3:case 4:case 5:break;default:je=3}var ni=Be;Be=je;try{return tt()}finally{Be=ni}},x.unstable_scheduleCallback=function(je,tt,ni){var Qr=x.unstable_now();switch(typeof ni=="object"&&ni!==null?(ni=ni.delay,ni=typeof ni=="number"&&0<ni?Qr+ni:Qr):ni=Qr,je){case 1:var me=-1;break;case 2:me=250;break;case 5:me=1073741823;break;case 4:me=1e4;break;default:me=5e3}return me=ni+me,je={id:Re++,callback:tt,priorityLevel:je,startTime:ni,expirationTime:me,sortIndex:-1},ni>Qr?(je.sortIndex=ni,Y(de,je),q(ge)===null&&je===q(de)&&(Ve?(At(tr),tr=-1):Ve=!0,Ds(oi,ni-Qr))):(je.sortIndex=me,Y(ge,je),ke||ct||(ke=!0,ts||(ts=!0,Jt()))),je},x.unstable_shouldYield=ha,x.unstable_wrapCallback=function(je){var tt=Be;return function(){var ni=Be;Be=tt;try{return je.apply(this,arguments)}finally{Be=ni}}}})(M3)),M3}var d8;function pK(){return d8||(d8=1,k3.exports=hK()),k3.exports}var U3={exports:{}},$c={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l8;function _K(){if(l8)return $c;l8=1;var x=H3();function Y(ge){var de="https://react.dev/errors/"+ge;if(1<arguments.length){de+="?args[]="+encodeURIComponent(arguments[1]);for(var Re=2;Re<arguments.length;Re++)de+="&args[]="+encodeURIComponent(arguments[Re])}return"Minified React error #"+ge+"; visit "+de+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function q(){}var K={d:{f:q,r:function(){throw Error(Y(522))},D:q,C:q,L:q,m:q,X:q,S:q,M:q},p:0,findDOMNode:null},X=Symbol.for("react.portal");function re(ge,de,Re){var ye=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:X,key:ye==null?null:""+ye,children:ge,containerInfo:de,implementation:Re}}var pe=x.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Pe(ge,de){if(ge==="font")return"";if(typeof de=="string")return de==="use-credentials"?de:""}return $c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=K,$c.createPortal=function(ge,de){var Re=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!de||de.nodeType!==1&&de.nodeType!==9&&de.nodeType!==11)throw Error(Y(299));return re(ge,de,null,Re)},$c.flushSync=function(ge){var de=pe.T,Re=K.p;try{if(pe.T=null,K.p=2,ge)return ge()}finally{pe.T=de,K.p=Re,K.d.f()}},$c.preconnect=function(ge,de){typeof ge=="string"&&(de?(de=de.crossOrigin,de=typeof de=="string"?de==="use-credentials"?de:"":void 0):de=null,K.d.C(ge,de))},$c.prefetchDNS=function(ge){typeof ge=="string"&&K.d.D(ge)},$c.preinit=function(ge,de){if(typeof ge=="string"&&de&&typeof de.as=="string"){var Re=de.as,ye=Pe(Re,de.crossOrigin),Be=typeof de.integrity=="string"?de.integrity:void 0,ct=typeof de.fetchPriority=="string"?de.fetchPriority:void 0;Re==="style"?K.d.S(ge,typeof de.precedence=="string"?de.precedence:void 0,{crossOrigin:ye,integrity:Be,fetchPriority:ct}):Re==="script"&&K.d.X(ge,{crossOrigin:ye,integrity:Be,fetchPriority:ct,nonce:typeof de.nonce=="string"?de.nonce:void 0})}},$c.preinitModule=function(ge,de){if(typeof ge=="string")if(typeof de=="object"&&de!==null){if(de.as==null||de.as==="script"){var Re=Pe(de.as,de.crossOrigin);K.d.M(ge,{crossOrigin:Re,integrity:typeof de.integrity=="string"?de.integrity:void 0,nonce:typeof de.nonce=="string"?de.nonce:void 0})}}else de==null&&K.d.M(ge)},$c.preload=function(ge,de){if(typeof ge=="string"&&typeof de=="object"&&de!==null&&typeof de.as=="string"){var Re=de.as,ye=Pe(Re,de.crossOrigin);K.d.L(ge,Re,{crossOrigin:ye,integrity:typeof de.integrity=="string"?de.integrity:void 0,nonce:typeof de.nonce=="string"?de.nonce:void 0,type:typeof de.type=="string"?de.type:void 0,fetchPriority:typeof de.fetchPriority=="string"?de.fetchPriority:void 0,referrerPolicy:typeof de.referrerPolicy=="string"?de.referrerPolicy:void 0,imageSrcSet:typeof de.imageSrcSet=="string"?de.imageSrcSet:void 0,imageSizes:typeof de.imageSizes=="string"?de.imageSizes:void 0,media:typeof de.media=="string"?de.media:void 0})}},$c.preloadModule=function(ge,de){if(typeof ge=="string")if(de){var Re=Pe(de.as,de.crossOrigin);K.d.m(ge,{as:typeof de.as=="string"&&de.as!=="script"?de.as:void 0,crossOrigin:Re,integrity:typeof de.integrity=="string"?de.integrity:void 0})}else K.d.m(ge)},$c.requestFormReset=function(ge){K.d.r(ge)},$c.unstable_batchedUpdates=function(ge,de){return ge(de)},$c.useFormState=function(ge,de,Re){return pe.H.useFormState(ge,de,Re)},$c.useFormStatus=function(){return pe.H.useHostTransitionStatus()},$c.version="19.1.1",$c}var u8;function fK(){if(u8)return U3.exports;u8=1;function x(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(x)}catch(Y){console.error(Y)}}return x(),U3.exports=_K(),U3.exports}var h8;function EK(){if(h8)return YV;h8=1;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x=pK(),Y=H3(),q=fK();function K(u){var p="https://react.dev/errors/"+u;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var E=2;E<arguments.length;E++)p+="&args[]="+encodeURIComponent(arguments[E])}return"Minified React error #"+u+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function X(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function re(u){var p=u,E=u;if(u.alternate)for(;p.return;)p=p.return;else{u=p;do p=u,(p.flags&4098)!==0&&(E=p.return),u=p.return;while(u)}return p.tag===3?E:null}function pe(u){if(u.tag===13){var p=u.memoizedState;if(p===null&&(u=u.alternate,u!==null&&(p=u.memoizedState)),p!==null)return p.dehydrated}return null}function Pe(u){if(re(u)!==u)throw Error(K(188))}function ge(u){var p=u.alternate;if(!p){if(p=re(u),p===null)throw Error(K(188));return p!==u?null:u}for(var E=u,g=p;;){var y=E.return;if(y===null)break;var O=y.alternate;if(O===null){if(g=y.return,g!==null){E=g;continue}break}if(y.child===O.child){for(O=y.child;O;){if(O===E)return Pe(y),u;if(O===g)return Pe(y),p;O=O.sibling}throw Error(K(188))}if(E.return!==g.return)E=y,g=O;else{for(var H=!1,Z=y.child;Z;){if(Z===E){H=!0,E=y,g=O;break}if(Z===g){H=!0,g=y,E=O;break}Z=Z.sibling}if(!H){for(Z=O.child;Z;){if(Z===E){H=!0,E=O,g=y;break}if(Z===g){H=!0,g=O,E=y;break}Z=Z.sibling}if(!H)throw Error(K(189))}}if(E.alternate!==g)throw Error(K(190))}if(E.tag!==3)throw Error(K(188));return E.stateNode.current===E?u:p}function de(u){var p=u.tag;if(p===5||p===26||p===27||p===6)return u;for(u=u.child;u!==null;){if(p=de(u),p!==null)return p;u=u.sibling}return null}var Re=Object.assign,ye=Symbol.for("react.element"),Be=Symbol.for("react.transitional.element"),ct=Symbol.for("react.portal"),ke=Symbol.for("react.fragment"),Ve=Symbol.for("react.strict_mode"),Fe=Symbol.for("react.profiler"),ht=Symbol.for("react.provider"),At=Symbol.for("react.consumer"),kt=Symbol.for("react.context"),Ar=Symbol.for("react.forward_ref"),oi=Symbol.for("react.suspense"),ts=Symbol.for("react.suspense_list"),tr=Symbol.for("react.memo"),is=Symbol.for("react.lazy"),ia=Symbol.for("react.activity"),ha=Symbol.for("react.memo_cache_sentinel"),Ns=Symbol.iterator;function Jt(u){return u===null||typeof u!="object"?null:(u=Ns&&u[Ns]||u["@@iterator"],typeof u=="function"?u:null)}var zo=Symbol.for("react.client.reference");function ir(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===zo?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case ke:return"Fragment";case Fe:return"Profiler";case Ve:return"StrictMode";case oi:return"Suspense";case ts:return"SuspenseList";case ia:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case ct:return"Portal";case kt:return(u.displayName||"Context")+".Provider";case At:return(u._context.displayName||"Context")+".Consumer";case Ar:var p=u.render;return u=u.displayName,u||(u=p.displayName||p.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case tr:return p=u.displayName||null,p!==null?p:ir(u.type)||"Memo";case is:p=u._payload,u=u._init;try{return ir(u(p))}catch{}}return null}var Ds=Array.isArray,je=Y.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,tt=q.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ni={pending:!1,data:null,method:null,action:null},Qr=[],me=-1;function at(u){return{current:u}}function gt(u){0>me||(u.current=Qr[me],Qr[me]=null,me--)}function Tt(u,p){me++,Qr[me]=u.current,u.current=p}var Ft=at(null),xr=at(null),xi=at(null),_s=at(null);function Fn(u,p){switch(Tt(xi,p),Tt(xr,u),Tt(Ft,null),p.nodeType){case 9:case 11:u=(u=p.documentElement)&&(u=u.namespaceURI)?Tw(u):0;break;default:if(u=p.tagName,p=p.namespaceURI)p=Tw(p),u=Rw(p,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}gt(Ft),Tt(Ft,u)}function mo(){gt(Ft),gt(xr),gt(xi)}function Fl(u){u.memoizedState!==null&&Tt(_s,u);var p=Ft.current,E=Rw(p,u.type);p!==E&&(Tt(xr,u),Tt(Ft,E))}function tS(u){xr.current===u&&(gt(Ft),gt(xr)),_s.current===u&&(gt(_s),Lm._currentValue=ni)}var tv=Object.prototype.hasOwnProperty,Xs=x.unstable_scheduleCallback,iv=x.unstable_cancelCallback,oN=x.unstable_shouldYield,Js=x.unstable_requestPaint,Yd=x.unstable_now,Ir=x.unstable_getCurrentPriorityLevel,bn=x.unstable_ImmediatePriority,x_=x.unstable_UserBlockingPriority,oh=x.unstable_NormalPriority,cN=x.unstable_LowPriority,iS=x.unstable_IdlePriority,wr=x.log,rv=x.unstable_setDisableYieldValue,pp=null,$r=null;function zd(u){if(typeof wr=="function"&&rv(u),$r&&typeof $r.setStrictMode=="function")try{$r.setStrictMode(pp,u)}catch{}}var fs=Math.clz32?Math.clz32:sv,nv=Math.log,av=Math.LN2;function sv(u){return u>>>=0,u===0?32:31-(nv(u)/av|0)|0}var V_=256,Ps=4194304;function Bl(u){var p=u&42;if(p!==0)return p;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function rS(u,p,E){var g=u.pendingLanes;if(g===0)return 0;var y=0,O=u.suspendedLanes,H=u.pingedLanes;u=u.warmLanes;var Z=g&134217727;return Z!==0?(g=Z&~O,g!==0?y=Bl(g):(H&=Z,H!==0?y=Bl(H):E||(E=Z&~u,E!==0&&(y=Bl(E))))):(Z=g&~O,Z!==0?y=Bl(Z):H!==0?y=Bl(H):E||(E=g&~u,E!==0&&(y=Bl(E)))),y===0?0:p!==0&&p!==y&&(p&O)===0&&(O=y&-y,E=p&-p,O>=E||O===32&&(E&4194048)!==0)?p:y}function LE(u,p){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&p)===0}function td(u,p){switch(u){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nS(){var u=V_;return V_<<=1,(V_&4194048)===0&&(V_=256),u}function NA(){var u=Ps;return Ps<<=1,(Ps&62914560)===0&&(Ps=4194304),u}function ov(u){for(var p=[],E=0;31>E;E++)p.push(u);return p}function kE(u,p){u.pendingLanes|=p,p!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function dN(u,p,E,g,y,O){var H=u.pendingLanes;u.pendingLanes=E,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=E,u.entangledLanes&=E,u.errorRecoveryDisabledLanes&=E,u.shellSuspendCounter=0;var Z=u.entanglements,le=u.expirationTimes,be=u.hiddenUpdates;for(E=H&~E;0<E;){var We=31-fs(E),Qe=1<<We;Z[We]=0,le[We]=-1;var De=be[We];if(De!==null)for(be[We]=null,We=0;We<De.length;We++){var Le=De[We];Le!==null&&(Le.lane&=-536870913)}E&=~Qe}g!==0&&qd(u,g,0),O!==0&&y===0&&u.tag!==0&&(u.suspendedLanes|=O&~(H&~p))}function qd(u,p,E){u.pendingLanes|=p,u.suspendedLanes&=~p;var g=31-fs(p);u.entangledLanes|=p,u.entanglements[g]=u.entanglements[g]|1073741824|E&4194090}function DA(u,p){var E=u.entangledLanes|=p;for(u=u.entanglements;E;){var g=31-fs(E),y=1<<g;y&p|u[g]&p&&(u[g]|=p),E&=~y}}function qo(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function cv(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function PA(){var u=tt.p;return u!==0?u:(u=window.event,u===void 0?32:Mw(u.type))}function lN(u,p){var E=tt.p;try{return tt.p=u,p()}finally{tt.p=E}}var pr=Math.random().toString(36).slice(2),Ls="__reactFiber$"+pr,go="__reactProps$"+pr,vc="__reactContainer$"+pr,ME="__reactEvents$"+pr,dv="__reactListeners$"+pr,lv="__reactHandles$"+pr,LA="__reactResources$"+pr,_p="__reactMarker$"+pr;function UE(u){delete u[Ls],delete u[go],delete u[ME],delete u[dv],delete u[lv]}function F_(u){var p=u[Ls];if(p)return p;for(var E=u.parentNode;E;){if(p=E[vc]||E[Ls]){if(E=p.alternate,p.child!==null||E!==null&&E.child!==null)for(u=bw(u);u!==null;){if(E=u[Ls])return E;u=bw(u)}return p}u=E,E=u.parentNode}return null}function B_(u){if(u=u[Ls]||u[vc]){var p=u.tag;if(p===5||p===6||p===13||p===26||p===27||p===3)return u}return null}function xE(u){var p=u.tag;if(p===5||p===26||p===27||p===6)return u.stateNode;throw Error(K(33))}function ch(u){var p=u[LA];return p||(p=u[LA]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function Da(u){u[_p]=!0}var j_=new Set,aS={};function Es(u,p){G_(u,p),G_(u+"Capture",p)}function G_(u,p){for(aS[u]=p,u=0;u<p.length;u++)j_.add(p[u])}var uN=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Pa={},kA={};function hN(u){return tv.call(kA,u)?!0:tv.call(Pa,u)?!1:uN.test(u)?kA[u]=!0:(Pa[u]=!0,!1)}function Bi(u,p,E){if(hN(p))if(E===null)u.removeAttribute(p);else{switch(typeof E){case"undefined":case"function":case"symbol":u.removeAttribute(p);return;case"boolean":var g=p.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){u.removeAttribute(p);return}}u.setAttribute(p,""+E)}}function sS(u,p,E){if(E===null)u.removeAttribute(p);else{switch(typeof E){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(p);return}u.setAttribute(p,""+E)}}function jl(u,p,E,g){if(g===null)u.removeAttribute(E);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(E);return}u.setAttributeNS(p,E,""+g)}}var uv,MA;function Xd(u){if(uv===void 0)try{throw Error()}catch(E){var p=E.stack.trim().match(/\n( *(at )?)/);uv=p&&p[1]||"",MA=-1<E.stack.indexOf(`
    at`)?" (<anonymous>)":-1<E.stack.indexOf("@")?"@unknown:0:0":""}return`
`+uv+u+MA}var hv=!1;function VE(u,p){if(!u||hv)return"";hv=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(p){var Qe=function(){throw Error()};if(Object.defineProperty(Qe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Qe,[])}catch(Le){var De=Le}Reflect.construct(u,[],Qe)}else{try{Qe.call()}catch(Le){De=Le}u.call(Qe.prototype)}}else{try{throw Error()}catch(Le){De=Le}(Qe=u())&&typeof Qe.catch=="function"&&Qe.catch(function(){})}}catch(Le){if(Le&&De&&typeof Le.stack=="string")return[Le.stack,De.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var O=g.DetermineComponentFrameRoot(),H=O[0],Z=O[1];if(H&&Z){var le=H.split(`
`),be=Z.split(`
`);for(y=g=0;g<le.length&&!le[g].includes("DetermineComponentFrameRoot");)g++;for(;y<be.length&&!be[y].includes("DetermineComponentFrameRoot");)y++;if(g===le.length||y===be.length)for(g=le.length-1,y=be.length-1;1<=g&&0<=y&&le[g]!==be[y];)y--;for(;1<=g&&0<=y;g--,y--)if(le[g]!==be[y]){if(g!==1||y!==1)do if(g--,y--,0>y||le[g]!==be[y]){var We=`
`+le[g].replace(" at new "," at ");return u.displayName&&We.includes("<anonymous>")&&(We=We.replace("<anonymous>",u.displayName)),We}while(1<=g&&0<=y);break}}}finally{hv=!1,Error.prepareStackTrace=E}return(E=u?u.displayName||u.name:"")?Xd(E):""}function pN(u){switch(u.tag){case 26:case 27:case 5:return Xd(u.type);case 16:return Xd("Lazy");case 13:return Xd("Suspense");case 19:return Xd("SuspenseList");case 0:case 15:return VE(u.type,!1);case 11:return VE(u.type.render,!1);case 1:return VE(u.type,!0);case 31:return Xd("Activity");default:return""}}function UA(u){try{var p="";do p+=pN(u),u=u.return;while(u);return p}catch(E){return`
Error generating stack: `+E.message+`
`+E.stack}}function yc(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function Cc(u){var p=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function FE(u){var p=Cc(u)?"checked":"value",E=Object.getOwnPropertyDescriptor(u.constructor.prototype,p),g=""+u[p];if(!u.hasOwnProperty(p)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var y=E.get,O=E.set;return Object.defineProperty(u,p,{configurable:!0,get:function(){return y.call(this)},set:function(H){g=""+H,O.call(this,H)}}),Object.defineProperty(u,p,{enumerable:E.enumerable}),{getValue:function(){return g},setValue:function(H){g=""+H},stopTracking:function(){u._valueTracker=null,delete u[p]}}}}function oS(u){u._valueTracker||(u._valueTracker=FE(u))}function ci(u){if(!u)return!1;var p=u._valueTracker;if(!p)return!0;var E=p.getValue(),g="";return u&&(g=Cc(u)?u.checked?"true":"false":u.value),u=g,u!==E?(p.setValue(u),!0):!1}function cS(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var pv=/[\n"\\]/g;function So(u){return u.replace(pv,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function _v(u,p,E,g,y,O,H,Z){u.name="",H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?u.type=H:u.removeAttribute("type"),p!=null?H==="number"?(p===0&&u.value===""||u.value!=p)&&(u.value=""+yc(p)):u.value!==""+yc(p)&&(u.value=""+yc(p)):H!=="submit"&&H!=="reset"||u.removeAttribute("value"),p!=null?fv(u,H,yc(p)):E!=null?fv(u,H,yc(E)):g!=null&&u.removeAttribute("value"),y==null&&O!=null&&(u.defaultChecked=!!O),y!=null&&(u.checked=y&&typeof y!="function"&&typeof y!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?u.name=""+yc(Z):u.removeAttribute("name")}function xA(u,p,E,g,y,O,H,Z){if(O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"&&(u.type=O),p!=null||E!=null){if(!(O!=="submit"&&O!=="reset"||p!=null))return;E=E!=null?""+yc(E):"",p=p!=null?""+yc(p):E,Z||p===u.value||(u.value=p),u.defaultValue=p}g=g??y,g=typeof g!="function"&&typeof g!="symbol"&&!!g,u.checked=Z?u.checked:!!g,u.defaultChecked=!!g,H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"&&(u.name=H)}function fv(u,p,E){p==="number"&&cS(u.ownerDocument)===u||u.defaultValue===""+E||(u.defaultValue=""+E)}function W_(u,p,E,g){if(u=u.options,p){p={};for(var y=0;y<E.length;y++)p["$"+E[y]]=!0;for(E=0;E<u.length;E++)y=p.hasOwnProperty("$"+u[E].value),u[E].selected!==y&&(u[E].selected=y),y&&g&&(u[E].defaultSelected=!0)}else{for(E=""+yc(E),p=null,y=0;y<u.length;y++){if(u[y].value===E){u[y].selected=!0,g&&(u[y].defaultSelected=!0);return}p!==null||u[y].disabled||(p=u[y])}p!==null&&(p.selected=!0)}}function VA(u,p,E){if(p!=null&&(p=""+yc(p),p!==u.value&&(u.value=p),E==null)){u.defaultValue!==p&&(u.defaultValue=p);return}u.defaultValue=E!=null?""+yc(E):""}function FA(u,p,E,g){if(p==null){if(g!=null){if(E!=null)throw Error(K(92));if(Ds(g)){if(1<g.length)throw Error(K(93));g=g[0]}E=g}E==null&&(E=""),p=E}E=yc(p),u.defaultValue=E,g=u.textContent,g===E&&g!==""&&g!==null&&(u.value=g)}function Jd(u,p){if(p){var E=u.firstChild;if(E&&E===u.lastChild&&E.nodeType===3){E.nodeValue=p;return}}u.textContent=p}var Ev=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function H_(u,p,E){var g=p.indexOf("--")===0;E==null||typeof E=="boolean"||E===""?g?u.setProperty(p,""):p==="float"?u.cssFloat="":u[p]="":g?u.setProperty(p,E):typeof E!="number"||E===0||Ev.has(p)?p==="float"?u.cssFloat=E:u[p]=(""+E).trim():u[p]=E+"px"}function BA(u,p,E){if(p!=null&&typeof p!="object")throw Error(K(62));if(u=u.style,E!=null){for(var g in E)!E.hasOwnProperty(g)||p!=null&&p.hasOwnProperty(g)||(g.indexOf("--")===0?u.setProperty(g,""):g==="float"?u.cssFloat="":u[g]="");for(var y in p)g=p[y],p.hasOwnProperty(y)&&E[y]!==g&&H_(u,y,g)}else for(var O in p)p.hasOwnProperty(O)&&H_(u,O,p[O])}function fp(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _N=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),mv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function dS(u){return mv.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}var gv=null;function Sv(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var K_=null,Y_=null;function jA(u){var p=B_(u);if(p&&(u=p.stateNode)){var E=u[go]||null;e:switch(u=p.stateNode,p.type){case"input":if(_v(u,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name),p=E.name,E.type==="radio"&&p!=null){for(E=u;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll('input[name="'+So(""+p)+'"][type="radio"]'),p=0;p<E.length;p++){var g=E[p];if(g!==u&&g.form===u.form){var y=g[go]||null;if(!y)throw Error(K(90));_v(g,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(p=0;p<E.length;p++)g=E[p],g.form===u.form&&ci(g)}break e;case"textarea":VA(u,E.value,E.defaultValue);break e;case"select":p=E.value,p!=null&&W_(u,!!E.multiple,p,!1)}}}var Tv=!1;function GA(u,p,E){if(Tv)return u(p,E);Tv=!0;try{var g=u(p);return g}finally{if(Tv=!1,(K_!==null||Y_!==null)&&(ol(),K_&&(p=K_,u=Y_,Y_=K_=null,jA(p),u)))for(p=0;p<u.length;p++)jA(u[p])}}function Ep(u,p){var E=u.stateNode;if(E===null)return null;var g=E[go]||null;if(g===null)return null;E=g[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(u=u.type,g=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!g;break e;default:u=!1}if(u)return null;if(E&&typeof E!="function")throw Error(K(231,p,typeof E));return E}var Gl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Rv=!1;if(Gl)try{var BE={};Object.defineProperty(BE,"passive",{get:function(){Rv=!0}}),window.addEventListener("test",BE,BE),window.removeEventListener("test",BE,BE)}catch{Rv=!1}var ks=null,vv=null,lS=null;function WA(){if(lS)return lS;var u,p=vv,E=p.length,g,y="value"in ks?ks.value:ks.textContent,O=y.length;for(u=0;u<E&&p[u]===y[u];u++);var H=E-u;for(g=1;g<=H&&p[E-g]===y[O-g];g++);return lS=y.slice(u,1<g?1-g:void 0)}function uS(u){var p=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&p===13&&(u=13)):u=p,u===10&&(u=13),32<=u||u===13?u:0}function z_(){return!0}function HA(){return!1}function To(u){function p(E,g,y,O,H){this._reactName=E,this._targetInst=y,this.type=g,this.nativeEvent=O,this.target=H,this.currentTarget=null;for(var Z in u)u.hasOwnProperty(Z)&&(E=u[Z],this[Z]=E?E(O):O[Z]);return this.isDefaultPrevented=(O.defaultPrevented!=null?O.defaultPrevented:O.returnValue===!1)?z_:HA,this.isPropagationStopped=HA,this}return Re(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=z_)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=z_)},persist:function(){},isPersistent:z_}),p}var mp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rs=To(mp),pn=Re({},mp,{view:0,detail:0}),yv=To(pn),Cv,bv,jE,Vr=Re({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Av,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==jE&&(jE&&u.type==="mousemove"?(Cv=u.screenX-jE.screenX,bv=u.screenY-jE.screenY):bv=Cv=0,jE=u),Cv)},movementY:function(u){return"movementY"in u?u.movementY:bv}}),KA=To(Vr),fN=Re({},Vr,{dataTransfer:0}),EN=To(fN),gp=Re({},pn,{relatedTarget:0}),GE=To(gp),mN=Re({},mp,{animationName:0,elapsedTime:0,pseudoElement:0}),WE=To(mN),gN=Re({},mp,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),HE=To(gN),KE=Re({},mp,{data:0}),q_=To(KE),SN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wl(u){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(u):(u=Xo[u])?!!p[u]:!1}function Av(){return Wl}var RN=Re({},pn,{key:function(u){if(u.key){var p=SN[u.key]||u.key;if(p!=="Unidentified")return p}return u.type==="keypress"?(u=uS(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?TN[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Av,charCode:function(u){return u.type==="keypress"?uS(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?uS(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),vN=To(RN),yN=Re({},Vr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),YA=To(yN),id=Re({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Av}),CN=To(id),rd=Re({},mp,{propertyName:0,elapsedTime:0,pseudoElement:0}),Iv=To(rd),bN=Re({},Vr,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),dt=To(bN),AN=Re({},mp,{newState:0,oldState:0}),IN=To(AN),wN=[9,13,27,32],wv=Gl&&"CompositionEvent"in window,Hl=null;Gl&&"documentMode"in document&&(Hl=document.documentMode);var ON=Gl&&"TextEvent"in window&&!Hl,zA=Gl&&(!wv||Hl&&8<Hl&&11>=Hl),qA=" ",X_=!1;function XA(u,p){switch(u){case"keyup":return wN.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function JA(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var dh=!1;function NN(u,p){switch(u){case"compositionend":return JA(p);case"keypress":return p.which!==32?null:(X_=!0,qA);case"textInput":return u=p.data,u===qA&&X_?null:u;default:return null}}function Zs(u,p){if(dh)return u==="compositionend"||!wv&&XA(u,p)?(u=WA(),lS=vv=ks=null,dh=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return zA&&p.locale!=="ko"?null:p.data;default:return null}}var DN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ZA(u){var p=u&&u.nodeName&&u.nodeName.toLowerCase();return p==="input"?!!DN[u.type]:p==="textarea"}function QA(u,p,E,g){K_?Y_?Y_.push(g):Y_=[g]:K_=g,p=Df(p,"onChange"),0<p.length&&(E=new rs("onChange","change",null,E,g),u.push({event:E,listeners:p}))}var Sp=null,Kl=null;function PN(u){Nf(u,0)}function hS(u){var p=xE(u);if(ci(p))return u}function $A(u,p){if(u==="change")return p}var Bn=!1;if(Gl){var Ov;if(Gl){var Nv="oninput"in document;if(!Nv){var eI=document.createElement("div");eI.setAttribute("oninput","return;"),Nv=typeof eI.oninput=="function"}Ov=Nv}else Ov=!1;Bn=Ov&&(!document.documentMode||9<document.documentMode)}function tI(){Sp&&(Sp.detachEvent("onpropertychange",pS),Kl=Sp=null)}function pS(u){if(u.propertyName==="value"&&hS(Kl)){var p=[];QA(p,Kl,u,Sv(u)),GA(PN,p)}}function LN(u,p,E){u==="focusin"?(tI(),Sp=p,Kl=E,Sp.attachEvent("onpropertychange",pS)):u==="focusout"&&tI()}function kN(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return hS(Kl)}function Dv(u,p){if(u==="click")return hS(p)}function YE(u,p){if(u==="input"||u==="change")return hS(p)}function MN(u,p){return u===p&&(u!==0||1/u===1/p)||u!==u&&p!==p}var Jo=typeof Object.is=="function"?Object.is:MN;function nd(u,p){if(Jo(u,p))return!0;if(typeof u!="object"||u===null||typeof p!="object"||p===null)return!1;var E=Object.keys(u),g=Object.keys(p);if(E.length!==g.length)return!1;for(g=0;g<E.length;g++){var y=E[g];if(!tv.call(p,y)||!Jo(u[y],p[y]))return!1}return!0}function iI(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function rI(u,p){var E=iI(u);u=0;for(var g;E;){if(E.nodeType===3){if(g=u+E.textContent.length,u<=p&&g>=p)return{node:E,offset:p-u};u=g}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=iI(E)}}function nI(u,p){return u&&p?u===p?!0:u&&u.nodeType===3?!1:p&&p.nodeType===3?nI(u,p.parentNode):"contains"in u?u.contains(p):u.compareDocumentPosition?!!(u.compareDocumentPosition(p)&16):!1:!1}function Ms(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var p=cS(u.document);p instanceof u.HTMLIFrameElement;){try{var E=typeof p.contentWindow.location.href=="string"}catch{E=!1}if(E)u=p.contentWindow;else break;p=cS(u.document)}return p}function Pv(u){var p=u&&u.nodeName&&u.nodeName.toLowerCase();return p&&(p==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||p==="textarea"||u.contentEditable==="true")}var UN=Gl&&"documentMode"in document&&11>=document.documentMode,Fr=null,Lv=null,zE=null,kv=!1;function aI(u,p,E){var g=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;kv||Fr==null||Fr!==cS(g)||(g=Fr,"selectionStart"in g&&Pv(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),zE&&nd(zE,g)||(zE=g,g=Df(Lv,"onSelect"),0<g.length&&(p=new rs("onSelect","select",null,p,E),u.push({event:p,listeners:g}),p.target=Fr)))}function Yl(u,p){var E={};return E[u.toLowerCase()]=p.toLowerCase(),E["Webkit"+u]="webkit"+p,E["Moz"+u]="moz"+p,E}var J_={animationend:Yl("Animation","AnimationEnd"),animationiteration:Yl("Animation","AnimationIteration"),animationstart:Yl("Animation","AnimationStart"),transitionrun:Yl("Transition","TransitionRun"),transitionstart:Yl("Transition","TransitionStart"),transitioncancel:Yl("Transition","TransitionCancel"),transitionend:Yl("Transition","TransitionEnd")},Mv={},sI={};Gl&&(sI=document.createElement("div").style,"AnimationEvent"in window||(delete J_.animationend.animation,delete J_.animationiteration.animation,delete J_.animationstart.animation),"TransitionEvent"in window||delete J_.transitionend.transition);function zl(u){if(Mv[u])return Mv[u];if(!J_[u])return u;var p=J_[u],E;for(E in p)if(p.hasOwnProperty(E)&&E in sI)return Mv[u]=p[E];return u}var oI=zl("animationend"),cI=zl("animationiteration"),Z_=zl("animationstart"),qE=zl("transitionrun"),xN=zl("transitionstart"),ee=zl("transitioncancel"),dI=zl("transitionend"),lI=new Map,Uv="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Uv.push("scrollEnd");function ad(u,p){lI.set(u,p),Es(p,[u])}var _S=new WeakMap;function Ro(u,p){if(typeof u=="object"&&u!==null){var E=_S.get(u);return E!==void 0?E:(p={value:u,source:p,stack:UA(p)},_S.set(u,p),p)}return{value:u,source:p,stack:UA(p)}}var bc=[],Q_=0,xv=0;function Zd(){for(var u=Q_,p=xv=Q_=0;p<u;){var E=bc[p];bc[p++]=null;var g=bc[p];bc[p++]=null;var y=bc[p];bc[p++]=null;var O=bc[p];if(bc[p++]=null,g!==null&&y!==null){var H=g.pending;H===null?y.next=y:(y.next=H.next,H.next=y),g.pending=y}O!==0&&lh(E,y,O)}}function Ac(u,p,E,g){bc[Q_++]=u,bc[Q_++]=p,bc[Q_++]=E,bc[Q_++]=g,xv|=g,u.lanes|=g,u=u.alternate,u!==null&&(u.lanes|=g)}function Vv(u,p,E,g){return Ac(u,p,E,g),uh(u)}function $_(u,p){return Ac(u,null,null,p),uh(u)}function lh(u,p,E){u.lanes|=E;var g=u.alternate;g!==null&&(g.lanes|=E);for(var y=!1,O=u.return;O!==null;)O.childLanes|=E,g=O.alternate,g!==null&&(g.childLanes|=E),O.tag===22&&(u=O.stateNode,u===null||u._visibility&1||(y=!0)),u=O,O=O.return;return u.tag===3?(O=u.stateNode,y&&p!==null&&(y=31-fs(E),u=O.hiddenUpdates,g=u[y],g===null?u[y]=[p]:g.push(p),p.lane=E|536870912),O):null}function uh(u){if(50<Rm)throw Rm=0,my=null,Error(K(185));for(var p=u.return;p!==null;)u=p,p=u.return;return u.tag===3?u.stateNode:null}var Ic={};function VN(u,p,E,g){this.tag=u,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zo(u,p,E,g){return new VN(u,p,E,g)}function Fv(u){return u=u.prototype,!(!u||!u.isReactComponent)}function ql(u,p){var E=u.alternate;return E===null?(E=Zo(u.tag,p,u.key,u.mode),E.elementType=u.elementType,E.type=u.type,E.stateNode=u.stateNode,E.alternate=u,u.alternate=E):(E.pendingProps=p,E.type=u.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=u.flags&65011712,E.childLanes=u.childLanes,E.lanes=u.lanes,E.child=u.child,E.memoizedProps=u.memoizedProps,E.memoizedState=u.memoizedState,E.updateQueue=u.updateQueue,p=u.dependencies,E.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},E.sibling=u.sibling,E.index=u.index,E.ref=u.ref,E.refCleanup=u.refCleanup,E}function ef(u,p){u.flags&=65011714;var E=u.alternate;return E===null?(u.childLanes=0,u.lanes=p,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=E.childLanes,u.lanes=E.lanes,u.child=E.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=E.memoizedProps,u.memoizedState=E.memoizedState,u.updateQueue=E.updateQueue,u.type=E.type,p=E.dependencies,u.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),u}function fS(u,p,E,g,y,O){var H=0;if(g=u,typeof u=="function")Fv(u)&&(H=1);else if(typeof u=="string")H=Dm(u,E,Ft.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case ia:return u=Zo(31,E,p,y),u.elementType=ia,u.lanes=O,u;case ke:return Xl(E.children,y,O,p);case Ve:H=8,y|=24;break;case Fe:return u=Zo(12,E,p,y|2),u.elementType=Fe,u.lanes=O,u;case oi:return u=Zo(13,E,p,y),u.elementType=oi,u.lanes=O,u;case ts:return u=Zo(19,E,p,y),u.elementType=ts,u.lanes=O,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case ht:case kt:H=10;break e;case At:H=9;break e;case Ar:H=11;break e;case tr:H=14;break e;case is:H=16,g=null;break e}H=29,E=Error(K(130,u===null?"null":typeof u,"")),g=null}return p=Zo(H,E,p,y),p.elementType=u,p.type=g,p.lanes=O,p}function Xl(u,p,E,g){return u=Zo(7,u,g,p),u.lanes=E,u}function Pn(u,p,E){return u=Zo(6,u,null,p),u.lanes=E,u}function Bv(u,p,E){return p=Zo(4,u.children!==null?u.children:[],u.key,p),p.lanes=E,p.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},p}var vo=[],tf=0,ES=null,mS=0,yo=[],wc=0,Tp=null,Jl=1,Qo="";function Rp(u,p){vo[tf++]=mS,vo[tf++]=ES,ES=u,mS=p}function gS(u,p,E){yo[wc++]=Jl,yo[wc++]=Qo,yo[wc++]=Tp,Tp=u;var g=Jl;u=Qo;var y=32-fs(g)-1;g&=~(1<<y),E+=1;var O=32-fs(p)+y;if(30<O){var H=y-y%5;O=(g&(1<<H)-1).toString(32),g>>=H,y-=H,Jl=1<<32-fs(p)+y|E<<y|g,Qo=O+u}else Jl=1<<O|E<<y|g,Qo=u}function XE(u){u.return!==null&&(Rp(u,1),gS(u,1,0))}function jv(u){for(;u===ES;)ES=vo[--tf],vo[tf]=null,mS=vo[--tf],vo[tf]=null;for(;u===Tp;)Tp=yo[--wc],yo[wc]=null,Qo=yo[--wc],yo[wc]=null,Jl=yo[--wc],yo[wc]=null}var ms=null,sn=null,Hr=!1,vp=null,Qd=!1,Gv=Error(K(519));function yp(u){var p=Error(K(418,""));throw ZE(Ro(p,u)),Gv}function SS(u){var p=u.stateNode,E=u.type,g=u.memoizedProps;switch(p[Ls]=u,p[go]=g,E){case"dialog":Wi("cancel",p),Wi("close",p);break;case"iframe":case"object":case"embed":Wi("load",p);break;case"video":case"audio":for(E=0;E<jp.length;E++)Wi(jp[E],p);break;case"source":Wi("error",p);break;case"img":case"image":case"link":Wi("error",p),Wi("load",p);break;case"details":Wi("toggle",p);break;case"input":Wi("invalid",p),xA(p,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),oS(p);break;case"select":Wi("invalid",p);break;case"textarea":Wi("invalid",p),FA(p,g.value,g.defaultValue,g.children),oS(p)}E=g.children,typeof E!="string"&&typeof E!="number"&&typeof E!="bigint"||p.textContent===""+E||g.suppressHydrationWarning===!0||Lf(p.textContent,E)?(g.popover!=null&&(Wi("beforetoggle",p),Wi("toggle",p)),g.onScroll!=null&&Wi("scroll",p),g.onScrollEnd!=null&&Wi("scrollend",p),g.onClick!=null&&(p.onclick=kf),p=!0):p=!1,p||yp(u)}function rf(u){for(ms=u.return;ms;)switch(ms.tag){case 5:case 13:Qd=!1;return;case 27:case 3:Qd=!0;return;default:ms=ms.return}}function JE(u){if(u!==ms)return!1;if(!Hr)return rf(u),Hr=!0,!1;var p=u.tag,E;if((E=p!==3&&p!==27)&&((E=p===5)&&(E=u.type,E=!(E!=="form"&&E!=="button")||Iy(u.type,u.memoizedProps)),E=!E),E&&sn&&yp(u),rf(u),p===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(K(317));e:{for(u=u.nextSibling,p=0;u;){if(u.nodeType===8)if(E=u.data,E==="/$"){if(p===0){sn=Ed(u.nextSibling);break e}p--}else E!=="$"&&E!=="$!"&&E!=="$?"||p++;u=u.nextSibling}sn=null}}else p===27?(p=sn,Vh(u.type)?(u=Ny,Ny=null,sn=u):sn=p):sn=ms?Ed(u.stateNode.nextSibling):null;return!0}function Zl(){sn=ms=null,Hr=!1}function uI(){var u=vp;return u!==null&&(Gn===null?Gn=u:Gn.push.apply(Gn,u),vp=null),u}function ZE(u){vp===null?vp=[u]:vp.push(u)}var Wv=at(null),Cp=null,Ql=null;function hh(u,p,E){Tt(Wv,p._currentValue),p._currentValue=E}function $l(u){u._currentValue=Wv.current,gt(Wv)}function Hv(u,p,E){for(;u!==null;){var g=u.alternate;if((u.childLanes&p)!==p?(u.childLanes|=p,g!==null&&(g.childLanes|=p)):g!==null&&(g.childLanes&p)!==p&&(g.childLanes|=p),u===E)break;u=u.return}}function Kv(u,p,E,g){var y=u.child;for(y!==null&&(y.return=u);y!==null;){var O=y.dependencies;if(O!==null){var H=y.child;O=O.firstContext;e:for(;O!==null;){var Z=O;O=y;for(var le=0;le<p.length;le++)if(Z.context===p[le]){O.lanes|=E,Z=O.alternate,Z!==null&&(Z.lanes|=E),Hv(O.return,E,u),g||(H=null);break e}O=Z.next}}else if(y.tag===18){if(H=y.return,H===null)throw Error(K(341));H.lanes|=E,O=H.alternate,O!==null&&(O.lanes|=E),Hv(H,E,u),H=null}else H=y.child;if(H!==null)H.return=y;else for(H=y;H!==null;){if(H===u){H=null;break}if(y=H.sibling,y!==null){y.return=H.return,H=y;break}H=H.return}y=H}}function QE(u,p,E,g){u=null;for(var y=p,O=!1;y!==null;){if(!O){if((y.flags&524288)!==0)O=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var H=y.alternate;if(H===null)throw Error(K(387));if(H=H.memoizedProps,H!==null){var Z=y.type;Jo(y.pendingProps.value,H.value)||(u!==null?u.push(Z):u=[Z])}}else if(y===_s.current){if(H=y.alternate,H===null)throw Error(K(387));H.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(u!==null?u.push(Lm):u=[Lm])}y=y.return}u!==null&&Kv(p,u,E,g),p.flags|=262144}function TS(u){for(u=u.firstContext;u!==null;){if(!Jo(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function $o(u){Cp=u,Ql=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function ra(u){return hI(Cp,u)}function ph(u,p){return Cp===null&&$o(u),hI(u,p)}function hI(u,p){var E=p._currentValue;if(p={context:p,memoizedValue:E,next:null},Ql===null){if(u===null)throw Error(K(308));Ql=p,u.dependencies={lanes:0,firstContext:p},u.flags|=524288}else Ql=Ql.next=p;return E}var FN=typeof AbortController<"u"?AbortController:function(){var u=[],p=this.signal={aborted:!1,addEventListener:function(E,g){u.push(g)}};this.abort=function(){p.aborted=!0,u.forEach(function(E){return E()})}},BN=x.unstable_scheduleCallback,Yv=x.unstable_NormalPriority,pa={$$typeof:kt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function bp(){return{controller:new FN,data:new Map,refCount:0}}function $E(u){u.refCount--,u.refCount===0&&BN(Yv,function(){u.controller.abort()})}var em=null,sd=0,nf=0,af=null;function jN(u,p){if(em===null){var E=em=[];sd=0,nf=mu(),af={status:"pending",value:void 0,then:function(g){E.push(g)}}}return sd++,p.then(pI,pI),p}function pI(){if(--sd===0&&em!==null){af!==null&&(af.status="fulfilled");var u=em;em=null,nf=0,af=null;for(var p=0;p<u.length;p++)(0,u[p])()}}function GN(u,p){var E=[],g={status:"pending",value:null,reason:null,then:function(y){E.push(y)}};return u.then(function(){g.status="fulfilled",g.value=p;for(var y=0;y<E.length;y++)(0,E[y])(p)},function(y){for(g.status="rejected",g.reason=y,y=0;y<E.length;y++)(0,E[y])(void 0)}),g}var _I=je.S;je.S=function(u,p){typeof p=="object"&&p!==null&&typeof p.then=="function"&&jN(u,p),_I!==null&&_I(u,p)};var eu=at(null);function zv(){var u=eu.current;return u!==null?u:In.pooledCache}function RS(u,p){p===null?Tt(eu,eu.current):Tt(eu,p.pool)}function fI(){var u=zv();return u===null?null:{parent:pa._currentValue,pool:u}}var tu=Error(K(460)),EI=Error(K(474)),vS=Error(K(542)),iu={then:function(){}};function mI(u){return u=u.status,u==="fulfilled"||u==="rejected"}function yS(){}function gI(u,p,E){switch(E=u[E],E===void 0?u.push(p):E!==p&&(p.then(yS,yS),p=E),p.status){case"fulfilled":return p.value;case"rejected":throw u=p.reason,TI(u),u;default:if(typeof p.status=="string")p.then(yS,yS);else{if(u=In,u!==null&&100<u.shellSuspendCounter)throw Error(K(482));u=p,u.status="pending",u.then(function(g){if(p.status==="pending"){var y=p;y.status="fulfilled",y.value=g}},function(g){if(p.status==="pending"){var y=p;y.status="rejected",y.reason=g}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw u=p.reason,TI(u),u}throw tm=p,tu}}var tm=null;function SI(){if(tm===null)throw Error(K(459));var u=tm;return tm=null,u}function TI(u){if(u===tu||u===vS)throw Error(K(483))}var Co=!1;function im(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function qv(u,p){u=u.updateQueue,p.updateQueue===u&&(p.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function _h(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function $d(u,p,E){var g=u.updateQueue;if(g===null)return null;if(g=g.shared,(Or&2)!==0){var y=g.pending;return y===null?p.next=p:(p.next=y.next,y.next=p),g.pending=p,p=uh(u),lh(u,null,E),p}return Ac(u,g,p,E),uh(u)}function rm(u,p,E){if(p=p.updateQueue,p!==null&&(p=p.shared,(E&4194048)!==0)){var g=p.lanes;g&=u.pendingLanes,E|=g,p.lanes=E,DA(u,E)}}function Xv(u,p){var E=u.updateQueue,g=u.alternate;if(g!==null&&(g=g.updateQueue,E===g)){var y=null,O=null;if(E=E.firstBaseUpdate,E!==null){do{var H={lane:E.lane,tag:E.tag,payload:E.payload,callback:null,next:null};O===null?y=O=H:O=O.next=H,E=E.next}while(E!==null);O===null?y=O=p:O=O.next=p}else y=O=p;E={baseState:g.baseState,firstBaseUpdate:y,lastBaseUpdate:O,shared:g.shared,callbacks:g.callbacks},u.updateQueue=E;return}u=E.lastBaseUpdate,u===null?E.firstBaseUpdate=p:u.next=p,E.lastBaseUpdate=p}var Jv=!1;function ru(){if(Jv){var u=af;if(u!==null)throw u}}function nu(u,p,E,g){Jv=!1;var y=u.updateQueue;Co=!1;var O=y.firstBaseUpdate,H=y.lastBaseUpdate,Z=y.shared.pending;if(Z!==null){y.shared.pending=null;var le=Z,be=le.next;le.next=null,H===null?O=be:H.next=be,H=le;var We=u.alternate;We!==null&&(We=We.updateQueue,Z=We.lastBaseUpdate,Z!==H&&(Z===null?We.firstBaseUpdate=be:Z.next=be,We.lastBaseUpdate=le))}if(O!==null){var Qe=y.baseState;H=0,We=be=le=null,Z=O;do{var De=Z.lane&-536870913,Le=De!==Z.lane;if(Le?(fr&De)===De:(g&De)===De){De!==0&&De===nf&&(Jv=!0),We!==null&&(We=We.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var wi=u,ui=Z;De=p;var cn=E;switch(ui.tag){case 1:if(wi=ui.payload,typeof wi=="function"){Qe=wi.call(cn,Qe,De);break e}Qe=wi;break e;case 3:wi.flags=wi.flags&-65537|128;case 0:if(wi=ui.payload,De=typeof wi=="function"?wi.call(cn,Qe,De):wi,De==null)break e;Qe=Re({},Qe,De);break e;case 2:Co=!0}}De=Z.callback,De!==null&&(u.flags|=64,Le&&(u.flags|=8192),Le=y.callbacks,Le===null?y.callbacks=[De]:Le.push(De))}else Le={lane:De,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},We===null?(be=We=Le,le=Qe):We=We.next=Le,H|=De;if(Z=Z.next,Z===null){if(Z=y.shared.pending,Z===null)break;Le=Z,Z=Le.next,Le.next=null,y.lastBaseUpdate=Le,y.shared.pending=null}}while(!0);We===null&&(le=Qe),y.baseState=le,y.firstBaseUpdate=be,y.lastBaseUpdate=We,O===null&&(y.shared.lanes=0),wo|=H,u.lanes=H,u.memoizedState=Qe}}function CS(u,p){if(typeof u!="function")throw Error(K(191,u));u.call(p)}function sf(u,p){var E=u.callbacks;if(E!==null)for(u.callbacks=null,u=0;u<E.length;u++)CS(E[u],p)}var fh=at(null),of=at(0);function Eh(u,p){u=pd,Tt(of,u),Tt(fh,p),pd=u|p.baseLanes}function od(){Tt(of,pd),Tt(fh,fh.current)}function Zv(){pd=of.current,gt(fh),gt(of)}var mh=0,Gi=null,on=null,La=null,cf=!1,df=!1,Ap=!1,bS=0,nm=0,lf=null,WN=0;function qn(){throw Error(K(321))}function ec(u,p){if(p===null)return!1;for(var E=0;E<p.length&&E<u.length;E++)if(!Jo(u[E],p[E]))return!1;return!0}function Qv(u,p,E,g,y,O){return mh=O,Gi=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,je.H=u===null||u.memoizedState===null?Oc:Ao,Ap=!1,O=E(g,y),Ap=!1,df&&(O=vI(p,E,g,y)),RI(u),O}function RI(u){je.H=na;var p=on!==null&&on.next!==null;if(mh=0,La=on=Gi=null,cf=!1,nm=0,lf=null,p)throw Error(K(300));u===null||ns||(u=u.dependencies,u!==null&&TS(u)&&(ns=!0))}function vI(u,p,E,g){Gi=u;var y=0;do{if(df&&(lf=null),nm=0,df=!1,25<=y)throw Error(K(301));if(y+=1,La=on=null,u.updateQueue!=null){var O=u.updateQueue;O.lastEffect=null,O.events=null,O.stores=null,O.memoCache!=null&&(O.memoCache.index=0)}je.H=dy,O=p(E,g)}while(df);return O}function $v(){var u=je.H,p=u.useState()[0];return p=typeof p.then=="function"?sm(p):p,u=u.useState()[0],(on!==null?on.memoizedState:null)!==u&&(Gi.flags|=1024),p}function ey(){var u=bS!==0;return bS=0,u}function am(u,p,E){p.updateQueue=u.updateQueue,p.flags&=-2053,u.lanes&=~E}function ty(u){if(cf){for(u=u.memoizedState;u!==null;){var p=u.queue;p!==null&&(p.pending=null),u=u.next}cf=!1}mh=0,La=on=Gi=null,df=!1,nm=bS=0,lf=null}function bo(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return La===null?Gi.memoizedState=La=u:La=La.next=u,La}function ka(){if(on===null){var u=Gi.alternate;u=u!==null?u.memoizedState:null}else u=on.next;var p=La===null?Gi.memoizedState:La.next;if(p!==null)La=p,on=u;else{if(u===null)throw Gi.alternate===null?Error(K(467)):Error(K(310));on=u,u={memoizedState:on.memoizedState,baseState:on.baseState,baseQueue:on.baseQueue,queue:on.queue,next:null},La===null?Gi.memoizedState=La=u:La=La.next=u}return La}function au(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function sm(u){var p=nm;return nm+=1,lf===null&&(lf=[]),u=gI(lf,u,p),p=Gi,(La===null?p.memoizedState:La.next)===null&&(p=p.alternate,je.H=p===null||p.memoizedState===null?Oc:Ao),u}function AS(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return sm(u);if(u.$$typeof===kt)return ra(u)}throw Error(K(438,String(u)))}function iy(u){var p=null,E=Gi.updateQueue;if(E!==null&&(p=E.memoCache),p==null){var g=Gi.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(p={data:g.data.map(function(y){return y.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),E===null&&(E=au(),Gi.updateQueue=E),E.memoCache=p,E=p.data[p.index],E===void 0)for(E=p.data[p.index]=Array(u),g=0;g<u;g++)E[g]=ha;return p.index++,E}function su(u,p){return typeof p=="function"?p(u):p}function IS(u){var p=ka();return ry(p,on,u)}function ry(u,p,E){var g=u.queue;if(g===null)throw Error(K(311));g.lastRenderedReducer=E;var y=u.baseQueue,O=g.pending;if(O!==null){if(y!==null){var H=y.next;y.next=O.next,O.next=H}p.baseQueue=y=O,g.pending=null}if(O=u.baseState,y===null)u.memoizedState=O;else{p=y.next;var Z=H=null,le=null,be=p,We=!1;do{var Qe=be.lane&-536870913;if(Qe!==be.lane?(fr&Qe)===Qe:(mh&Qe)===Qe){var De=be.revertLane;if(De===0)le!==null&&(le=le.next={lane:0,revertLane:0,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null}),Qe===nf&&(We=!0);else if((mh&De)===De){be=be.next,De===nf&&(We=!0);continue}else Qe={lane:0,revertLane:be.revertLane,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null},le===null?(Z=le=Qe,H=O):le=le.next=Qe,Gi.lanes|=De,wo|=De;Qe=be.action,Ap&&E(O,Qe),O=be.hasEagerState?be.eagerState:E(O,Qe)}else De={lane:Qe,revertLane:be.revertLane,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null},le===null?(Z=le=De,H=O):le=le.next=De,Gi.lanes|=Qe,wo|=Qe;be=be.next}while(be!==null&&be!==p);if(le===null?H=O:le.next=Z,!Jo(O,u.memoizedState)&&(ns=!0,We&&(E=af,E!==null)))throw E;u.memoizedState=O,u.baseState=H,u.baseQueue=le,g.lastRenderedState=O}return y===null&&(g.lanes=0),[u.memoizedState,g.dispatch]}function Ip(u){var p=ka(),E=p.queue;if(E===null)throw Error(K(311));E.lastRenderedReducer=u;var g=E.dispatch,y=E.pending,O=p.memoizedState;if(y!==null){E.pending=null;var H=y=y.next;do O=u(O,H.action),H=H.next;while(H!==y);Jo(O,p.memoizedState)||(ns=!0),p.memoizedState=O,p.baseQueue===null&&(p.baseState=O),E.lastRenderedState=O}return[O,g]}function yI(u,p,E){var g=Gi,y=ka(),O=Hr;if(O){if(E===void 0)throw Error(K(407));E=E()}else E=p();var H=!Jo((on||y).memoizedState,E);H&&(y.memoizedState=E,ns=!0),y=y.queue;var Z=OS.bind(null,g,y,u);if(wp(2048,8,Z,[u]),y.getSnapshot!==p||H||La!==null&&La.memoizedState.tag&1){if(g.flags|=2048,uf(9,LS(),CI.bind(null,g,y,E,p),null),In===null)throw Error(K(349));O||(mh&124)!==0||wS(g,p,E)}return E}function wS(u,p,E){u.flags|=16384,u={getSnapshot:p,value:E},p=Gi.updateQueue,p===null?(p=au(),Gi.updateQueue=p,p.stores=[u]):(E=p.stores,E===null?p.stores=[u]:E.push(u))}function CI(u,p,E,g){p.value=E,p.getSnapshot=g,bI(p)&&AI(u)}function OS(u,p,E){return E(function(){bI(p)&&AI(u)})}function bI(u){var p=u.getSnapshot;u=u.value;try{var E=p();return!Jo(u,E)}catch{return!0}}function AI(u){var p=$_(u,2);p!==null&&$s(p,u,2)}function ny(u){var p=bo();if(typeof u=="function"){var E=u;if(u=E(),Ap){zd(!0);try{E()}finally{zd(!1)}}}return p.memoizedState=p.baseState=u,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:su,lastRenderedState:u},p}function II(u,p,E,g){return u.baseState=E,ry(u,on,typeof g=="function"?g:su)}function HN(u,p,E,g,y){if(Ef(u))throw Error(K(485));if(u=p.action,u!==null){var O={payload:y,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(H){O.listeners.push(H)}};je.T!==null?E(!0):O.isTransition=!1,g(O),E=p.pending,E===null?(O.next=p.pending=O,wI(p,O)):(O.next=E.next,p.pending=E.next=O)}}function wI(u,p){var E=p.action,g=p.payload,y=u.state;if(p.isTransition){var O=je.T,H={};je.T=H;try{var Z=E(y,g),le=je.S;le!==null&&le(H,Z),NS(u,p,Z)}catch(be){ay(u,p,be)}finally{je.T=O}}else try{O=E(y,g),NS(u,p,O)}catch(be){ay(u,p,be)}}function NS(u,p,E){E!==null&&typeof E=="object"&&typeof E.then=="function"?E.then(function(g){OI(u,p,g)},function(g){return ay(u,p,g)}):OI(u,p,E)}function OI(u,p,E){p.status="fulfilled",p.value=E,DS(p),u.state=E,p=u.pending,p!==null&&(E=p.next,E===p?u.pending=null:(E=E.next,p.next=E,wI(u,E)))}function ay(u,p,E){var g=u.pending;if(u.pending=null,g!==null){g=g.next;do p.status="rejected",p.reason=E,DS(p),p=p.next;while(p!==g)}u.action=null}function DS(u){u=u.listeners;for(var p=0;p<u.length;p++)(0,u[p])()}function NI(u,p){return p}function gh(u,p){if(Hr){var E=In.formState;if(E!==null){e:{var g=Gi;if(Hr){if(sn){t:{for(var y=sn,O=Qd;y.nodeType!==8;){if(!O){y=null;break t}if(y=Ed(y.nextSibling),y===null){y=null;break t}}O=y.data,y=O==="F!"||O==="F"?y:null}if(y){sn=Ed(y.nextSibling),g=y.data==="F!";break e}}yp(g)}g=!1}g&&(p=E[0])}}return E=bo(),E.memoizedState=E.baseState=p,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:NI,lastRenderedState:p},E.queue=g,E=ff.bind(null,Gi,g),g.dispatch=E,g=ny(!1),O=cy.bind(null,Gi,!1,g.queue),g=bo(),y={state:p,dispatch:null,action:u,pending:null},g.queue=y,E=HN.bind(null,Gi,y,O,E),y.dispatch=E,g.memoizedState=u,[p,E,!1]}function PS(u){var p=ka();return el(p,on,u)}function el(u,p,E){if(p=ry(u,p,NI)[0],u=IS(su)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var g=sm(p)}catch(H){throw H===tu?vS:H}else g=p;p=ka();var y=p.queue,O=y.dispatch;return E!==p.memoizedState&&(Gi.flags|=2048,uf(9,LS(),KN.bind(null,y,E),null)),[g,O,u]}function KN(u,p){u.action=p}function DI(u){var p=ka(),E=on;if(E!==null)return el(p,E,u);ka(),p=p.memoizedState,E=ka();var g=E.queue.dispatch;return E.memoizedState=u,[p,g,!1]}function uf(u,p,E,g){return u={tag:u,create:E,deps:g,inst:p,next:null},p=Gi.updateQueue,p===null&&(p=au(),Gi.updateQueue=p),E=p.lastEffect,E===null?p.lastEffect=u.next=u:(g=E.next,E.next=u,u.next=g,p.lastEffect=u),u}function LS(){return{destroy:void 0,resource:void 0}}function Sh(){return ka().memoizedState}function kS(u,p,E,g){var y=bo();g=g===void 0?null:g,Gi.flags|=u,y.memoizedState=uf(1|p,LS(),E,g)}function wp(u,p,E,g){var y=ka();g=g===void 0?null:g;var O=y.memoizedState.inst;on!==null&&g!==null&&ec(g,on.memoizedState.deps)?y.memoizedState=uf(p,O,E,g):(Gi.flags|=u,y.memoizedState=uf(1|p,O,E,g))}function hf(u,p){kS(8390656,8,u,p)}function pf(u,p){wp(2048,8,u,p)}function PI(u,p){return wp(4,2,u,p)}function LI(u,p){return wp(4,4,u,p)}function kI(u,p){if(typeof p=="function"){u=u();var E=p(u);return function(){typeof E=="function"?E():p(null)}}if(p!=null)return u=u(),p.current=u,function(){p.current=null}}function MI(u,p,E){E=E!=null?E.concat([u]):null,wp(4,4,kI.bind(null,p,u),E)}function sy(){}function Th(u,p){var E=ka();p=p===void 0?null:p;var g=E.memoizedState;return p!==null&&ec(p,g[1])?g[0]:(E.memoizedState=[u,p],u)}function UI(u,p){var E=ka();p=p===void 0?null:p;var g=E.memoizedState;if(p!==null&&ec(p,g[1]))return g[0];if(g=u(),Ap){zd(!0);try{u()}finally{zd(!1)}}return E.memoizedState=[g,p],g}function tc(u,p,E){return E===void 0||(mh&1073741824)!==0?u.memoizedState=p:(u.memoizedState=E,u=Af(),Gi.lanes|=u,wo|=u,E)}function _f(u,p,E,g){return Jo(E,p)?E:fh.current!==null?(u=tc(u,E,g),Jo(u,p)||(ns=!0),u):(mh&42)===0?(ns=!0,u.memoizedState=E):(u=Af(),Gi.lanes|=u,wo|=u,p)}function Rh(u,p,E,g,y){var O=tt.p;tt.p=O!==0&&8>O?O:8;var H=je.T,Z={};je.T=Z,cy(u,!1,p,E);try{var le=y(),be=je.S;if(be!==null&&be(Z,le),le!==null&&typeof le=="object"&&typeof le.then=="function"){var We=GN(le,g);cm(u,p,We,nc(u))}else cm(u,p,g,nc(u))}catch(Qe){cm(u,p,{then:function(){},status:"rejected",reason:Qe},nc())}finally{tt.p=O,je.T=H}}function ou(){}function cu(u,p,E,g){if(u.tag!==5)throw Error(K(476));var y=xI(u).queue;Rh(u,y,p,ni,E===null?ou:function(){return MS(u),E(g)})}function xI(u){var p=u.memoizedState;if(p!==null)return p;p={memoizedState:ni,baseState:ni,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:su,lastRenderedState:ni},next:null};var E={};return p.next={memoizedState:E,baseState:E,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:su,lastRenderedState:E},next:null},u.memoizedState=p,u=u.alternate,u!==null&&(u.memoizedState=p),p}function MS(u){var p=xI(u).next.queue;cm(u,p,{},nc())}function oy(){return ra(Lm)}function US(){return ka().memoizedState}function VI(){return ka().memoizedState}function YN(u){for(var p=u.return;p!==null;){switch(p.tag){case 24:case 3:var E=nc();u=_h(E);var g=$d(p,u,E);g!==null&&($s(g,p,E),rm(g,p,E)),p={cache:bp()},u.payload=p;return}p=p.return}}function om(u,p,E){var g=nc();E={lane:g,revertLane:0,action:E,hasEagerState:!1,eagerState:null,next:null},Ef(u)?mf(p,E):(E=Vv(u,p,E,g),E!==null&&($s(E,u,g),FI(E,p,g)))}function ff(u,p,E){var g=nc();cm(u,p,E,g)}function cm(u,p,E,g){var y={lane:g,revertLane:0,action:E,hasEagerState:!1,eagerState:null,next:null};if(Ef(u))mf(p,y);else{var O=u.alternate;if(u.lanes===0&&(O===null||O.lanes===0)&&(O=p.lastRenderedReducer,O!==null))try{var H=p.lastRenderedState,Z=O(H,E);if(y.hasEagerState=!0,y.eagerState=Z,Jo(Z,H))return Ac(u,p,y,0),In===null&&Zd(),!1}catch{}finally{}if(E=Vv(u,p,y,g),E!==null)return $s(E,u,g),FI(E,p,g),!0}return!1}function cy(u,p,E,g){if(g={lane:2,revertLane:mu(),action:g,hasEagerState:!1,eagerState:null,next:null},Ef(u)){if(p)throw Error(K(479))}else p=Vv(u,E,g,2),p!==null&&$s(p,u,2)}function Ef(u){var p=u.alternate;return u===Gi||p!==null&&p===Gi}function mf(u,p){df=cf=!0;var E=u.pending;E===null?p.next=p:(p.next=E.next,E.next=p),u.pending=p}function FI(u,p,E){if((E&4194048)!==0){var g=p.lanes;g&=u.pendingLanes,E|=g,p.lanes=E,DA(u,E)}}var na={readContext:ra,use:AS,useCallback:qn,useContext:qn,useEffect:qn,useImperativeHandle:qn,useLayoutEffect:qn,useInsertionEffect:qn,useMemo:qn,useReducer:qn,useRef:qn,useState:qn,useDebugValue:qn,useDeferredValue:qn,useTransition:qn,useSyncExternalStore:qn,useId:qn,useHostTransitionStatus:qn,useFormState:qn,useActionState:qn,useOptimistic:qn,useMemoCache:qn,useCacheRefresh:qn},Oc={readContext:ra,use:AS,useCallback:function(u,p){return bo().memoizedState=[u,p===void 0?null:p],u},useContext:ra,useEffect:hf,useImperativeHandle:function(u,p,E){E=E!=null?E.concat([u]):null,kS(4194308,4,kI.bind(null,p,u),E)},useLayoutEffect:function(u,p){return kS(4194308,4,u,p)},useInsertionEffect:function(u,p){kS(4,2,u,p)},useMemo:function(u,p){var E=bo();p=p===void 0?null:p;var g=u();if(Ap){zd(!0);try{u()}finally{zd(!1)}}return E.memoizedState=[g,p],g},useReducer:function(u,p,E){var g=bo();if(E!==void 0){var y=E(p);if(Ap){zd(!0);try{E(p)}finally{zd(!1)}}}else y=p;return g.memoizedState=g.baseState=y,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:y},g.queue=u,u=u.dispatch=om.bind(null,Gi,u),[g.memoizedState,u]},useRef:function(u){var p=bo();return u={current:u},p.memoizedState=u},useState:function(u){u=ny(u);var p=u.queue,E=ff.bind(null,Gi,p);return p.dispatch=E,[u.memoizedState,E]},useDebugValue:sy,useDeferredValue:function(u,p){var E=bo();return tc(E,u,p)},useTransition:function(){var u=ny(!1);return u=Rh.bind(null,Gi,u.queue,!0,!1),bo().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,p,E){var g=Gi,y=bo();if(Hr){if(E===void 0)throw Error(K(407));E=E()}else{if(E=p(),In===null)throw Error(K(349));(fr&124)!==0||wS(g,p,E)}y.memoizedState=E;var O={value:E,getSnapshot:p};return y.queue=O,hf(OS.bind(null,g,O,u),[u]),g.flags|=2048,uf(9,LS(),CI.bind(null,g,O,E,p),null),E},useId:function(){var u=bo(),p=In.identifierPrefix;if(Hr){var E=Qo,g=Jl;E=(g&~(1<<32-fs(g)-1)).toString(32)+E,p="«"+p+"R"+E,E=bS++,0<E&&(p+="H"+E.toString(32)),p+="»"}else E=WN++,p="«"+p+"r"+E.toString(32)+"»";return u.memoizedState=p},useHostTransitionStatus:oy,useFormState:gh,useActionState:gh,useOptimistic:function(u){var p=bo();p.memoizedState=p.baseState=u;var E={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=E,p=cy.bind(null,Gi,!0,E),E.dispatch=p,[u,p]},useMemoCache:iy,useCacheRefresh:function(){return bo().memoizedState=YN.bind(null,Gi)}},Ao={readContext:ra,use:AS,useCallback:Th,useContext:ra,useEffect:pf,useImperativeHandle:MI,useInsertionEffect:PI,useLayoutEffect:LI,useMemo:UI,useReducer:IS,useRef:Sh,useState:function(){return IS(su)},useDebugValue:sy,useDeferredValue:function(u,p){var E=ka();return _f(E,on.memoizedState,u,p)},useTransition:function(){var u=IS(su)[0],p=ka().memoizedState;return[typeof u=="boolean"?u:sm(u),p]},useSyncExternalStore:yI,useId:US,useHostTransitionStatus:oy,useFormState:PS,useActionState:PS,useOptimistic:function(u,p){var E=ka();return II(E,on,u,p)},useMemoCache:iy,useCacheRefresh:VI},dy={readContext:ra,use:AS,useCallback:Th,useContext:ra,useEffect:pf,useImperativeHandle:MI,useInsertionEffect:PI,useLayoutEffect:LI,useMemo:UI,useReducer:Ip,useRef:Sh,useState:function(){return Ip(su)},useDebugValue:sy,useDeferredValue:function(u,p){var E=ka();return on===null?tc(E,u,p):_f(E,on.memoizedState,u,p)},useTransition:function(){var u=Ip(su)[0],p=ka().memoizedState;return[typeof u=="boolean"?u:sm(u),p]},useSyncExternalStore:yI,useId:US,useHostTransitionStatus:oy,useFormState:DI,useActionState:DI,useOptimistic:function(u,p){var E=ka();return on!==null?II(E,on,u,p):(E.baseState=u,[u,E.queue.dispatch])},useMemoCache:iy,useCacheRefresh:VI},vh=null,gs=0;function yh(u){var p=gs;return gs+=1,vh===null&&(vh=[]),gI(vh,u,p)}function dm(u,p){p=p.props.ref,u.ref=p!==void 0?p:null}function gf(u,p){throw p.$$typeof===ye?Error(K(525)):(u=Object.prototype.toString.call(p),Error(K(31,u==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":u)))}function BI(u){var p=u._init;return p(u._payload)}function xS(u){function p(Ce,Se){if(u){var Ie=Ce.deletions;Ie===null?(Ce.deletions=[Se],Ce.flags|=16):Ie.push(Se)}}function E(Ce,Se){if(!u)return null;for(;Se!==null;)p(Ce,Se),Se=Se.sibling;return null}function g(Ce){for(var Se=new Map;Ce!==null;)Ce.key!==null?Se.set(Ce.key,Ce):Se.set(Ce.index,Ce),Ce=Ce.sibling;return Se}function y(Ce,Se){return Ce=ql(Ce,Se),Ce.index=0,Ce.sibling=null,Ce}function O(Ce,Se,Ie){return Ce.index=Ie,u?(Ie=Ce.alternate,Ie!==null?(Ie=Ie.index,Ie<Se?(Ce.flags|=67108866,Se):Ie):(Ce.flags|=67108866,Se)):(Ce.flags|=1048576,Se)}function H(Ce){return u&&Ce.alternate===null&&(Ce.flags|=67108866),Ce}function Z(Ce,Se,Ie,Xe){return Se===null||Se.tag!==6?(Se=Pn(Ie,Ce.mode,Xe),Se.return=Ce,Se):(Se=y(Se,Ie),Se.return=Ce,Se)}function le(Ce,Se,Ie,Xe){var vt=Ie.type;return vt===ke?We(Ce,Se,Ie.props.children,Xe,Ie.key):Se!==null&&(Se.elementType===vt||typeof vt=="object"&&vt!==null&&vt.$$typeof===is&&BI(vt)===Se.type)?(Se=y(Se,Ie.props),dm(Se,Ie),Se.return=Ce,Se):(Se=fS(Ie.type,Ie.key,Ie.props,null,Ce.mode,Xe),dm(Se,Ie),Se.return=Ce,Se)}function be(Ce,Se,Ie,Xe){return Se===null||Se.tag!==4||Se.stateNode.containerInfo!==Ie.containerInfo||Se.stateNode.implementation!==Ie.implementation?(Se=Bv(Ie,Ce.mode,Xe),Se.return=Ce,Se):(Se=y(Se,Ie.children||[]),Se.return=Ce,Se)}function We(Ce,Se,Ie,Xe,vt){return Se===null||Se.tag!==7?(Se=Xl(Ie,Ce.mode,Xe,vt),Se.return=Ce,Se):(Se=y(Se,Ie),Se.return=Ce,Se)}function Qe(Ce,Se,Ie){if(typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint")return Se=Pn(""+Se,Ce.mode,Ie),Se.return=Ce,Se;if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case Be:return Ie=fS(Se.type,Se.key,Se.props,null,Ce.mode,Ie),dm(Ie,Se),Ie.return=Ce,Ie;case ct:return Se=Bv(Se,Ce.mode,Ie),Se.return=Ce,Se;case is:var Xe=Se._init;return Se=Xe(Se._payload),Qe(Ce,Se,Ie)}if(Ds(Se)||Jt(Se))return Se=Xl(Se,Ce.mode,Ie,null),Se.return=Ce,Se;if(typeof Se.then=="function")return Qe(Ce,yh(Se),Ie);if(Se.$$typeof===kt)return Qe(Ce,ph(Ce,Se),Ie);gf(Ce,Se)}return null}function De(Ce,Se,Ie,Xe){var vt=Se!==null?Se.key:null;if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return vt!==null?null:Z(Ce,Se,""+Ie,Xe);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case Be:return Ie.key===vt?le(Ce,Se,Ie,Xe):null;case ct:return Ie.key===vt?be(Ce,Se,Ie,Xe):null;case is:return vt=Ie._init,Ie=vt(Ie._payload),De(Ce,Se,Ie,Xe)}if(Ds(Ie)||Jt(Ie))return vt!==null?null:We(Ce,Se,Ie,Xe,null);if(typeof Ie.then=="function")return De(Ce,Se,yh(Ie),Xe);if(Ie.$$typeof===kt)return De(Ce,Se,ph(Ce,Ie),Xe);gf(Ce,Ie)}return null}function Le(Ce,Se,Ie,Xe,vt){if(typeof Xe=="string"&&Xe!==""||typeof Xe=="number"||typeof Xe=="bigint")return Ce=Ce.get(Ie)||null,Z(Se,Ce,""+Xe,vt);if(typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case Be:return Ce=Ce.get(Xe.key===null?Ie:Xe.key)||null,le(Se,Ce,Xe,vt);case ct:return Ce=Ce.get(Xe.key===null?Ie:Xe.key)||null,be(Se,Ce,Xe,vt);case is:var Zi=Xe._init;return Xe=Zi(Xe._payload),Le(Ce,Se,Ie,Xe,vt)}if(Ds(Xe)||Jt(Xe))return Ce=Ce.get(Ie)||null,We(Se,Ce,Xe,vt,null);if(typeof Xe.then=="function")return Le(Ce,Se,Ie,yh(Xe),vt);if(Xe.$$typeof===kt)return Le(Ce,Se,Ie,ph(Se,Xe),vt);gf(Se,Xe)}return null}function wi(Ce,Se,Ie,Xe){for(var vt=null,Zi=null,ii=Se,yi=Se=0,ss=null;ii!==null&&yi<Ie.length;yi++){ii.index>yi?(ss=ii,ii=null):ss=ii.sibling;var Er=De(Ce,ii,Ie[yi],Xe);if(Er===null){ii===null&&(ii=ss);break}u&&ii&&Er.alternate===null&&p(Ce,ii),Se=O(Er,Se,yi),Zi===null?vt=Er:Zi.sibling=Er,Zi=Er,ii=ss}if(yi===Ie.length)return E(Ce,ii),Hr&&Rp(Ce,yi),vt;if(ii===null){for(;yi<Ie.length;yi++)ii=Qe(Ce,Ie[yi],Xe),ii!==null&&(Se=O(ii,Se,yi),Zi===null?vt=ii:Zi.sibling=ii,Zi=ii);return Hr&&Rp(Ce,yi),vt}for(ii=g(ii);yi<Ie.length;yi++)ss=Le(ii,Ce,yi,Ie[yi],Xe),ss!==null&&(u&&ss.alternate!==null&&ii.delete(ss.key===null?yi:ss.key),Se=O(ss,Se,yi),Zi===null?vt=ss:Zi.sibling=ss,Zi=ss);return u&&ii.forEach(function(ul){return p(Ce,ul)}),Hr&&Rp(Ce,yi),vt}function ui(Ce,Se,Ie,Xe){if(Ie==null)throw Error(K(151));for(var vt=null,Zi=null,ii=Se,yi=Se=0,ss=null,Er=Ie.next();ii!==null&&!Er.done;yi++,Er=Ie.next()){ii.index>yi?(ss=ii,ii=null):ss=ii.sibling;var ul=De(Ce,ii,Er.value,Xe);if(ul===null){ii===null&&(ii=ss);break}u&&ii&&ul.alternate===null&&p(Ce,ii),Se=O(ul,Se,yi),Zi===null?vt=ul:Zi.sibling=ul,Zi=ul,ii=ss}if(Er.done)return E(Ce,ii),Hr&&Rp(Ce,yi),vt;if(ii===null){for(;!Er.done;yi++,Er=Ie.next())Er=Qe(Ce,Er.value,Xe),Er!==null&&(Se=O(Er,Se,yi),Zi===null?vt=Er:Zi.sibling=Er,Zi=Er);return Hr&&Rp(Ce,yi),vt}for(ii=g(ii);!Er.done;yi++,Er=Ie.next())Er=Le(ii,Ce,yi,Er.value,Xe),Er!==null&&(u&&Er.alternate!==null&&ii.delete(Er.key===null?yi:Er.key),Se=O(Er,Se,yi),Zi===null?vt=Er:Zi.sibling=Er,Zi=Er);return u&&ii.forEach(function(OD){return p(Ce,OD)}),Hr&&Rp(Ce,yi),vt}function cn(Ce,Se,Ie,Xe){if(typeof Ie=="object"&&Ie!==null&&Ie.type===ke&&Ie.key===null&&(Ie=Ie.props.children),typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case Be:e:{for(var vt=Ie.key;Se!==null;){if(Se.key===vt){if(vt=Ie.type,vt===ke){if(Se.tag===7){E(Ce,Se.sibling),Xe=y(Se,Ie.props.children),Xe.return=Ce,Ce=Xe;break e}}else if(Se.elementType===vt||typeof vt=="object"&&vt!==null&&vt.$$typeof===is&&BI(vt)===Se.type){E(Ce,Se.sibling),Xe=y(Se,Ie.props),dm(Xe,Ie),Xe.return=Ce,Ce=Xe;break e}E(Ce,Se);break}else p(Ce,Se);Se=Se.sibling}Ie.type===ke?(Xe=Xl(Ie.props.children,Ce.mode,Xe,Ie.key),Xe.return=Ce,Ce=Xe):(Xe=fS(Ie.type,Ie.key,Ie.props,null,Ce.mode,Xe),dm(Xe,Ie),Xe.return=Ce,Ce=Xe)}return H(Ce);case ct:e:{for(vt=Ie.key;Se!==null;){if(Se.key===vt)if(Se.tag===4&&Se.stateNode.containerInfo===Ie.containerInfo&&Se.stateNode.implementation===Ie.implementation){E(Ce,Se.sibling),Xe=y(Se,Ie.children||[]),Xe.return=Ce,Ce=Xe;break e}else{E(Ce,Se);break}else p(Ce,Se);Se=Se.sibling}Xe=Bv(Ie,Ce.mode,Xe),Xe.return=Ce,Ce=Xe}return H(Ce);case is:return vt=Ie._init,Ie=vt(Ie._payload),cn(Ce,Se,Ie,Xe)}if(Ds(Ie))return wi(Ce,Se,Ie,Xe);if(Jt(Ie)){if(vt=Jt(Ie),typeof vt!="function")throw Error(K(150));return Ie=vt.call(Ie),ui(Ce,Se,Ie,Xe)}if(typeof Ie.then=="function")return cn(Ce,Se,yh(Ie),Xe);if(Ie.$$typeof===kt)return cn(Ce,Se,ph(Ce,Ie),Xe);gf(Ce,Ie)}return typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint"?(Ie=""+Ie,Se!==null&&Se.tag===6?(E(Ce,Se.sibling),Xe=y(Se,Ie),Xe.return=Ce,Ce=Xe):(E(Ce,Se),Xe=Pn(Ie,Ce.mode,Xe),Xe.return=Ce,Ce=Xe),H(Ce)):E(Ce,Se)}return function(Ce,Se,Ie,Xe){try{gs=0;var vt=cn(Ce,Se,Ie,Xe);return vh=null,vt}catch(ii){if(ii===tu||ii===vS)throw ii;var Zi=Zo(29,ii,null,Ce.mode);return Zi.lanes=Xe,Zi.return=Ce,Zi}finally{}}}var Ch=xS(!0),jI=xS(!1),An=at(null),tl=null;function bh(u){var p=u.alternate;Tt(Wa,Wa.current&1),Tt(An,u),tl===null&&(p===null||fh.current!==null||p.memoizedState!==null)&&(tl=u)}function GI(u){if(u.tag===22){if(Tt(Wa,Wa.current),Tt(An,u),tl===null){var p=u.alternate;p!==null&&p.memoizedState!==null&&(tl=u)}}else Ah()}function Ah(){Tt(Wa,Wa.current),Tt(An,An.current)}function cd(u){gt(An),tl===u&&(tl=null),gt(Wa)}var Wa=at(0);function Ih(u){for(var p=u;p!==null;){if(p.tag===13){var E=p.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||wm(E)))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}function lm(u,p,E,g){p=u.memoizedState,E=E(g,p),E=E==null?p:Re({},p,E),u.memoizedState=E,u.lanes===0&&(u.updateQueue.baseState=E)}var ly={enqueueSetState:function(u,p,E){u=u._reactInternals;var g=nc(),y=_h(g);y.payload=p,E!=null&&(y.callback=E),p=$d(u,y,g),p!==null&&($s(p,u,g),rm(p,u,g))},enqueueReplaceState:function(u,p,E){u=u._reactInternals;var g=nc(),y=_h(g);y.tag=1,y.payload=p,E!=null&&(y.callback=E),p=$d(u,y,g),p!==null&&($s(p,u,g),rm(p,u,g))},enqueueForceUpdate:function(u,p){u=u._reactInternals;var E=nc(),g=_h(E);g.tag=2,p!=null&&(g.callback=p),p=$d(u,g,E),p!==null&&($s(p,u,E),rm(p,u,E))}};function VS(u,p,E,g,y,O,H){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(g,O,H):p.prototype&&p.prototype.isPureReactComponent?!nd(E,g)||!nd(y,O):!0}function WI(u,p,E,g){u=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(E,g),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(E,g),p.state!==u&&ly.enqueueReplaceState(p,p.state,null)}function Op(u,p){var E=p;if("ref"in p){E={};for(var g in p)g!=="ref"&&(E[g]=p[g])}if(u=u.defaultProps){E===p&&(E=Re({},E));for(var y in u)E[y]===void 0&&(E[y]=u[y])}return E}var FS=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)};function HI(u){FS(u)}function KI(u){console.error(u)}function YI(u){FS(u)}function BS(u,p){try{var E=u.onUncaughtError;E(p.value,{componentStack:p.stack})}catch(g){setTimeout(function(){throw g})}}function jS(u,p,E){try{var g=u.onCaughtError;g(E.value,{componentStack:E.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Ha(u,p,E){return E=_h(E),E.tag=3,E.payload={element:null},E.callback=function(){BS(u,p)},E}function zI(u){return u=_h(u),u.tag=3,u}function qI(u,p,E,g){var y=E.type.getDerivedStateFromError;if(typeof y=="function"){var O=g.value;u.payload=function(){return y(O)},u.callback=function(){jS(p,E,g)}}var H=E.stateNode;H!==null&&typeof H.componentDidCatch=="function"&&(u.callback=function(){jS(p,E,g),typeof y!="function"&&(sl===null?sl=new Set([this]):sl.add(this));var Z=g.stack;this.componentDidCatch(g.value,{componentStack:Z!==null?Z:""})})}function zN(u,p,E,g,y){if(E.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(p=E.alternate,p!==null&&QE(p,E,y,!0),E=An.current,E!==null){switch(E.tag){case 13:return tl===null?_d():E.alternate===null&&jn===0&&(jn=3),E.flags&=-257,E.flags|=65536,E.lanes=y,g===iu?E.flags|=16384:(p=E.updateQueue,p===null?E.updateQueue=new Set([g]):p.add(g),fu(u,g,y)),!1;case 22:return E.flags|=65536,g===iu?E.flags|=16384:(p=E.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([g])},E.updateQueue=p):(E=p.retryQueue,E===null?p.retryQueue=new Set([g]):E.add(g)),fu(u,g,y)),!1}throw Error(K(435,E.tag))}return fu(u,g,y),_d(),!1}if(Hr)return p=An.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=y,g!==Gv&&(u=Error(K(422),{cause:g}),ZE(Ro(u,E)))):(g!==Gv&&(p=Error(K(423),{cause:g}),ZE(Ro(p,E))),u=u.current.alternate,u.flags|=65536,y&=-y,u.lanes|=y,g=Ro(g,E),y=Ha(u.stateNode,g,y),Xv(u,y),jn!==4&&(jn=2)),!1;var O=Error(K(520),{cause:g});if(O=Ro(O,E),Up===null?Up=[O]:Up.push(O),jn!==4&&(jn=2),p===null)return!0;g=Ro(g,E),E=p;do{switch(E.tag){case 3:return E.flags|=65536,u=y&-y,E.lanes|=u,u=Ha(E.stateNode,g,u),Xv(E,u),!1;case 1:if(p=E.type,O=E.stateNode,(E.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(sl===null||!sl.has(O))))return E.flags|=65536,y&=-y,E.lanes|=y,y=zI(y),qI(y,u,E,g),Xv(E,y),!1}E=E.return}while(E!==null);return!1}var XI=Error(K(461)),ns=!1;function Ss(u,p,E,g){p.child=u===null?jI(p,null,E,g):Ch(p,u.child,E,g)}function Sf(u,p,E,g,y){E=E.render;var O=p.ref;if("ref"in g){var H={};for(var Z in g)Z!=="ref"&&(H[Z]=g[Z])}else H=g;return $o(p),g=Qv(u,p,E,H,O,y),Z=ey(),u!==null&&!ns?(am(u,p,y),dd(u,p,y)):(Hr&&Z&&XE(p),p.flags|=1,Ss(u,p,g,y),p.child)}function JI(u,p,E,g,y){if(u===null){var O=E.type;return typeof O=="function"&&!Fv(O)&&O.defaultProps===void 0&&E.compare===null?(p.tag=15,p.type=O,ZI(u,p,O,g,y)):(u=fS(E.type,null,g,p,p.mode,y),u.ref=p.ref,u.return=p,p.child=u)}if(O=u.child,!um(u,y)){var H=O.memoizedProps;if(E=E.compare,E=E!==null?E:nd,E(H,g)&&u.ref===p.ref)return dd(u,p,y)}return p.flags|=1,u=ql(O,g),u.ref=p.ref,u.return=p,p.child=u}function ZI(u,p,E,g,y){if(u!==null){var O=u.memoizedProps;if(nd(O,g)&&u.ref===p.ref)if(ns=!1,p.pendingProps=g=O,um(u,y))(u.flags&131072)!==0&&(ns=!0);else return p.lanes=u.lanes,dd(u,p,y)}return uy(u,p,E,g,y)}function QI(u,p,E){var g=p.pendingProps,y=g.children,O=u!==null?u.memoizedState:null;if(g.mode==="hidden"){if((p.flags&128)!==0){if(g=O!==null?O.baseLanes|E:E,u!==null){for(y=p.child=u.child,O=0;y!==null;)O=O|y.lanes|y.childLanes,y=y.sibling;p.childLanes=O&~g}else p.childLanes=0,p.child=null;return $I(u,p,g,E)}if((E&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},u!==null&&RS(p,O!==null?O.cachePool:null),O!==null?Eh(p,O):od(),GI(p);else return p.lanes=p.childLanes=536870912,$I(u,p,O!==null?O.baseLanes|E:E,E)}else O!==null?(RS(p,O.cachePool),Eh(p,O),Ah(),p.memoizedState=null):(u!==null&&RS(p,null),od(),Ah());return Ss(u,p,y,E),p.child}function $I(u,p,E,g){var y=zv();return y=y===null?null:{parent:pa._currentValue,pool:y},p.memoizedState={baseLanes:E,cachePool:y},u!==null&&RS(p,null),od(),GI(p),u!==null&&QE(u,p,g,!0),null}function GS(u,p){var E=p.ref;if(E===null)u!==null&&u.ref!==null&&(p.flags|=4194816);else{if(typeof E!="function"&&typeof E!="object")throw Error(K(284));(u===null||u.ref!==E)&&(p.flags|=4194816)}}function uy(u,p,E,g,y){return $o(p),E=Qv(u,p,E,g,void 0,y),g=ey(),u!==null&&!ns?(am(u,p,y),dd(u,p,y)):(Hr&&g&&XE(p),p.flags|=1,Ss(u,p,E,y),p.child)}function WS(u,p,E,g,y,O){return $o(p),p.updateQueue=null,E=vI(p,g,E,y),RI(u),g=ey(),u!==null&&!ns?(am(u,p,O),dd(u,p,O)):(Hr&&g&&XE(p),p.flags|=1,Ss(u,p,E,O),p.child)}function HS(u,p,E,g,y){if($o(p),p.stateNode===null){var O=Ic,H=E.contextType;typeof H=="object"&&H!==null&&(O=ra(H)),O=new E(g,O),p.memoizedState=O.state!==null&&O.state!==void 0?O.state:null,O.updater=ly,p.stateNode=O,O._reactInternals=p,O=p.stateNode,O.props=g,O.state=p.memoizedState,O.refs={},im(p),H=E.contextType,O.context=typeof H=="object"&&H!==null?ra(H):Ic,O.state=p.memoizedState,H=E.getDerivedStateFromProps,typeof H=="function"&&(lm(p,E,H,g),O.state=p.memoizedState),typeof E.getDerivedStateFromProps=="function"||typeof O.getSnapshotBeforeUpdate=="function"||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(H=O.state,typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount(),H!==O.state&&ly.enqueueReplaceState(O,O.state,null),nu(p,g,O,y),ru(),O.state=p.memoizedState),typeof O.componentDidMount=="function"&&(p.flags|=4194308),g=!0}else if(u===null){O=p.stateNode;var Z=p.memoizedProps,le=Op(E,Z);O.props=le;var be=O.context,We=E.contextType;H=Ic,typeof We=="object"&&We!==null&&(H=ra(We));var Qe=E.getDerivedStateFromProps;We=typeof Qe=="function"||typeof O.getSnapshotBeforeUpdate=="function",Z=p.pendingProps!==Z,We||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(Z||be!==H)&&WI(p,O,g,H),Co=!1;var De=p.memoizedState;O.state=De,nu(p,g,O,y),ru(),be=p.memoizedState,Z||De!==be||Co?(typeof Qe=="function"&&(lm(p,E,Qe,g),be=p.memoizedState),(le=Co||VS(p,E,le,g,De,be,H))?(We||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(p.flags|=4194308)):(typeof O.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=g,p.memoizedState=be),O.props=g,O.state=be,O.context=H,g=le):(typeof O.componentDidMount=="function"&&(p.flags|=4194308),g=!1)}else{O=p.stateNode,qv(u,p),H=p.memoizedProps,We=Op(E,H),O.props=We,Qe=p.pendingProps,De=O.context,be=E.contextType,le=Ic,typeof be=="object"&&be!==null&&(le=ra(be)),Z=E.getDerivedStateFromProps,(be=typeof Z=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(H!==Qe||De!==le)&&WI(p,O,g,le),Co=!1,De=p.memoizedState,O.state=De,nu(p,g,O,y),ru();var Le=p.memoizedState;H!==Qe||De!==Le||Co||u!==null&&u.dependencies!==null&&TS(u.dependencies)?(typeof Z=="function"&&(lm(p,E,Z,g),Le=p.memoizedState),(We=Co||VS(p,E,We,g,De,Le,le)||u!==null&&u.dependencies!==null&&TS(u.dependencies))?(be||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(g,Le,le),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(g,Le,le)),typeof O.componentDidUpdate=="function"&&(p.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof O.componentDidUpdate!="function"||H===u.memoizedProps&&De===u.memoizedState||(p.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||H===u.memoizedProps&&De===u.memoizedState||(p.flags|=1024),p.memoizedProps=g,p.memoizedState=Le),O.props=g,O.state=Le,O.context=le,g=We):(typeof O.componentDidUpdate!="function"||H===u.memoizedProps&&De===u.memoizedState||(p.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||H===u.memoizedProps&&De===u.memoizedState||(p.flags|=1024),g=!1)}return O=g,GS(u,p),g=(p.flags&128)!==0,O||g?(O=p.stateNode,E=g&&typeof E.getDerivedStateFromError!="function"?null:O.render(),p.flags|=1,u!==null&&g?(p.child=Ch(p,u.child,null,y),p.child=Ch(p,null,E,y)):Ss(u,p,E,y),p.memoizedState=O.state,u=p.child):u=dd(u,p,y),u}function ew(u,p,E,g){return Zl(),p.flags|=256,Ss(u,p,E,g),p.child}var hy={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function du(u){return{baseLanes:u,cachePool:fI()}}function Np(u,p,E){return u=u!==null?u.childLanes&~E:0,p&&(u|=Nc),u}function KS(u,p,E){var g=p.pendingProps,y=!1,O=(p.flags&128)!==0,H;if((H=O)||(H=u!==null&&u.memoizedState===null?!1:(Wa.current&2)!==0),H&&(y=!0,p.flags&=-129),H=(p.flags&32)!==0,p.flags&=-33,u===null){if(Hr){if(y?bh(p):Ah(),Hr){var Z=sn,le;if(le=Z){e:{for(le=Z,Z=Qd;le.nodeType!==8;){if(!Z){Z=null;break e}if(le=Ed(le.nextSibling),le===null){Z=null;break e}}Z=le}Z!==null?(p.memoizedState={dehydrated:Z,treeContext:Tp!==null?{id:Jl,overflow:Qo}:null,retryLane:536870912,hydrationErrors:null},le=Zo(18,null,null,0),le.stateNode=Z,le.return=p,p.child=le,ms=p,sn=null,le=!0):le=!1}le||yp(p)}if(Z=p.memoizedState,Z!==null&&(Z=Z.dehydrated,Z!==null))return wm(Z)?p.lanes=32:p.lanes=536870912,null;cd(p)}return Z=g.children,g=g.fallback,y?(Ah(),y=p.mode,Z=Tf({mode:"hidden",children:Z},y),g=Xl(g,y,E,null),Z.return=p,g.return=p,Z.sibling=g,p.child=Z,y=p.child,y.memoizedState=du(E),y.childLanes=Np(u,H,E),p.memoizedState=hy,g):(bh(p),lu(p,Z))}if(le=u.memoizedState,le!==null&&(Z=le.dehydrated,Z!==null)){if(O)p.flags&256?(bh(p),p.flags&=-257,p=py(u,p,E)):p.memoizedState!==null?(Ah(),p.child=u.child,p.flags|=128,p=null):(Ah(),y=g.fallback,Z=p.mode,g=Tf({mode:"visible",children:g.children},Z),y=Xl(y,Z,E,null),y.flags|=2,g.return=p,y.return=p,g.sibling=y,p.child=g,Ch(p,u.child,null,E),g=p.child,g.memoizedState=du(E),g.childLanes=Np(u,H,E),p.memoizedState=hy,p=y);else if(bh(p),wm(Z)){if(H=Z.nextSibling&&Z.nextSibling.dataset,H)var be=H.dgst;H=be,g=Error(K(419)),g.stack="",g.digest=H,ZE({value:g,source:null,stack:null}),p=py(u,p,E)}else if(ns||QE(u,p,E,!1),H=(E&u.childLanes)!==0,ns||H){if(H=In,H!==null&&(g=E&-E,g=(g&42)!==0?1:qo(g),g=(g&(H.suspendedLanes|E))!==0?0:g,g!==0&&g!==le.retryLane))throw le.retryLane=g,$_(u,g),$s(H,u,g),XI;Z.data==="$?"||_d(),p=py(u,p,E)}else Z.data==="$?"?(p.flags|=192,p.child=u.child,p=null):(u=le.treeContext,sn=Ed(Z.nextSibling),ms=p,Hr=!0,vp=null,Qd=!1,u!==null&&(yo[wc++]=Jl,yo[wc++]=Qo,yo[wc++]=Tp,Jl=u.id,Qo=u.overflow,Tp=p),p=lu(p,g.children),p.flags|=4096);return p}return y?(Ah(),y=g.fallback,Z=p.mode,le=u.child,be=le.sibling,g=ql(le,{mode:"hidden",children:g.children}),g.subtreeFlags=le.subtreeFlags&65011712,be!==null?y=ql(be,y):(y=Xl(y,Z,E,null),y.flags|=2),y.return=p,g.return=p,g.sibling=y,p.child=g,g=y,y=p.child,Z=u.child.memoizedState,Z===null?Z=du(E):(le=Z.cachePool,le!==null?(be=pa._currentValue,le=le.parent!==be?{parent:be,pool:be}:le):le=fI(),Z={baseLanes:Z.baseLanes|E,cachePool:le}),y.memoizedState=Z,y.childLanes=Np(u,H,E),p.memoizedState=hy,g):(bh(p),E=u.child,u=E.sibling,E=ql(E,{mode:"visible",children:g.children}),E.return=p,E.sibling=null,u!==null&&(H=p.deletions,H===null?(p.deletions=[u],p.flags|=16):H.push(u)),p.child=E,p.memoizedState=null,E)}function lu(u,p){return p=Tf({mode:"visible",children:p},u.mode),p.return=u,u.child=p}function Tf(u,p){return u=Zo(22,u,null,p),u.lanes=0,u.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},u}function py(u,p,E){return Ch(p,u.child,null,E),u=lu(p,p.pendingProps.children),u.flags|=2,p.memoizedState=null,u}function YS(u,p,E){u.lanes|=p;var g=u.alternate;g!==null&&(g.lanes|=p),Hv(u.return,p,E)}function uu(u,p,E,g,y){var O=u.memoizedState;O===null?u.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:g,tail:E,tailMode:y}:(O.isBackwards=p,O.rendering=null,O.renderingStartTime=0,O.last=g,O.tail=E,O.tailMode=y)}function tw(u,p,E){var g=p.pendingProps,y=g.revealOrder,O=g.tail;if(Ss(u,p,g.children,E),g=Wa.current,(g&2)!==0)g=g&1|2,p.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=p.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&YS(u,E,p);else if(u.tag===19)YS(u,E,p);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===p)break e;for(;u.sibling===null;){if(u.return===null||u.return===p)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}g&=1}switch(Tt(Wa,g),y){case"forwards":for(E=p.child,y=null;E!==null;)u=E.alternate,u!==null&&Ih(u)===null&&(y=E),E=E.sibling;E=y,E===null?(y=p.child,p.child=null):(y=E.sibling,E.sibling=null),uu(p,!1,y,E,O);break;case"backwards":for(E=null,y=p.child,p.child=null;y!==null;){if(u=y.alternate,u!==null&&Ih(u)===null){p.child=y;break}u=y.sibling,y.sibling=E,E=y,y=u}uu(p,!0,E,null,O);break;case"together":uu(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function dd(u,p,E){if(u!==null&&(p.dependencies=u.dependencies),wo|=p.lanes,(E&p.childLanes)===0)if(u!==null){if(QE(u,p,E,!1),(E&p.childLanes)===0)return null}else return null;if(u!==null&&p.child!==u.child)throw Error(K(153));if(p.child!==null){for(u=p.child,E=ql(u,u.pendingProps),p.child=E,E.return=p;u.sibling!==null;)u=u.sibling,E=E.sibling=ql(u,u.pendingProps),E.return=p;E.sibling=null}return p.child}function um(u,p){return(u.lanes&p)!==0?!0:(u=u.dependencies,!!(u!==null&&TS(u)))}function qN(u,p,E){switch(p.tag){case 3:Fn(p,p.stateNode.containerInfo),hh(p,pa,u.memoizedState.cache),Zl();break;case 27:case 5:Fl(p);break;case 4:Fn(p,p.stateNode.containerInfo);break;case 10:hh(p,p.type,p.memoizedProps.value);break;case 13:var g=p.memoizedState;if(g!==null)return g.dehydrated!==null?(bh(p),p.flags|=128,null):(E&p.child.childLanes)!==0?KS(u,p,E):(bh(p),u=dd(u,p,E),u!==null?u.sibling:null);bh(p);break;case 19:var y=(u.flags&128)!==0;if(g=(E&p.childLanes)!==0,g||(QE(u,p,E,!1),g=(E&p.childLanes)!==0),y){if(g)return tw(u,p,E);p.flags|=128}if(y=p.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),Tt(Wa,Wa.current),g)break;return null;case 22:case 23:return p.lanes=0,QI(u,p,E);case 24:hh(p,pa,u.memoizedState.cache)}return dd(u,p,E)}function wh(u,p,E){if(u!==null)if(u.memoizedProps!==p.pendingProps)ns=!0;else{if(!um(u,E)&&(p.flags&128)===0)return ns=!1,qN(u,p,E);ns=(u.flags&131072)!==0}else ns=!1,Hr&&(p.flags&1048576)!==0&&gS(p,mS,p.index);switch(p.lanes=0,p.tag){case 16:e:{u=p.pendingProps;var g=p.elementType,y=g._init;if(g=y(g._payload),p.type=g,typeof g=="function")Fv(g)?(u=Op(g,u),p.tag=1,p=HS(null,p,g,u,E)):(p.tag=0,p=uy(null,p,g,u,E));else{if(g!=null){if(y=g.$$typeof,y===Ar){p.tag=11,p=Sf(null,p,g,u,E);break e}else if(y===tr){p.tag=14,p=JI(null,p,g,u,E);break e}}throw p=ir(g)||g,Error(K(306,p,""))}}return p;case 0:return uy(u,p,p.type,p.pendingProps,E);case 1:return g=p.type,y=Op(g,p.pendingProps),HS(u,p,g,y,E);case 3:e:{if(Fn(p,p.stateNode.containerInfo),u===null)throw Error(K(387));g=p.pendingProps;var O=p.memoizedState;y=O.element,qv(u,p),nu(p,g,null,E);var H=p.memoizedState;if(g=H.cache,hh(p,pa,g),g!==O.cache&&Kv(p,[pa],E,!0),ru(),g=H.element,O.isDehydrated)if(O={element:g,isDehydrated:!1,cache:H.cache},p.updateQueue.baseState=O,p.memoizedState=O,p.flags&256){p=ew(u,p,g,E);break e}else if(g!==y){y=Ro(Error(K(424)),p),ZE(y),p=ew(u,p,g,E);break e}else{switch(u=p.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for(sn=Ed(u.firstChild),ms=p,Hr=!0,vp=null,Qd=!0,E=jI(p,null,g,E),p.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling}else{if(Zl(),g===y){p=dd(u,p,E);break e}Ss(u,p,g,E)}p=p.child}return p;case 26:return GS(u,p),u===null?(E=Ow(p.type,null,p.pendingProps,null))?p.memoizedState=E:Hr||(E=p.type,u=p.pendingProps,g=_T(xi.current).createElement(E),g[Ls]=p,g[go]=u,Ka(g,E,u),Da(g),p.stateNode=g):p.memoizedState=Ow(p.type,u.memoizedProps,p.pendingProps,u.memoizedState),null;case 27:return Fl(p),u===null&&Hr&&(g=p.stateNode=Aw(p.type,p.pendingProps,xi.current),ms=p,Qd=!0,y=sn,Vh(p.type)?(Ny=y,sn=Ed(g.firstChild)):sn=y),Ss(u,p,p.pendingProps.children,E),GS(u,p),u===null&&(p.flags|=4194304),p.child;case 5:return u===null&&Hr&&((y=g=sn)&&(g=hD(g,p.type,p.pendingProps,Qd),g!==null?(p.stateNode=g,ms=p,sn=Ed(g.firstChild),Qd=!1,y=!0):y=!1),y||yp(p)),Fl(p),y=p.type,O=p.pendingProps,H=u!==null?u.memoizedProps:null,g=O.children,Iy(y,O)?g=null:H!==null&&Iy(y,H)&&(p.flags|=32),p.memoizedState!==null&&(y=Qv(u,p,$v,null,null,E),Lm._currentValue=y),GS(u,p),Ss(u,p,g,E),p.child;case 6:return u===null&&Hr&&((u=E=sn)&&(E=pD(E,p.pendingProps,Qd),E!==null?(p.stateNode=E,ms=p,sn=null,u=!0):u=!1),u||yp(p)),null;case 13:return KS(u,p,E);case 4:return Fn(p,p.stateNode.containerInfo),g=p.pendingProps,u===null?p.child=Ch(p,null,g,E):Ss(u,p,g,E),p.child;case 11:return Sf(u,p,p.type,p.pendingProps,E);case 7:return Ss(u,p,p.pendingProps,E),p.child;case 8:return Ss(u,p,p.pendingProps.children,E),p.child;case 12:return Ss(u,p,p.pendingProps.children,E),p.child;case 10:return g=p.pendingProps,hh(p,p.type,g.value),Ss(u,p,g.children,E),p.child;case 9:return y=p.type._context,g=p.pendingProps.children,$o(p),y=ra(y),g=g(y),p.flags|=1,Ss(u,p,g,E),p.child;case 14:return JI(u,p,p.type,p.pendingProps,E);case 15:return ZI(u,p,p.type,p.pendingProps,E);case 19:return tw(u,p,E);case 31:return g=p.pendingProps,E=p.mode,g={mode:g.mode,children:g.children},u===null?(E=Tf(g,E),E.ref=p.ref,p.child=E,E.return=p,p=E):(E=ql(u.child,g),E.ref=p.ref,p.child=E,E.return=p,p=E),p;case 22:return QI(u,p,E);case 24:return $o(p),g=ra(pa),u===null?(y=zv(),y===null&&(y=In,O=bp(),y.pooledCache=O,O.refCount++,O!==null&&(y.pooledCacheLanes|=E),y=O),p.memoizedState={parent:g,cache:y},im(p),hh(p,pa,y)):((u.lanes&E)!==0&&(qv(u,p),nu(p,null,null,E),ru()),y=u.memoizedState,O=p.memoizedState,y.parent!==g?(y={parent:g,cache:g},p.memoizedState=y,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=y),hh(p,pa,g)):(g=O.cache,hh(p,pa,g),g!==y.cache&&Kv(p,[pa],E,!0))),Ss(u,p,p.pendingProps.children,E),p.child;case 29:throw p.pendingProps}throw Error(K(156,p.tag))}function ld(u){u.flags|=4}function iw(u,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!Dw(p)){if(p=An.current,p!==null&&((fr&4194048)===fr?tl!==null:(fr&62914560)!==fr&&(fr&536870912)===0||p!==tl))throw tm=iu,EI;u.flags|=8192}}function zS(u,p){p!==null&&(u.flags|=4),u.flags&16384&&(p=u.tag!==22?NA():536870912,u.lanes|=p,Lh|=p)}function hm(u,p){if(!Hr)switch(u.tailMode){case"hidden":p=u.tail;for(var E=null;p!==null;)p.alternate!==null&&(E=p),p=p.sibling;E===null?u.tail=null:E.sibling=null;break;case"collapsed":E=u.tail;for(var g=null;E!==null;)E.alternate!==null&&(g=E),E=E.sibling;g===null?p||u.tail===null?u.tail=null:u.tail.sibling=null:g.sibling=null}}function en(u){var p=u.alternate!==null&&u.alternate.child===u.child,E=0,g=0;if(p)for(var y=u.child;y!==null;)E|=y.lanes|y.childLanes,g|=y.subtreeFlags&65011712,g|=y.flags&65011712,y.return=u,y=y.sibling;else for(y=u.child;y!==null;)E|=y.lanes|y.childLanes,g|=y.subtreeFlags,g|=y.flags,y.return=u,y=y.sibling;return u.subtreeFlags|=g,u.childLanes=E,p}function XN(u,p,E){var g=p.pendingProps;switch(jv(p),p.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(p),null;case 1:return en(p),null;case 3:return E=p.stateNode,g=null,u!==null&&(g=u.memoizedState.cache),p.memoizedState.cache!==g&&(p.flags|=2048),$l(pa),mo(),E.pendingContext&&(E.context=E.pendingContext,E.pendingContext=null),(u===null||u.child===null)&&(JE(p)?ld(p):u===null||u.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,uI())),en(p),null;case 26:return E=p.memoizedState,u===null?(ld(p),E!==null?(en(p),iw(p,E)):(en(p),p.flags&=-16777217)):E?E!==u.memoizedState?(ld(p),en(p),iw(p,E)):(en(p),p.flags&=-16777217):(u.memoizedProps!==g&&ld(p),en(p),p.flags&=-16777217),null;case 27:tS(p),E=xi.current;var y=p.type;if(u!==null&&p.stateNode!=null)u.memoizedProps!==g&&ld(p);else{if(!g){if(p.stateNode===null)throw Error(K(166));return en(p),null}u=Ft.current,JE(p)?SS(p):(u=Aw(y,g,E),p.stateNode=u,ld(p))}return en(p),null;case 5:if(tS(p),E=p.type,u!==null&&p.stateNode!=null)u.memoizedProps!==g&&ld(p);else{if(!g){if(p.stateNode===null)throw Error(K(166));return en(p),null}if(u=Ft.current,JE(p))SS(p);else{switch(y=_T(xi.current),u){case 1:u=y.createElementNS("http://www.w3.org/2000/svg",E);break;case 2:u=y.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;default:switch(E){case"svg":u=y.createElementNS("http://www.w3.org/2000/svg",E);break;case"math":u=y.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;case"script":u=y.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof g.is=="string"?y.createElement("select",{is:g.is}):y.createElement("select"),g.multiple?u.multiple=!0:g.size&&(u.size=g.size);break;default:u=typeof g.is=="string"?y.createElement(E,{is:g.is}):y.createElement(E)}}u[Ls]=p,u[go]=g;e:for(y=p.child;y!==null;){if(y.tag===5||y.tag===6)u.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===p)break e;for(;y.sibling===null;){if(y.return===null||y.return===p)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}p.stateNode=u;e:switch(Ka(u,E,g),E){case"button":case"input":case"select":case"textarea":u=!!g.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&ld(p)}}return en(p),p.flags&=-16777217,null;case 6:if(u&&p.stateNode!=null)u.memoizedProps!==g&&ld(p);else{if(typeof g!="string"&&p.stateNode===null)throw Error(K(166));if(u=xi.current,JE(p)){if(u=p.stateNode,E=p.memoizedProps,g=null,y=ms,y!==null)switch(y.tag){case 27:case 5:g=y.memoizedProps}u[Ls]=p,u=!!(u.nodeValue===E||g!==null&&g.suppressHydrationWarning===!0||Lf(u.nodeValue,E)),u||yp(p)}else u=_T(u).createTextNode(g),u[Ls]=p,p.stateNode=u}return en(p),null;case 13:if(g=p.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(y=JE(p),g!==null&&g.dehydrated!==null){if(u===null){if(!y)throw Error(K(318));if(y=p.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(K(317));y[Ls]=p}else Zl(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;en(p),y=!1}else y=uI(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=y),y=!0;if(!y)return p.flags&256?(cd(p),p):(cd(p),null)}if(cd(p),(p.flags&128)!==0)return p.lanes=E,p;if(E=g!==null,u=u!==null&&u.memoizedState!==null,E){g=p.child,y=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(y=g.alternate.memoizedState.cachePool.pool);var O=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(O=g.memoizedState.cachePool.pool),O!==y&&(g.flags|=2048)}return E!==u&&E&&(p.child.flags|=8192),zS(p,p.updateQueue),en(p),null;case 4:return mo(),u===null&&Am(p.stateNode.containerInfo),en(p),null;case 10:return $l(p.type),en(p),null;case 19:if(gt(Wa),y=p.memoizedState,y===null)return en(p),null;if(g=(p.flags&128)!==0,O=y.rendering,O===null)if(g)hm(y,!1);else{if(jn!==0||u!==null&&(u.flags&128)!==0)for(u=p.child;u!==null;){if(O=Ih(u),O!==null){for(p.flags|=128,hm(y,!1),u=O.updateQueue,p.updateQueue=u,zS(p,u),p.subtreeFlags=0,u=E,E=p.child;E!==null;)ef(E,u),E=E.sibling;return Tt(Wa,Wa.current&1|2),p.child}u=u.sibling}y.tail!==null&&Yd()>kh&&(p.flags|=128,g=!0,hm(y,!1),p.lanes=4194304)}else{if(!g)if(u=Ih(O),u!==null){if(p.flags|=128,g=!0,u=u.updateQueue,p.updateQueue=u,zS(p,u),hm(y,!0),y.tail===null&&y.tailMode==="hidden"&&!O.alternate&&!Hr)return en(p),null}else 2*Yd()-y.renderingStartTime>kh&&E!==536870912&&(p.flags|=128,g=!0,hm(y,!1),p.lanes=4194304);y.isBackwards?(O.sibling=p.child,p.child=O):(u=y.last,u!==null?u.sibling=O:p.child=O,y.last=O)}return y.tail!==null?(p=y.tail,y.rendering=p,y.tail=p.sibling,y.renderingStartTime=Yd(),p.sibling=null,u=Wa.current,Tt(Wa,g?u&1|2:u&1),p):(en(p),null);case 22:case 23:return cd(p),Zv(),g=p.memoizedState!==null,u!==null?u.memoizedState!==null!==g&&(p.flags|=8192):g&&(p.flags|=8192),g?(E&536870912)!==0&&(p.flags&128)===0&&(en(p),p.subtreeFlags&6&&(p.flags|=8192)):en(p),E=p.updateQueue,E!==null&&zS(p,E.retryQueue),E=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(E=u.memoizedState.cachePool.pool),g=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(g=p.memoizedState.cachePool.pool),g!==E&&(p.flags|=2048),u!==null&&gt(eu),null;case 24:return E=null,u!==null&&(E=u.memoizedState.cache),p.memoizedState.cache!==E&&(p.flags|=2048),$l(pa),en(p),null;case 25:return null;case 30:return null}throw Error(K(156,p.tag))}function JN(u,p){switch(jv(p),p.tag){case 1:return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 3:return $l(pa),mo(),u=p.flags,(u&65536)!==0&&(u&128)===0?(p.flags=u&-65537|128,p):null;case 26:case 27:case 5:return tS(p),null;case 13:if(cd(p),u=p.memoizedState,u!==null&&u.dehydrated!==null){if(p.alternate===null)throw Error(K(340));Zl()}return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 19:return gt(Wa),null;case 4:return mo(),null;case 10:return $l(p.type),null;case 22:case 23:return cd(p),Zv(),u!==null&&gt(eu),u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 24:return $l(pa),null;case 25:return null;default:return null}}function rw(u,p){switch(jv(p),p.tag){case 3:$l(pa),mo();break;case 26:case 27:case 5:tS(p);break;case 4:mo();break;case 13:cd(p);break;case 19:gt(Wa);break;case 10:$l(p.type);break;case 22:case 23:cd(p),Zv(),u!==null&&gt(eu);break;case 24:$l(pa)}}function Dp(u,p){try{var E=p.updateQueue,g=E!==null?E.lastEffect:null;if(g!==null){var y=g.next;E=y;do{if((E.tag&u)===u){g=void 0;var O=E.create,H=E.inst;g=O(),H.destroy=g}E=E.next}while(E!==y)}}catch(Z){fn(p,p.return,Z)}}function Oh(u,p,E){try{var g=p.updateQueue,y=g!==null?g.lastEffect:null;if(y!==null){var O=y.next;g=O;do{if((g.tag&u)===u){var H=g.inst,Z=H.destroy;if(Z!==void 0){H.destroy=void 0,y=p;var le=E,be=Z;try{be()}catch(We){fn(y,le,We)}}}g=g.next}while(g!==O)}}catch(We){fn(p,p.return,We)}}function nw(u){var p=u.updateQueue;if(p!==null){var E=u.stateNode;try{sf(p,E)}catch(g){fn(u,u.return,g)}}}function Rf(u,p,E){E.props=Op(u.type,u.memoizedProps),E.state=u.memoizedState;try{E.componentWillUnmount()}catch(g){fn(u,p,g)}}function pm(u,p){try{var E=u.ref;if(E!==null){switch(u.tag){case 26:case 27:case 5:var g=u.stateNode;break;case 30:g=u.stateNode;break;default:g=u.stateNode}typeof E=="function"?u.refCleanup=E(g):E.current=g}}catch(y){fn(u,p,y)}}function Io(u,p){var E=u.ref,g=u.refCleanup;if(E!==null)if(typeof g=="function")try{g()}catch(y){fn(u,p,y)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof E=="function")try{E(null)}catch(y){fn(u,p,y)}else E.current=null}function aw(u){var p=u.type,E=u.memoizedProps,g=u.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":E.autoFocus&&g.focus();break e;case"img":E.src?g.src=E.src:E.srcSet&&(g.srcset=E.srcSet)}}catch(y){fn(u,u.return,y)}}function _m(u,p,E){try{var g=u.stateNode;oD(g,u.type,E,p),g[go]=p}catch(y){fn(u,u.return,y)}}function sw(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&Vh(u.type)||u.tag===4}function _y(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||sw(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&Vh(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function fm(u,p,E){var g=u.tag;if(g===5||g===6)u=u.stateNode,p?(E.nodeType===9?E.body:E.nodeName==="HTML"?E.ownerDocument.body:E).insertBefore(u,p):(p=E.nodeType===9?E.body:E.nodeName==="HTML"?E.ownerDocument.body:E,p.appendChild(u),E=E._reactRootContainer,E!=null||p.onclick!==null||(p.onclick=kf));else if(g!==4&&(g===27&&Vh(u.type)&&(E=u.stateNode,p=null),u=u.child,u!==null))for(fm(u,p,E),u=u.sibling;u!==null;)fm(u,p,E),u=u.sibling}function qS(u,p,E){var g=u.tag;if(g===5||g===6)u=u.stateNode,p?E.insertBefore(u,p):E.appendChild(u);else if(g!==4&&(g===27&&Vh(u.type)&&(E=u.stateNode),u=u.child,u!==null))for(qS(u,p,E),u=u.sibling;u!==null;)qS(u,p,E),u=u.sibling}function ow(u){var p=u.stateNode,E=u.memoizedProps;try{for(var g=u.type,y=p.attributes;y.length;)p.removeAttributeNode(y[0]);Ka(p,g,E),p[Ls]=u,p[go]=E}catch(O){fn(u,u.return,O)}}var ud=!1,Xn=!1,Pp=!1,cw=typeof WeakSet=="function"?WeakSet:Set,as=null;function hu(u,p){if(u=u.containerInfo,Ay=vT,u=Ms(u),Pv(u)){if("selectionStart"in u)var E={start:u.selectionStart,end:u.selectionEnd};else e:{E=(E=u.ownerDocument)&&E.defaultView||window;var g=E.getSelection&&E.getSelection();if(g&&g.rangeCount!==0){E=g.anchorNode;var y=g.anchorOffset,O=g.focusNode;g=g.focusOffset;try{E.nodeType,O.nodeType}catch{E=null;break e}var H=0,Z=-1,le=-1,be=0,We=0,Qe=u,De=null;t:for(;;){for(var Le;Qe!==E||y!==0&&Qe.nodeType!==3||(Z=H+y),Qe!==O||g!==0&&Qe.nodeType!==3||(le=H+g),Qe.nodeType===3&&(H+=Qe.nodeValue.length),(Le=Qe.firstChild)!==null;)De=Qe,Qe=Le;for(;;){if(Qe===u)break t;if(De===E&&++be===y&&(Z=H),De===O&&++We===g&&(le=H),(Le=Qe.nextSibling)!==null)break;Qe=De,De=Qe.parentNode}Qe=Le}E=Z===-1||le===-1?null:{start:Z,end:le}}else E=null}E=E||{start:0,end:0}}else E=null;for(Su={focusedElem:u,selectionRange:E},vT=!1,as=p;as!==null;)if(p=as,u=p.child,(p.subtreeFlags&1024)!==0&&u!==null)u.return=p,as=u;else for(;as!==null;){switch(p=as,O=p.alternate,u=p.flags,p.tag){case 0:break;case 11:case 15:break;case 1:if((u&1024)!==0&&O!==null){u=void 0,E=p,y=O.memoizedProps,O=O.memoizedState,g=E.stateNode;try{var wi=Op(E.type,y,E.elementType===E.type);u=g.getSnapshotBeforeUpdate(wi,O),g.__reactInternalSnapshotBeforeUpdate=u}catch(ui){fn(E,E.return,ui)}}break;case 3:if((u&1024)!==0){if(u=p.stateNode.containerInfo,E=u.nodeType,E===9)Oy(u);else if(E===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":Oy(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(K(163))}if(u=p.sibling,u!==null){u.return=p.return,as=u;break}as=p.return}}function XS(u,p,E){var g=E.flags;switch(E.tag){case 0:case 11:case 15:aa(u,E),g&4&&Dp(5,E);break;case 1:if(aa(u,E),g&4)if(u=E.stateNode,p===null)try{u.componentDidMount()}catch(H){fn(E,E.return,H)}else{var y=Op(E.type,p.memoizedProps);p=p.memoizedState;try{u.componentDidUpdate(y,p,u.__reactInternalSnapshotBeforeUpdate)}catch(H){fn(E,E.return,H)}}g&64&&nw(E),g&512&&pm(E,E.return);break;case 3:if(aa(u,E),g&64&&(u=E.updateQueue,u!==null)){if(p=null,E.child!==null)switch(E.child.tag){case 27:case 5:p=E.child.stateNode;break;case 1:p=E.child.stateNode}try{sf(u,p)}catch(H){fn(E,E.return,H)}}break;case 27:p===null&&g&4&&ow(E);case 26:case 5:aa(u,E),p===null&&g&4&&aw(E),g&512&&pm(E,E.return);break;case 12:aa(u,E);break;case 13:aa(u,E),g&4&&dw(u,E),g&64&&(u=E.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(E=iD.bind(null,E),_D(u,E))));break;case 22:if(g=E.memoizedState!==null||ud,!g){p=p!==null&&p.memoizedState!==null||Xn,y=ud;var O=Xn;ud=g,(Xn=p)&&!O?Ma(u,E,(E.subtreeFlags&8772)!==0):aa(u,E),ud=y,Xn=O}break;case 30:break;default:aa(u,E)}}function il(u){var p=u.alternate;p!==null&&(u.alternate=null,il(p)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(p=u.stateNode,p!==null&&UE(p)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var _r=null,Us=!1;function ic(u,p,E){for(E=E.child;E!==null;)Nh(u,p,E),E=E.sibling}function Nh(u,p,E){if($r&&typeof $r.onCommitFiberUnmount=="function")try{$r.onCommitFiberUnmount(pp,E)}catch{}switch(E.tag){case 26:Xn||Io(E,p),ic(u,p,E),E.memoizedState?E.memoizedState.count--:E.stateNode&&(E=E.stateNode,E.parentNode.removeChild(E));break;case 27:Xn||Io(E,p);var g=_r,y=Us;Vh(E.type)&&(_r=E.stateNode,Us=!1),ic(u,p,E),Om(E.stateNode),_r=g,Us=y;break;case 5:Xn||Io(E,p);case 6:if(g=_r,y=Us,_r=null,ic(u,p,E),_r=g,Us=y,_r!==null)if(Us)try{(_r.nodeType===9?_r.body:_r.nodeName==="HTML"?_r.ownerDocument.body:_r).removeChild(E.stateNode)}catch(O){fn(E,p,O)}else try{_r.removeChild(E.stateNode)}catch(O){fn(E,p,O)}break;case 18:_r!==null&&(Us?(u=_r,Cw(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,E.stateNode),xm(u)):Cw(_r,E.stateNode));break;case 4:g=_r,y=Us,_r=E.stateNode.containerInfo,Us=!0,ic(u,p,E),_r=g,Us=y;break;case 0:case 11:case 14:case 15:Xn||Oh(2,E,p),Xn||Oh(4,E,p),ic(u,p,E);break;case 1:Xn||(Io(E,p),g=E.stateNode,typeof g.componentWillUnmount=="function"&&Rf(E,p,g)),ic(u,p,E);break;case 21:ic(u,p,E);break;case 22:Xn=(g=Xn)||E.memoizedState!==null,ic(u,p,E),Xn=g;break;default:ic(u,p,E)}}function dw(u,p){if(p.memoizedState===null&&(u=p.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{xm(u)}catch(E){fn(p,p.return,E)}}function ZN(u){switch(u.tag){case 13:case 19:var p=u.stateNode;return p===null&&(p=u.stateNode=new cw),p;case 22:return u=u.stateNode,p=u._retryCache,p===null&&(p=u._retryCache=new cw),p;default:throw Error(K(435,u.tag))}}function fy(u,p){var E=ZN(u);p.forEach(function(g){var y=rD.bind(null,u,g);E.has(g)||(E.add(g),g.then(y,y))})}function Qs(u,p){var E=p.deletions;if(E!==null)for(var g=0;g<E.length;g++){var y=E[g],O=u,H=p,Z=H;e:for(;Z!==null;){switch(Z.tag){case 27:if(Vh(Z.type)){_r=Z.stateNode,Us=!1;break e}break;case 5:_r=Z.stateNode,Us=!1;break e;case 3:case 4:_r=Z.stateNode.containerInfo,Us=!0;break e}Z=Z.return}if(_r===null)throw Error(K(160));Nh(O,H,y),_r=null,Us=!1,O=y.alternate,O!==null&&(O.return=null),y.return=null}if(p.subtreeFlags&13878)for(p=p.child;p!==null;)lw(p,u),p=p.sibling}var hd=null;function lw(u,p){var E=u.alternate,g=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:Qs(p,u),rc(u),g&4&&(Oh(3,u,u.return),Dp(3,u),Oh(5,u,u.return));break;case 1:Qs(p,u),rc(u),g&512&&(Xn||E===null||Io(E,E.return)),g&64&&ud&&(u=u.updateQueue,u!==null&&(g=u.callbacks,g!==null&&(E=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=E===null?g:E.concat(g))));break;case 26:var y=hd;if(Qs(p,u),rc(u),g&512&&(Xn||E===null||Io(E,E.return)),g&4){var O=E!==null?E.memoizedState:null;if(g=u.memoizedState,E===null)if(g===null)if(u.stateNode===null){e:{g=u.type,E=u.memoizedProps,y=y.ownerDocument||y;t:switch(g){case"title":O=y.getElementsByTagName("title")[0],(!O||O[_p]||O[Ls]||O.namespaceURI==="http://www.w3.org/2000/svg"||O.hasAttribute("itemprop"))&&(O=y.createElement(g),y.head.insertBefore(O,y.querySelector("head > title"))),Ka(O,g,E),O[Ls]=u,Da(O),g=O;break e;case"link":var H=gT("link","href",y).get(g+(E.href||""));if(H){for(var Z=0;Z<H.length;Z++)if(O=H[Z],O.getAttribute("href")===(E.href==null||E.href===""?null:E.href)&&O.getAttribute("rel")===(E.rel==null?null:E.rel)&&O.getAttribute("title")===(E.title==null?null:E.title)&&O.getAttribute("crossorigin")===(E.crossOrigin==null?null:E.crossOrigin)){H.splice(Z,1);break t}}O=y.createElement(g),Ka(O,g,E),y.head.appendChild(O);break;case"meta":if(H=gT("meta","content",y).get(g+(E.content||""))){for(Z=0;Z<H.length;Z++)if(O=H[Z],O.getAttribute("content")===(E.content==null?null:""+E.content)&&O.getAttribute("name")===(E.name==null?null:E.name)&&O.getAttribute("property")===(E.property==null?null:E.property)&&O.getAttribute("http-equiv")===(E.httpEquiv==null?null:E.httpEquiv)&&O.getAttribute("charset")===(E.charSet==null?null:E.charSet)){H.splice(Z,1);break t}}O=y.createElement(g),Ka(O,g,E),y.head.appendChild(O);break;default:throw Error(K(468,g))}O[Ls]=u,Da(O),g=O}u.stateNode=g}else Nw(y,u.type,u.stateNode);else u.stateNode=Ff(y,g,u.memoizedProps);else O!==g?(O===null?E.stateNode!==null&&(E=E.stateNode,E.parentNode.removeChild(E)):O.count--,g===null?Nw(y,u.type,u.stateNode):Ff(y,g,u.memoizedProps)):g===null&&u.stateNode!==null&&_m(u,u.memoizedProps,E.memoizedProps)}break;case 27:Qs(p,u),rc(u),g&512&&(Xn||E===null||Io(E,E.return)),E!==null&&g&4&&_m(u,u.memoizedProps,E.memoizedProps);break;case 5:if(Qs(p,u),rc(u),g&512&&(Xn||E===null||Io(E,E.return)),u.flags&32){y=u.stateNode;try{Jd(y,"")}catch(Le){fn(u,u.return,Le)}}g&4&&u.stateNode!=null&&(y=u.memoizedProps,_m(u,y,E!==null?E.memoizedProps:y)),g&1024&&(Pp=!0);break;case 6:if(Qs(p,u),rc(u),g&4){if(u.stateNode===null)throw Error(K(162));g=u.memoizedProps,E=u.stateNode;try{E.nodeValue=g}catch(Le){fn(u,u.return,Le)}}break;case 3:if(mT=null,y=hd,hd=fT(p.containerInfo),Qs(p,u),hd=y,rc(u),g&4&&E!==null&&E.memoizedState.isDehydrated)try{xm(p.containerInfo)}catch(Le){fn(u,u.return,Le)}Pp&&(Pp=!1,vf(u));break;case 4:g=hd,hd=fT(u.stateNode.containerInfo),Qs(p,u),rc(u),hd=g;break;case 12:Qs(p,u),rc(u);break;case 13:Qs(p,u),rc(u),u.child.flags&8192&&u.memoizedState!==null!=(E!==null&&E.memoizedState!==null)&&(Vp=Yd()),g&4&&(g=u.updateQueue,g!==null&&(u.updateQueue=null,fy(u,g)));break;case 22:y=u.memoizedState!==null;var le=E!==null&&E.memoizedState!==null,be=ud,We=Xn;if(ud=be||y,Xn=We||le,Qs(p,u),Xn=We,ud=be,rc(u),g&8192)e:for(p=u.stateNode,p._visibility=y?p._visibility&-2:p._visibility|1,y&&(E===null||le||ud||Xn||Lp(u)),E=null,p=u;;){if(p.tag===5||p.tag===26){if(E===null){le=E=p;try{if(O=le.stateNode,y)H=O.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none";else{Z=le.stateNode;var Qe=le.memoizedProps.style,De=Qe!=null&&Qe.hasOwnProperty("display")?Qe.display:null;Z.style.display=De==null||typeof De=="boolean"?"":(""+De).trim()}}catch(Le){fn(le,le.return,Le)}}}else if(p.tag===6){if(E===null){le=p;try{le.stateNode.nodeValue=y?"":le.memoizedProps}catch(Le){fn(le,le.return,Le)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===u)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break e;for(;p.sibling===null;){if(p.return===null||p.return===u)break e;E===p&&(E=null),p=p.return}E===p&&(E=null),p.sibling.return=p.return,p=p.sibling}g&4&&(g=u.updateQueue,g!==null&&(E=g.retryQueue,E!==null&&(g.retryQueue=null,fy(u,E))));break;case 19:Qs(p,u),rc(u),g&4&&(g=u.updateQueue,g!==null&&(u.updateQueue=null,fy(u,g)));break;case 30:break;case 21:break;default:Qs(p,u),rc(u)}}function rc(u){var p=u.flags;if(p&2){try{for(var E,g=u.return;g!==null;){if(sw(g)){E=g;break}g=g.return}if(E==null)throw Error(K(160));switch(E.tag){case 27:var y=E.stateNode,O=_y(u);qS(u,O,y);break;case 5:var H=E.stateNode;E.flags&32&&(Jd(H,""),E.flags&=-33);var Z=_y(u);qS(u,Z,H);break;case 3:case 4:var le=E.stateNode.containerInfo,be=_y(u);fm(u,be,le);break;default:throw Error(K(161))}}catch(We){fn(u,u.return,We)}u.flags&=-3}p&4096&&(u.flags&=-4097)}function vf(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var p=u;vf(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),u=u.sibling}}function aa(u,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)XS(u,p.alternate,p),p=p.sibling}function Lp(u){for(u=u.child;u!==null;){var p=u;switch(p.tag){case 0:case 11:case 14:case 15:Oh(4,p,p.return),Lp(p);break;case 1:Io(p,p.return);var E=p.stateNode;typeof E.componentWillUnmount=="function"&&Rf(p,p.return,E),Lp(p);break;case 27:Om(p.stateNode);case 26:case 5:Io(p,p.return),Lp(p);break;case 22:p.memoizedState===null&&Lp(p);break;case 30:Lp(p);break;default:Lp(p)}u=u.sibling}}function Ma(u,p,E){for(E=E&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var g=p.alternate,y=u,O=p,H=O.flags;switch(O.tag){case 0:case 11:case 15:Ma(y,O,E),Dp(4,O);break;case 1:if(Ma(y,O,E),g=O,y=g.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(be){fn(g,g.return,be)}if(g=O,y=g.updateQueue,y!==null){var Z=g.stateNode;try{var le=y.shared.hiddenCallbacks;if(le!==null)for(y.shared.hiddenCallbacks=null,y=0;y<le.length;y++)CS(le[y],Z)}catch(be){fn(g,g.return,be)}}E&&H&64&&nw(O),pm(O,O.return);break;case 27:ow(O);case 26:case 5:Ma(y,O,E),E&&g===null&&H&4&&aw(O),pm(O,O.return);break;case 12:Ma(y,O,E);break;case 13:Ma(y,O,E),E&&H&4&&dw(y,O);break;case 22:O.memoizedState===null&&Ma(y,O,E),pm(O,O.return);break;case 30:break;default:Ma(y,O,E)}p=p.sibling}}function Em(u,p){var E=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(E=u.memoizedState.cachePool.pool),u=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(u=p.memoizedState.cachePool.pool),u!==E&&(u!=null&&u.refCount++,E!=null&&$E(E))}function _n(u,p){u=null,p.alternate!==null&&(u=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==u&&(p.refCount++,u!=null&&$E(u))}function rl(u,p,E,g){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)uw(u,p,E,g),p=p.sibling}function uw(u,p,E,g){var y=p.flags;switch(p.tag){case 0:case 11:case 15:rl(u,p,E,g),y&2048&&Dp(9,p);break;case 1:rl(u,p,E,g);break;case 3:rl(u,p,E,g),y&2048&&(u=null,p.alternate!==null&&(u=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==u&&(p.refCount++,u!=null&&$E(u)));break;case 12:if(y&2048){rl(u,p,E,g),u=p.stateNode;try{var O=p.memoizedProps,H=O.id,Z=O.onPostCommit;typeof Z=="function"&&Z(H,p.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(le){fn(p,p.return,le)}}else rl(u,p,E,g);break;case 13:rl(u,p,E,g);break;case 23:break;case 22:O=p.stateNode,H=p.alternate,p.memoizedState!==null?O._visibility&2?rl(u,p,E,g):mm(u,p):O._visibility&2?rl(u,p,E,g):(O._visibility|=2,Dh(u,p,E,g,(p.subtreeFlags&10256)!==0)),y&2048&&Em(H,p);break;case 24:rl(u,p,E,g),y&2048&&_n(p.alternate,p);break;default:rl(u,p,E,g)}}function Dh(u,p,E,g,y){for(y=y&&(p.subtreeFlags&10256)!==0,p=p.child;p!==null;){var O=u,H=p,Z=E,le=g,be=H.flags;switch(H.tag){case 0:case 11:case 15:Dh(O,H,Z,le,y),Dp(8,H);break;case 23:break;case 22:var We=H.stateNode;H.memoizedState!==null?We._visibility&2?Dh(O,H,Z,le,y):mm(O,H):(We._visibility|=2,Dh(O,H,Z,le,y)),y&&be&2048&&Em(H.alternate,H);break;case 24:Dh(O,H,Z,le,y),y&&be&2048&&_n(H.alternate,H);break;default:Dh(O,H,Z,le,y)}p=p.sibling}}function mm(u,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var E=u,g=p,y=g.flags;switch(g.tag){case 22:mm(E,g),y&2048&&Em(g.alternate,g);break;case 24:mm(E,g),y&2048&&_n(g.alternate,g);break;default:mm(E,g)}p=p.sibling}}var kp=8192;function Ph(u){if(u.subtreeFlags&kp)for(u=u.child;u!==null;)hw(u),u=u.sibling}function hw(u){switch(u.tag){case 26:Ph(u),u.flags&kp&&u.memoizedState!==null&&CD(hd,u.memoizedState,u.memoizedProps);break;case 5:Ph(u);break;case 3:case 4:var p=hd;hd=fT(u.stateNode.containerInfo),Ph(u),hd=p;break;case 22:u.memoizedState===null&&(p=u.alternate,p!==null&&p.memoizedState!==null?(p=kp,kp=16777216,Ph(u),kp=p):Ph(u));break;default:Ph(u)}}function JS(u){var p=u.alternate;if(p!==null&&(u=p.child,u!==null)){p.child=null;do p=u.sibling,u.sibling=null,u=p;while(u!==null)}}function gm(u){var p=u.deletions;if((u.flags&16)!==0){if(p!==null)for(var E=0;E<p.length;E++){var g=p[E];as=g,yf(g,u)}JS(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)pw(u),u=u.sibling}function pw(u){switch(u.tag){case 0:case 11:case 15:gm(u),u.flags&2048&&Oh(9,u,u.return);break;case 3:gm(u);break;case 12:gm(u);break;case 22:var p=u.stateNode;u.memoizedState!==null&&p._visibility&2&&(u.return===null||u.return.tag!==13)?(p._visibility&=-3,ZS(u)):gm(u);break;default:gm(u)}}function ZS(u){var p=u.deletions;if((u.flags&16)!==0){if(p!==null)for(var E=0;E<p.length;E++){var g=p[E];as=g,yf(g,u)}JS(u)}for(u=u.child;u!==null;){switch(p=u,p.tag){case 0:case 11:case 15:Oh(8,p,p.return),ZS(p);break;case 22:E=p.stateNode,E._visibility&2&&(E._visibility&=-3,ZS(p));break;default:ZS(p)}u=u.sibling}}function yf(u,p){for(;as!==null;){var E=as;switch(E.tag){case 0:case 11:case 15:Oh(8,E,p);break;case 23:case 22:if(E.memoizedState!==null&&E.memoizedState.cachePool!==null){var g=E.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:$E(E.memoizedState.cache)}if(g=E.child,g!==null)g.return=E,as=g;else e:for(E=u;as!==null;){g=as;var y=g.sibling,O=g.return;if(il(g),g===E){as=null;break e}if(y!==null){y.return=O,as=y;break e}as=O}}}var Sm={getCacheForType:function(u){var p=ra(pa),E=p.data.get(u);return E===void 0&&(E=u(),p.data.set(u,E)),E}},QN=typeof WeakMap=="function"?WeakMap:Map,Or=0,In=null,Yi=null,fr=0,Nr=0,_a=null,nl=!1,al=!1,Mp=!1,pd=0,jn=0,wo=0,pu=0,Ey=0,Nc=0,Lh=0,Up=null,Gn=null,xp=!1,Vp=0,kh=1/0,Cf=null,sl=null,Ts=0,Mh=null,xs=null,bf=0,Tm=0,Fp=null,_w=null,Rm=0,my=null;function nc(){if((Or&2)!==0&&fr!==0)return fr&-fr;if(je.T!==null){var u=nf;return u!==0?u:mu()}return PA()}function Af(){Nc===0&&(Nc=(fr&536870912)===0||Hr?nS():536870912);var u=An.current;return u!==null&&(u.flags|=32),Nc}function $s(u,p,E){(u===In&&(Nr===2||Nr===9)||u.cancelPendingCommit!==null)&&(Uh(u,0),Dc(u,fr,Nc,!1)),kE(u,E),((Or&2)===0||u!==In)&&(u===In&&((Or&2)===0&&(pu|=E),jn===4&&Dc(u,fr,Nc,!1)),No(u))}function QS(u,p,E){if((Or&6)!==0)throw Error(K(327));var g=!E&&(p&124)===0&&(p&u.expiredLanes)===0||LE(u,p),y=g?eD(u,p):gy(u,p,!0),O=g;do{if(y===0){al&&!g&&Dc(u,p,0,!1);break}else{if(E=u.current.alternate,O&&!Bp(E)){y=gy(u,p,!1),O=!1;continue}if(y===2){if(O=p,u.errorRecoveryDisabledLanes&O)var H=0;else H=u.pendingLanes&-536870913,H=H!==0?H:H&536870912?536870912:0;if(H!==0){p=H;e:{var Z=u;y=Up;var le=Z.current.memoizedState.isDehydrated;if(le&&(Uh(Z,H).flags|=256),H=gy(Z,H,!1),H!==2){if(Mp&&!le){Z.errorRecoveryDisabledLanes|=O,pu|=O,y=4;break e}O=Gn,Gn=y,O!==null&&(Gn===null?Gn=O:Gn.push.apply(Gn,O))}y=H}if(O=!1,y!==2)continue}}if(y===1){Uh(u,0),Dc(u,p,0,!0);break}e:{switch(g=u,O=y,O){case 0:case 1:throw Error(K(345));case 4:if((p&4194048)!==p)break;case 6:Dc(g,p,Nc,!nl);break e;case 2:Gn=null;break;case 3:case 5:break;default:throw Error(K(329))}if((p&62914560)===p&&(y=Vp+300-Yd(),10<y)){if(Dc(g,p,Nc,!nl),rS(g,0,!0)!==0)break e;g.timeoutHandle=vw($S.bind(null,g,E,Gn,Cf,xp,p,Nc,pu,Lh,nl,O,2,-0,0),y);break e}$S(g,E,Gn,Cf,xp,p,Nc,pu,Lh,nl,O,0,-0,0)}}break}while(!0);No(u)}function $S(u,p,E,g,y,O,H,Z,le,be,We,Qe,De,Le){if(u.timeoutHandle=-1,Qe=p.subtreeFlags,(Qe&8192||(Qe&16785408)===16785408)&&(Pm={stylesheets:null,count:0,unsuspend:yD},hw(p),Qe=My(),Qe!==null)){u.cancelPendingCommit=Qe(Ew.bind(null,u,p,O,E,g,y,H,Z,le,We,1,De,Le)),Dc(u,O,H,!be);return}Ew(u,p,O,E,g,y,H,Z,le)}function Bp(u){for(var p=u;;){var E=p.tag;if((E===0||E===11||E===15)&&p.flags&16384&&(E=p.updateQueue,E!==null&&(E=E.stores,E!==null)))for(var g=0;g<E.length;g++){var y=E[g],O=y.getSnapshot;y=y.value;try{if(!Jo(O(),y))return!1}catch{return!1}}if(E=p.child,p.subtreeFlags&16384&&E!==null)E.return=p,p=E;else{if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function Dc(u,p,E,g){p&=~Ey,p&=~pu,u.suspendedLanes|=p,u.pingedLanes&=~p,g&&(u.warmLanes|=p),g=u.expirationTimes;for(var y=p;0<y;){var O=31-fs(y),H=1<<O;g[O]=-1,y&=~H}E!==0&&qd(u,E,p)}function ol(){return(Or&6)===0?(vm(0),!1):!0}function _u(){if(Yi!==null){if(Nr===0)var u=Yi.return;else u=Yi,Ql=Cp=null,ty(u),vh=null,gs=0,u=Yi;for(;u!==null;)rw(u.alternate,u),u=u.return;Yi=null}}function Uh(u,p){var E=u.timeoutHandle;E!==-1&&(u.timeoutHandle=-1,dD(E)),E=u.cancelPendingCommit,E!==null&&(u.cancelPendingCommit=null,E()),_u(),In=u,Yi=E=ql(u.current,null),fr=p,Nr=0,_a=null,nl=!1,al=LE(u,p),Mp=!1,Lh=Nc=Ey=pu=wo=jn=0,Gn=Up=null,xp=!1,(p&8)!==0&&(p|=p&32);var g=u.entangledLanes;if(g!==0)for(u=u.entanglements,g&=p;0<g;){var y=31-fs(g),O=1<<y;p|=u[y],g&=~O}return pd=p,Zd(),E}function Pc(u,p){Gi=null,je.H=na,p===tu||p===vS?(p=SI(),Nr=3):p===EI?(p=SI(),Nr=4):Nr=p===XI?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,_a=p,Yi===null&&(jn=1,BS(u,Ro(p,u.current)))}function Oo(){var u=je.H;return je.H=na,u===null?na:u}function fw(){var u=je.A;return je.A=Sm,u}function _d(){jn=4,nl||(fr&4194048)!==fr&&An.current!==null||(al=!0),(wo&134217727)===0&&(pu&134217727)===0||In===null||Dc(In,fr,Nc,!1)}function gy(u,p,E){var g=Or;Or|=2;var y=Oo(),O=fw();(In!==u||fr!==p)&&(Cf=null,Uh(u,p)),p=!1;var H=jn;e:do try{if(Nr!==0&&Yi!==null){var Z=Yi,le=_a;switch(Nr){case 8:_u(),H=6;break e;case 3:case 2:case 9:case 6:An.current===null&&(p=!0);var be=Nr;if(Nr=0,_a=null,xh(u,Z,le,be),E&&al){H=0;break e}break;default:be=Nr,Nr=0,_a=null,xh(u,Z,le,be)}}$N(),H=jn;break}catch(We){Pc(u,We)}while(!0);return p&&u.shellSuspendCounter++,Ql=Cp=null,Or=g,je.H=y,je.A=O,Yi===null&&(In=null,fr=0,Zd()),H}function $N(){for(;Yi!==null;)eT(Yi)}function eD(u,p){var E=Or;Or|=2;var g=Oo(),y=fw();In!==u||fr!==p?(Cf=null,kh=Yd()+500,Uh(u,p)):al=LE(u,p);e:do try{if(Nr!==0&&Yi!==null){p=Yi;var O=_a;t:switch(Nr){case 1:Nr=0,_a=null,xh(u,p,O,1);break;case 2:case 9:if(mI(O)){Nr=0,_a=null,If(p);break}p=function(){Nr!==2&&Nr!==9||In!==u||(Nr=7),No(u)},O.then(p,p);break e;case 3:Nr=7;break e;case 4:Nr=5;break e;case 7:mI(O)?(Nr=0,_a=null,If(p)):(Nr=0,_a=null,xh(u,p,O,7));break;case 5:var H=null;switch(Yi.tag){case 26:H=Yi.memoizedState;case 5:case 27:var Z=Yi;if(!H||Dw(H)){Nr=0,_a=null;var le=Z.sibling;if(le!==null)Yi=le;else{var be=Z.return;be!==null?(Yi=be,tT(be)):Yi=null}break t}}Nr=0,_a=null,xh(u,p,O,5);break;case 6:Nr=0,_a=null,xh(u,p,O,6);break;case 8:_u(),jn=6;break e;default:throw Error(K(462))}}tD();break}catch(We){Pc(u,We)}while(!0);return Ql=Cp=null,je.H=g,je.A=y,Or=E,Yi!==null?0:(In=null,fr=0,Zd(),jn)}function tD(){for(;Yi!==null&&!oN();)eT(Yi)}function eT(u){var p=wh(u.alternate,u,pd);u.memoizedProps=u.pendingProps,p===null?tT(u):Yi=p}function If(u){var p=u,E=p.alternate;switch(p.tag){case 15:case 0:p=WS(E,p,p.pendingProps,p.type,void 0,fr);break;case 11:p=WS(E,p,p.pendingProps,p.type.render,p.ref,fr);break;case 5:ty(p);default:rw(E,p),p=Yi=ef(p,pd),p=wh(E,p,pd)}u.memoizedProps=u.pendingProps,p===null?tT(u):Yi=p}function xh(u,p,E,g){Ql=Cp=null,ty(p),vh=null,gs=0;var y=p.return;try{if(zN(u,y,p,E,fr)){jn=1,BS(u,Ro(E,u.current)),Yi=null;return}}catch(O){if(y!==null)throw Yi=y,O;jn=1,BS(u,Ro(E,u.current)),Yi=null;return}p.flags&32768?(Hr||g===1?u=!0:al||(fr&536870912)!==0?u=!1:(nl=u=!0,(g===2||g===9||g===3||g===6)&&(g=An.current,g!==null&&g.tag===13&&(g.flags|=16384))),iT(p,u)):tT(p)}function tT(u){var p=u;do{if((p.flags&32768)!==0){iT(p,nl);return}u=p.return;var E=XN(p.alternate,p,pd);if(E!==null){Yi=E;return}if(p=p.sibling,p!==null){Yi=p;return}Yi=p=u}while(p!==null);jn===0&&(jn=5)}function iT(u,p){do{var E=JN(u.alternate,u);if(E!==null){E.flags&=32767,Yi=E;return}if(E=u.return,E!==null&&(E.flags|=32768,E.subtreeFlags=0,E.deletions=null),!p&&(u=u.sibling,u!==null)){Yi=u;return}Yi=u=E}while(u!==null);jn=6,Yi=null}function Ew(u,p,E,g,y,O,H,Z,le){u.cancelPendingCommit=null;do nT();while(Ts!==0);if((Or&6)!==0)throw Error(K(327));if(p!==null){if(p===u.current)throw Error(K(177));if(O=p.lanes|p.childLanes,O|=xv,dN(u,E,O,H,Z,le),u===In&&(Yi=In=null,fr=0),xs=p,Mh=u,bf=E,Tm=O,Fp=y,_w=g,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,nD(oh,function(){return wf(),null})):(u.callbackNode=null,u.callbackPriority=0),g=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||g){g=je.T,je.T=null,y=tt.p,tt.p=2,H=Or,Or|=4;try{hu(u,p,E)}finally{Or=H,tt.p=y,je.T=g}}Ts=1,cl(),Ua(),rT()}}function cl(){if(Ts===1){Ts=0;var u=Mh,p=xs,E=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||E){E=je.T,je.T=null;var g=tt.p;tt.p=2;var y=Or;Or|=4;try{lw(p,u);var O=Su,H=Ms(u.containerInfo),Z=O.focusedElem,le=O.selectionRange;if(H!==Z&&Z&&Z.ownerDocument&&nI(Z.ownerDocument.documentElement,Z)){if(le!==null&&Pv(Z)){var be=le.start,We=le.end;if(We===void 0&&(We=be),"selectionStart"in Z)Z.selectionStart=be,Z.selectionEnd=Math.min(We,Z.value.length);else{var Qe=Z.ownerDocument||document,De=Qe&&Qe.defaultView||window;if(De.getSelection){var Le=De.getSelection(),wi=Z.textContent.length,ui=Math.min(le.start,wi),cn=le.end===void 0?ui:Math.min(le.end,wi);!Le.extend&&ui>cn&&(H=cn,cn=ui,ui=H);var Ce=rI(Z,ui),Se=rI(Z,cn);if(Ce&&Se&&(Le.rangeCount!==1||Le.anchorNode!==Ce.node||Le.anchorOffset!==Ce.offset||Le.focusNode!==Se.node||Le.focusOffset!==Se.offset)){var Ie=Qe.createRange();Ie.setStart(Ce.node,Ce.offset),Le.removeAllRanges(),ui>cn?(Le.addRange(Ie),Le.extend(Se.node,Se.offset)):(Ie.setEnd(Se.node,Se.offset),Le.addRange(Ie))}}}}for(Qe=[],Le=Z;Le=Le.parentNode;)Le.nodeType===1&&Qe.push({element:Le,left:Le.scrollLeft,top:Le.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<Qe.length;Z++){var Xe=Qe[Z];Xe.element.scrollLeft=Xe.left,Xe.element.scrollTop=Xe.top}}vT=!!Ay,Su=Ay=null}finally{Or=y,tt.p=g,je.T=E}}u.current=p,Ts=2}}function Ua(){if(Ts===2){Ts=0;var u=Mh,p=xs,E=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||E){E=je.T,je.T=null;var g=tt.p;tt.p=2;var y=Or;Or|=4;try{XS(u,p.alternate,p)}finally{Or=y,tt.p=g,je.T=E}}Ts=3}}function rT(){if(Ts===4||Ts===3){Ts=0,Js();var u=Mh,p=xs,E=bf,g=_w;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?Ts=5:(Ts=0,xs=Mh=null,mw(u,u.pendingLanes));var y=u.pendingLanes;if(y===0&&(sl=null),cv(E),p=p.stateNode,$r&&typeof $r.onCommitFiberRoot=="function")try{$r.onCommitFiberRoot(pp,p,void 0,(p.current.flags&128)===128)}catch{}if(g!==null){p=je.T,y=tt.p,tt.p=2,je.T=null;try{for(var O=u.onRecoverableError,H=0;H<g.length;H++){var Z=g[H];O(Z.value,{componentStack:Z.stack})}}finally{je.T=p,tt.p=y}}(bf&3)!==0&&nT(),No(u),y=u.pendingLanes,(E&4194090)!==0&&(y&42)!==0?u===my?Rm++:(Rm=0,my=u):Rm=0,vm(0)}}function mw(u,p){(u.pooledCacheLanes&=p)===0&&(p=u.pooledCache,p!=null&&(u.pooledCache=null,$E(p)))}function nT(u){return cl(),Ua(),rT(),wf()}function wf(){if(Ts!==5)return!1;var u=Mh,p=Tm;Tm=0;var E=cv(bf),g=je.T,y=tt.p;try{tt.p=32>E?32:E,je.T=null,E=Fp,Fp=null;var O=Mh,H=bf;if(Ts=0,xs=Mh=null,bf=0,(Or&6)!==0)throw Error(K(331));var Z=Or;if(Or|=4,pw(O.current),uw(O,O.current,H,E),Or=Z,vm(0,!1),$r&&typeof $r.onPostCommitFiberRoot=="function")try{$r.onPostCommitFiberRoot(pp,O)}catch{}return!0}finally{tt.p=y,je.T=g,mw(u,p)}}function aT(u,p,E){p=Ro(E,p),p=Ha(u.stateNode,p,2),u=$d(u,p,2),u!==null&&(kE(u,2),No(u))}function fn(u,p,E){if(u.tag===3)aT(u,u,E);else for(;p!==null;){if(p.tag===3){aT(p,u,E);break}else if(p.tag===1){var g=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(sl===null||!sl.has(g))){u=Ro(E,u),E=zI(2),g=$d(p,E,2),g!==null&&(qI(E,g,p,u),kE(g,2),No(g));break}}p=p.return}}function fu(u,p,E){var g=u.pingCache;if(g===null){g=u.pingCache=new QN;var y=new Set;g.set(p,y)}else y=g.get(p),y===void 0&&(y=new Set,g.set(p,y));y.has(E)||(Mp=!0,y.add(E),u=eo.bind(null,u,p,E),p.then(u,u))}function eo(u,p,E){var g=u.pingCache;g!==null&&g.delete(p),u.pingedLanes|=u.suspendedLanes&E,u.warmLanes&=~E,In===u&&(fr&E)===E&&(jn===4||jn===3&&(fr&62914560)===fr&&300>Yd()-Vp?(Or&2)===0&&Uh(u,0):Ey|=E,Lh===fr&&(Lh=0)),No(u)}function dl(u,p){p===0&&(p=NA()),u=$_(u,p),u!==null&&(kE(u,p),No(u))}function iD(u){var p=u.memoizedState,E=0;p!==null&&(E=p.retryLane),dl(u,E)}function rD(u,p){var E=0;switch(u.tag){case 13:var g=u.stateNode,y=u.memoizedState;y!==null&&(E=y.retryLane);break;case 19:g=u.stateNode;break;case 22:g=u.stateNode._retryCache;break;default:throw Error(K(314))}g!==null&&g.delete(p),dl(u,E)}function nD(u,p){return Xs(u,p)}var sT=null,ll=null,Sy=!1,oT=!1,Ty=!1,Eu=0;function No(u){u!==ll&&u.next===null&&(ll===null?sT=ll=u:ll=ll.next=u),oT=!0,Sy||(Sy=!0,Ry())}function vm(u,p){if(!Ty&&oT){Ty=!0;do for(var E=!1,g=sT;g!==null;){if(u!==0){var y=g.pendingLanes;if(y===0)var O=0;else{var H=g.suspendedLanes,Z=g.pingedLanes;O=(1<<31-fs(42|u)+1)-1,O&=y&~(H&~Z),O=O&201326741?O&201326741|1:O?O|2:0}O!==0&&(E=!0,dT(g,O))}else O=fr,O=rS(g,g===In?O:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(O&3)===0||LE(g,O)||(E=!0,dT(g,O));g=g.next}while(E);Ty=!1}}function aD(){gw()}function gw(){oT=Sy=!1;var u=0;Eu!==0&&(cD()&&(u=Eu),Eu=0);for(var p=Yd(),E=null,g=sT;g!==null;){var y=g.next,O=cT(g,p);O===0?(g.next=null,E===null?sT=y:E.next=y,y===null&&(ll=E)):(E=g,(u!==0||(O&3)!==0)&&(oT=!0)),g=y}vm(u)}function cT(u,p){for(var E=u.suspendedLanes,g=u.pingedLanes,y=u.expirationTimes,O=u.pendingLanes&-62914561;0<O;){var H=31-fs(O),Z=1<<H,le=y[H];le===-1?((Z&E)===0||(Z&g)!==0)&&(y[H]=td(Z,p)):le<=p&&(u.expiredLanes|=Z),O&=~Z}if(p=In,E=fr,E=rS(u,u===p?E:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),g=u.callbackNode,E===0||u===p&&(Nr===2||Nr===9)||u.cancelPendingCommit!==null)return g!==null&&g!==null&&iv(g),u.callbackNode=null,u.callbackPriority=0;if((E&3)===0||LE(u,E)){if(p=E&-E,p===u.callbackPriority)return p;switch(g!==null&&iv(g),cv(E)){case 2:case 8:E=x_;break;case 32:E=oh;break;case 268435456:E=iS;break;default:E=oh}return g=Of.bind(null,u),E=Xs(E,g),u.callbackPriority=p,u.callbackNode=E,p}return g!==null&&g!==null&&iv(g),u.callbackPriority=2,u.callbackNode=null,2}function Of(u,p){if(Ts!==0&&Ts!==5)return u.callbackNode=null,u.callbackPriority=0,null;var E=u.callbackNode;if(nT()&&u.callbackNode!==E)return null;var g=fr;return g=rS(u,u===In?g:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),g===0?null:(QS(u,g,p),cT(u,Yd()),u.callbackNode!=null&&u.callbackNode===E?Of.bind(null,u):null)}function dT(u,p){if(nT())return null;QS(u,p,!0)}function Ry(){lD(function(){(Or&6)!==0?Xs(bn,aD):gw()})}function mu(){return Eu===0&&(Eu=nS()),Eu}function lT(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:dS(""+u)}function Sw(u,p){var E=p.ownerDocument.createElement("input");return E.name=p.name,E.value=p.value,u.id&&E.setAttribute("form",u.id),p.parentNode.insertBefore(E,p),u=new FormData(u),E.parentNode.removeChild(E),u}function ym(u,p,E,g,y){if(p==="submit"&&E&&E.stateNode===y){var O=lT((y[go]||null).action),H=g.submitter;H&&(p=(p=H[go]||null)?lT(p.formAction):H.getAttribute("formAction"),p!==null&&(O=p,H=null));var Z=new rs("action","action",null,g,y);u.push({event:Z,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Eu!==0){var le=H?Sw(y,H):new FormData(y);cu(E,{pending:!0,data:le,method:y.method,action:O},null,le)}}else typeof O=="function"&&(Z.preventDefault(),le=H?Sw(y,H):new FormData(y),cu(E,{pending:!0,data:le,method:y.method,action:O},O,le))},currentTarget:y}]})}}for(var vy=0;vy<Uv.length;vy++){var yy=Uv[vy],gu=yy.toLowerCase(),Cm=yy[0].toUpperCase()+yy.slice(1);ad(gu,"on"+Cm)}ad(oI,"onAnimationEnd"),ad(cI,"onAnimationIteration"),ad(Z_,"onAnimationStart"),ad("dblclick","onDoubleClick"),ad("focusin","onFocus"),ad("focusout","onBlur"),ad(qE,"onTransitionRun"),ad(xN,"onTransitionStart"),ad(ee,"onTransitionCancel"),ad(dI,"onTransitionEnd"),G_("onMouseEnter",["mouseout","mouseover"]),G_("onMouseLeave",["mouseout","mouseover"]),G_("onPointerEnter",["pointerout","pointerover"]),G_("onPointerLeave",["pointerout","pointerover"]),Es("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Es("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Es("onBeforeInput",["compositionend","keypress","textInput","paste"]),Es("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Es("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Es("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bm=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jp));function Nf(u,p){p=(p&4)!==0;for(var E=0;E<u.length;E++){var g=u[E],y=g.event;g=g.listeners;e:{var O=void 0;if(p)for(var H=g.length-1;0<=H;H--){var Z=g[H],le=Z.instance,be=Z.currentTarget;if(Z=Z.listener,le!==O&&y.isPropagationStopped())break e;O=Z,y.currentTarget=be;try{O(y)}catch(We){FS(We)}y.currentTarget=null,O=le}else for(H=0;H<g.length;H++){if(Z=g[H],le=Z.instance,be=Z.currentTarget,Z=Z.listener,le!==O&&y.isPropagationStopped())break e;O=Z,y.currentTarget=be;try{O(y)}catch(We){FS(We)}y.currentTarget=null,O=le}}}}function Wi(u,p){var E=p[ME];E===void 0&&(E=p[ME]=new Set);var g=u+"__bubble";E.has(g)||(hT(p,u,2,!1),E.add(g))}function Cy(u,p,E){var g=0;p&&(g|=4),hT(E,u,g,p)}var uT="_reactListening"+Math.random().toString(36).slice(2);function Am(u){if(!u[uT]){u[uT]=!0,j_.forEach(function(E){E!=="selectionchange"&&(bm.has(E)||Cy(E,!1,u),Cy(E,!0,u))});var p=u.nodeType===9?u:u.ownerDocument;p===null||p[uT]||(p[uT]=!0,Cy("selectionchange",!1,p))}}function hT(u,p,E,g){switch(Mw(p)){case 2:var y=AD;break;case 8:y=ID;break;default:y=km}E=y.bind(null,p,E,u),y=void 0,!Rv||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(y=!0),g?y!==void 0?u.addEventListener(p,E,{capture:!0,passive:y}):u.addEventListener(p,E,!0):y!==void 0?u.addEventListener(p,E,{passive:y}):u.addEventListener(p,E,!1)}function Im(u,p,E,g,y){var O=g;if((p&1)===0&&(p&2)===0&&g!==null)e:for(;;){if(g===null)return;var H=g.tag;if(H===3||H===4){var Z=g.stateNode.containerInfo;if(Z===y)break;if(H===4)for(H=g.return;H!==null;){var le=H.tag;if((le===3||le===4)&&H.stateNode.containerInfo===y)return;H=H.return}for(;Z!==null;){if(H=F_(Z),H===null)return;if(le=H.tag,le===5||le===6||le===26||le===27){g=O=H;continue e}Z=Z.parentNode}}g=g.return}GA(function(){var be=O,We=Sv(E),Qe=[];e:{var De=lI.get(u);if(De!==void 0){var Le=rs,wi=u;switch(u){case"keypress":if(uS(E)===0)break e;case"keydown":case"keyup":Le=vN;break;case"focusin":wi="focus",Le=GE;break;case"focusout":wi="blur",Le=GE;break;case"beforeblur":case"afterblur":Le=GE;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Le=KA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Le=EN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Le=CN;break;case oI:case cI:case Z_:Le=WE;break;case dI:Le=Iv;break;case"scroll":case"scrollend":Le=yv;break;case"wheel":Le=dt;break;case"copy":case"cut":case"paste":Le=HE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Le=YA;break;case"toggle":case"beforetoggle":Le=IN}var ui=(p&4)!==0,cn=!ui&&(u==="scroll"||u==="scrollend"),Ce=ui?De!==null?De+"Capture":null:De;ui=[];for(var Se=be,Ie;Se!==null;){var Xe=Se;if(Ie=Xe.stateNode,Xe=Xe.tag,Xe!==5&&Xe!==26&&Xe!==27||Ie===null||Ce===null||(Xe=Ep(Se,Ce),Xe!=null&&ui.push(Gp(Se,Xe,Ie))),cn)break;Se=Se.return}0<ui.length&&(De=new Le(De,wi,null,E,We),Qe.push({event:De,listeners:ui}))}}if((p&7)===0){e:{if(De=u==="mouseover"||u==="pointerover",Le=u==="mouseout"||u==="pointerout",De&&E!==gv&&(wi=E.relatedTarget||E.fromElement)&&(F_(wi)||wi[vc]))break e;if((Le||De)&&(De=We.window===We?We:(De=We.ownerDocument)?De.defaultView||De.parentWindow:window,Le?(wi=E.relatedTarget||E.toElement,Le=be,wi=wi?F_(wi):null,wi!==null&&(cn=re(wi),ui=wi.tag,wi!==cn||ui!==5&&ui!==27&&ui!==6)&&(wi=null)):(Le=null,wi=be),Le!==wi)){if(ui=KA,Xe="onMouseLeave",Ce="onMouseEnter",Se="mouse",(u==="pointerout"||u==="pointerover")&&(ui=YA,Xe="onPointerLeave",Ce="onPointerEnter",Se="pointer"),cn=Le==null?De:xE(Le),Ie=wi==null?De:xE(wi),De=new ui(Xe,Se+"leave",Le,E,We),De.target=cn,De.relatedTarget=Ie,Xe=null,F_(We)===be&&(ui=new ui(Ce,Se+"enter",wi,E,We),ui.target=Ie,ui.relatedTarget=cn,Xe=ui),cn=Xe,Le&&wi)t:{for(ui=Le,Ce=wi,Se=0,Ie=ui;Ie;Ie=Pf(Ie))Se++;for(Ie=0,Xe=Ce;Xe;Xe=Pf(Xe))Ie++;for(;0<Se-Ie;)ui=Pf(ui),Se--;for(;0<Ie-Se;)Ce=Pf(Ce),Ie--;for(;Se--;){if(ui===Ce||Ce!==null&&ui===Ce.alternate)break t;ui=Pf(ui),Ce=Pf(Ce)}ui=null}else ui=null;Le!==null&&pT(Qe,De,Le,ui,!1),wi!==null&&cn!==null&&pT(Qe,cn,wi,ui,!0)}}e:{if(De=be?xE(be):window,Le=De.nodeName&&De.nodeName.toLowerCase(),Le==="select"||Le==="input"&&De.type==="file")var vt=$A;else if(ZA(De))if(Bn)vt=YE;else{vt=kN;var Zi=LN}else Le=De.nodeName,!Le||Le.toLowerCase()!=="input"||De.type!=="checkbox"&&De.type!=="radio"?be&&fp(be.elementType)&&(vt=$A):vt=Dv;if(vt&&(vt=vt(u,be))){QA(Qe,vt,E,We);break e}Zi&&Zi(u,De,be),u==="focusout"&&be&&De.type==="number"&&be.memoizedProps.value!=null&&fv(De,"number",De.value)}switch(Zi=be?xE(be):window,u){case"focusin":(ZA(Zi)||Zi.contentEditable==="true")&&(Fr=Zi,Lv=be,zE=null);break;case"focusout":zE=Lv=Fr=null;break;case"mousedown":kv=!0;break;case"contextmenu":case"mouseup":case"dragend":kv=!1,aI(Qe,E,We);break;case"selectionchange":if(UN)break;case"keydown":case"keyup":aI(Qe,E,We)}var ii;if(wv)e:{switch(u){case"compositionstart":var yi="onCompositionStart";break e;case"compositionend":yi="onCompositionEnd";break e;case"compositionupdate":yi="onCompositionUpdate";break e}yi=void 0}else dh?XA(u,E)&&(yi="onCompositionEnd"):u==="keydown"&&E.keyCode===229&&(yi="onCompositionStart");yi&&(zA&&E.locale!=="ko"&&(dh||yi!=="onCompositionStart"?yi==="onCompositionEnd"&&dh&&(ii=WA()):(ks=We,vv="value"in ks?ks.value:ks.textContent,dh=!0)),Zi=Df(be,yi),0<Zi.length&&(yi=new q_(yi,u,null,E,We),Qe.push({event:yi,listeners:Zi}),ii?yi.data=ii:(ii=JA(E),ii!==null&&(yi.data=ii)))),(ii=ON?NN(u,E):Zs(u,E))&&(yi=Df(be,"onBeforeInput"),0<yi.length&&(Zi=new q_("onBeforeInput","beforeinput",null,E,We),Qe.push({event:Zi,listeners:yi}),Zi.data=ii)),ym(Qe,u,be,E,We)}Nf(Qe,p)})}function Gp(u,p,E){return{instance:u,listener:p,currentTarget:E}}function Df(u,p){for(var E=p+"Capture",g=[];u!==null;){var y=u,O=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||O===null||(y=Ep(u,E),y!=null&&g.unshift(Gp(u,y,O)),y=Ep(u,p),y!=null&&g.push(Gp(u,y,O))),u.tag===3)return g;u=u.return}return[]}function Pf(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function pT(u,p,E,g,y){for(var O=p._reactName,H=[];E!==null&&E!==g;){var Z=E,le=Z.alternate,be=Z.stateNode;if(Z=Z.tag,le!==null&&le===g)break;Z!==5&&Z!==26&&Z!==27||be===null||(le=be,y?(be=Ep(E,O),be!=null&&H.unshift(Gp(E,be,le))):y||(be=Ep(E,O),be!=null&&H.push(Gp(E,be,le)))),E=E.return}H.length!==0&&u.push({event:p,listeners:H})}var sD=/\r\n?/g,fd=/\u0000|\uFFFD/g;function Lc(u){return(typeof u=="string"?u:""+u).replace(sD,`
`).replace(fd,"")}function Lf(u,p){return p=Lc(p),Lc(u)===p}function kf(){}function Xr(u,p,E,g,y,O){switch(E){case"children":typeof g=="string"?p==="body"||p==="textarea"&&g===""||Jd(u,g):(typeof g=="number"||typeof g=="bigint")&&p!=="body"&&Jd(u,""+g);break;case"className":sS(u,"class",g);break;case"tabIndex":sS(u,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":sS(u,E,g);break;case"style":BA(u,g,O);break;case"data":if(p!=="object"){sS(u,"data",g);break}case"src":case"href":if(g===""&&(p!=="a"||E!=="href")){u.removeAttribute(E);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){u.removeAttribute(E);break}g=dS(""+g),u.setAttribute(E,g);break;case"action":case"formAction":if(typeof g=="function"){u.setAttribute(E,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof O=="function"&&(E==="formAction"?(p!=="input"&&Xr(u,p,"name",y.name,y,null),Xr(u,p,"formEncType",y.formEncType,y,null),Xr(u,p,"formMethod",y.formMethod,y,null),Xr(u,p,"formTarget",y.formTarget,y,null)):(Xr(u,p,"encType",y.encType,y,null),Xr(u,p,"method",y.method,y,null),Xr(u,p,"target",y.target,y,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){u.removeAttribute(E);break}g=dS(""+g),u.setAttribute(E,g);break;case"onClick":g!=null&&(u.onclick=kf);break;case"onScroll":g!=null&&Wi("scroll",u);break;case"onScrollEnd":g!=null&&Wi("scrollend",u);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(K(61));if(E=g.__html,E!=null){if(y.children!=null)throw Error(K(60));u.innerHTML=E}}break;case"multiple":u.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":u.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){u.removeAttribute("xlink:href");break}E=dS(""+g),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",E);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?u.setAttribute(E,""+g):u.removeAttribute(E);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?u.setAttribute(E,""):u.removeAttribute(E);break;case"capture":case"download":g===!0?u.setAttribute(E,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?u.setAttribute(E,g):u.removeAttribute(E);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?u.setAttribute(E,g):u.removeAttribute(E);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?u.removeAttribute(E):u.setAttribute(E,g);break;case"popover":Wi("beforetoggle",u),Wi("toggle",u),Bi(u,"popover",g);break;case"xlinkActuate":jl(u,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":jl(u,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":jl(u,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":jl(u,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":jl(u,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":jl(u,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":jl(u,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":jl(u,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":jl(u,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":Bi(u,"is",g);break;case"innerText":case"textContent":break;default:(!(2<E.length)||E[0]!=="o"&&E[0]!=="O"||E[1]!=="n"&&E[1]!=="N")&&(E=_N.get(E)||E,Bi(u,E,g))}}function by(u,p,E,g,y,O){switch(E){case"style":BA(u,g,O);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(K(61));if(E=g.__html,E!=null){if(y.children!=null)throw Error(K(60));u.innerHTML=E}}break;case"children":typeof g=="string"?Jd(u,g):(typeof g=="number"||typeof g=="bigint")&&Jd(u,""+g);break;case"onScroll":g!=null&&Wi("scroll",u);break;case"onScrollEnd":g!=null&&Wi("scrollend",u);break;case"onClick":g!=null&&(u.onclick=kf);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!aS.hasOwnProperty(E))e:{if(E[0]==="o"&&E[1]==="n"&&(y=E.endsWith("Capture"),p=E.slice(2,y?E.length-7:void 0),O=u[go]||null,O=O!=null?O[E]:null,typeof O=="function"&&u.removeEventListener(p,O,y),typeof g=="function")){typeof O!="function"&&O!==null&&(E in u?u[E]=null:u.hasAttribute(E)&&u.removeAttribute(E)),u.addEventListener(p,g,y);break e}E in u?u[E]=g:g===!0?u.setAttribute(E,""):Bi(u,E,g)}}}function Ka(u,p,E){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Wi("error",u),Wi("load",u);var g=!1,y=!1,O;for(O in E)if(E.hasOwnProperty(O)){var H=E[O];if(H!=null)switch(O){case"src":g=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(K(137,p));default:Xr(u,p,O,H,E,null)}}y&&Xr(u,p,"srcSet",E.srcSet,E,null),g&&Xr(u,p,"src",E.src,E,null);return;case"input":Wi("invalid",u);var Z=O=H=y=null,le=null,be=null;for(g in E)if(E.hasOwnProperty(g)){var We=E[g];if(We!=null)switch(g){case"name":y=We;break;case"type":H=We;break;case"checked":le=We;break;case"defaultChecked":be=We;break;case"value":O=We;break;case"defaultValue":Z=We;break;case"children":case"dangerouslySetInnerHTML":if(We!=null)throw Error(K(137,p));break;default:Xr(u,p,g,We,E,null)}}xA(u,O,Z,le,be,H,y,!1),oS(u);return;case"select":Wi("invalid",u),g=H=O=null;for(y in E)if(E.hasOwnProperty(y)&&(Z=E[y],Z!=null))switch(y){case"value":O=Z;break;case"defaultValue":H=Z;break;case"multiple":g=Z;default:Xr(u,p,y,Z,E,null)}p=O,E=H,u.multiple=!!g,p!=null?W_(u,!!g,p,!1):E!=null&&W_(u,!!g,E,!0);return;case"textarea":Wi("invalid",u),O=y=g=null;for(H in E)if(E.hasOwnProperty(H)&&(Z=E[H],Z!=null))switch(H){case"value":g=Z;break;case"defaultValue":y=Z;break;case"children":O=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(K(91));break;default:Xr(u,p,H,Z,E,null)}FA(u,g,y,O),oS(u);return;case"option":for(le in E)if(E.hasOwnProperty(le)&&(g=E[le],g!=null))switch(le){case"selected":u.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Xr(u,p,le,g,E,null)}return;case"dialog":Wi("beforetoggle",u),Wi("toggle",u),Wi("cancel",u),Wi("close",u);break;case"iframe":case"object":Wi("load",u);break;case"video":case"audio":for(g=0;g<jp.length;g++)Wi(jp[g],u);break;case"image":Wi("error",u),Wi("load",u);break;case"details":Wi("toggle",u);break;case"embed":case"source":case"link":Wi("error",u),Wi("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(be in E)if(E.hasOwnProperty(be)&&(g=E[be],g!=null))switch(be){case"children":case"dangerouslySetInnerHTML":throw Error(K(137,p));default:Xr(u,p,be,g,E,null)}return;default:if(fp(p)){for(We in E)E.hasOwnProperty(We)&&(g=E[We],g!==void 0&&by(u,p,We,g,E,void 0));return}}for(Z in E)E.hasOwnProperty(Z)&&(g=E[Z],g!=null&&Xr(u,p,Z,g,E,null))}function oD(u,p,E,g){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,O=null,H=null,Z=null,le=null,be=null,We=null;for(Le in E){var Qe=E[Le];if(E.hasOwnProperty(Le)&&Qe!=null)switch(Le){case"checked":break;case"value":break;case"defaultValue":le=Qe;default:g.hasOwnProperty(Le)||Xr(u,p,Le,null,g,Qe)}}for(var De in g){var Le=g[De];if(Qe=E[De],g.hasOwnProperty(De)&&(Le!=null||Qe!=null))switch(De){case"type":O=Le;break;case"name":y=Le;break;case"checked":be=Le;break;case"defaultChecked":We=Le;break;case"value":H=Le;break;case"defaultValue":Z=Le;break;case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(K(137,p));break;default:Le!==Qe&&Xr(u,p,De,Le,g,Qe)}}_v(u,H,Z,le,be,We,O,y);return;case"select":Le=H=Z=De=null;for(O in E)if(le=E[O],E.hasOwnProperty(O)&&le!=null)switch(O){case"value":break;case"multiple":Le=le;default:g.hasOwnProperty(O)||Xr(u,p,O,null,g,le)}for(y in g)if(O=g[y],le=E[y],g.hasOwnProperty(y)&&(O!=null||le!=null))switch(y){case"value":De=O;break;case"defaultValue":Z=O;break;case"multiple":H=O;default:O!==le&&Xr(u,p,y,O,g,le)}p=Z,E=H,g=Le,De!=null?W_(u,!!E,De,!1):!!g!=!!E&&(p!=null?W_(u,!!E,p,!0):W_(u,!!E,E?[]:"",!1));return;case"textarea":Le=De=null;for(Z in E)if(y=E[Z],E.hasOwnProperty(Z)&&y!=null&&!g.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:Xr(u,p,Z,null,g,y)}for(H in g)if(y=g[H],O=E[H],g.hasOwnProperty(H)&&(y!=null||O!=null))switch(H){case"value":De=y;break;case"defaultValue":Le=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(K(91));break;default:y!==O&&Xr(u,p,H,y,g,O)}VA(u,De,Le);return;case"option":for(var wi in E)if(De=E[wi],E.hasOwnProperty(wi)&&De!=null&&!g.hasOwnProperty(wi))switch(wi){case"selected":u.selected=!1;break;default:Xr(u,p,wi,null,g,De)}for(le in g)if(De=g[le],Le=E[le],g.hasOwnProperty(le)&&De!==Le&&(De!=null||Le!=null))switch(le){case"selected":u.selected=De&&typeof De!="function"&&typeof De!="symbol";break;default:Xr(u,p,le,De,g,Le)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ui in E)De=E[ui],E.hasOwnProperty(ui)&&De!=null&&!g.hasOwnProperty(ui)&&Xr(u,p,ui,null,g,De);for(be in g)if(De=g[be],Le=E[be],g.hasOwnProperty(be)&&De!==Le&&(De!=null||Le!=null))switch(be){case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(K(137,p));break;default:Xr(u,p,be,De,g,Le)}return;default:if(fp(p)){for(var cn in E)De=E[cn],E.hasOwnProperty(cn)&&De!==void 0&&!g.hasOwnProperty(cn)&&by(u,p,cn,void 0,g,De);for(We in g)De=g[We],Le=E[We],!g.hasOwnProperty(We)||De===Le||De===void 0&&Le===void 0||by(u,p,We,De,g,Le);return}}for(var Ce in E)De=E[Ce],E.hasOwnProperty(Ce)&&De!=null&&!g.hasOwnProperty(Ce)&&Xr(u,p,Ce,null,g,De);for(Qe in g)De=g[Qe],Le=E[Qe],!g.hasOwnProperty(Qe)||De===Le||De==null&&Le==null||Xr(u,p,Qe,De,g,Le)}var Ay=null,Su=null;function _T(u){return u.nodeType===9?u:u.ownerDocument}function Tw(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Rw(u,p){if(u===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&p==="foreignObject"?0:u}function Iy(u,p){return u==="textarea"||u==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var wy=null;function cD(){var u=window.event;return u&&u.type==="popstate"?u===wy?!1:(wy=u,!0):(wy=null,!1)}var vw=typeof setTimeout=="function"?setTimeout:void 0,dD=typeof clearTimeout=="function"?clearTimeout:void 0,yw=typeof Promise=="function"?Promise:void 0,lD=typeof queueMicrotask=="function"?queueMicrotask:typeof yw<"u"?function(u){return yw.resolve(null).then(u).catch(uD)}:vw;function uD(u){setTimeout(function(){throw u})}function Vh(u){return u==="head"}function Cw(u,p){var E=p,g=0,y=0;do{var O=E.nextSibling;if(u.removeChild(E),O&&O.nodeType===8)if(E=O.data,E==="/$"){if(0<g&&8>g){E=g;var H=u.ownerDocument;if(E&1&&Om(H.documentElement),E&2&&Om(H.body),E&4)for(E=H.head,Om(E),H=E.firstChild;H;){var Z=H.nextSibling,le=H.nodeName;H[_p]||le==="SCRIPT"||le==="STYLE"||le==="LINK"&&H.rel.toLowerCase()==="stylesheet"||E.removeChild(H),H=Z}}if(y===0){u.removeChild(O),xm(p);return}y--}else E==="$"||E==="$?"||E==="$!"?y++:g=E.charCodeAt(0)-48;else g=0;E=O}while(E);xm(p)}function Oy(u){var p=u.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var E=p;switch(p=p.nextSibling,E.nodeName){case"HTML":case"HEAD":case"BODY":Oy(E),UE(E);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(E.rel.toLowerCase()==="stylesheet")continue}u.removeChild(E)}}function hD(u,p,E,g){for(;u.nodeType===1;){var y=E;if(u.nodeName.toLowerCase()!==p.toLowerCase()){if(!g&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(g){if(!u[_p])switch(p){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(O=u.getAttribute("rel"),O==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(O!==y.rel||u.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||u.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||u.getAttribute("title")!==(y.title==null?null:y.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(O=u.getAttribute("src"),(O!==(y.src==null?null:y.src)||u.getAttribute("type")!==(y.type==null?null:y.type)||u.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&O&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(p==="input"&&u.type==="hidden"){var O=y.name==null?null:""+y.name;if(y.type==="hidden"&&u.getAttribute("name")===O)return u}else return u;if(u=Ed(u.nextSibling),u===null)break}return null}function pD(u,p,E){if(p==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!E||(u=Ed(u.nextSibling),u===null))return null;return u}function wm(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState==="complete"}function _D(u,p){var E=u.ownerDocument;if(u.data!=="$?"||E.readyState==="complete")p();else{var g=function(){p(),E.removeEventListener("DOMContentLoaded",g)};E.addEventListener("DOMContentLoaded",g),u._reactRetry=g}}function Ed(u){for(;u!=null;u=u.nextSibling){var p=u.nodeType;if(p===1||p===3)break;if(p===8){if(p=u.data,p==="$"||p==="$!"||p==="$?"||p==="F!"||p==="F")break;if(p==="/$")return null}}return u}var Ny=null;function bw(u){u=u.previousSibling;for(var p=0;u;){if(u.nodeType===8){var E=u.data;if(E==="$"||E==="$!"||E==="$?"){if(p===0)return u;p--}else E==="/$"&&p++}u=u.previousSibling}return null}function Aw(u,p,E){switch(p=_T(E),u){case"html":if(u=p.documentElement,!u)throw Error(K(452));return u;case"head":if(u=p.head,!u)throw Error(K(453));return u;case"body":if(u=p.body,!u)throw Error(K(454));return u;default:throw Error(K(451))}}function Om(u){for(var p=u.attributes;p.length;)u.removeAttributeNode(p[0]);UE(u)}var kc=new Map,Iw=new Set;function fT(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var Tu=tt.d;tt.d={f:fD,r:ED,D:mD,C:gD,L:SD,m:Dy,X:RD,S:TD,M:vD};function fD(){var u=Tu.f(),p=ol();return u||p}function ED(u){var p=B_(u);p!==null&&p.tag===5&&p.type==="form"?MS(p):Tu.r(u)}var Mf=typeof document>"u"?null:document;function ww(u,p,E){var g=Mf;if(g&&typeof p=="string"&&p){var y=So(p);y='link[rel="'+u+'"][href="'+y+'"]',typeof E=="string"&&(y+='[crossorigin="'+E+'"]'),Iw.has(y)||(Iw.add(y),u={rel:u,crossOrigin:E,href:p},g.querySelector(y)===null&&(p=g.createElement("link"),Ka(p,"link",u),Da(p),g.head.appendChild(p)))}}function mD(u){Tu.D(u),ww("dns-prefetch",u,null)}function gD(u,p){Tu.C(u,p),ww("preconnect",u,p)}function SD(u,p,E){Tu.L(u,p,E);var g=Mf;if(g&&u&&p){var y='link[rel="preload"][as="'+So(p)+'"]';p==="image"&&E&&E.imageSrcSet?(y+='[imagesrcset="'+So(E.imageSrcSet)+'"]',typeof E.imageSizes=="string"&&(y+='[imagesizes="'+So(E.imageSizes)+'"]')):y+='[href="'+So(u)+'"]';var O=y;switch(p){case"style":O=Uf(u);break;case"script":O=Vf(u)}kc.has(O)||(u=Re({rel:"preload",href:p==="image"&&E&&E.imageSrcSet?void 0:u,as:p},E),kc.set(O,u),g.querySelector(y)!==null||p==="style"&&g.querySelector(Wp(O))||p==="script"&&g.querySelector(Nm(O))||(p=g.createElement("link"),Ka(p,"link",u),Da(p),g.head.appendChild(p)))}}function Dy(u,p){Tu.m(u,p);var E=Mf;if(E&&u){var g=p&&typeof p.as=="string"?p.as:"script",y='link[rel="modulepreload"][as="'+So(g)+'"][href="'+So(u)+'"]',O=y;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":O=Vf(u)}if(!kc.has(O)&&(u=Re({rel:"modulepreload",href:u},p),kc.set(O,u),E.querySelector(y)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(E.querySelector(Nm(O)))return}g=E.createElement("link"),Ka(g,"link",u),Da(g),E.head.appendChild(g)}}}function TD(u,p,E){Tu.S(u,p,E);var g=Mf;if(g&&u){var y=ch(g).hoistableStyles,O=Uf(u);p=p||"default";var H=y.get(O);if(!H){var Z={loading:0,preload:null};if(H=g.querySelector(Wp(O)))Z.loading=5;else{u=Re({rel:"stylesheet",href:u,"data-precedence":p},E),(E=kc.get(O))&&Ly(u,E);var le=H=g.createElement("link");Da(le),Ka(le,"link",u),le._p=new Promise(function(be,We){le.onload=be,le.onerror=We}),le.addEventListener("load",function(){Z.loading|=1}),le.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,ET(H,p,g)}H={type:"stylesheet",instance:H,count:1,state:Z},y.set(O,H)}}}function RD(u,p){Tu.X(u,p);var E=Mf;if(E&&u){var g=ch(E).hoistableScripts,y=Vf(u),O=g.get(y);O||(O=E.querySelector(Nm(y)),O||(u=Re({src:u,async:!0},p),(p=kc.get(y))&&ky(u,p),O=E.createElement("script"),Da(O),Ka(O,"link",u),E.head.appendChild(O)),O={type:"script",instance:O,count:1,state:null},g.set(y,O))}}function vD(u,p){Tu.M(u,p);var E=Mf;if(E&&u){var g=ch(E).hoistableScripts,y=Vf(u),O=g.get(y);O||(O=E.querySelector(Nm(y)),O||(u=Re({src:u,async:!0,type:"module"},p),(p=kc.get(y))&&ky(u,p),O=E.createElement("script"),Da(O),Ka(O,"link",u),E.head.appendChild(O)),O={type:"script",instance:O,count:1,state:null},g.set(y,O))}}function Ow(u,p,E,g){var y=(y=xi.current)?fT(y):null;if(!y)throw Error(K(446));switch(u){case"meta":case"title":return null;case"style":return typeof E.precedence=="string"&&typeof E.href=="string"?(p=Uf(E.href),E=ch(y).hoistableStyles,g=E.get(p),g||(g={type:"style",instance:null,count:0,state:null},E.set(p,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(E.rel==="stylesheet"&&typeof E.href=="string"&&typeof E.precedence=="string"){u=Uf(E.href);var O=ch(y).hoistableStyles,H=O.get(u);if(H||(y=y.ownerDocument||y,H={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},O.set(u,H),(O=y.querySelector(Wp(u)))&&!O._p&&(H.instance=O,H.state.loading=5),kc.has(u)||(E={rel:"preload",as:"style",href:E.href,crossOrigin:E.crossOrigin,integrity:E.integrity,media:E.media,hrefLang:E.hrefLang,referrerPolicy:E.referrerPolicy},kc.set(u,E),O||Py(y,u,E,H.state))),p&&g===null)throw Error(K(528,""));return H}if(p&&g!==null)throw Error(K(529,""));return null;case"script":return p=E.async,E=E.src,typeof E=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=Vf(E),E=ch(y).hoistableScripts,g=E.get(p),g||(g={type:"script",instance:null,count:0,state:null},E.set(p,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(K(444,u))}}function Uf(u){return'href="'+So(u)+'"'}function Wp(u){return'link[rel="stylesheet"]['+u+"]"}function xf(u){return Re({},u,{"data-precedence":u.precedence,precedence:null})}function Py(u,p,E,g){u.querySelector('link[rel="preload"][as="style"]['+p+"]")?g.loading=1:(p=u.createElement("link"),g.preload=p,p.addEventListener("load",function(){return g.loading|=1}),p.addEventListener("error",function(){return g.loading|=2}),Ka(p,"link",E),Da(p),u.head.appendChild(p))}function Vf(u){return'[src="'+So(u)+'"]'}function Nm(u){return"script[async]"+u}function Ff(u,p,E){if(p.count++,p.instance===null)switch(p.type){case"style":var g=u.querySelector('style[data-href~="'+So(E.href)+'"]');if(g)return p.instance=g,Da(g),g;var y=Re({},E,{"data-href":E.href,"data-precedence":E.precedence,href:null,precedence:null});return g=(u.ownerDocument||u).createElement("style"),Da(g),Ka(g,"style",y),ET(g,E.precedence,u),p.instance=g;case"stylesheet":y=Uf(E.href);var O=u.querySelector(Wp(y));if(O)return p.state.loading|=4,p.instance=O,Da(O),O;g=xf(E),(y=kc.get(y))&&Ly(g,y),O=(u.ownerDocument||u).createElement("link"),Da(O);var H=O;return H._p=new Promise(function(Z,le){H.onload=Z,H.onerror=le}),Ka(O,"link",g),p.state.loading|=4,ET(O,E.precedence,u),p.instance=O;case"script":return O=Vf(E.src),(y=u.querySelector(Nm(O)))?(p.instance=y,Da(y),y):(g=E,(y=kc.get(O))&&(g=Re({},E),ky(g,y)),u=u.ownerDocument||u,y=u.createElement("script"),Da(y),Ka(y,"link",g),u.head.appendChild(y),p.instance=y);case"void":return null;default:throw Error(K(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(g=p.instance,p.state.loading|=4,ET(g,E.precedence,u));return p.instance}function ET(u,p,E){for(var g=E.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=g.length?g[g.length-1]:null,O=y,H=0;H<g.length;H++){var Z=g[H];if(Z.dataset.precedence===p)O=Z;else if(O!==y)break}O?O.parentNode.insertBefore(u,O.nextSibling):(p=E.nodeType===9?E.head:E,p.insertBefore(u,p.firstChild))}function Ly(u,p){u.crossOrigin==null&&(u.crossOrigin=p.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=p.referrerPolicy),u.title==null&&(u.title=p.title)}function ky(u,p){u.crossOrigin==null&&(u.crossOrigin=p.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=p.referrerPolicy),u.integrity==null&&(u.integrity=p.integrity)}var mT=null;function gT(u,p,E){if(mT===null){var g=new Map,y=mT=new Map;y.set(E,g)}else y=mT,g=y.get(E),g||(g=new Map,y.set(E,g));if(g.has(u))return g;for(g.set(u,null),E=E.getElementsByTagName(u),y=0;y<E.length;y++){var O=E[y];if(!(O[_p]||O[Ls]||u==="link"&&O.getAttribute("rel")==="stylesheet")&&O.namespaceURI!=="http://www.w3.org/2000/svg"){var H=O.getAttribute(p)||"";H=u+H;var Z=g.get(H);Z?Z.push(O):g.set(H,[O])}}return g}function Nw(u,p,E){u=u.ownerDocument||u,u.head.insertBefore(E,p==="title"?u.querySelector("head > title"):null)}function Dm(u,p,E){if(E===1||p.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return u=p.disabled,typeof p.precedence=="string"&&u==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function Dw(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}var Pm=null;function yD(){}function CD(u,p,E){if(Pm===null)throw Error(K(475));var g=Pm;if(p.type==="stylesheet"&&(typeof E.media!="string"||matchMedia(E.media).matches!==!1)&&(p.state.loading&4)===0){if(p.instance===null){var y=Uf(E.href),O=u.querySelector(Wp(y));if(O){u=O._p,u!==null&&typeof u=="object"&&typeof u.then=="function"&&(g.count++,g=ST.bind(g),u.then(g,g)),p.state.loading|=4,p.instance=O,Da(O);return}O=u.ownerDocument||u,E=xf(E),(y=kc.get(y))&&Ly(E,y),O=O.createElement("link"),Da(O);var H=O;H._p=new Promise(function(Z,le){H.onload=Z,H.onerror=le}),Ka(O,"link",E),p.instance=O}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(p,u),(u=p.state.preload)&&(p.state.loading&3)===0&&(g.count++,p=ST.bind(g),u.addEventListener("load",p),u.addEventListener("error",p))}}function My(){if(Pm===null)throw Error(K(475));var u=Pm;return u.stylesheets&&u.count===0&&Hp(u,u.stylesheets),0<u.count?function(p){var E=setTimeout(function(){if(u.stylesheets&&Hp(u,u.stylesheets),u.unsuspend){var g=u.unsuspend;u.unsuspend=null,g()}},6e4);return u.unsuspend=p,function(){u.unsuspend=null,clearTimeout(E)}}:null}function ST(){if(this.count--,this.count===0){if(this.stylesheets)Hp(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var Bf=null;function Hp(u,p){u.stylesheets=null,u.unsuspend!==null&&(u.count++,Bf=new Map,p.forEach(bD,u),Bf=null,ST.call(u))}function bD(u,p){if(!(p.state.loading&4)){var E=Bf.get(u);if(E)var g=E.get(null);else{E=new Map,Bf.set(u,E);for(var y=u.querySelectorAll("link[data-precedence],style[data-precedence]"),O=0;O<y.length;O++){var H=y[O];(H.nodeName==="LINK"||H.getAttribute("media")!=="not all")&&(E.set(H.dataset.precedence,H),g=H)}g&&E.set(null,g)}y=p.instance,H=y.getAttribute("data-precedence"),O=E.get(H)||g,O===g&&E.set(null,y),E.set(H,y),this.count++,g=ST.bind(this),y.addEventListener("load",g),y.addEventListener("error",g),O?O.parentNode.insertBefore(y,O.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(y,u.firstChild)),p.state.loading|=4}}var Lm={$$typeof:kt,Provider:null,Consumer:null,_currentValue:ni,_currentValue2:ni,_threadCount:0};function Uy(u,p,E,g,y,O,H,Z){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ov(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ov(0),this.hiddenUpdates=ov(null),this.identifierPrefix=g,this.onUncaughtError=y,this.onCaughtError=O,this.onRecoverableError=H,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Z,this.incompleteTransitions=new Map}function Pw(u,p,E,g,y,O,H,Z,le,be,We,Qe){return u=new Uy(u,p,E,H,Z,le,be,Qe),p=1,O===!0&&(p|=24),O=Zo(3,null,null,p),u.current=O,O.stateNode=u,p=bp(),p.refCount++,u.pooledCache=p,p.refCount++,O.memoizedState={element:g,isDehydrated:E,cache:p},im(O),u}function TT(u){return u?(u=Ic,u):Ic}function RT(u,p,E,g,y,O){y=TT(y),g.context===null?g.context=y:g.pendingContext=y,g=_h(p),g.payload={element:E},O=O===void 0?null:O,O!==null&&(g.callback=O),E=$d(u,g,p),E!==null&&($s(E,u,p),rm(E,u,p))}function Lw(u,p){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var E=u.retryLane;u.retryLane=E!==0&&E<p?E:p}}function xy(u,p){Lw(u,p),(u=u.alternate)&&Lw(u,p)}function kw(u){if(u.tag===13){var p=$_(u,67108864);p!==null&&$s(p,u,67108864),xy(u,67108864)}}var vT=!0;function AD(u,p,E,g){var y=je.T;je.T=null;var O=tt.p;try{tt.p=2,km(u,p,E,g)}finally{tt.p=O,je.T=y}}function ID(u,p,E,g){var y=je.T;je.T=null;var O=tt.p;try{tt.p=8,km(u,p,E,g)}finally{tt.p=O,je.T=y}}function km(u,p,E,g){if(vT){var y=Kp(g);if(y===null)Im(u,p,g,jf,E),yT(u,g);else if(Fy(y,u,p,E,g))g.stopPropagation();else if(yT(u,g),p&4&&-1<tn.indexOf(u)){for(;y!==null;){var O=B_(y);if(O!==null)switch(O.tag){case 3:if(O=O.stateNode,O.current.memoizedState.isDehydrated){var H=Bl(O.pendingLanes);if(H!==0){var Z=O;for(Z.pendingLanes|=2,Z.entangledLanes|=2;H;){var le=1<<31-fs(H);Z.entanglements[1]|=le,H&=~le}No(O),(Or&6)===0&&(kh=Yd()+500,vm(0))}}break;case 13:Z=$_(O,2),Z!==null&&$s(Z,O,2),ol(),xy(O,2)}if(O=Kp(g),O===null&&Im(u,p,g,jf,E),O===y)break;y=O}y!==null&&g.stopPropagation()}else Im(u,p,g,null,E)}}function Kp(u){return u=Sv(u),se(u)}var jf=null;function se(u){if(jf=null,u=F_(u),u!==null){var p=re(u);if(p===null)u=null;else{var E=p.tag;if(E===13){if(u=pe(p),u!==null)return u;u=null}else if(E===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;u=null}else p!==u&&(u=null)}}return jf=u,null}function Mw(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ir()){case bn:return 2;case x_:return 8;case oh:case cN:return 32;case iS:return 268435456;default:return 32}default:return 32}}var Vy=!1,Fh=null,Bh=null,jh=null,Ru=new Map,Mm=new Map,Gh=[],tn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yT(u,p){switch(u){case"focusin":case"focusout":Fh=null;break;case"dragenter":case"dragleave":Bh=null;break;case"mouseover":case"mouseout":jh=null;break;case"pointerover":case"pointerout":Ru.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mm.delete(p.pointerId)}}function Um(u,p,E,g,y,O){return u===null||u.nativeEvent!==O?(u={blockedOn:p,domEventName:E,eventSystemFlags:g,nativeEvent:O,targetContainers:[y]},p!==null&&(p=B_(p),p!==null&&kw(p)),u):(u.eventSystemFlags|=g,p=u.targetContainers,y!==null&&p.indexOf(y)===-1&&p.push(y),u)}function Fy(u,p,E,g,y){switch(p){case"focusin":return Fh=Um(Fh,u,p,E,g,y),!0;case"dragenter":return Bh=Um(Bh,u,p,E,g,y),!0;case"mouseover":return jh=Um(jh,u,p,E,g,y),!0;case"pointerover":var O=y.pointerId;return Ru.set(O,Um(Ru.get(O)||null,u,p,E,g,y)),!0;case"gotpointercapture":return O=y.pointerId,Mm.set(O,Um(Mm.get(O)||null,u,p,E,g,y)),!0}return!1}function Uw(u){var p=F_(u.target);if(p!==null){var E=re(p);if(E!==null){if(p=E.tag,p===13){if(p=pe(E),p!==null){u.blockedOn=p,lN(u.priority,function(){if(E.tag===13){var g=nc();g=qo(g);var y=$_(E,g);y!==null&&$s(y,E,g),xy(E,g)}});return}}else if(p===3&&E.stateNode.current.memoizedState.isDehydrated){u.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}u.blockedOn=null}function Wh(u){if(u.blockedOn!==null)return!1;for(var p=u.targetContainers;0<p.length;){var E=Kp(u.nativeEvent);if(E===null){E=u.nativeEvent;var g=new E.constructor(E.type,E);gv=g,E.target.dispatchEvent(g),gv=null}else return p=B_(E),p!==null&&kw(p),u.blockedOn=E,!1;p.shift()}return!0}function CT(u,p,E){Wh(u)&&E.delete(p)}function By(){Vy=!1,Fh!==null&&Wh(Fh)&&(Fh=null),Bh!==null&&Wh(Bh)&&(Bh=null),jh!==null&&Wh(jh)&&(jh=null),Ru.forEach(CT),Mm.forEach(CT)}function bT(u,p){u.blockedOn===p&&(u.blockedOn=null,Vy||(Vy=!0,x.unstable_scheduleCallback(x.unstable_NormalPriority,By)))}var AT=null;function IT(u){AT!==u&&(AT=u,x.unstable_scheduleCallback(x.unstable_NormalPriority,function(){AT===u&&(AT=null);for(var p=0;p<u.length;p+=3){var E=u[p],g=u[p+1],y=u[p+2];if(typeof g!="function"){if(se(g||E)===null)continue;break}var O=B_(E);O!==null&&(u.splice(p,3),p-=3,cu(O,{pending:!0,data:y,method:E.method,action:g},g,y))}}))}function xm(u){function p(le){return bT(le,u)}Fh!==null&&bT(Fh,u),Bh!==null&&bT(Bh,u),jh!==null&&bT(jh,u),Ru.forEach(p),Mm.forEach(p);for(var E=0;E<Gh.length;E++){var g=Gh[E];g.blockedOn===u&&(g.blockedOn=null)}for(;0<Gh.length&&(E=Gh[0],E.blockedOn===null);)Uw(E),E.blockedOn===null&&Gh.shift();if(E=(u.ownerDocument||u).$$reactFormReplay,E!=null)for(g=0;g<E.length;g+=3){var y=E[g],O=E[g+1],H=y[go]||null;if(typeof O=="function")H||IT(E);else if(H){var Z=null;if(O&&O.hasAttribute("formAction")){if(y=O,H=O[go]||null)Z=H.formAction;else if(se(y)!==null)continue}else Z=H.action;typeof Z=="function"?E[g+1]=Z:(E.splice(g,3),g-=3),IT(E)}}}function jy(u){this._internalRoot=u}Gf.prototype.render=jy.prototype.render=function(u){var p=this._internalRoot;if(p===null)throw Error(K(409));var E=p.current,g=nc();RT(E,g,u,p,null,null)},Gf.prototype.unmount=jy.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var p=u.containerInfo;RT(u.current,2,null,u,null,null),ol(),p[vc]=null}};function Gf(u){this._internalRoot=u}Gf.prototype.unstable_scheduleHydration=function(u){if(u){var p=PA();u={blockedOn:null,target:u,priority:p};for(var E=0;E<Gh.length&&p!==0&&p<Gh[E].priority;E++);Gh.splice(E,0,u),E===0&&Uw(u)}};var xw=Y.version;if(xw!=="19.1.1")throw Error(K(527,xw,"19.1.1"));tt.findDOMNode=function(u){var p=u._reactInternals;if(p===void 0)throw typeof u.render=="function"?Error(K(188)):(u=Object.keys(u).join(","),Error(K(268,u)));return u=ge(p),u=u!==null?de(u):null,u=u===null?null:u.stateNode,u};var wD={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:je,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wf.isDisabled&&Wf.supportsFiber)try{pp=Wf.inject(wD),$r=Wf}catch{}}return YV.createRoot=function(u,p){if(!X(u))throw Error(K(299));var E=!1,g="",y=HI,O=KI,H=YI,Z=null;return p!=null&&(p.unstable_strictMode===!0&&(E=!0),p.identifierPrefix!==void 0&&(g=p.identifierPrefix),p.onUncaughtError!==void 0&&(y=p.onUncaughtError),p.onCaughtError!==void 0&&(O=p.onCaughtError),p.onRecoverableError!==void 0&&(H=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(Z=p.unstable_transitionCallbacks)),p=Pw(u,1,!1,null,null,E,g,y,O,H,Z,null),u[vc]=p.current,Am(u),new jy(p)},YV.hydrateRoot=function(u,p,E){if(!X(u))throw Error(K(299));var g=!1,y="",O=HI,H=KI,Z=YI,le=null,be=null;return E!=null&&(E.unstable_strictMode===!0&&(g=!0),E.identifierPrefix!==void 0&&(y=E.identifierPrefix),E.onUncaughtError!==void 0&&(O=E.onUncaughtError),E.onCaughtError!==void 0&&(H=E.onCaughtError),E.onRecoverableError!==void 0&&(Z=E.onRecoverableError),E.unstable_transitionCallbacks!==void 0&&(le=E.unstable_transitionCallbacks),E.formState!==void 0&&(be=E.formState)),p=Pw(u,1,!0,p,E??null,g,y,O,H,Z,le,be),p.context=TT(null),E=p.current,g=nc(),g=qo(g),y=_h(g),y.callback=null,$d(E,y,g),E=g,p.current.lanes=E,kE(p,E),No(p),u[vc]=p.current,Am(u),new Gf(p)},YV.version="19.1.1",YV}var p8;function mK(){if(p8)return L3.exports;p8=1;function x(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(x)}catch(Y){console.error(Y)}}return x(),L3.exports=EK(),L3.exports}var gK=mK();const SK=W3(gK);/**
 * react-router v7.9.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var _8="popstate";function TK(x={}){function Y(K,X){let{pathname:re,search:pe,hash:Pe}=K.location;return F3("",{pathname:re,search:pe,hash:Pe},X.state&&X.state.usr||null,X.state&&X.state.key||"default")}function q(K,X){return typeof X=="string"?X:JV(X)}return vK(Y,q,null,x)}function es(x,Y){if(x===!1||x===null||typeof x>"u")throw new Error(Y)}function NE(x,Y){if(!x){typeof console<"u"&&console.warn(Y);try{throw new Error(Y)}catch{}}}function RK(){return Math.random().toString(36).substring(2,10)}function f8(x,Y){return{usr:x.state,key:x.key,idx:Y}}function F3(x,Y,q=null,K){return{pathname:typeof x=="string"?x:x.pathname,search:"",hash:"",...typeof Y=="string"?nN(Y):Y,state:q,key:Y&&Y.key||K||RK()}}function JV({pathname:x="/",search:Y="",hash:q=""}){return Y&&Y!=="?"&&(x+=Y.charAt(0)==="?"?Y:"?"+Y),q&&q!=="#"&&(x+=q.charAt(0)==="#"?q:"#"+q),x}function nN(x){let Y={};if(x){let q=x.indexOf("#");q>=0&&(Y.hash=x.substring(q),x=x.substring(0,q));let K=x.indexOf("?");K>=0&&(Y.search=x.substring(K),x=x.substring(0,K)),x&&(Y.pathname=x)}return Y}function vK(x,Y,q,K={}){let{window:X=document.defaultView,v5Compat:re=!1}=K,pe=X.history,Pe="POP",ge=null,de=Re();de==null&&(de=0,pe.replaceState({...pe.state,idx:de},""));function Re(){return(pe.state||{idx:null}).idx}function ye(){Pe="POP";let Fe=Re(),ht=Fe==null?null:Fe-de;de=Fe,ge&&ge({action:Pe,location:Ve.location,delta:ht})}function Be(Fe,ht){Pe="PUSH";let At=F3(Ve.location,Fe,ht);de=Re()+1;let kt=f8(At,de),Ar=Ve.createHref(At);try{pe.pushState(kt,"",Ar)}catch(oi){if(oi instanceof DOMException&&oi.name==="DataCloneError")throw oi;X.location.assign(Ar)}re&&ge&&ge({action:Pe,location:Ve.location,delta:1})}function ct(Fe,ht){Pe="REPLACE";let At=F3(Ve.location,Fe,ht);de=Re();let kt=f8(At,de),Ar=Ve.createHref(At);pe.replaceState(kt,"",Ar),re&&ge&&ge({action:Pe,location:Ve.location,delta:0})}function ke(Fe){return yK(Fe)}let Ve={get action(){return Pe},get location(){return x(X,pe)},listen(Fe){if(ge)throw new Error("A history only accepts one active listener");return X.addEventListener(_8,ye),ge=Fe,()=>{X.removeEventListener(_8,ye),ge=null}},createHref(Fe){return Y(X,Fe)},createURL:ke,encodeLocation(Fe){let ht=ke(Fe);return{pathname:ht.pathname,search:ht.search,hash:ht.hash}},push:Be,replace:ct,go(Fe){return pe.go(Fe)}};return Ve}function yK(x,Y=!1){let q="http://localhost";typeof window<"u"&&(q=window.location.origin!=="null"?window.location.origin:window.location.href),es(q,"No window.location.(origin|href) available to create URL");let K=typeof x=="string"?x:JV(x);return K=K.replace(/ $/,"%20"),!Y&&K.startsWith("//")&&(K=q+K),new URL(K,q)}function v8(x,Y,q="/"){return CK(x,Y,q,!1)}function CK(x,Y,q,K){let X=typeof Y=="string"?nN(Y):Y,re=eS(X.pathname||"/",q);if(re==null)return null;let pe=y8(x);bK(pe);let Pe=null;for(let ge=0;Pe==null&&ge<pe.length;++ge){let de=UK(re);Pe=kK(pe[ge],de,K)}return Pe}function y8(x,Y=[],q=[],K="",X=!1){let re=(pe,Pe,ge=X,de)=>{let Re={relativePath:de===void 0?pe.path||"":de,caseSensitive:pe.caseSensitive===!0,childrenIndex:Pe,route:pe};if(Re.relativePath.startsWith("/")){if(!Re.relativePath.startsWith(K)&&ge)return;es(Re.relativePath.startsWith(K),`Absolute route path "${Re.relativePath}" nested under path "${K}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),Re.relativePath=Re.relativePath.slice(K.length)}let ye=$g([K,Re.relativePath]),Be=q.concat(Re);pe.children&&pe.children.length>0&&(es(pe.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${ye}".`),y8(pe.children,Y,Be,ye,ge)),!(pe.path==null&&!pe.index)&&Y.push({path:ye,score:PK(ye,pe.index),routesMeta:Be})};return x.forEach((pe,Pe)=>{if(pe.path===""||!pe.path?.includes("?"))re(pe,Pe);else for(let ge of C8(pe.path))re(pe,Pe,!0,ge)}),Y}function C8(x){let Y=x.split("/");if(Y.length===0)return[];let[q,...K]=Y,X=q.endsWith("?"),re=q.replace(/\?$/,"");if(K.length===0)return X?[re,""]:[re];let pe=C8(K.join("/")),Pe=[];return Pe.push(...pe.map(ge=>ge===""?re:[re,ge].join("/"))),X&&Pe.push(...pe),Pe.map(ge=>x.startsWith("/")&&ge===""?"/":ge)}function bK(x){x.sort((Y,q)=>Y.score!==q.score?q.score-Y.score:LK(Y.routesMeta.map(K=>K.childrenIndex),q.routesMeta.map(K=>K.childrenIndex)))}var AK=/^:[\w-]+$/,IK=3,wK=2,OK=1,NK=10,DK=-2,E8=x=>x==="*";function PK(x,Y){let q=x.split("/"),K=q.length;return q.some(E8)&&(K+=DK),Y&&(K+=wK),q.filter(X=>!E8(X)).reduce((X,re)=>X+(AK.test(re)?IK:re===""?OK:NK),K)}function LK(x,Y){return x.length===Y.length&&x.slice(0,-1).every((K,X)=>K===Y[X])?x[x.length-1]-Y[Y.length-1]:0}function kK(x,Y,q=!1){let{routesMeta:K}=x,X={},re="/",pe=[];for(let Pe=0;Pe<K.length;++Pe){let ge=K[Pe],de=Pe===K.length-1,Re=re==="/"?Y:Y.slice(re.length)||"/",ye=rG({path:ge.relativePath,caseSensitive:ge.caseSensitive,end:de},Re),Be=ge.route;if(!ye&&de&&q&&!K[K.length-1].route.index&&(ye=rG({path:ge.relativePath,caseSensitive:ge.caseSensitive,end:!1},Re)),!ye)return null;Object.assign(X,ye.params),pe.push({params:X,pathname:$g([re,ye.pathname]),pathnameBase:BK($g([re,ye.pathnameBase])),route:Be}),ye.pathnameBase!=="/"&&(re=$g([re,ye.pathnameBase]))}return pe}function rG(x,Y){typeof x=="string"&&(x={path:x,caseSensitive:!1,end:!0});let[q,K]=MK(x.path,x.caseSensitive,x.end),X=Y.match(q);if(!X)return null;let re=X[0],pe=re.replace(/(.)\/+$/,"$1"),Pe=X.slice(1);return{params:K.reduce((de,{paramName:Re,isOptional:ye},Be)=>{if(Re==="*"){let ke=Pe[Be]||"";pe=re.slice(0,re.length-ke.length).replace(/(.)\/+$/,"$1")}const ct=Pe[Be];return ye&&!ct?de[Re]=void 0:de[Re]=(ct||"").replace(/%2F/g,"/"),de},{}),pathname:re,pathnameBase:pe,pattern:x}}function MK(x,Y=!1,q=!0){NE(x==="*"||!x.endsWith("*")||x.endsWith("/*"),`Route path "${x}" will be treated as if it were "${x.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${x.replace(/\*$/,"/*")}".`);let K=[],X="^"+x.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(pe,Pe,ge)=>(K.push({paramName:Pe,isOptional:ge!=null}),ge?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return x.endsWith("*")?(K.push({paramName:"*"}),X+=x==="*"||x==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):q?X+="\\/*$":x!==""&&x!=="/"&&(X+="(?:(?=\\/|$))"),[new RegExp(X,Y?void 0:"i"),K]}function UK(x){try{return x.split("/").map(Y=>decodeURIComponent(Y).replace(/\//g,"%2F")).join("/")}catch(Y){return NE(!1,`The URL path "${x}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${Y}).`),x}}function eS(x,Y){if(Y==="/")return x;if(!x.toLowerCase().startsWith(Y.toLowerCase()))return null;let q=Y.endsWith("/")?Y.length-1:Y.length,K=x.charAt(q);return K&&K!=="/"?null:x.slice(q)||"/"}function xK(x,Y="/"){let{pathname:q,search:K="",hash:X=""}=typeof x=="string"?nN(x):x;return{pathname:q?q.startsWith("/")?q:VK(q,Y):Y,search:jK(K),hash:GK(X)}}function VK(x,Y){let q=Y.replace(/\/+$/,"").split("/");return x.split("/").forEach(X=>{X===".."?q.length>1&&q.pop():X!=="."&&q.push(X)}),q.length>1?q.join("/"):"/"}function x3(x,Y,q,K){return`Cannot include a '${x}' character in a manually specified \`to.${Y}\` field [${JSON.stringify(K)}].  Please separate it out to the \`to.${q}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function FK(x){return x.filter((Y,q)=>q===0||Y.route.path&&Y.route.path.length>0)}function b8(x){let Y=FK(x);return Y.map((q,K)=>K===Y.length-1?q.pathname:q.pathnameBase)}function A8(x,Y,q,K=!1){let X;typeof x=="string"?X=nN(x):(X={...x},es(!X.pathname||!X.pathname.includes("?"),x3("?","pathname","search",X)),es(!X.pathname||!X.pathname.includes("#"),x3("#","pathname","hash",X)),es(!X.search||!X.search.includes("#"),x3("#","search","hash",X)));let re=x===""||X.pathname==="",pe=re?"/":X.pathname,Pe;if(pe==null)Pe=q;else{let ye=Y.length-1;if(!K&&pe.startsWith("..")){let Be=pe.split("/");for(;Be[0]==="..";)Be.shift(),ye-=1;X.pathname=Be.join("/")}Pe=ye>=0?Y[ye]:"/"}let ge=xK(X,Pe),de=pe&&pe!=="/"&&pe.endsWith("/"),Re=(re||pe===".")&&q.endsWith("/");return!ge.pathname.endsWith("/")&&(de||Re)&&(ge.pathname+="/"),ge}var $g=x=>x.join("/").replace(/\/\/+/g,"/"),BK=x=>x.replace(/\/+$/,"").replace(/^\/*/,"/"),jK=x=>!x||x==="?"?"":x.startsWith("?")?x:"?"+x,GK=x=>!x||x==="#"?"":x.startsWith("#")?x:"#"+x;function WK(x){return x!=null&&typeof x.status=="number"&&typeof x.statusText=="string"&&typeof x.internal=="boolean"&&"data"in x}var I8=["POST","PUT","PATCH","DELETE"];new Set(I8);var HK=["GET",...I8];new Set(HK);var aN=ve.createContext(null);aN.displayName="DataRouter";var nG=ve.createContext(null);nG.displayName="DataRouterState";ve.createContext(!1);var w8=ve.createContext({isTransitioning:!1});w8.displayName="ViewTransition";var KK=ve.createContext(new Map);KK.displayName="Fetchers";var YK=ve.createContext(null);YK.displayName="Await";var DE=ve.createContext(null);DE.displayName="Navigation";var ZV=ve.createContext(null);ZV.displayName="Location";var PE=ve.createContext({outlet:null,matches:[],isDataRoute:!1});PE.displayName="Route";var K3=ve.createContext(null);K3.displayName="RouteError";function zK(x,{relative:Y}={}){es(QV(),"useHref() may be used only in the context of a <Router> component.");let{basename:q,navigator:K}=ve.useContext(DE),{hash:X,pathname:re,search:pe}=$V(x,{relative:Y}),Pe=re;return q!=="/"&&(Pe=re==="/"?q:$g([q,re])),K.createHref({pathname:Pe,search:pe,hash:X})}function QV(){return ve.useContext(ZV)!=null}function bA(){return es(QV(),"useLocation() may be used only in the context of a <Router> component."),ve.useContext(ZV).location}var O8="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function N8(x){ve.useContext(DE).static||ve.useLayoutEffect(x)}function Y3(){let{isDataRoute:x}=ve.useContext(PE);return x?oY():qK()}function qK(){es(QV(),"useNavigate() may be used only in the context of a <Router> component.");let x=ve.useContext(aN),{basename:Y,navigator:q}=ve.useContext(DE),{matches:K}=ve.useContext(PE),{pathname:X}=bA(),re=JSON.stringify(b8(K)),pe=ve.useRef(!1);return N8(()=>{pe.current=!0}),ve.useCallback((ge,de={})=>{if(NE(pe.current,O8),!pe.current)return;if(typeof ge=="number"){q.go(ge);return}let Re=A8(ge,JSON.parse(re),X,de.relative==="path");x==null&&Y!=="/"&&(Re.pathname=Re.pathname==="/"?Y:$g([Y,Re.pathname])),(de.replace?q.replace:q.push)(Re,de.state,de)},[Y,q,re,X,x])}ve.createContext(null);function XK(){let{matches:x}=ve.useContext(PE),Y=x[x.length-1];return Y?Y.params:{}}function $V(x,{relative:Y}={}){let{matches:q}=ve.useContext(PE),{pathname:K}=bA(),X=JSON.stringify(b8(q));return ve.useMemo(()=>A8(x,JSON.parse(X),K,Y==="path"),[x,X,K,Y])}function JK(x,Y){return D8(x,Y)}function D8(x,Y,q,K,X){es(QV(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:re}=ve.useContext(DE),{matches:pe}=ve.useContext(PE),Pe=pe[pe.length-1],ge=Pe?Pe.params:{},de=Pe?Pe.pathname:"/",Re=Pe?Pe.pathnameBase:"/",ye=Pe&&Pe.route;{let At=ye&&ye.path||"";P8(de,!ye||At.endsWith("*")||At.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${de}" (under <Route path="${At}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${At}"> to <Route path="${At==="/"?"*":`${At}/*`}">.`)}let Be=bA(),ct;if(Y){let At=typeof Y=="string"?nN(Y):Y;es(Re==="/"||At.pathname?.startsWith(Re),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${Re}" but pathname "${At.pathname}" was given in the \`location\` prop.`),ct=At}else ct=Be;let ke=ct.pathname||"/",Ve=ke;if(Re!=="/"){let At=Re.replace(/^\//,"").split("/");Ve="/"+ke.replace(/^\//,"").split("/").slice(At.length).join("/")}let Fe=v8(x,{pathname:Ve});NE(ye||Fe!=null,`No routes matched location "${ct.pathname}${ct.search}${ct.hash}" `),NE(Fe==null||Fe[Fe.length-1].route.element!==void 0||Fe[Fe.length-1].route.Component!==void 0||Fe[Fe.length-1].route.lazy!==void 0,`Matched leaf route at location "${ct.pathname}${ct.search}${ct.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ht=tY(Fe&&Fe.map(At=>Object.assign({},At,{params:Object.assign({},ge,At.params),pathname:$g([Re,re.encodeLocation?re.encodeLocation(At.pathname).pathname:At.pathname]),pathnameBase:At.pathnameBase==="/"?Re:$g([Re,re.encodeLocation?re.encodeLocation(At.pathnameBase).pathname:At.pathnameBase])})),pe,q,K,X);return Y&&ht?ve.createElement(ZV.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ct},navigationType:"POP"}},ht):ht}function ZK(){let x=sY(),Y=WK(x)?`${x.status} ${x.statusText}`:x instanceof Error?x.message:JSON.stringify(x),q=x instanceof Error?x.stack:null,K="rgba(200,200,200, 0.5)",X={padding:"0.5rem",backgroundColor:K},re={padding:"2px 4px",backgroundColor:K},pe=null;return console.error("Error handled by React Router default ErrorBoundary:",x),pe=ve.createElement(ve.Fragment,null,ve.createElement("p",null,"💿 Hey developer 👋"),ve.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ve.createElement("code",{style:re},"ErrorBoundary")," or"," ",ve.createElement("code",{style:re},"errorElement")," prop on your route.")),ve.createElement(ve.Fragment,null,ve.createElement("h2",null,"Unexpected Application Error!"),ve.createElement("h3",{style:{fontStyle:"italic"}},Y),q?ve.createElement("pre",{style:X},q):null,pe)}var QK=ve.createElement(ZK,null),$K=class extends ve.Component{constructor(x){super(x),this.state={location:x.location,revalidation:x.revalidation,error:x.error}}static getDerivedStateFromError(x){return{error:x}}static getDerivedStateFromProps(x,Y){return Y.location!==x.location||Y.revalidation!=="idle"&&x.revalidation==="idle"?{error:x.error,location:x.location,revalidation:x.revalidation}:{error:x.error!==void 0?x.error:Y.error,location:Y.location,revalidation:x.revalidation||Y.revalidation}}componentDidCatch(x,Y){this.props.unstable_onError?this.props.unstable_onError(x,Y):console.error("React Router caught the following error during render",x)}render(){return this.state.error!==void 0?ve.createElement(PE.Provider,{value:this.props.routeContext},ve.createElement(K3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function eY({routeContext:x,match:Y,children:q}){let K=ve.useContext(aN);return K&&K.static&&K.staticContext&&(Y.route.errorElement||Y.route.ErrorBoundary)&&(K.staticContext._deepestRenderedBoundaryId=Y.route.id),ve.createElement(PE.Provider,{value:x},q)}function tY(x,Y=[],q=null,K=null,X=null){if(x==null){if(!q)return null;if(q.errors)x=q.matches;else if(Y.length===0&&!q.initialized&&q.matches.length>0)x=q.matches;else return null}let re=x,pe=q?.errors;if(pe!=null){let de=re.findIndex(Re=>Re.route.id&&pe?.[Re.route.id]!==void 0);es(de>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(pe).join(",")}`),re=re.slice(0,Math.min(re.length,de+1))}let Pe=!1,ge=-1;if(q)for(let de=0;de<re.length;de++){let Re=re[de];if((Re.route.HydrateFallback||Re.route.hydrateFallbackElement)&&(ge=de),Re.route.id){let{loaderData:ye,errors:Be}=q,ct=Re.route.loader&&!ye.hasOwnProperty(Re.route.id)&&(!Be||Be[Re.route.id]===void 0);if(Re.route.lazy||ct){Pe=!0,ge>=0?re=re.slice(0,ge+1):re=[re[0]];break}}}return re.reduceRight((de,Re,ye)=>{let Be,ct=!1,ke=null,Ve=null;q&&(Be=pe&&Re.route.id?pe[Re.route.id]:void 0,ke=Re.route.errorElement||QK,Pe&&(ge<0&&ye===0?(P8("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),ct=!0,Ve=null):ge===ye&&(ct=!0,Ve=Re.route.hydrateFallbackElement||null)));let Fe=Y.concat(re.slice(0,ye+1)),ht=()=>{let At;return Be?At=ke:ct?At=Ve:Re.route.Component?At=ve.createElement(Re.route.Component,null):Re.route.element?At=Re.route.element:At=de,ve.createElement(eY,{match:Re,routeContext:{outlet:de,matches:Fe,isDataRoute:q!=null},children:At})};return q&&(Re.route.ErrorBoundary||Re.route.errorElement||ye===0)?ve.createElement($K,{location:q.location,revalidation:q.revalidation,component:ke,error:Be,children:ht(),routeContext:{outlet:null,matches:Fe,isDataRoute:!0},unstable_onError:K}):ht()},null)}function z3(x){return`${x} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function iY(x){let Y=ve.useContext(aN);return es(Y,z3(x)),Y}function rY(x){let Y=ve.useContext(nG);return es(Y,z3(x)),Y}function nY(x){let Y=ve.useContext(PE);return es(Y,z3(x)),Y}function q3(x){let Y=nY(x),q=Y.matches[Y.matches.length-1];return es(q.route.id,`${x} can only be used on routes that contain a unique "id"`),q.route.id}function aY(){return q3("useRouteId")}function sY(){let x=ve.useContext(K3),Y=rY("useRouteError"),q=q3("useRouteError");return x!==void 0?x:Y.errors?.[q]}function oY(){let{router:x}=iY("useNavigate"),Y=q3("useNavigate"),q=ve.useRef(!1);return N8(()=>{q.current=!0}),ve.useCallback(async(X,re={})=>{NE(q.current,O8),q.current&&(typeof X=="number"?x.navigate(X):await x.navigate(X,{fromRouteId:Y,...re}))},[x,Y])}var m8={};function P8(x,Y,q){!Y&&!m8[x]&&(m8[x]=!0,NE(!1,q))}ve.memo(cY);function cY({routes:x,future:Y,state:q,unstable_onError:K}){return D8(x,void 0,q,K,Y)}function B3(x){es(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function dY({basename:x="/",children:Y=null,location:q,navigationType:K="POP",navigator:X,static:re=!1}){es(!QV(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let pe=x.replace(/^\/*/,"/"),Pe=ve.useMemo(()=>({basename:pe,navigator:X,static:re,future:{}}),[pe,X,re]);typeof q=="string"&&(q=nN(q));let{pathname:ge="/",search:de="",hash:Re="",state:ye=null,key:Be="default"}=q,ct=ve.useMemo(()=>{let ke=eS(ge,pe);return ke==null?null:{location:{pathname:ke,search:de,hash:Re,state:ye,key:Be},navigationType:K}},[pe,ge,de,Re,ye,Be,K]);return NE(ct!=null,`<Router basename="${pe}"> is not able to match the URL "${ge}${de}${Re}" because it does not start with the basename, so the <Router> won't render anything.`),ct==null?null:ve.createElement(DE.Provider,{value:Pe},ve.createElement(ZV.Provider,{children:Y,value:ct}))}function lY({children:x,location:Y}){return JK(j3(x),Y)}function j3(x,Y=[]){let q=[];return ve.Children.forEach(x,(K,X)=>{if(!ve.isValidElement(K))return;let re=[...Y,X];if(K.type===ve.Fragment){q.push.apply(q,j3(K.props.children,re));return}es(K.type===B3,`[${typeof K.type=="string"?K.type:K.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),es(!K.props.index||!K.props.children,"An index route cannot have child routes.");let pe={id:K.props.id||re.join("-"),caseSensitive:K.props.caseSensitive,element:K.props.element,Component:K.props.Component,index:K.props.index,path:K.props.path,loader:K.props.loader,action:K.props.action,hydrateFallbackElement:K.props.hydrateFallbackElement,HydrateFallback:K.props.HydrateFallback,errorElement:K.props.errorElement,ErrorBoundary:K.props.ErrorBoundary,hasErrorBoundary:K.props.hasErrorBoundary===!0||K.props.ErrorBoundary!=null||K.props.errorElement!=null,shouldRevalidate:K.props.shouldRevalidate,handle:K.props.handle,lazy:K.props.lazy};K.props.children&&(pe.children=j3(K.props.children,re)),q.push(pe)}),q}var eG="get",tG="application/x-www-form-urlencoded";function aG(x){return x!=null&&typeof x.tagName=="string"}function uY(x){return aG(x)&&x.tagName.toLowerCase()==="button"}function hY(x){return aG(x)&&x.tagName.toLowerCase()==="form"}function pY(x){return aG(x)&&x.tagName.toLowerCase()==="input"}function _Y(x){return!!(x.metaKey||x.altKey||x.ctrlKey||x.shiftKey)}function fY(x,Y){return x.button===0&&(!Y||Y==="_self")&&!_Y(x)}var $j=null;function EY(){if($j===null)try{new FormData(document.createElement("form"),0),$j=!1}catch{$j=!0}return $j}var mY=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function V3(x){return x!=null&&!mY.has(x)?(NE(!1,`"${x}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${tG}"`),null):x}function gY(x,Y){let q,K,X,re,pe;if(hY(x)){let Pe=x.getAttribute("action");K=Pe?eS(Pe,Y):null,q=x.getAttribute("method")||eG,X=V3(x.getAttribute("enctype"))||tG,re=new FormData(x)}else if(uY(x)||pY(x)&&(x.type==="submit"||x.type==="image")){let Pe=x.form;if(Pe==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let ge=x.getAttribute("formaction")||Pe.getAttribute("action");if(K=ge?eS(ge,Y):null,q=x.getAttribute("formmethod")||Pe.getAttribute("method")||eG,X=V3(x.getAttribute("formenctype"))||V3(Pe.getAttribute("enctype"))||tG,re=new FormData(Pe,x),!EY()){let{name:de,type:Re,value:ye}=x;if(Re==="image"){let Be=de?`${de}.`:"";re.append(`${Be}x`,"0"),re.append(`${Be}y`,"0")}else de&&re.append(de,ye)}}else{if(aG(x))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');q=eG,K=null,X=tG,pe=x}return re&&X==="text/plain"&&(pe=re,re=void 0),{action:K,method:q.toLowerCase(),encType:X,formData:re,body:pe}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function X3(x,Y){if(x===!1||x===null||typeof x>"u")throw new Error(Y)}function SY(x,Y,q){let K=typeof x=="string"?new URL(x,typeof window>"u"?"server://singlefetch/":window.location.origin):x;return K.pathname==="/"?K.pathname=`_root.${q}`:Y&&eS(K.pathname,Y)==="/"?K.pathname=`${Y.replace(/\/$/,"")}/_root.${q}`:K.pathname=`${K.pathname.replace(/\/$/,"")}.${q}`,K}async function TY(x,Y){if(x.id in Y)return Y[x.id];try{let q=await import(x.module);return Y[x.id]=q,q}catch(q){return console.error(`Error loading route module \`${x.module}\`, reloading page...`),console.error(q),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function RY(x){return x==null?!1:x.href==null?x.rel==="preload"&&typeof x.imageSrcSet=="string"&&typeof x.imageSizes=="string":typeof x.rel=="string"&&typeof x.href=="string"}async function vY(x,Y,q){let K=await Promise.all(x.map(async X=>{let re=Y.routes[X.route.id];if(re){let pe=await TY(re,q);return pe.links?pe.links():[]}return[]}));return AY(K.flat(1).filter(RY).filter(X=>X.rel==="stylesheet"||X.rel==="preload").map(X=>X.rel==="stylesheet"?{...X,rel:"prefetch",as:"style"}:{...X,rel:"prefetch"}))}function g8(x,Y,q,K,X,re){let pe=(ge,de)=>q[de]?ge.route.id!==q[de].route.id:!0,Pe=(ge,de)=>q[de].pathname!==ge.pathname||q[de].route.path?.endsWith("*")&&q[de].params["*"]!==ge.params["*"];return re==="assets"?Y.filter((ge,de)=>pe(ge,de)||Pe(ge,de)):re==="data"?Y.filter((ge,de)=>{let Re=K.routes[ge.route.id];if(!Re||!Re.hasLoader)return!1;if(pe(ge,de)||Pe(ge,de))return!0;if(ge.route.shouldRevalidate){let ye=ge.route.shouldRevalidate({currentUrl:new URL(X.pathname+X.search+X.hash,window.origin),currentParams:q[0]?.params||{},nextUrl:new URL(x,window.origin),nextParams:ge.params,defaultShouldRevalidate:!0});if(typeof ye=="boolean")return ye}return!0}):[]}function yY(x,Y,{includeHydrateFallback:q}={}){return CY(x.map(K=>{let X=Y.routes[K.route.id];if(!X)return[];let re=[X.module];return X.clientActionModule&&(re=re.concat(X.clientActionModule)),X.clientLoaderModule&&(re=re.concat(X.clientLoaderModule)),q&&X.hydrateFallbackModule&&(re=re.concat(X.hydrateFallbackModule)),X.imports&&(re=re.concat(X.imports)),re}).flat(1))}function CY(x){return[...new Set(x)]}function bY(x){let Y={},q=Object.keys(x).sort();for(let K of q)Y[K]=x[K];return Y}function AY(x,Y){let q=new Set;return new Set(Y),x.reduce((K,X)=>{let re=JSON.stringify(bY(X));return q.has(re)||(q.add(re),K.push({key:re,link:X})),K},[])}function L8(){let x=ve.useContext(aN);return X3(x,"You must render this element inside a <DataRouterContext.Provider> element"),x}function IY(){let x=ve.useContext(nG);return X3(x,"You must render this element inside a <DataRouterStateContext.Provider> element"),x}var J3=ve.createContext(void 0);J3.displayName="FrameworkContext";function k8(){let x=ve.useContext(J3);return X3(x,"You must render this element inside a <HydratedRouter> element"),x}function wY(x,Y){let q=ve.useContext(J3),[K,X]=ve.useState(!1),[re,pe]=ve.useState(!1),{onFocus:Pe,onBlur:ge,onMouseEnter:de,onMouseLeave:Re,onTouchStart:ye}=Y,Be=ve.useRef(null);ve.useEffect(()=>{if(x==="render"&&pe(!0),x==="viewport"){let Ve=ht=>{ht.forEach(At=>{pe(At.isIntersecting)})},Fe=new IntersectionObserver(Ve,{threshold:.5});return Be.current&&Fe.observe(Be.current),()=>{Fe.disconnect()}}},[x]),ve.useEffect(()=>{if(K){let Ve=setTimeout(()=>{pe(!0)},100);return()=>{clearTimeout(Ve)}}},[K]);let ct=()=>{X(!0)},ke=()=>{X(!1),pe(!1)};return q?x!=="intent"?[re,Be,{}]:[re,Be,{onFocus:zV(Pe,ct),onBlur:zV(ge,ke),onMouseEnter:zV(de,ct),onMouseLeave:zV(Re,ke),onTouchStart:zV(ye,ct)}]:[!1,Be,{}]}function zV(x,Y){return q=>{x&&x(q),q.defaultPrevented||Y(q)}}function OY({page:x,...Y}){let{router:q}=L8(),K=ve.useMemo(()=>v8(q.routes,x,q.basename),[q.routes,x,q.basename]);return K?ve.createElement(DY,{page:x,matches:K,...Y}):null}function NY(x){let{manifest:Y,routeModules:q}=k8(),[K,X]=ve.useState([]);return ve.useEffect(()=>{let re=!1;return vY(x,Y,q).then(pe=>{re||X(pe)}),()=>{re=!0}},[x,Y,q]),K}function DY({page:x,matches:Y,...q}){let K=bA(),{manifest:X,routeModules:re}=k8(),{basename:pe}=L8(),{loaderData:Pe,matches:ge}=IY(),de=ve.useMemo(()=>g8(x,Y,ge,X,K,"data"),[x,Y,ge,X,K]),Re=ve.useMemo(()=>g8(x,Y,ge,X,K,"assets"),[x,Y,ge,X,K]),ye=ve.useMemo(()=>{if(x===K.pathname+K.search+K.hash)return[];let ke=new Set,Ve=!1;if(Y.forEach(ht=>{let At=X.routes[ht.route.id];!At||!At.hasLoader||(!de.some(kt=>kt.route.id===ht.route.id)&&ht.route.id in Pe&&re[ht.route.id]?.shouldRevalidate||At.hasClientLoader?Ve=!0:ke.add(ht.route.id))}),ke.size===0)return[];let Fe=SY(x,pe,"data");return Ve&&ke.size>0&&Fe.searchParams.set("_routes",Y.filter(ht=>ke.has(ht.route.id)).map(ht=>ht.route.id).join(",")),[Fe.pathname+Fe.search]},[pe,Pe,K,X,de,Y,x,re]),Be=ve.useMemo(()=>yY(Re,X),[Re,X]),ct=NY(Re);return ve.createElement(ve.Fragment,null,ye.map(ke=>ve.createElement("link",{key:ke,rel:"prefetch",as:"fetch",href:ke,...q})),Be.map(ke=>ve.createElement("link",{key:ke,rel:"modulepreload",href:ke,...q})),ct.map(({key:ke,link:Ve})=>ve.createElement("link",{key:ke,nonce:q.nonce,...Ve})))}function PY(...x){return Y=>{x.forEach(q=>{typeof q=="function"?q(Y):q!=null&&(q.current=Y)})}}var M8=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{M8&&(window.__reactRouterVersion="7.9.1")}catch{}function LY({basename:x,children:Y,window:q}){let K=ve.useRef();K.current==null&&(K.current=TK({window:q,v5Compat:!0}));let X=K.current,[re,pe]=ve.useState({action:X.action,location:X.location}),Pe=ve.useCallback(ge=>{ve.startTransition(()=>pe(ge))},[pe]);return ve.useLayoutEffect(()=>X.listen(Pe),[X,Pe]),ve.createElement(dY,{basename:x,children:Y,location:re.location,navigationType:re.action,navigator:X})}var U8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,x8=ve.forwardRef(function({onClick:Y,discover:q="render",prefetch:K="none",relative:X,reloadDocument:re,replace:pe,state:Pe,target:ge,to:de,preventScrollReset:Re,viewTransition:ye,...Be},ct){let{basename:ke}=ve.useContext(DE),Ve=typeof de=="string"&&U8.test(de),Fe,ht=!1;if(typeof de=="string"&&Ve&&(Fe=de,M8))try{let ia=new URL(window.location.href),ha=de.startsWith("//")?new URL(ia.protocol+de):new URL(de),Ns=eS(ha.pathname,ke);ha.origin===ia.origin&&Ns!=null?de=Ns+ha.search+ha.hash:ht=!0}catch{NE(!1,`<Link to="${de}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let At=zK(de,{relative:X}),[kt,Ar,oi]=wY(K,Be),ts=xY(de,{replace:pe,state:Pe,target:ge,preventScrollReset:Re,relative:X,viewTransition:ye});function tr(ia){Y&&Y(ia),ia.defaultPrevented||ts(ia)}let is=ve.createElement("a",{...Be,...oi,href:Fe||At,onClick:ht||re?Y:tr,ref:PY(ct,Ar),target:ge,"data-discover":!Ve&&q==="render"?"true":void 0});return kt&&!Ve?ve.createElement(ve.Fragment,null,is,ve.createElement(OY,{page:At})):is});x8.displayName="Link";var kY=ve.forwardRef(function({"aria-current":Y="page",caseSensitive:q=!1,className:K="",end:X=!1,style:re,to:pe,viewTransition:Pe,children:ge,...de},Re){let ye=$V(pe,{relative:de.relative}),Be=bA(),ct=ve.useContext(nG),{navigator:ke,basename:Ve}=ve.useContext(DE),Fe=ct!=null&&GY(ye)&&Pe===!0,ht=ke.encodeLocation?ke.encodeLocation(ye).pathname:ye.pathname,At=Be.pathname,kt=ct&&ct.navigation&&ct.navigation.location?ct.navigation.location.pathname:null;q||(At=At.toLowerCase(),kt=kt?kt.toLowerCase():null,ht=ht.toLowerCase()),kt&&Ve&&(kt=eS(kt,Ve)||kt);const Ar=ht!=="/"&&ht.endsWith("/")?ht.length-1:ht.length;let oi=At===ht||!X&&At.startsWith(ht)&&At.charAt(Ar)==="/",ts=kt!=null&&(kt===ht||!X&&kt.startsWith(ht)&&kt.charAt(ht.length)==="/"),tr={isActive:oi,isPending:ts,isTransitioning:Fe},is=oi?Y:void 0,ia;typeof K=="function"?ia=K(tr):ia=[K,oi?"active":null,ts?"pending":null,Fe?"transitioning":null].filter(Boolean).join(" ");let ha=typeof re=="function"?re(tr):re;return ve.createElement(x8,{...de,"aria-current":is,className:ia,ref:Re,style:ha,to:pe,viewTransition:Pe},typeof ge=="function"?ge(tr):ge)});kY.displayName="NavLink";var MY=ve.forwardRef(({discover:x="render",fetcherKey:Y,navigate:q,reloadDocument:K,replace:X,state:re,method:pe=eG,action:Pe,onSubmit:ge,relative:de,preventScrollReset:Re,viewTransition:ye,...Be},ct)=>{let ke=BY(),Ve=jY(Pe,{relative:de}),Fe=pe.toLowerCase()==="get"?"get":"post",ht=typeof Pe=="string"&&U8.test(Pe),At=kt=>{if(ge&&ge(kt),kt.defaultPrevented)return;kt.preventDefault();let Ar=kt.nativeEvent.submitter,oi=Ar?.getAttribute("formmethod")||pe;ke(Ar||kt.currentTarget,{fetcherKey:Y,method:oi,navigate:q,replace:X,state:re,relative:de,preventScrollReset:Re,viewTransition:ye})};return ve.createElement("form",{ref:ct,method:Fe,action:Ve,onSubmit:K?ge:At,...Be,"data-discover":!ht&&x==="render"?"true":void 0})});MY.displayName="Form";function UY(x){return`${x} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function V8(x){let Y=ve.useContext(aN);return es(Y,UY(x)),Y}function xY(x,{target:Y,replace:q,state:K,preventScrollReset:X,relative:re,viewTransition:pe}={}){let Pe=Y3(),ge=bA(),de=$V(x,{relative:re});return ve.useCallback(Re=>{if(fY(Re,Y)){Re.preventDefault();let ye=q!==void 0?q:JV(ge)===JV(de);Pe(x,{replace:ye,state:K,preventScrollReset:X,relative:re,viewTransition:pe})}},[ge,Pe,de,q,K,Y,x,X,re,pe])}var VY=0,FY=()=>`__${String(++VY)}__`;function BY(){let{router:x}=V8("useSubmit"),{basename:Y}=ve.useContext(DE),q=aY();return ve.useCallback(async(K,X={})=>{let{action:re,method:pe,encType:Pe,formData:ge,body:de}=gY(K,Y);if(X.navigate===!1){let Re=X.fetcherKey||FY();await x.fetch(Re,q,X.action||re,{preventScrollReset:X.preventScrollReset,formData:ge,body:de,formMethod:X.method||pe,formEncType:X.encType||Pe,flushSync:X.flushSync})}else await x.navigate(X.action||re,{preventScrollReset:X.preventScrollReset,formData:ge,body:de,formMethod:X.method||pe,formEncType:X.encType||Pe,replace:X.replace,state:X.state,fromRouteId:q,flushSync:X.flushSync,viewTransition:X.viewTransition})},[x,Y,q])}function jY(x,{relative:Y}={}){let{basename:q}=ve.useContext(DE),K=ve.useContext(PE);es(K,"useFormAction must be used inside a RouteContext");let[X]=K.matches.slice(-1),re={...$V(x||".",{relative:Y})},pe=bA();if(x==null){re.search=pe.search;let Pe=new URLSearchParams(re.search),ge=Pe.getAll("index");if(ge.some(Re=>Re==="")){Pe.delete("index"),ge.filter(ye=>ye).forEach(ye=>Pe.append("index",ye));let Re=Pe.toString();re.search=Re?`?${Re}`:""}}return(!x||x===".")&&X.route.index&&(re.search=re.search?re.search.replace(/^\?/,"?index&"):"?index"),q!=="/"&&(re.pathname=re.pathname==="/"?q:$g([q,re.pathname])),JV(re)}function GY(x,{relative:Y}={}){let q=ve.useContext(w8);es(q!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:K}=V8("useViewTransitionState"),X=$V(x,{relative:Y});if(!q.isTransitioning)return!1;let re=eS(q.currentLocation.pathname,K)||q.currentLocation.pathname,pe=eS(q.nextLocation.pathname,K)||q.nextLocation.pathname;return rG(X.pathname,pe)!=null||rG(X.pathname,re)!=null}const WY=()=>{const x=Y3(),Y=q=>{x(`/call/${q}`)};return It.jsx("div",{className:"home-container",children:It.jsxs("div",{className:"home-content",children:[It.jsx("h1",{children:"Agora Video Call Demo"}),It.jsx("p",{children:"Choose your user type to join the video call"}),It.jsxs("div",{className:"button-container",children:[It.jsx("button",{className:"user-button user-a-button",onClick:()=>Y("userA"),children:"Join as User A"}),It.jsx("button",{className:"user-button user-b-button",onClick:()=>Y("userB"),children:"Join as User B"})]}),It.jsxs("div",{className:"info",children:[It.jsx("p",{children:It.jsx("strong",{children:"Instructions:"})}),It.jsxs("ul",{children:[It.jsx("li",{children:"Open this app in two browser windows"}),It.jsx("li",{children:'Click "Join as User A" in one window'}),It.jsx("li",{children:'Click "Join as User B" in the other window'}),It.jsx("li",{children:"Allow camera and microphone permissions"}),It.jsx("li",{children:"You should see each other's video!"})]})]})]})})};var iG={exports:{}},HY=iG.exports,S8;function KY(){return S8||(S8=1,(function(x,Y){(function(q,K){x.exports=K()})(HY,(function(){function q(e,t){return t.forEach((function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach((function(r){if(r!=="default"&&!(r in e)){var a=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,a.get?a:{enumerable:!0,get:function(){return i[r]}})}}))})),Object.freeze(e)}var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function X(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var re=function(e){try{return!!e()}catch{return!0}},pe=!re((function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")})),Pe=pe,ge=Function.prototype,de=ge.call,Re=Pe&&ge.bind.bind(de,de),ye=Pe?Re:function(e){return function(){return de.apply(e,arguments)}},Be=ye({}.isPrototypeOf),ct=function(e){return e&&e.Math===Math&&e},ke=ct(typeof globalThis=="object"&&globalThis)||ct(typeof window=="object"&&window)||ct(typeof self=="object"&&self)||ct(typeof K=="object"&&K)||ct(typeof K=="object"&&K)||(function(){return this})()||Function("return this")(),Ve=pe,Fe=Function.prototype,ht=Fe.apply,At=Fe.call,kt=typeof Reflect=="object"&&Reflect.apply||(Ve?At.bind(ht):function(){return At.apply(ht,arguments)}),Ar=ye,oi=Ar({}.toString),ts=Ar("".slice),tr=function(e){return ts(oi(e),8,-1)},is=tr,ia=ye,ha=function(e){if(is(e)==="Function")return ia(e)},Ns=typeof document=="object"&&document.all,Jt=Ns===void 0&&Ns!==void 0?function(e){return typeof e=="function"||e===Ns}:function(e){return typeof e=="function"},zo={},ir=!re((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),Ds=pe,je=Function.prototype.call,tt=Ds?je.bind(je):function(){return je.apply(je,arguments)},ni={},Qr={}.propertyIsEnumerable,me=Object.getOwnPropertyDescriptor,at=me&&!Qr.call({1:2},1);ni.f=at?function(e){var t=me(this,e);return!!t&&t.enumerable}:Qr;var gt,Tt,Ft=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},xr=re,xi=tr,_s=Object,Fn=ye("".split),mo=xr((function(){return!_s("z").propertyIsEnumerable(0)}))?function(e){return xi(e)==="String"?Fn(e,""):_s(e)}:_s,Fl=function(e){return e==null},tS=Fl,tv=TypeError,Xs=function(e){if(tS(e))throw new tv("Can't call method on "+e);return e},iv=mo,oN=Xs,Js=function(e){return iv(oN(e))},Yd=Jt,Ir=function(e){return typeof e=="object"?e!==null:Yd(e)},bn={},x_=bn,oh=ke,cN=Jt,iS=function(e){return cN(e)?e:void 0},wr=function(e,t){return arguments.length<2?iS(x_[e])||iS(oh[e]):x_[e]&&x_[e][t]||oh[e]&&oh[e][t]},rv=ke.navigator,pp=rv&&rv.userAgent,$r=pp?String(pp):"",zd=ke,fs=$r,nv=zd.process,av=zd.Deno,sv=nv&&nv.versions||av&&av.version,V_=sv&&sv.v8;V_&&(Tt=(gt=V_.split("."))[0]>0&&gt[0]<4?1:+(gt[0]+gt[1])),!Tt&&fs&&(!(gt=fs.match(/Edge\/(\d+)/))||gt[1]>=74)&&(gt=fs.match(/Chrome\/(\d+)/))&&(Tt=+gt[1]);var Ps=Tt,Bl=Ps,rS=re,LE=ke.String,td=!!Object.getOwnPropertySymbols&&!rS((function(){var e=Symbol("symbol detection");return!LE(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Bl&&Bl<41})),nS=td&&!Symbol.sham&&typeof Symbol.iterator=="symbol",NA=wr,ov=Jt,kE=Be,dN=Object,qd=nS?function(e){return typeof e=="symbol"}:function(e){var t=NA("Symbol");return ov(t)&&kE(t.prototype,dN(e))},DA=String,qo=function(e){try{return DA(e)}catch{return"Object"}},cv=Jt,PA=qo,lN=TypeError,pr=function(e){if(cv(e))return e;throw new lN(PA(e)+" is not a function")},Ls=pr,go=Fl,vc=function(e,t){var i=e[t];return go(i)?void 0:Ls(i)},ME=tt,dv=Jt,lv=Ir,LA=TypeError,_p={exports:{}},UE=ke,F_=Object.defineProperty,B_=ke,xE=function(e,t){try{F_(UE,e,{value:t,configurable:!0,writable:!0})}catch{UE[e]=t}return t},ch="__core-js_shared__",Da=_p.exports=B_[ch]||xE(ch,{});(Da.versions||(Da.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var j_=_p.exports,aS=j_,Es=function(e,t){return aS[e]||(aS[e]=t||{})},G_=Xs,uN=Object,Pa=function(e){return uN(G_(e))},kA=Pa,hN=ye({}.hasOwnProperty),Bi=Object.hasOwn||function(e,t){return hN(kA(e),t)},sS=ye,jl=0,uv=Math.random(),MA=sS(1 .toString),Xd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+MA(++jl+uv,36)},hv=Es,VE=Bi,pN=Xd,UA=td,yc=nS,Cc=ke.Symbol,FE=hv("wks"),oS=yc?Cc.for||Cc:Cc&&Cc.withoutSetter||pN,ci=function(e){return VE(FE,e)||(FE[e]=UA&&VE(Cc,e)?Cc[e]:oS("Symbol."+e)),FE[e]},cS=tt,pv=Ir,So=qd,_v=vc,xA=function(e,t){var i,r;if(dv(i=e.toString)&&!lv(r=ME(i,e))||dv(i=e.valueOf)&&!lv(r=ME(i,e)))return r;throw new LA("Can't convert object to primitive value")},fv=TypeError,W_=ci("toPrimitive"),VA=function(e,t){if(!pv(e)||So(e))return e;var i,r=_v(e,W_);if(r){if(i=cS(r,e,t),!pv(i)||So(i))return i;throw new fv("Can't convert object to primitive value")}return xA(e)},FA=qd,Jd=function(e){var t=VA(e,"string");return FA(t)?t:t+""},Ev=Ir,H_=ke.document,BA=Ev(H_)&&Ev(H_.createElement),fp=function(e){return BA?H_.createElement(e):{}},_N=fp,mv=!ir&&!re((function(){return Object.defineProperty(_N("div"),"a",{get:function(){return 7}}).a!==7})),dS=ir,gv=tt,Sv=ni,K_=Ft,Y_=Js,jA=Jd,Tv=Bi,GA=mv,Ep=Object.getOwnPropertyDescriptor;zo.f=dS?Ep:function(e,t){if(e=Y_(e),t=jA(t),GA)try{return Ep(e,t)}catch{}if(Tv(e,t))return K_(!gv(Sv.f,e,t),e[t])};var Gl=re,Rv=Jt,BE=/#|\.prototype\./,ks=function(e,t){var i=lS[vv(e)];return i===uS||i!==WA&&(Rv(t)?Gl(t):!!t)},vv=ks.normalize=function(e){return String(e).replace(BE,".").toLowerCase()},lS=ks.data={},WA=ks.NATIVE="N",uS=ks.POLYFILL="P",z_=ks,HA=pr,To=pe,mp=ha(ha.bind),rs=function(e,t){return HA(e),t===void 0?e:To?mp(e,t):function(){return e.apply(t,arguments)}},pn={},yv=ir&&re((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),Cv=Ir,bv=String,jE=TypeError,Vr=function(e){if(Cv(e))return e;throw new jE(bv(e)+" is not an object")},KA=ir,fN=mv,EN=yv,gp=Vr,GE=Jd,mN=TypeError,WE=Object.defineProperty,gN=Object.getOwnPropertyDescriptor,HE="enumerable",KE="configurable",q_="writable";pn.f=KA?EN?function(e,t,i){if(gp(e),t=GE(t),gp(i),typeof e=="function"&&t==="prototype"&&"value"in i&&q_ in i&&!i[q_]){var r=gN(e,t);r&&r[q_]&&(e[t]=i.value,i={configurable:KE in i?i[KE]:r[KE],enumerable:HE in i?i[HE]:r[HE],writable:!1})}return WE(e,t,i)}:WE:function(e,t,i){if(gp(e),t=GE(t),gp(i),fN)try{return WE(e,t,i)}catch{}if("get"in i||"set"in i)throw new mN("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var SN=pn,TN=Ft,Xo=ir?function(e,t,i){return SN.f(e,t,TN(1,i))}:function(e,t,i){return e[t]=i,e},Wl=ke,Av=kt,RN=ha,vN=Jt,yN=zo.f,YA=z_,id=bn,CN=rs,rd=Xo,Iv=Bi,bN=function(e){var t=function(i,r,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,r)}return new e(i,r,a)}return Av(e,this,arguments)};return t.prototype=e.prototype,t},dt=function(e,t){var i,r,a,s,o,c,d,l,h,_=e.target,f=e.global,m=e.stat,S=e.proto,T=f?Wl:m?Wl[_]:Wl[_]&&Wl[_].prototype,R=f?id:id[_]||rd(id,_,{})[_],C=R.prototype;for(s in t)r=!(i=YA(f?s:_+(m?".":"#")+s,e.forced))&&T&&Iv(T,s),c=R[s],r&&(d=e.dontCallGetSet?(h=yN(T,s))&&h.value:T[s]),o=r&&d?d:t[s],(i||S||typeof c!=typeof o)&&(l=e.bind&&r?CN(o,Wl):e.wrap&&r?bN(o):S&&vN(o)?RN(o):o,(e.sham||o&&o.sham||c&&c.sham)&&rd(l,"sham",!0),rd(R,s,l),S&&(Iv(id,a=_+"Prototype")||rd(id,a,{}),rd(id[a],s,o),e.real&&C&&(i||!C[s])&&rd(C,s,o)))},AN=Math.ceil,IN=Math.floor,wN=Math.trunc||function(e){var t=+e;return(t>0?IN:AN)(t)},wv=wN,Hl=function(e){var t=+e;return t!=t||t===0?0:wv(t)},ON=Hl,zA=Math.max,qA=Math.min,X_=function(e,t){var i=ON(e);return i<0?zA(i+t,0):qA(i,t)},XA=Hl,JA=Math.min,dh=function(e){var t=XA(e);return t>0?JA(t,9007199254740991):0},NN=dh,Zs=function(e){return NN(e.length)},DN=Js,ZA=X_,QA=Zs,Sp=function(e){return function(t,i,r){var a=DN(t),s=QA(a);if(s===0)return!e&&-1;var o,c=ZA(r,s);if(e&&i!=i){for(;s>c;)if((o=a[c++])!=o)return!0}else for(;s>c;c++)if((e||c in a)&&a[c]===i)return e||c||0;return!e&&-1}},Kl={includes:Sp(!0),indexOf:Sp(!1)},PN=Kl.includes;dt({target:"Array",proto:!0,forced:re((function(){return!Array(1).includes()}))},{includes:function(e){return PN(this,e,arguments.length>1?arguments[1]:void 0)}});var hS=ke,$A=bn,Bn=function(e,t){var i=$A[e+"Prototype"],r=i&&i[t];if(r)return r;var a=hS[e],s=a&&a.prototype;return s&&s[t]},Ov=Bn("Array","includes"),Nv=Ir,eI=tr,tI=ci("match"),pS=function(e){var t;return Nv(e)&&((t=e[tI])!==void 0?!!t:eI(e)==="RegExp")},LN=pS,kN=TypeError,Dv={};Dv[ci("toStringTag")]="z";var YE=String(Dv)==="[object z]",MN=YE,Jo=Jt,nd=tr,iI=ci("toStringTag"),rI=Object,nI=nd((function(){return arguments})())==="Arguments",Ms=MN?nd:function(e){var t,i,r;return e===void 0?"Undefined":e===null?"Null":typeof(i=(function(a,s){try{return a[s]}catch{}})(t=rI(e),iI))=="string"?i:nI?nd(t):(r=nd(t))==="Object"&&Jo(t.callee)?"Arguments":r},Pv=Ms,UN=String,Fr=function(e){if(Pv(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return UN(e)},Lv=ci("match"),zE=dt,kv=function(e){if(LN(e))throw new kN("The method doesn't accept regular expressions");return e},aI=Xs,Yl=Fr,J_=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[Lv]=!1,"/./"[e](t)}catch{}}return!1},Mv=ye("".indexOf);zE({target:"String",proto:!0,forced:!J_("includes")},{includes:function(e){return!!~Mv(Yl(aI(this)),Yl(kv(e)),arguments.length>1?arguments[1]:void 0)}});var sI=Bn("String","includes"),zl=Be,oI=Ov,cI=sI,Z_=Array.prototype,qE=String.prototype,xN=function(e){var t=e.includes;return e===Z_||zl(Z_,e)&&t===Z_.includes?oI:typeof e=="string"||e===qE||zl(qE,e)&&t===qE.includes?cI:t},ee=X(xN),dI=pr,lI=Pa,Uv=mo,ad=Zs,_S=TypeError,Ro="Reduce of empty array with no initial value",bc=function(e){return function(t,i,r,a){var s=lI(t),o=Uv(s),c=ad(s);if(dI(i),c===0&&r<2)throw new _S(Ro);var d=e?c-1:0,l=e?-1:1;if(r<2)for(;;){if(d in o){a=o[d],d+=l;break}if(d+=l,e?d<0:c<=d)throw new _S(Ro)}for(;e?d>=0:c>d;d+=l)d in o&&(a=i(a,o[d],d,s));return a}},Q_={left:bc(!1)},xv=re,Zd=function(e,t){var i=[][e];return!!i&&xv((function(){i.call(null,t||function(){return 1},1)}))},Ac=ke,Vv=$r,$_=tr,lh=function(e){return Vv.slice(0,e.length)===e},uh=lh("Bun/")?"BUN":lh("Cloudflare-Workers")?"CLOUDFLARE":lh("Deno/")?"DENO":lh("Node.js/")?"NODE":Ac.Bun&&typeof Bun.version=="string"?"BUN":Ac.Deno&&typeof Deno.version=="object"?"DENO":$_(Ac.process)==="process"?"NODE":Ac.window&&Ac.document?"BROWSER":"REST",Ic=uh==="NODE",VN=Q_.left;dt({target:"Array",proto:!0,forced:!Ic&&Ps>79&&Ps<83||!Zd("reduce")},{reduce:function(e){var t=arguments.length;return VN(this,e,t,t>1?arguments[1]:void 0)}});var Zo=Bn("Array","reduce"),Fv=Be,ql=Zo,ef=Array.prototype,fS=function(e){var t=e.reduce;return e===ef||Fv(ef,e)&&t===ef.reduce?ql:t},Xl=fS,Pn=X(Xl),Bv=tr,vo=Array.isArray||function(e){return Bv(e)==="Array"},tf=dt,ES=vo,mS=ye([].reverse),yo=[1,2];tf({target:"Array",proto:!0,forced:String(yo)===String(yo.reverse())},{reverse:function(){return ES(this)&&(this.length=this.length),mS(this)}});var wc=Bn("Array","reverse"),Tp=Be,Jl=wc,Qo=Array.prototype,Rp=function(e){var t=e.reverse;return e===Qo||Tp(Qo,e)&&t===Qo.reverse?Jl:t},gS=Rp,XE=X(gS),jv=Xd,ms=Es("keys"),sn=function(e){return ms[e]||(ms[e]=jv(e))},Hr=!re((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),vp=Bi,Qd=Jt,Gv=Pa,yp=Hr,SS=sn("IE_PROTO"),rf=Object,JE=rf.prototype,Zl=yp?rf.getPrototypeOf:function(e){var t=Gv(e);if(vp(t,SS))return t[SS];var i=t.constructor;return Qd(i)&&t instanceof i?i.prototype:t instanceof rf?JE:null},uI=ye,ZE=pr,Wv=Ir,Cp=function(e){return Wv(e)||e===null},Ql=String,hh=TypeError,$l=function(e,t,i){try{return uI(ZE(Object.getOwnPropertyDescriptor(e,t)[i]))}catch{}},Hv=Ir,Kv=Xs,QE=function(e){if(Cp(e))return e;throw new hh("Can't set "+Ql(e)+" as a prototype")},TS=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,i={};try{(e=$l(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch{}return function(r,a){return Kv(r),QE(a),Hv(r)&&(t?e(r,a):r.__proto__=a),r}})():void 0),$o={},ra={},ph=Bi,hI=Js,FN=Kl.indexOf,BN=ra,Yv=ye([].push),pa=function(e,t){var i,r=hI(e),a=0,s=[];for(i in r)!ph(BN,i)&&ph(r,i)&&Yv(s,i);for(;t.length>a;)ph(r,i=t[a++])&&(~FN(s,i)||Yv(s,i));return s},bp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],$E=pa,em=bp.concat("length","prototype");$o.f=Object.getOwnPropertyNames||function(e){return $E(e,em)};var sd={};sd.f=Object.getOwnPropertySymbols;var nf=wr,af=$o,jN=sd,pI=Vr,GN=ye([].concat),_I=nf("Reflect","ownKeys")||function(e){var t=af.f(pI(e)),i=jN.f;return i?GN(t,i(e)):t},eu=Bi,zv=_I,RS=zo,fI=pn,tu={},EI=pa,vS=bp,iu=Object.keys||function(e){return EI(e,vS)},mI=ir,yS=yv,gI=pn,tm=Vr,SI=Js,TI=iu;tu.f=mI&&!yS?Object.defineProperties:function(e,t){tm(e);for(var i,r=SI(t),a=TI(t),s=a.length,o=0;s>o;)gI.f(e,i=a[o++],r[i]);return e};var Co,im=wr("document","documentElement"),qv=Vr,_h=tu,$d=bp,rm=ra,Xv=im,Jv=fp,ru="prototype",nu="script",CS=sn("IE_PROTO"),sf=function(){},fh=function(e){return"<"+nu+">"+e+"</"+nu+">"},of=function(e){e.write(fh("")),e.close();var t=e.parentWindow.Object;return e=null,t},Eh=function(){try{Co=new ActiveXObject("htmlfile")}catch{}var e,t,i;Eh=typeof document<"u"?document.domain&&Co?of(Co):(t=Jv("iframe"),i="java"+nu+":",t.style.display="none",Xv.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(fh("document.F=Object")),e.close(),e.F):of(Co);for(var r=$d.length;r--;)delete Eh[ru][$d[r]];return Eh()};rm[CS]=!0;var od=Object.create||function(e,t){var i;return e!==null?(sf[ru]=qv(e),i=new sf,sf[ru]=null,i[CS]=e):i=Eh(),t===void 0?i:_h.f(i,t)},Zv=Ir,mh=Xo,Gi=Error,on=ye("".replace),La=String(new Gi("zxcasd").stack),cf=/\n\s*at [^:]*:[^\n]*/,df=cf.test(La),Ap=Ft,bS=!re((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Ap(1,7)),e.stack!==7)})),nm=Xo,lf=function(e,t){if(df&&typeof e=="string"&&!Gi.prepareStackTrace)for(;t--;)e=on(e,cf,"");return e},WN=bS,qn=Error.captureStackTrace,ec={},Qv=ec,RI=ci("iterator"),vI=Array.prototype,$v=function(e){return e!==void 0&&(Qv.Array===e||vI[RI]===e)},ey=Ms,am=vc,ty=Fl,bo=ec,ka=ci("iterator"),au=function(e){if(!ty(e))return am(e,ka)||am(e,"@@iterator")||bo[ey(e)]},sm=tt,AS=pr,iy=Vr,su=qo,IS=au,ry=TypeError,Ip=function(e,t){var i=arguments.length<2?IS(e):t;if(AS(i))return iy(sm(i,e));throw new ry(su(e)+" is not iterable")},yI=tt,wS=Vr,CI=vc,OS=function(e,t,i){var r,a;wS(e);try{if(!(r=CI(e,"return"))){if(t==="throw")throw i;return i}r=yI(r,e)}catch(s){a=!0,r=s}if(t==="throw")throw i;if(a)throw r;return wS(r),i},bI=rs,AI=tt,ny=Vr,II=qo,HN=$v,wI=Zs,NS=Be,OI=Ip,ay=au,DS=OS,NI=TypeError,gh=function(e,t){this.stopped=e,this.result=t},PS=gh.prototype,el=function(e,t,i){var r,a,s,o,c,d,l,h=i&&i.that,_=!(!i||!i.AS_ENTRIES),f=!(!i||!i.IS_RECORD),m=!(!i||!i.IS_ITERATOR),S=!(!i||!i.INTERRUPTED),T=bI(t,h),R=function(b){return r&&DS(r,"normal",b),new gh(!0,b)},C=function(b){return _?(ny(b),S?T(b[0],b[1],R):T(b[0],b[1])):S?T(b,R):T(b)};if(f)r=e.iterator;else if(m)r=e;else{if(!(a=ay(e)))throw new NI(II(e)+" is not iterable");if(HN(a)){for(s=0,o=wI(e);o>s;s++)if((c=C(e[s]))&&NS(PS,c))return c;return new gh(!1)}r=OI(e,a)}for(d=f?e.next:r.next;!(l=AI(d,r)).done;){try{c=C(l.value)}catch(b){DS(r,"throw",b)}if(typeof c=="object"&&c&&NS(PS,c))return c}return new gh(!1)},KN=Fr,DI=dt,uf=Be,LS=Zl,Sh=TS,kS=function(e,t,i){for(var r=zv(t),a=fI.f,s=RS.f,o=0;o<r.length;o++){var c=r[o];eu(e,c)||i&&eu(i,c)||a(e,c,s(t,c))}},wp=od,hf=Xo,pf=Ft,PI=function(e,t){Zv(t)&&"cause"in t&&mh(e,"cause",t.cause)},LI=function(e,t,i,r){WN&&(qn?qn(e,t):nm(e,"stack",lf(i,r)))},kI=el,MI=function(e,t){return e===void 0?arguments.length<2?"":t:KN(e)},sy=ci("toStringTag"),Th=Error,UI=[].push,tc=function(e,t){var i,r=uf(_f,this);Sh?i=Sh(new Th,r?LS(this):_f):(i=r?this:wp(_f),hf(i,sy,"Error")),t!==void 0&&hf(i,"message",MI(t)),LI(i,tc,i.stack,1),arguments.length>2&&PI(i,arguments[2]);var a=[];return kI(e,UI,{that:a}),hf(i,"errors",a),i};Sh?Sh(tc,Th):kS(tc,Th,{name:!0});var _f=tc.prototype=wp(Th.prototype,{constructor:pf(1,tc),message:pf(1,""),name:pf(1,"AggregateError")});DI({global:!0},{AggregateError:tc});var Rh,ou,cu,xI=Jt,MS=ke.WeakMap,oy=xI(MS)&&/native code/.test(String(MS)),US=ke,VI=Ir,YN=Xo,om=Bi,ff=j_,cm=sn,cy=ra,Ef="Object already initialized",mf=US.TypeError,FI=US.WeakMap;if(oy||ff.state){var na=ff.state||(ff.state=new FI);na.get=na.get,na.has=na.has,na.set=na.set,Rh=function(e,t){if(na.has(e))throw new mf(Ef);return t.facade=e,na.set(e,t),t},ou=function(e){return na.get(e)||{}},cu=function(e){return na.has(e)}}else{var Oc=cm("state");cy[Oc]=!0,Rh=function(e,t){if(om(e,Oc))throw new mf(Ef);return t.facade=e,YN(e,Oc,t),t},ou=function(e){return om(e,Oc)?e[Oc]:{}},cu=function(e){return om(e,Oc)}}var Ao,dy,vh,gs={set:Rh,get:ou,has:cu,enforce:function(e){return cu(e)?ou(e):Rh(e,{})},getterFor:function(e){return function(t){var i;if(!VI(t)||(i=ou(t)).type!==e)throw new mf("Incompatible receiver, "+e+" required");return i}}},yh=ir,dm=Bi,gf=Function.prototype,BI=yh&&Object.getOwnPropertyDescriptor,xS=dm(gf,"name"),Ch={PROPER:xS&&(function(){}).name==="something",CONFIGURABLE:xS&&(!yh||yh&&BI(gf,"name").configurable)},jI=Xo,An=function(e,t,i,r){return r&&r.enumerable?e[t]=i:jI(e,t,i),e},tl=re,bh=Jt,GI=Ir,Ah=od,cd=Zl,Wa=An,Ih=ci("iterator"),lm=!1;[].keys&&("next"in(vh=[].keys())?(dy=cd(cd(vh)))!==Object.prototype&&(Ao=dy):lm=!0);var ly=!GI(Ao)||tl((function(){var e={};return Ao[Ih].call(e)!==e}));bh((Ao=ly?{}:Ah(Ao))[Ih])||Wa(Ao,Ih,(function(){return this}));var VS={IteratorPrototype:Ao,BUGGY_SAFARI_ITERATORS:lm},WI=Ms,Op=YE?{}.toString:function(){return"[object "+WI(this)+"]"},FS=YE,HI=pn.f,KI=Xo,YI=Bi,BS=Op,jS=ci("toStringTag"),Ha=function(e,t,i,r){var a=i?e:e&&e.prototype;a&&(YI(a,jS)||HI(a,jS,{configurable:!0,value:t}),r&&!FS&&KI(a,"toString",BS))},zI=VS.IteratorPrototype,qI=od,zN=Ft,XI=Ha,ns=ec,Ss=function(){return this},Sf=function(e,t,i,r){var a=t+" Iterator";return e.prototype=qI(zI,{next:zN(+!r,i)}),XI(e,a,!1,!0),ns[a]=Ss,e},JI=dt,ZI=tt,QI=Ch,$I=Sf,GS=Zl,uy=Ha,WS=An,HS=ec,ew=VS,hy=QI.PROPER,du=ew.BUGGY_SAFARI_ITERATORS,Np=ci("iterator"),KS="keys",lu="values",Tf="entries",py=function(){return this},YS=function(e,t,i,r,a,s,o){$I(i,t,r);var c,d,l,h=function(C){if(C===a&&T)return T;if(!du&&C&&C in m)return m[C];switch(C){case KS:case lu:case Tf:return function(){return new i(this,C)}}return function(){return new i(this)}},_=t+" Iterator",f=!1,m=e.prototype,S=m[Np]||m["@@iterator"]||a&&m[a],T=!du&&S||h(a),R=t==="Array"&&m.entries||S;if(R&&(c=GS(R.call(new e)))!==Object.prototype&&c.next&&(uy(c,_,!0,!0),HS[_]=py),hy&&a===lu&&S&&S.name!==lu&&(f=!0,T=function(){return ZI(S,this)}),a)if(d={values:h(lu),keys:s?T:h(KS),entries:h(Tf)},o)for(l in d)(du||f||!(l in m))&&WS(m,l,d[l]);else JI({target:t,proto:!0,forced:du||f},d);return o&&m[Np]!==T&&WS(m,Np,T,{}),HS[t]=T,d},uu=function(e,t){return{value:e,done:t}},tw=Js,dd=ec,um=gs;pn.f;var qN=YS,wh=uu,ld="Array Iterator",iw=um.set,zS=um.getterFor(ld);qN(Array,"Array",(function(e,t){iw(this,{type:ld,target:tw(e),index:0,kind:t})}),(function(){var e=zS(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,wh(void 0,!0);switch(e.kind){case"keys":return wh(i,!1);case"values":return wh(t[i],!1)}return wh([i,t[i]],!1)}),"values"),dd.Arguments=dd.Array;var hm=pn,en=function(e,t,i){return hm.f(e,t,i)},XN=wr,JN=en,rw=ir,Dp=ci("species"),Oh=Be,nw=TypeError,Rf=function(e,t){if(Oh(t,e))return e;throw new nw("Incorrect invocation")},pm=Jt,Io=j_,aw=ye(Function.toString);pm(Io.inspectSource)||(Io.inspectSource=function(e){return aw(e)});var _m=Io.inspectSource,sw=ye,_y=re,fm=Jt,qS=Ms,ow=_m,ud=function(){},Xn=wr("Reflect","construct"),Pp=/^\s*(?:class|function)\b/,cw=sw(Pp.exec),as=!Pp.test(ud),hu=function(e){if(!fm(e))return!1;try{return Xn(ud,[],e),!0}catch{return!1}},XS=function(e){if(!fm(e))return!1;switch(qS(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return as||!!cw(Pp,ow(e))}catch{return!0}};XS.sham=!0;var il,_r,Us,ic,Nh=!Xn||_y((function(){var e;return hu(hu.call)||!hu(Object)||!hu((function(){e=!0}))||e}))?XS:hu,dw=Nh,ZN=qo,fy=TypeError,Qs=Vr,hd=function(e){if(dw(e))return e;throw new fy(ZN(e)+" is not a constructor")},lw=Fl,rc=ci("species"),vf=function(e,t){var i,r=Qs(e).constructor;return r===void 0||lw(i=Qs(r)[rc])?t:hd(i)},aa=ye([].slice),Lp=TypeError,Ma=function(e,t){if(e<t)throw new Lp("Not enough arguments");return e},Em=/(?:ipad|iphone|ipod).*applewebkit/i.test($r),_n=ke,rl=kt,uw=rs,Dh=Jt,mm=Bi,kp=re,Ph=im,hw=aa,JS=fp,gm=Ma,pw=Em,ZS=Ic,yf=_n.setImmediate,Sm=_n.clearImmediate,QN=_n.process,Or=_n.Dispatch,In=_n.Function,Yi=_n.MessageChannel,fr=_n.String,Nr=0,_a={},nl="onreadystatechange";kp((function(){il=_n.location}));var al=function(e){if(mm(_a,e)){var t=_a[e];delete _a[e],t()}},Mp=function(e){return function(){al(e)}},pd=function(e){al(e.data)},jn=function(e){_n.postMessage(fr(e),il.protocol+"//"+il.host)};yf&&Sm||(yf=function(e){gm(arguments.length,1);var t=Dh(e)?e:In(e),i=hw(arguments,1);return _a[++Nr]=function(){rl(t,void 0,i)},_r(Nr),Nr},Sm=function(e){delete _a[e]},ZS?_r=function(e){QN.nextTick(Mp(e))}:Or&&Or.now?_r=function(e){Or.now(Mp(e))}:Yi&&!pw?(ic=(Us=new Yi).port2,Us.port1.onmessage=pd,_r=uw(ic.postMessage,ic)):_n.addEventListener&&Dh(_n.postMessage)&&!_n.importScripts&&il&&il.protocol!=="file:"&&!kp(jn)?(_r=jn,_n.addEventListener("message",pd,!1)):_r=nl in JS("script")?function(e){Ph.appendChild(JS("script"))[nl]=function(){Ph.removeChild(this),al(e)}}:function(e){setTimeout(Mp(e),0)});var wo={set:yf,clear:Sm},pu=ke,Ey=ir,Nc=Object.getOwnPropertyDescriptor,Lh=function(e){if(!Ey)return pu[e];var t=Nc(pu,e);return t&&t.value},Up=function(){this.head=null,this.tail=null};Up.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Gn,xp,Vp,kh,Cf,sl=Up,Ts=/ipad|iphone|ipod/i.test($r)&&typeof Pebble<"u",Mh=/web0s(?!.*chrome)/i.test($r),xs=ke,bf=Lh,Tm=rs,Fp=wo.set,_w=sl,Rm=Em,my=Ts,nc=Mh,Af=Ic,$s=xs.MutationObserver||xs.WebKitMutationObserver,QS=xs.document,$S=xs.process,Bp=xs.Promise,Dc=bf("queueMicrotask");if(!Dc){var ol=new _w,_u=function(){var e,t;for(Af&&(e=$S.domain)&&e.exit();t=ol.get();)try{t()}catch(i){throw ol.head&&Gn(),i}e&&e.enter()};Rm||Af||nc||!$s||!QS?!my&&Bp&&Bp.resolve?((kh=Bp.resolve(void 0)).constructor=Bp,Cf=Tm(kh.then,kh),Gn=function(){Cf(_u)}):Af?Gn=function(){$S.nextTick(_u)}:(Fp=Tm(Fp,xs),Gn=function(){Fp(_u)}):(xp=!0,Vp=QS.createTextNode(""),new $s(_u).observe(Vp,{characterData:!0}),Gn=function(){Vp.data=xp=!xp}),Dc=function(e){ol.head||Gn(),ol.add(e)}}var Uh=Dc,Pc=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Oo=ke.Promise,fw=ke,_d=Oo,gy=Jt,$N=z_,eD=_m,tD=ci,eT=uh,If=Ps,xh=_d&&_d.prototype,tT=tD("species"),iT=gy(fw.PromiseRejectionEvent),Ew=$N("Promise",(function(){var e=eD(_d),t=e!==String(_d);if(!t&&If===66||!xh.catch||!xh.finally)return!0;if(!If||If<51||!/native code/.test(e)){var i=new _d((function(a){a(1)})),r=function(a){a((function(){}),(function(){}))};if((i.constructor={})[tT]=r,!(i.then((function(){}))instanceof r))return!0}return!(t||eT!=="BROWSER"&&eT!=="DENO"||iT)})),cl={CONSTRUCTOR:Ew,REJECTION_EVENT:iT},Ua={},rT=pr,mw=TypeError,nT=function(e){var t,i;this.promise=new e((function(r,a){if(t!==void 0||i!==void 0)throw new mw("Bad Promise constructor");t=r,i=a})),this.resolve=rT(t),this.reject=rT(i)};Ua.f=function(e){return new nT(e)};var wf,aT,fn=dt,fu=Ic,eo=ke,dl=tt,iD=An,rD=Ha,nD=function(e){var t=XN(e);rw&&t&&!t[Dp]&&JN(t,Dp,{configurable:!0,get:function(){return this}})},sT=pr,ll=Jt,Sy=Ir,oT=Rf,Ty=vf,Eu=wo.set,No=Uh,vm=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},aD=Pc,gw=sl,cT=gs,Of=Oo,dT=cl,Ry=Ua,mu="Promise",lT=dT.CONSTRUCTOR,Sw=dT.REJECTION_EVENT,ym=cT.getterFor(mu),vy=cT.set,yy=Of&&Of.prototype,gu=Of,Cm=yy,jp=eo.TypeError,bm=eo.document,Nf=eo.process,Wi=Ry.f,Cy=Wi,uT=!!(bm&&bm.createEvent&&eo.dispatchEvent),Am="unhandledrejection",hT=function(e){var t;return!(!Sy(e)||!ll(t=e.then))&&t},Im=function(e,t){var i,r,a,s=t.value,o=t.state===1,c=o?e.ok:e.fail,d=e.resolve,l=e.reject,h=e.domain;try{c?(o||(t.rejection===2&&sD(t),t.rejection=1),c===!0?i=s:(h&&h.enter(),i=c(s),h&&(h.exit(),a=!0)),i===e.promise?l(new jp("Promise-chain cycle")):(r=hT(i))?dl(r,i,d,l):d(i)):l(s)}catch(_){h&&!a&&h.exit(),l(_)}},Gp=function(e,t){e.notified||(e.notified=!0,No((function(){for(var i,r=e.reactions;i=r.get();)Im(i,e);e.notified=!1,t&&!e.rejection&&Pf(e)})))},Df=function(e,t,i){var r,a;uT?((r=bm.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),eo.dispatchEvent(r)):r={promise:t,reason:i},!Sw&&(a=eo["on"+e])?a(r):e===Am&&vm("Unhandled promise rejection",i)},Pf=function(e){dl(Eu,eo,(function(){var t,i=e.facade,r=e.value;if(pT(e)&&(t=aD((function(){fu?Nf.emit("unhandledRejection",r,i):Df(Am,i,r)})),e.rejection=fu||pT(e)?2:1,t.error))throw t.value}))},pT=function(e){return e.rejection!==1&&!e.parent},sD=function(e){dl(Eu,eo,(function(){var t=e.facade;fu?Nf.emit("rejectionHandled",t):Df("rejectionhandled",t,e.value)}))},fd=function(e,t,i){return function(r){e(t,r,i)}},Lc=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Gp(e,!0))},Lf=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new jp("Promise can't be resolved itself");var r=hT(t);r?No((function(){var a={done:!1};try{dl(r,t,fd(Lf,a,e),fd(Lc,a,e))}catch(s){Lc(a,s,e)}})):(e.value=t,e.state=1,Gp(e,!1))}catch(a){Lc({done:!1},a,e)}}};lT&&(Cm=(gu=function(e){oT(this,Cm),sT(e),dl(wf,this);var t=ym(this);try{e(fd(Lf,t),fd(Lc,t))}catch(i){Lc(t,i)}}).prototype,(wf=function(e){vy(this,{type:mu,done:!1,notified:!1,parent:!1,reactions:new gw,rejection:!1,state:0,value:null})}).prototype=iD(Cm,"then",(function(e,t){var i=ym(this),r=Wi(Ty(this,gu));return i.parent=!0,r.ok=!ll(e)||e,r.fail=ll(t)&&t,r.domain=fu?Nf.domain:void 0,i.state===0?i.reactions.add(r):No((function(){Im(r,i)})),r.promise})),aT=function(){var e=new wf,t=ym(e);this.promise=e,this.resolve=fd(Lf,t),this.reject=fd(Lc,t)},Ry.f=Wi=function(e){return e===gu||e===void 0?new aT(e):Cy(e)}),fn({global:!0,wrap:!0,forced:lT},{Promise:gu}),rD(gu,mu,!1,!0),nD(mu);var kf=ci("iterator"),Xr=!1;try{var by=0,Ka={next:function(){return{done:!!by++}},return:function(){Xr=!0}};Ka[kf]=function(){return this},Array.from(Ka,(function(){throw 2}))}catch{}var oD=Oo,Ay=function(e,t){try{if(!t&&!Xr)return!1}catch{return!1}var i=!1;try{var r={};r[kf]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i},Su=cl.CONSTRUCTOR||!Ay((function(e){oD.all(e).then(void 0,(function(){}))})),_T=tt,Tw=pr,Rw=Ua,Iy=Pc,wy=el;dt({target:"Promise",stat:!0,forced:Su},{all:function(e){var t=this,i=Rw.f(t),r=i.resolve,a=i.reject,s=Iy((function(){var o=Tw(t.resolve),c=[],d=0,l=1;wy(e,(function(h){var _=d++,f=!1;l++,_T(o,t,h).then((function(m){f||(f=!0,c[_]=m,--l||r(c))}),a)})),--l||r(c)}));return s.error&&a(s.value),i.promise}});var cD=dt,vw=cl.CONSTRUCTOR;Oo&&Oo.prototype,cD({target:"Promise",proto:!0,forced:vw,real:!0},{catch:function(e){return this.then(void 0,e)}});var dD=tt,yw=pr,lD=Ua,uD=Pc,Vh=el;dt({target:"Promise",stat:!0,forced:Su},{race:function(e){var t=this,i=lD.f(t),r=i.reject,a=uD((function(){var s=yw(t.resolve);Vh(e,(function(o){dD(s,t,o).then(i.resolve,r)}))}));return a.error&&r(a.value),i.promise}});var Cw=Ua;dt({target:"Promise",stat:!0,forced:cl.CONSTRUCTOR},{reject:function(e){var t=Cw.f(this);return(0,t.reject)(e),t.promise}});var Oy=Vr,hD=Ir,pD=Ua,wm=function(e,t){if(Oy(e),hD(t)&&t.constructor===e)return t;var i=pD.f(e);return(0,i.resolve)(t),i.promise},_D=dt,Ed=Oo,Ny=cl.CONSTRUCTOR,bw=wm,Aw=wr("Promise"),Om=!Ny;_D({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return bw(Om&&this===Aw?Ed:this,e)}});var kc=tt,Iw=pr,fT=Ua,Tu=Pc,fD=el;dt({target:"Promise",stat:!0,forced:Su},{allSettled:function(e){var t=this,i=fT.f(t),r=i.resolve,a=i.reject,s=Tu((function(){var o=Iw(t.resolve),c=[],d=0,l=1;fD(e,(function(h){var _=d++,f=!1;l++,kc(o,t,h).then((function(m){f||(f=!0,c[_]={status:"fulfilled",value:m},--l||r(c))}),(function(m){f||(f=!0,c[_]={status:"rejected",reason:m},--l||r(c))}))})),--l||r(c)}));return s.error&&a(s.value),i.promise}});var ED=tt,Mf=pr,ww=wr,mD=Ua,gD=Pc,SD=el,Dy="No one promise resolved";dt({target:"Promise",stat:!0,forced:Su},{any:function(e){var t=this,i=ww("AggregateError"),r=mD.f(t),a=r.resolve,s=r.reject,o=gD((function(){var c=Mf(t.resolve),d=[],l=0,h=1,_=!1;SD(e,(function(f){var m=l++,S=!1;h++,ED(c,t,f).then((function(T){S||_||(_=!0,a(T))}),(function(T){S||_||(S=!0,d[m]=T,--h||s(new i(d,Dy)))}))})),--h||s(new i(d,Dy))}));return o.error&&s(o.value),r.promise}});var TD=dt,RD=kt,vD=aa,Ow=Ua,Uf=pr,Wp=Pc,xf=ke.Promise,Py=!1;TD({target:"Promise",stat:!0,forced:!xf||!xf.try||Wp((function(){xf.try((function(e){Py=e===8}),8)})).error||!Py},{try:function(e){var t=arguments.length>1?vD(arguments,1):[],i=Ow.f(this),r=Wp((function(){return RD(Uf(e),void 0,t)}));return(r.error?i.reject:i.resolve)(r.value),i.promise}});var Vf=Ua;dt({target:"Promise",stat:!0},{withResolvers:function(){var e=Vf.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Nm=dt,Ff=Oo,ET=re,Ly=wr,ky=Jt,mT=vf,gT=wm,Nw=Ff&&Ff.prototype;Nm({target:"Promise",proto:!0,real:!0,forced:!!Ff&&ET((function(){Nw.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=mT(this,Ly("Promise")),i=ky(e);return this.then(i?function(r){return gT(t,e()).then((function(){return r}))}:e,i?function(r){return gT(t,e()).then((function(){throw r}))}:e)}});var Dm=ye,Dw=Hl,Pm=Fr,yD=Xs,CD=Dm("".charAt),My=Dm("".charCodeAt),ST=Dm("".slice),Bf=function(e){return function(t,i){var r,a,s=Pm(yD(t)),o=Dw(i),c=s.length;return o<0||o>=c?e?"":void 0:(r=My(s,o))<55296||r>56319||o+1===c||(a=My(s,o+1))<56320||a>57343?e?CD(s,o):r:e?ST(s,o,o+2):a-56320+(r-55296<<10)+65536}},Hp={codeAt:Bf(!1),charAt:Bf(!0)},bD=Hp.charAt,Lm=Fr,Uy=gs,Pw=YS,TT=uu,RT="String Iterator",Lw=Uy.set,xy=Uy.getterFor(RT);Pw(String,"String",(function(e){Lw(this,{type:RT,string:Lm(e),index:0})}),(function(){var e,t=xy(this),i=t.string,r=t.index;return r>=i.length?TT(void 0,!0):(e=bD(i,r),t.index+=e.length,TT(e,!1))}));var kw=bn.Promise,vT={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},AD=ke,ID=Ha,km=ec;for(var Kp in vT)ID(AD[Kp],Kp),km[Kp]=km.Array;var jf=kw,se=X(jf),Mw=Bn("Array","values"),Vy=Ms,Fh=Bi,Bh=Be,jh=Mw,Ru=Array.prototype,Mm={DOMTokenList:!0,NodeList:!0},Gh=function(e){var t=e.values;return e===Ru||Bh(Ru,e)&&t===Ru.values||Fh(Mm,Vy(e))?jh:t},tn=X(Gh),yT=qo,Um=TypeError,Fy=aa,Uw=Math.floor,Wh=function(e,t){var i=e.length;if(i<8)for(var r,a,s=1;s<i;){for(a=s,r=e[s];a&&t(e[a-1],r)>0;)e[a]=e[--a];a!==s++&&(e[a]=r)}else for(var o=Uw(i/2),c=Wh(Fy(e,0,o),t),d=Wh(Fy(e,o),t),l=c.length,h=d.length,_=0,f=0;_<l||f<h;)e[_+f]=_<l&&f<h?t(c[_],d[f])<=0?c[_++]:d[f++]:_<l?c[_++]:d[f++];return e},CT=Wh,By=$r.match(/firefox\/(\d+)/i),bT=!!By&&+By[1],AT=/MSIE|Trident/.test($r),IT=$r.match(/AppleWebKit\/(\d+)\./),xm=!!IT&&+IT[1],jy=dt,Gf=ye,xw=pr,wD=Pa,Wf=Zs,u=function(e,t){if(!delete e[t])throw new Um("Cannot delete property "+yT(t)+" of "+yT(e))},p=Fr,E=re,g=CT,y=Zd,O=bT,H=AT,Z=Ps,le=xm,be=[],We=Gf(be.sort),Qe=Gf(be.push),De=E((function(){be.sort(void 0)})),Le=E((function(){be.sort(null)})),wi=y("sort"),ui=!E((function(){if(Z)return Z<70;if(!(O&&O>3)){if(H)return!0;if(le)return le<603;var e,t,i,r,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(r=0;r<47;r++)be.push({k:t+r,v:i})}for(be.sort((function(s,o){return o.v-s.v})),r=0;r<be.length;r++)t=be[r].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return a!=="DGBEFHACIJK"}}));jy({target:"Array",proto:!0,forced:De||!Le||!wi||!ui},{sort:function(e){e!==void 0&&xw(e);var t=wD(this);if(ui)return e===void 0?We(t):We(t,e);var i,r,a=[],s=Wf(t);for(r=0;r<s;r++)r in t&&Qe(a,t[r]);for(g(a,(function(o){return function(c,d){return d===void 0?-1:c===void 0?1:o!==void 0?+o(c,d)||0:p(c)>p(d)?1:-1}})(e)),i=Wf(a),r=0;r<i;)t[r]=a[r++];for(;r<s;)u(t,r++);return t}});var cn=Bn("Array","sort"),Ce=Be,Se=cn,Ie=Array.prototype,Xe=function(e){var t=e.sort;return e===Ie||Ce(Ie,e)&&t===Ie.sort?Se:t},vt=X(Xe),Zi=dt,ii=ye,yi=X_,ss=RangeError,Er=String.fromCharCode,ul=String.fromCodePoint,OD=ii([].join);Zi({target:"String",stat:!0,forced:!!ul&&ul.length!==1},{fromCodePoint:function(e){for(var t,i=[],r=arguments.length,a=0;r>a;){if(t=+arguments[a++],yi(t,1114111)!==t)throw new ss(t+" is not a valid code point");i[a]=t<65536?Er(t):Er(55296+((t-=65536)>>10),t%1024+56320)}return OD(i,"")}});var dG=re,lG=ci("iterator"),Vm=!dG((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(a,s){t.delete("b"),r+=s+a})),i.delete("a",2),i.delete("b",void 0),!e.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[lG]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"})),uG=An,Gy=dt,ND=ke,Wy=Lh,hG=wr,Fm=tt,Ya=ye,Yp=ir,DD=Vm,PD=An,pG=en,_G=function(e,t,i){for(var r in t)i&&i.unsafe&&e[r]?e[r]=t[r]:uG(e,r,t[r],i);return e},fG=Ha,EG=Sf,Hy=gs,LD=Rf,Ky=Jt,mG=Bi,gG=rs,SG=Ms,TG=Vr,kD=Ir,En=Fr,RG=od,MD=Ft,UD=Ip,vG=au,Bm=uu,vu=Ma,yG=CT,CG=ci("iterator"),yu="URLSearchParams",xD=yu+"Iterator",VD=Hy.set,fa=Hy.getterFor(yu),bG=Hy.getterFor(xD),FD=Wy("fetch"),jm=Wy("Request"),zp=Wy("Headers"),Yy=jm&&jm.prototype,BD=zp&&zp.prototype,AG=ND.TypeError,IG=ND.encodeURIComponent,wG=String.fromCharCode,OG=hG("String","fromCodePoint"),NG=parseInt,Gm=Ya("".charAt),jD=Ya([].join),ac=Ya([].push),GD=Ya("".replace),DG=Ya([].shift),WD=Ya([].splice),HD=Ya("".split),KD=Ya("".slice),PG=Ya(/./.exec),LG=/\+/g,kG=/^[0-9a-f]+$/i,YD=function(e,t){var i=KD(e,t,t+2);return PG(kG,i)?NG(i,16):NaN},MG=function(e){for(var t=0,i=128;i>0&&(e&i)!=0;i>>=1)t++;return t},UG=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},zD=function(e){for(var t=(e=GD(e,LG," ")).length,i="",r=0;r<t;){var a=Gm(e,r);if(a==="%"){if(Gm(e,r+1)==="%"||r+3>t){i+="%",r++;continue}var s=YD(e,r+1);if(s!=s){i+=a,r++;continue}r+=2;var o=MG(s);if(o===0)a=wG(s);else{if(o===1||o>4){i+="�",r++;continue}for(var c=[s],d=1;d<o&&!(++r+3>t||Gm(e,r)!=="%");){var l=YD(e,r+1);if(l!=l){r+=3;break}if(l>191||l<128)break;ac(c,l),r+=2,d++}if(c.length!==o){i+="�";continue}var h=UG(c);h===null?i+="�":a=OG(h)}}i+=a,r++}return i},xG=/[!'()~]|%20/g,VG={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},FG=function(e){return VG[e]},qD=function(e){return GD(IG(e),xG,FG)},zy=EG((function(e,t){VD(this,{type:xD,target:fa(e).entries,index:0,kind:t})}),yu,(function(){var e=bG(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,Bm(void 0,!0);var r=t[i];switch(e.kind){case"keys":return Bm(r.key,!1);case"values":return Bm(r.value,!1)}return Bm([r.key,r.value],!1)}),!0),XD=function(e){this.entries=[],this.url=null,e!==void 0&&(kD(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Gm(e,0)==="?"?KD(e,1):e:En(e)))};XD.prototype={type:yu,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,r,a,s,o,c,d=this.entries,l=vG(e);if(l)for(i=(t=UD(e,l)).next;!(r=Fm(i,t)).done;){if(s=(a=UD(TG(r.value))).next,(o=Fm(s,a)).done||(c=Fm(s,a)).done||!Fm(s,a).done)throw new AG("Expected sequence with length 2");ac(d,{key:En(o.value),value:En(c.value)})}else for(var h in e)mG(e,h)&&ac(d,{key:h,value:En(e[h])})},parseQuery:function(e){if(e)for(var t,i,r=this.entries,a=HD(e,"&"),s=0;s<a.length;)(t=a[s++]).length&&(i=HD(t,"="),ac(r,{key:zD(DG(i)),value:zD(jD(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],ac(i,qD(e.key)+"="+qD(e.value));return jD(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Wm=function(){LD(this,Cu);var e=VD(this,new XD(arguments.length>0?arguments[0]:void 0));Yp||(this.size=e.entries.length)},Cu=Wm.prototype;if(_G(Cu,{append:function(e,t){var i=fa(this);vu(arguments.length,2),ac(i.entries,{key:En(e),value:En(t)}),Yp||this.length++,i.updateURL()},delete:function(e){for(var t=fa(this),i=vu(arguments.length,1),r=t.entries,a=En(e),s=i<2?void 0:arguments[1],o=s===void 0?s:En(s),c=0;c<r.length;){var d=r[c];if(d.key!==a||o!==void 0&&d.value!==o)c++;else if(WD(r,c,1),o!==void 0)break}Yp||(this.size=r.length),t.updateURL()},get:function(e){var t=fa(this).entries;vu(arguments.length,1);for(var i=En(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null},getAll:function(e){var t=fa(this).entries;vu(arguments.length,1);for(var i=En(e),r=[],a=0;a<t.length;a++)t[a].key===i&&ac(r,t[a].value);return r},has:function(e){for(var t=fa(this).entries,i=vu(arguments.length,1),r=En(e),a=i<2?void 0:arguments[1],s=a===void 0?a:En(a),o=0;o<t.length;){var c=t[o++];if(c.key===r&&(s===void 0||c.value===s))return!0}return!1},set:function(e,t){var i=fa(this);vu(arguments.length,1);for(var r,a=i.entries,s=!1,o=En(e),c=En(t),d=0;d<a.length;d++)(r=a[d]).key===o&&(s?WD(a,d--,1):(s=!0,r.value=c));s||ac(a,{key:o,value:c}),Yp||(this.size=a.length),i.updateURL()},sort:function(){var e=fa(this);yG(e.entries,(function(t,i){return t.key>i.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,i=fa(this).entries,r=gG(e,arguments.length>1?arguments[1]:void 0),a=0;a<i.length;)r((t=i[a++]).value,t.key,this)},keys:function(){return new zy(this,"keys")},values:function(){return new zy(this,"values")},entries:function(){return new zy(this,"entries")}},{enumerable:!0}),PD(Cu,CG,Cu.entries,{}),PD(Cu,"toString",(function(){return fa(this).serialize()}),{enumerable:!0}),Yp&&pG(Cu,"size",{get:function(){return fa(this).entries.length},configurable:!0,enumerable:!0}),fG(Wm,yu),Gy({global:!0,forced:!DD},{URLSearchParams:Wm}),!DD&&Ky(zp)){var BG=Ya(BD.has),jG=Ya(BD.set),JD=function(e){if(kD(e)){var t,i=e.body;if(SG(i)===yu)return t=e.headers?new zp(e.headers):new zp,BG(t,"content-type")||jG(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),RG(e,{body:MD(0,En(i)),headers:MD(0,t)})}return e};if(Ky(FD)&&Gy({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return FD(e,arguments.length>1?JD(arguments[1]):{})}}),Ky(jm)){var qy=function(e){return LD(this,Yy),new jm(e,arguments.length>1?JD(arguments[1]):{})};Yy.constructor=qy,qy.prototype=Yy,Gy({global:!0,dontCallGetSet:!0,forced:!0},{Request:qy})}}var Ea,GG={URLSearchParams:Wm,getState:fa},WG=bn.URLSearchParams,ZD=ir,HG=ye,KG=tt,YG=re,Xy=iu,zG=sd,qG=ni,XG=Pa,JG=mo,bu=Object.assign,QD=Object.defineProperty,ZG=HG([].concat),QG=!bu||YG((function(){if(ZD&&bu({b:1},bu(QD({},"a",{enumerable:!0,get:function(){QD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},i=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach((function(a){t[a]=a})),bu({},e)[i]!==7||Xy(bu({},t)).join("")!==r}))?function(e,t){for(var i=XG(e),r=arguments.length,a=1,s=zG.f,o=qG.f;r>a;)for(var c,d=JG(arguments[a++]),l=s?ZG(Xy(d),s(d)):Xy(d),h=l.length,_=0;h>_;)c=l[_++],ZD&&!KG(o,d,c)||(i[c]=d[c]);return i}:bu,$G=Vr,e5=OS,t5=ir,i5=pn,r5=Ft,Jy=function(e,t,i){t5?i5.f(e,t,r5(0,i)):e[t]=i},n5=rs,a5=tt,s5=Pa,o5=function(e,t,i,r){try{return r?t($G(i)[0],i[1]):t(i)}catch(a){e5(e,"throw",a)}},c5=$v,d5=Nh,l5=Zs,$D=Jy,u5=Ip,h5=au,eP=Array,md=ye,Zy=2147483647,p5=/[^\0-\u007E]/,tP=/[.\u3002\uFF0E\uFF61]/g,iP="Overflow: input needs wider integers to process",rP=RangeError,_5=md(tP.exec),Au=Math.floor,Qy=String.fromCharCode,nP=md("".charCodeAt),aP=md([].join),sc=md([].push),f5=md("".replace),E5=md("".split),m5=md("".toLowerCase),sP=function(e){return e+22+75*(e<26)},g5=function(e,t,i){var r=0;for(e=i?Au(e/700):e>>1,e+=Au(e/t);e>455;)e=Au(e/35),r+=36;return Au(r+36*e/(e+38))},S5=function(e){var t=[];e=(function(C){for(var b=[],N=0,k=C.length;N<k;){var P=nP(C,N++);if(P>=55296&&P<=56319&&N<k){var U=nP(C,N++);(64512&U)==56320?sc(b,((1023&P)<<10)+(1023&U)+65536):(sc(b,P),N--)}else sc(b,P)}return b})(e);var i,r,a=e.length,s=128,o=0,c=72;for(i=0;i<e.length;i++)(r=e[i])<128&&sc(t,Qy(r));var d=t.length,l=d;for(d&&sc(t,"-");l<a;){var h=Zy;for(i=0;i<e.length;i++)(r=e[i])>=s&&r<h&&(h=r);var _=l+1;if(h-s>Au((Zy-o)/_))throw new rP(iP);for(o+=(h-s)*_,s=h,i=0;i<e.length;i++){if((r=e[i])<s&&++o>Zy)throw new rP(iP);if(r===s){for(var f=o,m=36;;){var S=m<=c?1:m>=c+26?26:m-c;if(f<S)break;var T=f-S,R=36-S;sc(t,Qy(sP(S+T%R))),f=Au(T/R),m+=36}sc(t,Qy(sP(f))),c=g5(o,_,l===d),o=0,l++}}o++,s++}return aP(t,"")},T5=dt,$y=ir,R5=Vm,eC=ke,oP=rs,ma=ye,Hm=An,ga=en,v5=Rf,tC=Bi,iC=QG,Iu=function(e){var t=s5(e),i=d5(this),r=arguments.length,a=r>1?arguments[1]:void 0,s=a!==void 0;s&&(a=n5(a,r>2?arguments[2]:void 0));var o,c,d,l,h,_,f=h5(t),m=0;if(!f||this===eP&&c5(f))for(o=l5(t),c=i?new this(o):eP(o);o>m;m++)_=s?a(t[m],m):t[m],$D(c,m,_);else for(c=i?new this:[],h=(l=u5(t,f)).next;!(d=a5(h,l)).done;m++)_=s?o5(l,a,[d.value,m],!0):d.value,$D(c,m,_);return c.length=m,c},za=aa,y5=Hp.codeAt,C5=function(e){var t,i,r=[],a=E5(f5(m5(e),tP,"."),".");for(t=0;t<a.length;t++)i=a[t],sc(r,_5(p5,i)?"xn--"+S5(i):i);return aP(r,".")},to=Fr,b5=Ha,A5=Ma,cP=GG,dP=gs,I5=dP.set,Km=dP.getterFor("URL"),w5=cP.URLSearchParams,O5=cP.getState,qp=eC.URL,rC=eC.TypeError,Ym=eC.parseInt,N5=Math.floor,lP=Math.pow,Sa=ma("".charAt),qa=ma(/./.exec),Xp=ma([].join),D5=ma(1 .toString),P5=ma([].pop),wu=ma([].push),nC=ma("".replace),L5=ma([].shift),k5=ma("".split),Jp=ma("".slice),zm=ma("".toLowerCase),M5=ma([].unshift),aC="Invalid scheme",Ou="Invalid host",uP="Invalid port",hP=/[a-z]/i,U5=/[\d+-.a-z]/i,sC=/\d/,x5=/^0x/i,V5=/^[0-7]+$/,F5=/^\d+$/,pP=/^[\da-f]+$/i,B5=/[\0\t\n\r #%/:<>?@[\\\]^|]/,j5=/[\0\t\n\r #/:<>?@[\\\]^|]/,G5=/^[\u0000-\u0020]+/,W5=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,H5=/[\t\n\r]/g,Zp=function(e){var t,i,r,a;if(typeof e=="number"){for(t=[],i=0;i<4;i++)M5(t,e%256),e=N5(e/256);return Xp(t,".")}if(typeof e=="object"){for(t="",r=(function(s){for(var o=null,c=1,d=null,l=0,h=0;h<8;h++)s[h]!==0?(l>c&&(o=d,c=l),d=null,l=0):(d===null&&(d=h),++l);return l>c?d:o})(e),i=0;i<8;i++)a&&e[i]===0||(a&&(a=!1),r===i?(t+=i?":":"::",a=!0):(t+=D5(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},qm={},_P=iC({},qm,{" ":1,'"':1,"<":1,">":1,"`":1}),fP=iC({},_P,{"#":1,"?":1,"{":1,"}":1}),oC=iC({},fP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),oc=function(e,t){var i=y5(e,0);return i>32&&i<127&&!tC(t,e)?e:encodeURIComponent(e)},Xm={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Qp=function(e,t){var i;return e.length===2&&qa(hP,Sa(e,0))&&((i=Sa(e,1))===":"||!t&&i==="|")},EP=function(e){var t;return e.length>1&&Qp(Jp(e,0,2))&&(e.length===2||(t=Sa(e,2))==="/"||t==="\\"||t==="?"||t==="#")},K5=function(e){return e==="."||zm(e)==="%2e"},cC={},mP={},dC={},gP={},SP={},lC={},TP={},RP={},Jm={},Zm={},uC={},hC={},pC={},_C={},vP={},fC={},Nu={},Rs={},yP={},gd={},io={},EC=function(e,t,i){var r,a,s,o=to(e);if(t){if(a=this.parse(o))throw new rC(a);this.searchParams=null}else{if(i!==void 0&&(r=new EC(i,!0)),a=this.parse(o,null,r))throw new rC(a);(s=O5(new w5)).bindURL(this),this.searchParams=s}};EC.prototype={type:"URL",parse:function(e,t,i){var r,a,s,o,c,d=this,l=t||cC,h=0,_="",f=!1,m=!1,S=!1;for(e=to(e),t||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,e=nC(e,G5,""),e=nC(e,W5,"$1")),e=nC(e,H5,""),r=Iu(e);h<=r.length;){switch(a=r[h],l){case cC:if(!a||!qa(hP,a)){if(t)return aC;l=dC;continue}_+=zm(a),l=mP;break;case mP:if(a&&(qa(U5,a)||a==="+"||a==="-"||a==="."))_+=zm(a);else{if(a!==":"){if(t)return aC;_="",l=dC,h=0;continue}if(t&&(d.isSpecial()!==tC(Xm,_)||_==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=_,t)return void(d.isSpecial()&&Xm[d.scheme]===d.port&&(d.port=null));_="",d.scheme==="file"?l=_C:d.isSpecial()&&i&&i.scheme===d.scheme?l=gP:d.isSpecial()?l=RP:r[h+1]==="/"?(l=SP,h++):(d.cannotBeABaseURL=!0,wu(d.path,""),l=yP)}break;case dC:if(!i||i.cannotBeABaseURL&&a!=="#")return aC;if(i.cannotBeABaseURL&&a==="#"){d.scheme=i.scheme,d.path=za(i.path),d.query=i.query,d.fragment="",d.cannotBeABaseURL=!0,l=io;break}l=i.scheme==="file"?_C:lC;continue;case gP:if(a!=="/"||r[h+1]!=="/"){l=lC;continue}l=Jm,h++;break;case SP:if(a==="/"){l=Zm;break}l=Rs;continue;case lC:if(d.scheme=i.scheme,a===Ea)d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=za(i.path),d.query=i.query;else if(a==="/"||a==="\\"&&d.isSpecial())l=TP;else if(a==="?")d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=za(i.path),d.query="",l=gd;else{if(a!=="#"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=za(i.path),d.path.length--,l=Rs;continue}d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=za(i.path),d.query=i.query,d.fragment="",l=io}break;case TP:if(!d.isSpecial()||a!=="/"&&a!=="\\"){if(a!=="/"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,l=Rs;continue}l=Zm}else l=Jm;break;case RP:if(l=Jm,a!=="/"||Sa(_,h+1)!=="/")continue;h++;break;case Jm:if(a!=="/"&&a!=="\\"){l=Zm;continue}break;case Zm:if(a==="@"){f&&(_="%40"+_),f=!0,s=Iu(_);for(var T=0;T<s.length;T++){var R=s[T];if(R!==":"||S){var C=oc(R,oC);S?d.password+=C:d.username+=C}else S=!0}_=""}else if(a===Ea||a==="/"||a==="?"||a==="#"||a==="\\"&&d.isSpecial()){if(f&&_==="")return"Invalid authority";h-=Iu(_).length+1,_="",l=uC}else _+=a;break;case uC:case hC:if(t&&d.scheme==="file"){l=fC;continue}if(a!==":"||m){if(a===Ea||a==="/"||a==="?"||a==="#"||a==="\\"&&d.isSpecial()){if(d.isSpecial()&&_==="")return Ou;if(t&&_===""&&(d.includesCredentials()||d.port!==null))return;if(o=d.parseHost(_))return o;if(_="",l=Nu,t)return;continue}a==="["?m=!0:a==="]"&&(m=!1),_+=a}else{if(_==="")return Ou;if(o=d.parseHost(_))return o;if(_="",l=pC,t===hC)return}break;case pC:if(!qa(sC,a)){if(a===Ea||a==="/"||a==="?"||a==="#"||a==="\\"&&d.isSpecial()||t){if(_!==""){var b=Ym(_,10);if(b>65535)return uP;d.port=d.isSpecial()&&b===Xm[d.scheme]?null:b,_=""}if(t)return;l=Nu;continue}return uP}_+=a;break;case _C:if(d.scheme="file",a==="/"||a==="\\")l=vP;else{if(!i||i.scheme!=="file"){l=Rs;continue}switch(a){case Ea:d.host=i.host,d.path=za(i.path),d.query=i.query;break;case"?":d.host=i.host,d.path=za(i.path),d.query="",l=gd;break;case"#":d.host=i.host,d.path=za(i.path),d.query=i.query,d.fragment="",l=io;break;default:EP(Xp(za(r,h),""))||(d.host=i.host,d.path=za(i.path),d.shortenPath()),l=Rs;continue}}break;case vP:if(a==="/"||a==="\\"){l=fC;break}i&&i.scheme==="file"&&!EP(Xp(za(r,h),""))&&(Qp(i.path[0],!0)?wu(d.path,i.path[0]):d.host=i.host),l=Rs;continue;case fC:if(a===Ea||a==="/"||a==="\\"||a==="?"||a==="#"){if(!t&&Qp(_))l=Rs;else if(_===""){if(d.host="",t)return;l=Nu}else{if(o=d.parseHost(_))return o;if(d.host==="localhost"&&(d.host=""),t)return;_="",l=Nu}continue}_+=a;break;case Nu:if(d.isSpecial()){if(l=Rs,a!=="/"&&a!=="\\")continue}else if(t||a!=="?")if(t||a!=="#"){if(a!==Ea&&(l=Rs,a!=="/"))continue}else d.fragment="",l=io;else d.query="",l=gd;break;case Rs:if(a===Ea||a==="/"||a==="\\"&&d.isSpecial()||!t&&(a==="?"||a==="#")){if((c=zm(c=_))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(d.shortenPath(),a==="/"||a==="\\"&&d.isSpecial()||wu(d.path,"")):K5(_)?a==="/"||a==="\\"&&d.isSpecial()||wu(d.path,""):(d.scheme==="file"&&!d.path.length&&Qp(_)&&(d.host&&(d.host=""),_=Sa(_,0)+":"),wu(d.path,_)),_="",d.scheme==="file"&&(a===Ea||a==="?"||a==="#"))for(;d.path.length>1&&d.path[0]==="";)L5(d.path);a==="?"?(d.query="",l=gd):a==="#"&&(d.fragment="",l=io)}else _+=oc(a,fP);break;case yP:a==="?"?(d.query="",l=gd):a==="#"?(d.fragment="",l=io):a!==Ea&&(d.path[0]+=oc(a,qm));break;case gd:t||a!=="#"?a!==Ea&&(a==="'"&&d.isSpecial()?d.query+="%27":d.query+=a==="#"?"%23":oc(a,qm)):(d.fragment="",l=io);break;case io:a!==Ea&&(d.fragment+=oc(a,_P))}h++}},parseHost:function(e){var t,i,r;if(Sa(e,0)==="["){if(Sa(e,e.length-1)!=="]"||(t=(function(a){var s,o,c,d,l,h,_,f=[0,0,0,0,0,0,0,0],m=0,S=null,T=0,R=function(){return Sa(a,T)};if(R()===":"){if(Sa(a,1)!==":")return;T+=2,S=++m}for(;R();){if(m===8)return;if(R()!==":"){for(s=o=0;o<4&&qa(pP,R());)s=16*s+Ym(R(),16),T++,o++;if(R()==="."){if(o===0||(T-=o,m>6))return;for(c=0;R();){if(d=null,c>0){if(!(R()==="."&&c<4))return;T++}if(!qa(sC,R()))return;for(;qa(sC,R());){if(l=Ym(R(),10),d===null)d=l;else{if(d===0)return;d=10*d+l}if(d>255)return;T++}f[m]=256*f[m]+d,++c!=2&&c!==4||m++}if(c!==4)return;break}if(R()===":"){if(T++,!R())return}else if(R())return;f[m++]=s}else{if(S!==null)return;T++,S=++m}}if(S!==null)for(h=m-S,m=7;m!==0&&h>0;)_=f[m],f[m--]=f[S+h-1],f[S+--h]=_;else if(m!==8)return;return f})(Jp(e,1,-1)),!t))return Ou;this.host=t}else if(this.isSpecial()){if(e=C5(e),qa(B5,e)||(t=(function(a){var s,o,c,d,l,h,_,f=k5(a,".");if(f.length&&f[f.length-1]===""&&f.length--,(s=f.length)>4)return a;for(o=[],c=0;c<s;c++){if((d=f[c])==="")return a;if(l=10,d.length>1&&Sa(d,0)==="0"&&(l=qa(x5,d)?16:8,d=Jp(d,l===8?1:2)),d==="")h=0;else{if(!qa(l===10?F5:l===8?V5:pP,d))return a;h=Ym(d,l)}wu(o,h)}for(c=0;c<s;c++)if(h=o[c],c===s-1){if(h>=lP(256,5-s))return null}else if(h>255)return null;for(_=P5(o),c=0;c<o.length;c++)_+=o[c]*lP(256,3-c);return _})(e),t===null))return Ou;this.host=t}else{if(qa(j5,e))return Ou;for(t="",i=Iu(e),r=0;r<i.length;r++)t+=oc(i[r],qm);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return tC(Xm,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&Qp(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,r=e.password,a=e.host,s=e.port,o=e.path,c=e.query,d=e.fragment,l=t+":";return a!==null?(l+="//",e.includesCredentials()&&(l+=i+(r?":"+r:"")+"@"),l+=Zp(a),s!==null&&(l+=":"+s)):t==="file"&&(l+="//"),l+=e.cannotBeABaseURL?o[0]:o.length?"/"+Xp(o,"/"):"",c!==null&&(l+="?"+c),d!==null&&(l+="#"+d),l},setHref:function(e){var t=this.parse(e);if(t)throw new rC(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Du(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Zp(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(to(e)+":",cC)},getUsername:function(){return this.username},setUsername:function(e){var t=Iu(to(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=oc(t[i],oC)}},getPassword:function(){return this.password},setPassword:function(e){var t=Iu(to(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=oc(t[i],oC)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Zp(e):Zp(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,uC)},getHostname:function(){var e=this.host;return e===null?"":Zp(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,hC)},getPort:function(){var e=this.port;return e===null?"":to(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=to(e))===""?this.port=null:this.parse(e,pC))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Xp(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Nu))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=to(e))===""?this.query=null:(Sa(e,0)==="?"&&(e=Jp(e,1)),this.query="",this.parse(e,gd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=to(e))!==""?(Sa(e,0)==="#"&&(e=Jp(e,1)),this.fragment="",this.parse(e,io)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Du=function(e){var t=v5(this,mn),i=A5(arguments.length,1)>1?arguments[1]:void 0,r=I5(t,new EC(e,!1,i));$y||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},mn=Du.prototype,Ta=function(e,t){return{get:function(){return Km(this)[e]()},set:t&&function(i){return Km(this)[t](i)},configurable:!0,enumerable:!0}};if($y&&(ga(mn,"href",Ta("serialize","setHref")),ga(mn,"origin",Ta("getOrigin")),ga(mn,"protocol",Ta("getProtocol","setProtocol")),ga(mn,"username",Ta("getUsername","setUsername")),ga(mn,"password",Ta("getPassword","setPassword")),ga(mn,"host",Ta("getHost","setHost")),ga(mn,"hostname",Ta("getHostname","setHostname")),ga(mn,"port",Ta("getPort","setPort")),ga(mn,"pathname",Ta("getPathname","setPathname")),ga(mn,"search",Ta("getSearch","setSearch")),ga(mn,"searchParams",Ta("getSearchParams")),ga(mn,"hash",Ta("getHash","setHash"))),Hm(mn,"toJSON",(function(){return Km(this).serialize()}),{enumerable:!0}),Hm(mn,"toString",(function(){return Km(this).serialize()}),{enumerable:!0}),qp){var CP=qp.createObjectURL,bP=qp.revokeObjectURL;CP&&Hm(Du,"createObjectURL",oP(CP,qp)),bP&&Hm(Du,"revokeObjectURL",oP(bP,qp))}b5(Du,"URL"),T5({global:!0,forced:!R5,sham:!$y},{URL:Du});var Y5=dt,AP=re,z5=Ma,IP=Fr,q5=Vm,mC=wr("URL"),X5=q5&&AP((function(){mC.canParse()})),J5=AP((function(){return mC.canParse.length!==1}));Y5({target:"URL",stat:!0,forced:!X5||J5},{canParse:function(e){var t=z5(arguments.length,1),i=IP(e),r=t<2||arguments[1]===void 0?void 0:IP(arguments[1]);try{return!!new mC(i,r)}catch{return!1}}});var Z5=dt,Q5=Ma,wP=Fr,$5=Vm,e6=wr("URL");Z5({target:"URL",stat:!0,forced:!$5},{parse:function(e){var t=Q5(arguments.length,1),i=wP(e),r=t<2||arguments[1]===void 0?void 0:wP(arguments[1]);try{return new e6(i,r)}catch{return null}}});var Qm=X(bn.URL);let OP=!0,NP=!0;function $m(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function Sd(e,t,i){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,a=r.addEventListener;r.addEventListener=function(o,c){if(o!==t)return a.apply(this,arguments);const d=l=>{const h=i(l);h&&(c.handleEvent?c.handleEvent(h):c(h))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,d),a.apply(this,[o,d])};const s=r.removeEventListener;r.removeEventListener=function(o,c){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(c))return s.apply(this,arguments);const d=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,d])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function t6(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(OP=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function i6(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(NP=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function DP(){if(typeof window=="object"){if(OP)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function gC(e,t){NP&&console.warn(e+" is deprecated, please use "+t+" instead.")}function PP(e){return Object.prototype.toString.call(e)==="[object Object]"}function LP(e){var t;return PP(e)?Pn(t=Object.keys(e)).call(t,(function(i,r){const a=PP(e[r]),s=a?LP(e[r]):e[r],o=a&&!Object.keys(s).length;return s===void 0||o?i:Object.assign(i,{[r]:s})}),{}):e}function SC(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?SC(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach((a=>{SC(e,e.get(a),i)}))})))}function kP(e,t,i){const r=i?"outbound-rtp":"inbound-rtp",a=new Map;if(t===null)return a;const s=[];return e.forEach((o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)})),s.forEach((o=>{e.forEach((c=>{c.type===r&&c.trackId===o.id&&SC(e,c,a)}))})),a}const MP=DP;function UP(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach((d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const l=typeof o[d]=="object"?o[d]:{ideal:o[d]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);const h=function(_,f){return _?_+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(l.ideal!==void 0){c.optional=c.optional||[];let _={};typeof l.ideal=="number"?(_[h("min",d)]=l.ideal,c.optional.push(_),_={},_[h("max",d)]=l.ideal,c.optional.push(_)):(_[h("",d)]=l.ideal,c.optional.push(_))}l.exact!==void 0&&typeof l.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=l.exact):["min","max"].forEach((_=>{l[_]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(_,d)]=l[_])}))})),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},a=function(o,c){if(t.version>=61)return c(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const d=function(l,h,_){h in l&&!(_ in l)&&(l[_]=l[h],delete l[h])};d((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),d(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let d=o.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const l=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||l)){let h;if(delete o.video.facingMode,d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(h=["front"]),h)return i.mediaDevices.enumerateDevices().then((_=>{_=_.filter((m=>m.kind==="videoinput"));let f=_.find((m=>h.some((S=>{var T;return ee(T=m.label.toLowerCase()).call(T,S)}))));return!f&&_.length&&ee(h).call(h,"back")&&(f=_[_.length-1]),f&&(o.video.deviceId=d.exact?{exact:f.deviceId}:{ideal:f.deviceId}),o.video=r(o.video),MP("chrome: "+JSON.stringify(o)),c(o)}))}o.video=r(o.video)}return MP("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(o,c,d){a(o,(l=>{i.webkitGetUserMedia(l,c,(h=>{d&&d(s(h))}))}))}).bind(i),i.mediaDevices.getUserMedia){const o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(c){return a(c,(d=>o(d).then((l=>{if(d.audio&&!l.getAudioTracks().length||d.video&&!l.getVideoTracks().length)throw l.getTracks().forEach((h=>{h.stop()})),new DOMException("","NotFoundError");return l}),(l=>se.reject(s(l))))))}}}function xP(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function VP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",(r=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((o=>o.track&&o.track.id===r.track.id)):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=a,s.transceiver={receiver:a},s.streams=[i.stream],this.dispatchEvent(s)})),i.stream.getTracks().forEach((r=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((o=>o.track&&o.track.id===r.id)):{track:r};const s=new Event("track");s.track=r,s.receiver=a,s.transceiver={receiver:a},s.streams=[i.stream],this.dispatchEvent(s)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Sd(e,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function FP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(a,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=a.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let d=a.apply(this,arguments);return d||(d=t(this,o),this._senders.push(d)),d};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],i.apply(this,[a]),a.getTracks().forEach((s=>{this._senders.push(t(this,s))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],r.apply(this,[a]),a.getTracks().forEach((s=>{const o=this._senders.find((c=>c.track===s));o&&this._senders.splice(this._senders.indexOf(o),1)}))}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach((r=>r._pc=this)),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function BP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,r,a]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);const s=function(c){const d={};return c.result().forEach((l=>{const h={id:l.id,timestamp:l.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type};l.names().forEach((_=>{h[_]=l.stat(_)})),d[h.id]=h})),d},o=function(c){return new Map(Object.keys(c).map((d=>[d,c[d]])))};if(arguments.length>=2){const c=function(d){r(o(s(d)))};return t.apply(this,[c,i])}return new se(((c,d)=>{t.apply(this,[function(l){c(o(s(l)))},d])})).then(r,a)}}function jP(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=i.apply(this,[]);return a.forEach((s=>s._pc=this)),a});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then((s=>kP(s,a.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=i.apply(this,[]);return r.forEach((a=>a._pc=this)),r}),Sd(e,"track",(r=>(r.receiver._pc=r.srcElement,r))),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then((a=>kP(a,r.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let r,a,s;return this.getSenders().forEach((o=>{o.track===i&&(r?s=!0:r=o)})),this.getReceivers().forEach((o=>(o.track===i&&(a?s=!0:a=o),o.track===i))),s||r&&a?se.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():a?a.getStats():se.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function GP(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((s=>this._shimmedLocalStreams[s][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach((d=>{if(this.getSenders().find((h=>h.track===d)))throw new DOMException("Track already exists.","InvalidAccessError")}));const o=this.getSenders();i.apply(this,arguments);const c=this.getSenders().filter((d=>o.indexOf(d)===-1));this._shimmedLocalStreams[s.id]=[s].concat(c)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach((o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]})),a.apply(this,arguments)}}function WP(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return GP(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const d=i.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map((l=>this._reverseStreams[l.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach((l=>{if(this.getSenders().find((_=>_.track===l)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[d.id]){const l=new e.MediaStream(d.getTracks());this._streams[d.id]=l,this._reverseStreams[l.id]=d,d=l}r.apply(this,[d])};const a=e.RTCPeerConnection.prototype.removeStream;function s(d,l){let h=l.sdp;return Object.keys(d._reverseStreams||[]).forEach((_=>{const f=d._reverseStreams[_],m=d._streams[f.id];h=h.replace(new RegExp(m.id,"g"),f.id)})),new RTCSessionDescription({type:l.type,sdp:h})}e.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},e.RTCPeerConnection.prototype.addTrack=function(d,l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find((m=>m===d)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((m=>m.track===d)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const f=this._streams[l.id];if(f)f.addTrack(d),se.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const m=new e.MediaStream([d]);this._streams[l.id]=m,this._reverseStreams[m.id]=l,this.addStream(m)}return this.getSenders().find((m=>m.track===d))},["createOffer","createAnswer"].forEach((function(d){const l=e.RTCPeerConnection.prototype[d],h={[d](){const _=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[f=>{const m=s(this,f);_[0].apply(null,[m])},f=>{_[1]&&_[1].apply(null,f)},arguments[2]]):l.apply(this,arguments).then((f=>s(this,f)))}};e.RTCPeerConnection.prototype[d]=h[d]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(d,l){let h=l.sdp;return Object.keys(d._reverseStreams||[]).forEach((_=>{const f=d._reverseStreams[_],m=d._streams[f.id];h=h.replace(new RegExp(f.id,"g"),m.id)})),new RTCSessionDescription({type:l.type,sdp:h})})(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:s(this,d)}}),e.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let l;this._streams=this._streams||{},Object.keys(this._streams).forEach((h=>{this._streams[h].getTracks().find((_=>d.track===_))&&(l=this._streams[h])})),l&&(l.getTracks().length===1?this.removeStream(this._reverseStreams[l.id]):l.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function TC(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(i){const r=e.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=a[i]}))}function HP(e,t){Sd(e,"negotiationneeded",(i=>{const r=i.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return i}))}var KP=Object.freeze({__proto__:null,fixNegotiationNeeded:HP,shimAddTrackRemoveTrack:WP,shimAddTrackRemoveTrackWithNative:GP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then((r=>{const a=i.video&&i.video.width,s=i.video&&i.video.height,o=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},a&&(i.video.mandatory.maxWidth=a),s&&(i.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(i)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:FP,shimGetStats:BP,shimGetUserMedia:UP,shimMediaStream:xP,shimOnTrack:VP,shimPeerConnection:TC,shimSenderReceiverGetStats:jP});function YP(e,t){const i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(a,s,o){gC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(a).then(s,o)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const a=function(o,c,d){c in o&&!(d in o)&&(o[d]=o[c],delete o[c])},s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),a(o.audio,"autoGainControl","mozAutoGainControl"),a(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const c=o.apply(this,arguments);return a(c,"mozAutoGainControl","autoGainControl"),a(c,"mozNoiseSuppression","noiseSuppression"),c}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),a(c,"autoGainControl","mozAutoGainControl"),a(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function zP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function RC(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(a){const s=e.RTCPeerConnection.prototype[a],o={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=o[a]}));const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[a,s,o]=arguments;return r.apply(this,[a||null]).then((c=>{if(t.version<53&&!s)try{c.forEach((d=>{d.type=i[d.type]||d.type}))}catch(d){if(d.name!=="TypeError")throw d;c.forEach(((l,h)=>{c.set(h,Object.assign({},l,{type:i[l.type]||l.type}))}))}return c})).then(s,o)}}function qP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach((a=>a._pc=this)),r});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):se.resolve(new Map)}}function XP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach((r=>r._pc=this)),i}),Sd(e,"track",(i=>(i.receiver._pc=i.srcElement,i))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function JP(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){gC("removeStream","removeTrack"),this.getSenders().forEach((i=>{var r;i.track&&ee(r=t.getTracks()).call(r,i.track)&&this.removeTrack(i)}))})}function ZP(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function QP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach((s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const a=t.apply(this,arguments);if(r){const{sender:s}=a,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=i,s.sendEncodings=i,this.setParametersPromises.push(s.setParameters(o).then((()=>{delete s.sendEncodings})).catch((()=>{delete s.sendEncodings}))))}return a})}function $P(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function eL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?se.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function tL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?se.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var iL=Object.freeze({__proto__:null,shimAddTransceiver:QP,shimCreateAnswer:tL,shimCreateOffer:eL,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,se.reject(r)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:$P,shimGetUserMedia:YP,shimOnTrack:zP,shimPeerConnection:RC,shimRTCDataChannel:ZP,shimReceiverGetStats:XP,shimRemoveStream:JP,shimSenderGetStats:qP});function rL(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var r;this._localStreams||(this._localStreams=[]),ee(r=this._localStreams).call(r,i)||this._localStreams.push(i),i.getAudioTracks().forEach((a=>t.call(this,a,i))),i.getVideoTracks().forEach((a=>t.call(this,a,i)))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];return a&&a.forEach((o=>{var c;this._localStreams?ee(c=this._localStreams).call(c,o)||this._localStreams.push(o):this._localStreams=[o]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const r=t.getTracks();this.getSenders().forEach((a=>{ee(r).call(r,a.track)&&this.removeTrack(a)}))})}}function nL(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach((a=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),ee(s=this._remoteStreams).call(s,a))return;this._remoteStreams.push(a);const o=new Event("addstream");o.stream=a,this.dispatchEvent(o)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach((a=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(a)>=0)return;i._remoteStreams.push(a);const s=new Event("addstream");s.stream=a,i.dispatchEvent(s)}))}),t.apply(i,arguments)}}}function aL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,a=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(d,l){const h=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[h]);return l?(_.then(d,l),se.resolve()):_},t.createAnswer=function(d,l){const h=arguments.length>=2?arguments[2]:arguments[0],_=r.apply(this,[h]);return l?(_.then(d,l),se.resolve()):_};let c=function(d,l,h){const _=a.apply(this,[d]);return h?(_.then(l,h),se.resolve()):_};t.setLocalDescription=c,c=function(d,l,h){const _=s.apply(this,[d]);return h?(_.then(l,h),se.resolve()):_},t.setRemoteDescription=c,c=function(d,l,h){const _=o.apply(this,[d]);return h?(_.then(l,h),se.resolve()):_},t.addIceCandidate=c}function sL(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=a=>r(oL(a))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,r,a){t.mediaDevices.getUserMedia(i).then(r,a)}).bind(t))}function oL(e){return e&&e.video!==void 0?Object.assign({},e,{video:LP(e.video)}):e}function cL(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const a=[];for(let s=0;s<i.iceServers.length;s++){let o=i.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(gC("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,a.push(o)):a.push(i.iceServers[s])}i.iceServers=a}return new t(i,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function dL(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function lL(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find((s=>s.receiver.track.kind==="audio"));i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const a=this.getTransceivers().find((s=>s.receiver.track.kind==="video"));i.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):i.offerToReceiveVideo!==!0||a||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function uL(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var hL=Object.freeze({__proto__:null,shimAudioContext:uL,shimCallbacksAPI:aL,shimConstraints:oL,shimCreateOfferLegacy:lL,shimGetUserMedia:sL,shimLocalStreamsAPI:rL,shimRTCIceServerUrls:cL,shimRemoteStreamsAPI:nL,shimTrackEventTransceiver:dL}),pL=`	
\v\f\r                　\u2028\u2029\uFEFF`,r6=Xs,n6=Fr,vC=pL,_L=ye("".replace),a6=RegExp("^["+vC+"]+"),s6=RegExp("(^|[^"+vC+"])["+vC+"]+$"),o6=function(e){return function(t){var i=n6(r6(t));return 1&e&&(i=_L(i,a6,"")),2&e&&(i=_L(i,s6,"$1")),i}},c6={trim:o6(3)},d6=Ch.PROPER,l6=re,fL=pL,u6=c6.trim;dt({target:"String",proto:!0,forced:(function(e){return l6((function(){return!!fL[e]()||"​᠎"[e]()!=="​᠎"||d6&&fL[e].name!==e}))})("trim")},{trim:function(){return u6(this)}});var h6=Bn("String","trim"),p6=Be,_6=h6,yC=String.prototype,f6=function(e){var t=e.trim;return typeof e=="string"||e===yC||p6(yC,e)&&t===yC.trim?_6:t},hr=X(f6),EL={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map((r=>r.trim()))},t.splitSections=function(i){return i.split(`
m=`).map(((r,a)=>(a>0?"m="+r:r).trim()+`\r
`))},t.getDescription=function(i){const r=t.splitSections(i);return r&&r[0]},t.getMediaSections=function(i){const r=t.splitSections(i);return r.shift(),r},t.matchPrefix=function(i,r){return t.splitLines(i).filter((a=>a.indexOf(r)===0))},t.parseCandidate=function(i){let r;r=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const a={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":a.relatedAddress=r[s+1];break;case"rport":a.relatedPort=parseInt(r[s+1],10);break;case"tcptype":a.tcpType=r[s+1];break;case"ufrag":a.ufrag=r[s+1],a.usernameFragment=r[s+1];break;default:a[r[s]]===void 0&&(a[r[s]]=r[s+1])}return a},t.writeCandidate=function(i){const r=[];r.push(i.foundation);const a=i.component;a==="rtp"?r.push(1):a==="rtcp"?r.push(2):r.push(a),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);const s=i.type;return r.push("typ"),r.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let r=i.substring(9).split(" ");const a={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),a.name=r[0],a.clockRate=parseInt(r[1],10),a.channels=r.length===3?parseInt(r[2],10):1,a.numChannels=a.channels,a},t.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);const a=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(a!==1?"/"+a:"")+`\r
`},t.parseExtmap=function(i){const r=i.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){const r={};let a;const s=i.substring(i.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)a=s[o].trim().split("="),r[a[0].trim()]=a[1];return r},t.writeFmtp=function(i){let r="",a=i.payloadType;if(i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const s=[];Object.keys(i.parameters).forEach((o=>{i.parameters[o]!==void 0?s.push(o+"="+i.parameters[o]):s.push(o)})),r+="a=fmtp:"+a+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(i){const r=i.substring(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(i){let r="",a=i.payloadType;return i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach((s=>{r+="a=rtcp-fb:"+a+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`})),r},t.parseSsrcMedia=function(i){const r=i.indexOf(" "),a={ssrc:parseInt(i.substring(7,r),10)},s=i.indexOf(":",r);return s>-1?(a.attribute=i.substring(r+1,s),a.value=i.substring(s+1)):a.attribute=i.substring(r+1),a},t.parseSsrcGroup=function(i){const r=i.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map((a=>parseInt(a,10)))}},t.getMid=function(i){const r=t.matchPrefix(i,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(i){const r=i.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:t.matchPrefix(i+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,r){let a="a=setup:"+r+`\r
`;return i.fingerprints.forEach((s=>{a+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`})),a},t.parseCryptoLine=function(i){const r=i.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const r=i.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,r){return t.matchPrefix(i+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,r){const a=t.matchPrefix(i+r,"a=ice-ufrag:")[0],s=t.matchPrefix(i+r,"a=ice-pwd:")[0];return a&&s?{usernameFragment:a.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(i){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=t.splitLines(i)[0].split(" ");r.profile=a[2];for(let o=3;o<a.length;o++){const c=a[o],d=t.matchPrefix(i,"a=rtpmap:"+c+" ")[0];if(d){const l=t.parseRtpMap(d),h=t.matchPrefix(i,"a=fmtp:"+c+" ");switch(l.parameters=h.length?t.parseFmtp(h[0]):{},l.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(l.name.toUpperCase())}}}t.matchPrefix(i,"a=extmap:").forEach((o=>{r.headerExtensions.push(t.parseExtmap(o))}));const s=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach((o=>{s.forEach((c=>{o.rtcpFeedback.find((d=>d.type===c.type&&d.parameter===c.parameter))||o.rtcpFeedback.push(c)}))})),r},t.writeRtpDescription=function(i,r){let a="";a+="m="+i+" ",a+=r.codecs.length>0?"9":"0",a+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=r.codecs.map((o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType)).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach((o=>{a+=t.writeRtpMap(o),a+=t.writeFmtp(o),a+=t.writeRtcpFb(o)}));let s=0;return r.codecs.forEach((o=>{o.maxptime>s&&(s=o.maxptime)})),s>0&&(a+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach((o=>{a+=t.writeExtmap(o)})),a},t.parseRtpEncodingParameters=function(i){const r=[],a=t.parseRtpParameters(i),s=a.fecMechanisms.indexOf("RED")!==-1,o=a.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(i,"a=ssrc:").map((f=>t.parseSsrcMedia(f))).filter((f=>f.attribute==="cname")),d=c.length>0&&c[0].ssrc;let l;const h=t.matchPrefix(i,"a=ssrc-group:FID").map((f=>f.substring(17).split(" ").map((m=>parseInt(m,10)))));h.length>0&&h[0].length>1&&h[0][0]===d&&(l=h[0][1]),a.codecs.forEach((f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let m={ssrc:d,codecPayloadType:parseInt(f.parameters.apt,10)};d&&l&&(m.rtx={ssrc:l}),r.push(m),s&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:d,mechanism:o?"red+ulpfec":"red"},r.push(m))}})),r.length===0&&d&&r.push({ssrc:d});let _=t.matchPrefix(i,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,r.forEach((f=>{f.maxBitrate=_}))),r},t.parseRtcpParameters=function(i){const r={},a=t.matchPrefix(i,"a=ssrc:").map((c=>t.parseSsrcMedia(c))).filter((c=>c.attribute==="cname"))[0];a&&(r.cname=a.value,r.ssrc=a.ssrc);const s=t.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=t.matchPrefix(i,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},t.parseMsid=function(i){let r;const a=t.matchPrefix(i,"a=msid:");if(a.length===1)return r=a[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(i,"a=ssrc:").map((o=>t.parseSsrcMedia(o))).filter((o=>o.attribute==="msid"));return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(i){const r=t.parseMLine(i),a=t.matchPrefix(i,"a=max-message-size:");let s;a.length>0&&(s=parseInt(a[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(i,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const c=t.matchPrefix(i,"a=sctpmap:");if(c.length>0){const d=c[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},t.writeSctpDescription=function(i,r){let a=[];return a=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&a.push("a=max-message-size:"+r.maxMessageSize+`\r
`),a.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,r,a){let s;const o=r!==void 0?r:2;return s=i||t.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,r){const a=t.splitLines(i);for(let s=0;s<a.length;s++)switch(a[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const r=t.splitLines(i)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(i){const r=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const r=t.splitLines(i);for(let a=0;a<r.length;a++)if(r[a].length<2||r[a].charAt(1)!=="=")return!1;return!0},e.exports=t})(EL);var mL=EL.exports,Pu=X(mL),E6=q({__proto__:null,default:Pu},[mL]);function eg(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const r=new t(i),a=Pu.parseCandidate(i.candidate),s=Object.assign(r,a);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,Sd(e,"icecandidate",(i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i)))}function CC(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Sd(e,"icecandidate",(t=>{if(t.candidate){const i=Pu.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t}))}function tg(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(c){if(!c||!c.sdp)return!1;const d=Pu.splitSections(c.sdp);return d.shift(),d.some((l=>{const h=Pu.parseMLine(l);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1}))},r=function(c){const d=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const l=parseInt(d[1],10);return l!=l?-1:l},a=function(c){let d=65536;return t.browser==="firefox"&&(d=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),d},s=function(c,d){let l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);const h=Pu.matchPrefix(c.sdp,"a=max-message-size:");return h.length>0?l=parseInt(h[0].substr(19),10):t.browser==="firefox"&&d!==-1&&(l=2147483637),l},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const c=r(arguments[0]),d=a(c),l=s(arguments[0],c);let h;h=d===0&&l===0?Number.POSITIVE_INFINITY:d===0||l===0?Math.max(d,l):Math.min(d,l);const _={};Object.defineProperty(_,"maxMessageSize",{get:()=>h}),this._sctp=_}return o.apply(this,arguments)}}function ig(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,a){const s=r.send;r.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(r.readyState==="open"&&a.sctp&&c>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=i.apply(this,arguments);return t(r,this),r},Sd(e,"datachannel",(r=>(t(r.channel,r.target),r)))}function bC(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((i=>{const r=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const s=a.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",a);s.dispatchEvent(o)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function AC(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=r.sdp.split(`
`).filter((s=>hr(s).call(s)!=="a=extmap-allow-mixed")).join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:a}):r.sdp=a}return i.apply(this,arguments)}}function rg(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?se.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),se.resolve())})}function ng(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return i.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?i.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((a=>i.apply(this,[a])))})}var m6=Object.freeze({__proto__:null,removeExtmapAllowMixed:AC,shimAddIceCandidateNullOrEmpty:rg,shimConnectionState:bC,shimMaxMessageSize:tg,shimParameterlessSetLocalDescription:ng,shimRTCIceCandidate:eg,shimRTCIceCandidateRelayProtocol:CC,shimSendThrowTypeError:ig});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=DP,r=(function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:c}=s;if(c.mozGetUserMedia)o.browser="firefox",o.version=$m(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=$m(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=$m(c.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o})(e),a={browserDetails:r,commonShim:m6,extractVersion:$m,disableLog:t6,disableWarnings:i6,sdp:E6};switch(r.browser){case"chrome":if(!KP||!TC||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),a;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),a;i("adapter.js shimming chrome."),a.browserShim=KP,rg(e,r),ng(e),UP(e,r),xP(e),TC(e,r),VP(e),WP(e,r),FP(e),BP(e),jP(e),HP(e,r),eg(e),CC(e),bC(e),tg(e,r),ig(e),AC(e,r);break;case"firefox":if(!iL||!RC||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),a;i("adapter.js shimming firefox."),a.browserShim=iL,rg(e,r),ng(e),YP(e,r),RC(e,r),zP(e),JP(e),qP(e),XP(e),ZP(e),QP(e),$P(e),eL(e),tL(e),eg(e),bC(e),tg(e,r),ig(e);break;case"safari":if(!hL||!t.shimSafari)return i("Safari shim is not included in this adapter release."),a;i("adapter.js shimming safari."),a.browserShim=hL,rg(e,r),ng(e),cL(e),lL(e),aL(e),rL(e),nL(e),dL(e),sL(e),uL(e),eg(e),CC(e),tg(e,r),ig(e),AC(e,r);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var IC=ke;dt({global:!0,forced:IC.globalThis!==IC},{globalThis:IC});var gL=X(ke),wC={exports:{}};(function(e,t){(function(i,r){var a="function",s="undefined",o="object",c="string",d="major",l="model",h="name",_="type",f="vendor",m="version",S="architecture",T="console",R="mobile",C="tablet",b="smarttv",N="wearable",k="embedded",P="Amazon",U="Apple",W="ASUS",z="BlackBerry",Q="Browser",he="Chrome",Ge="Firefox",xe="Google",qe="Huawei",ot="LG",xt="Microsoft",fe="Motorola",$="Opera",ne="Samsung",ie="Sharp",A="Sony",v="Xiaomi",D="Zebra",j="Facebook",ue="Chromium OS",rt="Mac OS",jt=" Browser",ar=function(gi){for(var Wt={},vi=0;vi<gi.length;vi++)Wt[gi[vi].toUpperCase()]=gi[vi];return Wt},ua=function(gi,Wt){return typeof gi===c&&Ho(Wt).indexOf(Ho(gi))!==-1},Ho=function(gi){return gi.toLowerCase()},sh=function(gi,Wt){if(typeof gi===c)return gi=gi.replace(/^\s\s*/,""),typeof Wt===s?gi:gi.substring(0,500)},xl=function(gi,Wt){for(var vi,zn,er,ur,Xt,Yt,Eo=0;Eo<Wt.length&&!Xt;){var Yo=Wt[Eo],OE=Wt[Eo+1];for(vi=zn=0;vi<Yo.length&&!Xt&&Yo[vi];)if(Xt=Yo[vi++].exec(gi))for(er=0;er<OE.length;er++)Yt=Xt[++zn],typeof(ur=OE[er])===o&&ur.length>0?ur.length===2?typeof ur[1]==a?this[ur[0]]=ur[1].call(this,Yt):this[ur[0]]=ur[1]:ur.length===3?typeof ur[1]!==a||ur[1].exec&&ur[1].test?this[ur[0]]=Yt?Yt.replace(ur[1],ur[2]):r:this[ur[0]]=Yt?ur[1].call(this,Yt,ur[2]):r:ur.length===4&&(this[ur[0]]=Yt?ur[3].call(this,Yt.replace(ur[1],ur[2])):r):this[ur]=Yt||r;Eo+=2}},M_=function(gi,Wt){for(var vi in Wt)if(typeof Wt[vi]===o&&Wt[vi].length>0){for(var zn=0;zn<Wt[vi].length;zn++)if(ua(Wt[vi][zn],gi))return vi==="?"?r:vi}else if(ua(Wt[vi],gi))return vi==="?"?r:vi;return Wt.hasOwnProperty("*")?Wt["*"]:gi},Qg={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ko={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[m,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[m,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,m],[/opios[\/ ]+([\w\.]+)/i],[m,[h,$+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[m,[h,$+" GX"]],[/\bopr\/([\w\.]+)/i],[m,[h,$]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[m,[h,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[m,[h,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,m],[/quark(?:pc)?\/([-\w\.]+)/i],[m,[h,"Quark"]],[/\bddg\/([\w\.]+)/i],[m,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[m,[h,"UC"+Q]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[m,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[m,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[m,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[m,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[m,[h,"Smart Lenovo "+Q]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+Q],m],[/\bfocus\/([\w\.]+)/i],[m,[h,Ge+" Focus"]],[/\bopt\/([\w\.]+)/i],[m,[h,$+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[m,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[m,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[m,[h,$+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[m,[h,"MIUI"+jt]],[/fxios\/([\w\.-]+)/i],[m,[h,Ge]],[/\bqihoobrowser\/?([\w\.]*)/i],[m,[h,"360"]],[/\b(qq)\/([\w\.]+)/i],[[h,/(.+)/,"$1Browser"],m],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1"+jt],m],[/samsungbrowser\/([\w\.]+)/i],[m,[h,ne+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[m,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],m],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[h,m],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[h],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[m,h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,j],m],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,m],[/\bgsa\/([\w\.]+) .*safari\//i],[m,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[m,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[m,[h,he+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,he+" WebView"],m],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[m,[h,"Android "+Q]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,m],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[m,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[m,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[m,M_,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,m],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],m],[/(wolvic|librewolf)\/([\w\.]+)/i],[h,m],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[m,[h,Ge+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,[m,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[h,[m,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[S,"amd64"]],[/(ia32(?=;))/i],[[S,Ho]],[/((?:i[346]|x)86)[;\)]/i],[[S,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[S,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[S,"armhf"]],[/windows (ce|mobile); ppc;/i],[[S,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[S,/ower/,"",Ho]],[/(sun4\w)[;\)]/i],[[S,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[S,Ho]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[f,ne],[_,C]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[l,[f,ne],[_,R]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[f,U],[_,R]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[f,U],[_,C]],[/(macintosh);/i],[l,[f,U]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[f,ie],[_,R]],[/(?:honor)([-\w ]+)[;\)]/i],[l,[f,"Honor"],[_,R]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[f,qe],[_,C]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[f,qe],[_,R]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[l,/_/g," "],[f,v],[_,R]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[f,v],[_,C]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[f,"OPPO"],[_,R]],[/\b(opd2\d{3}a?) bui/i],[l,[f,"OPPO"],[_,C]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[f,"Vivo"],[_,R]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[l,[f,"Realme"],[_,R]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[f,fe],[_,R]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[f,fe],[_,C]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[f,ot],[_,C]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[f,ot],[_,R]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[f,"Lenovo"],[_,C]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[f,"Nokia"],[_,R]],[/(pixel c)\b/i],[l,[f,xe],[_,C]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[f,xe],[_,R]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[f,A],[_,R]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[f,A],[_,C]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[f,"OnePlus"],[_,R]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[f,P],[_,C]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[f,P],[_,R]],[/(playbook);[-\w\),; ]+(rim)/i],[l,f,[_,C]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[f,z],[_,R]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[f,W],[_,C]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[f,W],[_,R]],[/(nexus 9)/i],[l,[f,"HTC"],[_,C]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[l,/_/g," "],[_,R]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[l,[f,"TCL"],[_,C]],[/(itel) ((\w+))/i],[[f,Ho],l,[_,M_,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[f,"Acer"],[_,C]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[f,"Meizu"],[_,R]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[l,[f,"Ulefone"],[_,R]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[l,[f,"Energizer"],[_,R]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[l,[f,"Cat"],[_,R]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[l,[f,"Smartfren"],[_,R]],[/droid.+; (a(?:015|06[35]|142p?))/i],[l,[f,"Nothing"],[_,R]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,l,[_,R]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,l,[_,C]],[/(surface duo)/i],[l,[f,xt],[_,C]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[f,"Fairphone"],[_,R]],[/(u304aa)/i],[l,[f,"AT&T"],[_,R]],[/\bsie-(\w*)/i],[l,[f,"Siemens"],[_,R]],[/\b(rct\w+) b/i],[l,[f,"RCA"],[_,C]],[/\b(venue[\d ]{2,7}) b/i],[l,[f,"Dell"],[_,C]],[/\b(q(?:mv|ta)\w+) b/i],[l,[f,"Verizon"],[_,C]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[f,"Barnes & Noble"],[_,C]],[/\b(tm\d{3}\w+) b/i],[l,[f,"NuVision"],[_,C]],[/\b(k88) b/i],[l,[f,"ZTE"],[_,C]],[/\b(nx\d{3}j) b/i],[l,[f,"ZTE"],[_,R]],[/\b(gen\d{3}) b.+49h/i],[l,[f,"Swiss"],[_,R]],[/\b(zur\d{3}) b/i],[l,[f,"Swiss"],[_,C]],[/\b((zeki)?tb.*\b) b/i],[l,[f,"Zeki"],[_,C]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],l,[_,C]],[/\b(ns-?\w{0,9}) b/i],[l,[f,"Insignia"],[_,C]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[f,"NextBook"],[_,C]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],l,[_,R]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],l,[_,R]],[/\b(ph-1) /i],[l,[f,"Essential"],[_,R]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[f,"Envizen"],[_,C]],[/\b(trio[-\w\. ]+) b/i],[l,[f,"MachSpeed"],[_,C]],[/\btu_(1491) b/i],[l,[f,"Rotor"],[_,C]],[/(shield[\w ]+) b/i],[l,[f,"Nvidia"],[_,C]],[/(sprint) (\w+)/i],[f,l,[_,R]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[f,xt],[_,R]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[f,D],[_,C]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[f,D],[_,R]],[/smart-tv.+(samsung)/i],[f,[_,b]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[f,ne],[_,b]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,ot],[_,b]],[/(apple) ?tv/i],[f,[l,U+" TV"],[_,b]],[/crkey/i],[[l,he+"cast"],[f,xe],[_,b]],[/droid.+aft(\w+)( bui|\))/i],[l,[f,P],[_,b]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[f,ie],[_,b]],[/(bravia[\w ]+)( bui|\))/i],[l,[f,A],[_,b]],[/(mitv-\w{5}) bui/i],[l,[f,v],[_,b]],[/Hbbtv.*(technisat) (.*);/i],[f,l,[_,b]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,sh],[l,sh],[_,b]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,l,[_,T]],[/droid.+; (shield) bui/i],[l,[f,"Nvidia"],[_,T]],[/(playstation [345portablevi]+)/i],[l,[f,A],[_,T]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[f,xt],[_,T]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[l,[f,ne],[_,N]],[/((pebble))app/i],[f,l,[_,N]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[f,U],[_,N]],[/droid.+; (glass) \d/i],[l,[f,xe],[_,N]],[/droid.+; (wt63?0{2,3})\)/i],[l,[f,D],[_,N]],[/droid.+; (glass) \d/i],[l,[f,xe],[_,N]],[/(pico) (4|neo3(?: link|pro)?)/i],[f,l,[_,N]],[/; (quest( \d| pro)?)/i],[l,[f,j],[_,N]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[_,k]],[/(aeobc)\b/i],[l,[f,P],[_,k]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[l,[_,R]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[_,C]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,C]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,R]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[m,[h,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[h,m],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[m,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,m],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[m,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,m],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[m,M_,Qg]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,M_,Qg],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[m,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,rt],[m,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[m,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,m],[/\(bb(10);/i],[m,[h,z]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[m,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[m,[h,Ge+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[m,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[m,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[m,[h,he+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,ue],m],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,m],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],m],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,m]]},$a=function(gi,Wt){if(typeof gi===o&&(Wt=gi,gi=r),!(this instanceof $a))return new $a(gi,Wt).getResult();var vi=typeof i!==s&&i.navigator?i.navigator:r,zn=gi||(vi&&vi.userAgent?vi.userAgent:""),er=vi&&vi.userAgentData?vi.userAgentData:r,ur=Wt?(function(Yt,Eo){var Yo={};for(var OE in Yt)Eo[OE]&&Eo[OE].length%2==0?Yo[OE]=Eo[OE].concat(Yt[OE]):Yo[OE]=Yt[OE];return Yo})(Ko,Wt):Ko,Xt=vi&&vi.userAgent==zn;return this.getBrowser=function(){var Yt={};return Yt[h]=r,Yt[m]=r,xl.call(Yt,zn,ur.browser),Yt[d]=(function(Eo){return typeof Eo===c?Eo.replace(/[^\d\.]/g,"").split(".")[0]:r})(Yt[m]),Xt&&vi&&vi.brave&&typeof vi.brave.isBrave==a&&(Yt[h]="Brave"),Yt},this.getCPU=function(){var Yt={};return Yt[S]=r,xl.call(Yt,zn,ur.cpu),Yt},this.getDevice=function(){var Yt={};return Yt[f]=r,Yt[l]=r,Yt[_]=r,xl.call(Yt,zn,ur.device),Xt&&!Yt[_]&&er&&er.mobile&&(Yt[_]=R),Xt&&Yt[l]=="Macintosh"&&vi&&typeof vi.standalone!==s&&vi.maxTouchPoints&&vi.maxTouchPoints>2&&(Yt[l]="iPad",Yt[_]=C),Yt},this.getEngine=function(){var Yt={};return Yt[h]=r,Yt[m]=r,xl.call(Yt,zn,ur.engine),Yt},this.getOS=function(){var Yt={};return Yt[h]=r,Yt[m]=r,xl.call(Yt,zn,ur.os),Xt&&!Yt[h]&&er&&er.platform&&er.platform!="Unknown"&&(Yt[h]=er.platform.replace(/chrome os/i,ue).replace(/macos/i,rt)),Yt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return zn},this.setUA=function(Yt){return zn=typeof Yt===c&&Yt.length>500?sh(Yt,500):Yt,this},this.setUA(zn),this};$a.VERSION="0.7.40",$a.BROWSER=ar([h,m,d]),$a.CPU=ar([S]),$a.DEVICE=ar([l,f,_,T,R,b,C,N,k]),$a.ENGINE=$a.OS=ar([h,m]),e.exports&&(t=e.exports=$a),t.UAParser=$a;var Vl=typeof i!==s&&(i.jQuery||i.Zepto);if(Vl&&!Vl.ua){var an=new $a;Vl.ua=an.getResult(),Vl.ua.get=function(){return an.getUA()},Vl.ua.set=function(gi){an.setUA(gi);var Wt=an.getResult();for(var vi in Wt)Vl.ua[vi]=Wt[vi]}}})(typeof window=="object"?window:K)})(wC,wC.exports);var g6=X(wC.exports),SL=wo.clear;dt({global:!0,bind:!0,forced:ke.clearImmediate!==SL},{clearImmediate:SL});var TL=ke,S6=kt,T6=Jt,R6=uh,v6=$r,y6=aa,C6=Ma,b6=TL.Function,A6=/MSIE .\./.test(v6)||R6==="BUN"&&(function(){var e=TL.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),I6=dt,RL=ke,vL=wo.set,w6=function(e,t){var i=1;return A6?function(r,a){var s=C6(arguments.length,1)>i,o=T6(r)?r:b6(r),c=s?y6(arguments,i):[],d=s?function(){S6(o,this,c)}:o;return e(d)}:e},yL=RL.setImmediate?w6(vL):vL;I6({global:!0,bind:!0,forced:RL.setImmediate!==yL},{setImmediate:yL});var CL=X(bn.setImmediate),O6=ke,N6=Uh,D6=pr,P6=Ma,L6=ir;dt({global:!0,dontCallGetSet:!0,forced:re((function(){return L6&&Object.getOwnPropertyDescriptor(O6,"queueMicrotask").value.length!==1}))},{queueMicrotask:function(e){P6(arguments.length,1),N6(D6(e))}});var bL=X(bn.queueMicrotask);function AL(e,t){return function(){return e.apply(t,arguments)}}const{toString:k6}=Object.prototype,{getPrototypeOf:OC}=Object,{iterator:ag,toStringTag:IL}=Symbol,sg=(NC=Object.create(null),e=>{const t=k6.call(e);return NC[t]||(NC[t]=t.slice(8,-1).toLowerCase())});var NC;const Xa=e=>(e=e.toLowerCase(),t=>sg(t)===e),og=e=>t=>typeof t===e,{isArray:Lu}=Array,$p=og("undefined"),wL=Xa("ArrayBuffer"),M6=og("string"),Ln=og("function"),OL=og("number"),cg=e=>e!==null&&typeof e=="object",dg=e=>{if(sg(e)!=="object")return!1;const t=OC(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||IL in e||ag in e)},U6=Xa("Date"),x6=Xa("File"),V6=Xa("Blob"),F6=Xa("FileList"),B6=Xa("URLSearchParams"),[j6,G6,W6,H6]=["ReadableStream","Request","Response","Headers"].map(Xa);function e_(e,t){let i,r,{allOwnKeys:a=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Lu(e))for(i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else{const s=a?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let c;for(i=0;i<o;i++)c=s[i],t.call(null,e[c],c,e)}}function NL(e,t){t=t.toLowerCase();const i=Object.keys(e);let r,a=i.length;for(;a-- >0;)if(r=i[a],t===r.toLowerCase())return r;return null}const Td=gL!==void 0?gL:typeof self<"u"?self:typeof window<"u"?window:globalThis,DL=e=>!$p(e)&&e!==Td,K6=(DC=typeof Uint8Array<"u"&&OC(Uint8Array),e=>DC&&e instanceof DC);var DC;const Y6=Xa("HTMLFormElement"),PL=(e=>{let{hasOwnProperty:t}=e;return(i,r)=>t.call(i,r)})(Object.prototype),z6=Xa("RegExp"),LL=(e,t)=>{const i=Object.getOwnPropertyDescriptors(e),r={};e_(i,((a,s)=>{let o;(o=t(a,s,e))!==!1&&(r[s]=o||a)})),Object.defineProperties(e,r)},q6=Xa("AsyncFunction"),kL=(ML=typeof CL=="function",UL=Ln(Td.postMessage),ML?CL:UL?(PC="axios@".concat(Math.random()),lg=[],Td.addEventListener("message",(e=>{let{source:t,data:i}=e;t===Td&&i===PC&&lg.length&&lg.shift()()}),!1),e=>{lg.push(e),Td.postMessage(PC,"*")}):e=>setTimeout(e));var ML,UL,PC,lg;const X6=bL!==void 0?bL.bind(Td):typeof process<"u"&&process.nextTick||kL;var ae={isArray:Lu,isArrayBuffer:wL,isBuffer:function(e){return e!==null&&!$p(e)&&e.constructor!==null&&!$p(e.constructor)&&Ln(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ln(e.append)&&((t=sg(e))==="formdata"||t==="object"&&Ln(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&wL(e.buffer),t},isString:M6,isNumber:OL,isBoolean:e=>e===!0||e===!1,isObject:cg,isPlainObject:dg,isReadableStream:j6,isRequest:G6,isResponse:W6,isHeaders:H6,isUndefined:$p,isDate:U6,isFile:x6,isBlob:V6,isRegExp:z6,isFunction:Ln,isStream:e=>cg(e)&&Ln(e.pipe),isURLSearchParams:B6,isTypedArray:K6,isFileList:F6,forEach:e_,merge:function e(){const{caseless:t}=DL(this)&&this||{},i={},r=(a,s)=>{const o=t&&NL(i,s)||s;dg(i[o])&&dg(a)?i[o]=e(i[o],a):dg(a)?i[o]=e({},a):Lu(a)?i[o]=a.slice():i[o]=a};for(let a=0,s=arguments.length;a<s;a++)arguments[a]&&e_(arguments[a],r);return i},extend:function(e,t,i){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return e_(t,((a,s)=>{i&&Ln(a)?e[s]=AL(a,i):e[s]=a}),{allOwnKeys:r}),e},trim:e=>hr(e)?hr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,i,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,r)=>{let a,s,o;const c={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),s=a.length;s-- >0;)o=a[s],r&&!r(o,e,t)||c[o]||(t[o]=e[o],c[o]=!0);e=i!==!1&&OC(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:sg,kindOfTest:Xa,endsWith:(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;const r=e.indexOf(t,i);return r!==-1&&r===i},toArray:e=>{if(!e)return null;if(Lu(e))return e;let t=e.length;if(!OL(t))return null;const i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{const i=(e&&e[ag]).call(e);let r;for(;(r=i.next())&&!r.done;){const a=r.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let i;const r=[];for(;(i=e.exec(t))!==null;)r.push(i);return r},isHTMLForm:Y6,hasOwnProperty:PL,hasOwnProp:PL,reduceDescriptors:LL,freezeMethods:e=>{LL(e,((t,i)=>{if(Ln(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=e[i];Ln(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))}))},toObjectSet:(e,t)=>{const i={},r=a=>{a.forEach((s=>{i[s]=!0}))};return Lu(e)?r(e):r(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,i,r){return i.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:NL,global:Td,isContextDefined:DL,isSpecCompliantForm:function(e){return!!(e&&Ln(e.append)&&e[IL]==="FormData"&&e[ag])},toJSONObject:e=>{const t=new Array(10),i=(r,a)=>{if(cg(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[a]=r;const s=Lu(r)?[]:{};return e_(r,((o,c)=>{const d=i(o,a+1);!$p(d)&&(s[c]=d)})),t[a]=void 0,s}}return r};return i(e,0)},isAsyncFn:q6,isThenable:e=>e&&(cg(e)||Ln(e))&&Ln(e.then)&&Ln(e.catch),setImmediate:kL,asap:X6,isIterable:e=>e!=null&&Ln(e[ag])};function St(e,t,i,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),r&&(this.request=r),a&&(this.response=a,this.status=a.status?a.status:null)}ae.inherits(St,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ae.toJSONObject(this.config),code:this.code,status:this.status}}});const xL=St.prototype,VL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{VL[e]={value:e}})),Object.defineProperties(St,VL),Object.defineProperty(xL,"isAxiosError",{value:!0}),St.from=(e,t,i,r,a,s)=>{const o=Object.create(xL);return ae.toFlatObject(e,o,(function(c){return c!==Error.prototype}),(c=>c!=="isAxiosError")),St.call(o,e.message,t,i,r,a),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function LC(e){return ae.isPlainObject(e)||ae.isArray(e)}function FL(e){return ae.endsWith(e,"[]")?e.slice(0,-2):e}function BL(e,t,i){return e?e.concat(t).map((function(r,a){return r=FL(r),!i&&a?"["+r+"]":r})).join(i?".":""):t}const J6=ae.toFlatObject(ae,{},null,(function(e){return/^is[A-Z]/.test(e)}));function ug(e,t,i){if(!ae.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(i=ae.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(f,m){return!ae.isUndefined(m[f])}))).metaTokens,a=i.visitor||l,s=i.dots,o=i.indexes,c=(i.Blob||typeof Blob<"u"&&Blob)&&ae.isSpecCompliantForm(t);if(!ae.isFunction(a))throw new TypeError("visitor must be a function");function d(f){if(f===null)return"";if(ae.isDate(f))return f.toISOString();if(!c&&ae.isBlob(f))throw new St("Blob is not supported. Use a Buffer instead.");return ae.isArrayBuffer(f)||ae.isTypedArray(f)?c&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function l(f,m,S){let T=f;if(f&&!S&&typeof f=="object"){if(ae.endsWith(m,"{}"))m=r?m:m.slice(0,-2),f=JSON.stringify(f);else if(ae.isArray(f)&&(function(R){return ae.isArray(R)&&!R.some(LC)})(f)||(ae.isFileList(f)||ae.endsWith(m,"[]"))&&(T=ae.toArray(f)))return m=FL(m),T.forEach((function(R,C){!ae.isUndefined(R)&&R!==null&&t.append(o===!0?BL([m],C,s):o===null?m:m+"[]",d(R))})),!1}return!!LC(f)||(t.append(BL(S,m,s),d(f)),!1)}const h=[],_=Object.assign(J6,{defaultVisitor:l,convertValue:d,isVisitable:LC});if(!ae.isObject(e))throw new TypeError("data must be an object");return(function f(m,S){if(!ae.isUndefined(m)){if(h.indexOf(m)!==-1)throw Error("Circular reference detected in "+S.join("."));h.push(m),ae.forEach(m,(function(T,R){(!(ae.isUndefined(T)||T===null)&&a.call(t,T,ae.isString(R)?hr(R).call(R):R,S,_))===!0&&f(T,S?S.concat(R):[R])})),h.pop()}})(e),t}function jL(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(i){return t[i]}))}function kC(e,t){this._pairs=[],e&&ug(e,this,t)}const GL=kC.prototype;function Z6(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function WL(e,t,i){if(!t)return e;const r=i&&i.encode||Z6;ae.isFunction(i)&&(i={serialize:i});const a=i&&i.serialize;let s;if(s=a?a(t,i):ae.isURLSearchParams(t)?t.toString():new kC(t,i).toString(r),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}GL.append=function(e,t){this._pairs.push([e,t])},GL.toString=function(e){const t=e?function(i){return e.call(this,i,jL)}:jL;return this._pairs.map((function(i){return t(i[0])+"="+t(i[1])}),"").join("&")};var HL=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ae.forEach(this.handlers,(function(t){t!==null&&e(t)}))}},KL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},YL={exports:{}},Q6=dt,$6=ir,zL=pn.f;Q6({target:"Object",stat:!0,forced:Object.defineProperty!==zL,sham:!$6},{defineProperty:zL});var qL=bn.Object,eW=YL.exports=function(e,t,i){return qL.defineProperty(e,t,i)};qL.defineProperty.sham&&(eW.sham=!0);var XL=X(YL.exports),tW=TypeError,JL=vo,iW=Nh,rW=Ir,nW=ci("species"),ZL=Array,aW=function(e){var t;return JL(e)&&(t=e.constructor,(iW(t)&&(t===ZL||JL(t.prototype))||rW(t)&&(t=t[nW])===null)&&(t=void 0)),t===void 0?ZL:t},QL=function(e,t){return new(aW(e))(t===0?0:t)},sW=re,oW=Ps,cW=ci("species"),$L=function(e){return oW>=51||!sW((function(){var t=[];return(t.constructor={})[cW]=function(){return{foo:1}},t[e](Boolean).foo!==1}))},dW=dt,lW=re,uW=vo,hW=Ir,pW=Pa,_W=Zs,ek=function(e){if(e>9007199254740991)throw tW("Maximum allowed index exceeded");return e},tk=Jy,fW=QL,EW=$L,mW=Ps,ik=ci("isConcatSpreadable"),gW=mW>=51||!lW((function(){var e=[];return e[ik]=!1,e.concat()[0]!==e})),SW=function(e){if(!hW(e))return!1;var t=e[ik];return t!==void 0?!!t:uW(e)};dW({target:"Array",proto:!0,forced:!gW||!EW("concat")},{concat:function(e){var t,i,r,a,s,o=pW(this),c=fW(o,0),d=0;for(t=-1,r=arguments.length;t<r;t++)if(SW(s=t===-1?o:arguments[t]))for(a=_W(s),ek(d+a),i=0;i<a;i++,d++)i in s&&tk(c,d,s[i]);else ek(d+1),tk(c,d++,s);return c.length=d,c}});var rk={},TW=tr,RW=Js,nk=$o.f,vW=aa,ak=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];rk.f=function(e){return ak&&TW(e)==="Window"?(function(t){try{return nk(t)}catch{return vW(ak)}})(e):nk(RW(e))};var ku={},yW=ci;ku.f=yW;var sk=bn,CW=Bi,bW=ku,AW=pn.f,Fi=function(e){var t=sk.Symbol||(sk.Symbol={});CW(t,e)||AW(t,e,{value:bW.f(e)})},IW=tt,wW=wr,OW=ci,NW=An,ok=function(){var e=wW("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,r=OW("toPrimitive");t&&!t[r]&&NW(t,r,(function(a){return IW(i,this)}),{})},DW=rs,PW=mo,LW=Pa,kW=Zs,MW=QL,eF=ye([].push),tF=function(e){var t=e===1,i=e===2,r=e===3,a=e===4,s=e===6,o=e===7,c=e===5||s;return function(d,l,h,_){for(var f,m,S=LW(d),T=PW(S),R=kW(T),C=DW(l,h),b=0,N=_||MW,k=t?N(d,R):i||o?N(d,0):void 0;R>b;b++)if((c||b in T)&&(m=C(f=T[b],b,S),e))if(t)k[b]=m;else if(m)switch(e){case 3:return!0;case 5:return f;case 6:return b;case 2:eF(k,f)}else switch(e){case 4:return!1;case 7:eF(k,f)}return s?-1:r||a?a:k}},MC={forEach:tF(0)},Hf=dt,hg=ke,ck=tt,wT=ye,Mu=ir,OT=td,Vs=re,Fs=Bi,dk=Be,NT=Vr,DT=Js,lk=Jd,uk=Fr,Kf=Ft,pg=od,iF=iu,rF=$o,nF=rk,aF=sd,hk=zo,sF=pn,oF=tu,pk=ni,cF=An,_k=en,Vw=Es,fk=ra,dF=Xd,UW=ci,xW=ku,VW=Fi,FW=ok,lF=Ha,UC=gs,ro=MC.forEach,no=sn("hidden"),Yf="Symbol",xC="prototype",uF=UC.set,hl=UC.getterFor(Yf),ao=Object[xC],Hh=hg.Symbol,Fw=Hh&&Hh[xC],BW=hg.RangeError,Ek=hg.TypeError,Bw=hg.QObject,zf=hk.f,qf=sF.f,hF=nF.f,pF=pk.f,Kh=wT([].push),Rd=Vw("symbols"),VC=Vw("op-symbols"),mk=Vw("wks"),jw=!Bw||!Bw[xC]||!Bw[xC].findChild,Gw=function(e,t,i){var r=zf(ao,t);r&&delete ao[t],qf(e,t,i),r&&e!==ao&&qf(ao,t,r)},FC=Mu&&Vs((function(){return pg(qf({},"a",{get:function(){return qf(this,"a",{value:7}).a}})).a!==7}))?Gw:qf,PT=function(e,t){var i=Rd[e]=pg(Fw);return uF(i,{type:Yf,tag:e,description:t}),Mu||(i.description=t),i},LT=function(e,t,i){e===ao&&LT(VC,t,i),NT(e);var r=lk(t);return NT(i),Fs(Rd,r)?(i.enumerable?(Fs(e,no)&&e[no][r]&&(e[no][r]=!1),i=pg(i,{enumerable:Kf(0,!1)})):(Fs(e,no)||qf(e,no,Kf(1,pg(null))),e[no][r]=!0),FC(e,r,i)):qf(e,r,i)},Ww=function(e,t){NT(e);var i=DT(t),r=iF(i).concat(Rk(i));return ro(r,(function(a){Mu&&!ck(gk,i,a)||LT(e,a,i[a])})),e},gk=function(e){var t=lk(e),i=ck(pF,this,t);return!(this===ao&&Fs(Rd,t)&&!Fs(VC,t))&&(!(i||!Fs(this,t)||!Fs(Rd,t)||Fs(this,no)&&this[no][t])||i)},Sk=function(e,t){var i=DT(e),r=lk(t);if(i!==ao||!Fs(Rd,r)||Fs(VC,r)){var a=zf(i,r);return!a||!Fs(Rd,r)||Fs(i,no)&&i[no][r]||(a.enumerable=!0),a}},Tk=function(e){var t=hF(DT(e)),i=[];return ro(t,(function(r){Fs(Rd,r)||Fs(fk,r)||Kh(i,r)})),i},Rk=function(e){var t=e===ao,i=hF(t?VC:DT(e)),r=[];return ro(i,(function(a){!Fs(Rd,a)||t&&!Fs(ao,a)||Kh(r,Rd[a])})),r};OT||(Hh=function(){if(dk(Fw,this))throw new Ek("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?uk(arguments[0]):void 0,t=dF(e),i=function(r){var a=this===void 0?hg:this;a===ao&&ck(i,VC,r),Fs(a,no)&&Fs(a[no],t)&&(a[no][t]=!1);var s=Kf(1,r);try{FC(a,t,s)}catch(o){if(!(o instanceof BW))throw o;Gw(a,t,s)}};return Mu&&jw&&FC(ao,t,{configurable:!0,set:i}),PT(t,e)},cF(Fw=Hh[xC],"toString",(function(){return hl(this).tag})),cF(Hh,"withoutSetter",(function(e){return PT(dF(e),e)})),pk.f=gk,sF.f=LT,oF.f=Ww,hk.f=Sk,rF.f=nF.f=Tk,aF.f=Rk,xW.f=function(e){return PT(UW(e),e)},Mu&&_k(Fw,"description",{configurable:!0,get:function(){return hl(this).description}})),Hf({global:!0,wrap:!0,forced:!OT,sham:!OT},{Symbol:Hh}),ro(iF(mk),(function(e){VW(e)})),Hf({target:Yf,stat:!0,forced:!OT},{useSetter:function(){jw=!0},useSimple:function(){jw=!1}}),Hf({target:"Object",stat:!0,forced:!OT,sham:!Mu},{create:function(e,t){return t===void 0?pg(e):Ww(pg(e),t)},defineProperty:LT,defineProperties:Ww,getOwnPropertyDescriptor:Sk}),Hf({target:"Object",stat:!0,forced:!OT},{getOwnPropertyNames:Tk}),FW(),lF(Hh,Yf),fk[no]=!0;var _F=td&&!!Symbol.for&&!!Symbol.keyFor,jW=dt,GW=wr,WW=Bi,fF=Fr,EF=Es,vk=_F,yk=EF("string-to-symbol-registry"),HW=EF("symbol-to-string-registry");jW({target:"Symbol",stat:!0,forced:!vk},{for:function(e){var t=fF(e);if(WW(yk,t))return yk[t];var i=GW("Symbol")(t);return yk[t]=i,HW[i]=t,i}});var KW=dt,YW=Bi,zW=qd,qW=qo,mF=_F,Ck=Es("symbol-to-string-registry");KW({target:"Symbol",stat:!0,forced:!mF},{keyFor:function(e){if(!zW(e))throw new TypeError(qW(e)+" is not a symbol");if(YW(Ck,e))return Ck[e]}});var gF=vo,SF=Jt,TF=tr,RF=Fr,vF=ye([].push),yF=dt,bk=wr,CF=kt,BC=tt,kT=ye,Ak=re,Ik=Jt,wk=qd,bF=aa,XW=function(e){if(SF(e))return e;if(gF(e)){for(var t=e.length,i=[],r=0;r<t;r++){var a=e[r];typeof a=="string"?vF(i,a):typeof a!="number"&&TF(a)!=="Number"&&TF(a)!=="String"||vF(i,RF(a))}var s=i.length,o=!0;return function(c,d){if(o)return o=!1,d;if(gF(this))return d;for(var l=0;l<s;l++)if(i[l]===c)return d}}},JW=td,Xf=String,Uu=bk("JSON","stringify"),jC=kT(/./.exec),AF=kT("".charAt),ZW=kT("".charCodeAt),QW=kT("".replace),$W=kT(1 .toString),IF=/[\uD800-\uDFFF]/g,Ok=/^[\uD800-\uDBFF]$/,Nk=/^[\uDC00-\uDFFF]$/,Dk=!JW||Ak((function(){var e=bk("Symbol")("stringify detection");return Uu([e])!=="[null]"||Uu({a:e})!=="{}"||Uu(Object(e))!=="{}"})),wF=Ak((function(){return Uu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Uu("\uDEAD")!=='"\\udead"'})),e4=function(e,t){var i=bF(arguments),r=XW(t);if(Ik(r)||e!==void 0&&!wk(e))return i[1]=function(a,s){if(Ik(r)&&(s=BC(r,this,Xf(a),s)),!wk(s))return s},CF(Uu,null,i)},OF=function(e,t,i){var r=AF(i,t-1),a=AF(i,t+1);return jC(Ok,e)&&!jC(Nk,a)||jC(Nk,e)&&!jC(Ok,r)?"\\u"+$W(ZW(e,0),16):e};Uu&&yF({target:"JSON",stat:!0,forced:Dk||wF},{stringify:function(e,t,i){var r=bF(arguments),a=CF(Dk?e4:Uu,null,r);return wF&&typeof a=="string"?QW(a,IF,OF):a}});var NF=sd,t4=Pa;dt({target:"Object",stat:!0,forced:!td||re((function(){NF.f(1)}))},{getOwnPropertySymbols:function(e){var t=NF.f;return t?t(t4(e)):[]}}),Fi("asyncIterator"),Fi("hasInstance"),Fi("isConcatSpreadable"),Fi("iterator"),Fi("match"),Fi("matchAll"),Fi("replace"),Fi("search"),Fi("species"),Fi("split");var i4=ok;Fi("toPrimitive"),i4();var r4=wr,n4=Ha;Fi("toStringTag"),n4(r4("Symbol"),"Symbol"),Fi("unscopables"),Ha(ke.JSON,"JSON",!0);var a4=bn.Symbol,s4=ci,DF=pn.f,Pk=s4("metadata"),PF=Function.prototype;PF[Pk]===void 0&&DF(PF,Pk,{value:null}),Fi("asyncDispose"),Fi("dispose"),Fi("metadata");var o4=a4,Lk=ye,kk=wr("Symbol"),c4=kk.keyFor,LF=Lk(kk.prototype.valueOf),kF=kk.isRegisteredSymbol||function(e){try{return c4(LF(e))!==void 0}catch{return!1}};dt({target:"Symbol",stat:!0},{isRegisteredSymbol:kF});for(var MF=Es,UF=wr,d4=ye,l4=qd,Hw=ci,GC=UF("Symbol"),Mk=GC.isWellKnownSymbol,xF=UF("Object","getOwnPropertyNames"),VF=d4(GC.prototype.valueOf),Kw=MF("wks"),Yw=0,FF=xF(GC),BF=FF.length;Yw<BF;Yw++)try{var Uk=FF[Yw];l4(GC[Uk])&&Hw(Uk)}catch{}var _g=function(e){if(Mk&&Mk(e))return!0;try{for(var t=VF(e),i=0,r=xF(Kw),a=r.length;i<a;i++)if(Kw[r[i]]==t)return!0}catch{}return!1};dt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:_g}),Fi("customMatcher"),Fi("observable"),dt({target:"Symbol",stat:!0},{isRegistered:kF}),dt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:_g}),Fi("matcher"),Fi("metadataKey"),Fi("patternMatch"),Fi("replaceAll");var fg=X(o4),MT=X(ku.f("iterator"));function WC(e){return WC=typeof fg=="function"&&typeof MT=="symbol"?function(t){return typeof t}:function(t){return t&&typeof fg=="function"&&t.constructor===fg&&t!==fg.prototype?"symbol":typeof t},WC(e)}var u4=X(ku.f("toPrimitive"));function F(e){var t=(function(i,r){if(WC(i)!="object"||!i)return i;var a=i[u4];if(a!==void 0){var s=a.call(i,r);if(WC(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(i)})(e,"string");return WC(t)=="symbol"?t:t+""}function V(e,t,i){return(t=F(t))in e?XL(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var jF=X(WG),xk={isBrowser:!0,classes:{URLSearchParams:jF!==void 0?jF:kC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const HC=typeof window<"u"&&typeof document<"u",Vk=typeof navigator=="object"&&navigator||void 0,h4=HC&&(!Vk||["ReactNative","NativeScript","NS"].indexOf(Vk.product)<0),p4=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",GF=HC&&window.location.href||"http://localhost";function Fk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function so(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Fk(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Fk(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}var Do=so(so({},Object.freeze({__proto__:null,hasBrowserEnv:HC,hasStandardBrowserEnv:h4,hasStandardBrowserWebWorkerEnv:p4,navigator:Vk,origin:GF})),xk),_4=Vr,f4=tt,E4=Bi,m4=Be,WF=function(){var e=_4(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Bk=RegExp.prototype,HF=function(e){var t=e.flags;return t!==void 0||"flags"in Bk||E4(e,"flags")||!m4(Bk,e)?t:f4(WF,e)},KF=Hp.charAt,YF=tt,g4=Vr,S4=Jt,T4=tr,R4=/./.exec,v4=TypeError,zF=dt,jk=tt,qF=ha,zw=Sf,KC=uu,Gk=Xs,UT=dh,YC=Fr,y4=Vr,C4=Ir,b4=tr,XF=pS,JF=HF,A4=vc,I4=re,w4=vf,O4=function(e,t,i){return t+(i?KF(e,t).length:1)},ZF=function(e,t){var i=e.exec;if(S4(i)){var r=YF(i,e,t);return r!==null&&g4(r),r}if(T4(e)==="RegExp")return YF(R4,e,t);throw new v4("RegExp#exec called on incompatible receiver")},QF=gs,$F=ci("matchAll"),Wk="RegExp String",eB=Wk+" Iterator",N4=QF.set,D4=QF.getterFor(eB),Hk=TypeError,xT=qF("".indexOf),VT=qF("".matchAll),Kk=!!VT&&!I4((function(){VT("a",/./)})),tB=zw((function(e,t,i,r){N4(this,{type:eB,regexp:e,string:t,global:i,unicode:r,done:!1})}),Wk,(function(){var e=D4(this);if(e.done)return KC(void 0,!0);var t=e.regexp,i=e.string,r=ZF(t,i);return r===null?(e.done=!0,KC(void 0,!0)):e.global?(YC(r[0])===""&&(t.lastIndex=O4(i,UT(t.lastIndex),e.unicode)),KC(r,!1)):(e.done=!0,KC(r,!1))})),iB=function(e){var t,i,r,a=y4(this),s=YC(e),o=w4(a,RegExp),c=YC(JF(a));return t=new o(o===RegExp?a.source:a,c),i=!!~xT(c,"g"),r=!!~xT(c,"u"),t.lastIndex=UT(a.lastIndex),new tB(t,s,i,r)};zF({target:"String",proto:!0,forced:Kk},{matchAll:function(e){var t,i,r,a,s=Gk(this);if(C4(e)){if(XF(e)&&(t=YC(Gk(JF(e))),!~xT(t,"g")))throw new Hk("`.matchAll` does not allow non-global regexes");if(Kk)return VT(s,e);if((r=A4(e,$F))===void 0&&b4(e)==="RegExp"&&(r=iB),r)return jk(r,e,s)}else if(Kk)return VT(s,e);return i=YC(s),a=new RegExp(e,"g"),jk(iB,a,i)}});var P4=Bn("String","matchAll"),L4=Be,Yk=P4,zk=String.prototype,k4=function(e){var t=e.matchAll;return typeof e=="string"||e===zk||L4(zk,e)&&t===zk.matchAll?Yk:t},rB=X(k4);function qw(e){function t(i,r,a,s){let o=i[s++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),d=s>=i.length;return o=!o&&ae.isArray(a)?a.length:o,d?(ae.hasOwnProp(a,o)?a[o]=[a[o],r]:a[o]=r,!c):(a[o]&&ae.isObject(a[o])||(a[o]=[]),t(i,r,a[o],s)&&ae.isArray(a[o])&&(a[o]=(function(l){const h={},_=Object.keys(l);let f;const m=_.length;let S;for(f=0;f<m;f++)S=_[f],h[S]=l[S];return h})(a[o])),!c)}if(ae.isFormData(e)&&ae.isFunction(e.entries)){const i={};return ae.forEachEntry(e,((r,a)=>{t((function(s){return rB(ae).call(ae,/\w+|\[(\w*)]/g,s).map((o=>o[0]==="[]"?"":o[1]||o[0]))})(r),a,i,0)})),i}return null}const zC={transitional:KL,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",r=i.indexOf("application/json")>-1,a=ae.isObject(e);if(a&&ae.isHTMLForm(e)&&(e=new FormData(e)),ae.isFormData(e))return r?JSON.stringify(qw(e)):e;if(ae.isArrayBuffer(e)||ae.isBuffer(e)||ae.isStream(e)||ae.isFile(e)||ae.isBlob(e)||ae.isReadableStream(e))return e;if(ae.isArrayBufferView(e))return e.buffer;if(ae.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(i.indexOf("application/x-www-form-urlencoded")>-1)return(function(o,c){return ug(o,new Do.classes.URLSearchParams,Object.assign({visitor:function(d,l,h,_){return Do.isNode&&ae.isBuffer(d)?(this.append(l,d.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},c))})(e,this.formSerializer).toString();if((s=ae.isFileList(e))||i.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return ug(s?{"files[]":e}:e,o&&new o,this.formSerializer)}}return a||r?(t.setContentType("application/json",!1),(function(o,c,d){if(ae.isString(o))try{return(c||JSON.parse)(o),hr(ae).call(ae,o)}catch(l){if(l.name!=="SyntaxError")throw l}return(d||JSON.stringify)(o)})(e)):e}],transformResponse:[function(e){const t=this.transitional||zC.transitional,i=t&&t.forcedJSONParsing,r=this.responseType==="json";if(ae.isResponse(e)||ae.isReadableStream(e))return e;if(e&&ae.isString(e)&&(i&&!this.responseType||r)){const a=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(a)throw s.name==="SyntaxError"?St.from(s,St.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Do.classes.FormData,Blob:Do.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ae.forEach(["delete","get","head","post","put","patch"],(e=>{zC.headers[e]={}}));var qk=zC;const nB=ae.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),FT=Symbol("internals");function Jf(e){var t;return e&&hr(t=String(e)).call(t).toLowerCase()}function BT(e){return e===!1||e==null?e:ae.isArray(e)?e.map(BT):String(e)}function jT(e,t,i,r,a){return ae.isFunction(r)?r.call(this,t,i):(a&&(t=i),ae.isString(t)?ae.isString(r)?t.indexOf(r)!==-1:ae.isRegExp(r)?r.test(t):void 0:void 0)}class Mc{constructor(t){t&&this.set(t)}set(t,i,r){const a=this;function s(d,l,h){const _=Jf(l);if(!_)throw new Error("header name must be a non-empty string");const f=ae.findKey(a,_);(!f||a[f]===void 0||h===!0||h===void 0&&a[f]!==!1)&&(a[f||l]=BT(d))}const o=(d,l)=>ae.forEach(d,((h,_)=>s(h,_,l)));if(ae.isPlainObject(t)||t instanceof this.constructor)o(t,i);else if(ae.isString(t)&&(t=hr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(hr(c=t).call(c)))o((d=>{const l={};let h,_,f;return d&&d.split(`
`).forEach((function(m){var S,T;f=m.indexOf(":"),h=hr(S=m.substring(0,f)).call(S).toLowerCase(),_=hr(T=m.substring(f+1)).call(T),!h||l[h]&&nB[h]||(h==="set-cookie"?l[h]?l[h].push(_):l[h]=[_]:l[h]=l[h]?l[h]+", "+_:_)})),l})(t),i);else if(ae.isObject(t)&&ae.isIterable(t)){let d,l,h={};for(const _ of t){if(!ae.isArray(_))throw TypeError("Object iterator must return a key-value pair");h[l=_[0]]=(d=h[l])?ae.isArray(d)?[...d,_[1]]:[d,_[1]]:_[1]}o(h,i)}else t!=null&&s(i,t,r);var c;return this}get(t,i){if(t=Jf(t)){const r=ae.findKey(this,t);if(r){const a=this[r];if(!i)return a;if(i===!0)return(function(s){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=c.exec(s);)o[d[1]]=d[2];return o})(a);if(ae.isFunction(i))return i.call(this,a,r);if(ae.isRegExp(i))return i.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=Jf(t)){const r=ae.findKey(this,t);return!(!r||this[r]===void 0||i&&!jT(0,this[r],r,i))}return!1}delete(t,i){const r=this;let a=!1;function s(o){if(o=Jf(o)){const c=ae.findKey(r,o);!c||i&&!jT(0,r[c],c,i)||(delete r[c],a=!0)}}return ae.isArray(t)?t.forEach(s):s(t),a}clear(t){const i=Object.keys(this);let r=i.length,a=!1;for(;r--;){const s=i[r];t&&!jT(0,this[s],s,t,!0)||(delete this[s],a=!0)}return a}normalize(t){const i=this,r={};return ae.forEach(this,((a,s)=>{var o;const c=ae.findKey(r,s);if(c)return i[c]=BT(a),void delete i[s];const d=t?(function(l){return hr(l).call(l).toLowerCase().replace(/([a-z\d])(\w*)/g,((h,_,f)=>_.toUpperCase()+f))})(s):hr(o=String(s)).call(o);d!==s&&delete i[s],i[d]=BT(a),r[d]=!0})),this}concat(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return this.constructor.concat(this,...i)}toJSON(t){const i=Object.create(null);return ae.forEach(this,((r,a)=>{r!=null&&r!==!1&&(i[a]=t&&ae.isArray(r)?r.join(", "):r)})),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((t=>{let[i,r]=t;return i+": "+r})).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const i=new this(t);for(var r=arguments.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];return a.forEach((o=>i.set(o))),i}static accessor(t){const i=(this[FT]=this[FT]={accessors:{}}).accessors,r=this.prototype;function a(s){const o=Jf(s);i[o]||((function(c,d){const l=ae.toCamelCase(" "+d);["get","set","has"].forEach((h=>{Object.defineProperty(c,h+l,{value:function(_,f,m){return this[h].call(this,d,_,f,m)},configurable:!0})}))})(r,s),i[o]=!0)}return ae.isArray(t)?t.forEach(a):a(t),this}}Mc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ae.reduceDescriptors(Mc.prototype,((e,t)=>{let{value:i}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(a){this[r]=a}}})),ae.freezeMethods(Mc);var vd=Mc;function Xw(e,t){const i=this||qk,r=t||i,a=vd.from(r.headers);let s=r.data;return ae.forEach(e,(function(o){s=o.call(i,s,a.normalize(),t?t.status:void 0)})),a.normalize(),s}function Eg(e){return!(!e||!e.__CANCEL__)}function mg(e,t,i){St.call(this,e??"canceled",St.ERR_CANCELED,t,i),this.name="CanceledError"}function qC(e,t,i){const r=i.config.validateStatus;i.status&&r&&!r(i.status)?t(new St("Request failed with status code "+i.status,[St.ERR_BAD_REQUEST,St.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}ae.inherits(mg,St,{__CANCEL__:!0});const XC=function(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const a=(function(s,o){s=s||10;const c=new Array(s),d=new Array(s);let l,h=0,_=0;return o=o!==void 0?o:1e3,function(f){const m=Date.now(),S=d[_];l||(l=m),c[h]=f,d[h]=m;let T=_,R=0;for(;T!==h;)R+=c[T++],T%=s;if(h=(h+1)%s,h===_&&(_=(_+1)%s),m-l<o)return;const C=S&&m-S;return C?Math.round(1e3*R/C):void 0}})(50,250);return(function(s,o){let c,d,l=0,h=1e3/o;const _=function(f){l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,d&&(clearTimeout(d),d=null),s.apply(null,f)};return[function(){const f=Date.now(),m=f-l;for(var S=arguments.length,T=new Array(S),R=0;R<S;R++)T[R]=arguments[R];m>=h?_(T,f):(c=T,d||(d=setTimeout((()=>{d=null,_(c)}),h-m)))},()=>c&&_(c)]})((s=>{const o=s.loaded,c=s.lengthComputable?s.total:void 0,d=o-r,l=a(d);r=o,e({loaded:o,total:c,progress:c?o/c:void 0,bytes:d,rate:l||void 0,estimated:l&&c&&o<=c?(c-o)/l:void 0,event:s,lengthComputable:c!=null,[t?"download":"upload"]:!0})}),i)},Xk=(e,t)=>{const i=e!=null;return[r=>t[0]({lengthComputable:i,total:e,loaded:r}),t[1]]},aB=e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return ae.asap((()=>e(...i)))};var M4=Do.hasStandardBrowserEnv?((e,t)=>i=>(i=new Qm(i,Do.origin),e.protocol===i.protocol&&e.host===i.host&&(t||e.port===i.port)))(new Qm(Do.origin),Do.navigator&&/(msie|trident)/i.test(Do.navigator.userAgent)):()=>!0,sB=Do.hasStandardBrowserEnv?{write(e,t,i,r,a,s){const o=[e+"="+encodeURIComponent(t)];ae.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),ae.isString(r)&&o.push("path="+r),ae.isString(a)&&o.push("domain="+a),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Jk(e,t,i){let r=!(function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)})(t);return e&&(r||i==0)?(function(a,s){return s?a.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):a})(e,t):t}function Zk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}const Zf=e=>e instanceof vd?(function(t){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zk(Object(r),!0).forEach((function(a){V(t,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zk(Object(r)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))}))}return t})({},e):e;function Qf(e,t){t=t||{};const i={};function r(l,h,_,f){return ae.isPlainObject(l)&&ae.isPlainObject(h)?ae.merge.call({caseless:f},l,h):ae.isPlainObject(h)?ae.merge({},h):ae.isArray(h)?h.slice():h}function a(l,h,_,f){return ae.isUndefined(h)?ae.isUndefined(l)?void 0:r(void 0,l,0,f):r(l,h,0,f)}function s(l,h){if(!ae.isUndefined(h))return r(void 0,h)}function o(l,h){return ae.isUndefined(h)?ae.isUndefined(l)?void 0:r(void 0,l):r(void 0,h)}function c(l,h,_){return _ in t?r(l,h):_ in e?r(void 0,l):void 0}const d={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(l,h,_)=>a(Zf(l),Zf(h),0,!0)};return ae.forEach(Object.keys(Object.assign({},e,t)),(function(l){const h=d[l]||a,_=h(e[l],t[l],l);ae.isUndefined(_)&&h!==c||(i[l]=_)})),i}var oB=e=>{const t=Qf({},e);let i,{data:r,withXSRFToken:a,xsrfHeaderName:s,xsrfCookieName:o,headers:c,auth:d}=t;if(t.headers=c=vd.from(c),t.url=WL(Jk(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),ae.isFormData(r)){if(Do.hasStandardBrowserEnv||Do.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((i=c.getContentType())!==!1){const[l,...h]=i?i.split(";").map((_=>hr(_).call(_))).filter(Boolean):[];c.setContentType([l||"multipart/form-data",...h].join("; "))}}if(Do.hasStandardBrowserEnv&&(a&&ae.isFunction(a)&&(a=a(t)),a||a!==!1&&M4(t.url))){const l=s&&o&&sB.read(o);l&&c.set(s,l)}return t},U4=typeof XMLHttpRequest<"u"&&function(e){return new se((function(t,i){const r=oB(e);let a=r.data;const s=vd.from(r.headers).normalize();let o,c,d,l,h,{responseType:_,onUploadProgress:f,onDownloadProgress:m}=r;function S(){l&&l(),h&&h(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let T=new XMLHttpRequest;function R(){if(!T)return;const b=vd.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders());qC((function(N){t(N),S()}),(function(N){i(N),S()}),{data:_&&_!=="text"&&_!=="json"?T.response:T.responseText,status:T.status,statusText:T.statusText,headers:b,config:e,request:T}),T=null}T.open(r.method.toUpperCase(),r.url,!0),T.timeout=r.timeout,"onloadend"in T?T.onloadend=R:T.onreadystatechange=function(){T&&T.readyState===4&&(T.status!==0||T.responseURL&&T.responseURL.indexOf("file:")===0)&&setTimeout(R)},T.onabort=function(){T&&(i(new St("Request aborted",St.ECONNABORTED,e,T)),T=null)},T.onerror=function(){i(new St("Network Error",St.ERR_NETWORK,e,T)),T=null},T.ontimeout=function(){let b=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const N=r.transitional||KL;r.timeoutErrorMessage&&(b=r.timeoutErrorMessage),i(new St(b,N.clarifyTimeoutError?St.ETIMEDOUT:St.ECONNABORTED,e,T)),T=null},a===void 0&&s.setContentType(null),"setRequestHeader"in T&&ae.forEach(s.toJSON(),(function(b,N){T.setRequestHeader(N,b)})),ae.isUndefined(r.withCredentials)||(T.withCredentials=!!r.withCredentials),_&&_!=="json"&&(T.responseType=r.responseType),m&&([d,h]=XC(m,!0),T.addEventListener("progress",d)),f&&T.upload&&([c,l]=XC(f),T.upload.addEventListener("progress",c),T.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(o=b=>{T&&(i(!b||b.type?new mg(null,e,T):b),T.abort(),T=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const C=(function(b){const N=/^([-+\w]{1,25})(:?\/\/|:)/.exec(b);return N&&N[1]||""})(r.url);C&&Do.protocols.indexOf(C)===-1?i(new St("Unsupported protocol "+C+":",St.ERR_BAD_REQUEST,e)):T.send(a||null)}))},Qk=(e,t)=>{const{length:i}=e=e?e.filter(Boolean):[];if(t||i){let r,a=new AbortController;const s=function(l){if(!r){r=!0,c();const h=l instanceof Error?l:this.reason;a.abort(h instanceof St?h:new mg(h instanceof Error?h.message:h))}};let o=t&&setTimeout((()=>{o=null,s(new St("timeout ".concat(t," of ms exceeded"),St.ETIMEDOUT))}),t);const c=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach((l=>{l.unsubscribe?l.unsubscribe(s):l.removeEventListener("abort",s)})),e=null)};e.forEach((l=>l.addEventListener("abort",s)));const{signal:d}=a;return d.unsubscribe=()=>ae.asap(c),d}},Jw=X(jf),cB=ku.f("asyncIterator"),$k=X(cB);function cc(e,t){this.v=e,this.k=t}function oo(e){return function(){return new di(e.apply(this,arguments))}}function di(e){var t,i;function r(s,o){try{var c=e[s](o),d=c.value,l=d instanceof cc;Jw.resolve(l?d.v:d).then((function(h){if(l){var _=s==="return"?"return":"next";if(!d.k||h.done)return r(_,h);h=e[_](h).value}a(c.done?"return":"normal",h)}),(function(h){r("throw",h)}))}catch(h){a("throw",h)}}function a(s,o){switch(s){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):i=null}this._invoke=function(s,o){return new Jw((function(c,d){var l={key:s,arg:o,resolve:c,reject:d,next:null};i?i=i.next=l:(t=i=l,r(s,o))}))},typeof e.return!="function"&&(this.return=void 0)}function hi(e){return new cc(e,0)}function GT(e){var t={},i=!1;function r(a,s){return i=!0,s=new Jw((function(o){o(e[a](s))})),{done:!1,value:new cc(s,1)}}return t[fg!==void 0&&MT||"@@iterator"]=function(){return this},t.next=function(a){return i?(i=!1,a):r("next",a)},typeof e.throw=="function"&&(t.throw=function(a){if(i)throw i=!1,a;return r("throw",a)}),typeof e.return=="function"&&(t.return=function(a){return i?(i=!1,a):r("return",a)}),t}di.prototype[typeof fg=="function"&&$k||"@@asyncIterator"]=function(){return this},di.prototype.next=function(e){return this._invoke("next",e)},di.prototype.throw=function(e){return this._invoke("throw",e)},di.prototype.return=function(e){return this._invoke("return",e)};var JC=X(cB);function WT(e){var t,i,r,a=2;for(typeof Symbol<"u"&&(i=JC,r=Symbol.iterator);a--;){if(i&&(t=e[i])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new Zw(t.call(e));i="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Zw(e){function t(i){if(Object(i)!==i)return se.reject(new TypeError(i+" is not an object."));var r=i.done;return se.resolve(i.value).then((function(a){return{value:a,done:r}}))}return Zw=function(i){this.s=i,this.n=i.next},Zw.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return r===void 0?se.resolve({value:i,done:!0}):t(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return r===void 0?se.reject(i):t(r.apply(this.s,arguments))}},new Zw(e)}const x4=function*(e,t){let i=e.byteLength;if(!t||i<t)return void(yield e);let r,a=0;for(;a<i;)r=a+t,yield e.slice(a,r),a=r},V4=(function(){var e=oo((function*(t,i){var r,a=!1,s=!1;try{for(var o,c=WT(dB(t));a=!(o=yield hi(c.next())).done;a=!1){const d=o.value;yield*GT(WT(x4(d,i)))}}catch(d){s=!0,r=d}finally{try{a&&c.return!=null&&(yield hi(c.return()))}finally{if(s)throw r}}}));return function(t,i){return e.apply(this,arguments)}})(),dB=(function(){var e=oo((function*(t){if(t[JC])return void(yield*GT(WT(t)));const i=t.getReader();try{for(;;){const{done:r,value:a}=yield hi(i.read());if(r)break;yield a}}finally{yield hi(i.cancel())}}));return function(t){return e.apply(this,arguments)}})(),e1=(e,t,i,r)=>{const a=V4(e,t);let s,o=0,c=d=>{s||(s=!0,r&&r(d))};return new ReadableStream({async pull(d){try{const{done:l,value:h}=await a.next();if(l)return c(),void d.close();let _=h.byteLength;if(i){let f=o+=_;i(f)}d.enqueue(new Uint8Array(h))}catch(l){throw c(l),l}},cancel:d=>(c(d),a.return())},{highWaterMark:2})};function t1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function ZC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?t1(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t1(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}const QC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",lB=QC&&typeof ReadableStream=="function",uB=QC&&(typeof TextEncoder=="function"?(i1=new TextEncoder,e=>i1.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var i1;const hB=function(e){try{for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return!!e(...i)}catch{return!1}},r1=lB&&hB((()=>{let e=!1;const t=new Request(Do.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),HT=lB&&hB((()=>ae.isReadableStream(new Response("").body))),$C={stream:HT&&(e=>e.body)};var pB;QC&&(pB=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!$C[e]&&($C[e]=ae.isFunction(pB[e])?t=>t[e]():(t,i)=>{throw new St("Response type '".concat(e,"' is not supported"),St.ERR_NOT_SUPPORT,i)})})));const F4=async(e,t)=>{const i=ae.toFiniteNumber(e.getContentLength());return i??(async r=>r==null?0:ae.isBlob(r)?r.size:ae.isSpecCompliantForm(r)?(await new Request(Do.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:ae.isArrayBufferView(r)||ae.isArrayBuffer(r)?r.byteLength:(ae.isURLSearchParams(r)&&(r+=""),ae.isString(r)?(await uB(r)).byteLength:void 0))(t)};var n1=QC&&(async e=>{let{url:t,method:i,data:r,signal:a,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:d,responseType:l,headers:h,withCredentials:_="same-origin",fetchOptions:f}=oB(e);l=l?(l+"").toLowerCase():"text";let m,S=Qk([a,s&&s.toAbortSignal()],o);const T=S&&S.unsubscribe&&(()=>{S.unsubscribe()});let R;try{if(d&&r1&&i!=="get"&&i!=="head"&&(R=await F4(h,r))!==0){let P,U=new Request(t,{method:"POST",body:r,duplex:"half"});if(ae.isFormData(r)&&(P=U.headers.get("content-type"))&&h.setContentType(P),U.body){const[W,z]=Xk(R,XC(aB(d)));r=e1(U.body,65536,W,z)}}ae.isString(_)||(_=_?"include":"omit");const C="credentials"in Request.prototype;m=new Request(t,ZC(ZC({},f),{},{signal:S,method:i.toUpperCase(),headers:h.normalize().toJSON(),body:r,duplex:"half",credentials:C?_:void 0}));let b=await fetch(m);const N=HT&&(l==="stream"||l==="response");if(HT&&(c||N&&T)){const P={};["status","statusText","headers"].forEach((Q=>{P[Q]=b[Q]}));const U=ae.toFiniteNumber(b.headers.get("content-length")),[W,z]=c&&Xk(U,XC(aB(c),!0))||[];b=new Response(e1(b.body,65536,W,(()=>{z&&z(),T&&T()})),P)}l=l||"text";let k=await $C[ae.findKey($C,l)||"text"](b,e);return!N&&T&&T(),await new se(((P,U)=>{qC(P,U,{data:k,headers:vd.from(b.headers),status:b.status,statusText:b.statusText,config:e,request:m})}))}catch(C){throw T&&T(),C&&C.name==="TypeError"&&/Load failed|fetch/i.test(C.message)?Object.assign(new St("Network Error",St.ERR_NETWORK,e,m),{cause:C.cause||C}):St.from(C,C&&C.code,e,m)}});const Qw={http:null,xhr:U4,fetch:n1};ae.forEach(Qw,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}}));const _B=e=>"- ".concat(e),fB=e=>ae.isFunction(e)||e===null||e===!1;var $w={getAdapter:e=>{e=ae.isArray(e)?e:[e];const{length:t}=e;let i,r;const a={};for(let s=0;s<t;s++){let o;if(i=e[s],r=i,!fB(i)&&(r=Qw[(o=String(i)).toLowerCase()],r===void 0))throw new St("Unknown adapter '".concat(o,"'"));if(r)break;a[o||"#"+s]=r}if(!r){const s=Object.entries(a).map((o=>{let[c,d]=o;return"adapter ".concat(c," ")+(d===!1?"is not supported by the environment":"is not available in the build")}));throw new St("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(_B).join(`
`):" "+_B(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:Qw};function eO(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new mg(null,e)}function a1(e){return eO(e),e.headers=vd.from(e.headers),e.data=Xw.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),$w.getAdapter(e.adapter||qk.adapter)(e).then((function(t){return eO(e),t.data=Xw.call(e,e.transformResponse,t),t.headers=vd.from(t.headers),t}),(function(t){return Eg(t)||(eO(e),t&&t.response&&(t.response.data=Xw.call(e,e.transformResponse,t.response),t.response.headers=vd.from(t.response.headers))),se.reject(t)}))}const eb="1.9.0",tb={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{tb[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}}));const ib={};tb.transitional=function(e,t,i){function r(a,s){return"[Axios v"+eb+"] Transitional option '"+a+"'"+s+(i?". "+i:"")}return(a,s,o)=>{if(e===!1)throw new St(r(s," has been removed"+(t?" in "+t:"")),St.ERR_DEPRECATED);return t&&!ib[s]&&(ib[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,s,o)}},tb.spelling=function(e){return(t,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var yd={assertOptions:function(e,t,i){if(typeof e!="object")throw new St("options must be an object",St.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let a=r.length;for(;a-- >0;){const s=r[a],o=t[s];if(o){const c=e[s],d=c===void 0||o(c,s,e);if(d!==!0)throw new St("option "+s+" must be "+d,St.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new St("Unknown option "+s,St.ERR_BAD_OPTION)}},validators:tb};const Cd=yd.validators;let gg=class{constructor(e){this.defaults=e||{},this.interceptors={request:new HL,response:new HL}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const a=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?a&&!String(i.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+a):i.stack=a}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Qf(this.defaults,t);const{transitional:i,paramsSerializer:r,headers:a}=t;i!==void 0&&yd.assertOptions(i,{silentJSONParsing:Cd.transitional(Cd.boolean),forcedJSONParsing:Cd.transitional(Cd.boolean),clarifyTimeoutError:Cd.transitional(Cd.boolean)},!1),r!=null&&(ae.isFunction(r)?t.paramsSerializer={serialize:r}:yd.assertOptions(r,{encode:Cd.function,serialize:Cd.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),yd.assertOptions(t,{baseUrl:Cd.spelling("baseURL"),withXsrfToken:Cd.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=a&&ae.merge(a.common,a[t.method]);a&&ae.forEach(["delete","get","head","post","put","patch","common"],(m=>{delete a[m]})),t.headers=vd.concat(s,a);const o=[];let c=!0;this.interceptors.request.forEach((function(m){typeof m.runWhen=="function"&&m.runWhen(t)===!1||(c=c&&m.synchronous,o.unshift(m.fulfilled,m.rejected))}));const d=[];let l;this.interceptors.response.forEach((function(m){d.push(m.fulfilled,m.rejected)}));let h,_=0;if(!c){const m=[a1.bind(this),void 0];for(m.unshift.apply(m,o),m.push.apply(m,d),h=m.length,l=se.resolve(t);_<h;)l=l.then(m[_++],m[_++]);return l}h=o.length;let f=t;for(_=0;_<h;){const m=o[_++],S=o[_++];try{f=m(f)}catch(T){S.call(this,T);break}}try{l=a1.call(this,f)}catch(m){return se.reject(m)}for(_=0,h=d.length;_<h;)l=l.then(d[_++],d[_++]);return l}getUri(e){return WL(Jk((e=Qf(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ae.forEach(["delete","get","head","options"],(function(e){gg.prototype[e]=function(t,i){return this.request(Qf(i||{},{method:e,url:t,data:(i||{}).data}))}})),ae.forEach(["post","put","patch"],(function(e){function t(i){return function(r,a,s){return this.request(Qf(s||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:r,data:a}))}}gg.prototype[e]=t(),gg.prototype[e+"Form"]=t(!0)}));var KT=gg;class s1{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new se((function(a){i=a}));const r=this;this.promise.then((a=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](a);r._listeners=null})),this.promise.then=a=>{let s;const o=new se((c=>{r.subscribe(c),s=c})).then(a);return o.cancel=function(){r.unsubscribe(s)},o},t((function(a,s,o){r.reason||(r.reason=new mg(a,s,o),i(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const t=new AbortController,i=r=>{t.abort(r)};return this.subscribe(i),t.signal.unsubscribe=()=>this.unsubscribe(i),t.signal}static source(){let t;return{token:new s1((function(r){t=r})),cancel:t}}}var o1=s1;const c1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(c1).forEach((e=>{let[t,i]=e;c1[i]=t}));var os=c1;const mr=(function e(t){const i=new KT(t),r=AL(KT.prototype.request,i);return ae.extend(r,KT.prototype,i,{allOwnKeys:!0}),ae.extend(r,i,null,{allOwnKeys:!0}),r.create=function(a){return e(Qf(t,a))},r})(qk);mr.Axios=KT,mr.CanceledError=mg,mr.CancelToken=o1,mr.isCancel=Eg,mr.VERSION=eb,mr.toFormData=ug,mr.AxiosError=St,mr.Cancel=mr.CanceledError,mr.all=function(e){return se.all(e)},mr.spread=function(e){return function(t){return e.apply(null,t)}},mr.isAxiosError=function(e){return ae.isObject(e)&&e.isAxiosError===!0},mr.mergeConfig=Qf,mr.AxiosHeaders=vd,mr.formToJSON=e=>qw(ae.isHTMLForm(e)?new FormData(e):e),mr.getAdapter=$w.getAdapter,mr.HttpStatusCode=os,mr.default=mr;var co=mr;const rb=()=>{};function $f(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:rb};return e.promise=new se(((t,i)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(r))}})),e}const Sg=new Map,bd=new Map,Br=new Map;let Ot=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),bi=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({});const pl=new g6;let Ad=pl.getResult(),pi=null;function _i(e){if(!pi){Ad=pl.getResult();const t=(function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return bi.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return bi.CHROME;case"Safari":case"Mobile Safari":return bi.SAFARI;case"Edge":return bi.EDGE;case"Firefox":return bi.FIREFOX;case"QQ":case"QQBrowser":return bi.QQ;case"Opera":return bi.OPERA;case"WeChat":return bi.WECHAT;default:return c.browser.name||""}})(Ad),i=nb(Ad),r=(function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""})(Ad),a=Ad.os.version,s=nb(Ad,!1),o=Ad.device.type;if(!(t&&i&&r&&a))return{name:t,version:i,os:r,osVersion:a,browserVersion:s,deviceType:o};pi={name:t,version:i,os:r,osVersion:a,browserVersion:s,deviceType:o}}return pi}function nb(e){let t,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?t.split(".")[0]:t}function ab(){return _i().os}function sb(){const e=_i();return"".concat(e.os," ").concat(e.osVersion)}function _l(){const e=_i();return!!(Ad.engine.name==="WebKit"&&e.os===Ot.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==bi.SAFARI||Jn()&&e.name!==bi.SAFARI)}function dn(){return _i().name===bi.CHROME}function Ra(){return _i().name===bi.SAFARI}function d1(){const e=_i();if(e.name!==bi.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function jr(){return _i().name===bi.EDGE}function Ci(){return _i().name===bi.FIREFOX}function Jn(){return _i().os===Ot.IOS}function Tg(e){const t=_i();return!(t.name!==bi.CHROME||!t.osVersion)&&Number(t.version)>=e}function tO(e){const t=_i();return!(t.name!==bi.CHROME||!t.osVersion)&&Number(t.version)<e}function ob(e,t,i){const r=_i();return!(r.name!==e||!r.osVersion)&&(i?Number(r.version)>=t&&Number(r.version)<=i:Number(r.version)===t)}function cb(e){const t=_i();return!(t.name!==bi.EDGE||!t.osVersion)&&Number(t.version)>=e}function iO(e){const t=_i();return!(t.name!==bi.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function l1(e){const t=_i();return!(t.name!==bi.SAFARI||!t.osVersion)&&Number(t.version)>=e}function u1(e,t,i){const r=_i();if(r.os!==Ot.IOS||!r.osVersion)return!1;const a=r.osVersion.split(".");return i?t&&Number(a[0])===e&&Number(a[1])>t||Number(a[0])>e:t?Number(a[0])===e&&Number(a[1])>=t||Number(a[0])>e:Number(a[0])>=e}function rO(e,t,i){const r=_i();if(r.os!==Ot.IOS||!r.osVersion)return!1;const a=r.osVersion.split(".");return t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e}function db(e,t,i){const r=_i();if(r.name!==bi.SAFARI||!r.osVersion||!r.browserVersion)return!1;const a=r.browserVersion.split(".");return i?t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e:t?Number(a[0])===e&&Number(a[1])<=t||Number(a[0])<e:Number(a[0])<=e}function nO(e){const t=_i();return!(t.name!==bi.OPERA||!t.osVersion)&&Number(t.version)>=e}function Rg(){const e=_i();if(e.os!==Ot.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function eE(){const e=_i();if(e.os!==Ot.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function aO(){const e=_i();if(e.os!==Ot.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function Id(){const e=_i();if(e.os!==Ot.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function wd(){return Ra()&&navigator.maxTouchPoints>0}function h1(){return _i().name===bi.WECHAT}function sO(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function xu(){const e=ab();return(function(){const{deviceType:t}=_i();return t==="mobile"||t==="tablet"})()||e===Ot.ANDROID||e===Ot.IOS||e===Ot.HARMONY_OS}function fl(){const e=_i();return e.name!==bi.EDGE&&e.name!==bi.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function tE(){return ab()===Ot.ANDROID}function Rt(){const e=_i();return tE()&&(e.name===bi.CHROME||e.name===bi.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function wt(e,t,i){return(t=(function(r){var a=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof a=="symbol"?a:a+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function we(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function M(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?we(Object(i),!0).forEach((function(r){wt(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):we(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}let L=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),_e=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(t),wt(this,"code",void 0),wt(this,"message",void 0),wt(this,"data",void 0),wt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function gr(e,t){if(typeof e!="boolean")throw new _e(L.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Bt(e,t,i){if(!ee(i).call(i,e))throw new _e(L.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(i)))}function ji(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(a){return typeof a=="number"&&a%1==0})(e))throw new _e(L.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(i,", ").concat(r,"]. integer only"))}function Zn(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new _e(L.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&ji(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&ji(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&ji(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&ji(e.ideal,"".concat(t,".ideal"),1,1/0)}else ji(e,t,1,1/0)}function rn(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new _e(L.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!YT(e,i,r,a))throw new _e(L.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(i,",").concat(r,"].").concat(a?" ASCII characters only.":""))}function zi(e,t){if(!Array.isArray(e))throw new _e(L.INVALID_PARAMS,"".concat(t," should be an array"))}function Gr(e){return e==null}function YT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=t&&(!r||(function(a){if(typeof a!="string")return!1;for(let s=0;s<a.length;s+=1){const o=a.charCodeAt(s);if(o<0||o>255)return!1}return!0})(e))}var vg=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(vg||{}),oO=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(oO||{});const cO=new class{constructor(){wt(this,"_clientSize",null),wt(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),wt(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),wt(this,"getStyle",(e=>window.getComputedStyle(e,null))),wt(this,"checkCssVisibleProperty",(e=>{var t;let i=!0;const r=this.getStyle(e),{display:a,visibility:s,opacity:o,filter:c}=r;return(a==="none"||ee(t=["hidden","collapse"]).call(t,s)||Number(o)<.1)&&(i=!1),!!i&&(c&&c.split(" ").filter((d=>{var l;const h=d.split("(")[0];return ee(l=["brightness","blur","opacity"]).call(l,h)})).map((d=>{const[l,h]=d.split(/\(|\)/);return[l,Number(h.match(/^[0-9\.]+/))]})).forEach((d=>{const[l,h]=d;switch(l){case"brightness":(h<.1||h>3)&&(i=!1);break;case"blur":h>3&&(i=!1);break;case"opacity":h<.1&&(i=!1)}})),i)})),wt(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let i=!0,r=!0;const a=o=>t(o);let s=e;for(;s&&r;)a(s)||(i=!1,r=!1),s=s.parentElement,s||(r=!1);return i})),wt(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),wt(this,"getSizeAboutClient",(e=>{const{width:t,height:i,left:r,right:a,top:s,bottom:o}=e.getBoundingClientRect(),c=this.getClientWidth(),d=this.getClientHeight();return{width:t,height:i,left:r,right:a,top:s,bottom:o,clientWidth:c,clientHeight:d,clientMin:Math.min(c,d)}})),wt(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,t,i)})),wt(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),wt(this,"checkCoverForAPoint",((e,t,i)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==i})),wt(this,"getPointPositionList",(()=>{const{width:e,height:t,left:i,top:r}=this._clientSize,a=e/6,s=t/6,o=[],c=10**6;for(let d=0;d<5;d++)for(let l=0;l<5;l++){const h=(i*c+(d===0?.1:d===4?(a*d*c-1e5)/c:a*d)*c)/c,_=(r*c+(l===0?.1:l===4?(s*l*c-1e5)/c:s*l)*c)/c;o.push({x:h,y:_})}return[...o]})),wt(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((t=>!!t)).length>6)),wt(this,"checkSizeIsVisible",((e,t,i)=>(e>50||i/e<=10)&&(t>50||i/t<=10))),wt(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:i,bottom:r,clientHeight:a,clientWidth:s,clientMin:o}=this._clientSize;let c,d,l,h;if(e<0)c=0;else{if(!(e<s))return!1;c=e}if(t<0)return!1;if(d=t<s?t:s,i<0)l=0;else{if(!(i<a))return!1;l=i}if(r<0)return!1;h=r<a?r:a;const _=d-c,f=h-l;return this.checkSizeIsVisible(_,f,o)})),wt(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),wt(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(vg.COVERED);{const t=this.checkActualSize(),i=this.checkSizeOfPartInClient();return t&&!i?this.returnHiddenResult(vg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(vg.SIZE)}}return this.returnHiddenResult(vg.STYLE)}return this.returnHiddenResult(oO.UNMOUNTED)}return this.returnHiddenResult(oO.INVALID_HTML_ELEMENT)})),wt(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))))}};function dO(e){return new TextEncoder().encode(e)}const lO=function(e,t){const i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i},Sr=async e=>(function(t,i){let r="";return new Uint8Array(t).forEach((a=>{r+=a.toString(i).padStart(2,"0")})),r})(await crypto.subtle.digest("SHA-256",dO(e)),16);class or{constructor(){wt(this,"_events",{}),wt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map((i=>i.listener)):[]}on(t,i){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,i)===-1&&r.push({listener:i,once:!1})}once(t,i){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,i)===-1&&r.push({listener:i,once:!0})}off(t,i){if(!this._events[t])return;const r=this._events[t],a=this._indexOfListener(r,i);a!==-1&&r.splice(a,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const i=this._events[t].map((o=>o));for(var r=arguments.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];for(let o=0;o<i.length;o+=1){const c=i[o];c.once&&this.off(t,c.listener),c.listener.apply(this,a||[])}}safeEmit(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];[...this._events[t]||[]].forEach((s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o?.toString()))}}))}_indexOfListener(t,i){let r=t.length;for(;r--;)if(t[r].listener===i)return r;return-1}}let zT=null;function Jr(){if(zT)return zT;if(window.electron)return zT=window.electron;if(!window.require)return null;try{return zT=window.require("electron"),zT}catch{return null}}let Gt=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e})({}),Tr=(function(e){return e.TRACER="tracer",e})({});function EB(e){return ji(e.timeout,"config.timeout",0,1e5),ji(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ji(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ji(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Vi=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),Oi=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e})({});function qT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((t=>{if(!t.urls)throw Error()}))}catch{return!1}return!0}function uO(e){return rn(e.turnServerURL,"turnServerURL"),rn(e.username,"username"),rn(e.password,"password"),e.udpport&&ji(e.udpport,"udpport",1,99999,!0),e.forceturn&&gr(e.forceturn,"forceturn"),e.security&&gr(e.security,"security"),e.tcpport&&ji(e.tcpport,"tcpport",1,99999,!0),!0}function ri(e){return e.level!==void 0&&Bt(e.level,"level",[1,2,3]),e.delay!==void 0&&ji(e.delay,"delay",0,3e3,!0),!0}let yt=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e})({}),Rr=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),cs=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),kn=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function zt(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return e.getListeners(t).length===0?se.reject(new _e(L.UNEXPECTED_ERROR,"can not emit promise")):new se(((s,o)=>{e.emit(t,...r,s,o)}))}function fi(e,t){if(e.getListeners(t).length===0)return se.resolve();for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return zt(e,t,...r)}function Bs(e,t){if(e.getListeners(t).length===0)return null;for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return Kr(e,t,...r)}function Kr(e,t){let i=null,r=null;for(var a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];if(e.emit(t,...s,(c=>{i=c}),(c=>{r=c})),r!==null)throw r;if(i===null)throw new _e(L.UNEXPECTED_ERROR,"handler is not sync");return i}const Zr=new class extends or{set networkState(e){this.emit(kn.NETWORK_STATE_CHANGE,e,this._networkState),e===cs.ONLINE?this.emit(kn.ONLINE):e===cs.OFFLINE&&(this.onlineWaiter=new se((t=>{this.once(kn.ONLINE,(()=>{this.onlineWaiter=void 0,t(cs.ONLINE)}))})),this.emit(kn.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===cs.ONLINE}constructor(){super(),wt(this,"_moduleName","network-indicator"),wt(this,"_networkState",cs.ONLINE),wt(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=cs.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=cs.OFFLINE}))}};function t_(e,t){const i=e.indexOf(t);i!==-1&&e.splice(i,1)}function i_(e){const t=[];return e.forEach((i=>{t.indexOf(i)===-1&&t.push(i)})),t}function cr(e){se!==void 0?se.resolve().then(e):setTimeout(e,0)}function qi(e){return JSON.parse(JSON.stringify(e))}function iE(e){try{return qi(e)}catch{return e}}const r_={};function Uc(e,t){r_[t]||(r_[t]=!0,e())}function xc(e){const t=window.atob(e),i=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)i[r]=t.charCodeAt(r);return i}function n_(e){let t="";for(let i=0;i<e.length;i+=1)t+=String.fromCharCode(e[i]);return window.btoa(t)}function p1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>t)i=i.slice(0,t);else if(i.length<t){const r=new Uint8Array(t);r.set(i),i=r}return i}function Vu(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=Pn(t).call(t,((o,c)=>o+c.length),0),a=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach((o=>{a.set(o,s),s+=o.length})),a}function Fu(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function mB(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((i=>{t+=typeof i=="string"?Fu(i):i.size})),t+138}function va(e){const t=new _e(L.TIMEOUT,"timeout");return new se(((i,r)=>{window.setTimeout((()=>r(t)),e)}))}function Ht(e){return new se((t=>{window.setTimeout(t,e)}))}function Mi(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(t).concat(i):"".concat(t).concat(i)+Mi(e-i.length,"")}function Yh(){return Mi(32,"").toUpperCase()}const lb=()=>{},_1=new class{constructor(){wt(this,"fnMap",new Map)}throttleByKey(e,t,i,r){for(var a=arguments.length,s=new Array(a>4?a-4:0),o=4;o<a;o++)s[o-4]=arguments[o];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==i){c.fn(...c.args),clearTimeout(c.timer);const d=window.setTimeout((()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)}),i);this.fnMap.set(t,{fn:e,threshold:i,timer:d,args:s,skipFn:r})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,M(M({},c),{},{fn:e,args:s,skipFn:r}))}else{const c=window.setTimeout((()=>{const d=this.fnMap.get(t);d&&d.fn(...d.args),this.fnMap.delete(t)}),i);this.fnMap.set(t,{fn:e,threshold:i,timer:c,args:s,skipFn:r})}}},f1=_1.throttleByKey.bind(_1);function hO(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function pO(e,t){if(!hO(e)||!hO(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const i=[...e];for(let r=0;r<t.length;r++)i[r]=pO(e[r],t[r]);return i}{const i=M({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?i[r]=pO(e[r],t[r]):i[r]=t[r]);return i}}function yg(e,t){let i=[0];if(i=new Array(t).fill(0),e===0)return i;let r=0;for(;e>0&&(i[r]=255&e,e>>=8,r++,r!==t););return i}function rE(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function _O(e){return Pn(e).call(e,((t,i)=>t+i),0)}function gB(e){const t="0123456789abcdef";function i(N){let k,P="";for(k=0;k<=3;k++)P+=t.charAt(N>>8*k+4&15)+t.charAt(N>>8*k&15);return P}function r(N,k){const P=(65535&N)+(65535&k);return(N>>16)+(k>>16)+(P>>16)<<16|65535&P}function a(N,k,P,U,W,z){return r((function(Q,he){return Q<<he|Q>>>32-he})(r(r(k,N),r(U,z)),W),P)}function s(N,k,P,U,W,z,Q){return a(k&P|~k&U,N,k,W,z,Q)}function o(N,k,P,U,W,z,Q){return a(k&U|P&~U,N,k,W,z,Q)}function c(N,k,P,U,W,z,Q){return a(k^P^U,N,k,W,z,Q)}function d(N,k,P,U,W,z,Q){return a(P^(k|~U),N,k,W,z,Q)}const l=(function(N){let k;const P=1+(N.length+8>>6),U=new Array(16*P);for(k=0;k<16*P;k++)U[k]=0;for(k=0;k<N.length;k++)U[k>>2]|=N.charCodeAt(k)<<k%4*8;return U[k>>2]|=128<<k%4*8,U[16*P-2]=8*N.length,U})(e);let h,_,f,m,S,T=1732584193,R=-271733879,C=-1732584194,b=271733878;for(h=0;h<l.length;h+=16)_=T,f=R,m=C,S=b,T=s(T,R,C,b,l[h+0],7,-680876936),b=s(b,T,R,C,l[h+1],12,-389564586),C=s(C,b,T,R,l[h+2],17,606105819),R=s(R,C,b,T,l[h+3],22,-1044525330),T=s(T,R,C,b,l[h+4],7,-176418897),b=s(b,T,R,C,l[h+5],12,1200080426),C=s(C,b,T,R,l[h+6],17,-1473231341),R=s(R,C,b,T,l[h+7],22,-45705983),T=s(T,R,C,b,l[h+8],7,1770035416),b=s(b,T,R,C,l[h+9],12,-1958414417),C=s(C,b,T,R,l[h+10],17,-42063),R=s(R,C,b,T,l[h+11],22,-1990404162),T=s(T,R,C,b,l[h+12],7,1804603682),b=s(b,T,R,C,l[h+13],12,-40341101),C=s(C,b,T,R,l[h+14],17,-1502002290),R=s(R,C,b,T,l[h+15],22,1236535329),T=o(T,R,C,b,l[h+1],5,-165796510),b=o(b,T,R,C,l[h+6],9,-1069501632),C=o(C,b,T,R,l[h+11],14,643717713),R=o(R,C,b,T,l[h+0],20,-373897302),T=o(T,R,C,b,l[h+5],5,-701558691),b=o(b,T,R,C,l[h+10],9,38016083),C=o(C,b,T,R,l[h+15],14,-660478335),R=o(R,C,b,T,l[h+4],20,-405537848),T=o(T,R,C,b,l[h+9],5,568446438),b=o(b,T,R,C,l[h+14],9,-1019803690),C=o(C,b,T,R,l[h+3],14,-187363961),R=o(R,C,b,T,l[h+8],20,1163531501),T=o(T,R,C,b,l[h+13],5,-1444681467),b=o(b,T,R,C,l[h+2],9,-51403784),C=o(C,b,T,R,l[h+7],14,1735328473),R=o(R,C,b,T,l[h+12],20,-1926607734),T=c(T,R,C,b,l[h+5],4,-378558),b=c(b,T,R,C,l[h+8],11,-2022574463),C=c(C,b,T,R,l[h+11],16,1839030562),R=c(R,C,b,T,l[h+14],23,-35309556),T=c(T,R,C,b,l[h+1],4,-1530992060),b=c(b,T,R,C,l[h+4],11,1272893353),C=c(C,b,T,R,l[h+7],16,-155497632),R=c(R,C,b,T,l[h+10],23,-1094730640),T=c(T,R,C,b,l[h+13],4,681279174),b=c(b,T,R,C,l[h+0],11,-358537222),C=c(C,b,T,R,l[h+3],16,-722521979),R=c(R,C,b,T,l[h+6],23,76029189),T=c(T,R,C,b,l[h+9],4,-640364487),b=c(b,T,R,C,l[h+12],11,-421815835),C=c(C,b,T,R,l[h+15],16,530742520),R=c(R,C,b,T,l[h+2],23,-995338651),T=d(T,R,C,b,l[h+0],6,-198630844),b=d(b,T,R,C,l[h+7],10,1126891415),C=d(C,b,T,R,l[h+14],15,-1416354905),R=d(R,C,b,T,l[h+5],21,-57434055),T=d(T,R,C,b,l[h+12],6,1700485571),b=d(b,T,R,C,l[h+3],10,-1894986606),C=d(C,b,T,R,l[h+10],15,-1051523),R=d(R,C,b,T,l[h+1],21,-2054922799),T=d(T,R,C,b,l[h+8],6,1873313359),b=d(b,T,R,C,l[h+15],10,-30611744),C=d(C,b,T,R,l[h+6],15,-1560198380),R=d(R,C,b,T,l[h+13],21,1309151649),T=d(T,R,C,b,l[h+4],6,-145523070),b=d(b,T,R,C,l[h+11],10,-1120210379),C=d(C,b,T,R,l[h+2],15,718787259),R=d(R,C,b,T,l[h+9],21,-343485551),T=r(T,_),R=r(R,f),C=r(C,m),b=r(b,S);return i(T)+i(R)+i(C)+i(b)}let SB=1,xa=console,Wn=class{static setLogger(e){xa=e}constructor(e,t){wt(this,"id",void 0),wt(this,"lockingPromise",se.resolve()),wt(this,"locks",0),wt(this,"name",""),wt(this,"lockId",void 0),this.lockId=SB++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");xa.debug("".concat(i," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const i=new se((a=>{t=()=>{this.locks-=1,this.logger("unlocked",e),a()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>i)),r}};function Yr(e,t){return function(i,r,a){const s=a.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const o=this[t];if(!o)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const c=await o.lock("From ".concat(e,".").concat(r));try{for(var d=arguments.length,l=new Array(d),h=0;h<d;h++)l[h]=arguments[h];return await s.apply(this,l)}finally{c()}},a}}const ln={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Od(e,t){const i=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,i)}function Vc(e,t,i,r){const a=Object.assign({},ln,r);let s=a.timeout;const o=async()=>{await(function(l){return new se((h=>{window.setTimeout(h,l)}))})(s),s*=a.timeoutFactor,s=Math.min(a.maxRetryTimeout,s)};let c=!1;const d=new se((async(l,h)=>{t=t||(()=>!1),i=i||(()=>!0);for(let _=0;_<a.maxRetryCount;_+=1){if(c)return h(new _e(L.OPERATION_ABORTED));try{const f=await e();if(!t(f,_)||_+1===a.maxRetryCount)return l(f);await o()}catch(f){if(!i(f,_)||_+1===a.maxRetryCount)return h(f);await o()}}}));return d.cancel=()=>c=!0,d}let ub,hb=class{constructor(e){wt(this,"input",[]),wt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Pn(e=this.input).call(e,((t,i)=>t+i))/this.input.length}},XT=0,pb=0;function E1(e,t,i,r){return new se(((a,s)=>{t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),XT+=Fu(t.data)):i&&(t.data.size?XT+=t.data.size:t.data instanceof FormData?XT+=mB(t.data):XT+=Fu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,co.request(t).then((o=>{typeof o.data=="string"?pb+=Fu(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?pb+=o.data.byteLength:pb+=Fu(JSON.stringify(o.data)),a(o.data)})).catch((o=>{co.isCancel(o)?s(new _e(L.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new _e(L.NETWORK_TIMEOUT,o.message)):o.response?s(new _e(L.NETWORK_RESPONSE_ERROR,o.response.status)):s(new _e(L.NETWORK_ERROR,o.message))}))}))}async function TB(e,t){const i=new Blob([t.data],{type:"buffer"});return await E1(e,M(M({},t),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Nd=()=>window.isSecureContext!==void 0;function Dd(e){if(Array.isArray(e))return e.map((i=>i));if(!fO(e))return e;const t={};for(const i in e){const r=e[i];fO(r)||Array.isArray(r)?t[i]=Dd(r):t[i]=r}return t}function fO(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let El=class{constructor(e){wt(this,"input",[]),wt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Fc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},JT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Fc,remoteCandidate:Fc},updateInterval:0},m1={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},g1={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},S1={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},EO={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let T1=class{constructor(e,t){wt(this,"onFirstVideoReceived",void 0),wt(this,"onFirstVideoDecoded",void 0),wt(this,"onFirstAudioReceived",void 0),wt(this,"onFirstVideoDecodedTimeout",void 0),wt(this,"onFirstAudioDecoded",void 0),wt(this,"onSelectedLocalCandidateChanged",void 0),wt(this,"onSelectedRemoteCandidateChanged",void 0),wt(this,"videoIsReady",!1),wt(this,"videoIsReady2",{}),wt(this,"pc",void 0),wt(this,"options",void 0),wt(this,"intervalTimer",void 0),wt(this,"stats",Dd(JT)),wt(this,"isFirstVideoReceived",{}),wt(this,"isFirstVideoDecoded",{}),wt(this,"isFirstAudioReceived",{}),wt(this,"isFirstAudioDecoded",{}),wt(this,"isFirstVideoDecodedTimeout",{}),wt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new se((e=>{e({local:M({},Fc),remote:M({},Fc)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,a=0,s=0,o=0;for(const c of i)e[c].forEach(((d,l)=>{if(!this.lossRateWindowStats[t-1][c][l]||!this.lossRateWindowStats[0][c][l])return;const h=this.lossRateWindowStats[t-1][c][l].packets-this.lossRateWindowStats[0][c][l].packets,_=this.lossRateWindowStats[t-1][c][l].packetsLost-this.lossRateWindowStats[0][c][l].packetsLost;c==="videoSend"||c==="audioSend"?(r+=h,s+=_):(a+=h,o+=_),Number.isNaN(h)||Number.isNaN(h)?d.packetLostRate=0:d.packetLostRate=h<=0||_<=0?0:_/(h+_)}));e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=a<=0||o<=0?0:o/(a+o)}},_b=class extends T1{constructor(){super(...arguments),wt(this,"_stats",JT),wt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Dd(JT);const i=t.filter((a=>a.type==="ssrc"));this.processSSRCStats(i);const r=t.find((a=>a.type==="VideoBwe"));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((t=>{var i;const r=ee(i=t.id).call(i,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const a=Dd(g1);a.codec=t.googCodecName,a.adaptionChangeReason="none",t.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(t.googAvgEncodeMs),a.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.firsCount=Number(t.googFirReceived),a.nacksCount=Number(t.googNacksReceived),a.plisCount=Number(t.googPlisReceived),a.frameCount=Number(t.framesEncoded),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=Dd(m1),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(a.codec=t.googCodecName,a.targetDelayMs=Number(t.googTargetDelayMs),a.renderDelayMs=Number(t.googRenderDelayMs),a.currentDelayMs=Number(t.googCurrentDelayMs),a.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),a.decodeMs=Number(t.googDecodeMs),a.maxDecodeMs=Number(t.googMaxDecodeMs),a.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},a.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},a.decodeFrameRate=Number(t.googFrameRateDecoded),a.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},a.jitterBufferMs=Number(t.googJitterBufferMs),a.firsCount=Number(t.googFirsSent),a.nacksCount=Number(t.googNacksSent),a.plisCount=Number(t.googPlisSent),a.framesDecodeCount=Number(t.framesDecoded),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),s){const o=s.stats,c=Date.now()-s.lts;a.framesDecodeFreezeTime=o.framesDecodeFreezeTime,a.framesDecodeInterval=o.framesDecodeInterval,a.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(s.lts=Date.now(),a.framesDecodeInterval=c,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):a.framesDecodeCount<s.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:M({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=Dd(EO);a.codec=t.googCodecName,a.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,a.decodingCNG=Number(t.googDecodingCNG),a.decodingCTN=Number(t.googDecodingCTN),a.decodingCTSG=Number(t.googDecodingCTSG),a.decodingNormal=Number(t.googDecodingNormal),a.decodingPLC=Number(t.googDecodingPLC),a.decodingPLCCNG=Number(t.googDecodingPLCCNG),a.expandRate=Number(t.googExpandRate),a.accelerateRate=Number(t.googAccelerateRate),a.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),a.speechExpandRate=Number(t.googSpeechExpandRate),a.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),a.jitterBufferMs=Number(t.googJitterBufferMs),a.jitterMs=Number(t.googJitterReceived),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),a.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=Dd(S1);a.codec=t.googCodecName,a.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,a.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}}))}_getStats(){return new se(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((i=>{const r={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach((a=>{r[a]=i.stat(a)})),t.push(r)})),t}},nE=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),ZT=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),Po=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),vs=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var zh=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(zh||{});function QT(e,t,i,r){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:zh.kNone;if(!t)return;const s=Number(t[i]);if(typeof s!="number")return;const o=Number(t[r]);if(typeof o!="number")return;if(!e)return o?s/o*a:void 0;const c=Number(e[i]);if(typeof c!="number")return;const d=Number(e[r]);if(typeof d!="number")return;const l=o-d;return l?(s-c)/l*a:void 0}let RB=class extends T1{constructor(){super(...arguments),wt(this,"_stats",JT),wt(this,"report",void 0),wt(this,"lastDecodeVideoReceiverStats",new Map),wt(this,"lastVideoFramesRecv",new Map),wt(this,"lastVideoFramesSent",new Map),wt(this,"lastVideoFramesDecode",new Map),wt(this,"lastVideoFramesOutput",new Map),wt(this,"lastVideoJBDelay",new Map),wt(this,"lastAudioJBDelay",new Map),wt(this,"mediaBytesSent",new Map),wt(this,"mediaBytesRetransmit",new Map),wt(this,"mediaBytesTargetEncode",new Map),wt(this,"lastDecodeAudioReceiverStats",new Map),wt(this,"lastAudioConcealment",new Map),wt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Dd(JT),this.report.forEach((e=>{switch(e.type){case vs.OUTBOUND:case vs.INBOUND:{const t=e.mediaType||e.kind,i=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===vs.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||i)&&this.processVideoOutboundStats(e):e.type===vs.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||i)&&this.processVideoInboundStats(e));break}case vs.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case vs.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:M({},Fc),remote:M({},Fc)};return e.forEach((i=>{let r;if(i.type===vs.TRANSPORT&&(r=e.get(i.selectedCandidatePairId)),i.type===vs.CANDIDATE_PAIR&&i.selected&&(r=i),r){const a=(s,o)=>{s.type=o.type,s.id=o.id,o.address&&(s.address=o.address),o.candidateType&&(s.candidateType=o.candidateType),o.port&&(s.port=o.port),o.priority&&(s.priority=o.priority),o.protocol&&(s.protocol=o.protocol),o.relayProtocol&&(s.relayProtocol=o.relayProtocol)};if(r.localCandidateId){const s=e.get(r.localCandidateId);s&&a(t.local,s)}if(r.remoteCandidateId){const s=e.get(r.remoteCandidateId);s&&a(t.remote,s)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===vs.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===vs.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===vs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(M({},t),M({},this.stats.selectedCandidatePair.localCandidate)),e.type===vs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(M({},t),M({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((r=>r.ssrc===e.ssrc));t||(t=Dd(EO),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=QT(i,t,"totalProcessingDelay","jitterBufferEmittedCount",zh.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,i,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,M({},t))}calculateAudioFreeze(e,t,i){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const a=r.lts,s=i.timestamp,o=s-a;if(o<=0)return;const c=e.concealedSamples-t.concealedSamples-0,d=r.nonSilent+c,l=e.totalSamplesReceived-t.totalSamplesReceived;if(l<=0)return;const h=80*l/o,_=200*l/o,f=o/l;let m=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,d>h&&(r.plc80>0?(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*f)):(e.freezeSamples80+=d,e.freezeMs80+=Math.round(d*f)),m=r.plc80+1);let S=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,d>_&&(r.plc200>0?(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*f)):(e.freezeSamples200+=d,e.freezeMs200+=Math.round(d*f)),S=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:c,lts:s,plc80:m,plc200:S})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:i.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find((o=>o.ssrc===e.ssrc));t||(t=Dd(m1),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),a=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const o=t.decodedFrame?t.decodedFrame.width:0,c=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,o,c),this.isFirstVideoDecoded[t.ssrc]=!0}if(i){const o=i.stats,c=s-i.lts;t.framesDecodeFreezeTime=o.framesDecodeFreezeTime,t.framesDecodeInterval=o.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(i.lts=Date.now(),t.framesDecodeInterval=c,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<o.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=QT(i?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=QT(i?.stats,t,"totalProcessingDelay","framesDecodeCount",zh.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=QT(i?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",zh.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=QT(i?.stats,t,"totalInterFrameDelay","framesDecodeCount",zh.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(a&&s-a.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-a.count)/((s-a.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):a?t.outputFrameRate=a.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:M({},t),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((r=>r.ssrc===e.ssrc));t||(t=Dd(g1),this._stats.videoSend.push(t));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const r=new El(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const a=new El(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const a=new El(10);a.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,a)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const a=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/a}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,vs.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((i=>i.ssrc===e.ssrc));if(t||(t=Dd(S1),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,vs.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}findRemoteStatsId(e,t){var i;const r=Array.from(tn(i=this.report).call(i)).find((a=>a.type===t&&a.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(t.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,t){const i=this.report.get(e);i&&(t.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,t,i){var r,a,s,o;const c=t?this.report.get(t):void 0,d=(r=c?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof d!="number")return;let l=(a=c?.frameWidth)!==null&&a!==void 0?a:e.frameWidth,h=(s=c?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,_=(o=c?.framesPerSecond)!==null&&o!==void 0?o:e.framesPerSecond;if(typeof l=="number"&&typeof h=="number"||(l=0,h=0),_==null){const f=Date.now(),m=this.lastVideoFramesSent.get(i.ssrc);m&&f-m.lts>=800?(_=Math.round((d-m.count)/((f-m.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:d,lts:f,rate:_})):m?_=m.rate:this.lastVideoFramesSent.set(i.ssrc,{count:d,lts:f,rate:0})}i.sentFrame={width:l,height:h,frameRate:Math.max(0,_)}}processVideoTrackReceiverStats(e,t,i){var r,a,s,o,c;const d=t?this.report.get(t):void 0,l=(r=d?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,h=(a=d?.frameWidth)!==null&&a!==void 0?a:e.frameWidth,_=(s=d?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,f=(o=d?.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,m=(c=d?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount;if(typeof l=="number"){const S=this.lastVideoFramesRecv.get(i.ssrc),T=Date.now();i.framesReceivedCount=l;let R=0;S&&T-S.lts>=800?(R=Math.round((l-S.count)/((T-S.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:l,lts:T,rate:R})):S?R=S.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:l,lts:T,rate:0}),i.receivedFrame={width:h||0,height:_||0,frameRate:R||0},i.decodedFrame={width:h||0,height:_||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:h||0,height:_||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(f&&m){const S=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let T=S.jitterBufferMs;const R=m-S.jitterBufferEmittedCount;R>0&&(T=1e3*(f-S.jitterBufferDelay)/R),i.jitterBufferMs=T,i.currentDelayMs=Math.round(T),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:f,jitterBufferEmittedCount:m,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,t,i){var r,a,s,o;const c=t?this.report.get(t):void 0,d=(r=(a=c?.echoReturnLoss)!==null&&a!==void 0?a:e.echoReturnLoss)!==null&&r!==void 0?r:0,l=(s=(o=c?.echoReturnLossEnhancement)!==null&&o!==void 0?o:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;i.aecReturnLoss=d,i.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,i){var r,a,s,o,c,d,l,h,_;const f=t?this.report.get(t):void 0,m=(r=f?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,S=(a=f?.totalSamplesReceived)!==null&&a!==void 0?a:e.totalSamplesReceived,T=(s=f?.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,R=(o=f?.jitterBufferEmittedCount)!==null&&o!==void 0?o:e.jitterBufferEmittedCount,C=(c=f?.audioLevel)!==null&&c!==void 0?c:e?.audioLevel,b=(d=f?.totalSamplesDuration)!==null&&d!==void 0?d:e?.totalSamplesDuration,N=(l=f?.concealedSamples)!==null&&l!==void 0?l:e.concealedSamples,k=(h=f?.silentConcealedSamples)!==null&&h!==void 0?h:e.silentConcealedSamples,P=(_=f?.concealmentEvents)!==null&&_!==void 0?_:e.concealmentEvents;if(typeof S=="number"&&(i.totalSamplesReceived=S),typeof k=="number"&&(i.silentConcealedSamples=k),typeof P=="number"&&(i.concealmentEvents=P),typeof N=="number"&&(i.concealedSamples=N),m&&S&&(i.accelerateRate=m/S),T&&R){const W=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let z=W.jitterBufferMs;const Q=R-W.jitterBufferEmittedCount;Q>0&&(z=1e3*(T-W.jitterBufferDelay)/Q),i.jitterBufferMs=Math.round(z),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:R,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=C;let U=1920;b&&S&&(U=S/b/50,i.receivedFrames=Math.round(S/U)),N&&(i.droppedFrames=Math.round(N/U))}processRemoteInboundStats(e,t){const i=this.report.get(e);i&&(t.packetsLost=i.packetsLost,i.roundTripTime&&(t.rttMs=1e3*i.roundTripTime),i.jitter&&(t.jitterMs=1e3*i.jitter),i.timestamp&&(t.timestamp=i.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const i=t.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,t=null,i=null;this.mediaBytesSent.forEach((a=>{e+=a.diffMean()})),this.mediaBytesRetransmit.forEach((a=>{t=t===null?a.diffMean():t+a.diffMean()})),this.mediaBytesTargetEncode.forEach((a=>{i=i===null?a.diffMean():i+a.diffMean()}));const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},R1=class extends T1{updateStats(){return se.resolve()}};function mO(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=(function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null})();return s?s<76?new _b(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:a}):new RB(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:a}):(function(o){if(!window.RTCStatsReport)return!1;const c=o.getStats();return!!(c instanceof se||(function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"})(c))})(e)?new RB(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:a}):new R1(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:a})}const gO="websdk_ng_install_id";function dc(){try{if(G("INSTALL_ID"))return G("INSTALL_ID");let e=window.localStorage.getItem(gO);return e||(e=Yh(),window.localStorage.setItem(gO,e)),B("INSTALL_ID",e),e}catch{return}}const lc=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],r=t[2];return"".concat(i,".").concat(r)}return"4.0.0.999"})("4.24.0"),a_=(function(){try{return JSON.parse("true")===!0}catch{return!0}})();let wn=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({});const Qn=(function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const r=i.join(""),a=[];for(let c=0;c<6;c++)a.push("1");const s=a.join(""),o={};return o[e]=r,o[t]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Qn;const $T={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},fb={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Eb="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",dr={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Ct=M(M(M(M({},dr),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:fb,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},$T),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function B(e,t,i){var r,a,s;ee(r=Object.keys(Ct)).call(r,e)&&(!i&&ee(a=Object.keys(ft)).call(a,e)||(Ct[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Ct.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,Ct.USE_NEW_NETWORK_CONFIG=s,s&&(Ct.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ct.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ct.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ct.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ct.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ct.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ct.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Ct.ENABLE_INSTANT_VIDEO=!0,Ct.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Ct.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Ct.NEW_TURN_MODE||(Ct.NEW_TURN_MODE=4))))}function G(e){return Ct[e]}a_||(Ct.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ct.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ct.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ct.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ct.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ct.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ct.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ct.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ct.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ct.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ct.AREAS=["NORTH_AMERICA","OVERSEA"]);let ml=(function(e){return e[e.REALTIME=1]="REALTIME",e})({});const ft={};var bt=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(bt||{});let eR=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const vB=128,yB=96,Cg=1e3,tR=10;let CB=0;var lo=(()=>{var e={8:(r,a,s)=>{s.r(a),s.d(a,{Parser:()=>Q,Printer:()=>ot,parse:()=>ne,print:()=>ie});const o=`
`,c="".concat("\r").concat(o),d=" ";let l;function h(A){return A>="0"&&A<="9"}function _(A){return A>="!"&&A<="~"}function f(A){return _(A)||A>=""&&A<="ÿ"}function m(A){return A==="!"||A>="#"&&A<="'"||A>="*"&&A<="+"||A>="-"&&A<="."||A>="0"&&A<="9"||A>="A"&&A<="Z"||A>="^"&&A<="~"}function S(A){return A>="1"&&A<="9"}function T(A){return A>="A"&&A<="Z"||A>="a"&&A<="z"}function R(A){return A==="d"||A==="h"||A==="m"||A==="s"}function C(A){return A>""&&A<"	"||A>"\v"&&A<"\f"||A>""&&A<"ÿ"}function b(A){return T(A)||h(A)||A==="+"||A==="/"}function N(A){return h(A)||T(A)||A==="+"||A==="/"||A==="-"||A==="_"}function k(A){return T(A)||h(A)||A==="+"||A==="/"}function P(A,v){var D=Object.keys(A);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(A);v&&(j=j.filter((function(ue){return Object.getOwnPropertyDescriptor(A,ue).enumerable}))),D.push.apply(D,j)}return D}function U(A){for(var v=1;v<arguments.length;v++){var D=arguments[v]!=null?arguments[v]:{};v%2?P(Object(D),!0).forEach((function(j){W(A,j,D[j])})):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(D)):P(Object(D)).forEach((function(j){Object.defineProperty(A,j,Object.getOwnPropertyDescriptor(D,j))}))}return A}function W(A,v,D){return v in A?Object.defineProperty(A,v,{value:D,enumerable:!0,configurable:!0,writable:!0}):A[v]=D,A}(function(A){A.VERSION="v",A.ORIGIN="o",A.SESSION_NAME="s",A.INFORMATION="i",A.URI="u",A.EMAIL="e",A.PHONE="p",A.CONNECTION="c",A.BANDWIDTH="b",A.TIME="t",A.REPEAT="r",A.ZONE_ADJUSTMENTS="z",A.KEY="k",A.ATTRIBUTE="a",A.MEDIA="m"})(l||(l={}));class z{consumeText(v,D){let j=D;for(;j<v.length;){const ue=v[j];if(ue==="\0"||ue==="\r"||ue===o)break;j+=1}if(j-D==0)throw new Error("Invalid text, at ".concat(v));return j}consumeUnicastAddress(v,D,j){return this.consumeTill(v,D,d)}consumeOneOrMore(v,D,j){let ue=D;for(;j(v[ue]);)ue++;if(ue-D==0)throw new Error("Invalid rule at ".concat(D,"."));return ue}consumeSpace(v,D){if(v[D]===d)return D+1;throw new Error("Invalid space at ".concat(D,"."))}consumeIP4Address(v,D){let j=D;for(let ue=0;ue<4;ue++)if(j=this.consumeDecimalUChar(v,j),ue!==3){if(v[j]!==".")throw new Error("Invalid IP4 address.");j++}return j}consumeDecimalUChar(v,D){let j=D;for(let rt=0;rt<3&&h(v[j]);rt++,j++);if(j-D==0)throw new Error("Invalid decimal uchar.");const ue=parseInt(v.slice(D,j));if(ue>=0&&ue<=255)return j;throw new Error("Invalid decimal uchar")}consumeIP6Address(v,D){let j=this.consumeHexpart(v,D);return v[j]===":"&&(j+=1,j=this.consumeIP4Address(v,j)),j}consumeHexpart(v,D){let j=D;if(v[j]===":"&&v[j+1]===":"){j+=2;try{j=this.consumeHexseq(v,j)}catch{}return j}if(j=this.consumeHexseq(v,j),v[j]===":"&&v[j+1]===":"){j+=2;try{j=this.consumeHexseq(v,j)}catch{}return j}return j}consumeHexseq(v,D){let j=D;for(;j=this.consumeHex4(v,j),v[j]===":"&&v[j+1]!==":";)j+=1;return j}consumeHex4(v,D){let j=0;for(;j<4;j++)if(!((ue=v[D+j])>="0"&&ue<="9"||ue>="a"&&ue<="f"||ue>="A"&&ue<="F")){if(j===0)throw new Error("Invalid hex 4");break}var ue;return D+j}consumeFQDN(v,D){let j=D;for(;h(v[j])||T(v[j])||v[j]==="-"||v[j]===".";)j+=1;if(j-D<4)throw new Error("Invalid FQDN");return j}consumeExtnAddr(v,D){return this.consumeOneOrMore(v,D,f)}consumeMulticastAddress(v,D,j){switch(j){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v,D);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v,D);default:try{return this.consumeFQDN(v,D)}catch{return this.consumeExtnAddr(v,D)}}}consumeIP6MulticastAddress(v,D){const j=this.consumeHexpart(v,D);return v[j]==="/"?this.consumeInteger(v,j+1):j}consumeIP4MulticastAddress(v,D){let j=D+3;const ue=v.slice(D,j),rt=parseInt(ue);if(rt<224||rt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let jt=0;jt<3;jt++){if(v[j]!==".")throw new Error("Invalid IP4 multicast address.");j+=1,j=this.consumeDecimalUChar(v,j)}return v[j]==="/"&&(j+=1),j=this.consumeTTL(v,j),v[j]==="/"&&(j=this.consumeInteger(v,j)),j}consumeInteger(v,D){if(!S(v[D]))throw new Error("Invalid integer.");for(D+=1;h(v[D]);)D+=1;return D}consumeTTL(v,D){if(v[D]==="0")return D+1;if(!S(v[D]))throw new Error("Invalid TTL.");D+=1;for(let j=0;j<2&&h(v[D]);j++)D+=1;return D}consumeToken(v,D){return this.consumeOneOrMore(v,D,m)}consumeTime(v,D){let j=D;if(v[j]==="0")return j+1;for(S(v[j])&&(j+=1);h(v[j]);)j++;if(j-D<10)throw new Error("Invalid time");return j}consumeAddress(v,D){return this.consumeTill(v,D,d)}consumeTypedTime(v,D){let j=D;return j=this.consumeOneOrMore(v,j,h),R(v[j])?j+1:j}consumeRepeatInterval(v,D){if(!S(v[D]))throw new Error("Invalid repeat interval");for(D+=1;h(v[D]);)D+=1;return R(v[D])&&(D+=1),D}consumePort(v,D){return this.consumeOneOrMore(v,D,h)}consume(v,D,j){for(let ue=0;ue<j.length;ue++){if(D+ue>=v.length)throw new Error("consume exceeding value length");if(v[D+ue]!==j[ue])throw new Error("consume ".concat(j," failed at ").concat(ue))}return D+j.length}consumeTill(v,D,j){let ue=D;for(;ue<v.length&&(typeof j!="string"||v[ue]!==j)&&(typeof j!="function"||!j(v[ue]));)ue++;return ue}}class Q extends z{constructor(){super(),W(this,"records",[]),W(this,"currentLine",0)}parse(v){const D=this.probeEOL(v);this.records=v.split(D).filter((Vl=>!!hr(Vl).call(Vl))).map(this.parseLine),this.currentLine=0;const j=this.parseVersion(),ue=this.parseOrigin(),rt=this.parseSessionName(),jt=this.parseInformation(),ar=this.parseUri(),ua=this.parseEmail(),Ho=this.parsePhone(),sh=this.parseConnection(),xl=this.parseBandWidth(),M_=this.parseTimeFields(),Qg=this.parseKey(),Ko=this.parseSessionAttribute(),$a=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:j,origin:ue,sessionName:rt,information:jt,uri:ar,emails:ua,phones:Ho,connection:sh,bandwidths:xl,timeFields:M_,key:Qg,attributes:Ko,mediaDescriptions:$a}}getCurrentRecord(){const v=this.records[this.currentLine];if(!v)throw new Error("Record doesn't exit.");return v}probeEOL(v){for(let D=0;D<v.length;D++)if(v[D]===o)return v[D-1]==="\r"?c:o;throw new Error("Invalid newline character.")}parseLine(v,D){if(v.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const j=v[0];if(v[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:j,value:v.slice(2),line:D,cur:0}}parseSessionAttribute(){const v=new Ge;for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==l.ATTRIBUTE)break;const j={attField:this.extractOneOrMore(D,(ue=>m(ue)&&ue!==":")),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,j.attValue=this.extractOneOrMore(D,C)),v.parse(j),this.currentLine++}return v.digest()}parseMediaAttributes(v){const D=new xe(v);for(;this.currentLine<this.records.length;){const j=this.getCurrentRecord();if(j.type!==l.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(j,(rt=>m(rt)&&rt!==":")),_cur:0};j.value[j.cur]===":"&&(j.cur+=1,ue.attValue=this.extractOneOrMore(j,C)),D.parse(ue),this.currentLine++}return D.digest()}parseKey(){const v=this.getCurrentRecord();if(v.type===l.KEY){if(v.value==="prompt"||v.value==="clear:"||v.value==="base64:"||v.value==="uri:")return v.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v=this.getCurrentRecord();if(v.type===l.ZONE_ADJUSTMENTS){const D=[];for(;;)try{const j=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);let ue=!1;v.value[v.cur]==="-"&&(ue=!0,v.cur+=1);const rt=this.extract(v,this.consumeTypedTime);D.push({time:j,typedTime:rt,back:ue})}catch{break}if(D.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,D}return[]}parseRepeat(){const v=[];for(;;){const D=this.getCurrentRecord();if(D.type!==l.REPEAT)break;{const j=this.extract(D,this.consumeRepeatInterval),ue=this.parseTypedTime(D);v.push({repeatInterval:j,typedTimes:ue}),this.currentLine++}}return v}parseTypedTime(v){const D=[];for(;;)try{this.consumeSpaceForRecord(v),D.push(this.extract(v,this.consumeTypedTime))}catch{break}if(D.length===0)throw new Error("Invalid typed time.");return D}parseTime(){const v=this.getCurrentRecord(),D=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);const j=this.extract(v,this.consumeTime);return this.currentLine++,{startTime:D,stopTime:j}}parseBandWidth(){const v=[];for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==l.BANDWIDTH)break;{const j=this.extractOneOrMore(D,m);if(D.value[D.cur]!==":")throw new Error("Invalid bandwidth field.");D.cur++;const ue=this.extractOneOrMore(D,h);v.push({bwtype:j,bandwidth:ue}),this.currentLine++}}return v}parseVersion(){const v=this.getCurrentRecord();if(v.type!==l.VERSION)throw new Error("first sdp record must be version");const D=v.value.slice(0,this.consumeOneOrMore(v.value,0,h));if(D.length!==v.value.length)throw new Error('invalid proto version, "v='.concat(v.value,'"'));return this.currentLine++,D}parseOrigin(){const v=this.getCurrentRecord();if(v.type!==l.ORIGIN)throw new Error("second line of sdp must be origin");const D=this.extractOneOrMore(v,f);this.consumeSpaceForRecord(v);const j=this.extractOneOrMore(v,h);this.consumeSpaceForRecord(v);const ue=this.extractOneOrMore(v,h);this.consumeSpaceForRecord(v);const rt=this.extractOneOrMore(v,m);this.consumeSpaceForRecord(v);const jt=this.extractOneOrMore(v,m);this.consumeSpaceForRecord(v);const ar=this.extract(v,this.consumeUnicastAddress);return this.currentLine++,{username:D,sessId:j,sessVersion:ue,nettype:rt,addrtype:jt,unicastAddress:ar}}parseSessionName(){const v=this.getCurrentRecord();if(v.type===l.SESSION_NAME){const D=this.extract(v,this.consumeText);return this.currentLine++,D}}parseInformation(){const v=this.getCurrentRecord();if(v.type!==l.INFORMATION)return;const D=this.extract(v,this.consumeText);return this.currentLine++,D}parseUri(){const v=this.getCurrentRecord();if(v.type===l.URI)return this.currentLine++,v.value}parseEmail(){const v=[];for(;;){const D=this.getCurrentRecord();if(D.type!==l.EMAIL)break;v.push(D.value),this.currentLine++}return v}parsePhone(){const v=[];for(;;){const D=this.getCurrentRecord();if(D.type!==l.PHONE)break;v.push(D.value),this.currentLine++}return v}parseConnection(){const v=this.getCurrentRecord();if(v.type===l.CONNECTION){const D=this.extractOneOrMore(v,m);this.consumeSpaceForRecord(v);const j=this.extractOneOrMore(v,m);this.consumeSpaceForRecord(v);const ue=this.extract(v,this.consumeAddress);return this.currentLine++,{nettype:D,addrtype:j,address:ue}}}parseMedia(){const v=this.getCurrentRecord(),D=this.extract(v,this.consumeToken);this.consumeSpaceForRecord(v);let j=this.extract(v,this.consumePort);v.value[v.cur]==="/"&&(v.cur+=1,j+=this.extract(v,this.consumeInteger)),this.consumeSpaceForRecord(v);const ue=[];for(ue.push(this.extract(v,this.consumeToken));v.value[v.cur]==="/";)v.cur+=1,ue.push(this.extract(v,this.consumeToken));if(ue.length===0)throw new Error("Invalid proto");const rt=this.parseFmt(v);return this.currentLine++,{mediaType:D,port:j,protos:ue,fmts:rt}}parseTimeFields(){const v=[];for(;this.getCurrentRecord().type===l.TIME;){const D=this.parseTime(),j=this.parseRepeat(),ue=this.parseZone();v.push({time:D,repeats:j,zones:ue})}return v}parseMediaDescription(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.MEDIA;){const D=this.parseMedia(),j=this.parseInformation(),ue=this.parseConnections(),rt=this.parseBandWidth(),jt=this.parseKey(),ar=this.parseMediaAttributes(D);v.push({media:D,information:j,connections:ue,bandwidths:rt,key:jt,attributes:ar})}return v}parseConnections(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.CONNECTION;)v.push(this.parseConnection());return v}parseFmt(v){const D=[];for(;;)try{this.consumeSpaceForRecord(v),D.push(this.extract(v,this.consumeToken))}catch{break}if(D.length===0)throw new Error("Invalid fmts");return D}extract(v,D){for(var j=arguments.length,ue=new Array(j>2?j-2:0),rt=2;rt<j;rt++)ue[rt-2]=arguments[rt];const jt=D.call(this,v.value,v.cur,...ue),ar=v.value.slice(v.cur,jt);return v.cur=jt,ar}extractOneOrMore(v,D){const j=this.consumeOneOrMore(v.value,v.cur,D),ue=v.value.slice(v.cur,j);return v.cur=j,ue}consumeSpaceForRecord(v){if(v.value[v.cur]!==d)throw new Error("Invalid space at ".concat(v.cur,"."));v.cur+=1}}class he extends z{constructor(){super(...arguments),W(this,"attributes",void 0),W(this,"digested",!1)}extractOneOrMore(v,D,j){const ue=this.consumeOneOrMore(v.attValue,v._cur,D),rt=v.attValue.slice(v._cur,ue),[jt,ar]=j||[];if(typeof jt=="number"&&rt.length<jt)throw new Error("error in length, should be more or equal than ".concat(jt," characters."));if(typeof ar=="number"&&rt.length>ar)throw new Error("error in length, should be less or equal than ".concat(ar," characters."));return v._cur=ue,rt}consumeAttributeSpace(v){if(v.attValue[v._cur]!==d)throw new Error("Invalid space at ".concat(v._cur,"."));v._cur+=1}extract(v,D){if(!v.attValue)throw new Error("Nothing to extract from attValue.");for(var j=arguments.length,ue=new Array(j>2?j-2:0),rt=2;rt<j;rt++)ue[rt-2]=arguments[rt];const jt=D.call(this,v.attValue,v._cur,...ue),ar=v.attValue.slice(v._cur,jt);return v._cur=jt,ar}atEnd(v){if(!v.attValue)throw new Error;return v._cur>=v.attValue.length}peekChar(v){if(!v.attValue)throw new Error;return v.attValue[v._cur]}peek(v,D){if(!v.attValue)throw new Error;for(let j=0;j<D.length;j++)if(D[j]!==v.attValue[v._cur+j])return!1;return!0}parseIceUfrag(v){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v,b,[4,256])}parseIcePwd(v){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v,b,[22,256])}parseIceOptions(v){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const D=[];for(;!this.atEnd(v);){D.push(this.extractOneOrMore(v,b));try{this.consumeAttributeSpace(v)}catch(j){if(this.atEnd(v))break;throw j}}this.attributes.iceOptions=D}parseFingerprint(v){const D=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const j=this.extract(v,this.consumeTill);this.attributes.fingerprints.push({hashFunction:D,fingerprint:j})}parseExtmap(v){const D=this.extractOneOrMore(v,h);let j;this.peekChar(v)==="/"&&(this.extract(v,this.consume,"/"),j=this.extract(v,this.consumeToken)),this.consumeAttributeSpace(v);const ue=this.extract(v,this.consumeTill,d),rt=U(U({entry:parseInt(D,10)},j&&{direction:j}),{},{extensionName:ue});this.peekChar(v)===d&&(this.consumeAttributeSpace(v),rt.extensionAttributes=this.extract(v,this.consumeTill)),this.attributes.extmaps.push(rt)}parseSetup(v){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const D=this.extract(v,this.consumeTill);if(D!=="active"&&D!=="passive"&&D!=="actpass"&&D!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=D}}class Ge extends he{constructor(){super(...arguments),W(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"group":this.parseGroup(v);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"fingerprint":this.parseFingerprint(v);break;case"setup":this.parseSetup(v);break;case"tls-id":this.parseTlsId(v);break;case"identity":this.parseIdentity(v);break;case"extmap":this.parseExtmap(v);break;case"msid-semantic":this.parseMsidSemantic(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(D){throw console.error("parsing session attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),D}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v){const D=this.extract(v,this.consumeToken),j=[];for(;!this.atEnd(v)&&this.peekChar(v)===d;)this.consumeAttributeSpace(v),j.push(this.extract(v,this.consumeToken));this.attributes.groups.push({semantic:D,identificationTag:j})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v,N)}parseIdentity(v){const D=this.extractOneOrMore(v,k),j=[];for(;!this.atEnd(v)&&this.peekChar(v)===d;){this.consumeAttributeSpace(v);const ue=this.extract(v,this.consumeToken);this.extract(v,this.consume,"=");const rt=this.extractOneOrMore(v,(jt=>jt!==d&&C(jt)));j.push({name:ue,value:rt})}this.attributes.identities.push({assertionValue:D,extensions:j})}parseMsidSemantic(v){this.peekChar(v)===d&&this.consumeAttributeSpace(v);const D={semantic:this.extract(v,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v)}catch{break}if(this.peekChar(v)==="*"){this.extract(v,this.consume,"*"),D.applyForAll=!0;break}{const j=this.extract(v,this.consumeTill,d);D.identifierList.push(j)}}this.attributes.msidSemantic=D}}class xe extends he{constructor(v){super(),W(this,"attributes",void 0),v.protos.indexOf("RTP")!==-1||v.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"extmap":this.parseExtmap(v);break;case"setup":this.parseSetup(v);break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"candidate":this.parseCandidate(v);break;case"remote-candidate":this.parseRemoteCandidate(v);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v);break;case"rtpmap":this.parseRtpmap(v);break;case"ptime":this.parsePtime(v);break;case"maxptime":this.parseMaxPtime(v);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v);break;case"ssrc":this.parseSSRC(v);break;case"fmtp":this.parseFmtp(v);break;case"rtcp-fb":this.parseRtcpFb(v);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v);break;case"mid":this.parseMid(v);break;case"msid":this.parseMsid(v);break;case"imageattr":this.parseImageAttr(v);break;case"rid":this.parseRid(v);break;case"simulcast":this.parseSimulcast(v);break;case"sctp-port":this.parseSctpPort(v);break;case"max-message-size":this.parseMaxMessageSize(v);break;case"ssrc-group":this.parseSSRCGroup(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(D){throw console.error("parsing media attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),D}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}parseCandidate(v){const D=this.extractOneOrMore(v,b,[1,32]);this.consumeAttributeSpace(v);const j=this.extractOneOrMore(v,h,[1,5]);this.consumeAttributeSpace(v);const ue=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const rt=this.extractOneOrMore(v,h,[1,10]);this.consumeAttributeSpace(v);const jt=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const ar=this.extract(v,this.consumePort);this.consumeAttributeSpace(v),this.extract(v,this.consume,"typ"),this.consumeAttributeSpace(v);const ua={foundation:D,componentId:j,transport:ue,priority:rt,connectionAddress:jt,port:ar,type:this.extract(v,this.consumeToken),extension:{}};for(this.peek(v," raddr")&&(this.extract(v,this.consume," raddr"),this.consumeAttributeSpace(v),ua.relAddr=this.extract(v,this.consumeAddress)),this.peek(v," rport")&&(this.extract(v,this.consume," rport"),this.consumeAttributeSpace(v),ua.relPort=this.extract(v,this.consumePort));this.peekChar(v)===d;){this.consumeAttributeSpace(v);const Ho=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v),ua.extension[Ho]=this.extractOneOrMore(v,_)}this.attributes.candidates.push(ua)}parseRemoteCandidate(v){const D=[];for(;;){const j=this.extractOneOrMore(v,h,[1,5]);this.consumeAttributeSpace(v);const ue=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const rt=this.extract(v,this.consumePort);D.push({componentId:j,connectionAddress:ue,port:rt});try{this.consumeAttributeSpace(v)}catch{break}}this.attributes.remoteCandidatesList.push(D)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v){const D=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const j=this.extract(v,this.consumeTill,"/");this.extract(v,this.consume,"/");const ue={encodingName:j,clockRate:this.extractOneOrMore(v,h)};this.atEnd(v)||this.peekChar(v)!=="/"||(this.extract(v,this.consume,"/"),ue.encodingParameters=parseInt(this.extract(v,this.consumeTill),10));const rt=this.attributes.payloads.find((jt=>jt.payloadType===parseInt(D,10)));rt?rt.rtpMap=ue:this.attributes.payloads.push({payloadType:parseInt(D,10),rtpMap:ue,rtcpFeedbacks:[]})}parsePtime(v){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v,this.consumeTill)}parseMaxPtime(v){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v,this.consumeTill)}parseDirection(v){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v.attField}parseSSRC(v){const D=this.extractOneOrMore(v,h);this.consumeAttributeSpace(v);const j=this.extract(v,this.consumeTill,":");let ue;this.peekChar(v)===":"&&(this.extract(v,this.consume,":"),ue=this.extract(v,this.consumeTill));const rt=this.attributes.ssrcs.find((jt=>jt.ssrcId===parseInt(D,10)));rt?rt.attributes[j]=ue:this.attributes.ssrcs.push({ssrcId:parseInt(D,10),attributes:{[j]:ue}})}parseFmtp(v){const D=this.extract(v,this.consumeTill,d);this.consumeAttributeSpace(v);const j=this.extract(v,this.consumeTill),ue={};j.split(";").forEach((jt=>{let[ar,ua]=jt.split("=");ar=hr(ar).call(ar);const Ho=typeof ua=="string"?hr(ua).call(ua):null;typeof ar=="string"&&ar.length>0&&(ue[ar]=Ho)}));const rt=this.attributes.payloads.find((jt=>jt.payloadType===parseInt(D,10)));rt?rt.fmtp={parameters:ue}:this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[],fmtp:{parameters:ue}})}parseFmtParameters(v){const D={},j=this.extract(v,this.consumeTill,"=");v._cur++;const ue=this.extract(v,this.consumeTill,";");for(D[j]=ue;v.attValue[v._cur]===";";){const rt=this.extract(v,this.consumeTill,"=");v._cur++;const jt=this.extract(v,this.consumeTill,";");D[rt]=jt}return D}parseRtcpFb(v){let D="";D=this.peekChar(v)==="*"?this.extract(v,this.consume,"*"):this.extract(v,this.consumeTill,d),this.consumeAttributeSpace(v);const j=this.extract(v,this.consumeTill,d);let ue;if(j==="trr-int")ue={type:j,interval:this.extract(v,this.consumeTill)};else{const rt={type:j};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),rt.parameter=this.extract(v,this.consumeToken),this.peekChar(v)===d&&(rt.additional=this.extract(v,this.consumeTill))),ue=rt}if(D==="*")this.attributes.rtcpFeedbackWildcards.push(ue);else{const rt=this.attributes.payloads.find((jt=>jt.payloadType===parseInt(D,10)));rt?rt.rtcpFeedbacks.push(ue):this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[ue]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const D={port:this.extract(v,this.consumePort)};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),D.netType=this.extractOneOrMore(v,m),this.consumeAttributeSpace(v),D.addressType=this.extractOneOrMore(v,m),this.consumeAttributeSpace(v),D.address=this.extract(v,this.consumeAddress)),this.attributes.rtcp=D}parseMsid(v){const D={id:this.extractOneOrMore(v,m,[1,64])};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),D.appdata=this.extractOneOrMore(v,m,[1,64])),this.attributes.msids.push(D)}parseImageAttr(v){this.attributes.imageattr.push(v.attValue)}parseRid(v){const D=this.extractOneOrMore(v,(ue=>T(ue)||h(ue)||ue==="_"||ue==="-"));this.consumeAttributeSpace(v);const j={id:D,direction:this.extract(v,this.consumeToken),params:[]};if(this.peekChar(v)===d){if(this.consumeAttributeSpace(v),this.peek(v,"pt=")){this.extract(v,this.consume,"pt=");const ue=[];for(;;){const rt=this.extract(v,this.consumeToken);ue.push(rt);try{this.extract(v,this.consume,",")}catch{break}}j.payloads=ue,this.peekChar(v)===d&&this.extract(v,this.consume,d)}for(;;){const ue=this.extract(v,this.consumeToken);switch(ue){case"depend":{const rt={type:ue,rids:this.extract(v,this.consume,"=").split(",")};j.params.push(rt);break}default:{const rt={type:ue};this.peekChar(v)==="="&&(this.extract(v,this.consume,"="),rt.val=this.extract(v,this.consumeTill,";")),j.params.push(rt)}}try{this.extract(v,this.consume,";")}catch{break}}}this.attributes.rids.push(j)}parseSimulcast(v){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v.attValue,this.extract(v,this.consumeTill)}parseSctpPort(v){this.attributes.sctpPort=this.extractOneOrMore(v,h,[1,5])}parseMaxMessageSize(v){this.attributes.maxMessageSize=this.extractOneOrMore(v,h,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v){this.attributes.mid=this.extract(v,this.consumeToken)}parseSSRCGroup(v){const D=this.extract(v,this.consumeToken),j=[];for(;;)try{this.consumeAttributeSpace(v);const ue=this.extract(v,this.consumeInteger);j.push(parseInt(ue,10))}catch{break}this.attributes.ssrcGroups.push({semantic:D,ssrcIds:j})}}function qe(A,v,D){return v in A?Object.defineProperty(A,v,{value:D,enumerable:!0,configurable:!0,writable:!0}):A[v]=D,A}class ot{constructor(){qe(this,"eol",c)}print(v,D){let j="";return D&&(this.eol=D),j+=this.printVersion(v.version),j+=this.printOrigin(v.origin),j+=this.printSessionName(v.sessionName),j+=this.printInformation(v.information),j+=this.printUri(v.uri),j+=this.printEmail(v.emails),j+=this.printPhone(v.phones),j+=this.printConnection(v.connection),j+=this.printBandwidth(v.bandwidths),j+=this.printTimeFields(v.timeFields),j+=this.printKey(v.key),j+=this.printSessionAttributes(v.attributes),j+=this.printMediaDescription(v.mediaDescriptions),j}printVersion(v){return"v=".concat(v).concat(this.eol)}printOrigin(v){return"o=".concat(v.username," ").concat(v.sessId," ").concat(v.sessVersion," ").concat(v.nettype," ").concat(v.addrtype," ").concat(v.unicastAddress).concat(this.eol)}printSessionName(v){return v?"s=".concat(v).concat(this.eol):""}printInformation(v){return v?"i=".concat(v).concat(this.eol):""}printUri(v){return v?"u=".concat(v).concat(this.eol):""}printEmail(v){let D="";for(const j of v)D+="e=".concat(j).concat(this.eol);return D}printPhone(v){let D="";for(const j of v)D+="e=".concat(j).concat(this.eol);return D}printConnection(v){return v?"c=".concat(v.nettype," ").concat(v.addrtype," ").concat(v.address).concat(this.eol):""}printBandwidth(v){let D="";for(const j of v)D+="b=".concat(j.bwtype,":").concat(j.bandwidth).concat(this.eol);return D}printTimeFields(v){let D="";for(const j of v){D+="t=".concat(j.time.startTime," ").concat(j.time.startTime).concat(this.eol);for(const ue of j.repeats)D+="r=".concat(ue.repeatInterval," ").concat(ue.typedTimes.join(" ")).concat(this.eol);j.zoneAdjustments&&(D+="z=",D+="z=".concat(j.zoneAdjustments.map((ue=>"".concat(ue.time," ").concat(ue.back?"-":""," ").concat(ue.typedTime))).join(" ")).concat(this.eol),D+=this.eol)}return D}printKey(v){return v?"k=".concat(v).concat(this.eol):""}printAttributes(v){let D="";for(const j of v)D+="a=".concat(j.attField).concat(j.attValue?":".concat(j.attValue):"").concat(this.eol);return D}printMediaDescription(v){let D="";for(const j of v)D+=this.printMedia(j.media),D+=this.printInformation(j.information),D+=this.printConnections(j.connections),D+=this.printBandwidth(j.bandwidths),D+=this.printKey(j.key),D+=this.printMediaAttributes(j);return D}printConnections(v){let D="";for(const j of v)D+=this.printConnection(j);return D}printMedia(v){return"m=".concat(v.mediaType," ").concat(v.port," ").concat(v.protos.join("/")," ").concat(v.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v){return new fe(this.eol).print(v)}printMediaAttributes(v){return new $(this.eol).print(v)}}class xt{constructor(v){qe(this,"eol",void 0),this.eol=v}printIceUfrag(v){return v===void 0?"":"a=ice-ufrag:".concat(v).concat(this.eol)}printIcePwd(v){return v===void 0?"":"a=ice-pwd:".concat(v).concat(this.eol)}printIceOptions(v){return v===void 0?"":"a=ice-options:".concat(v.join(d)).concat(this.eol)}printFingerprints(v){return v.length>0?v.map((D=>"a=fingerprint:".concat(D.hashFunction).concat(d).concat(D.fingerprint))).join(this.eol)+this.eol:""}printExtmap(v){return v.map((D=>"a=extmap:".concat(D.entry).concat(D.direction?"/".concat(D.direction):"").concat(d).concat(D.extensionName).concat(D.extensionAttributes?"".concat(d).concat(D.extensionAttributes):"").concat(this.eol))).join("")}printSetup(v){return v===void 0?"":"a=setup:".concat(v).concat(this.eol)}printUnrecognized(v){return v.map((D=>"a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol))).join("")}}class fe extends xt{print(v){let D="";return D+=this.printGroups(v.groups),D+=this.printMsidSemantic(v.msidSemantic),D+=this.printIceLite(v.iceLite),D+=this.printIceUfrag(v.iceUfrag),D+=this.printIcePwd(v.icePwd),D+=this.printIceOptions(v.iceOptions),D+=this.printFingerprints(v.fingerprints),D+=this.printSetup(v.setup),D+=this.printTlsId(v.tlsId),D+=this.printIdentity(v.identities),D+=this.printExtmap(v.extmaps),D+=this.printUnrecognized(v.unrecognized),D}printGroups(v){let D="";return v.length>0&&(D+=v.map((j=>"a=group:".concat(j.semantic).concat(j.identificationTag.map((ue=>"".concat(d).concat(ue))).join("")).concat(this.eol))).join("")),D}printIceLite(v){return v===void 0?"":"a=ice-lite"+this.eol}printTlsId(v){return v?"a=tls-id:".concat(v).concat(this.eol):""}printIdentity(v){return v.length===0?"":v.map((D=>"a=identity:".concat(D.assertionValue).concat(D.extensions.map((j=>"".concat(d).concat(j.name).concat(j.value?"=".concat(j.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(v){if(!v)return"";let D="a=msid-semantic:".concat(v.semantic);return v.applyForAll?D+="".concat(d,"*"):v.identifierList.length>0&&(D+=v.identifierList.map((j=>"".concat(d).concat(j)))),D+this.eol}}class $ extends xt{print(v){const D=v.attributes;let j="";return j+=this.printRTCP(D.rtcp),j+=this.printIceUfrag(D.iceUfrag),j+=this.printIcePwd(D.icePwd),j+=this.printIceOptions(D.iceOptions),j+=this.printCandidates(D.candidates),j+=this.printRemoteCandidatesList(D.remoteCandidatesList),j+=this.printEndOfCandidates(D.endOfCandidates),j+=this.printFingerprints(D.fingerprints),j+=this.printSetup(D.setup),j+=this.printMid(D.mid),j+=this.printExtmap(D.extmaps),j+=this.printRTPRelated(D),j+=this.printPtime(D.ptime),j+=this.printMaxPtime(D.maxPtime),j+=this.printDirection(D.direction),j+=this.printSSRCGroups(D.ssrcGroups),j+=this.printSSRC(D.ssrcs),j+=this.printRTCPMux(D.rtcpMux),j+=this.printRTCPMuxOnly(D.rtcpMuxOnly),j+=this.printRTCPRsize(D.rtcpRsize),j+=this.printMSId(D.msids),j+=this.printImageattr(D.imageattr),j+=this.printRid(D.rids),j+=this.printSimulcast(D.simulcast),j+=this.printSCTPPort(D.sctpPort),j+=this.printMaxMessageSize(D.maxMessageSize),j+=this.printUnrecognized(D.unrecognized),j}printCandidates(v){return v.map((D=>"a=candidate:".concat(D.foundation).concat(d).concat(D.componentId).concat(d).concat(D.transport).concat(d).concat(D.priority).concat(d).concat(D.connectionAddress).concat(d).concat(D.port).concat(d,"typ").concat(d).concat(D.type).concat(D.relAddr?"".concat(d,"raddr").concat(d).concat(D.relAddr):"").concat(D.relPort?"".concat(d,"rport").concat(d).concat(D.relPort):"").concat(Object.keys(D.extension).map((j=>"".concat(d).concat(j).concat(d).concat(D.extension[j]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(v){return v.map((D=>"a=remote-candidates:".concat(D.join(d)).concat(this.eol))).join("")}printEndOfCandidates(v){return v===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(v){if(!v.payloads)return"";const D=v.payloads;let j="";j+=v.rtcpFeedbackWildcards.map((ue=>this.printRTCPFeedback("*",ue))).join("");for(const ue of D)j+=this.printRtpMap(ue.payloadType,ue.rtpMap),j+=this.printFmtp(ue.payloadType,ue.fmtp),j+=ue.rtcpFeedbacks.map((rt=>this.printRTCPFeedback(ue.payloadType,rt))).join("");return j}printFmtp(v,D){if(!D)return"";const j=Object.keys(D.parameters);return j.length===1&&D.parameters[j[0]]===null?"a=fmtp:".concat(v).concat(d).concat(j[0]).concat(this.eol):"a=fmtp:".concat(v).concat(d).concat(Object.keys(D.parameters).map((ue=>"".concat(ue,"=").concat(D.parameters[ue]))).join(";")).concat(this.eol)}printRtpMap(v,D){return D?"a=rtpmap:".concat(v).concat(d).concat(D.encodingName,"/").concat(D.clockRate).concat(D.encodingParameters?"/".concat(D.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v,D){let j="a=rtcp-fb:".concat(v).concat(d),ue=D;return ue.type==="trr-int"?j+="ttr-int".concat(d).concat(ue.interval):(j+="".concat(ue.type),ue.parameter&&(j+="".concat(d).concat(ue.parameter),ue.additional&&(j+="".concat(d).concat(ue.additional)))),j+this.eol}printPtime(v){return v===void 0?"":"a=ptime:".concat(v).concat(this.eol)}printMaxPtime(v){return v===void 0?"":"a=maxptime:".concat(v).concat(this.eol)}printDirection(v){return v===void 0?"":"a=".concat(v).concat(this.eol)}printSSRC(v){return v.map((D=>Object.keys(D.attributes).map((j=>"a=ssrc:".concat(D.ssrcId.toString(10)).concat(d).concat(j).concat(D.attributes[j]?":".concat(D.attributes[j]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(v){return v===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v){return v===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v){return v===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v){if(v===void 0)return"";let D="a=rtcp:".concat(v.port);return v.netType&&(D+="".concat(d).concat(v.netType)),v.addressType&&(D+="".concat(d).concat(v.addressType)),v.address&&(D+="".concat(d).concat(v.address)),D+this.eol}printMSId(v){return v.map((D=>"a=msid:".concat(D.id).concat(D.appdata?"".concat(d).concat(D.appdata):"").concat(this.eol))).join("")}printImageattr(v){return v.map((D=>"a=imageattr:".concat(D).concat(this.eol))).join("")}printRid(v){return v.map((D=>{let j="a=rid:".concat(D.id).concat(d).concat(D.direction);return D.payloads&&(j+="".concat(d,"pt=").concat(D.payloads.join(","))),D.params.length>0&&(j+="".concat(d).concat(D.params.map((ue=>ue.type==="depend"?"depend=".concat(ue.rids.join(",")):"".concat(ue.type,"=").concat(ue.val))).join(";"))),j+this.eol})).join("")}printSimulcast(v){return v===void 0?"":"a=simulcast:".concat(v).concat(this.eol)}printSCTPPort(v){return v===void 0?"":"a=sctp-port:".concat(v).concat(this.eol)}printMaxMessageSize(v){return v===void 0?"":"a=max-message-size:".concat(v).concat(this.eol)}printMid(v){return v===void 0?"":"a=mid:".concat(v).concat(this.eol)}printSSRCGroups(v){return v.map((D=>"a=ssrc-group:".concat(D.semantic).concat(D.ssrcIds.map((j=>"".concat(d).concat(j.toString(10)))).join("")).concat(this.eol))).join("")}}function ne(A){return new Q().parse(A)}function ie(A,v){return new ot().print(A,v)}}},t={};function i(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r](a,a.exports,i),a.exports}return i.d=(r,a)=>{for(var s in a)i.o(a,s)&&!i.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:a[s]})},i.o=(r,a)=>Object.prototype.hasOwnProperty.call(r,a),i.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},i(8)})();function ya(e){return lo.parse(e)}function aE(e,t){return lo.print(e,t)}var B4=Bn("Array","keys"),j4=Ms,G4=Bi,W4=Be,v1=B4,y1=Array.prototype,H4={DOMTokenList:!0,NodeList:!0},Lo=function(e){var t=e.keys;return e===y1||W4(y1,e)&&t===y1.keys||G4(H4,j4(e))?v1:t},Pi=X(Lo);function Wr(e,t,i){return(t=(function(r){var a=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof a=="symbol"?a:a+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Mt(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Ut(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Mt(Object(i),!0).forEach((function(r){Wr(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Mt(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}const bB=new class extends or{constructor(){super(...arguments),Wr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class C1{constructor(t){Wr(this,"logger",void 0),Wr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.debug(...this.prefixLists,...i)}info(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.info(...this.prefixLists,...i)}warning(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.warning(...this.prefixLists,...i)}error(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.error(...this.prefixLists,...i)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function SO(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function Bc(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const ko={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},sE=Date.now(),I=e=>{for(const t in ko)if(Object.prototype.hasOwnProperty.call(ko,t)&&ko[t]===e)return t;return"DEFAULT"},w=new class{constructor(){Wr(this,"proxyServerURL",void 0),Wr(this,"logLevel",ko.DEBUG),Wr(this,"uploadState","collecting"),Wr(this,"uploadLogWaitingList",[]),Wr(this,"uploadLogUploadingList",[]),Wr(this,"uploadErrorCount",0),Wr(this,"currentLogID",0),Wr(this,"url",void 0),Wr(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=[ko.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=[ko.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=[ko.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=[ko.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=[ko.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){B("UPLOAD_LOG",!0)}disableLogUpload(){B("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new C1(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-sE<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-sE);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=SO()+" Agora-SDK [".concat(I(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const a=SO()+" %cAgora-SDK [".concat(I(r),"]:");let s=[];if(!G("USE_NEW_LOG"))switch(r){case ko.DEBUG:s=[a,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case ko.INFO:s=[a,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case ko.WARNING:s=[a,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case ko.ERROR:s=[a,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-sE<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-sE);const r=Math.max(0,Math.min(4,t[0]));t[0]=SO()+" Agora-SDK [".concat(I(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!G("UPLOAD_LOG"))return;for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];Array.isArray(i[0])?i[0][0]=Bc()+" Agora-SDK [".concat(I(e),"]:"):i[0]=Bc()+" Agora-SDK [".concat(I(e),"]:");let a="";i.forEach((s=>{typeof s=="object"&&(s=JSON.stringify(s)),a+="".concat(s," ")})),this.uploadLogWaitingList.push({payload_str:a,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:lc,process_id:G("PROCESS_ID"),payload:JSON.stringify(e)};return Vc((async()=>{const i=await co.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(G("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(G("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(i.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=i,r}}),(()=>(this.uploadLogUploadingList=[],!1)),(i=>{const r={status:-1,message:i.message,errorRange:e.map((a=>a.log_item_id))};return i.response?(r.status=i.response.status,r.data=i.response.data,r.headers=i.response.headers):i.request&&(r.status=i.request.status),bB.reportLogUploadError(r),!0}),{timeout:G("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:G("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,G("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),G("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),G("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),G("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var AB;function K4(e){return rn(e.reportId,"params.reportId",0,100,!1),rn(e.category,"params.category",0,100,!1),rn(e.event,"params.event",0,100,!1),rn(e.label,"params.label",0,100,!1),ji(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(AB={}).FREE="free",AB.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});const Hn={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let qt=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),vr=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let pt=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function Te(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,i,r){const a=r.value;if(typeof a=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var o,c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];let h=d;if(e.argsMap)try{h=e.argsMap(this,...d)}catch(f){w.warning(f),h=[]}try{JSON.stringify(h)}catch{w.warning("arguments for method ".concat(s,".").concat(String(i)," not serializable for apiInvoke.")),h=[]}const _=(e.report||J).reportApiInvoke(this._sessionId||null,{id:this._clientId||((o=this.store)===null||o===void 0?void 0:o.clientId)||this._ID,name:"".concat(s,".").concat(String(i)),options:h,tag:Tr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const f=a.apply(this,d);return f instanceof se?f.then((m=>(_.onSuccess(e.reportResult&&m),m))).catch((m=>{throw _.onError(m),m})):(_.onSuccess(e.reportResult&&f),f)}catch(f){throw _.onError(f),f}}}return r}}const J=new class{constructor(){Wr(this,"baseInfoMap",new Map),Wr(this,"proxyServer",void 0),Wr(this,"eventUploadTimer",void 0),Wr(this,"setSessionIdTimer",void 0),Wr(this,"url",void 0),Wr(this,"sids",new Set),Wr(this,"backupUrl",void 0),Wr(this,"_appId",void 0),Wr(this,"_aid",0),Wr(this,"keyEventUploadPendingItems",[]),Wr(this,"normalEventUploadPendingItems",[]),Wr(this,"apiInvokeUploadPendingItems",[]),Wr(this,"apiInvokeCount",0),Wr(this,"apiInvokeLoggedCount",0),Wr(this,"ltsList",[]),Wr(this,"lastSendNormalEventTime",Date.now()),Wr(this,"customReportCounterTimer",void 0),Wr(this,"customReportCount",0),Wr(this,"extApiInvoke",(async e=>{for(const t of e){const i=Ut(Ut({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Tr.TRACER});this.sendApiInvoke(i)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),G("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),G("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(t=>{let[i,r]=t;return i+r})),16)||0}reportApiInvoke(e,t,i){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,s=!!G("SHOW_REPORT_INVOKER_LOG"),o=!!G("SHOW_REPORT_USER_INVOKER_LOG"),c=s||o&&t.id;c&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function l(m,S){if(c){let T="[apiInvoke-".concat(d,"]");if(t.id&&(T+="[".concat(t.id,"]")),t.name&&(T+="[".concat(t.name,"]"),t.name===Gt.JOIN))return w.info("".concat(T," ").concat(m));w.info("".concat(T," ").concat(m),m==="start"?t.options:S||"")}}const h=()=>({tag:t.tag,invokeId:a,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});l("start");let _=!1;Ht(t.timeout).then((()=>{_||(this.sendApiInvoke(Ut(Ut({},h()),{},{error:L.API_INVOKE_TIMEOUT,success:!1})),l("timeout"))}));const f=new _e(L.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:m=>{const S=()=>{if(_)throw f;return _=!0,this.sendApiInvoke(Ut(Ut({},h()),{},{success:!0},t.reportResult&&{result:m})),l("onSuccess"),m};return i?f1(S,t.name+"Success",i,(()=>_=!0)):S()},onError:m=>{const S=()=>{if(_)throw m;_=!0,this.sendApiInvoke(Ut(Ut({},h()),{},{success:!1,error:m})),l("onFailure",m.toString())};return i?f1(S,t.name+"Error",i,(()=>_=!0)):S()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const i=Date.now(),r=this.createBaseInfo(e,i);r.cname=t.cname;const a=Object.assign({},{willUploadConsoleLog:G("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:a_?"global":"oversea",areas:G("AREAS")&&G("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:d,lsid:l,clientRole:h}=t,_=Date.now(),f=Ut(Ut({},r),{},{eventType:qt.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Eb,lts:_,elapse:_-i,extend:JSON.stringify(a),mode:t.mode,process:G("PROCESS_ID"),appType:G("APP_TYPE"),success:!0,version:lc,stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:d,lsid:l,clientType:ee(m=window.navigator.userAgent).call(m,"AgoraWebView")?42:20,clientRole:h,serviceId:G("PROCESS_ID"),extensionID:G("PLUGIN_INFO").join(",")||""});var m;this.send({type:vr.SESSION,data:f},!0)}joinChooseServer(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut({},r),{},{role:t.role,eventType:qt.JOIN_CHOOSE_SERVER,lts:a,eventElapse:t.elapse||a-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:a-i.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:vr.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut({},r),{},{eventType:qt.REQ_USER_ACCOUNT,lts:a,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||a-i.startTime,eventElapse:a-t.lts,extend:JSON.stringify(t.extend)});this.send({type:vr.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const a=Date.now(),{firstSuccess:s,addr:o,isProxy:c}=t,d=a-i.startTime,l=Ut(Ut({},r),{},{eventType:qt.JOIN_GATEWAY,lts:a,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:d,eventElapse:a-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:dc(),isABTestSuccess:t.isABTestSuccess?1:0}),h=l.success?1:0;if(t.succ&&(i.lastJoinSuccessTime=a),s)this.send({type:vr.JOIN_GATEWAY,data:l},!0);else{let _;if(o)if(c){const m=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),S=o.match(/p=[0-9]{1,6}/g);_={isSuccess:h,gatewayIp:m&&m.length?m[0].split("=")[1].replace(/-/g,"."):"",port:S&&S.length?S[0].split("=")[1]:"",isProxy:c?1:0}}else{const m=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),S=o.match(/(:|p=)[0-9]{1,6}/g);_={isSuccess:h,gatewayIp:m&&m.length?m[0].split("//")[1].replace(/-/g,"."):"",port:S&&S.length?S[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else _={isSuccess:h,gatewayIp:"",port:"",isProxy:c?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);const f=Object.assign({},l,_,{eventType:qt.REJOIN_GATEWAY});this.send({type:vr.RE_JOIN_GATEWAY,data:f},!0)}}joinChannelTimeout(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=Date.now(),a=Ut(Ut({},i.info),{},{lts:r,timeout:t,elapse:r-i.startTime});this.send({type:vr.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut({},r),{},{eventType:qt.PUBLISH,lts:a,eventElapse:t.eventElapse,elapse:a-i.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:vr.PUBLISH,data:s},!0)}subscribe(e,t,i){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,s=Date.now(),o=Ut(Ut({},a),{},{eventType:qt.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:vr.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const i=[...Pi(t=this.baseInfoMap).call(t)],r=i.length?i[0]:"UnableToGetSid",a=this.baseInfoMap.get(r);if(!a)return;const s=a.info,o=Date.now(),c=Ut(Ut({},s),{},{eventType:qt.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-a.startTime,status:e.status?1:2});this.send({type:vr.WS_COMPRESSOR_INIT,data:c},!0)}firstXLAPeerFirstVideoFrame(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=t.peerPubStatusMs-(i.lastJoinSuccessTime||a),o=Ut(Ut({},r),{},{elapse:a-i.startTime,eventType:qt.XLA_PEER_FIRST_VIDEO_FRAME,lts:a,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:vr.XLA_PEER_FIRST_VIDEO_FRAME,data:o},!0)}firstRemoteVideoDecode(e,t,i,r){const a=this.baseInfoMap.get(e);if(!a)return;const s=a.info,o=Date.now(),c=Ut(Ut(Ut({},s),r),{},{elapse:o-a.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-a.startTime,0),apEnd:Math.max(r.apEnd-a.startTime,0),apStart:Math.max(r.apStart-a.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-a.startTime,0),joinGwStart:Math.max(r.joinGwStart-a.startTime,0),pcEnd:Math.max(r.pcEnd-a.startTime,0),pcStart:Math.max(r.pcStart-a.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-a.startTime,0),subscriberStart:Math.max(r.subscriberStart-a.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-a.startTime,0)});this.send({type:i,data:c},!0)}firstRemoteFrame(e,t,i,r){const a=this.baseInfoMap.get(e);if(!a)return;const s=a.info,o=Date.now(),c=Ut(Ut(Ut({},s),r),{},{elapse:o-a.startTime,eventType:t,lts:o});this.send({type:i,data:c},!0)}abTest(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut(Ut({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:a-i.startTime,eventType:qt.AB_TEST,lts:a});this.send({type:vr.AB_TEST,data:s},!0)}pcStats(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut(Ut({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:a-i.startTime,eventType:qt.PC_STATS,lts:a,preallocation:t.preallocation?1:0});this.send({type:vr.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut(Ut({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:qt.UPDATE_REMOTE_RTPCAPABILITIES,lts:a});this.send({type:vr.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,i,r){const a=this.baseInfoMap.get(e);if(!a)return;const s=a.info,o=Date.now(),c=Ut(Ut(Ut({},s),r),{},{eventType:t,lts:o});this.send({type:i,data:c},!0)}streamSwitch(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut({},r),{},{eventType:qt.STREAM_SWITCH,lts:a,isDual:t.isdual,elapse:a-i.startTime,success:t.succ});this.send({type:vr.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut({},r),{},{eventType:qt.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-t.lts,elapse:a-i.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:vr.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut({},r),{},{eventType:qt.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-t.lts,elapse:a-i.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:vr.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?w.debug("reportProxyServerurl: ".concat(e)):w.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:a,elapse:a-i.startTime,joinChannelSuccessElapse:a-(i.lastJoinSuccessTime||a),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:vr.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now();(function(s,o,c){const d=s[o];if(!d||typeof d!="string")return[s];s[o]="";const l=Fu(JSON.stringify(s));let h=0;const _=[];let f=0;for(let m=0;m<d.length;m++)f+=d.charCodeAt(m)<=127?1:3,f<=c-l||(_[_.length]=M(M({},s),{},{[o]:d.substring(h,m)}),h=m,f=d.charCodeAt(m)<=127?1:3);return h!==d.length-1&&(_[_.length]=M(M({},s),{},{[o]:d.substring(h)})),_})(Ut(Ut(Ut({},r),t),{},{elapse:a-i.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach((s=>this.send({type:vr.WORKER_EVENT,data:s},!0)))}apworkerEvent(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut(Ut({},r),t),{},{elapse:a-i.startTime,lts:a});this.send({type:vr.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut(Ut({},r),t),{},{elapse:a-i.startTime,lts:a,extend:t.extend||void 0});this.send({type:vr.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),s=Ut(Ut(Ut({},r),t),{},{elapse:a-i.startTime,lts:a});this.send({type:vr.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>G("CUSTOM_REPORT_LIMIT"))throw new _e(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const i=Date.now(),r=t.map((a=>({type:vr.USER_ANALYTICS,data:Ut(Ut({sid:e},a),{},{lts:i})})));try{G("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(a){throw w.error("send custom report message failed",a.toString()),new _e(L.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(e){const t=G("NOT_REPORT_EVENT");if(e.tag&&ee(t)&&ee(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:a,cid:s}=i.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof _e){const{code:d,message:l}=e.error;o=d||l||e.error.toString()}else o=e.error.toString();const c={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:a,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:vr.API_INVOKE,data:c},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find((i=>i!==null));t&&e.forEach((i=>{i&&(i.sid=t,this.sendApiInvoke(Object.assign({},i)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const i=[],r=[];for(;e.length;){const s=e.shift();i.length<20?i.push(s):r.push(s)}e.push(...r);for(const s of[...i]){var a;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),vt(a=this.ltsList).call(a,((o,c)=>o-c)))}return t||(this.lastSendNormalEventTime=Date.now()),G("ENABLE_EVENT_REPORT")&&i.length&&(G("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((s=>o=>{G("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-G("NORMAL_EVENT_QUEUE_CAPACITY")),w.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){Zr.networkState===cs.OFFLINE&&await se.race([Zr.onlineWaiter,Ht(2*ln.maxRetryTimeout)]);const t=a=>{let s=new Uint8Array;return a.forEach((o=>{const c=dO(JSON.stringify(o.data)),d=new ArrayBuffer(5),l=(_=>{let f=0;return Object.entries(vr).forEach((m=>{let[S,T]=m;T===_.type&&(f=pt[S])})),f})(o),h=new DataView(d);h.setUint16(0,c.byteLength,!0),h.setUint8(2,255&l),h.setUint8(3,l>>>8&255),h.setUint8(4,l>>>16&255),s=lO(s,new Uint8Array(d)),s=lO(s,c)})),s},i="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let a=0;a<2;a+=1){a===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await E1(r,{timeout:1e4,data:t(e),headers:Ut(Ut({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(a===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(c=>{const d=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return d&&d.info.vid&&+d.info.vid||0})(e[0]),r=i?void 0:this._aid,a={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((c=>JSON.stringify(c))),vid:i,aid:r};Zr.networkState===cs.OFFLINE&&await se.race([Zr.onlineWaiter,Ht(2*ln.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(G("EVENT_REPORT_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(s));for(let c=0;c<2;c+=1){c===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(G("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(s)));try{t?await TB(o,{timeout:1e4,data:a}):await E1(o,{timeout:1e4,data:a})}catch(d){if(c===1)throw d;continue}return}}createBaseInfo(e,t){const i=Object.assign({},Hn);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:t}),i}reportResourceTiming(e,t){const i=performance.getEntriesByName(e),r=i[i.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Tr.TRACER}).onSuccess()}};bB.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=Zr.networkState,J.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Tr.TRACER}).onSuccess("logUploadError")}));class oe extends _e{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Wr(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,w)}throw(){super.throw(w)}}const Nt={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Si(){return Nt}function mb(){return"setSinkId"in HTMLAudioElement.prototype&&(!G("RESTRICTION_SET_PLAYBACK_DEVICE")||(dn()||jr())&&!xu())}function iR(){return!Nt.supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&fl()}function TO(e){return!(Ci()||tO(87)||iR()||!G("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}function sa(e){return!!G("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB"))}let On=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function ai(e,t,i){return{sampleRate:e,stereo:t,bitrate:i}}function Kt(e,t,i,r,a){return{width:e,height:t,frameRate:i,bitrateMin:r,bitrateMax:a}}function jc(e,t,i,r,a){return{width:{max:e},height:{max:t},frameRate:i,bitrateMin:r,bitrateMax:a}}function b1(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Y4={"90p":Kt(160,90),"90p_1":Kt(160,90),"120p":Kt(160,120,15,30,65),"120p_1":Kt(160,120,15,30,65),"120p_3":Kt(120,120,15,30,50),"120p_4":Kt(212,120),"180p":Kt(320,180,15,30,140),"180p_1":Kt(320,180,15,30,140),"180p_3":Kt(180,180,15,30,100),"180p_4":Kt(240,180,15,30,120),"240p":Kt(320,240,15,40,200),"240p_1":Kt(320,240,15,40,200),"240p_3":Kt(240,240,15,40,140),"240p_4":Kt(424,240,15,40,220),"360p":Kt(640,360,15,80,400),"360p_1":Kt(640,360,15,80,400),"360p_3":Kt(360,360,15,80,260),"360p_4":Kt(640,360,30,80,600),"360p_6":Kt(360,360,30,80,400),"360p_7":Kt(480,360,15,80,320),"360p_8":Kt(480,360,30,80,490),"360p_9":Kt(640,360,15,80,800),"360p_10":Kt(640,360,24,80,800),"360p_11":Kt(640,360,24,80,1e3),"480p":Kt(640,480,15,100,500),"480p_1":Kt(640,480,15,100,500),"480p_2":Kt(640,480,30,100,1e3),"480p_3":Kt(480,480,15,100,400),"480p_4":Kt(640,480,30,100,750),"480p_6":Kt(480,480,30,100,600),"480p_8":Kt(848,480,15,100,610),"480p_9":Kt(848,480,30,100,930),"480p_10":Kt(640,480,10,100,400),"720p":Kt(1280,720,15,120,1130),"720p_auto":Kt(1280,720,30,900,3e3),"720p_1":Kt(1280,720,15,120,1130),"720p_2":Kt(1280,720,30,120,2e3),"720p_3":Kt(1280,720,30,120,1710),"720p_5":Kt(960,720,15,120,910),"720p_6":Kt(960,720,30,120,1380),"1080p":Kt(1920,1080,15,120,2080),"1080p_1":Kt(1920,1080,15,120,2080),"1080p_2":Kt(1920,1080,30,120,3e3),"1080p_3":Kt(1920,1080,30,120,3150),"1080p_5":Kt(1920,1080,60,120,4780),"1440p":Kt(2560,1440,30,120,4850),"1440p_1":Kt(2560,1440,30,120,4850),"1440p_2":Kt(2560,1440,60,120,7350),"4k":Kt(3840,2160,30,120,8910),"4k_1":Kt(3840,2160,30,120,8910),"4k_3":Kt(3840,2160,60,120,13500)},z4={"480p":jc(640,480,5),"480p_1":jc(640,480,5),"480p_2":jc(640,480,30),"480p_3":jc(640,480,15),"720p":jc(1280,720,5),"720p_auto":Kt(1280,720,30,900,3e3),"720p_1":jc(1280,720,5),"720p_2":jc(1280,720,30),"720p_3":jc(1280,720,15),"1080p":jc(1920,1080,5),"1080p_1":jc(1920,1080,5),"1080p_2":jc(1920,1080,30),"1080p_3":jc(1920,1080,15)},gl={"1SL1TL":b1(1,1),"3SL3TL":b1(3,3),"2SL3TL":b1(2,3)};function Gc(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Y4[e]):e}function rR(e){return typeof e=="string"?Object.assign({},z4[e]):e}function RO(e){return typeof e=="string"?Object.assign({},gl[e]):e}const vO={speech_low_quality:ai(16e3,!1),speech_standard:ai(32e3,!1,18),music_standard:ai(48e3,!1),standard_stereo:ai(48e3,!0,56),high_quality:ai(48e3,!1,128),high_quality_stereo:ai(48e3,!0,192)};function s_(e){return typeof e=="string"?Object.assign({},vO[e]):e}const bg=[];function Je(e){return Bt(e,"mediaSource",["screen","window","application"]),!0}let Oe=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),Ui=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),nR=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),q4=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),Ag=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),Sl=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),js=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),Gs=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),ys=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),Mo=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const gb={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},yO={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},IB={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},wB={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Cs={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let nn=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),Ws=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),Bu=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),Mn=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),un=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),Tl=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({});const aR={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let si=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function te(e,t,i,r,a){var s,o,c={};return Object.keys(r).forEach((function(d){c[d]=r[d]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Pn(s=XE(o=i.slice()).call(o)).call(s,(function(d,l){return l(e,t,d)||d}),c),a&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(a):void 0,c.initializer=void 0),c.initializer===void 0?(Object.defineProperty(e,t,c),null):c}function ce(e,t,i){return(t=(function(r){var a=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof a=="symbol"?a:a+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Qi(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function $i(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Qi(Object(i),!0).forEach((function(r){ce(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Qi(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}class Ig extends or{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Sl.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,i){super(),ce(this,"trackMediaType",void 0),ce(this,"_ID",void 0),ce(this,"_rtpTransceiver",void 0),ce(this,"_lowRtpTransceiver",void 0),ce(this,"_hints",[]),ce(this,"_isClosed",!1),ce(this,"_originMediaStreamTrack",void 0),ce(this,"mediaStreamTrack",void 0),ce(this,"_external",{}),this._ID=i||Mi(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(r){ee(bg).call(bg,r)||bg.push(r)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Uc((()=>{var i;J.reportApiInvoke(null,{name:Gt.GET_MEDIA_STREAM_TRACK,options:[],tag:Tr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===nR.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){const i=bg.indexOf(t);i!==-1&&bg.splice(i,1)})(this),this.emit(js.CLOSED),this.removeAllListeners(Sl.SEI_RECEIVED)}_updateRtpTransceiver(t,i){if(i===nR.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Sl.TRANSCEIVER_UPDATED,t,i)}}class wg extends Ig{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,i){super(t,i),ce(this,"_enabled",!0),ce(this,"_muted",!1),ce(this,"_isExternalTrack",!1),ce(this,"_isClosed",!1),ce(this,"_enabledMutex",void 0),ce(this,"processor",void 0),ce(this,"_processorContext",void 0),ce(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Wn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,i;return(t=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,w.debug("[".concat(this.getTrackId(),"] close")),this.emit(Oe.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,i){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fi(this,Oe.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(js.TRACK_ENDED)}stateCheck(t,i){if(w.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(i,"]")),gr(i,t),this._enabled&&this._muted&&t==="enabled"&&i===!1)throw new _e(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",w);if(!this._enabled&&!this._muted&&t==="muted"&&i===!0)throw new _e(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",w)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():se.resolve([])}}const uc=window.AudioContext||window.webkitAudioContext;let li=null;const Li=new class extends or{constructor(){super(...arguments),ce(this,"prevState",void 0),ce(this,"curState",void 0),ce(this,"currentTime",void 0),ce(this,"currentTimeStuckAt",void 0),ce(this,"interruptDetectorTrack",void 0),ce(this,"onLocalAudioTrackMute",(()=>{w.info("ios15-interruption-start"),this.emit(On.IOS_15_16_INTERRUPTION_START)})),ce(this,"onLocalAudioTrackUnmute",(async()=>{w.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?w.info("ios15-interruption-end-canceled"):(li&&await li.suspend(),this.emit(On.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){w.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){w.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Rl(){if(!li){if((function(){if(!uc)return void w.error("your browser is not support web audio");w.info("create audio context");const e=$i({},G("WEBAUDIO_INIT_OPTIONS"));w.debug("audio context init option:",JSON.stringify(e)),li=new uc(e),Li.curState=li.state,li.onstatechange=()=>{Li.prevState=Li.curState,Li.curState=li?li.state:void 0;const{prevState:t,curState:i}=Li,r=i==="running",a=i==="interrupted",s=t==="running",o=t==="suspended",c=t==="interrupted",d=_i().osVersion;(Jn()||wd())&&s&&a&&(w.info("ios".concat(d,"-interruption-start")),Li.emit(On.IOS_INTERRUPTION_START)),(Jn()||wd())&&(o||c)&&r&&(w.info("ios".concat(d,"-interruption-end")),Li.emit(On.IOS_INTERRUPTION_END)),t!==i&&Li.emit(On.STATE_CHANGE,i,t)},setInterval((()=>{var t;const i=(t=li)===null||t===void 0?void 0:t.currentTime;Li.currentTime!==i?(Li.currentTimeStuckAt&&(w.debug("AudioContext current time resume at ".concat(i)),Li.currentTimeStuckAt=void 0),Li.currentTime=i):(i!==Li.currentTimeStuckAt&&(J.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Tr.TRACER}).onSuccess(),w.warning("AudioContext current time stuck at ".concat(i))),Li.currentTimeStuckAt=i)}),5e3),(async function(t){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,a=!1,s=!1,o=!1;function c(T){t.state==="running"?d(!1):Jn()||wd()?t.state==="suspended"&&(d(!0),T&&t.resume().then(l,l)):t.state!=="closed"&&(d(!0),T&&t.resume().then(l,l))}function d(T){if(a!==T){a=T;for(let R=0,C=i;R<C.length;R+=1){const b=C[R];T?window.addEventListener(b,h,{capture:!0,passive:!0}):window.removeEventListener(b,h,{capture:!0,passive:!0})}}}function l(){c(!1)}function h(){c(!0)}function _(T){if(!o)if(r.paused)if(T){let R;f(!1),o=!0;try{R=r.play(),R?R.then(m,m):(r.addEventListener("playing",m),r.addEventListener("abort",m),r.addEventListener("error",m))}catch{m()}}else f(!0);else f(!1)}function f(T){if(s!==T){s=T;for(let R=0,C=i;R<C.length;R++){const b=C[R];T?window.addEventListener(b,S,{capture:!0,passive:!0}):window.removeEventListener(b,S,{capture:!0,passive:!0})}}}function m(){r.removeEventListener("playing",m),r.removeEventListener("abort",m),r.removeEventListener("error",m),o=!1,_(!1)}function S(){_(!0)}if(Jn()){const T=t.createMediaStreamDestination(),R=document.createElement("div");R.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=R.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=T.stream,_(!0)}Li.on(On.STATE_CHANGE,(function(){c(!0)})),c(!1)})(li)})(),!li)throw new _e(L.NOT_SUPPORTED,"can not create audio context");return li}return li}function o_(e){if((function(){if(Sb!==null)return Sb;const r=Rl(),a=r.createBufferSource(),s=r.createGain(),o=r.createGain();a.connect(s),a.connect(o),a.disconnect(s);let c=!1;try{a.disconnect(s)}catch{c=!0}return a.disconnect(),Sb=c,c})())return;const t=e.connect,i=e.disconnect;e.connect=(r,a,s)=>{var o;return e._inputNodes||(e._inputNodes=[]),ee(o=e._inputNodes).call(o,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,a,s)):t.call(e,r,a)),e},e.disconnect=(r,a,s)=>{i.call(e),r?t_(e._inputNodes,r):e._inputNodes=[];for(const o of e._inputNodes)t.call(e,o)}}let Sb=null;function CO(e,t){let i=!1;const r=1/t;if(G("DISABLE_WEBAUDIO")){const a=window.setInterval((()=>{i?window.clearInterval(a):e(performance.now()/1e3)}),1e3*r)}else{const a=Rl();let s=a.createGain();s.gain.value=0,s.connect(a.destination);const o=()=>{if(i)return void(s=null);const c=a.createOscillator();c.onended=o,c.connect(s),c.start(0),c.stop(a.currentTime+r),e(a.currentTime)};o()}return()=>{i=!0}}class A1{constructor(){ce(this,"context",void 0),ce(this,"analyserNode",void 0),ce(this,"sourceNode",void 0),this.context=Rl(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Jn()||wd()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let a=0;a<t.length;++a)t[a]=r[a]/128-1}const i=Pn(t).call(t,((r,a)=>r+a*a),0)/t.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,i;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{w.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class I1 extends or{get processSourceNode(){return this.sourceNode}set processedNode(t){var i;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ce(this,"outputNode",void 0),ce(this,"outputTrack",void 0),ce(this,"isPlayed",!1),ce(this,"sourceNode",void 0),ce(this,"context",void 0),ce(this,"audioBufferNode",void 0),ce(this,"destNode",void 0),ce(this,"audioOutputLevel",0),ce(this,"volumeLevelAnalyser",void 0),ce(this,"_processedNode",void 0),ce(this,"playNode",void 0),ce(this,"isDestroyed",!1),ce(this,"onNoAudioInput",void 0),ce(this,"isNoAudioInput",!1),ce(this,"_noAudioInputCount",0),this.context=Rl(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),o_(this.outputNode),this.volumeLevelAnalyser=new A1}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Mo.ON_AUDIO_BUFFER,(function(r){for(let a=0;a<r.outputBuffer.numberOfChannels;a+=1){const s=r.outputBuffer.getChannelData(a);for(let o=0;o<s.length;o+=1)s[o]=0}return r.inputBuffer})(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Si().webAudioMediaStreamDest)throw new _e(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&cr((()=>{Li.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Jn()||wd()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let r;i.getFloatTimeDomainData?(r=new Float32Array(i.fftSize),i.getFloatTimeDomainData(r)):(r=new Uint8Array(i.fftSize),i.getByteTimeDomainData(r));let a=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(a=!0);return a?(this.isNoAudioInput=!1,!0):(await Ht(200),await this.checkHasAudioInput(t?t+1:1)&&a)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,i;(t=this.processedNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class w1 extends I1{get isFreeze(){return!1}constructor(t,i,r){var a;if(super(),ce(this,"sourceNode",void 0),ce(this,"track",void 0),ce(this,"clonedTrack",void 0),ce(this,"audioElement",void 0),ce(this,"isCurrentTrackCloned",!1),ce(this,"isRemoteTrack",!1),ce(this,"originVolumeLevelAnalyser",void 0),ce(this,"rebuildWebAudio",(async()=>{if(w.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void w.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>w.info("resume success"))),w.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),o_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const l=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(l,this.context.currentTime),o_(this.outputNode),this.emit(Mo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),t.kind!=="audio")throw new _e(L.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(s),o_(this.sourceNode),r){const c=r.clone();c.enabled=!0,this.clonedTrack=c,w.debug("create an unmuted track ".concat(c.id," from the original track ").concat(r.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([c]));o_(d),this.originVolumeLevelAnalyser=new A1,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=_i();i&&o.os===Ot.IOS&&Number((a=o.osVersion)===null||a===void 0?void 0:a.split(".")[0])<15&&(Li.on(On.STATE_CHANGE,(()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const i=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(i),o_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Mo.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Li.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const i=t.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),w.debug("create an unmuted track ".concat(i.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([i]));o_(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function OB(e,t,i){const r=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,a={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(a.video.mandatory.maxFrameRate=t.frameRate.max,a.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(a.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(a)}async function NB(e,t){const i=await bO(e.mediaSource),{sourceId:r,audio:a}=await(function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new se(((c,d)=>{const l=document.createElement("div");l.innerText="share screen",l.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const h=document.createElement("div");h.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const m=document.createElement("div");m.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const S=document.createElement("button");S.innerHTML="cancel",S.setAttribute("style","width: 85px;"),S.onclick=()=>{document.body.removeChild(C);const b=new Error("NotAllowedError");b.name="NotAllowedError",d(b)};let T=o;const R=document.createElement("div");if(o){const b=document.createElement("input");b.setAttribute("type","checkbox");const N=document.createElement("span");b.setAttribute("style","margin-right: 6px;"),N.innerText="Share audio",b.checked=T,b.onchange=()=>{T=b.checked},R.appendChild(b),R.appendChild(N)}m.appendChild(R),m.appendChild(S),h.appendChild(_),h.appendChild(f),h.appendChild(m);const C=document.createElement("div");C.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),C.appendChild(l),C.appendChild(h),document.body.appendChild(C),s.map((b=>{if(b.id){const N=document.createElement("div");N.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let k=b.thumbnail;try{const{width:P}=k.getSize();P>1920&&(k=k.resize({width:1920}))}catch(P){throw P&&P.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),P}N.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+k.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+b.name.replace(/[\u00A0-\u9999<>\&]/g,(function(P){return"&#"+P.charCodeAt(0)+";"}))+"</span>",N.onclick=()=>{document.body.removeChild(C),c({sourceId:b.id,audio:T})},f.appendChild(N)}}))}))})(i,t);return await OB(r,e,a)}async function bO(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const i=Jr();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new _e(L.ELECTRON_IS_NULL);let r=null;try{var a;r=((a=i.desktopCapturer)===null||a===void 0?void 0:a.getSources({types:t}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new se(((s,o)=>{i.desktopCapturer.getSources({types:t},((c,d)=>{c?o(c):s(d)}))})));try{return await r}catch(s){throw new _e(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const AO=new Wn("safari");let O1=!1,hc=!1;async function Wc(e,t){let i=0,r=null;for(;i<2;)try{r=await IO(e,t,i>0);break}catch(a){if(a instanceof _e)throw w.error("[".concat(t,"] ").concat(a.toString())),a;const s=c_(a.name||a.code||a,a.message);if(s.code===L.MEDIA_OPTION_INVALID){w.debug("[".concat(t,"] detect media option invalid, retry")),i+=1,await Ht(500);continue}throw w.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new _e(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function IO(e,t,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new _e(L.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Si(),a=new MediaStream;if(e.audioSource&&a.addTrack(e.audioSource),e.videoSource&&a.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return w.debug("Using Video Source/ Audio Source"),a;if(e.screen)if(Jr())e.screen.sourceId?bs(a,await OB(e.screen.sourceId,e.screen,!!e.screenAudio)):bs(a,await NB(e.screen,!!e.screenAudio));else if(dn()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new _e(L.NOT_SUPPORTED,"This browser does not support screen sharing");w.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const f=await(o=e.screen.extensionId,c=t,new se(((m,S)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},(T=>{if(!T||!T.streamId)return w.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),T),void S(new _e(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));m(T.streamId)}))}catch(T){w.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),T.toString()),S(new _e(L.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=f,bs(a,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&Je(e.screen.mediaSource);const f={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:m,surfaceSwitching:S,systemAudio:T,preferCurrentTab:R}=e.screen,C={selfBrowserSurface:m,surfaceSwitching:S,systemAudio:T,preferCurrentTab:R};!m&&delete C.selfBrowserSurface,!S&&delete C.surfaceSwitching,!T&&delete C.systemAudio,!R&&delete C.preferCurrentTab,w.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:f,audio:e.screenAudio,controls:C})),bs(a,await navigator.mediaDevices.getDisplayMedia($i({video:f,audio:e.screenAudio},C)))}else{if(!Ci())throw w.error("[".concat(t,"] This browser does not support screenSharing")),new _e(L.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&Je(e.screen.mediaSource);const f={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};w.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(f))),bs(a,await navigator.mediaDevices.getUserMedia(f))}}var o,c;if(!e.video&&!e.audio)return a;let d={video:e.video,audio:e.audio},l=G("MEDIA_DEVICE_CONSTRAINTS");if(l)try{typeof l=="string"&&(l=JSON.parse(l)),d=pO(d,l)}catch{}w.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(d)),_i();let h,_=null;(Ra()||Jn()||_l())&&(_=await AO.lock());try{h=await navigator.mediaDevices.getUserMedia(d)}catch(f){throw _&&_(),f}return d.audio&&(O1=!0),d.video&&(hc=!0),bs(a,h),_&&_(),a}function c_(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new _e(L.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new _e(L.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new _e(L.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new _e(L.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new _e(L.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new _e(L.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return w.error("getUserMedia unexpected error",e),new _e(L.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function bs(e,t){const i=e.getVideoTracks()[0],r=e.getAudioTracks()[0],a=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),a&&(i&&e.removeTrack(i),e.addTrack(a))}const Uo=new class extends or{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Mn.STATE_CHANGE,e),this._state=e)}constructor(){super(),ce(this,"_state",Bu.IDLE),ce(this,"isAccessMicrophonePermission",!1),ce(this,"isAccessCameraPermission",!1),ce(this,"lastAccessMicrophonePermission",!1),ce(this,"lastAccessCameraPermission",!1),ce(this,"checkdeviceMatched",!1),ce(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(G("ENUMERATE_DEVICES_INTERVAL")||(tE()||ab()===Ot.HARMONY_OS)&&fl())&&this.updateDevicesInfo()}),G("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>w.error(e.toString())))}async enumerateDevices(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new _e(L.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),a=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;a.audio&&(s=!1),a.video&&(o=!1);let c=null,d=null,l=null;if(!i&&(s||o)){if(AO.isLocked&&(w.debug("[device manager] wait GUM lock"),(await AO.lock())(),w.debug("[device manager] GUM unlock")),O1&&(s=!1,this.isAccessMicrophonePermission=!0),hc&&(o=!1,this.isAccessCameraPermission=!0),w.debug("[device manager] check media device permissions",e,t,s,o),s&&o){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(h){const _=c_(h.name||h.code||h,h.message);if(_.code===L.PERMISSION_DENIED)throw _;w.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({audio:e})}catch(h){const _=c_(h.name||h.code||h,h.message);if(_.code===L.PERMISSION_DENIED)throw _;w.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(o){try{d=await navigator.mediaDevices.getUserMedia({video:t})}catch(h){const _=c_(h.name||h.code||h,h.message);if(_.code===L.PERMISSION_DENIED)throw _;w.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}w.debug("[device manager] mic permission",e,"cam permission",t)}try{const h=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach((_=>_.stop())),d&&d.getTracks().forEach((_=>_.stop())),l&&l.getTracks().forEach((_=>_.stop())),c=null,d=null,l=null,h}catch(h){return c&&c.getTracks().forEach((_=>_.stop())),d&&d.getTracks().forEach((_=>_.stop())),l&&l.getTracks().forEach((_=>_.stop())),c=null,d=null,l=null,new _e(L.ENUMERATE_DEVICES_FAILED,h.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audioinput"))}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((t=>t.kind==="videoinput"))}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audiooutput"))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((i=>{i.device.label===e&&(t=i.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((i=>i.deviceId===e));if(!t)throw new _e(L.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Bu.INITING;try{await this.updateDevicesInfo(),this.state=Bu.INITEND}catch(e){throw w.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Bu.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new _e(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const a=e.find((o=>o.kind==="audioinput"&&o.deviceId==="default")),s=e.find((o=>o.kind==="audiooutput"&&o.deviceId==="default"));a&&s?s.groupId===a.groupId?w.debug("[device-check] default input ".concat(a.label," and output ").concat(s.label," is the same group")):w.debug("[device-check] default input ".concat(a.label," and output ").concat(s.label," is not the same group")):w.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((a=>{if(!a.deviceId)return;const s=this.deviceInfoMap.get("".concat(a.kind,"_").concat(a.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:t,updateAt:t,device:a,state:"ACTIVE"};this.deviceInfoMap.set("".concat(a.kind,"_").concat(a.deviceId),o),i.push(o)}s&&(s.updateAt=t)})),this.deviceInfoMap.forEach(((a,s)=>{a.state==="ACTIVE"&&a.updateAt!==t&&(a.state="INACTIVE",i.push(a))})),this.state!==Bu.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach((a=>{switch(a.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Mn.RECORDING_DEVICE_CHANGED,a);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Mn.CAMERA_DEVICE_CHANGED,a);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Mn.PLAYOUT_DEVICE_CHANGED,a)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((a=>a.kind==="audioinput")),i=e.filter((a=>a.kind==="videoinput")),r={audio:!1,video:!1};for(const a of t)if(a.label&&a.deviceId){r.audio=!0;break}for(const a of i)if(a.label&&a.deviceId){r.video=!0;break}return r}};let xo=!1;const pc=new class extends or{constructor(){super(...arguments),ce(this,"onAutoplayFailed",void 0),ce(this,"onAudioAutoplayFailed",void 0)}};function N1(){if(_i(),!xo){const e=t=>{t.preventDefault(),xo=!1,Rt()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};xo=!0,Rt()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),w.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),pc.onAutoplayFailed?pc.onAutoplayFailed():pc.onAudioAutoplayFailed?w.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):w.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),pc.emit("autoplay-failed")}}function DB(e,t,i,r){if(!e)return;const a=J.getBaseInfoBySessionId(e);if(!a)return;const s=a.info,o=Date.now(),c=$i($i({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-a.startTime,cbRegistered:pc.onAutoplayFailed||pc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:t,trackId:r,extend:void 0});J.send({type:vr.AUTOPLAY_FAILED,data:c},!0)}const uo=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ki=new class{constructor(){ce(this,"onAutoplayFailed",void 0),ce(this,"elementMap",new Map),ce(this,"elementStateMap",new Map),ce(this,"elementsNeedToResume",[]),ce(this,"sinkIdMap",new Map),ce(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[i,r]=t;const a=this.elementStateMap.get(i),s=r.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(w.debug("resume after interrupted, ele: ".concat(a," audio: ").concat(o," ").concat(e)),o==="live"){if(e)return r.pause(),void r.play();if(Li.curState==="running")return eE()?(r.pause(),void r.play()):void(a&&a==="paused"&&r.play())}}))})),ce(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,i]=e;const r=i.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(w.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())}))})),this.autoResumeAudioElement(),Li.on(On.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Li.on(On.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Li.on(On.STATE_CHANGE,(()=>{Jn()&&Li.prevState==="suspended"&&Li.curState==="running"&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),i)try{await i.setSinkId(t)}catch(r){throw new _e(L.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,i,r){if(this.elementMap.has(t))return;const a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,a),this.elementMap.set(t,a),this.elementStateMap.set(t,un.INIT),this.setVolume(t,i);const s=this.sinkIdMap.get(t);if(s)try{a.setSinkId(s).catch((c=>{w.warning("[".concat(t,"] set sink id failed"),c.toString())}))}catch(c){w.warning("[".concat(t,"] set sink id failed"),c.toString())}const o=a.play();o&&o.then&&o.catch((c=>{r&&DB(r,"audio",c.message,t),w.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(w.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(a),cr((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),N1()})))}))}updateTrack(e,t){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const i=this.elementMap.get(e);i&&(t=Math.max(0,Math.min(100,t)),i.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const i=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(i,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){uo.forEach((i=>{t.addEventListener(i,(r=>{const a=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(w.debug("[".concat(e,"] audio-element-status change ").concat(a," => ").concat(s)),r.type==="error"){const o=t?.error;o&&w.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(e,s)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((t=>{t.play().then((i=>{w.debug("Auto resume audio element success")})).catch((i=>{w.warning("Auto resume audio element failed!",i)}))})),this.elementsNeedToResume=[]};new se((t=>{document.body?t():window.addEventListener("load",(()=>t()))})).then((()=>{Rt()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function zr(){return function(e,t,i){const r=i.value;return typeof r=="function"&&(i.value=function(){this._isClosed&&new _e(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",w);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];const c=r.apply(this,s);return c instanceof se?new se(((d,l)=>{c.then(d).catch(l)})):c}),i}}class D1 extends or{constructor(t){super(),ce(this,"name","VideoProcessorDestination"),ce(this,"ID","0"),ce(this,"_source",void 0),ce(this,"videoContext",void 0),ce(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new _e(L.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new _e(L.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(nn.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(nn.ON_TRACK,void 0)}}class P1 extends or{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i){super(),ce(this,"constraintsMap",new Map),ce(this,"statsRegistry",[]),ce(this,"usageRegistry",[]),ce(this,"trackId",void 0),ce(this,"direction",void 0),ce(this,"_chained",!1),this.trackId=t,this.direction=i}async getConstraints(){return await zt(this,Ws.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,i){var r;return w.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),fi(this,Ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(tn(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return w.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),fi(this,Ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(tn(i=this.constraintsMap).call(i)))}registerStats(t,i,r){this.statsRegistry.find((a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===i))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:r})}unregisterStats(t,i){const r=this.statsRegistry.findIndex((a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===i));r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:i,processorName:r,type:a,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:i,processorName:r,type:a,stats:o})}catch(o){w.error(new _e(L.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,i){this.usageRegistry.find((r=>r.processorID===t.ID&&r.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){const i=this.usageRegistry.findIndex((r=>r.processorID===t.ID&&r.processorName===t.name));i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let r=i();r instanceof se&&(r=await r),t.push($i($i({},r),{},{direction:this.direction}))}catch(r){w.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class L1 extends or{constructor(t){super(),ce(this,"name","AudioProcessorDestination"),ce(this,"ID","0"),ce(this,"inputTrack",void 0),ce(this,"inputNode",void 0),ce(this,"audioProcessorContext",void 0),ce(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new _e(L.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new _e(L.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(nn.ON_TRACK,void 0),this.emit(nn.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(nn.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(nn.ON_NODE,this.inputNode))}}class wO extends or{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i,r){super(),ce(this,"constraintsMap",new Map),ce(this,"statsRegistry",[]),ce(this,"audioContext",void 0),ce(this,"trackId",void 0),ce(this,"direction",void 0),ce(this,"usageRegistry",[]),ce(this,"_chained",!1),this.audioContext=t,this.trackId=i,this.direction=r}async getConstraints(){return zt(this,Ws.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,i){var r;return w.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),fi(this,Ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(tn(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),fi(this,Ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(tn(i=this.constraintsMap).call(i)))}registerStats(t,i,r){this.statsRegistry.find((a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===i))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:r})}unregisterStats(t,i){const r=this.statsRegistry.findIndex((a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===i));r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:i,processorName:r,type:a,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:i,processorName:r,type:a,stats:o})}catch(o){w.error(new _e(L.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,i){this.usageRegistry.find((r=>r.processorID===t.ID&&r.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){const i=this.usageRegistry.findIndex((r=>r.processorID===t.ID&&r.processorName===t.name));i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let r=i();r instanceof se&&(r=await r),t.push($i($i({},r),{},{direction:this.direction}))}catch(r){w.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class k1 extends or{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ce(this,"context",void 0),ce(this,"processSourceNode",void 0),ce(this,"outputTrack",void 0),ce(this,"processedNode",void 0),ce(this,"clonedTrack",void 0),ce(this,"outputNode",void 0),this.outputNode=new PB}setVolume(){}createOutputTrack(){throw new _e(L.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class PB{disconnect(){}connect(){}}function Tb(e){return new se(((t,i)=>{let r=!1;const a=document.createElement("video");a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.muted=!0,a.autoplay=!0,a.setAttribute("playsinline",""),a.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(a);const s=Jn()?"canplay":"playing";a.addEventListener(s,(()=>{const o=a.videoWidth,c=a.videoHeight;!o&&Ci()||(r=!0,a.srcObject=null,a.remove(),t([o,c]))})),a.srcObject=new MediaStream([e]),a.play().catch(lb),setTimeout((()=>{r||(a.srcObject=null,a.remove(),t([a.videoWidth,a.videoHeight]))}),4e3)}))}function Rb(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const i=Gc(e.encoderConfig);return i.width!=null&&(t.width=i.width),i.height!=null&&(t.height=i.height),!sO()&&i.frameRate&&(t.frameRate=i.frameRate),jr()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Ci()&&(t.frameRate={ideal:30,max:30}),t}function M1(e){const t={};return sO()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,dn()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function LB(e){const t=M1(e);if(e.encoderConfig){const i=s_(e.encoderConfig);t.channelCount=i.stereo?2:1,t.sampleRate=i.sampleRate,t.sampleSize=i.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),tE()&&(t.sampleRate=void 0),t}const kB=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:i,width:r,height:a}=e.getMediaStreamTrackSettings();let{frameRate:s=i,width:o=r,height:c=a}=t;if(!s||!o||!c)return;o=rE(o),c=rE(c),s=rE(s);const{max:d,min:l}=(function(m,S,T){const R=200*Math.pow(T/15,.6)*Math.pow(m*S/640/360,.75);return{min:Math.floor(R),max:Math.floor(4*R)}})(o,c,s),{bitrateMax:h,bitrateMin:_}=t||{};h||w.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(c,", fps: ").concat(s,"] => [brMax: ").concat(h,", brMin: ").concat(_,"]"));const{maxFramerate:f}=G("ENCODER_CONFIG_LIMIT");return f&&typeof f=="number"&&(s=Math.min(s,f)),{frameRate:s,bitrateMax:h||d,bitrateMin:_||l,scaleResolutionDownBy:1,scale:0}},OO=async(e,t,i)=>await(async(r,a,s)=>{const o=(function(l){const h=[];for(let _=0;_<l.length;_+=2)h.push(parseInt(l.slice(_,_+2),16));return Uint8Array.from(h)})(gB(""+a+s)).slice(0,16),c=o.slice(0,12),d=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},d,r))})(e.buffer,t,i),NO=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new se(((i,r)=>{t.toBlob((async a=>{if(t.remove(),a){const s=await U1(a);i({buffer:s,width:t.width,height:t.height})}else r(new _e(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},U1=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var x1,V1,F1,B1,j1,G1,W1,H1,K1,Y1,z1,q1,X1,J1,Z1,Q1,$1,Dr,Pr,eM,tM,iM,rM,nM,ju,Gu,aM,sM,oM,cM,dM,lM,uM,hM,pM,_M,fM,EM,Ca,Ti;let yr=(x1=Te({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),V1=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),F1=zr(),B1=Yr("LocalAudioTrack","_enabledMutex"),j1=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),G1=zr(),W1=Yr("LocalAudioTrack","_enabledMutex"),H1=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),K1=zr(),Y1=zr(),z1=zr(),q1=Te({argsMap:e=>[e.getTrackId()]}),X1=zr(),J1=Te({argsMap:e=>[e.getTrackId()]}),Z1=zr(),Q1=Te({argsMap:e=>[e.getTrackId()]}),$1=Te({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Dr=Te({argsMap:e=>[e.getTrackId()]}),te((Pr=class extends wg{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ki.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,i,r){super(e,i),ce(this,"trackMediaType",ys.AUDIO),ce(this,"_encoderConfig",void 0),ce(this,"_trackSource",void 0),ce(this,"metadata",[]),ce(this,"_enabled",!0),ce(this,"_volume",100),ce(this,"_useAudioElement",!0),ce(this,"_bypassWebAudio",!1),ce(this,"processor",void 0),ce(this,"_processorContext",void 0),ce(this,"_processorDestination",void 0),ce(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new k1,G("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),G("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ra()&&!li?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){ji(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ki.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void w.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,fi(this,Oe.NEED_REPLACE_TRACK,this).then((()=>{w.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((i=>{w.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!mb())throw new _e(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ki.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,i){return this._setEnabled(e,t,i)}async _setEnabled(e,t,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await fi(this,Oe.NEED_ENABLE_TRACK,this),w.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw i||(this._enabled=!1),w.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await fi(this,Oe.NEED_DISABLE_TRACK,this)}catch(r){throw i||(this._enabled=!0),w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,w.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await fi(this,Oe.NEED_MUTE_TRACK,this):await fi(this,Oe.NEED_UNMUTE_TRACK,this))}getStats(){return Uc((()=>{w.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),Bs(this,Oe.GET_STATS)||$i({},gb)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Mo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Mo.ON_AUDIO_BUFFER),this._source.on(Mo.ON_AUDIO_BUFFER,(i=>e(i)))}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ki.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ki.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ki.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fi(this,Oe.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return se.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new _e(L.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new _e(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(nn.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await fi(this,Oe.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fi(this,Oe.NEED_REPLACE_TRACK,this))})),e.on(nn.ON_NODE,(t=>{this._source.processedNode=t}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(nn.ON_TRACK),e.removeAllListeners(nn.ON_NODE)}bindProcessorContextEvents(e){e.on(Ws.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(Ws.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof k1&&(this._trackSource=new w1(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new wO(this._source.context,this.getTrackId(),"local"),t=new L1(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Mo.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ki.stop(this.getTrackId()),this._source.play()),fi(this,Oe.NEED_REPLACE_MIXING_TRACK,this).then((()=>{w.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((i=>{w.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[x1],Object.getOwnPropertyDescriptor(Pr.prototype,"setVolume"),Pr.prototype),te(Pr.prototype,"setPlaybackDevice",[V1,F1],Object.getOwnPropertyDescriptor(Pr.prototype,"setPlaybackDevice"),Pr.prototype),te(Pr.prototype,"setEnabled",[B1,j1,G1],Object.getOwnPropertyDescriptor(Pr.prototype,"setEnabled"),Pr.prototype),te(Pr.prototype,"setMuted",[W1,H1,K1],Object.getOwnPropertyDescriptor(Pr.prototype,"setMuted"),Pr.prototype),te(Pr.prototype,"getStats",[Y1],Object.getOwnPropertyDescriptor(Pr.prototype,"getStats"),Pr.prototype),te(Pr.prototype,"setAudioFrameCallback",[z1],Object.getOwnPropertyDescriptor(Pr.prototype,"setAudioFrameCallback"),Pr.prototype),te(Pr.prototype,"play",[q1,X1],Object.getOwnPropertyDescriptor(Pr.prototype,"play"),Pr.prototype),te(Pr.prototype,"stop",[J1,Z1],Object.getOwnPropertyDescriptor(Pr.prototype,"stop"),Pr.prototype),te(Pr.prototype,"close",[Q1],Object.getOwnPropertyDescriptor(Pr.prototype,"close"),Pr.prototype),te(Pr.prototype,"pipe",[$1],Object.getOwnPropertyDescriptor(Pr.prototype,"pipe"),Pr.prototype),te(Pr.prototype,"unpipe",[Dr],Object.getOwnPropertyDescriptor(Pr.prototype,"unpipe"),Pr.prototype),Pr),vb=(eM=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),tM=zr(),iM=Yr("MicrophoneAudioTrack","_enabledMutex"),rM=Te({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),nM=zr(),ju=Te({argsMap:e=>[e.getTrackId()]}),te((Gu=class extends yr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,i,r){super(e,t.encoderConfig?s_(t.encoderConfig):{},r,G("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ce(this,"_config",void 0),ce(this,"_deviceName","default"),ce(this,"_constraints",void 0),ce(this,"_originalConstraints",void 0),ce(this,"_enabled",!0),this._config=t,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(eE()||aO())&&Li.bindInterruptDetectorTrack(this)}async setDevice(e){if(w.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Uo.getDeviceById(e),i={};i.audio=$i({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Wc(i,this.getTrackId())}catch(a){throw w.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),r=await Wc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Uo.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}w.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,i){if(t)return w.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),e),G("AUTO_RESET_AUDIO_ROUTE")&&(Jn()||wd())){const o=navigator.audioSession;o&&(e||(o.type="playback"),o.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),i||(this._enabled=!1);try{await fi(this,Oe.NEED_DISABLE_TRACK,this)}catch(o){throw w.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const a=$i({},this._constraints),s=Uo.searchDeviceIdByName(this._deviceName);s&&!a.deviceId&&(a.deviceId=s);try{i||(this._enabled=!0);const o=await Wc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await fi(this,Oe.NEED_ENABLE_TRACK,this)}catch(o){throw i||(this._enabled=!1),w.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}w.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(eE()||aO())&&Li.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Jn()||wd())&&this._enabled&&!this._isClosed&&Li.duringInterruption){const e=async()=>{Li.off(On.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Li.on(On.IOS_INTERRUPTION_END,e)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(js.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,i=Uo.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId=i),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Wc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ws.REQUEST_UPDATE_CONSTRAINTS,(async(t,i,r)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),i()}catch(a){r(a)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ws.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[eM,tM],Object.getOwnPropertyDescriptor(Gu.prototype,"setDevice"),Gu.prototype),te(Gu.prototype,"setEnabled",[iM,rM,nM],Object.getOwnPropertyDescriptor(Gu.prototype,"setEnabled"),Gu.prototype),te(Gu.prototype,"close",[ju],Object.getOwnPropertyDescriptor(Gu.prototype,"close"),Gu.prototype),Gu),Un=(aM=Te({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),sM=zr(),oM=Te({argsMap:e=>[e.getTrackId()]}),cM=zr(),dM=Te({argsMap:e=>[e.getTrackId()]}),lM=zr(),uM=Te({argsMap:e=>[e.getTrackId()]}),hM=zr(),pM=Te({argsMap:e=>[e.getTrackId()]}),_M=zr(),fM=Te({argsMap:e=>[e.getTrackId()]}),EM=Te({argsMap:e=>[e.getTrackId()]}),Ca=zr(),te((Ti=class extends yr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,i,r){super(t.createOutputTrack(),i,r),ce(this,"source",void 0),ce(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Mo.AUDIO_SOURCE_STATE_CHANGE,(a=>{this.safeEmit(js.SOURCE_STATE_CHANGE,a)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){ji(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[aM,sM],Object.getOwnPropertyDescriptor(Ti.prototype,"startProcessAudioBuffer"),Ti.prototype),te(Ti.prototype,"pauseProcessAudioBuffer",[oM,cM],Object.getOwnPropertyDescriptor(Ti.prototype,"pauseProcessAudioBuffer"),Ti.prototype),te(Ti.prototype,"seekAudioBuffer",[dM,lM],Object.getOwnPropertyDescriptor(Ti.prototype,"seekAudioBuffer"),Ti.prototype),te(Ti.prototype,"resumeProcessAudioBuffer",[uM,hM],Object.getOwnPropertyDescriptor(Ti.prototype,"resumeProcessAudioBuffer"),Ti.prototype),te(Ti.prototype,"stopProcessAudioBuffer",[pM,_M],Object.getOwnPropertyDescriptor(Ti.prototype,"stopProcessAudioBuffer"),Ti.prototype),te(Ti.prototype,"close",[fM],Object.getOwnPropertyDescriptor(Ti.prototype,"close"),Ti.prototype),te(Ti.prototype,"setAudioBufferPlaybackSpeed",[EM,Ca],Object.getOwnPropertyDescriptor(Ti.prototype,"setAudioBufferPlaybackSpeed"),Ti.prototype),Ti);class xn extends yr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Rl().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Mi(8,"track-mix-")),ce(this,"trackList",void 0),ce(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(w.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):w.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){w.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}t_(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach((i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(t.stereo=!0))})),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach((i=>{i instanceof xn?i.emit(Sl.TRANSCEIVER_UPDATED,t):i._updateRtpTransceiver(t)})))}}class MB extends I1{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Mo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ce(this,"audioBuffer",void 0),ce(this,"sourceNode",void 0),ce(this,"startPlayTime",0),ce(this,"startPlayOffset",0),ce(this,"pausePlayTime",0),ce(this,"options",void 0),ce(this,"currentLoopCount",0),ce(this,"currentPlaybackSpeed",100),ce(this,"_currentState","stopped"),this.audioBuffer=t,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):w.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const mM=new Map;function DO(e,t){if(e.length===0||t.length===0)return 1/0;const i=_O(e),r=_O(t);return Math.floor(r/i)}class PO{get rendFrameRate(){const t=Math.max(1,DO(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:un.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(w.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var i;t!==this._videoState&&(this._videoState=t,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(t){ce(this,"trackId",void 0),ce(this,"config",void 0),ce(this,"onFirstVideoFrameDecoded",void 0),ce(this,"onFirstVideoFrameRender",void 0),ce(this,"onVideoStateChanged",void 0),ce(this,"freezeTimeCounterList",[]),ce(this,"renderFreezeAccTime",0),ce(this,"renderFreezeAccTime2",0),ce(this,"isKeepLastFrame",!1),ce(this,"isDestroyed",!1),ce(this,"timeUpdatedCount",0),ce(this,"freezeTime",0),ce(this,"playbackTime",0),ce(this,"lastTimeUpdatedTime",0),ce(this,"autoplayFailed",!1),ce(this,"videoTrack",void 0),ce(this,"videoElement",void 0),ce(this,"cacheVideoElement",void 0),ce(this,"internal",!1),ce(this,"_render_interframe_delays",[]),ce(this,"_render_interframe_delays_sizes",[]),ce(this,"_videoState",Tl.VideoStateStopped),ce(this,"videoElementCheckInterval",void 0),ce(this,"videoElementFreezeTimeout",void 0),ce(this,"_videoElementStatus",un.NONE),ce(this,"_isInPage",!0),ce(this,"isGettingVideoDimensions",!1),ce(this,"startGetVideoDimensions",(()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return w.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()})),ce(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Li.curState==="running"&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(sb())),Id()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),ce(this,"handleVideoEvents",(i=>{switch(i.type){case"play":case"playing":i.type==="play"&&w.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=un.PLAYING;break;case"loadeddata":if(this.videoState=Tl.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=un.CANPLAY;break;case"stalled":this.videoElementStatus=un.STALLED;break;case"suspend":this.videoElementStatus=un.SUSPEND;break;case"pause":this.videoElementStatus=un.PAUSED,Jn()||wd()||Ra()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=un.WAITING;break;case"abort":this.videoElementStatus=un.ABORT;break;case"ended":this.videoElementStatus=un.ENDED;break;case"emptied":this.videoElementStatus=un.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=un.ERROR,w.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const a=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Hu.lastVisibleTime<Hu.lastHiddenTime||s<Hu.lastHiddenTime||s<Hu.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(a>G("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=a),this.playbackTime+=a;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),ce(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(sb())),Id()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Li.on(On.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Li.on(On.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const i=this.videoElement.play();i&&i.catch&&i.catch((a=>{t&&DB(t,"video",a.message,this.trackId),a.name==="NotAllowedError"?(w.warning("detected video element autoplay failed",a),this.autoplayFailed=!0,this.handleAutoPlayFailed()):w.warning("[".concat(this.trackId,"] play warning: "),a)}));const r=_i();if((r.name==="Safari"&&Number(r.version)===15||eE())&&i&&i.then){const a=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(a).catch(a)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const i=t.getContext("2d");if(!i)return w.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,t.width,t.height);const r=i.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const a=r.getContext("2d");return a?(a.drawImage(this.videoElement,0,0,r.width,r.height),new se(((s,o)=>{r.toBlob((async c=>{if(r.remove(),c){const d=await U1(c);s({buffer:d,width:r.width,height:r.height})}else o(new _e(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,i<0?.1:i>1?1:i)}))):await NO(t)}destroy(){this.isDestroyed=!0,Li.off(On.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Li.off(On.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Tl.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=un.INIT,!this.videoElementCheckInterval&&(LO.forEach((s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)}),1e3),G("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,i;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(c,G("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Tl.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Tl.VideoStateFrozen:document.addEventListener("visibilitychange",o))},d=(l,h)=>{if(this.videoElementStatus===un.PLAYING){if(s){const m=h.presentationTime-s.presentationTime,S=h.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(S),this._render_interframe_delays.push(m);const T=_O(this._render_interframe_delays_sizes),R=T-this._render_interframe_delays_sizes[0];if(T>30&&R>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Tl.VideoStateStarting&&(this.videoState=Tl.VideoStateDecoding),this.videoState===Tl.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,G("VIDEO_FREEZE_DURATION"))),m<G("VIDEO_FREEZE_DURATION")&&this.videoState===Tl.VideoStateFrozen&&(this.videoState=Tl.VideoStateDecoding),m>G("VIDEO_FREEZE_DURATION")&&Hu.lastVisibleTime>=Hu.lastHiddenTime&&s.timestamp>Hu.lastVisibleTime&&s.timestamp>Hu.lastHiddenTime){const C=Math.min(66,DO(this._render_interframe_delays_sizes,this._render_interframe_delays)),b=Math.max(0,m-(S-1)*C);this.renderFreezeAccTime2+=b>C?b:0,this.renderFreezeAccTime+=m}}s=$i($i({},h),{},{timestamp:l})}else this.isSkipCalcRenderFreezeTime()&&(s=$i($i({},h),{},{timestamp:l}));var _,f;G("ENABLE_VIDEO_FRAME_CALLBACK")&&((_=(f=this.videoElement).requestVideoFrameCallback)===null||_===void 0||_.call(f,d))};(t=(i=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(i,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),tE()&&!G("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=_i();r.name==="Safari"&&Number(r.version)===15||eE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ci()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ci()&&this.videoElement.load());const a=this.videoElement.play();a!==void 0&&a.catch((s=>{w.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())}))}resetVideoElement(){LO.forEach((t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=un.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===un.DESTROYED||this.internal}handleAutoPlayFailed(){const t=i=>{i.preventDefault(),this.videoElement.play().then((()=>{w.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((r=>{w.error(r)})),this.autoplayFailed=!1,Rt()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Rt()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),N1()}}const LO=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class kO extends PO{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),ce(this,"container",void 0),ce(this,"slot",void 0),this.slot=t.element,this.internal=i,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const i=t.element;var r;!this.internal||this.slot?(i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()):(this.slot=i,i&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var i;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await NO(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",G("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var gM,SM,TM,RM,vM,yM,CM,bM,AM,IM,wM,OM,NM,DM,PM,LM,kM,MM,UM,xM,VM,FM,BM,jM,GM,WM,HM,Zt,Qt,KM,YM,zM,qM,XM,JM,ZM,_c,Ai;let Xi=(gM=Te({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),SM=zr(),TM=Te({argsMap:e=>[e.getTrackId()]}),RM=Yr("LocalVideoTrack","_enabledMutex"),vM=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),yM=zr(),CM=Yr("LocalVideoTrack","_enabledMutex"),bM=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),AM=zr(),IM=Te({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),wM=zr(),OM=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),NM=zr(),DM=zr(),PM=Te({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),LM=zr(),kM=zr(),MM=zr(),UM=Te({argsMap:e=>[e.getTrackId()]}),xM=zr(),VM=zr(),FM=zr(),BM=zr(),jM=zr(),GM=Te({argsMap:(e,t)=>[e.getTrackId(),t.name]}),WM=Te({argsMap:e=>[e.getTrackId()]}),HM=Te({argsMap:e=>[e.getTrackId()]}),Zt=Te({argsMap:(e,t,i)=>[e.getTrackId(),t.label,i]}),Qt=class F8 extends wg{get videoHeight(){if(Ra()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ra()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==un.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,i,r,a,s,o){if(super(t,s),ce(this,"trackMediaType",ys.VIDEO),ce(this,"_player",void 0),ce(this,"isUseScaleResolutionDownBy",!1),ce(this,"_videoVisibleTimer",null),ce(this,"_previousVideoVisibleStatus",void 0),ce(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),ce(this,"_encoderConfig",void 0),ce(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ce(this,"_optimizationMode",void 0),ce(this,"_saveEncodeBitrateRatio",1),ce(this,"_videoHeight",void 0),ce(this,"_videoWidth",void 0),ce(this,"_forceBitrateLimit",void 0),ce(this,"_enabled",!0),ce(this,"_processorDestination",void 0),ce(this,"_processorContext",void 0),Ra()){const{width:c,height:d}=t.getSettings();this._videoWidth=c,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=a,this._hints=o||[],i&&this._hints.indexOf(Ui.CUSTOM_TRACK)!==-1?this._encoderConfig=qi(i):this._encoderConfig=i,this._hints.indexOf(Ui.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(ob(bi.CHROME,115)&&ab().indexOf("Windows")!==-1){const c=(function(d,l){if("VideoFrame"in window&&"TransformStream"in window&&Si().supportWebRTCInsertableStream){const h=new MediaStreamTrackProcessor(d),_=new MediaStreamTrackGenerator({kind:"video"});let f,m,S=Date.now();const T=()=>{R&&(clearInterval(R),R=void 0),f&&(f.close(),f=void 0),d.stop(),m=void 0,_.removeEventListener("ended",T)};let R=window.setInterval((()=>{if(m&&f&&Date.now()-S>1e3)try{_.readyState==="live"?m.enqueue(f.clone()):T()}catch{T()}}),1e3);const C=new TransformStream({transform:(b,N)=>{_.readyState==="live"?(m=N,S=Date.now(),f===void 0?(f=b,N.enqueue(b.clone())):(N.enqueue(f),f=b)):b.close()}});return _.addEventListener("ended",T),h.readable.pipeThrough(C).pipeTo(_.writable),_}})(t);c&&(w.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}i&&this._hints.indexOf(Ui.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new P1(this.getTrackId(),"local"),this._processorDestination=new D1(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const r=$i($i($i({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new PO(r):this._player=new kO(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(js.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}}),G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await fi(this,Oe.NEED_DISABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return i||(this._enabled=!1),void w.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await fi(this,Oe.NEED_ENABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,w.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await fi(this,Oe.NEED_MUTE_TRACK,this):await fi(this,Oe.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),w.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await fi(this,Oe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(w)}}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new _e(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Gc(t),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=Rb({encoderConfig:t});(Ra()||Jn()||wd())&&(r.deviceId=void 0),w.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(a){const s=new _e(L.UNEXPECTED_ERROR,a.toString());throw w.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(Ui.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fi(this,Oe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(w)}}getStats(){return Uc((()=>{w.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),Bs(this,Oe.GET_STATS)||$i({},yO)}async setBeautyEffect(t){w.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,i):await NO(t)}async findClosestProfile(){const{width:t,height:i,frameRate:r}=this.getMediaStreamTrackSettings(),{width:a,height:s,frameRate:o}=this._encoderConfig||{},c=rE(this._videoWidth||t||a||0),d=rE(this._videoHeight||i||s||0),l=(function(h,_,f){if(!Array.isArray(G("VIDEO_ENCODER_CONFIG_LIST"))||G("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const m=Math.min(h,_);return!(m>=480)&&$i($i({},G("VIDEO_ENCODER_CONFIG_LIST").find((S=>S.height>m))),{},{frameRate:f})})(c,d,rE(r||o||15));if(l)return w.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(c,"x").concat(d," => ").concat(JSON.stringify(l))),this.setEncoderConfiguration(l)}async setBitrateLimit(t){w.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void w.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=t,await fi(this,Oe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=i,w.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return w.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,w.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){Tb(this._originMediaStreamTrack).then((t=>{let[i,r]=t;this._videoHeight=r,this._videoWidth=i})).catch(lb)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new _e(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");w.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Gc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Ui.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fi(this,Oe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(w)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:i,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!i||!r)return;const{bitrateMax:a,bitrateMin:s}=this._encoderConfig;if(s==null||a==null){const{max:o,min:c}=(function(d,l,h,_,f){const m=G("BITRATE_ADAPTER_TYPE");if(m==="DEFAULT_BITRATE")return{min:_,max:f};if(f===void 0){const S=Math.floor(200*Math.pow(h/15,.6)*Math.pow(d*l/640/360,.75));f=m==="STANDARD_BITRATE"?4*S:2*S,_=_??S}else _=_??Math.floor(f/10);return{min:_,max:f}})(t,i,r,s,a);if(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,G("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&a==null){const[d,l]=(function(h,_,f){const m=4*Math.floor(2e5*Math.pow(f/15,.6)*Math.pow(h*_/230400,.75)),S=h*_,T=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),R=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let C=tn(T).call(T).next().value,b=1;if(T.has(S))C=T.get(S);else{var N;const he=vt(N=Array.from(T.entries())).call(N,((xe,qe)=>{let[ot]=xe,[xt]=qe;return ot-xt})),Ge=he.find((xe=>{let[qe]=xe;return qe>S}));if(Ge){const xe=he.indexOf(Ge);if(xe>0){const qe=he[xe-1],ot=(S-qe[0])/(Ge[0]-qe[0]);C=qe[1]+ot*(Ge[1]-qe[1])}else C=Ge[1]}else C=he[he.length-1][1]}if(R.has(S))b=R.get(S);else{var k;const he=vt(k=Array.from(R.entries())).call(k,((xe,qe)=>{let[ot]=xe,[xt]=qe;return ot-xt})),Ge=he.find((xe=>{let[qe]=xe;return qe>S}));if(Ge){const xe=he.indexOf(Ge);if(xe>0){const qe=he[xe-1],ot=(S-qe[0])/(Ge[0]-qe[0]);b=qe[1]+ot*(Ge[1]-qe[1])}else b=Ge[1]}else b=he[he.length-1][1]}const P=G("VIDEO_NEW_BITRATE_RATIO");P&&P>0&&(C=P/100);const U=Math.floor(m*C),W=Math.floor(65e4*Math.pow(h*_/230400,.5)*Math.pow(f/15,.69));let z=U;const Q=G("VIDEO_STANDARD_BITRATE_VERSION");return Q&&Q>0&&(Q===1?z=m:Q===2?z=U:Q===3&&(z=W)),[Math.floor(z/1e3),b]})(t,i,r);this._encoderConfig.bitrateMax=d,this._encoderConfig.bitrateMin=c?Math.min(c,d):d,this._saveEncodeBitrateRatio=l,w.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else w.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(c,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,i;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:r?.parentElement},{element:s,slot:o}=a;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=cO.checkOneElementVisible(s),d=Object.assign({},c);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const l=J.reportApiInvoke(null,{tag:Tr.TRACER,name:Gt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(r){throw new _e(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new _e(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=$i($i({},r),Gc(t))),r=iE(r);const a=Mi(8,"track-video-cloned-"),s=new F8(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,iE(this._scalabilityMode),this._optimizationMode,a,iE(this._hints));return t&&r&&s.setEncoderConfiguration(r),w.debug("clone video track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(i)),s}async replaceTrack(t,i){if(!(t instanceof MediaStreamTrack))throw new _e(L.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new _e(L.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Uc((()=>{J.reportApiInvoke(null,{name:Gt.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Tr.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!G("ENABLE_VIDEO_SEI")||!G("ENABLE_ENCODED_TRANSFORM"))return void w.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new _e(L.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void w.warning("Video track is not published, SEI can not be send");const r=i.sender.getParameters();if(r.codecs.length===0)return;const a=r.codecs[0].mimeType.toLocaleLowerCase();a==="video/h264"||a==="video/h265"?this.safeEmit("sei-to-send",t):w.warning("SEI is not supported by ".concat(a))}bindProcessorDestinationEvents(){this.processorDestination.on(nn.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await fi(this,Oe.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fi(this,Oe.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(nn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ws.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ws.REQUEST_CONSTRAINTS)}},te(Qt.prototype,"play",[gM,SM],Object.getOwnPropertyDescriptor(Qt.prototype,"play"),Qt.prototype),te(Qt.prototype,"stop",[TM],Object.getOwnPropertyDescriptor(Qt.prototype,"stop"),Qt.prototype),te(Qt.prototype,"setEnabled",[RM,vM,yM],Object.getOwnPropertyDescriptor(Qt.prototype,"setEnabled"),Qt.prototype),te(Qt.prototype,"setMuted",[CM,bM,AM],Object.getOwnPropertyDescriptor(Qt.prototype,"setMuted"),Qt.prototype),te(Qt.prototype,"setSaveEncodeBitrateRatio",[IM,wM],Object.getOwnPropertyDescriptor(Qt.prototype,"setSaveEncodeBitrateRatio"),Qt.prototype),te(Qt.prototype,"setEncoderConfiguration",[OM,NM],Object.getOwnPropertyDescriptor(Qt.prototype,"setEncoderConfiguration"),Qt.prototype),te(Qt.prototype,"getStats",[DM],Object.getOwnPropertyDescriptor(Qt.prototype,"getStats"),Qt.prototype),te(Qt.prototype,"setBeautyEffect",[PM,LM],Object.getOwnPropertyDescriptor(Qt.prototype,"setBeautyEffect"),Qt.prototype),te(Qt.prototype,"getCurrentFrameData",[kM],Object.getOwnPropertyDescriptor(Qt.prototype,"getCurrentFrameData"),Qt.prototype),te(Qt.prototype,"getCurrentFrameImage",[MM],Object.getOwnPropertyDescriptor(Qt.prototype,"getCurrentFrameImage"),Qt.prototype),te(Qt.prototype,"findClosestProfile",[UM,xM],Object.getOwnPropertyDescriptor(Qt.prototype,"findClosestProfile"),Qt.prototype),te(Qt.prototype,"setBitrateLimit",[VM],Object.getOwnPropertyDescriptor(Qt.prototype,"setBitrateLimit"),Qt.prototype),te(Qt.prototype,"setOptimizationMode",[FM],Object.getOwnPropertyDescriptor(Qt.prototype,"setOptimizationMode"),Qt.prototype),te(Qt.prototype,"setScalabiltyMode",[BM],Object.getOwnPropertyDescriptor(Qt.prototype,"setScalabiltyMode"),Qt.prototype),te(Qt.prototype,"updateMediaStreamTrackResolution",[jM],Object.getOwnPropertyDescriptor(Qt.prototype,"updateMediaStreamTrackResolution"),Qt.prototype),te(Qt.prototype,"pipe",[GM],Object.getOwnPropertyDescriptor(Qt.prototype,"pipe"),Qt.prototype),te(Qt.prototype,"unpipe",[WM],Object.getOwnPropertyDescriptor(Qt.prototype,"unpipe"),Qt.prototype),te(Qt.prototype,"close",[HM],Object.getOwnPropertyDescriptor(Qt.prototype,"close"),Qt.prototype),te(Qt.prototype,"replaceTrack",[Zt],Object.getOwnPropertyDescriptor(Qt.prototype,"replaceTrack"),Qt.prototype),Qt),sR=(KM=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),YM=zr(),zM=Yr("CameraVideoTrack","_enabledMutex"),qM=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),XM=zr(),JM=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),ZM=zr(),_c=Te({argsMap:e=>[e.getTrackId()]}),Ai=class B8 extends Xi{get __className__(){return"CameraVideoTrack"}constructor(t,i,r,a,s,o){super(t,Gc(i.encoderConfig),a,s,o),ce(this,"_config",void 0),ce(this,"_originalConstraints",void 0),ce(this,"_constraints",void 0),ce(this,"_enabled",!0),ce(this,"_deviceName","default"),ce(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(eE()||aO())&&!(function(){const c=_i();if(c.os!==Ot.IOS||!c.osVersion)return!1;const d=c.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2})()&&h1()&&this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=i,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Gc(this._config.encoderConfig),Li.on(On.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Li.on(On.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(w.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const i=await Uo.getDeviceById(t),r={};r.video=$i({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let a=null;try{a=await Wc(r,this.getTrackId())}catch(s){throw w.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),a=await Wc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Uo.getDeviceById(t);this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}w.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){w.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const i={video:$i($i({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Wc(i,this.getTrackId())}catch(a){throw w.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),a.toString()),r=await Wc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=$i({},i.video),w.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Wc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await fi(this,Oe.NEED_ENABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),w.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await fi(this,Oe.NEED_DISABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new _e(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Gc(t),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=qi(this._config);r.encoderConfig=t;const a=Rb(r);(Ra()||Jn()||wd())&&(a.deviceId=void 0),w.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(s){const o=new _e(L.UNEXPECTED_ERROR,s.toString());throw w.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=r,this._constraints=a,this._originalConstraints=a,this._encoderConfig=t,this._hints.indexOf(Ui.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fi(this,Oe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(w)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Jn()||wd())&&this._enabled&&!this._isClosed&&Li.duringInterruption){const t=async()=>{Li.off(On.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Li.on(On.IOS_INTERRUPTION_END,t)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(js.TRACK_ENDED)}async renewMediaStreamTrack(t){const i=t||this._constraints,r=Uo.searchDeviceIdByName(this._deviceName);if(r&&!i.deviceId&&(i.deviceId={exact:r}),this._enabled){const a=await Wc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Li.off(On.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Li.off(On.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=$i($i({},r),Gc(t))),r=iE(r);const a=Mi(8,"track-cam-cloned-"),s=new B8(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,iE($i($i({},this._config),{},{encoderConfig:r})),iE(this._constraints),iE(this._scalabilityMode),this._optimizationMode,a);return t&&r&&s.setEncoderConfiguration(r),w.debug("clone track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(i)),s}bindProcessorContextEvents(){this.processorContext.on(Ws.REQUEST_UPDATE_CONSTRAINTS,(async(t,i,r)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),i()}catch(a){r(a)}})),this.processorContext.on(Ws.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}},te(Ai.prototype,"setDevice",[KM,YM],Object.getOwnPropertyDescriptor(Ai.prototype,"setDevice"),Ai.prototype),te(Ai.prototype,"setEnabled",[zM,qM,XM],Object.getOwnPropertyDescriptor(Ai.prototype,"setEnabled"),Ai.prototype),te(Ai.prototype,"setEncoderConfiguration",[JM,ZM],Object.getOwnPropertyDescriptor(Ai.prototype,"setEncoderConfiguration"),Ai.prototype),te(Ai.prototype,"close",[_c],Object.getOwnPropertyDescriptor(Ai.prototype,"close"),Ai.prototype),Ai);function MO(e,t,i,r){i.optimizationMode&&(r&&r.width&&r.height?(i.encoderConfig=$i($i({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(t.contentHint=i.optimizationMode,t.contentHint===i.optimizationMode?w.debug("[".concat(e,"] set content hint to"),i.optimizationMode):w.debug("[".concat(e,"] set content hint failed")))):w.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var QM,$M,eU,Hc,Kc,tU,iU,rU,nU,aU,ds,ls;class Og extends Ig{getUserId(){return this._userId}constructor(t,i,r,a){super(t,"track-".concat(t.kind,"-").concat(i,"-").concat(a.clientId,"_").concat(Mi(5,""))),ce(this,"_userId",void 0),ce(this,"_uintId",void 0),ce(this,"_isDestroyed",!1),ce(this,"store",void 0),ce(this,"processor",void 0),ce(this,"processorContext",void 0),this._userId=i,this._uintId=r,this.store=a}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,w.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Wu=(QM=Te({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),$M=Te({argsMap:e=>[e.getTrackId()]}),eU=Te({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Hc=Te({argsMap:e=>[e.getTrackId()]}),te((Kc=class extends Og{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==un.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,i,r,a){super(e,t,i,r),ce(this,"_videoVisibleTimer",null),ce(this,"_previousVideoVisibleStatus",void 0),ce(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),ce(this,"trackMediaType",ys.VIDEO),ce(this,"_videoWidth",void 0),ce(this,"_videoHeight",void 0),ce(this,"_player",void 0),ce(this,"_prePlayer",void 0),ce(this,"processorDestination",void 0),ce(this,"processorContext",void 0),this._prePlayer=a,this.updateMediaStreamTrackResolution(),this.processorContext=new P1(this.getTrackId(),"remote"),this.processorDestination=new D1(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Uc((()=>{w.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),Bs(this,Oe.GET_STATS)||$i({},Cs)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Gs.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const i=$i($i({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(i);else{let r=!1,a=!1;e instanceof HTMLVideoElement?(this._player=new PO(i),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,a=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(i)):this._player=new kO(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Gs.FIRST_FRAME_DECODED),a&&this.safeEmit(Gs.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(Gs.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Gs.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}}),G("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Gs.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Tb(this._originMediaStreamTrack).then((e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t})).catch(lb)}_updatePlayerSource(){w.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i?.parentElement},{element:a,slot:s}=r;if(this.isPlaying&&a instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=cO.checkOneElementVisible(a),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const d=J.reportApiInvoke(null,{tag:Tr.TRACER,name:Gt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(i){throw new _e(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new _e(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(nn.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(nn.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Sl.SEI_RECEIVED,e)}}).prototype,"play",[QM],Object.getOwnPropertyDescriptor(Kc.prototype,"play"),Kc.prototype),te(Kc.prototype,"stop",[$M],Object.getOwnPropertyDescriptor(Kc.prototype,"stop"),Kc.prototype),te(Kc.prototype,"pipe",[eU],Object.getOwnPropertyDescriptor(Kc.prototype,"pipe"),Kc.prototype),te(Kc.prototype,"unpipe",[Hc],Object.getOwnPropertyDescriptor(Kc.prototype,"unpipe"),Kc.prototype),Kc),fc=(tU=Te({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),iU=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),rU=Te({argsMap:e=>[e.getTrackId()]}),nU=Te({argsMap:e=>[e.getTrackId()]}),aU=Te({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ds=Te({argsMap:e=>[e.getTrackId()]}),te((ls=class extends Og{get isPlaying(){return this._useAudioElement?ki.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,i,r){super(e,t,i,r),ce(this,"trackMediaType",ys.AUDIO),ce(this,"_source",void 0),ce(this,"_useAudioElement",!0),ce(this,"_volume",100),ce(this,"processorContext",void 0),ce(this,"processorDestination",void 0),ce(this,"_played",!1),ce(this,"_bypassWebAudio",!1),G("DISABLE_WEBAUDIO")?(this._source=new k1,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new w1(e,!0),G("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Mo.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(Gs.FIRST_FRAME_DECODED)})),this.processorContext=new wO(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new L1(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Mo.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Mo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Mo.ON_AUDIO_BUFFER),this._source.on(Mo.ON_AUDIO_BUFFER,(i=>e(i)))}setVolume(e){this._volume=e,this._useAudioElement?ki.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!mb())throw new _e(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ki.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Uc((()=>{w.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),Bs(this,Oe.GET_STATS)||$i({},IB)}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] use audio element to play")),ki.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ki.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ki.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new _e(L.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new _e(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new _e(L.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(nn.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(nn.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(nn.ON_TRACK),this.processorDestination.removeAllListeners(nn.ON_NODE)}}).prototype,"setVolume",[tU],Object.getOwnPropertyDescriptor(ls.prototype,"setVolume"),ls.prototype),te(ls.prototype,"setPlaybackDevice",[iU],Object.getOwnPropertyDescriptor(ls.prototype,"setPlaybackDevice"),ls.prototype),te(ls.prototype,"play",[rU],Object.getOwnPropertyDescriptor(ls.prototype,"play"),ls.prototype),te(ls.prototype,"stop",[nU],Object.getOwnPropertyDescriptor(ls.prototype,"stop"),ls.prototype),te(ls.prototype,"pipe",[aU],Object.getOwnPropertyDescriptor(ls.prototype,"pipe"),ls.prototype),te(ls.prototype,"unpipe",[ds],Object.getOwnPropertyDescriptor(ls.prototype,"unpipe"),ls.prototype),ls);const Hu=new class extends or{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ce(this,"_lastHiddenTime",0),ce(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),w.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class UB extends or{constructor(t,i){super(),ce(this,"trackMediaType",ys.DATA),ce(this,"_version",1),ce(this,"_type",3),ce(this,"_config",void 0),ce(this,"_originDataChannel",void 0),ce(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ce(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),ce(this,"_datachannelEventMap",new Map),this._config=t,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return G("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new se(((t,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout((()=>{var a;i(new _e(L.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((a=this._originDataChannel)===null||a===void 0?void 0:a.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new _e(L.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new _e(L.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[si.OPEN,si.CLOSE,si.ERROR].forEach((i=>{const r=()=>{this.emit(i)};this._datachannelEventMap.set(i,r),t.addEventListener(i,r)}))}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach((i=>{let[r,a]=i;t.removeEventListener(r,a)})),this._datachannelEventMap.clear()}}class X4 extends UB{constructor(t){super(t),ce(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=i.data.slice(0,this._dataStreamPacketHeader.byteLength),a=new DataView(r).getUint8(3);if(a!==this.id)return void(G("SHOW_DATASTREAM2_LOG")&&w.debug("invalid datachannel id: ".concat(a," !== ").concat(this.id)));let s=i.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(si.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class UO extends UB{send(t){if(this._originDataChannel){let i=t;i=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function yb(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>Qm.revokeObjectURL(e)),0),new Worker(Qm.createObjectURL(e))}const xO=71,Cb=1,bb=2,VO=1,d_=2;var qh=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(qh||{});function oR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==xO)return;const r=e.getUint16(1),a=Cb+bb+r,s=new Uint8Array(e.byteLength-a);s.set(new Uint8Array(e.buffer,a,e.byteLength-a));const o={m:i,tlvLen:r,tlv:[],frame:s};let c=Cb+bb;for(;c<a;){const d=e.getUint8(c),l=e.getUint16(c+VO),h=VO+d_;if(d===qh.AUDIO_LEVEL){let _=e.getUint8(c+h);for(let f=1;f<l;f++)_=_<<8|e.getUint8(c+h+f);o.tlv.push({tag:d,length:l,value:t?127^_>>1:127&_})}else if(d===qh.METADATA||d===qh.AUDIO_64_BIT_PTS){const _=new Uint8Array(l);for(let f=0;f<l;f++)_[f]=e.getUint8(c+h+f);o.tlv.push({tag:d,length:l,value:_})}c+=h+l}return o}const Ng=new Map,Xh=127,l_=1e-10,cR=139/13,dR=new Map;function FO(e,t,i){const r="".concat(e,"-").concat(t,"-").concat(i);let a=0;return dR.has(r)?a=dR.get(r):(a=Math.log((function(o,c){const d=o-c;c<d&&(c=d);let l=1;for(let h=o,_=1;h>c;h--,_++)l=l*h/_;return l})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(i)+i*e,dR.set(r,a)),a<l_&&(a=l_),a}function xB(e,t,i){const r=t.length,a=e.length/r;let s=!1;for(let o=0,c=0;o<r;o++){let d=0;for(let l=c+a;c<l;c++)e[c]>i&&d++;t[o]!==d&&(t[o]=d,s=!0)}return s}window.cache=dR;let VB=0;class FB{constructor(t){ce(this,"id",void 0),ce(this,"immediates",[]),ce(this,"lastNonSilence",-1),ce(this,"immediateSpeechActivityScore",l_),ce(this,"lastLevelChangedTime",Date.now()),ce(this,"levels",[]),ce(this,"longs",[]),ce(this,"longSpeechActivityScore",l_),ce(this,"mediums",[]),ce(this,"mediumSpeechActivityScore",l_),ce(this,"minLevel",0),ce(this,"nextMinLevel",0),ce(this,"nextMinLevelWindowLength",0),ce(this,"energyScore",0),this.id=t||"".concat(VB++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,i=this.levels,r=this.minLevel+cR;let a=!1;for(let s=0;s<t.length;++s){let o=i[s];o<r&&(o=0);const c=Math.floor(o/cR);t[s]!==c&&(t[s]=c,a=!0)}return a}computeLongs(){return xB(this.mediums,this.longs,4)}computeMediums(){return xB(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=FO(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=FO(this.longs[0],10,47),this.longSpeechActivityScore>l_&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=FO(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(XE(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let r=t;return t<0&&(r=0),t>Xh&&(r=Xh),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+cR?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>Xh&&(i=Xh),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class sU{constructor(t){ce(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?t=!0:setTimeout(this.execute.bind(this),i)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class oU{constructor(t,i,r){ce(this,"isDominant",void 0),ce(this,"energyRanking",void 0),ce(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=i,this.energyScore=r}}class lR extends or{constructor(t){super(),ce(this,"dominantId",null),ce(this,"lastDecisionTime",0),ce(this,"lastLevelChangedTime",0),ce(this,"lastLevelIdleTime",0),ce(this,"relativeSpeechActivities",[]),ce(this,"speakers",new Map),ce(this,"enableSilence",!1),ce(this,"timeoutToSilenceInterval",0),ce(this,"decisionMaker",null),ce(this,"loudest",[]),ce(this,"numLoudestToTrack",3),ce(this,"energyExpireTimeMs",250),ce(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,i!=null&&(this.energyExpireTimeMs=i),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some((i=>i.id===t))}levelChanged(t,i){const r=Date.now(),a=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const s=a.levelChanged(i,r);return this.updateLoudestList(a,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach((i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)}))}removeSpeakers(t){t.forEach((i=>{this.speakers.delete(i.id)}))}getOrCreateSpeaker(t){let i=this.speakers.get(t);return i||(i=new FB(t),this.speakers.set(t,i),this.maybeStartDecisionMaker()),i}updateLoudestList(t,i,r){const a=t.id===this.dominantId;if(i<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==t;)++d;return new oU(a,d,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new oU(a,0,t.energyScore);const s=r-this.energyExpireTimeMs;let o=0;for(;o<this.loudest.length;){const d=this.loudest[o];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(d.id!==t.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let c=0;for(;c<this.loudest.length&&!(this.loudest[c].energyScore<t.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new oU(a,c,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new sU(this),this.decisionMaker.execute())}makeDecision(t){let i=null,r=null;const a=this.speakers.size;let s=null;if(a===0)s=null;else if(a===1){var o;const c=tn(o=this.speakers).call(o).next().value;this.enableSilence&&c&&(s=c.id,c.evaluateSpeechActivityScores(t),t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let c=this.dominantId==null?null:this.speakers.get(this.dominantId);if(c==null){const h=this.speakers.entries().next();h.value&&(s=h.value[0],c=h.value[1])}else s=c.id;c?.evaluateSpeechActivityScores(t);const d=this.relativeSpeechActivities;let l=2;for(const h of this.speakers.entries()){const[_,f]=h;if(f===c)continue;f.evaluateSpeechActivityScores(t);for(let R=0;R<d.length;++R){const C=c==null?l_:c.getSpeechActivityScore(R);d[R]=Math.log(f.getSpeechActivityScore(R)/C)}const m=d[0],S=d[1],T=d[2];m>3&&S>2&&T>0&&S>l&&(l=S,s=_)}this.enableSilence&&c!=null&&s===c.id&&t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(i=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===i||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),i=300-(t-this.lastLevelIdleTime);let r=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=i;let a=300-(t-this.lastDecisionTime);return a<=0&&(this.lastDecisionTime=t,this.makeDecision(t),a=300-(Date.now()-t)),a>0&&r>a&&(r=a),r}timeoutIdleLevels(t){const i=[];for(const a of tn(r=this.speakers).call(r)){var r;const s=t-a.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||a.id!==this.dominantId)?i.push(a.id):300<s&&a.levelTimedOut()}i.forEach((a=>this.speakers.delete(a)))}}const Vo=new Map;let Yc=null,Ab=null;const oE=3;let ho=[];const zc=new Map,BO=new Map;class jO{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,i){ce(this,"id",void 0),ce(this,"track",void 0),ce(this,"score",0),ce(this,"active",!0),ce(this,"muted",!1),ce(this,"timer",0),ce(this,"actives",0),ce(this,"inactives",0),this.id=t,this.track=i,this.setActive(zc.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:r}=(function(){const a=[],s=[];return Array.from(tn(zc).call(zc)).forEach((o=>{o.active?a.push(o):s.push(o)})),{actives:a,inactives:s}})();if(i.length>3){let a;i.forEach((s=>{(!a||a.score>s.score)&&(a=s)})),a&&a.setActive(!1)}if(i.length<3&&r.length>0){let a;r.forEach((s=>{(!a||a.score<s.score)&&s.id!==this.id&&(a=s)})),a&&t&&!this.active&&(a.samples>40&&a.activeRate-this.activeRate>.4?a.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=(function(i){let r;return Array.from(tn(zc).call(zc)).forEach((a=>{!a.active||a.id===i||a.samples<40||(!r||a.score<r.score)&&(r=a)})),r})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=(function(i){let r;return Array.from(tn(zc).call(zc)).forEach((a=>{a.active||a.id===i||a.samples<40||(!r||a.score>r.score)&&(r=a)})),r})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Ib;function wb(e){const t=zc.get(e);t&&(zc.delete(e),t.clearTimer())}const GO=new Map,cU=new Map,Ob="video/h264",WO="video/h265";function dU(e,t,i){let r=new Uint8Array(e,t,i),a=[],s=0;for(;a.length<i;)s+3<i&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(a.push(r[s],r[s+1],r[s+3]),s+=4):(a.push(r[s]),s++);return new Uint8Array(a)}function lU(e){const t=e.length;let i=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(i.push(e[r],e[r+1],3,e[r+2]),r+=3):(i.push(e[r]),r++);return new Uint8Array(i)}function Nb(e){if(e.length<5)return"";let t=-1;for(let a=0;a<e.length-3;a++){if(e[a]===0&&e[a+1]===0&&e[a+2]===1){t=a;break}if(a<e.length-4&&e[a]===0&&e[a+1]===0&&e[a+2]===0&&e[a+3]===1){t=a;break}}if(t===-1)return"";const i=t+(e[t+2]===0?4:3);if(i>=e.length)return"";const r=e[i];return 128&r?"":(r>>1&63)>=32||i+1<e.length&&(248&e[i+1])==0?WO:(31&r)<=31?Ob:""}const cE=new Map,Db=new Map;(function(){const e=_i();Nt.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Nt.getStreamFromExtension=e.name===bi.CHROME&&Number(e.version)>34,Nt.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let i=!1;try{t.addTransceiver("audio"),i=!0}catch{}return t.close(),i})(),Nt.supportMinBitrate=e.name===bi.CHROME||e.name===bi.EDGE,Nt.supportSetRtpSenderParameters=(function(){const t=_i();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!fl()||!(!Ra()&&!_l())||t.name===bi.FIREFOX&&Number(t.version)>=64)})(),e.name===bi.SAFARI&&(Number(e.version)>=14?Nt.supportDualStream=!0:Nt.supportDualStream=!1),Nt.webAudioMediaStreamDest=(function(){const t=_i();return!(t.name===bi.SAFARI&&Number(t.version)<12)})(),Nt.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Nt.supportWebGL=typeof WebGLRenderingContext<"u",Nt.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,fl()||(Nt.webAudioWithAEC=!0),Nt.supportShareAudio=(function(){const t=_i();return(t.os===Ot.WIN_10||t.os===Ot.WIN_81||t.os===Ot.WIN_7||t.os===Ot.LINUX||t.os===Ot.MAC_OS||t.os===Ot.CHROMIUM_OS)&&t.name===bi.CHROME&&Number(t.version)>=74})(),Nt.supportDataChannel=!!(Tg(76)||iO(68)||l1(14)),Nt.supportPCSetConfiguration=(function(){const t=window.RTCPeerConnection;return!Ci()&&!!t&&t.prototype.setConfiguration instanceof Function})(),Nt.supportWebRTCEncodedTransform=Tg(87)||d1()||iO(117),Nt.supportWebRTCInsertableStream=(function(){const t=_i();return(t.name===bi.CHROME||t.name===bi.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),Nt.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Nt.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,cr((()=>{Nt.supportDualStreamEncoding=(function(){const t=_i();return!!G("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&G("CHROME_DUAL_STREAM_USE_ENCODING"))})(),w.debug("browser ua: ",navigator.userAgent),w.info("browser info: ",e),w.info("browser compatibility: ",Nt)}))})();const BB=["CHINA","GLOBAL"],dE=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],vl=[],yl=[];function u_(e,t){return!!t&&vl.some((i=>i.uid===e&&i.channelName===t))}function uU(){return yl.length>0}var jB=MC.forEach,GB=Zd("forEach")?[].forEach:function(e){return jB(this,e,arguments.length>1?arguments[1]:void 0)};dt({target:"Array",proto:!0,forced:[].forEach!==GB},{forEach:GB});var J4=Bn("Array","forEach"),Z4=Ms,Q4=Bi,$4=Be,hU=J4,pU=Array.prototype,eH={DOMTokenList:!0,NodeList:!0},tH=function(e){var t=e.forEach;return e===pU||$4(pU,e)&&t===pU.forEach||Q4(eH,Z4(e))?hU:t},iH=X(tH),WB=Pa,HB=iu;dt({target:"Object",stat:!0,forced:re((function(){HB(1)}))},{keys:function(e){return HB(WB(e))}});var rH=X(bn.Object.keys),nH=X(Xl),aH=X(gS),KB=dt,YB=vo,sH=Nh,zB=Ir,qB=X_,oH=Zs,cH=Js,dH=Jy,lH=ci,uH=aa,hH=$L("slice"),_U=lH("species"),fU=Array,pH=Math.max;KB({target:"Array",proto:!0,forced:!hH},{slice:function(e,t){var i,r,a,s=cH(this),o=oH(s),c=qB(e,o),d=qB(t===void 0?o:t,o);if(YB(s)&&(i=s.constructor,(sH(i)&&(i===fU||YB(i.prototype))||zB(i)&&(i=i[_U])===null)&&(i=void 0),i===fU||i===void 0))return uH(s,c,d);for(r=new(i===void 0?fU:i)(pH(d-c,0)),a=0;c<d;c++,a++)c in s&&dH(r,a,s[c]);return r.length=a,r}});var _H=Bn("Array","slice"),fH=Be,EU=_H,mU=Array.prototype,EH=function(e){var t=e.slice;return e===mU||fH(mU,e)&&t===mU.slice?EU:t},$e=X(EH);function Ze(e,t,i,r,a){var s,o,c,d={};return iH(s=rH(r)).call(s,(function(l){d[l]=r[l]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=nH(o=aH(c=$e(i).call(i)).call(c)).call(o,(function(l,h){return h(e,t,l)||l}),d),a&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(a):void 0,d.initializer=void 0),d.initializer===void 0?(XL(e,t,d),null):d}let uR=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),qc=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),gn=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e})({}),nt=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),He=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),et=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),Ne=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e})({}),Et=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),$t=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),Dt=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e})({}),_t=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),Pt=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e})({});function Dg(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw w.error("Invalid Channel Name ".concat(e)),new oe(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Cl(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||YT(e,1,255)))throw new oe(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&w.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let h_=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({});const gU={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Pb={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function SU(e,t){rn(e.url,"".concat(t,".url"),1,1e3,!1),Gr(e.x)||ji(e.x,"".concat(t,".x"),0,1e4),Gr(e.y)||ji(e.y,"".concat(t,".y"),0,1e4),Gr(e.width)||ji(e.width,"".concat(t,".width"),0,1e4),Gr(e.height)||ji(e.height,"".concat(t,".height"),0,1e4),Gr(e.zOrder)||ji(e.zOrder,"".concat(t,".zOrder"),0,255),Gr(e.alpha)||ji(e.alpha,"".concat(t,".alpha"),0,1,!1)}const lE={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Jh=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),Sn=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),Nn=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function As(e){if(!e.channelName)throw new oe(L.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new oe(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&rn(e.token,"info.token",1,2047),Cl(e.uid),Dg(e.channelName),!0}let Kn=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),oa=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),Ja=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),Ni=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),Vt=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),Vn=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e})({}),Dn=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),Lt=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),Di=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({});const Va=[Di.AFRICA,Di.ASIA,Di.CHINA,Di.EUROPE,Di.GLOBAL,Di.INDIA,Di.JAPAN,Di.NORTH_AMERICA,Di.OCEANIA,Di.OVERSEA,Di.SOUTH_AMERICA];let ca=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({});const uE={CHINA:{},ASIA:{CODE:ca.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ca.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ca.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ca.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ca.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ca.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ca.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ca.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ca.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ca.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ca.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ca.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ca.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};a_&&(uE.CHINA={CODE:ca.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let hR=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e})({});function TU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class RU extends or{constructor(t,i){super(),V(this,"onICEConnectionStateChange",void 0),V(this,"onConnectionStateChange",void 0),V(this,"onDTLSTransportStateChange",void 0),V(this,"onDTLSTransportError",void 0),V(this,"onICETransportStateChange",void 0),V(this,"onFirstAudioReceived",void 0),V(this,"onFirstVideoReceived",void 0),V(this,"onFirstAudioDecoded",void 0),V(this,"onFirstVideoDecoded",void 0),V(this,"onFirstVideoRender",void 0),V(this,"onFirstVideoDecodedTimeout",void 0),V(this,"onSelectedLocalCandidateChanged",void 0),V(this,"onSelectedRemoteCandidateChanged",void 0),V(this,"onICECandidateError",void 0),V(this,"getLocalVideoStats",void 0)}}class ze extends RU{constructor(t,i){super(t,i),V(this,"establishPromise",void 0)}}let Me=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),Tn=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),Zh=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({});const Ae=["disconnected","failed"];let Ee=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),Ue=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),it=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e})({}),ba=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Lr=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),$n=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),Ku=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),Fa=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),Aa=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Fo=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),kr=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Mr=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),Pd=(function(e){return e.ABORT="abort",e})({}),hE=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),mH=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({});const pR={[uR.ACCESS_POINT]:{[nt.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[nt.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[nt.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[nt.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[nt.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[nt.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[nt.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[uR.UNILBS]:{[gn.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[gn.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[gn.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[gn.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[gn.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[gn.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[gn.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[gn.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[gn.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[gn.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[gn.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[gn.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[uR.STRING_UID_ALLOCATOR]:{[qc.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[qc.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[qc.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function _R(e){const t=pR[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const i=t[e%1e4];if(!i){if(Math.floor(e/1e4)===uR.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Lb={[He.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[He.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[He.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[He.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[He.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[He.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[He.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[He.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[He.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[He.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[He.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[He.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[He.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[He.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[He.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[He.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[He.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[He.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[He.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[He.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[He.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[He.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[He.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[He.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[He.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[He.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[He.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[He.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[He.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[He.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[He.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[He.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[He.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[He.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[He.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[He.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[He.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[He.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[He.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[He.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[He.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[He.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[He.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[He.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[He.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[He.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[He.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[He.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[He.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[He.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[He.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[He.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[He.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[He.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[He.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[He.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[He.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[He.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[He.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[He.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[He.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[He.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[He.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[He.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function fR(e){return Lb[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function HO(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function kb(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?HO(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HO(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}function vU(e,t){if(typeof e=="string")return e;const{proxy:i,host:r,port:a}=e;if(t){const s=G("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(a)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(a)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(r,"&p=").concat(a):"wss://".concat(r,":").concat(a)}const gH=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,SH=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,TH=/wss:\/\/(.+):([0-9]+)\/?/,RH=/wss:\/\/(.[^\/]+)\/?/;let vH=0;class XB{constructor(t,i){V(this,"id",0),V(this,"store",void 0),V(this,"recordIndex",void 0),V(this,"websockets",[]),V(this,"try443PortDuration",2e3),V(this,"forceCloseWSDuration",5e3),V(this,"try443PortTimeout",null),V(this,"forceCloseTimeout",null),V(this,"isTry443PortFailed",!1),V(this,"isNormalPortFailed",!1),V(this,"useDoubleDomain",!1),V(this,"useProxy",!1),V(this,"startTime",Date.now()),this.id=++vH,this.try443PortDuration=G("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach((t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const i=Date.now()-this.startTime;for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];w.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...a)}createWebSocket(t,i,r){this.logger("createWebSocket:",t,{isTry443Port:i,hasTimeoutDetection:r});const a=G("GATEWAY_DOMAINS"),s=Date.now(),o=[],c=a.find((f=>{var m;return ee(m=t.host).call(m,f)}));c||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)a.forEach((f=>{d.push(vU(kb(kb({},t),{},{host:t.host.replace(c,f)}),i))}));else{const f=kb({},t);if(i&&c){const m=a.find((S=>S!==c));m&&(f.host=f.host.replace(c,m))}d.push(vU(f,i))}try{d.forEach((f=>{const m=new WebSocket(f);m.binaryType="arraybuffer",o.push(m),this.logger("ws is connecting:",m.url)}))}catch(f){if(this.logger("ws create failed"),o.forEach((m=>m.close())),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,i,r);if(!i&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new oe(L.WS_ERR,"init websocket failed! Error: ".concat(f.toString()))}const l=$f();this.store&&this.store.recordJoinChannelService({urls:o.map((f=>f.url)),service:"gateway"},this.recordIndex),o.forEach((f=>{f.onopen=()=>{this.logger("onopen: ws ".concat(f.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach((m=>{m!==f&&(m.onopen=null,m.onclose=null,m.onmessage=null,m.close(),this.logger("close backup websocket: ".concat(m.url)))})),this.websockets.length=0,l.resolve(f)},f.onclose=m=>{this.logger("onclose: ws ".concat(f.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(f.readyState));const S=o.every((T=>T.readyState===WebSocket.CLOSED||T.readyState===WebSocket.CLOSING));this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(S)),S&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(m.reason)),l.reject({code:m.code,reason:Dn.A_ROUND_WS_FAILED})):!i&&S&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),_()),i?this.isTry443PortFailed=S:this.isNormalPortFailed=S},f.onmessage=m=>this.logger("".concat(f.url," onmessage: ").concat(m.data))})),this.websockets.push(...o);const h=()=>{this.websockets.forEach((f=>f.readyState!==WebSocket.OPEN&&f.close()))},_=()=>{if(l.isResolved)return h();_i().os===Ot.MAC_OS&&Ci()&&h(),this.createWebSocket(t,!0,!0).then((f=>{l.resolve(f)})).catch((f=>{this.isNormalPortFailed&&l.reject(f),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",l.isResolved),this.forceCloseTimeout=null,h()}),this.forceCloseWSDuration)};return r||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,h()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",l.isResolved),this.try443PortTimeout=null,_()}),this.try443PortDuration)})(),l.promise}chooseBestWebsocket(t,i,r,a){return this.useDoubleDomain=!!i,typeof t=="string"&&(t=(function(s){let o,c,d;return[,o,c,d]=s.match(gH)||[],o||([,c,d]=s.match(SH)||[]),c&&d||([,c,d]=s.match(TH)||[]),c&&d||([,c]=s.match(RH)||[]),c||w.warning("un-destructible url: ",s),{proxy:o,host:c,port:d||"443"}})(t)),this.recordIndex=a,this.useProxy=!!t.proxy,r&&this.useProxy&&(w.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally((()=>this.clearTimeout()))}}function yU(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}class KO extends or{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var i;ee(i=["tryNext","recover"]).call(i,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Pt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Pt.CONNECTED):this._state==="closed"?this.emit(Pt.CLOSED):this._state==="failed"&&this.emit(Pt.FAILED))}resetReconnectCount(t){w.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,i){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),V(this,"_websocketUrl",null),V(this,"connectionID",0),V(this,"currentURLIndex",0),V(this,"urls",[]),V(this,"_reconnectMode","tryNext"),V(this,"reconnectReason",void 0),V(this,"_initMutex",void 0),V(this,"name",void 0),V(this,"_state","closed"),V(this,"reconnectInterrupter",void 0),V(this,"websocket",void 0),V(this,"retryConfig",void 0),V(this,"reconnectCount",0),V(this,"forceCloseTimeout",5e3),V(this,"onlineReconnectListener",void 0),V(this,"useCompress",void 0),V(this,"tryDoubleDomain",!1),V(this,"use443PortOnly",!1),V(this,"wsInflateLength",0),V(this,"wsDeflateLength",0),V(this,"closeEstablishingWs",(()=>{})),V(this,"store",void 0),V(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=t,this.retryConfig=(function(_){for(var f=1;f<arguments.length;f++){var m=arguments[f]!=null?arguments[f]:{};f%2?yU(Object(m),!0).forEach((function(S){V(_,S,m[S])})):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(m)):yU(Object(m)).forEach((function(S){Object.defineProperty(_,S,Object.getOwnPropertyDescriptor(m,S))}))}return _})({},i),this.useCompress=r,this.tryDoubleDomain=a,this.use443PortOnly=s,this._initMutex=new Wn("websocket",o?o.clientId:void 0);const{timeout:c,timeoutFactor:d}=i,l=Math.max(300,Math.floor(3*c/5)),h=Math.max(1.2,Math.floor(8*d)/10);cs.ONLINE&&(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=h),Zr.on(kn.NETWORK_STATE_CHANGE,((_,f)=>{_!==f&&(this.resetReconnectCount("network state change: ".concat(f," -> ").concat(_)),_===cs.ONLINE?(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=h):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=d))}))}getConnection(){return this.websocket||void 0}async init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=t,this.state="connecting";try{var a;const s=$f(),o=this.urls[this.currentURLIndex];(a=this.store)===null||a===void 0||a.beforeConnect(),(function(c){return!(iR()||G("USE_NEW_TOKEN")||!G("ENABLE_PREALLOC_PC")&&(c==null||!c.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(Ku.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(s.resolve).catch(s.reject),this.once(Pt.CLOSED,(()=>{s.reject(new _e(L.WS_DISCONNECT))})),this.once(Pt.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;i?setTimeout((()=>r.close()),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,i){if(!this.websocket)return void w.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),w.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:i})}sendMessage(t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new _e(L.WS_ABORT,"websocket is not ready");try{i||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new _e(L.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var i;const r=$f();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const a=h=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),w.debug("[".concat(this.name,"] websocket opened:"),h),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async h=>{var _;if(w.debug("[".concat(this.name,"] websocket close ").concat((_=this.websocket)===null||_===void 0?void 0:_.url,", code: ").concat(h.code,", reason: ").concat(h.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new _e(L.WS_DISCONNECT,"websocket close: ".concat(h.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=h.reason,this.state="reconnecting");const f=Bs(this,Pt.WILL_RECONNECT,this.reconnectMode,h.reason)||this.reconnectMode,m=await this.reconnectWithAction(f);if(this.state==="closed")return void w.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!m)return r.reject(new _e(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(h.code))),this.close(!0);r.resolve()}},o=h=>{this.emit(Pt.ON_MESSAGE,h)},c=h=>{w.warn("[".concat(this.connectionID,"] ws open error ").concat(h))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),G("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=G("GATEWAY_WSS_ADDRESS")),w.debug("[".concat(this.name,"] start connect, url:"),t);const d=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var l;this._websocketUrl=vU(t);const h=await this.chooseBestWebsocketConnection(t);this.websocket=h,a&&a(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=c,(l=this.store)===null||l===void 0||l.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(h){const _=this.state==="closed",f=h instanceof _e,m=f&&h.code===L.WS_ABORT,S=f&&h.code===L.WS_ERR,T=f?h.message:h&&(h.reason||h.toString());w.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(T)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:m?"aborted":"error",errors:[h]},d),_||S?(r.reject(_?new _e(L.WS_DISCONNECT,"websocket is closed: ".concat(T)):new _e(L.WS_ERR,"init websocket failed: ".concat(T))),S&&w.error("[".concat(this.name,"] init websocket failed: ").concat(T))):s&&s(h)}return r.promise}async reconnectWithAction(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;w.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Zr.isOnline||!Zr.onlineWaiter||(this.onlineReconnectListener=Zr.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let r=!0;if(this.reconnectInterrupter=()=>r=!1,i){const o=Od(this.reconnectCount,this.retryConfig);w.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(t)),await se.race([Ht(o),this.onlineReconnectListener||new se((()=>{}))])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const a=async(o,c)=>{this.emit(Pt.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(o)};try{if(t==="retry")await a(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);w.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await a(this.urls[this.currentURLIndex],t)}else t==="recover"&&(w.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await zt(this,Pt.REQUEST_NEW_URLS),this.currentURLIndex=0,await a(this.urls[this.currentURLIndex],t))}catch(o){var s;w.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const c=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(c)&&ee(c).call(c,"dynamic key expired")?(this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,i)}return!0}}class Pg extends KO{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){const r=$f(),a=(function(o,c){return new XB(o,c)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),a.closeAllWebsockets(),r.reject(new _e(L.WS_ABORT,"choose best websocket aborted"))};const s=G("GATEWAY_DOMAINS");return w.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),a.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,i).then(r.resolve).catch(r.reject),r.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class Mb extends KO{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){return new se(((r,a)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),o.forEach((S=>{S.onclose=null,S.onopen=null,S.onmessage=null,S.close()})),a(new _e(L.WS_ABORT,"choose best websocket aborted"))};const c=G("GATEWAY_DOMAINS");let d;const l=t.indexOf("?h="),h=c.find((S=>l!==-1?ee(t).call(t,S,l):ee(t).call(t,S)));w.debug("[choose-best-ws] currentDomain: ",h,", domains: ",c);let _=!this.tryDoubleDomain||!h;if(!_&&h){var f;const S=Date.now();try{c.forEach((T=>{const R=l===-1?t.replace(h,T):t.substr(0,l)+t.substr(l).replace(h,T),C=new WebSocket(R);C.binaryType="arraybuffer",o.push(C),w.debug("[choose-best-ws] ws is connecting:",C.url)}))}catch{for(w.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((R=>R.close()));o.length;)o.pop();_=!0}(f=this.store)===null||f===void 0||f.recordJoinChannelService({urls:o.map((T=>T.url)),service:"gateway"},i),o.forEach((T=>{T.onopen=()=>{if(s)return;const R=Date.now()-S;w.debug("[choose-best-ws] ws open cost ".concat(R,"ms")),o.filter((C=>C!==T)).forEach((C=>{w.debug("[choose-best-ws]close backup websocket: ".concat(C.url)),C.close()})),s=!0,r(T)},T.onclose=R=>{d=R,!s&&(o.find((C=>!(C.readyState===WebSocket.CLOSED||C.readyState===WebSocket.CLOSING)))||(w.debug("[choose-best-ws] all websocket is closed"),s=!0,a(d)))},T.onmessage=R=>{w.debug("[choose-best-ws]".concat(T.url," onmessage: ").concat(R.data))}})),Ht(this.forceCloseTimeout).then((()=>{o.forEach((T=>{T.readyState!==WebSocket.OPEN&&T.close()}))}))}if(_){var m;let S;w.debug("[choose-best-ws] use single url: ",t),(m=this.store)===null||m===void 0||m.recordJoinChannelService({urls:[t],service:"gateway"},i);try{S=new WebSocket(t),o.push(S),S.binaryType="arraybuffer"}catch(T){const R=new _e(L.WS_ERR,"init websocket failed! Error: ".concat(T.toString()));return w.error("[".concat(this.name,"]").concat(R)),void a(R)}S.onopen=()=>{r(S)},S.onclose=T=>{a(T)},S.onmessage=T=>{w.debug("[choose-best-ws]".concat(S.url," onmessage: ").concat(T.data))},Ht(this.forceCloseTimeout).then((()=>{S&&S.readyState!==WebSocket.OPEN&&S.close()}))}})).then((r=>(this.closeEstablishingWs=void 0,r))).catch((r=>{throw this.closeEstablishingWs=void 0,r}))}}class yH extends or{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===et.CONNECTED?this.emit(Ne.WS_CONNECTED):t===et.RECONNECTING?this.emit(Ne.WS_RECONNECTING,this._websocketReconnectReason):t===et.CLOSED&&this.emit(Ne.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",et.CLOSED),V(this,"reconnectToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new hb(5)),V(this,"pingpongTimer",void 0),V(this,"wsInflateDataTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"ortc",void 0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"onWebsocketMessage",(r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Ne.ON_BINARY_DATA,r.data);const a=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const s="res-@".concat(a._id);this.emit(s,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){if(this.emit(a._type,a._message),a._type===Dt.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===Dt.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(Oi.UID_BANNED);break;case 15:this.close(Oi.IP_BANNED);break;case 16:this.close(Oi.CHANNEL_BANNED)}if(a._type===Dt.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case He.ERR_LICENSE_MISSING:this.close(Oi.LICENSE_MISSING);break;case He.ERR_LICENSE_EXPIRED:this.close(Oi.LICENSE_EXPIRED);break;case He.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Oi.LICENSE_MINUTES_EXCEEDED);break;case He.ERR_LICENSE_PERIOD_INVALID:this.close(Oi.LICENSE_PERIOD_INVALID);break;case He.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Oi.LICENSE_MULTIPLE_SDK_SERVICE);break;case He.ERR_LICENSE_ILLEGAL:this.close(Oi.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new Pg("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===et.CONNECTED&&this.reconnect("retry",Rr.OFFLINE)}))}async request(t,i,r,a){const s=Mi(6,""),o={_id:s,_type:t,_message:i},c=this.websocket.connectionID,d=()=>new se(((S,T)=>{if(this.connectionState===et.CONNECTED)return S();const R=()=>{this.off(Ne.WS_CLOSED,C),S()},C=()=>{this.off(Ne.WS_CONNECTED,R),T(new oe(L.WS_ABORT))};this.once(Ne.WS_CONNECTED,R),this.once(Ne.WS_CLOSED,C),t!==Et.PUBLISH&&t!==Et.PUBLISH_DATASTREAM&&t!==Et.SUBSCRIBE&&t!==Et.SUBSCRIBE_DATASTREAM&&t!==Et.UNSUBSCRIBE&&t!==Et.UNSUBSCRIBE_DATASTREAM&&t!==Et.UNPUBLISH&&t!==Et.UNPUBLISH_DATASTREAM&&t!==Et.CONTROL&&t!==Et.RESTART_ICE||this.once(Ne.DISCONNECT_P2P,(()=>{T(new oe(L.DISCONNECT_P2P))})),t!==Et.PUBLISH&&t!==Et.RESTART_ICE||this.once(Ne.ABORT_P2P_EXECUTION,(()=>{T(new oe(L.DISCONNECT_P2P))}))}));if(this.connectionState!==et.CONNECTING&&this.connectionState!==et.RECONNECTING||t===Et.JOIN||t===Et.REJOIN||await d(),this.websocket.sendMessage(o,!0),a)return;const l=new se(((S,T)=>{let R=!1;const C=(N,k)=>{R=!0,S({isSuccess:N==="success",message:k||{}}),this.off(Ne.WS_CLOSED,b),this.off(Ne.WS_RECONNECTING,b),this.emit(Ne.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(s),C);const b=()=>{T(new oe(L.WS_ABORT,"type: ".concat(t))),this.off(Ne.WS_CLOSED,b),this.off(Ne.WS_RECONNECTING,b),this.off("res-@".concat(s),C)};this.once(Ne.WS_CLOSED,b),this.once(Ne.WS_RECONNECTING,b),Ht(G("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==c||R||(w.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ne.REQUEST_TIMEOUT,t,i))}))}));let h=null;try{h=await l}catch(S){if(this.connectionState===et.CLOSED||t===Et.LEAVE)throw new oe(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?S.throw():t===Et.JOIN||t===Et.REJOIN?null:(await d(),await this.request(t,i))}if(h.isSuccess)return h.message;const _=Number(h.message.error_code||h.message.code),f=fR(_),m=new oe(L.UNEXPECTED_RESPONSE,"".concat(f.desc,": ").concat(h.message.error_str),{code:_,data:h.message,desc:f.desc});return f.action==="success"?h.message:(w.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(f.desc,", action: ").concat(f.action)),_===He.ERR_TOO_MANY_BROADCASTERS?((t===Et.JOIN||t===Et.REJOIN)&&(this.initError=m,this.close()),m.throw()):f.action==="failed"?m.throw():f.action==="quit"?(this.initError=m,this.close(),m.throw()):(_===He.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Rr.MULTI_IP)):this.reconnect(f.action,Rr.SERVER_ERROR),t===Et.JOIN||t===Et.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new se((r=>{const a=s=>{(!i||i(s))&&(this.off(t,a),r(s))};this.on(t,a)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload($t.WRTC_STATS,i)}upload(t,i){const r={_type:t,_message:i};try{this.websocket.sendMessage(r)}catch{const s=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==et.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)}),G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){const r={_type:t,_message:i};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new se(((i,r)=>{this.once(Ne.WS_CONNECTED,(()=>i(this.joinResponse))),this.once(Ne.WS_CLOSED,(a=>r(this.initError||new oe(L.WS_ABORT,a)))),this.connectionState=et.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Oi.LEAVE,this.connectionState=et.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Ne.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await zt(this,Ne.REQUEST_JOIN_INFO);this.store.joinReq();const i=await this.request(Et.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!i)return this.emit(Ne.REPORT_JOIN_GATEWAY,Dn.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Ne.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=et.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new oe(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Kr(this,Ne.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const i=await this.request(Et.REJOIN,t);return!!i&&(this.connectionState=et.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach((r=>{this.emit(Dt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Dt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Dt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Dt.MUTE_AUDIO,{uid:r.uid}):this.emit(Dt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Dt.MUTE_VIDEO,{uid:r.uid}):this.emit(Dt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Dt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Dt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Dt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Dt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Dt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})})),!0)}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}async downgradeCodec(t){if(!this.ortc)return!1;const i={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Et.DOWNGRADE_CODEC,i)}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const i=fR(t.code);if(t.code===28&&"detail"in t&&(w.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Ne.RECOVER_NOTIFICATION,t.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Oi.UID_BANNED),void this.close()):void this.reconnect(i.action,Rr.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=G("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Rr.TIMEOUT):this.request(Et.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const r=Date.now()-i;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Et.PING_BACK,{pingpongElapse:r})})).catch((r=>{}))}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:i}=this.websocket.getWsInflateData();t!==0&&i!==0&&this.upload($t.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Pt.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(Ne.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(Pt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Pt.CLOSED,(()=>{this.connectionState=et.CLOSED})),this.websocket.on(Pt.FAILED,(()=>{this._disconnectedReason=Oi.NETWORK_ERROR,this.connectionState=et.CLOSED})),this.websocket.on(Pt.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===et.CONNECTED?this.connectionState=et.RECONNECTING:this.connectionState=et.CONNECTING})),this.websocket.on(Pt.WILL_RECONNECT,((t,i,r)=>{const a=Kr(this,Ne.IS_P2P_DISCONNECTED),s=a||t!=="retry";a&&t==="retry"&&(w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",i=Dn.P2P_DISCONNECTED),s&&(w.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Ne.REPORT_JOIN_GATEWAY,i||Dn.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ne.DISCONNECT_P2P)),r(t)})),this.websocket.on(Pt.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Rr.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(Ne.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof oe){if(t.code===L.UNEXPECTED_RESPONSE&&t.data.code===He.ERR_NO_AUTHORIZED)return this.initError=new oe(L.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Oi.TOKEN_EXPIRE);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Rr.SERVER_ERROR):(this.initError=t,this.close())}}))})),this.websocket.on(Pt.REQUEST_NEW_URLS,((t,i)=>{zt(this,Ne.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)})),this.websocket.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(Ku.PRE_CONNECT_PC,(()=>{this.emit(Ne.PRE_CONNECT_PC)}))}}let Rn=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),hn=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function Ub(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Yu(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Ub(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ub(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}function zu(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(G("TURN_DOMAIN")):(w.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function ER(e){try{const t=G("GATEWAY_DOMAINS").concat(G("TURN_DOMAIN")).find((i=>ee(e).call(e,i)));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return w.debug("serverUrlToIp error, fallback to url",e),e}}function po(e,t){e.addresses||(e.addresses=[]);const i=(function(c,d){if(G("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map((_=>{let{ip:f,port:m}=_;return{address:"".concat(f,":").concat(m)}}));const l=G("GATEWAY_DOMAINS");let h=l[1]&&ee(d).call(d,l[1])?1:0;return c.map((_=>{let{domain_prefix:f,port:m,ip:S}=_;if(f)return{address:"".concat(f,".").concat(l[h++%l.length],":").concat(m)};const T=/^[\.\:\d]+$/.test(S),R=T?"".concat(S.replace(/[^\d]/g,"-"),".").concat(l[h++%l.length],":").concat(m):"".concat(S,":").concat(m);return T||w.debug("Cannot recognized as ip address: ".concat(S,", use as host3")),{ip:S,port:m,address:R}}))})(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const c=r.split(";");for(let d=0;d<c.length;d++){var a;const l=hr(a=c[d]).call(a);i[d]&&l&&(i[d].ip6=l)}}const s=e.detail&&e.detail.candidate;let o;if(s){const[c,d]=s.split(":");c&&d&&(o={port:Number(d),ip:c,address:"".concat(c,":").concat(d)})}return{gatewayAddrs:i,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Bo(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function CU(e){const t=e._encoderConfig;if(!t)return{};const i={resolution:t.width&&t.height?"".concat(Bo(t.width),"x").concat(Bo(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(i.maxFrameRate=t.frameRate,i.minFrameRate=t.frameRate):t.frameRate&&(i.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,i.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),i}function mR(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function gR(e,t){let i,r,a;switch(t){case hn.CHOOSE_SERVER:r=4096,a="choose server";break;case hn.CLOUD_PROXY:r=1048576,a="proxy";break;case hn.CLOUD_PROXY_5:r=4194304,a="proxy5";break;case hn.CLOUD_PROXY_FALLBACK:r=4194310,a="proxy fallback";break;default:throw new oe(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((s=>{s.buffer&&s.buffer.flag===r&&(i={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map((o=>Yu(Yu({},o),{},{ticket:s.buffer.cert}))),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:Yu(Yu({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})})),!i)throw new oe(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(a," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function YO(e,t){return await se.all(e.addresses.map((async i=>({address:zu(i.ip),tcpport:i.port,udpport:i.port,username:t&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Qn.username,password:t&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Sr(t.toString()):Qn.password}))))}function Qh(e,t){const i=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||i.height,a=t.videoWidth||i.width;return r&&a?Math.max(Math.min(r,a)/Math.min(Bo(e.height),Bo(e.width)),1):(w.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Xc(e){let{candidateType:t,relayProtocol:i,type:r,address:a,port:s,protocol:o}=e;const c={candidateType:t,relayProtocol:i,protocol:o};if(r!=="local-candidate"){const d=a.split(".");d.length>=4&&(d[1]="*",d[2]="*"),c.address=d.join("."),c.port=s}return c}function $h(e){const t=e.split(":"),i=e.split(/[-.]/),r=ee(e).call(e,"-")?"-":".";let a=e;return t.length>1?i.length>1?(i[1]="**",a=i[0]+r+"**:"+t[t.length-1]):a=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:i.length>1&&(a=i[0]+r+"**"),a}function xb(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G("SVC_MODE");if(G("ENABLE_SVC"))return(function(t){return t in ZT})(e)?e:ZT.L1T3}const Vb={[Me.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Me.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function p_(e,t,i){t.forEach((r=>{var a;const s=Vb[e].find((c=>{var d;let{key:l}=c;return ee(d=r.extensionName).call(d,l)}));if(!s)return;const o=i.find((c=>{let{extensionName:d}=c;return ee(d).call(d,s.key)}));o&&ee(a=o.extensionName).call(a,"gdpr_forbidden")&&(r.extensionName=o.extensionName)}))}function Lg(e,t){t.forEach((i=>{var r;const a=Vb[e].find((s=>{var o;let{key:c}=s;return ee(o=i.extensionName).call(o,c)}));ee(r=i.extensionName).call(r,"gdpr_forbidden")&&a&&(i.extensionName=a.extensionName)}))}function Fb(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ee(e).call(e,"abs-send-time")}function Bb(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ee(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function bU(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function SR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?bU(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):bU(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}function bl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:a,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:c,filterVideoCodec:d,unsupportedVideoUplinkCodec:l,unsupportedVideoDownlinkCodec:h}=t,{useXR:_}=i;let f=[],m=[],S=[],T=[],R=!1,C=!1;if(ya(e).mediaDescriptions.forEach((N=>{r&&r!==N.attributes.direction||(N.media.mediaType!=="video"||R||(m=N.attributes.payloads,T=N.attributes.extmaps,R=!0),N.media.mediaType!=="audio"||C||(f=N.attributes.payloads,S=N.attributes.extmaps,C=!0))})),!T||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!S||f.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(m.forEach((N=>{var k;(k=N.rtpMap)!==null&&k!==void 0&&k.clockRate&&(N.rtpMap.clockRate=parseInt(N.rtpMap.clockRate)),_&&N.rtcpFeedbacks.push({type:"rrtr"})})),f.forEach((N=>{var k;(k=N.rtpMap)!==null&&k!==void 0&&k.clockRate&&(N.rtpMap.clockRate=parseInt(N.rtpMap.clockRate)),_&&N.rtcpFeedbacks.push({type:"rrtr"})})),a&&(f=f.filter((N=>{var k;return((k=N.rtpMap)===null||k===void 0?void 0:k.encodingName.toLowerCase())!=="rtx"})),m=m.filter((N=>{var k;return((k=N.rtpMap)===null||k===void 0?void 0:k.encodingName.toLowerCase())!=="rtx"}))),s){const N=m.filter((U=>{var W;return/(red)|(ulpfec)|(flexfec)/i.test(((W=U.rtpMap)===null||W===void 0?void 0:W.encodingName)||"")})),k=mc(N,m).map((U=>U.payloadType)),P=[...N.map((U=>U.payloadType)),...k];m=m.filter((U=>!ee(P).call(P,U.payloadType)))}if(o&&(f=f.filter((N=>{var k;return!/(red)|(ulpfec)|(flexfec)/i.test(((k=N.rtpMap)===null||k===void 0?void 0:k.encodingName)||"")}))),c&&c?.length>0&&(f=f.filter((N=>{var k;return ee(c).call(c,((k=N.rtpMap)===null||k===void 0?void 0:k.encodingName.toLowerCase())||"")}))),d&&d?.length>0){const N=m.filter((k=>{var P;return ee(d).call(d,((P=k.rtpMap)===null||P===void 0?void 0:P.encodingName.toLowerCase())||"")}));m=N.concat(a?[]:mc(N,m))}const b=G("UNSUPPORTED_VIDEO_CODEC");if(b&&b.length>0){const N=m.filter((U=>U.rtpMap&&ee(b).call(b,U.rtpMap.encodingName.toLowerCase()))),k=mc(N,m),P=N.concat(k).map((U=>U.payloadType));m=m.filter((U=>!ee(P).call(P,U.payloadType))),w.debug("unsupportedVideoCodec: ".concat(b,", toBeRemoved: ").concat(P))}if(l&&l.length>0&&r==="sendonly"){const N=m.filter((U=>U.rtpMap&&ee(l).call(l,U.rtpMap.encodingName.toLowerCase()))),k=mc(N,m),P=N.concat(k).map((U=>U.payloadType));m=m.filter((U=>!ee(P).call(P,U.payloadType))),w.debug("unsupportedVideoUplinkCodec: ".concat(l,", toBeRemoved: ").concat(P))}if(h&&h.length>0&&r==="recvonly"){const N=m.filter((U=>U.rtpMap&&ee(h).call(h,U.rtpMap.encodingName.toLowerCase()))),k=mc(N,m),P=N.concat(k).map((U=>U.payloadType));m=m.filter((U=>!ee(P).call(P,U.payloadType))),w.debug("unsupportedVideoDownlinkCodec: ".concat(h,", toBeRemoved: ").concat(P))}return{audioCodecs:f,videoCodecs:m,audioExtensions:S,videoExtensions:T}}function __(e){const t=ya(e);let i,r;for(const a of t.mediaDescriptions){if(!i){const s=a.attributes.iceUfrag,o=a.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:s,icePwd:o}}if(!r){const s=a.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:r}}function AU(e,t){const i=[],r=e.attributes.ssrcGroups.filter((o=>o.semantic==="FID")),a=e.attributes.ssrcGroups.find((o=>o.semantic==="SIM")),s=e.attributes.ssrcs;if(a)a.ssrcIds.forEach((o=>{var c;const d=(c=r.find((l=>l.ssrcIds[0]===o)))===null||c===void 0?void 0:c.ssrcIds[1];i.push({ssrcId:o,rtx:t?d:void 0})}));else if(r.length>0){const o=r[0].ssrcIds[0],c=r[0].ssrcIds[1];i.push({ssrcId:o,rtx:t?c:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:s[0].ssrcId})}return i}function IU(e,t,i){const{cname:r}=e;let a=[];t&&(a=TR(t)),a.length===0&&(a=e.iceParameters.candidates.map((h=>({foundation:h.foundation,componentId:"1",transport:h.protocol,priority:h.priority.toString(),connectionAddress:h.ip,port:h.port.toString(),type:h.type,extension:{}}))),w.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map((h=>({hashFunction:h.algorithm,fingerprint:h.fingerprint})))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}const d=f_(e.rtpCapabilities),l=[];return Array.isArray(i)&&i.length>0&&i.forEach((h=>{l.push({kind:Me.VIDEO,ssrcMsg:[{ssrcId:h.v,rtx:h.v_rtx}],mslabel:"".concat(h.v,"_").concat(h.a)},{kind:Me.AUDIO,ssrcMsg:[{ssrcId:h.a}],mslabel:"".concat(h.v,"_").concat(h.a)})})),{dtlsParameters:s,iceParameters:o,candidates:a,rtpCapabilities:d,setup:c,cname:r,preSSRCs:l}}function TR(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat($h(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat($h(e.ip6),":").concat(e.port)))),t}function ep(e,t,i){const r=[],a=[];return e.forEach((s=>{let{ssrcId:o,rtx:c}=s;const d=Mi(8,"track-"),l={ssrcId:o,attributes:SR({label:d,mslabel:i=i||Mi(10,""),msid:"".concat(i," ").concat(d)},t&&{cname:t})};if(r.push(l),c!==void 0){const h={ssrcId:c,attributes:SR({label:d,mslabel:i,msid:"".concat(i," ").concat(d)},t&&{cname:t})};r.push(h),a.push({semantic:"FID",ssrcIds:[o,c]})}})),e.length>1&&a.push({semantic:"SIM",ssrcIds:e.map((s=>{let{ssrcId:o}=s;return o}))}),{ssrcs:r,ssrcGroups:a}}function pE(e,t){t instanceof yr&&e.attributes.payloads.forEach((i=>{var r;const a=(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!a||["opus","pcmu","pcma","g722"].indexOf(a)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),a==="opus"&&typeof G("OPUS_PTIME")=="number"?i.fmtp.parameters.ptime=G("OPUS_PTIME"):i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&(a!=="pcmu"&&a!=="pcma"&&a!=="g722"&&(s.bitrate&&!Ci()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1")),t instanceof vb&&a==="opus"&&t._config.DTX&&(i.fmtp.parameters.usedtx="1"))}))}function jb(e){const t=e.attributes.unrecognized.findIndex((i=>i.attField==="x-google-flag"&&i.attValue==="conference"));t!==-1&&e.attributes.unrecognized.splice(t,1)}function zO(e,t){var i;if(!(t instanceof Xi&&t._encoderConfig&&t._hints.indexOf(Ui.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Si().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((a=>{var s,o;ee(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=a.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),Si().supportMinBitrate&&!ee(i=t._hints).call(i,Ui.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((a=>{var s,o;ee(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=a.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-start-bitrate"]="".concat(G("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function Gb(e){if(e.media.mediaType!=="video")return;const t=_i();if(t.name!==bi.SAFARI&&t.os!==Ot.IOS)return;const i=e.attributes.extmaps.findIndex((r=>/video-orientation/g.test(r.extensionName)));i!==-1&&e.attributes.extmaps.splice(i,1)}function Wb(e,t,i){if(!t)return;let r,a;if(e.media.mediaType==="video"?(r=i.videoExtensions,a=i.videoCodecs):(r=i.audioExtensions,a=i.audioCodecs),t.twcc===!0){const s=r.find((o=>Bb(o.extensionName)));if(s){const o=s.extensionName;e.attributes.extmaps.find((d=>Bb(d.extensionName)))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),(function(d,l){return l.filter((h=>!!d.find((_=>_.payloadType===h.payloadType&&!!_.rtcpFeedbacks.find((f=>f.type==="transport-cc"))))))})(a,e.attributes.payloads).forEach((d=>{d.rtcpFeedbacks.find((l=>l.type==="transport-cc"))||d.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex((o=>Bb(o.extensionName)));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach((o=>{const c=o.rtcpFeedbacks.findIndex((d=>d.type==="transport-cc"));c!==-1&&o.rtcpFeedbacks.splice(c,1)}))}if(t.remb===!0){const s=r.find((o=>Fb(o.extensionName)));if(s){const o=s.extensionName;e.attributes.extmaps.find((d=>d.extensionName===o))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),(function(d,l){return l.filter((h=>!!d.find((_=>_.payloadType===h.payloadType&&!!_.rtcpFeedbacks.find((f=>f.type==="goog-remb"))))))})(a,e.attributes.payloads).forEach((d=>{d.rtcpFeedbacks.find((l=>l.type==="goog-remb"))||d.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex((o=>Fb(o.extensionName)));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach((o=>{const c=o.rtcpFeedbacks.findIndex((d=>d.type==="goog-remb"));c!==-1&&o.rtcpFeedbacks.splice(c,1)}))}}function wU(e,t,i){if(Ci()||e.media.mediaType!=="video"||!(t instanceof Xi)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!G("SIMULCAST")||i==="vp9"&&G("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=i==="vp8"?2:t._scalabilityMode.numSpatialLayers,a=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find((c=>c.semantic==="FID"&&c.ssrcIds[0]===a.ssrcId)),o={semantic:"SIM",ssrcIds:[a.ssrcId]};for(let c=1;c<r;c++)e.attributes.ssrcs.push({ssrcId:a.ssrcId+c,attributes:qi(a.attributes)}),o.ssrcIds.push(a.ssrcId+c),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+c,attributes:qi(a.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[a.ssrcId+c,s.ssrcIds[1]+c]}));e.attributes.ssrcGroups.unshift(o)}async function OU(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const r=(await i.createOffer()).sdp,{send:a,recv:s,sendrecv:o}=(function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const h=bl(l,c,d,"sendonly"),_=bl(l,c,d,"recvonly"),f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ec(h,_,"videoExtensions",f,m,S),Ec(h,_,"videoCodecs",f,m,S),Ec(h,_,"audioExtensions",f,m,S),Ec(h,_,"audioCodecs",f,m,S),G("RAISE_H264_BASELINE_PRIORITY")){const T=[],R=[];if(S.videoCodecs.forEach(((C,b)=>{var N;if(((N=C.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"){var k,P;const U=S.videoCodecs[b+1],W=U&&LU(C,U),z=(k=C.fmtp)===null||k===void 0?void 0:k.parameters["profile-level-id"],Q=(P=C.fmtp)===null||P===void 0?void 0:P.parameters["packetization-mode"];!z||z!==G("FIRST_H264_PROFILE_LEVEL_ID")||G("FIRST_PACKETIZATION_MODE")&&Q!==G("FIRST_PACKETIZATION_MODE")?W?R.push([C,U]):R.push([C]):W?T.push([C,U]):T.push([C])}})),T.length>0&&R.length>0){w.debug("raising H264 baseline profile priority"),S.videoCodecs.forEach(((b,N)=>{var k;if(((k=b.rtpMap)===null||k===void 0?void 0:k.encodingName.toLocaleLowerCase())==="h264"){const P=LU(b,S.videoCodecs[N+1]),U=T.shift()||R.shift()||[];U.length>0&&(P?S.videoCodecs.splice(N,2,...U):S.videoCodecs.splice(N,1,...U))}}));const C=m.videoCodecs.filter((b=>{var N,k;return((N=b.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((k=b.fmtp)===null||k===void 0?void 0:k.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID")}));if(C.length>0){const b=mc(C,m.videoCodecs).map((k=>k.payloadType)),N=[...C.map((k=>k.payloadType)),...b];m.videoCodecs=m.videoCodecs.filter((k=>!ee(N).call(N,k.payloadType)))}G("FILTER_SEND_H264_BASELINE")&&(f.videoCodecs=f.videoCodecs.filter((b=>{var N,k;return!(((N=b.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((k=b.fmtp)===null||k===void 0?void 0:k.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:f,recv:m,sendrecv:S}}return{send:f,recv:m,sendrecv:S}})(e,t,r);try{i.close()}catch{}return{send:a,recv:s,sendrecv:o}}function Ld(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=bl(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ec(e,t,"videoExtensions",i,r,a),Ec(e,t,"videoCodecs",i,r,a),Ec(e,t,"audioExtensions",i,r,a),Ec(e,t,"audioCodecs",i,r,a),G("RAISE_H264_BASELINE_PRIORITY")){const s=a.videoCodecs.findIndex((o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f"));if(s!==-1){const o=a.videoCodecs.findIndex((c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(o<s){w.debug("raising H264 baseline profile priority");const c=a.videoCodecs[s];a.videoCodecs.splice(s,1),a.videoCodecs.splice(o,0,c)}o!==-1&&(r.videoCodecs=r.videoCodecs.filter((c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:i,recv:r,sendrecv:a}}function Ec(e,t,i,r,a,s){if(i==="videoExtensions"||i==="audioExtensions"){const o=[];return e[i].forEach((c=>{t[i].some(((d,l)=>{if(c.entry===d.entry&&c.extensionName===d.extensionName)return o.push(l),!0}))?s[i].push(c):r[i].push(c)})),void t[i].forEach(((c,d)=>{o.indexOf(d)===-1&&a[i].push(c)}))}if(i==="videoCodecs"||i==="audioCodecs"){const o=[];return e[i].forEach((c=>{t[i].some(((d,l)=>{if(c.payloadType===d.payloadType&&JSON.stringify(c)===JSON.stringify(d))return o.push(l),!0}))?s[i].push(c):r[i].push(c)})),void t[i].forEach(((c,d)=>{o.indexOf(d)===-1&&a[i].push(c)}))}}function f_(e){const{send:t,recv:i,sendrecv:r}=e;if(!r){if(!t||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:i}}let a,s;return t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...r.audioCodecs],a.videoCodecs=[...t.videoCodecs,...r.videoCodecs],a.audioExtensions=[...t.audioExtensions,...r.audioExtensions],a.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):a=r,i?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...i.audioCodecs,...r.audioCodecs],s.videoCodecs=[...i.videoCodecs,...r.videoCodecs],s.audioExtensions=[...i.audioExtensions,...r.audioExtensions],s.videoExtensions=[...i.videoExtensions,...r.videoExtensions]):s=r,{send:a,recv:s}}function tp(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter((t=>{var i;return((i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"})).forEach((t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"}))}function Al(e,t,i,r){let a=[];if(e===Me.VIDEO){if(G("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(a=t.videoCodecs.filter((s=>{var o;return ee(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===G("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(a)||a.length===0){let s=[];const o=[],c=[],d=[];if(i.videoCodecs.forEach((l=>{const h=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"";ee(h).call(h,r)?s.push(l):ee(h).call(h,"vp9")?o.push(l):ee(h).call(h,"vp8")?c.push(l):ee(h).call(h,"h264")&&d.push(l)})),s.length===0){let l="";o.length!==0?(s=o,l="vp9"):c.length!==0?(s=c,l="vp8"):d.length!==0&&(s=d,l="h264"),w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(l))}s.length!==0&&(a=t.videoCodecs.filter((l=>s.some((h=>h.payloadType===l.payloadType)))))}if(a.length===0&&(w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),a=t.videoCodecs),G("USE_PUB_RTX")||G("USE_SUB_RTX")){const s=mc(a,t.videoCodecs);a=[...a,...s]}}else{a=t.audioCodecs.filter((o=>{var c;return ee(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,r)}));const s=t.audioCodecs.filter((o=>{var c;return ee(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"red")}));a.length===0&&(w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),a=t.audioCodecs.filter((o=>{var c;return ee(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}))),G("ENABLE_AUDIO_RED")&&s.length!==0&&(a=[...s,...a])}return a}function mc(e,t){const i=e.map((r=>r.payloadType.toString()));return t.filter((r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&ee(i).call(i,r.fmtp&&r.fmtp.parameters.apt)))}async function E_(e,t,i){const r=t.toString(),a=DU(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=NU(o,i||{}),a?.(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function NU(e,t,i){const r=ya(e),{useXR:a}=t;return r.mediaDescriptions.forEach((s=>{var o;s.attributes.mid&&(Array.isArray(i)&&!ee(i).call(i,s.attributes.mid)||(s.media.mediaType==="audio"&&tp(s),a&&ee(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach((c=>{c.rtcpFeedbacks.findIndex((d=>d.type==="rrtr"))===-1&&c.rtcpFeedbacks.push({type:"rrtr"})}))))})),aE(r)}function DU(e,t,i,r){if(G("SDP_LOGGING"))return w.upload("exchanging ".concat(i," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?a=>{DU(a,"answer",i==="local"?"remote":"local",r)}:void 0}function PU(e){const t=G("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((i=>ee(e).call(e,i)))}function LU(e,t){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===t.payloadType.toString()}catch{return!1}}function gc(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Jc(e,t){return typeof G(e)===t?G(e):void 0}function JB(){try{const e=G("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gc(Object(r),!0).forEach((function(a){V(t,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gc(Object(r)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))}))}return t})({},e)}catch(e){return w.debug("handle gateway attributes failed: ",e),{}}}const m_={};function jo(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&w.debug("install service ".concat(e.name)),m_[e.name]=e}function ip(e){const t=m_[e];if(!t)throw new _e(L.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function Hb(e,t){return ip("DataStream").create(e,t)}function Kb(){return ip("InterceptFrame").create()}function Za(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Ba(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Za(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Za(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}const kU=new Map;class qO extends or{get state(){return this._state}set state(t){if(t===this._state)return;const i=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Vn.CONNECTION_STATE_CHANGE,t,i,this._disconnectedReason):this.emit(Vn.CONNECTION_STATE_CHANGE,t,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){w.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,i){var r,a,s;super(),V(this,"store",void 0),V(this,"joinInfo",void 0),V(this,"key",void 0),V(this,"ntpOffset",0),V(this,"signal",void 0),V(this,"role",void 0),V(this,"isPreallocation",void 0),V(this,"isPreSub",void 0),V(this,"inChannelInfo",{joinAt:null,duration:0}),V(this,"spec",void 0),V(this,"_state","DISCONNECTED"),V(this,"_statsCollector",void 0),V(this,"_disconnectedReason",void 0),V(this,"isSignalRecover",!1),V(this,"hasChangeBGPAddress",!1),V(this,"trafficStatsInterval",void 0),V(this,"networkQualityInterval",void 0),V(this,"_joinGatewayStartTime",0),V(this,"_signalTimeout",!1),V(this,"_clientRoleOptions",void 0),V(this,"_isProactiveJoin",!1),this.store=t,this.spec=i,this.signal=this.store.useP2P?(r={spec:Ba(Ba({},i),{},{retryConfig:i.websocketRetryConfig}),store:t},(a=(s=ip("P2PChannel")).createSubmodule)===null||a===void 0?void 0:a.call(s,r)):new yH(Ba(Ba({},i),{},{retryConfig:i.websocketRetryConfig}),t),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(t,i,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const a=Date.now();let s=kU.get(t.cname);if(s||(s=new Map,kU.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const l=new oe(L.UID_CONFLICT);throw J.joinGateway(t.sid,{lts:a,succ:!1,ec:l.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),l}s.set(t.uid,!0),this.joinInfo=t,this.key=i;let o=0;this.joinGatewayStartTime=a;const c=t.proxyServer;try{w.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const l=t.gatewayAddrs.map((h=>{let{address:_}=h;const[f,m]=_.split(":"),S={host:f,port:m};return t.proxyServer&&(S.proxy=t.proxyServer),S}));o=(await this.signal.init(l)).uid,w.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(l){var d;throw w.error("[".concat(this.store.clientId,"] User join failed"),l.toString()),J.joinGateway(t.sid,{lts:a,succ:!1,ec:((d=l.data)===null||d===void 0?void 0:d.desc)||l.code,errorMsg:l.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),l}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),w.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((l=>{w.warning("[".concat(this.store.clientId,"] get traffic stats error"),l.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Vn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Vn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Vn.NETWORK_QUALITY,{uplinkNetworkQuality:mR(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:mR(this._statsCollector.trafficStats.B_dnq)}):this.emit(Vn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Oi.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==et.CONNECTED||await(function(r,a){return a===1/0?r:se.race([r,va(a)])})(this.signal.request(Et.LEAVE,void 0,!0),3e3)}catch(r){w.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(i),i!==Oi.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:G("PUB_EXTEND"),twcc:!!G("PUBLISH_TWCC"),rtx:!!G("USE_PUB_RTX")};try{return(await this.signal.request(Et.PUBLISH,a,!0))._message}catch(s){if(r&&s.data&&s.data.code===He.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,i),this.publish(t,i,!1);throw s}}async publishDataChannel(t,i,r){var a;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(a=i.maxRetransmits)!==null&&a!==void 0?a:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Et.PUBLISH_DATASTREAM,s,!0)}catch(o){if(r&&o.data&&o.data.code===He.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(t,i),this.publishDataChannel(t,i,!1);throw o}}async unpublish(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Et.UNPUBLISH,{stream_id:i,ortc:t},!0)}catch(r){w.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await se.all(t.map((i=>this.signal.request(Et.UNPUBLISH_DATASTREAM,{channel_id:i},!0))))}catch(i){w.warning("unpublish datachannels warning: ",i)}}async presubscribe(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const a={stream_id:t,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX")||void 0,extend:G("SUB_EXTEND"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Et.PRE_SUBSCRIBE,a,!0)}catch(s){if(r&&s.data&&s.data.code===He.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,i,!1);throw s}}async subscribe(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const a={stream_id:t,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX"),extend:G("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return(await this.signal.request(Et.SUBSCRIBE,a,!0))._message}catch(s){if(r&&s.data&&s.data.code===He.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,i),await this.subscribe(t,i,!1);throw s}}async subscribeDataChannel(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const a={uid:t,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Et.SUBSCRIBE_DATASTREAM,a,!0)}catch(s){if(r&&s.data&&s.data.code===He.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,i),await this.subscribeDataChannel(t,i,!1);throw s}}async subscribeAll(t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!G("USE_SUB_RTX"),twcc:!!G("SUBSCRIBE_TWCC"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Et.SUBSCRIBE_STREAMS,r,!0)}catch(a){if(i&&a.data&&a.data.code===He.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),a.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw a}}async setVideoProfile(t){const i=(function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let a=r.frameRate,s=r.width,o=r.height,c=!0;return typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,a||(c=!1)),c?{stream_type:0,width:s,height:o,fps:a,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0})(t);if(i)return this.signal.request(Et.SET_VIDEO_PROFILE,i);w.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,i){try{await this.signal.request(Et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:i},!0)}catch(r){w.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await se.all(t.map((r=>this.signal.request(Et.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:i},!0))))}catch(r){w.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Et.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){w.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(t){const{iceParameters:i,dtlsParameters:r,rtpCapabilities:a}=t;return{gatewayEstablishParams:await this.signal.request(Et.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:r,rtpCapabilities:a}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Et.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Et.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,i){i&&(this._clientRoleOptions=Object.assign({},i)),G("CLIENT_ROLE_OPTIONS")&&(w.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),G("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS")),w.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,a=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,a=1):a=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:a=0;const s=Object.assign({},i);delete s.delay,delete s.level,await this.signal.request(Et.SET_CLIENT_ROLE,Ba(Ba({role:t,level:a,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,i){await this.signal.request(Et.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:i})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Et.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,i){await this.signal.request(Et.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:i})}async pickSVCLayer(t,i){await this.signal.request(Et.PICK_SVC_LAYER,{stream_id:t,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Et.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,i,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,i,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Ba({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Et.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=kU.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=(function(i){let r;return r=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Qn.username,password:Qn.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ba(Ba({},Qn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Et.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((i=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((a=>a.peer_uid===i.peer_uid));r&&r.B_st!==i.B_st&&cr((()=>{this.emit(Vn.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)}))})),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var i,r;if(!this.joinInfo||!this.key)throw new oe(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const a=Object.assign({},this.joinInfo.apResponse);let s=G("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var o;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Vn.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,ee(yl).call(yl,o)||yl.push(o);const c=TO(this.store),d=!((i=this.isPreallocation)===null||i===void 0||!i.call(this)),l=sa(this.store),h=JB(),_=Tg(87)||d1()||iO(117),f=((function(){const S=_i();if(S.name!==bi.SAFARI||!S.browserVersion)return!1;const T=S.browserVersion.split(".");return Number(T[0])>18||Number(T[0])===18&&Number(T[1])>=4})()||u1(18,4,!1))&&db(18,6,!0)&&this.spec.codec==="h264"&&G("ENABLE_ABSSENDTIME_AS_SENTTS"),m=Ba({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:lc,browser:navigator.userAgent,process_id:G("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:a,extend:G("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:Ba(Ba({enableEncodedTransform:(!!G("ENABLE_AUDIO_METADATA")||!!G("ENABLE_AUDIO_PTS"))&&_||!!G("ENABLE_AUDIO_TOPN")&&ob(bi.CHROME,87,116)||void 0,enableAudioMetadata:!!G("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!G("ENABLE_AUDIO_PTS")&&_,topnSmoothLevel:G("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:G("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:G("TOPN_SWITCH_HOLD_MS"),topnAudioGain:G("TOPN_AUDIO_GAIN"),enablePublishedUserList:G("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:G("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Jc("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Jc("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Jc("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:G("USE_PUB_RTX")===!0||G("USE_SUB_RTX")===!0||void 0,disableFEC:G("DISABLE_FEC"),enableNTPReport:!!G("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:l,enableFulllinkAvSync:!!G("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Jc("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!G("FORCE_ENABLE_AUT_CC")||!iR()&&(!!G("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!G("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Jc("USE_XR","boolean"),enableLossbasedBwe:Jc("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!G("FORCE_ENABLE_AUT_CC")||!iR()&&(!!G("ENABLE_AUT_CC")||void 0),enableCCFallback:Jc("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:c?Jc("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Jc("PUBLISH_TWCC","boolean"),enableSubTWCC:Jc("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Jc("USE_PUB_RTX","boolean"),enableSubRTX:Jc("USE_SUB_RTX","boolean"),enableSubSVC:G("ENABLE_SVC")?G("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0,enableSvcExtended:G("ENABLE_SVC")&&Array.isArray(G("SVC_EXTENDED"))&&G("SVC_EXTENDED").length!==0?G("SVC_EXTENDED"):void 0},h),{},{audioDuplicate:Jc("ENABLE_AUDIO_RED","boolean")?(r=Jc("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0,senttsUsesAbsSendTime:!!f||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(m.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(m.aes_mode=this.joinInfo.aesmode,G("ENCRYPT_AES")?(m.aes_secret=this.joinInfo.aespassword,m.aes_encrypt=!0):m.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(m.aes_salt=this.joinInfo.aessalt)),a.addresses[this.signal.websocket.currentURLIndex]&&(m.ap_response.ticket=a.addresses[this.signal.websocket.currentURLIndex].ticket,delete a.addresses),this.joinInfo.defaultVideoStream!==void 0&&(m.default_video_stream=this.joinInfo.defaultVideoStream),m}getRejoinMessage(){if(!this.joinInfo)throw new oe(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ne.WS_RECONNECT_CREATE_CONNECTION,(t=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(Ne.WS_RECONNECTING,(t=>{this.joinInfo&&J.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Rr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",J.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(Ne.WS_CLOSED,(t=>{let i;switch(t){case Oi.LEAVE:i=Rr.LEAVE;break;case Oi.UID_BANNED:case Oi.IP_BANNED:case Oi.CHANNEL_BANNED:case Oi.SERVER_ERROR:i=Rr.SERVER_ERROR;break;case Oi.FALLBACK:i=Rr.FALLBACK;break;case Oi.LICENSE_MISSING:case Oi.LICENSE_EXPIRED:case Oi.LICENSE_MINUTES_EXCEEDED:case Oi.LICENSE_PERIOD_INVALID:case Oi.LICENSE_MULTIPLE_SDK_SERVICE:case Oi.LICENSE_ILLEGAL:case Oi.TOKEN_EXPIRE:i=t;break;default:i=Rr.NETWORK_ERROR}w.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+Rr.NETWORK_ERROR)),this.joinInfo&&J.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Oi.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=t,t!==Oi.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(Ne.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=G("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(w.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(J.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void w.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));B("EVENT_REPORT_DOMAIN",t[1]),B("EVENT_REPORT_BACKUP_DOMAIN",t[1]),B("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}})),this.signal.on(Dt.ON_UPLINK_STATS,(t=>{this._statsCollector.updateUplinkStats(t)})),this.signal.on(Ne.REQUEST_RECOVER,((t,i,r)=>{if(!this.joinInfo)return r(new oe(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,zt(this,Vn.REQUEST_NEW_GATEWAY_LIST).then(i).catch(r)})),this.signal.on(Ne.REQUEST_JOIN_INFO,(async(t,i,r)=>{var a,s,o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const c=qi((a=this.joinInfo)===null||a===void 0?void 0:a.turnServer);if(G("NEW_TURN_MODE")&&c&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var d;let f=c.servers.map((T=>"turnServerURL"in T&&G("USE_TURN_IP")?Ba(Ba({},T),{},{turnServerURL:ER(T.turnServerURL)}):T)),m=(d=c.serversFromGateway)===null||d===void 0?void 0:d.map((T=>G("USE_TURN_IP")?Ba(Ba({},T),{},{turnServerURL:ER(T.turnServerURL)}):T));const S=this.signal.currentURLIndex;f.length>0&&(f=[f[S%f.length]],c.servers=f),Array.isArray(m)&&m.length>0&&(m=[m[0]],c.serversFromGateway=m),w.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(S))}const{iceParameters:l,dtlsParameters:h,rtpCapabilities:_}=await zt(this,Vn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c,cloudProxyServer:(o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:h,rtpCapabilities:_,version:"2"}}))}catch(f){i(f)}})),this.signal.on(Ne.REQUEST_REJOIN_INFO,(t=>{t(this.getRejoinMessage())})),this.signal.on(Ne.REPORT_JOIN_GATEWAY,((t,i)=>{if(!this.joinInfo)return;let r,a="";var s;t instanceof oe?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,a=t.message):r=t,J.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:a,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(Ne.IS_P2P_DISCONNECTED,(t=>{t(Kr(this,Vn.IS_P2P_DISCONNECTED))})),this.signal.on(Ne.DISCONNECT_P2P,(()=>{this.emit(Vn.DISCONNECT_P2P)})),this.signal.on(Ne.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(Ne.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(Ne.JOIN_RESPONSE,(t=>{const i=this.getCurrentGatewayAddress();this.emit(Vn.JOIN_RESPONSE,t,i)})),this.signal.on(Ne.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var t,i;this.updateTurnConfigFromSignal();const a=this.getCurrentGatewayAddress(),s=qi((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(G("NEW_TURN_MODE")&&s&&((i=this.joinInfo)===null||i===void 0?void 0:i.cloudProxyServer)==="disabled"){var r;let c=s.servers.map((h=>"turnServerURL"in h&&G("USE_TURN_IP")?Ba(Ba({},h),{},{turnServerURL:ER(h.turnServerURL)}):h)),d=(r=s.serversFromGateway)===null||r===void 0?void 0:r.map((h=>G("USE_TURN_IP")?Ba(Ba({},h),{},{turnServerURL:ER(h.turnServerURL)}):h));const l=this.signal.currentURLIndex;c.length>0&&(c=[c[l%c.length]],s.servers=c),Array.isArray(d)&&d.length>0&&(d=[d[0]],s.serversFromGateway=d),w.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(l,",in pre pc"))}const o=G("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(a&&o){const c=TR(a);this.emit(Vn.PRE_CONNECT_PC,{candidates:c,fingerprint:o,turnServer:s})}}})),this.signal.on(Ne.RECOVER_NOTIFICATION,(t=>{this.joinInfo&&typeof G("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(G("AP_REQUEST_DETAIL"),";").concat(t))}))}async tryUnsubBeforeResub(t,i){try{await this.signal.request(Et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[i]},!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,i){try{await this.signal.request(Et.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(r){throw w.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,i){try{await this.signal.request(Et.UNPUBLISH,{stream_id:t,ortc:i},!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,i){try{await this.signal.request(Et.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(r){throw w.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const i={users:t.map((r=>({stream_id:r.stream_id,stream_type:r.stream_type})))};try{await this.signal.request(Et.UNSUBSCRIBE_STREAMS,i,!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,i){const r={action:t.find((a=>a.stream_type===Vt.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(Et.CONTROL,r,!0,!0)}catch(a){throw w.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),a),a}}async unmuteLocal(t,i){const r={action:t.find((a=>a.stream_type===Vt.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(Et.CONTROL,r,!0,!0)}catch(a){throw w.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),a),a}}async muteRemote(t,i){const r={action:t===Me.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Et.CONTROL,r,!0,!0)}catch(a){throw w.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),a),a}}async unmuteRemote(t,i){const r={action:t===Me.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Et.CONTROL,r,!0,!0)}catch(a){throw w.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),a),a}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,i){this.signal.upload(t,i)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Et.RESTART_ICE,i,!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,i){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,i||Rr.P2P_FAILED)}getCurrentGatewayAddress(){var t,i;if(!G("GATEWAY_WSS_ADDRESS"))return G("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(w.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Et.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let RR=0,kd=0;function Sc(e,t,i,r){return new se(((a,s)=>{t.timeout=t.timeout||G("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),RR+=Fu(t.data)):i&&(t.data.size?RR+=t.data.size:t.data instanceof FormData?RR+=mB(t.data):RR+=Fu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,co.request(t).then((o=>{typeof o.data=="string"?kd+=Fu(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?kd+=o.data.byteLength:kd+=Fu(JSON.stringify(o.data)),r&&a({data:o.data,headers:o.headers}),a(o.data)})).catch((o=>{co.isCancel(o)?s(new oe(L.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new oe(L.NETWORK_TIMEOUT,o.message)):o.response?s(new oe(L.NETWORK_RESPONSE_ERROR,o.response.status)):s(new oe(L.NETWORK_ERROR,o.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t($){var ne=0;return function(){return ne<$.length?{done:!1,value:$[ne++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function($,ne,ie){return $==Array.prototype||$==Object.prototype||($[ne]=ie.value),$},r,a=(function($){$=[typeof globalThis=="object"&&globalThis,$,typeof window=="object"&&window,typeof self=="object"&&self,typeof K=="object"&&K];for(var ne=0;ne<$.length;++ne){var ie=$[ne];if(ie&&ie.Math==Math)return ie}throw Error("Cannot find global object")})(this);function s($,ne){if(ne)e:{var ie=a;$=$.split(".");for(var A=0;A<$.length-1;A++){var v=$[A];if(!(v in ie))break e;ie=ie[v]}(ne=ne(A=ie[$=$[$.length-1]]))!=A&&ne!=null&&i(ie,$,{configurable:!0,writable:!0,value:ne})}}function o($){return($={next:$})[Symbol.iterator]=function(){return this},$}function c($){var ne=typeof Symbol<"u"&&Symbol.iterator&&$[Symbol.iterator];return ne?ne.call($):{next:t($)}}if(s("Symbol",(function($){function ne(v,D){this.A=v,i(this,"description",{configurable:!0,writable:!0,value:D})}if($)return $;ne.prototype.toString=function(){return this.A};var ie="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",A=0;return function v(D){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new ne(ie+(D||"")+"_"+A++,D)}})),s("Symbol.iterator",(function($){if($)return $;$=Symbol("Symbol.iterator");for(var ne="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ie=0;ie<ne.length;ie++){var A=a[ne[ie]];typeof A=="function"&&typeof A.prototype[$]!="function"&&i(A.prototype,$,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return $})),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var d;e:{var l={};try{l.__proto__={a:!0},d=l.a;break e}catch{}d=!1}r=d?function($,ne){if($.__proto__=ne,$.__proto__!==ne)throw new TypeError($+" is not extensible");return $}:null}var h=r;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function f($){if($.m)throw new TypeError("Generator is already running");$.m=!0}function m($,ne){return $.h=3,{value:ne}}function S($){this.g=new _,this.G=$}function T($,ne,ie,A){try{var v=ne.call($.g.j,ie);if(!(v instanceof Object))throw new TypeError("Iterator result "+v+" is not an object");if(!v.done)return $.g.m=!1,v;var D=v.value}catch(j){return $.g.j=null,$.g.s(j),R($)}return $.g.j=null,A.call($.g,D),R($)}function R($){for(;$.g.h;)try{var ne=$.G($.g);if(ne)return $.g.m=!1,{value:ne.value,done:!1}}catch(ie){$.g.v=void 0,$.g.s(ie)}if($.g.m=!1,$.g.l){if(ne=$.g.l,$.g.l=null,ne.F)throw ne.D;return{value:ne.return,done:!0}}return{value:void 0,done:!0}}function C($){this.next=function(ne){return $.o(ne)},this.throw=function(ne){return $.s(ne)},this.return=function(ne){return(function(ie,A){f(ie.g);var v=ie.g.j;return v?T(ie,"return"in v?v.return:function(D){return{value:D,done:!0}},A,ie.g.return):(ie.g.return(A),R(ie))})($,ne)},this[Symbol.iterator]=function(){return this}}function b($,ne){return ne=new C(new S(ne)),h&&$.prototype&&h(ne,$.prototype),ne}if(_.prototype.o=function($){this.v=$},_.prototype.s=function($){this.l={D:$,F:!0},this.h=this.C||this.u},_.prototype.return=function($){this.l={return:$},this.h=this.u},S.prototype.o=function($){return f(this.g),this.g.j?T(this,this.g.j.next,$,this.g.o):(this.g.o($),R(this))},S.prototype.s=function($){return f(this.g),this.g.j?T(this,this.g.j.throw,$,this.g.o):(this.g.s($),R(this))},s("Array.prototype.entries",(function($){return $||function(){return(function(ne,ie){ne instanceof String&&(ne+="");var A=0,v=!1,D={next:function(){if(!v&&A<ne.length){var j=A++;return{value:ie(j,ne[j]),done:!1}}return v=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D})(this,(function(ne,ie){return[ne,ie]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var N=function($,ne){for(var ie=0;ie<$.length;ie++)ne($[ie])},k=function($){return $.replace(/\r?\n|\r/g,`\r
`)},P=function($,ne,ie){return ne instanceof Blob?(ie=ie!==void 0?ie+"":typeof ne.name=="string"?ne.name:"blob",ne.name===ie&&Object.prototype.toString.call(ne)!=="[object Blob]"||(ne=new File([ne],ie)),[String($),ne]):[String($),String(ne)]},U=function($,ne){if($.length<ne)throw new TypeError(ne+" argument required, but only "+$.length+" present.")},W=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,z=W.FormData,Q=W.XMLHttpRequest&&W.XMLHttpRequest.prototype.send,he=W.Request&&W.fetch,Ge=W.navigator&&W.navigator.sendBeacon,xe=W.Element&&W.Element.prototype,qe=W.Symbol&&Symbol.toStringTag;qe&&(Blob.prototype[qe]||(Blob.prototype[qe]="Blob"),"File"in W&&!File.prototype[qe]&&(File.prototype[qe]="File"));try{new File([],"")}catch{W.File=function(ne,ie,A){return ne=new Blob(ne,A||{}),Object.defineProperties(ne,{name:{value:ie},lastModified:{value:+(A&&A.lastModified!==void 0?new Date(A.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),qe&&Object.defineProperty(ne,qe,{value:"File"}),ne}}var ot=function($){return $.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},xt=function($){this.i=[];var ne=this;$&&N($.elements,(function(ie){if(ie.name&&!ie.disabled&&ie.type!=="submit"&&ie.type!=="button"&&!ie.matches("form fieldset[disabled] *"))if(ie.type==="file"){var A=ie.files&&ie.files.length?ie.files:[new File([],"",{type:"application/octet-stream"})];N(A,(function(v){ne.append(ie.name,v)}))}else ie.type==="select-multiple"||ie.type==="select-one"?N(ie.options,(function(v){!v.disabled&&v.selected&&ne.append(ie.name,v.value)})):ie.type==="checkbox"||ie.type==="radio"?ie.checked&&ne.append(ie.name,ie.value):(A=ie.type==="textarea"?k(ie.value):ie.value,ne.append(ie.name,A))}))};if((e=xt.prototype).append=function($,ne,ie){U(arguments,2),this.i.push(P($,ne,ie))},e.delete=function($){U(arguments,1);var ne=[];$=String($),N(this.i,(function(ie){ie[0]!==$&&ne.push(ie)})),this.i=ne},e.entries=function $(){var ne,ie=this;return b($,(function(A){if(A.h==1&&(ne=0),A.h!=3)return ne<ie.i.length?A=m(A,ie.i[ne]):(A.h=0,A=void 0),A;ne++,A.h=2}))},e.forEach=function($,ne){U(arguments,1);for(var ie=c(this),A=ie.next();!A.done;A=ie.next()){var v=c(A.value);A=v.next().value,v=v.next().value,$.call(ne,v,A,this)}},e.get=function($){U(arguments,1);var ne=this.i;$=String($);for(var ie=0;ie<ne.length;ie++)if(ne[ie][0]===$)return ne[ie][1];return null},e.getAll=function($){U(arguments,1);var ne=[];return $=String($),N(this.i,(function(ie){ie[0]===$&&ne.push(ie[1])})),ne},e.has=function($){U(arguments,1),$=String($);for(var ne=0;ne<this.i.length;ne++)if(this.i[ne][0]===$)return!0;return!1},e.keys=function $(){var ne,ie,A,v,D=this;return b($,(function(j){if(j.h==1&&(ne=c(D),ie=ne.next()),j.h!=3)return ie.done?void(j.h=0):(A=ie.value,v=c(A),m(j,v.next().value));ie=ne.next(),j.h=2}))},e.set=function($,ne,ie){U(arguments,2),$=String($);var A=[],v=P($,ne,ie),D=!0;N(this.i,(function(j){j[0]===$?D&&(D=!A.push(v)):A.push(j)})),D&&A.push(v),this.i=A},e.values=function $(){var ne,ie,A,v,D=this;return b($,(function(j){if(j.h==1&&(ne=c(D),ie=ne.next()),j.h!=3)return ie.done?void(j.h=0):(A=ie.value,(v=c(A)).next(),m(j,v.next().value));ie=ne.next(),j.h=2}))},xt.prototype._asNative=function(){for(var $=new z,ne=c(this),ie=ne.next();!ie.done;ie=ne.next()){var A=c(ie.value);ie=A.next().value,A=A.next().value,$.append(ie,A)}return $},xt.prototype._blob=function(){var $="----formdata-polyfill-"+Math.random(),ne=[],ie="--"+$+`\r
Content-Disposition: form-data; name="`;return this.forEach((function(A,v){return typeof A=="string"?ne.push(ie+ot(k(v))+`"\r
\r
`+k(A)+`\r
`):ne.push(ie+ot(k(v))+'"; filename="'+ot(A.name)+`"\r
Content-Type: `+(A.type||"application/octet-stream")+`\r
\r
`,A,`\r
`)})),ne.push("--"+$+"--"),new Blob(ne,{type:"multipart/form-data; boundary="+$})},xt.prototype[Symbol.iterator]=function(){return this.entries()},xt.prototype.toString=function(){return"[object FormData]"},xe&&!xe.matches&&(xe.matches=xe.matchesSelector||xe.mozMatchesSelector||xe.msMatchesSelector||xe.oMatchesSelector||xe.webkitMatchesSelector||function($){for(var ne=($=(this.document||this.ownerDocument).querySelectorAll($)).length;0<=--ne&&$.item(ne)!==this;);return-1<ne}),qe&&(xt.prototype[qe]="FormData"),Q){var fe=W.XMLHttpRequest.prototype.setRequestHeader;W.XMLHttpRequest.prototype.setRequestHeader=function($,ne){fe.call(this,$,ne),$.toLowerCase()==="content-type"&&(this.B=!0)},W.XMLHttpRequest.prototype.send=function($){$ instanceof xt?($=$._blob(),this.B||this.setRequestHeader("Content-Type",$.type),Q.call(this,$)):Q.call(this,$)}}he&&(W.fetch=function($,ne){return ne&&ne.body&&ne.body instanceof xt&&(ne.body=ne.body._blob()),he.call(this,$,ne)}),Ge&&(W.navigator.sendBeacon=function($,ne){return ne instanceof xt&&(ne=ne._asNative()),Ge.call(this,$,ne)}),W.FormData=xt}})();const vR=()=>{const e=G("AREAS");return e.length===0&&e.push(Di.GLOBAL),Pn(e).call(e,((t,i,r)=>{const a=ZB(i);return a?r===0?a:"".concat(t,",").concat(a):t}),"")},ZB=e=>e===Di.OVERSEA?"".concat(ca.ASIA,",").concat(ca.EUROPE,",").concat(ca.AFRICA,",").concat(ca.NORTH_AMERICA,",").concat(ca.SOUTH_AMERICA,",").concat(ca.OCEANIA):ca[e],XO=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((i=>{const r=uE[i],a=Object.keys(r);a&&a.map((s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))}))})),t},kg={GLOBAL:{ASIA:[Di.CHINA,Di.JAPAN,Di.INDIA,Di.KOREA,Di.HKMC],EUROPE:[],NORTH_AMERICA:[Di.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},yR=Object.keys(kg[Di.GLOBAL]),MU=[Di.CHINA,Di.NORTH_AMERICA,Di.EUROPE,Di.ASIA,Di.JAPAN,Di.INDIA,Di.OCEANIA,Di.SOUTH_AMERICA,Di.AFRICA,Di.KOREA,Di.HKMC,Di.US],QB=function(e,t){let i=[];if(ee(e).call(e,Di.GLOBAL)){const s=[Di.GLOBAL,Di.OVERSEA],o=Object.keys(uE);if(t===Di.GLOBAL)throw new oe(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Di.CHINA)i=[Di.OVERSEA];else if(a=t,ee(yR).call(yR,a)){const c=(r=t,kg[Di.GLOBAL][r]||[]),d=[...s,t,...c];i=o.filter((l=>!ee(d).call(d,l)))}else if((function(c){let d=!1;return yR.forEach((l=>{var h;ee(h=kg[Di.GLOBAL][l]).call(h,c)&&(d=!0)})),d})(t)){const c=(function(l){let h;return yR.forEach((_=>{var f;ee(f=kg[Di.GLOBAL][_]).call(f,l)&&(h=_)})),h})(t),d=[...s,c,t];i=o.filter((l=>!ee(d).call(d,l)))}else i=e;i=(function(c){const d=[];return MU.forEach((l=>{ee(c).call(c,l)&&d.push(l)})),d.concat(c.filter((l=>!ee(MU).call(MU,l))))})(i)}else i=e;var r,a;return i};function JO(e){var t,i;if(!e&&ee(t=G("AREAS")).call(t,Di.EXTENSIONS))return w.debug("update area from ap : reset"),void ZO(BB,!0);if(!ee(i=G("AREAS")).call(i,Di.GLOBAL)||!e)return;let r=uE.EXTENSIONS;r&&(r={CODE:ZB(Di.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},w.debug("update area from ap success: ".concat(e,",config is "),r),B("AREAS",[Di.EXTENSIONS],!0),Object.keys(r).map((a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?B(a,r[a][0]):B(a,r[a])})))}function ZO(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=J.reportApiInvoke(null,{name:Gt.SET_AREA,options:e,tag:Tr.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach((s=>{if(!ee(Va).call(Va,s))throw new oe(L.INVALID_PARAMS,"invalid area code")})),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:o}=e;if(!s)throw new oe(L.INVALID_PARAMS,"area code is needed");let c=s;typeof s=="string"&&(c=[s]),r=o?QB(c,o):c}if(!t){if(ft.AREAS){const s=new oe(L.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(s),void w.warning("setArea is prohibited because of config-distribute")}if(ee(r).call(r,Di.GLOBAL)&&G("AREAS")===Di.EXTENSIONS){const s=new oe(L.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(s),void w.warning("setArea is prohibited because of ap extensions")}}B("AREAS",r,t);const a=XO(r);Object.keys(a).map((s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?B(s,a[s][0]):B(s,a[s])})),w.debug("set area success:",r.join(","))}catch(r){throw i.onError(r),r}i.onSuccess()}function qu(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Il(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?qu(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qu(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}let UU=1;function xU(e,t,i,r,a){UU+=1;const s={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:UU,requestId:UU,version:lc,cname:i.cname},o={service_name:t,json_body:JSON.stringify(s)};let c,d,l=e[0];return Vc((async()=>{c=Date.now();const h=await Sc(l,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-c,h.code!==0){const m=new oe(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+h.code,{retry:!0,responseTime:d});throw w.error(m.toString()),m}const _=JSON.parse(h.json_body);if(_.code!==200){const m=new oe(L.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:d});throw w.error(m.toString()),m}if(!_.servers||_.servers.length===0){const m=new oe(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:d});throw w.error(m.toString()),m}const f=(function(m,S){return{addressList:m.servers.map((T=>"wss://".concat(T.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(T.wss,"?serviceName=").concat(encodeURIComponent(S)))),workerToken:m.workerToken,vid:m.vid}})(_,t);return G("LIVE_STREAMING_ADDRESS")&&(f.addressList=G("LIVE_STREAMING_ADDRESS")instanceof Array?G("LIVE_STREAMING_ADDRESS"):[G("LIVE_STREAMING_ADDRESS")]),Il(Il({},f),{},{responseTime:d})}),((h,_)=>(J.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(h.addressList),firstSuccess:_===0,responseTime:d,serverIp:e[_%e.length]}),!1)),((h,_)=>(J.apworkerEvent(i.sid,{success:!1,sc:h.data&&h.data.code||200,serviceName:t,responseTime:d,serverIp:e[_%e.length]}),!!(h.code!==L.OPERATION_ABORTED&&h.code!==L.UNEXPECTED_RESPONSE||h.data&&h.data.retry)&&(l=e[(_+1)%e.length],!0))),a)}let QO=1;function VU(e,t,i,r){let{url:a,areaCode:s}=e;const{clientId:o,sid:c}=t,d=Date.now();let l;const h=t.role,[_,f]=GU(t,s,[hn.CHOOSE_SERVER]);let m=Zr.networkState;return Vc((async()=>{m&&Zr.networkState===cs.OFFLINE&&Zr.onlineWaiter&&await se.race([Zr.onlineWaiter,Ht(r&&r.maxRetryTimeout||ln.maxRetryTimeout)]),m=Zr.networkState;const{data:S,headers:T}=await Sc(a,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=T.http3==="1"?1:-1,J.reportResourceTiming(a,c),$O(S,a,t,d,[hn.CHOOSE_SERVER],l);const R=gR(S,hn.CHOOSE_SERVER);return BU(R),po(R,a)}),(S=>(S&&J.joinChooseServer(c,{role:h,lts:d,succ:!0,csAddr:a,opid:f,serverList:S.gatewayAddrs.map((T=>T.address)),ec:null,cid:S.cid.toString(),uid:S.uid.toString(),csIp:S.csIp,unilbsServerIds:[hn.CHOOSE_SERVER].toString(),isHttp3:l,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:S.res.detail&&S.res.detail[38]}),!1)),(S=>S.code!==L.OPERATION_ABORTED&&(S.code===L.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(J.joinChooseServer(c,{role:h,lts:d,succ:!1,csAddr:a,serverList:null,opid:f,ec:S.code,csIp:S.data&&S.data.csIp,unilbsServerIds:[hn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:m}),isHttp3:l,corssRegionTagReq:t.apRequestDetail}),w.warning("[".concat(o||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),S),!0))),r)}function FU(e,t,i,r){let a,{url:s,areaCode:o,serviceIds:c}=e;const d=Date.now(),l=t.role,[h,_]=GU(t,o,c);let f;return Vc((async()=>{f&&Zr.networkState===cs.OFFLINE&&Zr.onlineWaiter&&await se.race([Zr.onlineWaiter,Ht(r&&r.maxRetryTimeout||ln.maxRetryTimeout)]),f=Zr.networkState;const{data:m,headers:S}=await Sc(s,{data:h,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a=S.http3==="1"?1:-1,J.reportResourceTiming(s,t.sid),$O(m,s,t,d,c,a);const T=gR(m,hn.CHOOSE_SERVER),R=gR(m,t.cloudProxyServer==="proxy5"?hn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?hn.CLOUD_PROXY:hn.CLOUD_PROXY_FALLBACK),C=performance.getEntriesByName(s),b=C[C.length-1];let N;return b&&(N={name:b.name,protocol:"nextHopProtocol"in b?b.nextHopProtocol:"",dnscost:"domainLookupEnd"in b&&"domainLookupStart"in b&&typeof b.domainLookupEnd=="number"&&typeof b.domainLookupStart=="number"?b.domainLookupEnd-b.domainLookupStart:-1,tcpTlsCost:"connectEnd"in b&&"connectStart"in b&&typeof b.connectEnd=="number"&&typeof b.connectStart=="number"?b.connectEnd-b.connectStart:-1,reqCost:"requestStart"in b&&typeof b.requestStart=="number"&&"responseEnd"in b&&typeof b.responseEnd=="number"?b.responseEnd-b.requestStart:-1,handleCost:"leave_ts"in m&&"enter_ts"in m&&typeof m.leave_ts=="number"&&typeof m.enter_ts=="number"?m.leave_ts-m.enter_ts:-1}),BU(T),{gatewayInfo:po(T,s),proxyInfo:R,url:s,resourceTimingInfo:N}}),(m=>(m.gatewayInfo&&J.joinChooseServer(t.sid,{role:l,lts:d,succ:!0,csAddr:s,serverList:m.gatewayInfo.gatewayAddrs.map((S=>S.address)),ec:null,opid:_,cid:m.gatewayInfo.cid.toString(),uid:m.gatewayInfo.uid.toString(),csIp:m.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:a,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:m.gatewayInfo.res.detail&&m.gatewayInfo.res.detail[38],resourceTimingInfo:m.resourceTimingInfo?JSON.stringify(m.resourceTimingInfo):void 0}),m.proxyInfo&&J.joinWebProxyAP(t.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:m.proxyInfo.addresses.map((S=>S.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1)),(m=>m.code!==L.OPERATION_ABORTED&&(m.code===L.CAN_NOT_GET_GATEWAY_SERVER?m.data.retry:(J.joinWebProxyAP(t.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:m.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:f})}),w.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),m),!0))),r)}const $O=(e,t,i,r,a,s)=>{const{sid:o,clientId:c,cloudProxyServer:d}=i,l=[],h=_=>{_.flag===4096?J.joinChooseServer(o,{role:i.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:a.toString(),isHttp3:s,corssRegionTagReq:i.apRequestDetail}):_.flag!==1048576&&_.flag!==4194304&&_.flag!==4194310||J.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:_.error.code,eventType:d,unilbsServerIds:a.toString()})};if(e.response_body.forEach((_=>{const f=_.buffer.code;if(_.uri===23&&f===0&&!_.buffer.edges_services)if(_.buffer.flag===4194310)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{const m={error:new oe(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:_.buffer.flag};l.push(m),h(m)}if(f!==0){const m=_R(f),S={error:new oe(L.CAN_NOT_GET_GATEWAY_SERVER,m.desc,{desc:m.desc,retry:m.retry,csIp:e.detail[502]}),flag:_.buffer.flag};_.buffer.flag===4194310?w.warning(S.error.toString()):l.push(S),h(S)}})),l.length)throw w.warning("[".concat(c||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map((_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry))).join(" | "))),new oe(L.CAN_NOT_GET_GATEWAY_SERVER,l.map((_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message))).join(" | "),{retry:!!l.find((_=>_.error.data.retry)),csIp:e.detail[502],desc:[...new Set(l.map((_=>{var f;return _==null||(f=_.error)===null||f===void 0||(f=f.data)===null||f===void 0?void 0:f.desc})).filter((_=>!!_)))]})},BU=e=>{var t,i,r,a;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new oe(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(G("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((a=e.detail)===null||a===void 0?void 0:a[23])=="string"?JO(e.detail[23].toLowerCase()):JO()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const o=e.detail[19],c=o?.split(";");for(let d=0;d<c.length;d++){var s;const l=hr(s=c[d]).call(s);e.addresses[d]&&c&&(e.addresses[d].fingerprint=l)}}if(G("GATEWAY_ADDRESS")&&G("GATEWAY_ADDRESS").length>0){w.debug("assign gateway address to",G("GATEWAY_ADDRESS"));const o=G("GATEWAY_ADDRESS").map((c=>{var d,l;const h=(d=(l=e.addresses.find((_=>_.ip===c.ip&&_.port===c.port)))===null||l===void 0?void 0:l.fingerprint)!==null&&d!==void 0?d:"";return{ip:c.ip,port:c.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:h}}));e.addresses=o}},jU=(e,t)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const r=_R(i.buffer.code);throw new oe(L.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return i.buffer.ticket}throw w.debug("update ticket request received ap response without response body:",t),new oe(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},GU=(e,t,i)=>{const r=Math.floor(Math.random()*1e12),a=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Il(Il(Il({6:e.stringUid,11:t,12:G("USE_NEW_TOKEN")?"1":void 0},a?{17:a}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};s.request_bodies.forEach((c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const o=new FormData;return o.append("request",JSON.stringify(s)),[o,r]},CR=(e,t)=>{const i=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((s=>({ip:s.ip,port:s.port})))}}]},a=new FormData;return a.append("request",JSON.stringify(r)),[a,i]};let Xu=0;function rp(e){return se.all(e.map((t=>t.then((i=>{throw i}),(i=>i))))).then((t=>{throw t}),(t=>t))}const bR=async e=>{let{fragementLength:t,referenceList:i,asyncMapHandler:r,allFailedhandler:a,promisesCollector:s}=e,o=0;const c=t;let d,l=0;const h=async()=>{const _=(()=>{const f=o*c,m=f+c;return i.slice(f,m).map(r)})();s&&s.push(..._);try{d=await rp(_)}catch(f){if(l+=c,o++,!(l>=i.length))return void await h();a(f)}_.forEach((f=>f.cancel()))};return await h(),d},$B=async e=>{let{referenceList:t,asyncMapHandler:i,closeFn:r}=e;const a=t.length;let s=0;const o=async()=>{const c=i(t.shift());try{return await c}catch(d){if(s++,s>=a||r!=null&&r(d))throw d;return o()}};return o()};async function WU(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],a=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],o=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new se(((d,l)=>{let h;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:f=>{f.close(),clearTimeout(h),d(!0)},error:f=>{clearTimeout(h),d(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();const _=[t,i,r,a,s,o];for(let f=0;f<_.length;f++){const m=new EncodedVideoChunk({type:f==0?"key":"delta",timestamp:33333*f,duration:33333,data:new Uint8Array(_[f])});try{await e.decode(m)}catch{return void d(!1)}}})(),h=setTimeout((()=>{d(!1)}),5e3)}))}async function e0(e,t,i,r){return{gatewayInfo:await(async function(s,o,c,d){let l=null;const h=[],_=async()=>{const m=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((R=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(R+"/api/v2/transpond/webrtc?v=2"):"https://".concat(R,"/api/v2/transpond/webrtc?v=2"),areaCode:vR()}))),S=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:m.map((R=>R.url))}),T=await bR({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:R=>(w.debug("[".concat(s.clientId,"] Connect to choose_server:"),R.url),VU(R,s,o,c)),allFailedhandler:R=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:R},S),R[0]},promisesCollector:h});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},S),T},f=async()=>{if(await Ht(1e3),l!==null)return l;const m=G("WEBCS_DOMAIN_BACKUP_LIST").map((R=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(R+"/api/v2/transpond/webrtc?v=2"):"https://".concat(R,"/api/v2/transpond/webrtc?v=2"),areaCode:vR()}))),S=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:m.map((R=>R.url))}),T=await bR({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:R=>(w.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),R.url),VU(R,s,o,c)),allFailedhandler:R=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:R},S),R[0]},promisesCollector:h});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},S),T};try{return l=await rp([_(),f()]),h.length&&h.forEach((m=>m.cancel&&typeof m.cancel=="function"&&m.cancel())),l}catch(m){throw m[0]}})(e,t,i,r)}}async function HU(e,t,i,r,a){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await e0(e,t,i,a);if(G("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:f,proxyInfo:m}=await ij(e,t,i,a);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:f};const S=m.map((T=>({turnServerURL:T.address,tcpport:T.tcpport||Qn.tcpport,udpport:T.udpport||Qn.udpport,username:T.username||Qn.username,password:T.password||Qn.password,forceturn:!1,security:!0})));if(a.useP2P){var o;const T=(o=e.uid)!==null&&o!==void 0?o:f.uid,R="glb:".concat(T.toString()),C=await Sr(R),b=m.map((N=>({turnServerURL:N.address,tcpport:N.tcpport||Qn.tcpport,udpport:N.udpport||Qn.udpport,username:R,password:C,forceturn:!1,security:!0})));S.push(...b)}return e.turnServer={mode:"manual",servers:S},{gatewayInfo:f}}return await e0(e,t,i,a)}const{proxyInfo:c,gatewayInfo:d}=await ij(e,t,i,a),l={gatewayInfo:d},h=c.map((f=>({turnServerURL:f.address,tcpport:s==="proxy3"?void 0:f.tcpport?f.tcpport:Qn.tcpport,udpport:s==="proxy4"?void 0:f.udpport?f.udpport:Qn.udpport,username:f.username||Qn.username,password:f.password||Qn.password,forceturn:s!=="proxy4",security:s==="proxy5"})));if(a.useP2P){var _;const f=(_=e.uid)!==null&&_!==void 0?_:d.uid,m="glb:".concat(f.toString()),S=await Sr(m),T=c.map((R=>({turnServerURL:R.address,tcpport:s==="proxy3"?void 0:R.tcpport||Qn.tcpport,udpport:s==="proxy4"?void 0:R.udpport||Qn.udpport,username:m,password:S,forceturn:s!=="proxy4",security:s==="proxy5"})));h.push(...T)}return e.turnServer={mode:"manual",servers:h},w.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),l}async function ej(e,t,i,r,a){const s=G("ACCOUNT_REGISTER").slice(0,G("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?s.map((d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"))):s.map((d=>"https://".concat(d,"/api/v1")));const c=a?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const d=await(async function(l,h,_,f,m){const S=Date.now(),T={sid:_.sid,opid:10,appid:_.appId,string_uid:h};let R=l[0];const C=await Vc((()=>Sc(R+"".concat(R.indexOf("?")===-1?"?":"&","action=stringuid"),{data:T,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((b,N)=>{if(b.code===0){if(b.uid<=0||b.uid>=Math.pow(2,32))throw w.error("Invalid Uint Uid ".concat(h," => ").concat(b.uid),b),J.reqUserAccount(T.sid,{lts:S,success:!1,serverAddr:R,stringUid:T.string_uid,uid:b.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:T}),new oe(L.INVALID_UINT_UID_FROM_STRING_UID);return J.reqUserAccount(T.sid,{lts:S,success:!0,serverAddr:R,stringUid:T.string_uid,uid:b.uid,errorCode:null,extend:T}),!1}const k=_R(b.code);return k.retry&&(R=l[(N+1)%l.length]),J.reqUserAccount(T.sid,{lts:S,success:!1,serverAddr:R,stringUid:T.string_uid,uid:b.uid,errorCode:k.desc,extend:T}),k.retry}),((b,N)=>b.code!==L.OPERATION_ABORTED&&(J.reqUserAccount(T.sid,{lts:S,success:!1,serverAddr:R,stringUid:T.string_uid,uid:null,errorCode:b.code,extend:T}),R=l[(N+1)%l.length],!0)),m);if(C.code!==0){const b=_R(C.code);throw new oe(L.UNEXPECTED_RESPONSE,b.desc)}return C})(o,e,t,i,r);return a?.recordJoinChannelService({status:"success",endTs:Date.now()},c),d.uid}catch(d){throw a?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},c),d}}async function CH(e,t,i){const r=G("ACCOUNT_REGISTER");let a=[];a=t.proxyServer?r.map((s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1"))):r.map((s=>"https://".concat(s,"/api/v1")));try{return await $B({referenceList:a,asyncMapHandler:o=>(async function(c,d,l,h){const _=Date.now(),f={sid:l.sid,opid:10,appid:l.appId,string_uid:d};try{const m=await Sc(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:f,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(m.code!==0){const S=_R(m.code);throw new oe(L.UNEXPECTED_RESPONSE,"preload sua error:".concat(S.desc),S)}if(m.uid<=0||m.uid>=Math.pow(2,32))throw new oe(L.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_,url:c,req:f,uid:m.uid,elapse:Date.now()-_}}catch(m){throw m}})(o,e,t,i),closeFn:o=>o.code===L.OPERATION_ABORTED||o.code===L.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function tj(e,t,i){const r=G("CDS_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config"))),a=r.map((d=>(function(l,h,_,f){const m=_i(),S={flag:64,cipher_method:0,features:Il(Il(Il(Il(Il({install_id:dc(),device:m.name,system:m.os,system_general:navigator.userAgent,vendor:h.appId,version:lc,cname:h.cname,session_id:h.sid,proxyServer:h.proxyServer,sdk_type:Rn.WEB_RTC,browser_name:m.name,browser_version:m.version,user_agent:navigator.userAgent,channel_name:h.cname},h.stringUid&&{string_uid:h.stringUid}),h.uid&&{uid:h.uid+""}),m.os&&{os_name:m.os}),m.osVersion&&{os_version:m.osVersion}),{},{detail:""})};return Vc((()=>Sc(l,{data:S,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(T=>T.code!==L.OPERATION_ABORTED),f)})(d,e,t,i)));let s=null,o=null,c={};try{s=await rp(a)}catch(d){if(d.code===L.OPERATION_ABORTED)throw d;o=d}if(a.forEach((d=>d.cancel())),J.reportApiInvoke(e.sid,{name:Gt.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{c=(function(d){if(!d.test_tags)return{};const l=d.test_tags,h=Object.keys(l),_={};return h.forEach((f=>{var m;const S=hr(m=f.slice(4)).call(m),T=JSON.parse(l[f]),R=T[1];_[S]={tag:T[0]||"",value:R}})),_})(s)}catch{}return c}async function KU(e,t){const i=G("WEBCS_DOMAIN").concat(G("WEBCS_DOMAIN_BACKUP_LIST")).map((r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:vR(),serviceIds:[hn.CHOOSE_SERVER,hn.CLOUD_PROXY_FALLBACK]})));try{return await $B({referenceList:i,asyncMapHandler:a=>(async function(s,o,c){let d,{url:l,areaCode:h,serviceIds:_}=s;const f=Date.now(),[m,S]=GU(o,h,_);let T=Zr.networkState;try{T&&Zr.networkState===cs.OFFLINE&&Zr.onlineWaiter&&await se.race([Zr.onlineWaiter,Ht(ln.maxRetryTimeout)]),T=Zr.networkState;const{data:R,headers:C}=await Sc(l,{data:m,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=C.http3==="1"?1:-1,(P=>{const U=[];if(P.response_body.forEach((W=>{const z=W.buffer.code;if(W.uri===23&&z===0&&!W.buffer.edges_services)if(W.buffer.flag===4194310)W.buffer.edges_services=[];else{const Q={error:new oe(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:P.detail[502]}),flag:W.buffer.flag};U.push(Q)}if(z!==0){const Q=_R(z),he={error:new oe(L.CAN_NOT_GET_GATEWAY_SERVER,Q.desc,{desc:Q.desc,retry:Q.retry,csIp:P.detail[502]}),flag:W.buffer.flag};W.buffer.flag===4194310?w.warning(he.error.toString()):U.push(he)}})),U.length)throw new oe(L.CAN_NOT_GET_GATEWAY_SERVER,U.map((W=>"flag: ".concat(W.flag,", message: ").concat(W.error.message))).join(" | "),{retry:!!U.find((W=>W.error.data.retry)),csIp:P.detail[502],desc:[...new Set(U.map((W=>{var z;return W==null||(z=W.error)===null||z===void 0||(z=z.data)===null||z===void 0?void 0:z.desc})).filter((W=>!!W)))]})})(R);const N=gR(R,hn.CHOOSE_SERVER),k=gR(R,hn.CLOUD_PROXY_FALLBACK);return BU(N),{gatewayInfo:po(N,l),proxyInfo:k,opid:S,requestTime:f,url:l,isHttp3:d,elapse:Date.now()-f}}catch(R){throw R}})(a,e,t),closeFn:a=>a.code===L.OPERATION_ABORTED||a.code===L.CAN_NOT_GET_GATEWAY_SERVER&&!a.data.retry})}catch(r){throw r}}async function ij(e,t,i,r){const a=G("PROXY_SERVER_TYPE3"),s=(m,S,T)=>{let R=T||a;return Array.isArray(R)&&(R=S%2==0&&a[1]||a[0]),"https://".concat(R,"/ap/?url=").concat(m)};let o=null;const c=[],d=async()=>{const m=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(((R,C)=>{let b;return b=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(R,"/api/v2/transpond/webrtc?v=2"),C,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(R,"/api/v2/transpond/webrtc?v=2"):s("".concat(R,"/api/v2/transpond/webrtc?v=2"),C),{url:b,areaCode:vR(),serviceIds:[hn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?hn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?hn.CLOUD_PROXY:hn.CLOUD_PROXY_FALLBACK]}})),S=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:m.map((R=>R.url))}),T=await bR({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:R=>(w.debug("[".concat(e.clientId,"] Connect to choose_server:"),R.url),FU(R,e,t,i)),allFailedhandler:R=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:R},S),R[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},S),T},l=async()=>{if(await Ht(1e3),o!==null)return o;const m=G("WEBCS_DOMAIN_BACKUP_LIST").map(((R,C)=>{let b;return b=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(R,"/api/v2/transpond/webrtc?v=2"),C,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(R,"/api/v2/transpond/webrtc?v=2"):s("".concat(R,"/api/v2/transpond/webrtc?v=2"),C),{url:b,areaCode:vR(),serviceIds:[hn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?hn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?hn.CLOUD_PROXY:hn.CLOUD_PROXY_FALLBACK]}})),S=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:m.map((R=>R.url))}),T=await bR({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:R=>(w.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),R.url),FU(R,e,t,i)),allFailedhandler:R=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:R},S),R[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},S),T};let h,_,f;try{({gatewayInfo:h,proxyInfo:_,url:f}=await rp([d(),l()]))}catch(m){throw m[0]}if(c.length&&c.forEach((m=>m.cancel&&typeof m.cancel=="function"&&m.cancel())),!h||!_)throw new oe(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=f,e.cloudProxyServer!=="disabled"&&Array.isArray(a)&&f){const m=/^https?:\/\/(.+?)(\/.*)?$/.exec(f)[1];ee(a).call(a,m)&&(e.proxyServer=m,w.setProxyServer(m),J.setProxyServer(m))}return o={gatewayInfo:h,proxyInfo:await YO(_,h.uid)},o}async function bH(e,t,i){const r=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap"))),a=r.map((s=>(function(o,c,d,l){const h={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:lc,cname:c.cname,uid:c.uid.toString(),requestId:QO,seq:QO};QO+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(h)};return Vc((async()=>{const f=await Sc(o,{data:_,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(f.code!==0){const S=new oe(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+f.code,{retry:!0});throw w.error(S.toString()),S}const m=JSON.parse(f.json_body);if(m.code!==200){const S=new oe(L.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(m.code,", reason: ").concat(m.reason));throw w.error(S.toString()),S}if(!m.servers||m.servers.length===0){const S=new oe(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw w.error(S.toString()),S}return{vid:m.vid,workerToken:m.workerToken,addressList:(G("CHANNEL_MEDIA_RELAY_SERVERS")||m.servers).map((S=>"wss://".concat(S.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(S.wss)))}}),void 0,(f=>!!(f.code!==L.OPERATION_ABORTED&&f.code!==L.UNEXPECTED_RESPONSE||f.data&&f.data.retry)),l)})(s,e,t,i)));try{const s=await rp(a);return a.forEach((o=>o.cancel())),s}catch(s){throw s[0]}}async function rj(e,t,i){let r=null;const a=[],s=async o=>{const c=G(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2")));return o&&(await Ht(1e3),r!==null)?r:await bR({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:d=>(w.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),d),(function(l,h,_,f){const[m]=CR(h,[hn.CHOOSE_SERVER]);let S=Zr.networkState;return Vc((async()=>{S&&Zr.networkState===cs.OFFLINE&&Zr.onlineWaiter&&await se.race([Zr.onlineWaiter,Ht(f&&f.maxRetryTimeout||ln.maxRetryTimeout)]),S=Zr.networkState;const T=await Sc(l,{data:m,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return jU(T,l)}),(()=>!1),(T=>T.code!==L.OPERATION_ABORTED&&(T.code===L.UPDATE_TICKET_FAILED?T.data.retry:(w.warning("[".concat(h.clientId,"] update ticket network error, retry"),T),!0))),f)})(d,e,t,i)),allFailedhandler:d=>{throw d[0]},promisesCollector:a})};try{return r=await rp([s(!1),s(!0)]),a.length&&a.forEach((o=>o.cancel&&typeof o.cancel=="function"&&o.cancel())),r}catch(o){throw o[0]}}function t0(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function YU(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?t0(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t0(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}class AH extends or{get isSuccess(){return!!this.configs}constructor(t,i){super(),V(this,"configs",void 0),V(this,"store",void 0),V(this,"joinInfo",void 0),V(this,"cancelToken",void 0),V(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),V(this,"interval",void 0),V(this,"mutex",void 0),V(this,"mutableParamsRead",!1),V(this,"configCache",{}),V(this,"limit_bitrate",void 0),this.mutex=new Wn("config-distribute",t),this.store=i}startGetConfigDistribute(t,i){this.joinInfo=t,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),G("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),G("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,J.reportApiInvoke(null,{options:void 0,name:Gt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Tr.TRACER}).onSuccess(JSON.stringify(ft))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void w.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const i=await this.mutex.lock();try{t=await tj(this.joinInfo,this.cancelToken,this.retryConfig),w.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=(function(a){var s;const o=vt(s=Object.keys(a).filter((l=>/^webrtc_ng_global_parameter/.test(l)))).call(s);for(let l=0;l<o.length;l++)for(let h=o.length-1;h>l;h--){const _=o[h],f=a[_].value;if(typeof f.__priority=="number"){const m=f.__priority,S=o[h-1],T=a[S].value;if(typeof T.__priority=="number"){if(!(m>T.__priority))continue;{const R=_;o[h]=o[h-1],o[h-1]=R}}else{const R=_;o[h]=o[h-1],o[h-1]=R}}}const c=Date.now();let d={};return o.forEach((l=>{const h=a[l].value.__expires;h&&h<=c||(d[l]=a[l])})),d})(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const a=new oe(L.NETWORK_RESPONSE_ERROR,r);w.warning("[config-distribute] ".concat(a.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){TU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(hR.UPDATE_BITRATE_LIMIT,t):this.emit(hR.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&YU({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const i={},r=Object.keys(t),a=[];r.forEach((s=>{const o=t[s].value;i[s]=o;const c=o.__id;if(c&&this.configCache[s]&&this.configCache[s].__id===c)return;const d=o.__type,l=t[s].value,h=t[s].tag;let _=0;d?d===ml.REALTIME&&(_=1):Object.keys(l).some((f=>Object.prototype.hasOwnProperty.call(dr,f)||!uU()&&Object.prototype.hasOwnProperty.call($T,f)?(_=1,!0):void 0)),a.push({tag:h,isApplied:_,feature:s,params:JSON.stringify(o)})})),a.forEach((s=>{let{tag:o,feature:c,params:d,isApplied:l}=s;this.store.sessionId&&J.abTest(this.store.sessionId,{intSucc:1,isApplied:l,tag:o,feature:c,params:d,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=i}catch(i){w.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(t){const i=(function(a){const s={};return Object.keys(a).forEach((o=>{const c=a[o].value,d=c.__expires,l=c.__type;Object.keys(c).forEach((h=>{h==="__id"||h==="__type"||h==="__priority"||h==="__expires"||Object.prototype.hasOwnProperty.call(s,h)||(s[h]=YU(YU({value:c[h]},d&&{expires:d}),l&&{type:l}))}))})),s})(t);try{var r;const a=(r=i.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete i.LIMIT_BITRATE,a&&TU(a)&&this.handleBitrateLimit(a),this.limit_bitrate=a,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(t),(function(c){try{const d=Date.now();Object.keys(c).forEach((l=>{const{value:h,type:_,expires:f}=c[l];f&&f<=d||((_===ml.REALTIME||Object.prototype.hasOwnProperty.call(dr,l))&&(ft[l]=h,Ct[l]=h,w.debug("Update realtime parameters from config distribute",l,h)),_||uU()||!Object.prototype.hasOwnProperty.call($T,l)||(ft[l]=h,Ct[l]=h,w.debug("Update gateway parameters from config distribute",l,h)))}))}catch(d){w.error("Error update config immediately: ".concat(c),d.message)}})(i);const s=JSON.stringify(i),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),w.debug("Caching global parameters ".concat(s))}catch(a){w.error("Error caching global parameters:",a.message)}}handleGlobalParameterConfig(t){try{const i=Date.now();Object.keys(t).forEach((r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Ct,r)){const{value:a,expires:s}=t[r];if(s&&s<=i)return;(function(o,c){try{return typeof o=="object"&&typeof c=="object"&&JSON.stringify(o)===JSON.stringify(c)}catch{return!1}})(Ct[r],a)||(ft[r]=a,Ct[r]=a,this.emit(hR.UPDATE_CLIENT_ROLE_OPTIONS,a),w.debug("Updating client role options: ".concat(JSON.stringify(a))))}}))}catch(i){w.error("Error handling global parameter config:",i.message)}}}class zU extends or{constructor(){super(...arguments),V(this,"resultStorage",new Map)}setLocalAudioStats(t,i,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,i))}setLocalVideoStats(t,i,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,i)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,i)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!i.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,i){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(i))}setRemoteVideoStats(t,i){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(i))}record(t,i,r){if(G("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const a=this.resultStorage.get(t);if(!a)return;a.result.push(r);const s=t==="VIDEO_ENCODE_FAILED"?G("ENCODE_EXCEPTION_TIMES"):5;if(a.result.length>=s){var o;const c=ee(o=a.result).call(o,!0);a.isPrevNormal&&!c&&this.emit("exception",Ia[t],t,i),!a.isPrevNormal&&c&&this.emit("exception",Ia[t]+2e3,t+"_RECOVER",i),a.isPrevNormal=c,a.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,i){return i instanceof xn&&!i.isActive||!!i.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,i){let r=null;i._encoderConfig&&i._encoderConfig.frameRate&&(r=Bo(i._encoderConfig.frameRate));const a=t.captureFrameRate;return!r||!a||!(r>10&&a<5||r<10&&r>=5&&a<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var i;return!(!t.codecType||ee(i=G("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(i,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,i){return!!i.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,i){return i instanceof xn&&!i.isActive||!!i.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Ia={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ja=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(i.length>0){const r=i[i.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(i.length>0){const r=i[i.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function _E(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Ju(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?_E(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_E(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}class AR{constructor(t){V(this,"store",void 0),V(this,"onStatsException",void 0),V(this,"onUploadPublishDuration",void 0),V(this,"onStatsChanged",void 0),V(this,"onVideoCodecChanged",void 0),V(this,"localStats",new Map),V(this,"remoteStats",new Map),V(this,"updateStatsInterval",void 0),V(this,"trafficStats",void 0),V(this,"trafficStatsPeerList",[]),V(this,"uplinkStats",void 0),V(this,"exceptionMonitor",void 0),V(this,"p2pChannel",void 0),V(this,"scalabilityMode",ZT.L1T1),V(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=t,this.exceptionMonitor=new zU,this.exceptionMonitor.on("exception",((i,r,a)=>{this.onStatsException&&this.onStatsException(i,r,a)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ee.LocalAudioTrack)||Ju({},gb)}getLocalVideoTrackStats(){return this.localStats.get(Ee.LocalVideoTrack)||Ju({},yO)}getRemoteAudioTrackStats(t){const i=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find((d=>d.peer_uid===s));return c&&(o.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var a;const s=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.audioStats;s&&(r[t]=i(t,s))}else Array.from(this.remoteStats.entries()).forEach((s=>{let[o,{audioStats:c}]=s;c&&(r[o]=i(o,c))}));return r}getRemoteNetworkQualityStats(t){const i={};if(t){var r;const a=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;a&&(i[t]=a)}else Array.from(this.remoteStats.entries()).forEach((a=>{let[s,{networkStats:o}]=a;o&&(i[s]=o)}));return i}getRemoteVideoTrackStats(t){const i=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find((d=>d.peer_uid===s));return c&&(o.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var a;const s=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.videoStats;s&&(r[t]=i(t,s))}else Array.from(this.remoteStats.entries()).forEach((s=>{let[o,{videoStats:c}]=s;c&&(r[o]=i(o,c))}));return r}getRTCStats(){let t=0,i=0,r=0,a=0;const s=this.localStats.get(Ee.LocalAudioTrack);s&&(t+=s.sendBytes,i+=s.sendBitrate);const o=this.localStats.get(Ee.LocalVideoTrack);o&&(t+=o.sendBytes,i+=o.sendBitrate);const c=this.localStats.get(Ee.LocalVideoLowTrack);c&&(t+=c.sendBytes,i+=c.sendBitrate),this.remoteStats.forEach((l=>{let{audioStats:h,videoStats:_}=l;h&&(r+=h.receiveBytes,a+=h.receiveBitrate),_&&(r+=_.receiveBytes,a+=_.receiveBitrate)}));let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:i,SendBytes:t,RecvBytes:r,RecvBitrate:a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter((i=>i.B_ppad!==void 0||i.B_ppvd!==void 0)),t.peer_delay.filter((i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1)).forEach((i=>{var r;const a=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(i.peer_uid),s=a!=null&&a.videoSSRC?ja.measureFromSubscribeStart(this.store.clientId,a.videoSSRC):0,o=a!=null&&a.audioSSRC?ja.measureFromSubscribeStart(this.store.clientId,a.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(i.peer_uid))})),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&w.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,i,r){if(!t)return!1;const a=!!r&&i.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||i.framesDecodeCount>r.framesDecodeCount;return a||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach((i=>{let[r,a]=i;switch(r){case Ee.LocalVideoTrack:case Ee.LocalVideoLowTrack:{const c=a,d=Ju({},yO),l=t.getStats(),h=t.getLocalMedia(r);if(l){const _=l.videoSend.find((f=>f.ssrc===h?.ssrcs[0].ssrcId));if(_){const f=t.getLocalVideoSize(),m=t.getEncoderConfig(Ee.LocalVideoTrack);var s;(_.codec==="H264"||_.codec==="H265"||_.codec==="VP8"||_.codec==="VP9"||_.codec==="AV1X"||_.codec==="AV1")&&(d.codecType=_.codec,c?.codecType!==_.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,_.codec.toLocaleLowerCase()))),d.sendBytes=_.bytes,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0,_.inputFrame?(d.captureFrameRate=_.inputFrame.frameRate,d.captureResolutionHeight=_.inputFrame.height,d.captureResolutionWidth=_.inputFrame.width):f&&(d.captureResolutionWidth=f.width,d.captureResolutionHeight=f.height),_.sentFrame?(d.sendFrameRate=_.sentFrame.frameRate,d.sendResolutionHeight=_.sentFrame.height,d.sendResolutionWidth=_.sentFrame.width):f&&(d.sendResolutionWidth=f.width,d.sendResolutionHeight=f.height),_.avgEncodeMs&&(d.encodeDelay=_.avgEncodeMs),m&&m.bitrateMax?d.targetSendBitrate=1e3*m.bitrateMax:_.targetBitrate&&(d.targetSendBitrate=_.targetBitrate),d.sendPackets=_.packets,d.sendPacketsLost=_.packetsLost,d.sendJitterMs=_.jitterMs,d.sendRttMs=_.rttMs,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(d.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(w.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(r,d),(c?.sendResolutionWidth!==d.sendResolutionWidth||c?.sendResolutionHeight!==d.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&h&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,h.track,d);break}case Ee.LocalAudioTrack:{const c=a,d=Ju({},gb),l=t.getStats(),h=t.getLocalMedia(r);if(l){const _=l.audioSend.find((f=>f.ssrc===h?.ssrcs[0].ssrcId));if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(d.codecType=_.codec),_.inputLevel)d.sendVolumeLevel=Math.round(32767*_.inputLevel);else{const f=t.getLocalAudioVolume();f&&(d.sendVolumeLevel=Math.round(32767*f))}d.sendBytes=_.bytes,d.sendPackets=_.packets,d.sendPacketsLost=_.packetsLost,d.sendJitterMs=_.jitterMs,d.sendRttMs=_.rttMs,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ee.LocalAudioTrack,d),d&&h&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,h.track,d);break}}}))}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach((i=>{var r,a;let[s,{videoStats:o,audioStats:c,videoPcStats:d}]=i;const l=c,h=o,_=d,f=Ju({},IB),m=Ju({},Cs),S=Ju({},wB),{audioTrack:T,videoTrack:R,audioSSRC:C,videoSSRC:b}=t.getRemoteMedia(s);let N;N=this.store.useP2P?t.getStats(!0):t.getStats();const k=(r=N)===null||r===void 0?void 0:r.audioRecv.find((z=>z.ssrc===C)),P=(a=N)===null||a===void 0?void 0:a.videoRecv.find((z=>z.ssrc===b)),U=this.trafficStats&&this.trafficStats.peer_delay.find((z=>z.peer_uid===s));if(k&&(k.codec!=="opus"&&k.codec!=="aac"&&k.codec!=="PCMU"&&k.codec!=="PCMA"&&k.codec!=="G722"||(f.codecType=k.codec),k.outputLevel?f.receiveLevel=Math.round(32767*k.outputLevel):T&&(f.receiveLevel=Math.round(32767*T.getVolumeLevel())),f.receiveBytes=k.bytes,f.receivePackets=k.packets,f.receivePacketsLost=k.packetsLost,f.receivePacketsDiscarded=k.packetsDiscarded,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.receiveBitrate=l?8*Math.max(0,f.receiveBytes-l.receiveBytes):0,f.totalDuration=l?l.totalDuration+1:1,f.totalFreezeTime=l?l.totalFreezeTime:0,f.freezeRate=f.totalFreezeTime/f.totalDuration,f.receiveDelay=k.jitterBufferMs,f.totalDuration>10&&AR.isRemoteAudioFreeze(T)&&(f.totalFreezeTime+=1)),P){var W;P.codec!=="H264"&&P.codec!=="H265"&&P.codec!=="VP8"&&P.codec!=="VP9"&&P.codec!=="AV1X"&&P.codec!=="AV1"||(m.codecType=P.codec),m.receiveBytes=P.bytes,m.receiveBitrate=h?8*Math.max(0,m.receiveBytes-h.receiveBytes):0,m.decodeFrameRate=P.decodeFrameRate<0?0:P.decodeFrameRate,m.renderFrameRate=P.decodeFrameRate<0?0:P.decodeFrameRate,P.outputFrame&&(m.renderFrameRate=P.outputFrame.frameRate),P.receivedFrame?(m.receiveFrameRate=P.receivedFrame.frameRate,m.receiveResolutionHeight=P.receivedFrame.height,m.receiveResolutionWidth=P.receivedFrame.width):R&&(m.receiveResolutionHeight=R._videoHeight||0,m.receiveResolutionWidth=R._videoWidth||0),P.framesRateFirefox!==void 0&&(m.receiveFrameRate=Math.round(P.framesRateFirefox)),m.receivePackets=P.packets,m.receivePacketsLost=P.packetsLost,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost);const z=h?h.totalFreezeTime:0,Q=h?h.totalDuration:0;m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=(W=P.totalFreezesDuration)!==null&&W!==void 0?W:z||0,m.receiveDelay=P.jitterBufferMs||0;const he=!!b&&t.getRemoteVideoIsReady(b);P.totalFreezesDuration===void 0&&R&&he&&AR.isRemoteVideoFreeze(R,P,_)&&(m.totalFreezeTime+=1),m.freezeRate=Math.max(0,Math.min((m.totalFreezeTime-z)/(m.totalDuration-Q),1))}U&&(f.end2EndDelay=U.B_ad,m.end2EndDelay=U.B_vd,f.transportDelay=U.B_ed,m.transportDelay=U.B_ed,f.currentPacketLossRate=U.B_ealr4/100,m.currentPacketLossRate=U.B_evlr4/100,S.uplinkNetworkQuality=U.B_punq?U.B_punq:0,S.downlinkNetworkQuality=U.B_pdnq?U.B_pdnq:0),this.remoteStats.set(s,{audioStats:f,videoStats:m,videoPcStats:P,networkStats:S}),T&&this.exceptionMonitor.setRemoteAudioStats(T,f),R&&this.exceptionMonitor.setRemoteVideoStats(R,m)}))}}class qU{constructor(){V(this,"destChannelMediaInfos",new Map),V(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){As(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){As(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Dg(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function g_(e){if(!(e instanceof qU))return new oe(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!t)return new oe(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new oe(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class S_{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,i){V(this,"uid",void 0),V(this,"_uintid",void 0),V(this,"_trust_in_room_",!0),V(this,"_trust_audio_enabled_state_",!0),V(this,"_trust_video_enabled_state_",!0),V(this,"_trust_audio_mute_state_",!0),V(this,"_trust_video_mute_state_",!0),V(this,"_audio_muted_",!1),V(this,"_video_muted_",!1),V(this,"_audio_enabled_",!0),V(this,"_video_enabled_",!0),V(this,"_audio_added_",!1),V(this,"_video_added_",!1),V(this,"_is_pre_created",!1),V(this,"_video_pre_subscribed",!1),V(this,"_audio_pre_subscribed",!1),V(this,"_trust_video_stream_added_state_",!0),V(this,"_trust_audio_stream_added_state_",!0),V(this,"_audioTrack",void 0),V(this,"_videoTrack",void 0),V(this,"_dataChannels",[]),V(this,"_audioSSRC",void 0),V(this,"_videoSSRC",void 0),V(this,"_audioOrtc",void 0),V(this,"_videoOrtc",void 0),V(this,"_cname",void 0),V(this,"_rtxSsrcId",void 0),V(this,"_videoMid",void 0),V(this,"_audioMid",void 0),this.uid=t,this._uintid=i}}function i0(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function IR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?i0(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):i0(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}const wR="9",OR=2e4,Yb=4e4;function np(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Zc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?np(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):np(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}var T_=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(T_||{});const zb=new Map;function XU(e,t,i,r){let{scale:a}=e;if(a===0&&r===T_.UP||a>=t.length-1&&r===T_.DOWN)return e;let s=Zc(Zc({},e),{},{scale:r===T_.DOWN?++a:--a});switch(i){case"maintain-framerate":s=Zc(Zc({},s),t[a].motion);break;case"maintain-resolution":s=Zc(Zc({},s),t[a].detail);break;case"balanced":s=Zc(Zc({},s),t[a].balanced)}return s}function JU(e,t){if(t){const i={overUse:0,underUse:0,adaptationList:nj(t)};zb.set(e,i)}else zb.delete(e)}function nj(e){const t=Zc({},e),{bitrateMax:i,frameRate:r,scaleResolutionDownBy:a,bitrateMin:s}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:h,BWE_SCALE_UP_THRESHOLD:_,BWE_SCALE_DOWN_THRESHOLD:f,PERF_SCALE_DOWN_THRESHOLD:m,PERF_SCALE_UP_THRESHOLD:S,BALANCE_BITRATE_FACTOR:T,BALANCE_FRAMERATE_FACTOR:R,BALANCE_RESOLUTION_FACTOR:C,MOTION_RESOLUTION_FACTOR:b,MOTION_BITRATE_FACTOR:N,DETAIL_FRAMERATE_FACTOR:k,DETAIL_BITRATE_FACTOR:P}=fb,U=Math.min(t.frameRate,c),W=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(f,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(m,1)*U),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s}}];for(let z=1;z<=d;z++){const Q={bwe_up:Math.round(Math.pow(_,z)*i),bwe_down:Math.round(Math.pow(f,z+1)*i),fps_up:Math.round(Math.pow(S,z)*U),fps_down:Math.round(Math.pow(m,z+1)*U)},he={scaleResolutionDownBy:a/Math.pow(C,z),frameRate:Math.max(Math.round(Math.pow(R,z)*r),o),bitrateMax:Math.max(Math.round(Math.pow(T,z)*i),h),bitrateMin:Math.max(Math.round(Math.pow(T,z)*s),l)},Ge={scaleResolutionDownBy:a/Math.pow(b,z),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(N,z)*i),h),bitrateMin:Math.max(Math.round(Math.pow(N,z)*s),l)},xe={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(k,z)*r),o),bitrateMax:Math.max(Math.round(Math.pow(P,z)*i),h),bitrateMin:Math.max(Math.round(Math.pow(P,z)*s),l)};W.push({scale:z,threshold:Q,balanced:he,motion:Ge,detail:xe})}return W}function aj(e,t,i,r,a,s){const o=zb.get(e)||{overUse:0,underUse:0,adaptationList:nj(a)},{adaptationList:c}=o;zb.set(e,o);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:l}=fb,{scale:h}=r;let _,f;return typeof t=="number"&&t>0&&(function(m,S,T,R){if(S>=T.length)return!1;let{threshold:{fps_down:C}}=T[S];return G("FORCE_AG_HIGH_FRAMERATE")&&R==="maintain-framerate"&&(C=T[0].threshold.fps_down),m<C})(t,h,c,s)&&(o.overUse++,f=nE.CPU,o.overUse>d)||typeof i=="number"&&i>0&&(function(m,S,T){if(S>=T.length)return!1;const{threshold:{bwe_down:R}}=T[S];return m<R})(i,h,c)&&(o.overUse++,f=nE.BANDWIDTH,o.overUse>d)?(o.overUse=0,o.underUse=0,_=XU(r,c,s,T_.DOWN),[_,f]):(typeof t=="number"&&t>0&&typeof i=="number"&&i>0&&(function(m,S,T,R){if(S===0)return;let{threshold:{fps_up:C}}=T[S];return G("FORCE_AG_HIGH_FRAMERATE")&&R==="maintain-framerate"&&(C=T[1].threshold.fps_up),m>C})(t,h,c,s)&&(function(m,S,T){if(S===0)return;const{threshold:{bwe_up:R}}=T[S];return m>R})(i,h,c)&&(o.underUse++,o.underUse>l&&(o.overUse=0,o.underUse=0,_=XU(r,c,s,T_.UP),_.scale===0&&(f=nE.NONE))),[_,f])}function r0(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function NR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?r0(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r0(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}const Mg=new Map;function n0(e,t){const i=Mg.get(e);if(i){const{timer:r}=i;window.clearTimeout(r),Mg.delete(e)}t.qualityLimitationReason=nE.NONE,JU(e)}function ZU(e,t){var i;let r;switch(t){case Ee.LocalAudioTrack:r=Vt.Audio;break;case Ee.LocalVideoTrack:r=ee(i=e._hints).call(i,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High;break;case Ee.LocalVideoLowTrack:r=Vt.Low}return r}function qb(e){const t=Si();if(e.some((i=>i._bypassWebAudio)))throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function QU(e,t){qb(e);const i=new xn;return e.forEach((r=>i.addAudioTrack(r))),i}const a0=!Si().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&fl();function DR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return a0?(i={spec:t,store:e},ip("PlanBConnection").create(i)):new vn(t,e)}function s0(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function Ei(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(qT(e.turnServer.servers))return!1;if(G("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((t=>t.forceturn)))return!0}return!1}catch{return!1}}var mi;function wl(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function wa(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?wl(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wl(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}let vn=(mi=class yA extends ze{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var i;return ee(i=Object.keys(eR)).call(i,t)})))]}constructor(t,i){super(t,i),V(this,"id",Mi(5,"connection-")),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"forceTurn",!1),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"transportEventReceiver",void 0),V(this,"statsFilter",void 0),V(this,"extension",{useXR:G("USE_XR")}),V(this,"localCapabilities",void 0),V(this,"remoteCodecs",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"isPreallocation",!1),V(this,"preMediaMap",new Map),V(this,"dataStreamChannelMap",new Map),V(this,"establishPromise",void 0),V(this,"recoveredDataChannelIds",[]),V(this,"currentDataChannelId",1),V(this,"supportAV1RtpSpec",!1),V(this,"mutex",void 0),V(this,"qualityLimitationReason",nE.NONE),V(this,"isFirstConnected",!1),this.store=i,this.forceTurn=Ei(t),this.mutex=new Wn("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(yA.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=mO(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Ci()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,i){if(this.remoteCodecs=i,!this.remoteSDP)return void w.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(t,i,this.store.codec)){const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();a?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else w.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=__(r.sdp),s=await OU({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=f_(s),this.initialOffer=r,G("ENABLE_SVC")&&this.store.codec=="av1"){const c=await(async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:ZT.L1T3}]});const l=await d.createOffer();if(!l.sdp)return void d.close();const h=ya(l.sdp).mediaDescriptions[0];if(!h)return;const _=h.attributes.extmaps.find((f=>f.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"));return d.close(),_}catch{return}})();var t;c&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(c))}let o;return r.sdp&&PU(r.sdp)&&(o=qi(s),(i=o).send&&(Lg(Me.VIDEO,i.send.videoExtensions),Lg(Me.AUDIO,i.send.audioExtensions)),i.recv&&(Lg(Me.VIDEO,i.recv.videoExtensions),Lg(Me.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(Lg(Me.VIDEO,i.sendrecv.videoExtensions),Lg(Me.AUDIO,i.sendrecv.audioExtensions))),wa(wa({},a),{},{rtpCapabilities:o||s,offerSDP:r.sdp})}catch(r){throw new _e(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var i}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&PU(this.initialOffer.sdp)&&(i=t.rtpCapabilities,r=this.localCapabilities,i.send&&(p_(Me.VIDEO,i.send.videoExtensions,r.send.videoExtensions),p_(Me.AUDIO,i.send.audioExtensions,r.send.audioExtensions)),i.recv&&(p_(Me.VIDEO,i.recv.videoExtensions,r.recv.videoExtensions),p_(Me.AUDIO,i.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return qi(this._localCapabilities)}get rtpCapabilities(){return qi(this._rtpCapabilities)}get candidates(){return qi(this._candidates)}get iceParameters(){return qi(this._iceParameters)}get dtlsParameters(){return qi(this._dtlsParameters)}constructor(d){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1],h=arguments.length>2&&arguments[2]!==void 0&&arguments[2];V(this,"sessionDesc",void 0),V(this,"_localCapabilities",void 0),V(this,"_rtpCapabilities",void 0),V(this,"_candidates",void 0),V(this,"_originCandidates",void 0),V(this,"_iceParameters",void 0),V(this,"_isUseExtmapAllowMixed",void 0),V(this,"_isUseLocalCodecs",void 0),V(this,"_dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname",void 0),V(this,"useLocalCodecsMids",[]),V(this,"preloadSsrcs",[]),V(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=l,this._isUseLocalCodecs=h,d=qi(d);const{iceParameters:_,dtlsParameters:f,candidates:m,rtpCapabilities:S,setup:T,localCapabilities:R,cname:C}=d;this._rtpCapabilities=S,this._candidates=m,this._originCandidates=qi(m),this._iceParameters=_,this._dtlsParameters=f,this._localCapabilities=R,this.setup=T,this.cname=C,[this.sessionDesc]=this.updateRemoteRTPCapabilities(S),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(d){return d.length===this.preloadSsrcs.length&&d.every((l=>{var h;return ee(h=this.preloadSsrcs).call(h,l)}))}preloadRemoteMedia(d){let l=0;const h=[],_=[];for(;d>0;){const f=[IR({ssrcId:Yb+l},G("USE_SUB_RTX")?{rtx:Yb+l+1}:{})],m="".concat(Yb+l,"_").concat(OR+l),{ssrcs:S,ssrcGroups:T}=ep(f,this.cname,G("SYNC_GROUP")?m:void 0),R=this.preCreateOrRecycleSendMedia("video",S,T,void 0),C=[{ssrcId:OR+l}],b="".concat(Yb+l,"_").concat(OR+l),{ssrcs:N,ssrcGroups:k}=ep(C,this.cname,G("SYNC_GROUP")?b:void 0),P=this.preCreateOrRecycleSendMedia("audio",N,k,void 0);d--,l+=2,h.push(R,P),_.push(S[0].ssrcId,N[0].ssrcId)}return this.useLocalCodecsMids.push(...h),this.preloadSsrcs=_,{mids:h,preSSRCs:_,isAvailable:!0}}preCreateOrRecycleSendMedia(d,l,h,_){const f=this.rtpCapabilities.send.videoCodecs,m=this._isUseLocalCodecs||f.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;w.debug("create or recycle send media without remote rtp capabilities, ssrcs ",l[0].ssrcId);const S=d===Me.VIDEO?m.videoCodecs:m.audioCodecs,T=d===Me.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const R="".concat(this.currentMidIndex);let C={media:{mediaType:d,port:wR,protos:["UDP","TLS","RTP","SAVPF"],fmts:S.map((b=>b.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:T,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:h,rtcpFeedbackWildcards:[],payloads:S,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(R)}};return C=this.mungSendMediaDesc(C,_),this.sessionDesc.mediaDescriptions.push(C),this.updateBundleMids(),R}toString(){return aE(this.sessionDesc)}send(d,l,h,_){const{ssrcs:f,ssrcGroups:m}=ep(l,this.cname,G("SYNC_GROUP")?h:void 0),S=this.findPreloadMediaDesc(f);if(S){if(Ci()&&this.firefoxSsrcMidMap.set(f[0].ssrcId,S.attributes.mid),_&&(_.twcc||_.remb)){const T=this.sessionDesc.mediaDescriptions.indexOf(S);return this.sessionDesc.mediaDescriptions[T]=this.mungSendMediaDesc(S,_),{mid:S.attributes.mid,needExchangeSDP:!0}}return{mid:S.attributes.mid,needExchangeSDP:!1}}{const T=this.findAvailableMediaIndex(d,f);let R;return T===-1||T===1&&(Ra()||(function(){const C=_i();return!(C.name!==bi.CHROME||!C.osVersion)&&Number(C.version)<=90})()||G("ENABLE_ENCODED_TRANSFORM")&&dn())||T===0&&!(function(C){const b=_i();return!(b.name!==bi.FIREFOX||!b.osVersion)&&Number(b.version)===C})(138)&&G("USE_SUB_RTX")||Rg()?(R=this.createOrRecycleSendMedia(d,f,m,"sendonly",_),this.updateBundleMids()):(R=qi(this.sessionDesc.mediaDescriptions[T]),R.attributes.direction="sendonly",R.attributes.ssrcs=f,R.attributes.ssrcGroups=m,this.sessionDesc.mediaDescriptions[T]=this.mungSendMediaDesc(R,_)),Ci()&&this.firefoxSsrcMidMap.set(f[0].ssrcId,R.attributes.mid),{mid:R.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:d,needExchangeSDP:l}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:d.attributes.mid,needExchangeSDP:l}}batchSend(d){const l=d.map((f=>{let{kind:m,ssrcMsg:S,mslabel:T}=f;return this.send(m,S,T)})),h=[];let _=!1;return l.forEach((f=>{let{mid:m,needExchangeSDP:S}=f;S&&(_=!0),h.push(m)})),{mids:h,needExchangeSDP:_}}stopSending(d){const l=this.sessionDesc.mediaDescriptions.filter((h=>h.attributes.mid&&d.indexOf(h.attributes.mid)!==-1));if(l.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");l.forEach((h=>{h.attributes.mid==="0"||Ci()||Rg()?h.attributes.ssrcs=[]:(h.attributes.ssrcs=[],h.attributes.direction="inactive",h.media.port="0")})),this.updateBundleMids()}mute(d){const l=this.sessionDesc.mediaDescriptions.find((h=>h.attributes.mid===d));if(!l)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));l.attributes.direction="inactive"}unmute(d){const l=this.sessionDesc.mediaDescriptions.find((h=>h.attributes.mid===d));if(!l)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));l.attributes.direction="sendonly"}muteRemote(d){const l=this.sessionDesc.mediaDescriptions.filter((h=>ee(d).call(d,h.attributes.mid||"")));if(l.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");l.forEach((h=>{h.attributes.direction="inactive"}))}unmuteRemote(d){const l=this.sessionDesc.mediaDescriptions.filter((h=>ee(d).call(d,h.attributes.mid||"")));if(l.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");l.forEach((h=>{h.attributes.direction="recvonly"}))}receive(d,l,h,_){d.forEach(((f,m)=>{this.createOrRecycleRecvMedia(f,[],"recvonly",l,h,_[m])})),this.updateBundleMids()}stopReceiving(d){const l=this.sessionDesc.mediaDescriptions.filter((h=>d.indexOf(h.attributes.mid)!==-1));if(l.length!==d.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");l.forEach((h=>{h.media.port="0",h.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(d){const l=this.sessionDesc||ya((h=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(h?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var h;this._rtpCapabilities=d;let _=!1;const f=this.rtpCapabilities.send,m=this.localCapabilities.send,S=this.localCapabilities.recv,T=S.videoCodecs,R=S.audioCodecs,C=S.videoExtensions,b=S.audioExtensions;for(const U of l.mediaDescriptions){var N;if(U.attributes.direction!=="sendonly"||typeof U.attributes.mid!="string"||!ee(N=this.useLocalCodecsMids).call(N,U.attributes.mid)){if(_=!0,U.attributes.iceUfrag=this._iceParameters.iceUfrag,U.attributes.icePwd=this._iceParameters.icePwd,U.attributes.fingerprints=this._dtlsParameters.fingerprints,U.attributes.candidates=this._candidates,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var k;U.media.fmts=T.map((z=>z.payloadType.toString(10))),U.attributes.payloads=T,U.attributes.extmaps=C;const W=U.attributes.mid;typeof W!="string"||ee(k=this.useLocalCodecsMids).call(k,W)||this.useLocalCodecsMids.push(W)}else if(f.videoCodecs.length===0){const W=m.videoCodecs.filter((z=>{var Q,he;return(Q=z.rtpMap)===null||Q===void 0?void 0:ee(he=Q.encodingName.toLowerCase()).call(he,"vp8")}))||[m.videoCodecs[0]];U.media.fmts=W.map((z=>z.payloadType.toString(10))),U.attributes.payloads=W,U.attributes.extmaps=[]}else U.media.fmts=f.videoCodecs.map((W=>W.payloadType.toString(10))),U.attributes.payloads=f.videoCodecs,U.attributes.extmaps=f.videoExtensions;if(U.media.mediaType==="audio")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var P;U.media.fmts=R.map((z=>z.payloadType.toString(10))),U.attributes.payloads=R,U.attributes.extmaps=b;const W=U.attributes.mid;typeof W!="string"||ee(P=this.useLocalCodecsMids).call(P,W)||this.useLocalCodecsMids.push(W)}else if(f.audioCodecs.length===0){const W=m.audioCodecs.filter((z=>{var Q,he;return(Q=z.rtpMap)===null||Q===void 0?void 0:ee(he=Q.encodingName.toLowerCase()).call(he,"opus")}))||[m.audioCodecs[0]];U.media.fmts=W.map((z=>z.payloadType.toString(10))),U.attributes.payloads=W,U.attributes.extmaps=[]}else U.media.fmts=f.audioCodecs.map((W=>W.payloadType.toString(10))),U.attributes.payloads=f.audioCodecs,U.attributes.extmaps=f.audioExtensions,tp(U)}}return this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1,[this.sessionDesc,_]}updateCandidates(d){const l=this._originCandidates.filter((_=>_.transport==="udp")),h=[];if(l.forEach((_=>{h.push(IR(IR({},_),{},{foundation:"tcpcandidate",priority:Number(_.priority)-1+"",transport:"tcp",port:Number(_.port)+90+""}))})),l.length!==0){switch(d){case Tn.TCP_RELAY:this._candidates=h;break;case Tn.UDP_TCP_RELAY:case Tn.RELAY:this._candidates=[...l,...h];break;default:this._candidates=l}for(const _ of this.sessionDesc.mediaDescriptions)_.attributes.candidates=this.candidates}}restartICE(d){d=qi(d),this._iceParameters=d,this.sessionDesc.mediaDescriptions.forEach((l=>{l.attributes.iceUfrag=d.iceUfrag,l.attributes.icePwd=d.icePwd}))}predictReceivingMids(d){const l=[];for(let h=0;h<d;h++)l.push((this.currentMidIndex+h+1).toString(10));return l}findAvailableMediaIndex(d,l){return this.sessionDesc.mediaDescriptions.findIndex((h=>{const _=h.media.mediaType===d&&h.media.port!=="0"&&(h.attributes.direction==="sendonly"||h.attributes.direction==="sendrecv")&&h.attributes.ssrcs.length===0;if(Ci()){if(_){const f=this.firefoxSsrcMidMap.get(l[0].ssrcId);return!(f||h.attributes.mid!=="0"&&h.attributes.mid!=="1")||!(!f||f!==h.attributes.mid)}return!1}return _}))}createOrRecycleDataChannel(){for(const h of this.sessionDesc.mediaDescriptions)if(h.media.mediaType==="application")return{mediaDesc:h,needExchangeSDP:!1};this.currentMidIndex+=1;const d="".concat(this.currentMidIndex),l={media:{mediaType:"application",port:wR,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(d),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(l),{mediaDesc:l,needExchangeSDP:!0}}createOrRecycleRecvMedia(d,l,h,_,f,m){const S=d._mediaStreamTrack.kind,T=this.rtpCapabilities.recv,R=Al(S,T,this.localCapabilities.send,S===Me.VIDEO?_:f),C=S===Me.VIDEO?T.videoExtensions:T.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let N={media:{mediaType:S,port:wR,protos:["UDP","TLS","RTP","SAVPF"],fmts:R.map((P=>P.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:R,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:h,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};N=this.mungRecvMediaDsec(N,d,m);const k=this.findFirstClosedMedia(S);if(k){const P=this.sessionDesc.mediaDescriptions.indexOf(k);this.sessionDesc.mediaDescriptions[P]=N}else this.sessionDesc.mediaDescriptions.push(N);return N}updateRemoteDtlsParameters(d){const l=new Set(this._dtlsParameters.fingerprints.map((f=>f.fingerprint))),h=new Set(d.map((f=>f.fingerprint)));let _=!1;l.size!==h.size&&(_=!0);for(const f of l)h.has(f)||(_=!0);return _}updateRemoteCodec(d,l,h){const _=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((N=>N.rtpMap&&N.rtpMap.encodingName.toLowerCase()||"")).filter((N=>{var k;return ee(k=Object.keys(eR)).call(k,N)})))],f=new Set(l);if(_.every((N=>f.has(N))))return w.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(l)),!1;const m=this._rtpCapabilities.recv.videoCodecs.filter((N=>l.some((k=>{var P;return ee(P=N.rtpMap&&N.rtpMap.encodingName.toLowerCase()||"").call(P,k)}))));if(m.length===0)return w.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(_," codecs: ").concat(l)),!1;const S=[...new Set(m.map((N=>N.rtpMap&&N.rtpMap.encodingName.toLowerCase()||"")))];let T;if(w.debug("updateRemoteCodec, from ".concat(_," to ").concat(S)),d.length===0)T=this.sessionDesc.mediaDescriptions.filter((N=>N.media.mediaType==="video"&&N.attributes.direction==="recvonly"));else if(T=this.sessionDesc.mediaDescriptions.filter((N=>N.attributes.mid&&N.media.mediaType==="video"&&ee(d).call(d,N.attributes.mid)&&N.attributes.direction==="recvonly")),T.length!==d.length)return w.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(d,", codecs: ").concat(l)),!1;if(G("USE_PUB_RTX")||G("USE_SUB_RTX")){const N=mc(m,this.rtpCapabilities.recv.videoCodecs);m.push(...N)}this._rtpCapabilities.recv.videoCodecs=m;const R=this.localCapabilities.send,C=this.rtpCapabilities.recv,b=Al(Me.VIDEO,C,R,h);return T.forEach((N=>{const k=b.map((P=>P.payloadType.toString(10)));w.debug("updateRemoteCodec mid: ".concat(N.attributes.mid,", from"),N.attributes.payloads,"to",b),N.attributes.payloads=b,N.media.fmts=k})),!0}createOrRecycleSendMedia(d,l,h,_,f){const m=this.rtpCapabilities.send.videoCodecs,S=this._isUseLocalCodecs||m.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,T=d===Me.VIDEO?S.videoCodecs:S.audioCodecs,R=d===Me.VIDEO?S.videoExtensions:S.audioExtensions;this.currentMidIndex+=1;const C="".concat(this.currentMidIndex);let b={media:{mediaType:d,port:wR,protos:["UDP","TLS","RTP","SAVPF"],fmts:T.map((k=>k.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:h,rtcpFeedbackWildcards:[],payloads:T,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(C)}};b=this.mungSendMediaDesc(b,f);const N=this.findFirstClosedMedia(d);if(N){const k=this.sessionDesc.mediaDescriptions.indexOf(N);this.sessionDesc.mediaDescriptions[k]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((d=>d.media.port!=="0")).map((d=>d.attributes.mid))}mungRecvMediaDsec(d,l,h){const _=qi(d);return jb(_),pE(_,l),zO(_,l),Gb(_),Wb(_,h,this.localCapabilities.send),_}mungSendMediaDesc(d,l){const h=qi(d);return Wb(h,l,this.localCapabilities.recv),tp(h),h}updateRecvMedia(d,l){const h=this.sessionDesc.mediaDescriptions.findIndex((_=>_.attributes.mid===d));if(h!==-1){const _=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],l);this.sessionDesc.mediaDescriptions[h]=_}}bumpMid(d){this.currentMidIndex+=d}findFirstClosedMedia(d){return this.sessionDesc.mediaDescriptions.find((l=>Ci()?l.media.port==="0"&&l.media.mediaType===d:l.media.port==="0"))}findPreloadMediaDesc(d){return this.sessionDesc.mediaDescriptions.find((l=>{var h;return((h=l.attributes)===null||h===void 0||(h=h.ssrcs[0])===null||h===void 0?void 0:h.ssrcId)===d[0].ssrcId}))}getSSRC(d){var l;return(l=this.sessionDesc.mediaDescriptions.find((h=>h.attributes.mid===d)))===null||l===void 0?void 0:l.attributes.ssrcs}}(wa(wa({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&TO(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const a=this.remoteSDP.toString(),s=NU(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),TO(this.store))if(t.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const d=G("PRE_SUB_NUM"),{mids:l,preSSRCs:h}=this.remoteSDP.preloadRemoteMedia(d);await E_(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(h)),this.presetMedia(l,h)}else{const{preSSRCs:d=[]}=t,l=d.map((_=>_.ssrcMsg[0].ssrcId));if(d.length===0)return;const{mids:h}=this.remoteSDP.batchSend(d.map((_=>Object.assign({},_))));await E_(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(h,l)}}catch(a){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}var i,r}presetMedia(t,i){t.forEach(((r,a)=>{this.peerConnection.getTransceivers().forEach((s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const o=s.receiver.track;let c;o.kind==="video"&&G("ENABLE_PRE_RENDER")&&(c=new kO({trackId:"track-".concat(o.kind,"-unknown-").concat(this.store.clientId,"_").concat(Mi(5,""))},!0),c.updateVideoTrack(o),c.onFirstVideoFrameRender=()=>{var d;const l=this.preMediaMap.get(i[a]);l&&(l.firstVideoRender=Date.now()),(d=this.onFirstVideoRender)===null||d===void 0||d.call(this,i[a])},c.play(this.store.sessionId||void 0)),this.preMediaMap.set(i[a],{mid:r,track:o,player:c,transceiver:s})}})),this.store.peerReceiver()}))}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:r}=t;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const o=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||o}const{preSSRCs:a=[]}=t,s=a.map((o=>o.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(s)){const o=[],c=[];if(Array.from(this.preMediaMap.entries()).every((d=>{let[l,{mid:h,player:_,track:f}]=d;return o.push(h),c.push(l),this.preMediaMap.delete(l),_&&_.destroy(),!0})),o.length>0&&(this.remoteSDP.stopSending(o),await E_(this.peerConnection,this.remoteSDP,this.extension),w.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(c)),J.reportApiInvoke(this.store.sessionId,{name:Gt.PRELOAD_MEDIA_FAILED,options:[a,c],tag:Tr.TRACER}).onSuccess()),a.length>0){const{mids:d}=this.remoteSDP.batchSend(a.map((l=>Object.assign({},l))));await E_(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(d,s)}}i?(await E_(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):w.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(t,i,r){var a=this;return oo((function*(){const s=yield hi(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=xb();t.forEach((R=>{const C=a.peerConnection.addTransceiver(R._mediaStreamTrack,wa({direction:"sendonly"},R.trackMediaType==="video"&&a.supportAV1RtpSpec&&c?{sendEncodings:[{scalabilityMode:c}]}:{}));o.push(C),R._updateRtpTransceiver(C)})),Ci()&&G("SIMULCAST")===!0&&(yield hi(a.applySimulcastForFirefox(o,t)));const d=yield hi(a.peerConnection.createOffer()),l=a.remoteSDP.predictReceivingMids(t.length),h=a.mungSendOfferSDP(d.sdp,t,l),_=ya(h),f=l.map((R=>{const C=_.mediaDescriptions.find((b=>b.attributes.mid===R));if(!C)throw new Error("Cannot extract ssrc from mediaDescription.");return AU(C,G("USE_PUB_RTX"))}));let m;try{m=yield f}catch(R){m=[],a.remoteSDP.receive(t,i,r,m);const C=a.remoteSDP.toString();throw yield hi(a.peerConnection.setLocalDescription({type:"offer",sdp:h})),yield hi(a.peerConnection.setRemoteDescription({type:"answer",sdp:C})),yield hi(a.stopSending(l,!0)),R}a.remoteSDP.receive(t,i,r,m);const S=a.remoteSDP.toString(),T=a.logSDPExchange(h,"offer","local","send");return yield hi(a.peerConnection.setLocalDescription({type:"offer",sdp:h})),yield hi(a.applySimulcastEncodings(o,t)),yield hi(a.applySendEncodings(o,t)),T?.(S),yield hi(a.peerConnection.setRemoteDescription({type:"answer",sdp:S})),o.map(((R,C)=>{const b=l[C];return{localSSRC:f[C],id:b,transceiver:R}}))}catch(o){throw o instanceof _e?o:new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}}))()}async createDataChannels(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")w.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}i.forEach((s=>{s._updateOriginDataChannel(r)}));const{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),w.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else w.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof _e?r:new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const i=this.dataStreamChannelMap.get(t);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof _e?i:new _e(L.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(t,i){const r=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter((d=>t.indexOf(d.mid)!==-1));if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map((d=>{var l;n0(this.id+d.mid,this),d.direction="inactive",(l=d.stop)===null||l===void 0||l.call(d)}));const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(a){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{r&&r()}}async receive(t,i,r,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,i,r,a);o&&(await E_(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const c=this.peerConnection.getTransceivers().find((d=>d.mid===s));if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await E_(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map((a=>{const s=this.peerConnection.getTransceivers().find((o=>o.mid===a));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:a,transceiver:s}}))}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach((s=>{Array.from(this.preMediaMap.entries()).some((o=>{let[c,{mid:d,player:l}]=o;if(d===s)return this.preMediaMap.delete(c),l&&l.destroy(),!0}))})),this.remoteSDP.stopSending(t);const i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const a=await this.peerConnection.createAnswer();r?.(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const a=await this.peerConnection.createAnswer();r?.(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const a=await this.peerConnection.createAnswer();r?.(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map((o=>{o.direction="inactive"}));const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();a?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map((async(o,c)=>{o.direction="sendonly"}));const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();a?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return oo((function*(){const r=yield hi(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=Si().supportPCSetConfiguration,s=G("FORCE_TURN_TCP")||i.forceTurn;if(t===Tn.RELAY&&!a)return;if(a&&!s){const _=t===Tn.RELAY?"relay":"all",f=i.peerConnection.getConfiguration();f.iceTransportPolicy!==_&&(w.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(_,"]")),f.iceTransportPolicy=_,i.peerConnection.setConfiguration(f))}i.remoteSDP.updateCandidates(t);const o=yield hi(i.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=__(o.sdp),{remoteIceParameters:d}=yield c.iceParameters;i.remoteSDP.restartICE(d);const l=i.remoteSDP.toString(),h=i.logSDPExchange(o.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield hi(i.peerConnection.setLocalDescription(o)),h?.(l),yield hi(i.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(a){w.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),a)}finally{r()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Tn.TCP_RELAY),await E_(this.peerConnection,this.remoteSDP,this.extension)}catch(i){w.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach((i=>{n0(this.id+i.mid,this)})),this.preMediaMap.forEach((i=>{let{player:r}=i;r&&r.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return wa(wa({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new _e(L.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){const r=this.peerConnection.getTransceivers().filter((a=>a.mid===t));r.length===1&&(this.isVP8Simulcast(i)?Ci()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){const r=this.peerConnection.getTransceivers().find((a=>a.mid===i));r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const i=t[0].transport.iceTransport,{local:r,remote:a}=i.getSelectedCandidatePair();return{local:wa(wa({},Fc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:wa(wa({},Fc),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var i;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),a=t.port?"local: ".concat(t.port):"",s=$h(t.url||"");w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(a)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const i={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&(qT(t.turnServer.servers)?i.iceServers=t.turnServer.servers:G("NEW_TURN_MODE")&&i.iceServers&&r==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&i.iceServers.push(...yA.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):i.iceServers.push(...yA.newTurnServerConfigToIceServers(t.turnServer.servers)),G("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...yA.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...yA.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((a=>{a.forceturn&&(i.iceTransportPolicy="relay")})))),G("ENABLE_ENCODED_TRANSFORM")&&Si().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(t){const i=[];return t.forEach((r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(zu(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))})),i}static newTurnServerConfigToIceServers(t){const i=[];return t.forEach((r=>{const a=G("NEW_TURN_MODE");a===1?i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):a===2?i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):a===3?i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(zu(r.turnServerURL),":443?transport=tcp")}):a===4&&(i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(zu(r.turnServerURL),":443?transport=tcp")}))})),i}tryBindTransportEvents(t){const i=t.transport;if(i){this.transportEventReceiver=t,i.onstatechange=()=>{var a;i!=null&&i.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,i.state))},i.onerror=a=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in a?a.error:a)};const r=i.iceTransport;r&&(r.onstatechange=()=>{const a=i?.iceTransport.state;var s;a&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,a))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:a,remote:s}=r.getSelectedCandidatePair()||{};if(a&&s){const o=a.address+":"+a.port,c=s.address+":"+s.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify($h(o)),", remote ").concat(JSON.stringify($h(c))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var r,a;if(i||(i=this.peerConnection.getSenders().find((R=>R.track===t._mediaStreamTrack))),!i)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Si().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const c=(function(T,R){return T.getTransceivers().find((C=>C.sender.track===R||C.receiver.track===R))})(this.peerConnection,t._mediaStreamTrack),d=kB(t);if((function(T){var R;return!(!G("ENABLE_AG_ADAPTATION")||!(T instanceof sR||ee(R=T._hints).call(R,Ui.CUSTOM_TRACK))||!G("FORCE_SUPPORT_AG_ADAPTATION")&&!(u1(14,0,!1)&&rO(17,4)||l1(14)&&db(17,4,!0)))})(t)&&c&&i&&d&&this.getLocalVideoStats&&ee(r=["vp8","vp9"]).call(r,this.store.codec)){var l;const T=s.degradationPreference||(ee(l=t._hints).call(l,Ui.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(R,C,b,N,k,P){if(n0(R,b),k(C),N!=="balanced"&&N!=="maintain-framerate"&&N!=="maintain-resolution")return;let U=-1;JU(R,C);const W=window.setInterval((()=>{const Q=Mg.get(R);if(!G("ENABLE_AG_ADAPTATION")||!Q)return n0(R,b),void k(C);const he=P();if(he.sendPackets>0&&he.OutgoingAvailableBandwidth>0){if(U===-1)return void(U=Date.now());if(Date.now()-U<1e3)return;const Ge=he.sendFrameRate,xe=he.OutgoingAvailableBandwidth,[qe,ot]=aj(R,Ge,xe,Q.adaptationConfig,C,N);ot&&(b.qualityLimitationReason=ot),qe&&Q.adaptationConfig.scale!==qe.scale&&(w.debug("[".concat(R,"] applyAdaptation: ").concat(b.qualityLimitationReason,`
           sendFps `).concat(Ge,", bwe ").concat(xe,", switch from ").concat(Q.adaptationConfig.scale," to ").concat(qe.scale," ")),Q.adaptationConfig=NR(NR({},Q.adaptationConfig),qe),k(qe))}}),G("CHECK_LOCAL_STATS_INTERVAL")),z=NR({},C);Mg.set(R,{timer:W,adaptationConfig:z,originConfig:C,adaptationFunc:k}),w.debug("[".concat(R,"] start adaptation, originConfig: ").concat(JSON.stringify(C),", degradationPreference: ").concat(N))})(this.id+c.mid,d,this,T,(R=>{i&&this.updateAdaptation(i,R)}),this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var h;const{bitrateMax:T,frameRate:R,scaleResolutionDownBy:C}=t._encoderConfig;T&&(o.maxBitrate=1e3*T),(ee(h=t._hints).call(h,Ui.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(R&&(o.maxFramerate=Bo(R)),C&&C>=1&&(o.scaleResolutionDownBy=C))}const{maxFramerate:_}=G("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,_):_),G("DSCP_TYPE")&&fl()){var f;const T=G("DSCP_TYPE");ee(f=["very-low","low","medium","high"]).call(f,T)&&(o.networkPriority=T)}const m=i.getParameters(),S=(a=m.encodings)===null||a===void 0?void 0:a[0];Ci()&&!S&&(s.encodings=[o]),S&&Object.assign(S,o),Object.assign(m,s),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m),await(async function(T,R,C){try{var b;if(!Si().supportSetRtpSenderParameters||!(function(W){return W==="vp9"||W==="av1"})(T)||!G("ENABLE_SVC"))return;const N={},k={},P=R.getParameters(),U=(b=P.encodings)===null||b===void 0?void 0:b[0];k.scalabilityMode=xb(C),U&&Object.assign(U,k),Object.assign(P,N),await R.setParameters(P),w.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(P.encodings)))}catch(N){w.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",N)}})(this.store.codec,i,G("SVC_MODE"))}async updateAdaptation(t,i){var r,a;if(!t)return w.debug("[updateAdaptation] no rtpSender found");if(!Si().supportSetRtpSenderParameters)return w.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:c,scaleResolutionDownBy:d}=i;o&&(s.maxBitrate=1e3*o),c&&(s.maxFramerate=Bo(c)),d&&d>=1&&ee(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=d);const l=t.getParameters(),h=(a=l.encodings)===null||a===void 0?void 0:a[0];h&&Object.assign(h,s),Object.assign(l,{});try{await t.setParameters(l),w.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(l.encodings)))}catch(_){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?w.debug("[updateAdaptation] peerConnection not connected}"):w.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):w.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,i){try{if(!Si().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){const a=t[r],s=i[r];s instanceof Xi&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,a.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,r){const a=ya(t);return i.forEach(((s,o)=>{const c=r[o],d=a.mediaDescriptions.find((l=>l.attributes.mid===c));d&&(pE(d,s),wU(d,s,this.store.codec))})),aE(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var r,a,s,o,c;const l=t[d],h=i[d];if(h instanceof Xi&&!ee(r=h._hints).call(r,Ui.LOW_STREAM)&&(a=h._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((s=h._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=h._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=h._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},f={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:f.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:f.high}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,_))}}}async applySimulcastEncodings(t,i){if(!Ci()&&t.length===i.length)for(let r=0;r<t.length;r++){const a=i[r];if(a instanceof Xi&&this.isVP8Simulcast(a)){const s=t[r],o={},c={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,o))}}}isVP8Simulcast(t){var i,r,a,s,o;return!!(t instanceof Xi&&G("SIMULCAST")&&this.store.codec==="vp8"&&!ee(i=t._hints).call(i,Ui.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,i,r,a){if(G("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(i," SDP during P2PConnection.").concat(a,`
`),t),i==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(t);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(t){if(Si().supportPCSetConfiguration){const i=yA.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}t.isPreallocation&&(this.isPreallocation=!0)}},Ze(mi.prototype,"updateRemoteRTPCapabilities",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"updateRemoteRTPCapabilities"),mi.prototype),Ze(mi.prototype,"connect",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"connect"),mi.prototype),Ze(mi.prototype,"updateRemoteConnect",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"updateRemoteConnect"),mi.prototype),Ze(mi.prototype,"createDataChannels",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"createDataChannels"),mi.prototype),Ze(mi.prototype,"receive",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"receive"),mi.prototype),Ze(mi.prototype,"batchReceive",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"batchReceive"),mi.prototype),Ze(mi.prototype,"stopReceiving",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"stopReceiving"),mi.prototype),Ze(mi.prototype,"muteRemote",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"muteRemote"),mi.prototype),Ze(mi.prototype,"unmuteRemote",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"unmuteRemote"),mi.prototype),Ze(mi.prototype,"muteLocal",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"muteLocal"),mi.prototype),Ze(mi.prototype,"unmuteLocal",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"unmuteLocal"),mi.prototype),Ze(mi.prototype,"close",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"close"),mi.prototype),Ze(mi.prototype,"updateEncoderConfig",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"updateEncoderConfig"),mi.prototype),Ze(mi.prototype,"updateSendParameters",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"updateSendParameters"),mi.prototype),Ze(mi.prototype,"replaceTrack",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"replaceTrack"),mi.prototype),Ze(mi.prototype,"updateAdaptation",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"updateAdaptation"),mi.prototype),Ze(mi.prototype,"getRemoteSSRC",[Is],Object.getOwnPropertyDescriptor(mi.prototype,"getRemoteSSRC"),mi.prototype),mi);function Is(e,t,i){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const a=this.mutex,s=await a.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await r.apply(this,c)}finally{s()}},i}function o0(e,t){let i=document.createElement("video"),r=document.createElement("canvas");i.setAttribute("style","display:none"),r.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),r.width=Bo(t.width),r.height=Bo(t.height);const a=Bo(t.framerate||15);document.body.append(i),document.body.append(r);let s=e._mediaStreamTrack;i.srcObject=new MediaStream([s]),i.play();const o=r.getContext("2d");if(!o)throw new oe(L.UNEXPECTED_ERROR,"can not get canvas context");const c=Si(),d=r.captureStream(c.supportRequestFrame?0:a).getVideoTracks()[0];d.canvas||(d.canvas=r),r.startCapture=()=>{if(!i)return r.stopCapture&&r.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const h=i.videoWidth,_=i.videoHeight/h,f=r.width*_;Math.abs(f-r.height)>=2&&(w.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(f)),r.height=f)}o.drawImage(i,0,0,r.width,r.height),d.requestFrame&&d.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,i.srcObject=new MediaStream([s]))},r.stopCapture=CO((()=>r.startCapture&&r.startCapture()),a);const l=d.stop;return d.stop=()=>{l.call(d),i&&(i.remove(),i.srcObject=null,i=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),w.debug("clean low stream renderer")},d}var Ol=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(Ol||{}),mt=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(mt||{}),st=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(st||{}),rr=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e})(rr||{}),us=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(us||{}),ap=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e})(ap||{});const sp=1e3,fE=6,Xb=3,ut=Math.max(fE,Xb,60);function lt(e,t,i){i!=null&&Number.isFinite(i)&&(e[t]=Math.round(Math.max(0,i)))}function $U(e){const t={[us.CONN_TYPE]:0,[us.RTT]:e.rtt,[us.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(t[us.CONN_TYPE]=1),i==="tcp"&&(t[us.CONN_TYPE]=3),i==="tls"&&(t[us.CONN_TYPE]=4);break}case"srflx":t[us.CONN_TYPE]=2;break;case"unknown":t[us.CONN_TYPE]=5;break;default:t[us.CONN_TYPE]=0}return t}function ex(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class sj extends or{constructor(t){super(),V(this,"store",void 0),V(this,"uploadWRTCStatsTimer",void 0),V(this,"uploadOutboundDenoiserStatsTimer",void 0),V(this,"uploadExtStatsTimer",void 0),V(this,"uploadExtUsageStatsTimer",void 0),V(this,"uploadInboundExtStatsTimer",void 0),V(this,"requestStats",void 0),V(this,"requestTransportStats",void 0),V(this,"requestLocalMedia",void 0),V(this,"requestRemoteMedia",void 0),V(this,"requestAllTracks",void 0),V(this,"requestVideoIsReady",void 0),V(this,"requestUploadStats",void 0),V(this,"requestUpload",void 0),V(this,"uploadOutboundStarted",!1),V(this,"uploadInboundStarted",!1),V(this,"uploadTransportStarted",!1),V(this,"uploadBaseStatsStarted",!1),V(this,"uploadExtensionUsageStarted",!1),V(this,"lastRecvStats",void 0),V(this,"lastSendStats",void 0),V(this,"lastRefRecvStats",void 0),V(this,"lastRefSendStats",void 0),V(this,"lastNormalRecvStats",void 0),V(this,"lastNormalSendStats",void 0),V(this,"lastExtendStats",{}),V(this,"needUploadStats",{}),V(this,"needUploadRenderFreezeTime",!0),V(this,"lastUploadCompensateTime",-1),V(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const i=t%Xb==0,r=t%fE==0,a=t%60==0;let s,o;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),s||o){var c;const d={};if(this.uploadTransportStarted&&s){const h=this.getTransportStats(s,o,i);h&&(d.misc=[h])}if(this.uploadOutboundStarted&&s){const h=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,i?this.lastRefSendStats:void 0,this.lastSendStats,a);h&&(d.outbound=[h])}if(this.uploadInboundStarted&&o){this.uploadCompensateStats(t);const h=this.getInboundStats(o,r?this.lastNormalRecvStats:void 0,i?this.lastRefRecvStats:void 0,this.lastRecvStats);h&&(d.inbound=h)}const l=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;l&&(Array.isArray(d.misc)?d.misc[0]&&d.misc[0].addition&&(d.misc[0].addition[ap.RTC_PEER_CONNECTION_STATE]=Po[l]):d.misc=[{addition:{[ap.RTC_PEER_CONNECTION_STATE]:Po[l]}}]),this.needUploadStats.sendType&&(Array.isArray(d.outbound)&&d.outbound[0]&&d.outbound[0].high&&(d.outbound[0].high[Ol.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(d)}this.lastRecvStats=o,this.lastSendStats=s,r&&(this.lastNormalRecvStats=o,this.lastNormalSendStats=s),i&&(this.lastRefRecvStats=o,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,r;const a=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(a&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[ap.RTC_PEER_CONNECTION_STATE]:Po[a.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===ut+1&&(t=1)}),sp)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const i=t%Xb==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!i)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const a=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*a;const s=this.requestStats(!0);new Array(a).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const o={};if(this.uploadInboundStarted&&s){const c=this.requestRemoteMedia()||[],d=[];c.forEach((l=>{let[h,_]=l;const f={peer:h.uid};if(h._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(h._videoSSRC)&&_.has(Me.VIDEO)&&h.videoTrack){const m=(function(S,T,R){if(!T.videoRecv.find((b=>b.ssrc===S)))return;const C={};if(R&&R._player){const b=R._player,{renderFreezeAccTime2:N,videoElementStatus:k}=b;if(Hu.visibility==="visible"&&k===un.PLAYING&&Si().supportRequestVideoFrameCallback){const P=Math.min(6e3,N);b.renderFreezeAccTime2=Math.max(0,N-P),lt(C,mt.Video_Render_Freeze_Time_Render2,P),G("USE_NEW_RENDER_FREEZE_TIME")&&lt(C,mt.Video_Render_Freeze_Time_Render,P)}}return C})(h._videoSSRC,s,h.videoTrack);m&&(f.video=m)}f.video&&d.push(f)})),d.length>0&&(o.inbound=d,this.requestUploadStats(o))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,i,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[us.RTT]:t.rtt,[us.CONN_TYPE]:void 0,[us.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const a=$U(t);if(this.store.useP2P){if(i){const s=$U(i);a[us.CONN_TYPE]+=s[us.CONN_TYPE]<<3}a[us.CONN_TYPE]+=110}else a[us.CONN_TYPE]+=100;return{addition:a}}getOutboundStats(t,i,r,a,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,d,l;return o.forEach((h=>{let[_,{track:f,ssrcs:m}]=h;switch(_){case Ee.LocalVideoLowTrack:case Ee.LocalVideoTrack:if(_===Ee.LocalVideoTrack){var S;const T=(function(N,k,P,U,W,z){const Q=k.videoSend.find((qe=>qe.ssrc===N));if(!Q)return;const he={},{sentFrame:Ge,inputFrame:xe}=Q;if(U&&(lt(he,mt.Video_Send_Qp_Sum,Q.qpSumPerFrame),xe&&Ge)){const qe=xe.frameRate,ot=Ge.frameRate;he[mt.Video_Send_Freeze]=(function(xt,fe){let $=!0;return $=!(xt<=5)&&(xt<=10?fe<3:xt<=20?fe<4:fe<5),$})(qe,ot)?1:0}if(W){switch(Ge&&(lt(he,st.Video_Send_Height,Ge.height),lt(he,st.Video_Send_Width,Ge.width),lt(he,st.Video_Send_Frame_Rate,Ge.frameRate)),he[st.Video_Send_Disabled]=P._originMediaStreamTrack&&!P._originMediaStreamTrack.enabled||P._mediaStreamTrack&&!P._mediaStreamTrack.enabled?1:0,Q.adaptionChangeReason){case"none":he[st.Video_Send_Adaptation]=0;break;case"cpu":he[st.Video_Send_Adaptation]=1;break;case"bandwidth":he[st.Video_Send_Adaptation]=2;break;case"other":he[st.Video_Send_Adaptation]=3}let qe=0;Q.adaptionChangeReason&&(qe+=ex(Q.adaptionChangeReason)),k.qualityLimitationReason&&(qe+=ex(k.qualityLimitationReason)<<3),he[st.Video_Send_Adaptation]=qe,he[st.Video_Send_Player_Status]=aR[P._player?P._player.videoElementStatus:"uninit"],lt(he,st.Video_Send_Nacks,Q.nacksCount),lt(he,st.Video_Send_Plis,Q.plisCount),lt(he,st.Video_Send_Firs,Q.firsCount),lt(he,st.Video_Send_Avg_Encode,Q.avgEncodeMs),lt(he,st.Video_Send_Huge_Frame_Sent,Q.hugeFramesSent),lt(he,st.Video_Send_Bytes_Retransmit,Q.retransmittedBytesSent),lt(he,st.Video_Send_Packages_Retransmit,Q.retransmittedPacketsSent),lt(he,st.Video_Send_Key_Frames_Encoded,Q.keyFramesEncoded);const ot=W.videoSend.find((xt=>xt.ssrc===N));if(ot){let xt=sp*Xb;ot.timestamp&&Q.timestamp&&(xt=Q.timestamp-ot.timestamp),ot.packets!=null&&Q.packets!=null&&lt(he,st.Video_Send_Package_Rate,1e3*(Q.packets-ot.packets)/xt),Q.packetsLost!=null&&ot.packetsLost!=null&&lt(he,st.Video_Send_Package_Lost,Q.packetsLost-ot.packetsLost),ot.bytes!=null&&Q.bytes!=null&&lt(he,st.Video_Send_Bitrate,8*(Q.bytes-ot.bytes)/xt)}}return he})(m[0].ssrcId,t,f,i,r),R=f.__className__==="CameraVideoTrack"?3:ee(S=f._hints).call(S,Ui.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==R||s)&&(this.needUploadStats={sendType:R},this.lastExtendStats.sendType=R);const C=f&&(function(N,k,P,U){const W=k.videoSend.find((Q=>Q.ssrc===N));if(!W)return null;const z={};if(U){const Q=W.inputFrame,he=Q&&Q.height||P.videoHeight||0,Ge=Q&&Q.width||P.videoWidth||0,xe=Q&&Q.frameRate||0;lt(z,st.Video_Capture_Height,he),lt(z,st.Video_Capture_Width,Ge),lt(z,st.Video_Capture_Frame_Rate,xe)}return z})(m[0].ssrcId,t,f,!!r),b=(function(N,k){const P={};return k&&(lt(P,st.Video_Send_Retransmit,N.bitrate.retransmit),lt(P,st.Video_Send_Target_Encoded,N.bitrate.targetEncoded),lt(P,st.Video_Send_Actual_Encoded,N.bitrate.actualEncoded),lt(P,st.Video_Send_Transmit,N.bitrate.transmit),lt(P,st.Video_Send_Bandwidth,N.sendBandwidth)),P})(t,!!r);d=Object.assign({},T,C,b)}else l=(function(T,R,C,b,N){const k=R.videoSend.find((U=>U.ssrc===T));if(!k)return;const P={};if(b){const U=k.sentFrame;U&&(lt(P,st.Video_Send_Low_Height,U.height),lt(P,st.Video_Send_Low_Width,U.width),lt(P,st.Video_Send_Low_Frame_Rate,U.frameRate));const W=b.videoSend.find((z=>z.ssrc===T));if(W){let z=sp*fE;W.timestamp&&k.timestamp&&(z=k.timestamp-W.timestamp),W.packets!=null&&k.packets!=null&&lt(P,st.Video_Send_Low_Package_Rate,1e3*(k.packets-W.packets)/z),k.packetsLost!=null&&W.packetsLost!=null&&lt(P,st.Video_Send_Low_Package_Lost,k.packetsLost-W.packetsLost),W.bytes!=null&&k.bytes!=null&&lt(P,st.Video_Send_Low_Bitrate,8*(k.bytes-W.bytes)/z)}}return P})(m[0].ssrcId,t,0,r);break;case Ee.LocalAudioTrack:c=f&&(function(T,R,C,b,N,k){const P=R.audioSend.find((W=>W.ssrc===T));if(!P)return;const U={};if(N){U[st.Audio_Send_Disabled]=C._originMediaStreamTrack&&!C._originMediaStreamTrack.enabled||C._mediaStreamTrack&&!C._mediaStreamTrack.enabled?1:0;const W=100*C._source.getAccurateVolumeLevel(),z=P.inputLevel;if(z!=null){const he=Math.ceil(50*Math.log10(100*z+1));lt(U,st.Audio_Send_Level,he)}lt(U,st.Audio_Capture_PCM_Level,W),lt(U,st.Audio_Send_AEC_Return_Loss,P.aecReturnLoss),lt(U,st.Audio_Send_AEC_Return_Loss_Enhancement,P.aecReturnLossEnhancement),lt(U,st.Audio_Send_Bytes_Retransmit,P.retransmittedBytesSent),lt(U,st.Audio_Send_Packages_Retransmit,P.retransmittedPacketsSent),U[st.Audio_Send_Freeze]=0;const Q=N.audioSend.find((he=>he.ssrc===T));if(Q){let he=sp*fE;Q.timestamp&&P.timestamp&&(he=P.timestamp-Q.timestamp),Q.bytes!=null&&P.bytes!=null&&lt(U,st.Audio_Send_Bitrate,8*(P.bytes-Q.bytes)/he),Q.packets!=null&&P.packets!=null&&lt(U,st.Audio_Send_Package_Rate,1e3*(P.packets-Q.packets)/he)}}return U})(m[0].ssrcId,t,f,0,r)}})),{high:d,low:l,audio:c}}getInboundStats(t,i,r,a){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],o=[];return s.forEach((c=>{let[d,l]=c;const h={peer:d.uid};if(l.has(Me.VIDEO)&&d.videoTrack){const _=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,f=d.videoTrack?(function(m,S,T,R,C,b,N,k){const P=S.videoRecv.find((qe=>qe.ssrc===m));if(!P)return;const U={},{receivedFrame:W,outputFrame:z,decodeFrameRate:Q}=P;lt(U,rr.Video_Render_Frame_Rate_Decode,Q),P.framesRateFirefox&&lt(U,rr.Video_Recv_Frame_Rate,P.framesRateFirefox),W&&lt(U,rr.Video_Recv_Frame_Rate,W.frameRate),lt(U,rr.Video_Recv_Frame_Dropped,P.framesDroppedCount),lt(U,rr.Video_Recv_Bytes_Retransmit,P.retransmittedBytesReceived),lt(U,rr.Video_Recv_Packages_Retransmit,P.retransmittedPacketsReceived),lt(U,rr.Video_Recv_Packages_Discarded,P.packetsDiscarded),lt(U,rr.Video_Recv_Avg_Decode,P.avgDecodeMs),lt(U,rr.Video_Recv_Avg_Processing_Delay,P.avgProcessingDelayMs),lt(U,rr.Video_Recv_Avg_Assembly_Time,P.avgFramesAssembledFromMultiplePacketsMs),lt(U,rr.Video_Recv_Avg_Inter_Frame_Delay,P.avgInterFrameDelayMs),lt(U,rr.Video_Recv_Key_Frames_Decoded,P.keyFramesDecoded);const he=k&&k.videoRecv.find((qe=>qe.ssrc===m));if(he){const qe=S.timestamp-k.timestamp||sp;P.packetsLost!=null&&he.packetsLost!=null&&lt(U,rr.Video_Recv_Package_Lost,P.packetsLost-he.packetsLost),he.bytes!=null&&P.bytes!=null&&lt(U,rr.Video_Recv_Bitrate,8*(P.bytes-he.bytes)/qe),he.packets!=null&&P.packets!=null&&lt(U,rr.Video_Recv_Package_Rate,1e3*(P.packets-he.packets)/qe)}const Ge=b&&b.videoRecv.find((qe=>qe.ssrc===m));if(Ge&&(lt(U,mt.Video_Recv_Qp_Sum,P.qpSumPerFrame),U[mt.Video_Recv_Freeze]=R&&AR.isRemoteVideoFreeze(T,P,Ge)?1:0),N){var xe;const qe=N.videoRecv.find((xt=>xt.ssrc===m));W?(lt(U,st.Video_Recv_Height,W.height),lt(U,st.Video_Recv_Width,W.width)):T&&(lt(U,st.Video_Recv_Height,T._videoHeight||0),lt(U,st.Video_Recv_Width,T._videoWidth||0)),z&&lt(U,st.Video_Recv_Frame_Rate_Output,z.frameRate);const ot=(xe=T._player)===null||xe===void 0?void 0:xe.rendFrameRate.toFixed(0);if(ot&&lt(U,st.Video_Render_Frame_Rate_Render,+ot),lt(U,st.Video_Recv_Jitter_Buffer,P.jitterBufferMs),lt(U,st.Video_Recv_Current_Delay,P.currentDelayMs),lt(U,st.Video_Recv_Firs,P.firsCount),lt(U,st.Video_Recv_Nacks,P.nacksCount),lt(U,st.Video_Recv_Plis,P.plisCount),T){U[st.Video_Recv_Disabled]=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?0:1;const xt=T._player;if(xt){const{freezeTimeCounterList:fe,renderFreezeAccTime:$,renderFreezeAccTime2:ne,videoElementStatus:ie}=xt;if(fe&&fe.length>0&&lt(U,mt.Video_Render_Freeze_Time,fe.splice(0,1)[0]),C&&Hu.visibility==="visible"&&ie===un.PLAYING&&Si().supportRequestVideoFrameCallback){const A=Math.min(6e3,ne);xt.renderFreezeAccTime2=Math.max(0,ne-A),lt(U,mt.Video_Render_Freeze_Time_Render2,A);const v=Math.min(6e3,$);xt.renderFreezeAccTime=Math.max(0,$-v),lt(U,mt.Video_Render_Freeze_Time_Render,G("USE_NEW_RENDER_FREEZE_TIME")?A:v)}if(typeof P.totalFreezesDuration=="number"){const A=qe&&qe.totalFreezesDuration?P.totalFreezesDuration-qe.totalFreezesDuration:P.totalFreezesDuration;lt(U,st.Video_Render_Freeze_Duration,1e3*A)}}}if(U[st.Video_Recv_Player_Status]=aR[T._player?T._player.videoElementStatus:"uninit"],qe&&P.totalInterFrameDelay!==void 0&&P.totalSquaredInterFrameDelay!==void 0&&qe.totalInterFrameDelay!==void 0&&qe.totalSquaredInterFrameDelay!==void 0){const xt=P.totalInterFrameDelay-qe.totalInterFrameDelay,fe=P.totalSquaredInterFrameDelay-qe.totalSquaredInterFrameDelay,$=P.framesDecodeCount-qe.framesDecodeCount,ne=xt/$*1e3,ie=Math.round(1e3*Math.sqrt((fe-Math.pow(xt,2)/$)/$));!isNaN(ie)&&ne+ie>Math.max(3*ne,ne+150)&&(U[st.Video_Recv_I_Frame_Delay]=ie)}}return U})(d._videoSSRC,t,d.videoTrack,_===!0,this.needUploadRenderFreezeTime,i,r,a):void 0;f&&(h.video=f)}if(l.has(Me.AUDIO)&&d.audioTrack){const _=d.audioTrack?(function(f,m,S,T,R,C){const b=m.audioRecv.find((U=>U.ssrc===f));if(!b)return;const N={};lt(N,rr.Audio_Recv_Jitter,b.jitterMs),lt(N,rr.Audio_Recv_Bytes_Retransmit,b.retransmittedBytesReceived),lt(N,rr.Audio_Recv_Packages_Retransmit,b.retransmittedPacketsReceived),lt(N,rr.Audio_Recv_Packages_Discarded,b.packetsDiscarded),lt(N,rr.Audio_Recv_Avg_Processing_Delay,b.avgProcessingDelayMs);const k=C&&C.audioRecv.find((U=>U.ssrc===f));if(k){const U=sp;b.packets!=null&&k.packets!=null&&lt(N,rr.Audio_Recv_Package_Rate,1e3*(b.packets-k.packets)/U),b.packetsLost!=null&&k.packetsLost!=null&&lt(N,rr.Audio_Recv_Package_Lost,b.packetsLost-k.packetsLost)}if(T){const{receivedFrames:U,droppedFrames:W}=b;U!=null&&W!=null&&(N[mt.Audio_Recv_Freeze]=(P=U)===0||100*W/P>20?1:0)}var P;if(R){const U=100*S._source.getAccurateVolumeLevel(),W=b.outputLevel;if(W!=null){const Q=Math.ceil(50*Math.log10(100*W+1));lt(N,st.Audio_Render_Level,Q)}lt(N,st.Audio_Recv_PCM_Level,U),S&&(N[st.Audio_Recv_Disabled]=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?0:1),lt(N,st.Audio_Recv_Jitter_Buffer,b.jitterBufferMs),lt(N,st.Audio_Recv_Current_Delay,b.jitterBufferMs),N[st.Audio_Recv_Player_Status]=aR[ki.getPlayerState(S.getTrackId())];const z=R.audioRecv.find((Q=>Q.ssrc===f));if(z){z.bytes!=null&&b.bytes!=null&&lt(N,st.Audio_Recv_Bitrate,8*(b.bytes-z.bytes)/(sp*Xb));const Q=b.concealedSamples-z.concealedSamples;Q>0&&lt(N,st.Audio_Recv_Concealed_Samples,Q);const he=b.totalSamplesReceived-z.totalSamplesReceived;he>0&&lt(N,st.Audio_Recv_Total_Samples_Received,he);const Ge=b.freezeSamples80-z.freezeSamples80;Ge>0&&lt(N,st.Audio_Render_Freeze_Samples_80ms,Ge);const xe=b.freezeSamples200-z.freezeSamples200;xe>0&&lt(N,st.Audio_Render_Freeze_Samples_200ms,xe);const qe=b.freezeMs80-z.freezeMs80;lt(N,st.Audio_Render_Freeze_Time_80ms,qe<0?0:qe);const ot=b.freezeMs200-z.freezeMs200;lt(N,st.Audio_Render_Freeze_Time_200ms,ot<0?0:ot)}}return N})(d._audioSSRC,t,d.audioTrack,i,r,a):void 0;_&&(h.audio=_)}(h.video||h.audio)&&o.push(h)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find((i=>i instanceof vb));if(t&&t._external.getDenoiserStats){const i=t._external.getDenoiserStats();i&&this.requestUpload($t.DENOISER_STATS,i)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((t=>{t.getProcessorStats().forEach((i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((t=>{let[i,r]=t;r.has(Me.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach((a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)})),r.has(Me.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach((a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const i=Date.now(),r={connectionInterval:G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let a=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const l of s)!l.muted&&l.enabled&&(a=a.concat(await l.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[l,h]of o)h.has(Me.VIDEO)&&l.videoTrack&&(a=a.concat(await l.videoTrack.getProcessorUsage())),h.has(Me.AUDIO)&&l.audioTrack&&(a=a.concat(await l.audioTrack.getProcessorUsage()));if(a.length===0)return;r.details=(function(l,h){const _={};for(const{id:T,value:R,level:C,direction:b}of l){var f;const N=(f=h.get(T))!==null&&f!==void 0?f:0,k=R===2?N+G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:N;var m,S;h.set(T,k),_[T]?(R===2&&(_[T].value=R),C>_[T].level&&(_[T].level=C),b==="remote"&&(_[T].remoteUidCount+=1),_[T].totalTs=(m=h.get(T))!==null&&m!==void 0?m:0):_[T]={value:R,level:C,remoteUidCount:b==="local"?0:1,totalTs:(S=h.get(T))!==null&&S!==void 0?S:0}}return Object.keys(_).map((T=>{const{level:R,value:C,totalTs:b}=_[T];return{id:T,level:R,value:C,totalTs:b}}))})(a,t);const c=Date.now(),d=c>i?c:i+1;this.requestUpload&&this.requestUpload($t.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:d})}),G("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const c0=G("ICE_RESTART_INTERVAL");let R_=new Map,Md=new Map,op=[Tn.UDP_TCP_RELAY,Tn.TCP_RELAY,Tn.RELAY],d0=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Si().supportPCSetConfiguration;function tx(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=R_.get(e.id);i&&(window.clearTimeout(i),R_.delete(e.id));const r=Md.get(e.id);t&&r&&r.index===op.length-1&&(w.debug("[".concat(e.id,"] reset ICE restart policy")),Md.delete(e.id))}function ei(e,t,i){if(R_.size===0&&Md.size===0&&(Array.isArray(G("RESTART_SEQUENCE"))&&G("RESTART_SEQUENCE").length>0&&!(function(c,d){if(c.length!==d.length)return!1;for(let l=0;l<c.length;l+=1){const h=c[l];if(c.filter((_=>_===h)).length!==d.filter((_=>_===h)).length)return!1}return!0})(op,G("RESTART_SEQUENCE"))&&(op=G("RESTART_SEQUENCE").filter((c=>{var d;if(ee(d=Object.values(Tn)).call(d,c))return!0})),w.debug("use reconnection policy from config distribution, queues: ".concat(op.join(" => ")))),d0=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Si().supportPCSetConfiguration),op.length===0)return void i();let r,{index:a=0,type:s}=Md.get(e.id)||{};if(d0&&s===Tn.RELAY)return void i();let o=s&&a>=op.length-1;if(d0)s=Tn.RELAY;else{if(o)return void i();s?(a++,s=op[a]):(s=op[0],a=0)}w.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(a)),t(s),Md.set(e.id,{index:a,type:s}),r=window.setTimeout((()=>ei(e,t,i)),c0),R_.set(e.id,r)}var ti;function Zu(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Qu(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Zu(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Zu(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}function Jb(e){var t,i,r,a=2;for(typeof Symbol<"u"&&(i=JC,r=Symbol.iterator);a--;){if(i&&(t=e[i])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new EE(t.call(e));i="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function EE(e){function t(i){if(Object(i)!==i)return se.reject(new TypeError(i+" is not an object."));var r=i.done;return se.resolve(i.value).then((function(a){return{value:a,done:r}}))}return EE=function(i){this.s=i,this.n=i.next},EE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return r===void 0?se.resolve({value:i,done:!0}):t(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return r===void 0?se.reject(i):t(r.apply(this.s,arguments))}},new EE(e)}let Oa=(ti=class extends or{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(it.StateChange,t,this._state)}constructor(e,t){super(),V(this,"isPlanB",void 0),V(this,"store",void 0),V(this,"statsUploader",void 0),V(this,"connection",void 0),V(this,"localTrackMap",new Map),V(this,"remoteUserMap",new Map),V(this,"localDataChannels",[]),V(this,"remoteDataChannelMap",new Map),V(this,"pendingLocalTracks",[]),V(this,"pendingRemoteTracks",[]),V(this,"pendingLocalDataChannels",[]),V(this,"pendingRemoteDataChannels",[]),V(this,"statsCollector",void 0),V(this,"shouldForwardP2PCreation",void 0),V(this,"iceFailedCount",0),V(this,"dtlsFailedCount",0),V(this,"mutex",void 0),V(this,"_state",Ue.Disconnected),V(this,"_pcStatsUploadType",G("NEW_ICE_RESTART")?Zh.FIRST_CONNECTION:Zh.OLD_FIRST_CONNECTION),V(this,"_isStartRestartIce",!1),V(this,"_restartTimer",void 0),V(this,"_isTryConnecting",!1),V(this,"_iceError",null),V(this,"_forceTurn",!1),V(this,"_isWaitPcToRePub",!1),V(this,"handleMuteLocalTrack",(async(i,r,a)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ue.Connected)return void a(new _e(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(i);if(o.length===0)return void r();const c=o.find((l=>l[0]==="videoLowTrack"));if(c){const l=c[1];this.store.enableInstantMuteRestore?(l.track._originMediaStreamTrack.enabled=!1,w.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):l.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?w.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(o.map((l=>{let[,{id:h}]=l;return h})));const d=this.createMuteMessage(o);await fi(this,it.RequestMuteLocal,d),r()}catch(o){a(o)}finally{s()}})),V(this,"handleUnmuteLocalTrack",(async(i,r,a)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ue.Connected)return void a(new _e(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(i);if(o.length===0)return void r();const c=o.find((l=>l[0]==="videoLowTrack"));if(c){const l=c[1];if(this.store.enableInstantMuteRestore)l.track._originMediaStreamTrack.enabled=!0,w.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(l.track._originMediaStreamTrack.stop(),!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Si().supportDualStreamEncoding){const h=i._mediaStreamTrack.clone();l.track._mediaStreamTrack=h,l.track._originMediaStreamTrack=h}else{const h=o0(i,Kr(this,it.RequestLowStreamParameter));l.track._mediaStreamTrack=h,l.track._originMediaStreamTrack=h}await new se(((h,_)=>{this.handleReplaceTrack(l.track,h,_,!0)}))}}this.store.enableInstantMuteRestore?w.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(o.map((l=>{let[,{id:h}]=l;return h})));const d=this.createUnmuteMessage(o);await fi(this,it.RequestUnmuteLocal,d),r()}catch(o){a(o)}finally{s()}})),V(this,"handleUpdateVideoEncoder",(async(i,r,a,s)=>{let o;s||(o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(Ee.LocalVideoTrack);if(!this.connection||!d||d.track!==i||this.state!==Ue.Connected)return void r();const{id:l,track:h}=d;await this.connection.updateSendParameters(l,h),await this.connection.updateEncoderConfig(l,h),this.emit(it.UpdateVideoEncoder,h),r()}catch(d){a(d)}finally{var c;(c=o)===null||c===void 0||c()}})),V(this,"handleUpdateVideoSendParameters",(async(i,r,a)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Ee.LocalVideoTrack);if(!this.connection||!o||o.track!==i||this.state!==Ue.Connected)return void r();const{id:c,track:d}=o;await this.connection.updateSendParameters(c,d),r()}catch(o){a(o)}finally{s()}})),V(this,"handleReplaceMixingTrack",(async(i,r,a,s)=>{if(!this.connection||this.state!==Ue.Connected)return void r();const o=QU([i]);let c;w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,o),r()}catch(l){a(l)}finally{var d;(d=c)===null||d===void 0||d()}})),V(this,"handleReplaceTrack",(async(i,r,a,s)=>{let o;w.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;const l=Array.from(this.localTrackMap.entries()).find((h=>{let[,{track:_}]=h;return i===_}));if(!this.connection||!l||this.state!==Ue.Connected)return void r();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(i,l[1].id)),this.isPlanB){const h=l[1];h.id=i._mediaStreamTrack.id,this.localTrackMap.set(l[0],h)}if(l[0]===Ee.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Si().supportDualStreamEncoding){const h=this.localTrackMap.get(Ee.LocalVideoLowTrack);if(h){const _=i._mediaStreamTrack.clone();h.track._originMediaStreamTrack.stop(),h.track._mediaStreamTrack=_,h.track._originMediaStreamTrack=_,await new se(((f,m)=>{this.handleReplaceTrack(h.track,f,m,!0)}))}}r()}catch(l){a(l)}finally{var d;(d=o)===null||d===void 0||d()}})),V(this,"handleGetRTCStats",(i=>{i(this.statsCollector.getRTCStats())})),V(this,"handleGetLocalVideoStats",(i=>{i(this.statsCollector.getLocalVideoTrackStats())})),V(this,"handleGetLocalAudioStats",(i=>{i(this.statsCollector.getLocalAudioTrackStats())})),V(this,"handleGetRemoteVideoStats",(i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid])),V(this,"handleGetRemoteAudioStats",(i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new sj(this.store),this.bindStatsUploaderEvents(),this.mutex=new Wn("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Si().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&fl(),this.shouldForwardP2PCreation=G("FORWARD_P2P_CREATION")&&Si().supportPCSetConfiguration&&xu(),this.shouldForwardP2PCreation&&(this.connection=DR(this.store),this.emit(it.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var i;this.state=Ue.New,this._forceTurn=Ei(e),w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=DR(this.store,e),this.emit(it.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new _e(L.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=G("NEW_ICE_RESTART")?Zh.FIRST_CONNECTION:Zh.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new _e(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Ue.Connected){if(this.connection instanceof vn&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),J.reportApiInvoke(this.store.sessionId,{name:Gt.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Tr.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(it.RequestReconnect)}));await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ue.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((a=>{var s;let[o]=a;return ee(s=[Ee.LocalVideoLowTrack,Ee.LocalVideoTrack]).call(s,o)})),i=t.map((a=>{let[,{id:s}]=a;return s})),r=t.map((a=>{let[s]=a;return s}));if(this.connection instanceof vn){if(J.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ee(e).call(e,this.store.codec)){const a=["vp9","vp8","h264"].find((s=>ee(e).call(e,s)));a&&(this.store.codec=a,w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof vn&&this.connection.peerConnectionState!=="closed"&&ee(e=[Ue.New,Ue.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Ue.Connected){if(this.state===Ue.Disconnected)throw new _e(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((i=>{var r;ee(r=this.pendingLocalDataChannels).call(r,i)||this.pendingLocalDataChannels.push(i)})),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach((i=>{const r=Date.now();this.store.publish(i.id.toString(),"datachannel",r)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((i=>{this.localDataChannels.push(i);const r=Date.now();this.store.publish(i.id+"","datachannel",void 0,r)})),e.map((i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId}))))}publish(e,t,i){var r=this;return oo((function*(){const a=yield hi(r.mutex.lock("From P2PChannel.publish"));try{var s;const o=r.connection&&ee(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==Ue.Connected||o){if(r.state===Ue.Disconnected)throw new _e(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const d=e.filter((l=>r.pendingLocalTracks.indexOf(l)===-1));return r.pendingLocalTracks=r.pendingLocalTracks.concat(d),void(o&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,ja.markPublishStart(r.store.clientId,r.store.pubId);const c=r.filterTobePublishedTracks(e,t,i);if(c.length===0)return void(yield hi(r.tryToUnmuteAudio(e)));yield*GT(Jb(r.doPublish(r.connection,c)))}finally{a()}}))()}doPublish(e,t){var i=this;return oo((function*(){t.forEach((f=>{let{track:m,type:S}=f;const T=Date.now();i.store.publish(m.getTrackId(),S===Ee.LocalAudioTrack?"audio":"video",T)})),i.bindLocalTrackEvents(t);const r=t.map((f=>{let{track:m}=f;return m})),a=yield hi(e.send(r,i.store.codec,i.store.audioCodec)),s=(yield hi(a.next())).value,o=i.createGatewayPublishMessage(t,s);let c;try{c=yield o}catch(f){throw a.throw(f),f?.code===L.WS_ABORT&&t.forEach((m=>{let{track:S}=m;i.pendingLocalTracks.indexOf(S)===-1&&i.pendingLocalTracks.push(S)})),i.unbindLocalTrackEvents(t),f}const d=i.mapPubResToRemoteConfig(o,c,r),l=(yield hi(a.next(d))).value;if(i.state===Ue.Disconnected)throw new _e(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");G("ENABLE_VIDEO_SEI");const h=G("ENABLE_ENCODED_TRANSFORM"),_=G("ENABLE_AUDIO_METADATA");r.forEach((async f=>{const m=f.getRTCRtpTransceiver();if(!m||!h)return;const{interceptLocalVideoFrame:S,interceptLocalAudioFrame:T}=Kb();f.trackMediaType===Me.VIDEO?await S(m.sender,f):f.trackMediaType===Me.AUDIO&&await T(m.sender,{metadata:_?()=>{const R=f.metadata.shift();return R&&R.value}:void 0})})),t.forEach((f=>{let{type:m}=f;i.statsCollector.addLocalStats(m)})),i.assignLocalTracks(t,l),i.statsUploader.startUploadOutboundStats(),t.forEach((f=>{let{track:m,type:S}=f;const T=Date.now();i.store.publish(m.getTrackId(),S===Ee.LocalAudioTrack?"audio":"video",void 0,T)}))}))()}async updateVideoStreamParameter(e,t){const i=this.localTrackMap.get(t);if(!i||!this.connection)return;if(!(i.track instanceof Xi))return w.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=i,a=(function(s,o){const c={};return s.height&&s.width&&(c.scaleResolutionDownBy=Qh(s,o)),c.maxFramerate=s.framerate?Bo(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c})(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Ee.LocalVideoLowTrack||!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Si().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return w.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(o,c){const d=o.canvas;c.width&&(d.width=Bo(c.width)),c.height&&(d.height=Bo(c.height)),c.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=CO((()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()}),Bo(c.framerate)))})(s,e)}a.maxBitrate!=null&&(r._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=a.maxFramerate:r._encoderConfig.frameRate={max:a.maxFramerate}),w.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return oo((function*(){if(!t.connection||t.state!==Ue.Connected)return;const i=yield hi(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const a=t.localTrackMap.get(Ee.LocalVideoTrack);if(!a)throw new _e(L.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Ee.LocalVideoLowTrack))throw new _e(L.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(a.track,e),type:Ee.LocalVideoLowTrack}];if(yield*GT(Jb(t.doPublish(t.connection,s))),a.track.muted||!a.track.enabled){var r;const o=(r=t.localTrackMap.get(Ee.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;o!==void 0&&(yield hi(t.connection.muteLocal([o])))}}finally{i()}}))()}async republish(){this.pendingLocalTracks.length>0&&(w.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await zt(this,it.RequestRePublish,this.pendingLocalTracks),this.emit(it.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(w.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await zt(this,it.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:i,kind:r}=this.pendingRemoteTracks[t];(r!==Me.AUDIO||i._audio_added_&&i._audioSSRC)&&(r!==Me.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await zt(this,it.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:i}of this.pendingRemoteTracks)await this.subscribe(t,i,i===Me.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((t=>{let{user:i}=t;this.emit(it.MediaReconnectEnd,i.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Ue.Connected)return void e.forEach((r=>{const a=this.pendingLocalTracks.indexOf(r);a!==-1&&this.pendingLocalTracks.splice(a,1)}));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const i=t.find((r=>r[0]==="videoLowTrack"));return i&&i[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Ue.Connected)return void e.forEach((i=>{const r=this.pendingLocalDataChannels.indexOf(i);r!==-1&&this.pendingLocalDataChannels.splice(r,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach((i=>{const r=this.localDataChannels.indexOf(i);r!==-1&&this.localDataChannels.splice(r,1)})),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map((i=>i.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ue.Connected)return;const e=this.localTrackMap.get(Ee.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Ee.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const i=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((r=>{let[,{id:a}]=r;return a}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((r=>{let[a,{track:s}]=r;return{type:a,track:s}}))),t.forEach((r=>{let[a]=r;this.statsCollector.removeLocalStats(a)})),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Ue.Connected)throw new _e(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=t.filter((r=>{var a;return!((a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.get(r.id))}));if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach((r=>{var a;this.remoteDataChannelMap.has(e)?(a=this.remoteDataChannelMap.get(e))===null||a===void 0||a.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex((o=>{let{user:c,id:d}=o;return c.uid===e.uid&&d===r.id}));s!==-1&&this.pendingRemoteDataChannels.splice(s,1)})),i.map((r=>r.id))}async subscribe(e,t,i,r,a){var s;if(!this.connection||this.state!==Ue.Connected)throw new _e(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let o,c,d,l;const h=this.connection.getPreMedia(i);if(h)w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),d=h.transceiver,o=h.track,c=h.mid,l=h.player,h.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:h.firstVideoRender});else if(a){const m=a.find((T=>{let{stream_type:R}=T;return R===t}));if(!m)throw new _e(L.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const S=await this.connection.receive(t,m.ssrcs,String(e._uintid),m.attributes);this.connection instanceof vn&&(d=S.transceiver),o=S.track,c=S.id}else{const m=await this.connection.receive(t,[{ssrcId:i,rtx:r}],String(e._uintid),void 0);this.connection instanceof vn&&(d=m.transceiver),o=m.track,c=m.id}if(t===Me.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new fc(o,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new Wu(o,e.uid,e._uintid,this.store,l),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Gs.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})})),e._videoTrack.once(Gs.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)})),l?e._videoTrack.once(Gs.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})):e._videoTrack.once(Gs.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}))),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack)),d&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:m,interceptRemoteAudioFrame:S}=Kb();t==Me.VIDEO?await m(d.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(T=>{var R;return(R=e._videoTrack)===null||R===void 0?void 0:R._onSei(T)})}):t==Me.AUDIO&&await S(d.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:T=>{this.safeEmit(it.AudioMetadata,T)},onPts:T=>{this.safeEmit(it.AudioPts,T)}})}const _=this.remoteUserMap.get(e);_?_.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const f=this.pendingRemoteTracks.findIndex((m=>{let{user:S,kind:T}=m;return S.uid===e.uid&&t===T}));f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(it.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Ue.Connected)throw new _e(L.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((a=>{var s;let{user:o,mediaType:c}=a;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(c))}));const t=[],i=new Map;e.forEach((a=>{if(!this.connection)return;const s=this.connection.getPreMedia(a.ssrcId);if(s){const{track:o,mid:c,transceiver:d,player:l}=s;i.set(a.ssrcId,{track:o,id:c,transceiver:d,player:l})}else t.push(a)}));const r=await this.connection.batchReceive(t.map((a=>{let{user:s,mediaType:o,ssrcId:c,rtxSsrcId:d}=a;return{kind:o,ssrcMsg:[{ssrcId:c,rtx:d}],mslabel:String(s._uintid)}})));t.forEach(((a,s)=>{i.set(a.ssrcId,r[s])}));for(const{user:a,mediaType:s,ssrcId:o}of e){const c=i.get(o);if(!c)return void w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(a.uid," subscribe data,").concat(s,", ").concat(o));const{track:d,id:l,transceiver:h,player:_}=c;if(h&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:S,interceptRemoteAudioFrame:T}=Kb();s==Me.VIDEO?await S(h.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(R=>{var C;return(C=a._videoTrack)===null||C===void 0?void 0:C._onSei(R)})}):s==Me.AUDIO&&await T(h.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:R=>{this.safeEmit(it.AudioMetadata,R)},onPts:R=>{this.safeEmit(it.AudioPts,R)}})}if(s===Me.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(d):(a._audioTrack=new fc(d,a.uid,a._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),h&&a._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(d):(a._videoTrack=new Wu(d,a.uid,a._uintid,this.store,_),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),h&&a._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(a,a._videoTrack)),G("ENABLE_VIDEO_SEI")&&h){const{interceptRemoteVideoFrame:S,interceptRemoteAudioFrame:T}=Kb();s==Me.VIDEO?await S(h.receiver,{onSei:R=>{var C;(C=a._videoTrack)===null||C===void 0||C._onSei(R)}}):s==Me.AUDIO&&await T(h.receiver)}const f=this.remoteUserMap.get(a);f?f.set(s,l):this.remoteUserMap.set(a,new Map([[s,l]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadInboundStats();const m=this.pendingRemoteTracks.findIndex((S=>{let{user:T,kind:R}=S;return T.uid===a.uid&&s===R}));m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(it.MediaReconnectEnd,a.uid))}}async unsubscribe(e,t,i){const r=this.pendingRemoteTracks.filter((o=>{let{user:c,kind:d}=o;return t!==void 0?c.uid===e.uid&&t===d:c.uid===e.uid}));if(r.forEach((o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)})),this.connection&&this.state===Ue.Connected||i||r.forEach((o=>{let{kind:c}=o;var d;if(c===Me.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(c===Me.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==Ue.Connected)return;const a=this.filterTobeUnSubscribedTracks(e,t);if(a.length===0)return;await this.connection.stopReceiving(a.map((o=>{let[,{id:c}]=o;return c})));const s=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach((o=>{let[c,{kind:d}]=o;var l,h;if(d===Me.VIDEO&&c._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===Me.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),i||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(d===Me.AUDIO){var _;this.unbindRemoteTrackEvents(c._audioTrack),!i&&((_=c._audioTrack)===null||_===void 0||_._destroy(),c._audioTrack=void 0)}})),s}async unsubscribeDataChannel(e,t){if(t.forEach((a=>{const s=this.pendingRemoteDataChannels.findIndex((o=>o.id===a.id));s!==-1&&this.pendingRemoteDataChannels.splice(s,1)})),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,t);if(i.length===0)return;t.forEach((a=>{a._close()}));const r=this.remoteDataChannelMap.get(e);return i.forEach((a=>{r&&r.delete(a.id)})),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map((a=>a.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:a,mediaType:s}of e){const o=this.pendingRemoteTracks.filter((c=>{let{user:d,kind:l}=c;return s!==void 0?d.uid===a.uid&&s===l:d.uid===a.uid}));o.forEach((c=>{const d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)})),t=t.concat(o)}if(!this.connection||this.state!==Ue.Connected)return void t.forEach((a=>{let{user:s,kind:o}=a;var c;if(o===Me.AUDIO)(c=s._audioTrack)===null||c===void 0||c._destroy(),s._audioTrack=void 0;else if(o===Me.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}}));const i=Pn(e).call(e,((a,s)=>{let{user:o,mediaType:c}=s;const d=this.filterTobeUnSubscribedTracks(o,c);return a.concat(d)}),[]);if(i.length===0)return;await this.connection.stopReceiving(i.map((a=>{let[,{id:s}]=a;return s})));const r=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach((a=>{let[s,{kind:o}]=a;var c,d;if(o===Me.VIDEO&&s._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===Me.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(o===Me.AUDIO){var l;this.unbindRemoteTrackEvents(s._audioTrack),(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0}})),r}isPreSubScribe(e){return!this.connection||this.state!==Ue.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void w.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void w.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Me.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void w.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||w.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Ee.LocalAudioTrack),i=t&&t.track;i&&i.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Ee.LocalAudioTrack);if(t?.track instanceof xn){const i=t.track;return Array.from(this.localTrackMap.entries()).filter((r=>{let[a]=r;return a!==Ee.LocalAudioTrack})).filter((r=>{let[a]=r;return!(e&&a===Ee.LocalVideoLowTrack)})).map((r=>{let[,{track:a}]=r;return a})).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter((i=>{let[r]=i;return!(e&&r===Ee.LocalVideoLowTrack)})).map((i=>{let[,{track:r}]=i;return r}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,i,r,a){if(e){const o=this.localTrackMap.get(Ee.LocalAudioTrack),c=r?this.localTrackMap.get(Ee.LocalVideoLowTrack):this.localTrackMap.get(Ee.LocalVideoTrack);J.publish(this.store.sessionId,{eventElapse:ja.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(Ui.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var s;i||(i=[]);const o=i.find((d=>d instanceof yr)),c=r?(s=this.localTrackMap.get(Ee.LocalVideoTrack))===null||s===void 0?void 0:s.track:i.find((d=>d instanceof Xi));J.publish(this.store.sessionId,{eventElapse:ja.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(Ui.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,r){const a=r===Me.VIDEO?i._videoSSRC:i._audioSSRC;a&&J.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Me.VIDEO,audio:r===Me.AUDIO,peerid:i.uid,subscribeRequestid:a,p2pid:this.store.p2pId,eventElapse:ja.measureFromSubscribeStart(this.store.clientId,a),preSsrc:this.isPreSubScribe(a)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Wn("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=DR(this.store),this.emit(it.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ee.LocalAudioTrack);if(e?.track instanceof xn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((i=>{t.removeAudioTrack(i)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ue.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ee.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ee.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Xi||t&&t.track instanceof yr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;const i=Array.from(Pi(t=this.remoteUserMap).call(t)).find((r=>r.uid===e));return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((i=>{let[r]=i;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(Ee.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=vt(e).call(e,((i,r)=>i.level-r.level)),e}async disconnectForReconnect(){this.connection&&(w.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ue.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=DR(this.store),this.emit(it.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[i,{track:r}]=e;switch(i){case Ee.LocalVideoTrack:ee(t=r._hints).call(t,Ui.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Ee.LocalAudioTrack:r instanceof xn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Ee.LocalVideoLowTrack:}})),this.emit(it.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,i]=e;Array.from(Pi(i).call(i)).forEach((r=>{this.setPendingRemoteMedia(t,r)})),this.emit(it.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,i]=e;Array.from(Pi(i).call(i)).forEach((r=>{this.setPendingRemoteDataChannel(t,r)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),w.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const i of this.pendingRemoteDataChannels){const{user:r,id:a}=i;if((e instanceof S_?e.uid:e)===r.uid&&a===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const i of this.pendingRemoteTracks){const{user:r,kind:a}=i;if((e instanceof S_?e.uid:e)===r.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return oo((function*(){if(!t.connection||t.state!==Ue.Connected)return;const i=yield hi(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield hi(t.connection.restartICE(e));const s=yield hi(r.next());if(s.done)return;const o=s.value,c=yield o;switch(s0(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Tn.UDP_TCP_RELAY:t._pcStatsUploadType=Zh.UDP_TCP_RESTART;break;case Tn.TCP_RELAY:t._pcStatsUploadType=Zh.TCP_RESTART;break;case Tn.RELAY:t._pcStatsUploadType=Zh.RELAY_RESTART;break;default:t._pcStatsUploadType=Zh.OLD_RESTART}t._isTryConnecting=!0,r.next(c)}catch(s){var a;(a=r)===null||a===void 0||a.throw(s)}finally{i()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Ee.LocalVideoTrack),i=this.localTrackMap.get(Ee.LocalAudioTrack),r=e.videoSend.find((m=>m.ssrc===t?.ssrcs[0].ssrcId)),a=e.audioSend.find((m=>m.ssrc===i?.ssrcs[0].ssrcId));if(!r||!a)return 1;const s=Bs(this,it.NeedSignalRTT),o=r?r.rttMs:void 0,c=a?a.rttMs:void 0,d=o&&c?(o+c)/2:o||c,l=(d&&s?(d+s)/2:d||s)||0,h=100*e.sendPacketLossRate*.7/50+.3*l/1500,_=h<.17?1:h<.36?2:h<.59?3:h<.1?4:5,f=t?.track;if(f&&f._encoderConfig&&f._hints.indexOf(Ui.SCREEN_TRACK)===-1){const m=f._encoderConfig.bitrateMax,S=e.bitrate.actualEncoded;if(m&&S){const T=(1e3*m-S)/(1e3*m);return dE[T<.15?0:T<.3?1:T<.45?2:T<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((i=>{let[r]=i;const a=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find((S=>S.ssrc===a)),c=e.videoRecv.find((S=>S.ssrc===s));if(!o&&!c)return void(t+=1);const d=Bs(this,it.NeedSignalRTT),l=e.rtt,h=(l&&d?(l+d)/2:l||d)||0,_=o?o.jitterMs:void 0,f=e.recvPacketLossRate;let m=.7*f*100/50+.3*h/1500;_&&(m=.6*f*100/50+.2*h/1500+.2*_/400),t+=m<.1?1:m<.17?2:m<.36?3:m<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new se(((t,i)=>{this.handleMuteLocalTrack(e,t,i)}))}async replaceTrack(e,t){var i;if(w.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Ue.Connected)return;const r=Array.from(this.localTrackMap.entries()).find((s=>{let[,{track:o}]=s;return e===o}));if(!r)return;const a=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:a}]),this.bindLocalTrackEvents([{track:t,type:a}]),r[1].track=t),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(t,r[1].id)),this.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(a,s)}if(a===Ee.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Si().supportDualStreamEncoding){const s=this.localTrackMap.get(Ee.LocalVideoLowTrack);if(s){const o=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new se(((c,d)=>{this.handleReplaceTrack(s.track,c,d,!0)}))}}}filterTobePublishedTracks(e,t,i){const r=[],a=this.getAllTracks();e=i_(e=e.filter((d=>a.indexOf(d)===-1)));let s,o=!1;const c=this.localTrackMap.get(Ee.LocalAudioTrack);for(const d of e){if(d instanceof Xi&&(this.localTrackMap.has(Ee.LocalVideoTrack)||o?new _e(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:Ee.LocalVideoTrack}),o=!0),t)){const l=this.getLowVideoTrack(d,i);r.push({track:l,type:Ee.LocalVideoLowTrack})}if(d instanceof yr)if(c){const l=c.track;if(l instanceof xn)qb([d]),l.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const h=QU([l,d]);w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),this.replaceTrack(l,h)}}else s instanceof xn?(qb([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&Si().webAudioMediaStreamDest&&!d._bypassWebAudio?s=QU(s?[d,s]:[d]):s=d}return s&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:Ee.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],i=this.getAllTracks();e=i_(e=e.filter((r=>i.indexOf(r)!==-1)));for(const r of e){if(r instanceof yr){const a=this.localTrackMap.get(Ee.LocalAudioTrack);if(!a)continue;a.track instanceof xn?(a.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),a.track.trackList.length===0&&(t.push([Ee.LocalAudioTrack,a]),a.track.close())):t.push([Ee.LocalAudioTrack,a])}if(r instanceof Xi){const a=this.localTrackMap.get(Ee.LocalVideoTrack);if(!a)continue;t.push([Ee.LocalVideoTrack,a]);const s=this.localTrackMap.get(Ee.LocalVideoLowTrack);s&&t.push([Ee.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=i_(e)).filter((t=>this.localDataChannels.findIndex((i=>i.id===t.id))===-1))}filterTobeUnpublishedDataChannels(e){return e=(e=(e=i_(e)).filter((t=>this.localDataChannels.indexOf(t)!==-1))).filter((t=>t._originDataChannel))}bindLocalTrackEvents(e){e.forEach((t=>{let{track:i,type:r}=t;switch(r){case Ee.LocalVideoTrack:i.addListener(Oe.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Oe.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Oe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Oe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Oe.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ee.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ee.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof xn?e.trackList.forEach((i=>{i.addListener(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Oe.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Oe.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Oe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Oe.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[i,{track:r}]=t;return{track:r,type:i}}))),e.forEach((t=>{let{track:i,type:r}=t;switch(r){case Ee.LocalVideoTrack:i.off(Oe.GET_STATS,this.handleGetLocalVideoStats),i.off(Oe.GET_RTC_STATS,this.handleGetRTCStats),i.off(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Oe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Oe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Oe.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ee.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ee.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof xn?e.trackList.forEach((t=>{t.off(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Oe.GET_STATS,this.handleGetLocalAudioStats),t.off(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Oe.GET_STATS,this.handleGetLocalAudioStats),e.off(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Oe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Oe.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Wu&&t.addListener(Oe.GET_STATS,(i=>{i(this.handleGetRemoteVideoStats(e))})),t instanceof fc&&t.addListener(Oe.GET_STATS,(i=>{i(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Oe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,i]=e;i.has(Me.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(Me.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((i,r)=>{var a;let s,o,{track:c,type:d}=i;switch(d){case Ee.LocalAudioTrack:s=Vt.Audio,o={dtx:c instanceof vb&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ee.LocalVideoTrack:s=ee(a=c._hints).call(a,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High,o=Qu(Qu({},CU(c)),{},{codec:this.store.codec,svc_mode:xb()});break;case Ee.LocalVideoLowTrack:s=Vt.Low,o=Qu(Qu({},CU(c)),{},{codec:this.store.codec,svc_mode:xb()})}return{stream_type:s,attributes:o,ssrcs:t[r]}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var i;let r,[a,{track:s,ssrcs:o,id:c}]=t;switch(a){case Ee.LocalVideoTrack:r=ee(i=s._hints).call(i,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High;break;case Ee.LocalAudioTrack:r=Vt.Audio;break;case Ee.LocalVideoLowTrack:r=Vt.Low}return{stream_type:r,ssrcs:o,mid:c}}))}assignLocalTracks(e,t){e.forEach(((i,r)=>{let{track:a,type:s}=i;this.localTrackMap.set(s,{track:a,id:t[r].id,ssrcs:t[r].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[i]=t;this.localTrackMap.delete(i)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(it.PeerConnectionStateChange,t),t==="connecting"&&e instanceof vn&&!Ci()&&G("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{t==="connecting"&&e.extendCandidate()}),G("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof vn&&tx(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Zh.DISCONNECTED_OR_FAILED,Bs(this,it.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map((a=>a.getTrackId())),r=this.pendingLocalDataChannels.map((a=>"dc_".concat(a.id)));J.reportApiInvoke(this.store.sessionId,{name:Gt.REPUB_AFTER_PC_CONNECTED,options:i.concat(r),tag:Tr.TRACER}).onSuccess(),this.republish()}if(G("NEW_ICE_RESTART")&&e instanceof vn&&!Ci()&&!this._forceTurn){if(ee(Ae).call(Ae,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=a=>{s0(e)&&(w.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(a)),Bs(this,it.QueryClientConnectionState)==="CONNECTED"&&this.emit(it.RequestRestartICE,a))},r=()=>{s0(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),w.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(it.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{ei(e,i,r)}),800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout((()=>{e.iceConnectionState==="disconnected"&&G("ICE_RESTART")&&Bs(this,it.QueryClientConnectionState)==="CONNECTED"&&this.emit(it.RequestRestartICE)}),800),void setTimeout((()=>{e.peerConnectionState==="disconnected"&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(it.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);t==="failed"&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(it.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),J.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tr.TRACER}).onSuccess(),this.emit(it.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;const r=Array.from(Pi(i=this.remoteUserMap).call(i)).find((s=>s._audioSSRC===t));var a;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(a=r.audioTrack)===null||a===void 0||a.emit(Gs.FIRST_FRAME_DECODED),J.firstRemoteFrame(this.store.sessionId,qt.FIRST_AUDIO_DECODE,vr.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:ja.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;const r=Array.from(Pi(i=this.remoteUserMap).call(i)).find((a=>a._audioSSRC===t));r&&J.firstRemoteFrame(this.store.sessionId,qt.FIRST_AUDIO_RECEIVED,vr.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:ja.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,r)=>{var a;const s=Array.from(Pi(a=this.remoteUserMap).call(a)).find((o=>o._videoSSRC===t));s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,i,r)},e.onFirstVideoRender=t=>{var i;const r=Array.from(Pi(i=this.remoteUserMap).call(i)).find((a=>a._videoSSRC===t));r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r))},e.onFirstVideoReceived=t=>{var i;const r=Array.from(Pi(i=this.remoteUserMap).call(i)).find((a=>a._videoSSRC===t));r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),J.firstRemoteFrame(this.store.sessionId,qt.FIRST_VIDEO_RECEIVED,vr.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:ja.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,i)=>{const r=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&r===a||this.emit(it.ConnectionTypeChange,r),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xc(i))," -> ").concat(JSON.stringify(Xc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xc(i))," -> ").concat(JSON.stringify(Xc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Qu(Qu({},t),i)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof vn&&(function(t){Md.delete(t.id),tx(t)})(e),e.close(),this.emit(it.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const i=this.localTrackMap.get(Ee.LocalAudioTrack);if(e instanceof yr&&i?.track instanceof xn)return i.track.isActive||t.push([Ee.LocalAudioTrack,i]),t;const r=Array.from(this.localTrackMap.entries()).find((a=>{let[,{track:s}]=a;return e===s}));if(r&&(t.push(r),r[0]===Ee.LocalVideoTrack)){const a=this.localTrackMap.get(Ee.LocalVideoLowTrack);a&&t.push([Ee.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],i=this.localTrackMap.get(Ee.LocalAudioTrack);if(e instanceof yr&&i?.track instanceof xn)return i.track.isActive&&t.push([Ee.LocalAudioTrack,i]),t;const r=Array.from(this.localTrackMap.entries()).find((a=>{let[,{track:s}]=a;return e===s}));if(r)if(r[0]===Ee.LocalVideoTrack){t.push(r);const a=this.localTrackMap.get(Ee.LocalVideoLowTrack);a&&t.push([Ee.LocalVideoLowTrack,a])}else t.push(r);return t}createMuteMessage(e){return e.map((t=>{var i;let r,[a,{track:s,ssrcs:o,id:c}]=t;switch(a){case Ee.LocalAudioTrack:r=Vt.Audio;break;case Ee.LocalVideoTrack:r=ee(i=s._hints).call(i,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High;break;case Ee.LocalVideoLowTrack:r=Vt.Low}return{stream_type:r,ssrcs:o,mid:c}}))}createUnmuteMessage(e){return e.map((t=>{var i;let r,[a,{track:s,ssrcs:o,id:c}]=t;switch(a){case Ee.LocalAudioTrack:r=Vt.Audio;break;case Ee.LocalVideoTrack:r=ee(i=s._hints).call(i,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High;break;case Ee.LocalVideoLowTrack:r=Vt.Low}return{stream_type:r,ssrcs:o,mid:c}}))}filterTobeUnSubscribedTracks(e,t){const i=[],r=this.remoteUserMap.get(e);if(!r)return i;if(t){const a=r.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(r.entries()).forEach((a=>{let[s,o]=a;i.push([e,{kind:s,id:o}])}));return i}filterTobeUnSubscribedDataChannels(e,t){const i=[];return t.forEach((r=>{var a;(a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.has(r.id)&&i.push(r)})),i}createUnsubscribeMessage(e){const t=[];return e.forEach((i=>{let[r,{kind:a,id:s}]=i;switch(a){case Me.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Me.VIDEO,ssrcId:r._videoSSRC}));case Me.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Me.AUDIO,ssrcId:r._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((i=>{let[r,{kind:a}]=i;if(t.has(r)){let s=t.get(r);a===Me.VIDEO?s|=Lt.Video:s|=Lt.Audio,t.set(r,s)}else a===Me.VIDEO?t.set(r,Lt.Video):t.set(r,Lt.Audio)})),{users:Array.from(t.entries()).map((i=>{let[r,a]=i;return{stream_id:r.uid,stream_type:a}}))}}withdrawRemoteTracks(e){e.forEach((t=>{let[i,{kind:r}]=t;const a=this.remoteUserMap.get(i);a&&(a.delete(r),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ee.LocalVideoTrack),i=this.localTrackMap.get(Ee.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new se(((r,a)=>{this.handleUpdateVideoEncoder(t.track,r,a,!0)}))),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new se(((r,a)=>{this.handleUpdateVideoEncoder(i.track,r,a,!0)})))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof vn&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof vn&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,i){return e.map(((r,a)=>{var s;let{stream_type:o}=r;const c=(s=t.find((d=>{let{stream_type:l}=d;return o===l})))===null||s===void 0?void 0:s.attributes;if(c&&G("DISABLE_SCREEN_SHARE_REMB")){const d=i[a]._hints;(ee(d).call(d,Ui.SCREEN_TRACK)||ee(d).call(d,Ui.SCREEN_LOW_TRACK))&&(c.remb=!1,w.debug("disable remb for screen share, hints:",d))}return c}))}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof yr){var t;const r=this.filterTobeUnmutedTracks(e[i]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map((s=>{let[,{id:o}]=s;return o}))));const a=this.createUnmuteMessage(r);return void await fi(this,it.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(it.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(it.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ht(Od(this.dtlsFailedCount,ln)),this.emit(it.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await zt(this,it.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(it.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ee.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof Xi))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof Xi)).length>1)throw new _e(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof yr)).length>1&&(e.some((t=>t instanceof yr&&t._bypassWebAudio))||!Si().webAudioMediaStreamDest))throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Xi&&this.pendingLocalTracks.some((i=>i instanceof Xi)))throw new _e(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof yr&&this.pendingLocalTracks.some((i=>i instanceof yr))&&(!Si().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((i=>i instanceof yr&&i._bypassWebAudio))))throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var i;const r=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Si().supportDualStreamEncoding,a=Qu(Qu({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():o0(e,a);const o=Mi(8,"track-low-"),c=new Xi(s,Qu(Qu({},r&&{scaleResolutionDownBy:Qh(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,o);return c.on(Sl.TRANSCEIVER_UPDATED,(d=>{e._updateRtpTransceiver(d,nR.LOW_STREAM)})),c._hints.push(Ui.LOW_STREAM),ee(i=e._hints).call(i,Ui.SCREEN_TRACK)&&c._hints.push(Ui.SCREEN_LOW_TRACK),e.on("sei-to-send",(d=>{c.emit("sei-to-send",d)})),e.addListener(Oe.NEED_CLOSE,(()=>{c.close()})),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof vn){var a,s,o,c;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:h,peerConnectionState:_}=this.connection,{local:f,remote:m}=await this.connection.getSelectedCandidatePair();J.pcStats(this.store.sessionId,{startTime:d,eventElapse:e-d||0,iceconnectionsate:l,dtlsstate:h,connectionstate:_,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(a=f?.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(s=f.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(f.address,":").concat(f.port),selectedRemoteCandidateProtocol:(o=m.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(c=m.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(m.address,":").concat(m.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,i=t.firstVideoFrameDecoded.find((h=>h.userId===e.uid));if(!i)return;const{isInternalUpload:r,isExternalUpload:a}=i;if(r&&a)return;const{subscribeEnd:s,firstPreRender:o,peerPublishDuration:c,peerPubStatusMs:d}=i;let{firstRender:l=0}=i;if(s&&(l||o)&&c&&d){i.isInternalUpload=!0;const{playEnd:h}=i;h&&(i.isExternalUpload=!0);const{firstPreRender:_=0}=i;l=_||l;const f=e.videoTrack,m={peer:e._uintid,width:f?._videoWidth||0,height:f?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:c,peerPubStatusMs:d,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:i.userJoinNotify||0,videoAddNotify:i.videoAddNotify||0,subscribeStart:i.subscribeStart||0,subscribeEnd:i.subscribeEnd||0,firstReceived:i.firstReceived||0,firstDecoded:i.firstDecoded||0,firstPreRender:_||0,firstRender:h?Math.max(l,h):Math.max(l,s),playStart:i.playStart||0,playEnd:i.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:sa(this.store)};J.firstXLAPeerFirstVideoFrame(this.store.sessionId,m)}}reportVideoFirstFrameDecoded(e,t,i,r){var a;const s=Array.from(Pi(a=this.remoteUserMap).call(a)).find((o=>o._videoSSRC===e));if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find((d=>d.userId===s.uid&&d.type==="video"));J.firstRemoteVideoDecode(this.store.sessionId,qt.FIRST_VIDEO_DECODE,vr.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:i,subscribeElapse:ja.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0,firstFrame:c?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const a=r.get(t);if(!a)return!1;const s=await this.connection.getRemoteSSRC(a);return s!==void 0&&s!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:i}]=e;t===Ee.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,nR.LOW_STREAM):i._updateRtpTransceiver(void 0)}))}},Ze(ti.prototype,"startP2PConnection",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"startP2PConnection"),ti.prototype),Ze(ti.prototype,"connect",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"connect"),ti.prototype),Ze(ti.prototype,"updateRemoteRTPCapabilities",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"updateRemoteRTPCapabilities"),ti.prototype),Ze(ti.prototype,"publishDataChannel",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"publishDataChannel"),ti.prototype),Ze(ti.prototype,"unpublish",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"unpublish"),ti.prototype),Ze(ti.prototype,"unpublishDataChannel",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"unpublishDataChannel"),ti.prototype),Ze(ti.prototype,"unpublishLowStream",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"unpublishLowStream"),ti.prototype),Ze(ti.prototype,"subscribeDataChannel",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"subscribeDataChannel"),ti.prototype),Ze(ti.prototype,"subscribe",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"subscribe"),ti.prototype),Ze(ti.prototype,"massSubscribe",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"massSubscribe"),ti.prototype),Ze(ti.prototype,"unsubscribe",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"unsubscribe"),ti.prototype),Ze(ti.prototype,"unsubscribeDataChannel",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"unsubscribeDataChannel"),ti.prototype),Ze(ti.prototype,"massUnsubscribe",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"massUnsubscribe"),ti.prototype),Ze(ti.prototype,"muteRemote",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"muteRemote"),ti.prototype),Ze(ti.prototype,"unmuteRemote",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"unmuteRemote"),ti.prototype),Ze(ti.prototype,"hasRemoteMediaWithLock",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"hasRemoteMediaWithLock"),ti.prototype),Ze(ti.prototype,"disconnectForReconnect",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"disconnectForReconnect"),ti.prototype),Ze(ti.prototype,"updateBitrateLimit",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"updateBitrateLimit"),ti.prototype),Ze(ti.prototype,"remoteMediaSsrcChanged",[hs],Object.getOwnPropertyDescriptor(ti.prototype,"remoteMediaSsrcChanged"),ti.prototype),ti);function hs(e,t,i){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const a=this.mutex,s=await a.lock("From P2PChannel.".concat(t));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await r.apply(this,c)}finally{s()}},i}function ix(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function oj(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ix(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ix(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}const IH=Date.now(),rx=20,PR=new Map,Zb=new Map;async function nx(e){const t=PR.get(e),i=Array.isArray(t)&&t[t.length-1],r=Zb.get(e);if(!i)return void(r.isSyncing=!1);const a={uid:i.uid,payload:i.payload};r.firstRecvTs===0&&(r.firstRecvTs=i.recvTs,r.firstSendTs=i.sendTs);const s=i.sendTs-r.firstSendTs,o=s-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-s);let c=i.mediaDelay+o;c<=0?(t.pop(),cj(i.context,a),c=0):c=Math.min(c,rx),setTimeout((()=>t.length&&nx(e)),c)}function cj(e,t){e.safeEmit(yt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function wH(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return cj(i,{uid:e.uid,payload:e.payload});const r="".concat(i.id,"-").concat(e.uid),a=PR.get(r)||[],s=a.findIndex((l=>e.sendTs>=l.sendTs)),o=oj(oj({},e),{},{context:i,mediaDelay:t,recvTs:Date.now()});s===-1?a.push(o):a.splice(s,0,o),PR.set(r,a);let c=!1;var d;Zb.has(r)?c=!((d=Zb.get(r))===null||d===void 0||!d.isSyncing):Zb.set(r,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||nx(r)}const dj=_i().name;function ax(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Ug(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ax(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ax(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}const LR="websdk_ng_cache_parameter",OH=G("MAX_PRELOAD_ASYNC_LENGTH"),xg=1e4,Ud=new Map,v_=[];let Qb=null,$b=0,kR=0;const l0=new Map,sx=(function(e,t){const i=[];let r=0;const a=async()=>{const s=i.shift();s&&await s(),i.length>0&&r<t?a():r--};return async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return new se((async(d,l)=>{i.push((async()=>{try{const h=await e(...o);d(h)}catch(h){l(h)}})),r<t&&(r++,a())}))}})(ox,OH),u0=co.CancelToken.source();async function ox(e,t,i,r,a,s){try{if(!G("ENABLE_PRELOAD"))return;if(!Si().supportWebCrypto)return void Uc((()=>{w.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!i&&i!==null)throw new _e(L.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&rn(i,"token",1,2047),rn(e,"appid",1,2047),Dg(t),r&&Cl(r);const o=Yh();w.debug("preload channel ".concat(t,", uid is ").concat(r));const c={appId:e,cname:t,token:i||e,uid:typeof r!="string"?r:null,sid:o,proxyServer:a};let d,l;typeof r=="string"?(c.stringUid=r,[l,d]=await se.all([CH(r,{sid:o,appId:e},u0.token),KU(Ug(Ug({},c),{},{token:i||e,uid:0}),u0.token)]),c.uid=l.uid,d.gatewayInfo.uid=c.uid,d.gatewayInfo.res.uid=c.uid):(s&&(c.stringUid=s),d=await KU(c,u0.token));const h={sid:o,appId:e,cname:t,token:i||e,uid:c.stringUid||r,intUid:c.uid||d.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:l,ap:d};await(async function(_){let f;try{_.uid&&h0({appId:_.appId,cname:_.cname,token:_.token,uid:_.uid,stringUid:_.stringUid});const m=lj(_),S=await(async function(R,C){try{const b=await window.crypto.subtle.importKey("raw",p1(C),"AES-GCM",!1,["encrypt"]),N=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},b,xc(window.btoa(JSON.stringify(R))));return n_(new Uint8Array(N))}catch{return}})(_,_.token||_.appId);if(!S)return;f=eA(LR);const T=f?JSON.parse(f):[];T.push({[m]:S}),T.length>G("AP_CACHE_NUM")&&T.shift(),tA(LR,JSON.stringify(T))}catch(m){w.warn("Error caching server parameters:",m.message),tA(LR,"")}})(h),$b++}catch(o){throw kR++,(function(c){Qb||(Qb=window.setTimeout((()=>{let l="";l0.forEach(((h,_)=>{l+="".concat(_,": ").concat(h," ;")})),J.reportApiInvoke(null,{name:Gt.PRELOAD,options:{success:$b,failed:kR,err:l}}).onError(c),$b=0,kR=0,l0.clear(),Qb=null}),xg));const d=l0.get(c.code)||0;l0.set(c.code,d+1)})(o),o}}async function cx(e){try{if(G("AP_REQUEST_DETAIL")||G("ENABLE_ROLE_SELECT_EDGE"))return;const t=h0(e);if(!t||e.cloudProxyServer!=="disabled")return;const i=await(async function(r,a){try{const s=await window.crypto.subtle.importKey("raw",p1(a),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,xc(r));return JSON.parse(window.atob(n_(new Uint8Array(o))))}catch{return}})(t,e.token||e.appId);if(!i||!(function(r,a){return r.cname===a.cname&&r.appId===a.appId&&r.token===a.token?a.stringUid?r.stringUid===a.stringUid:typeof a.uid=="number"?r.uid===a.uid:r.uid==a.uid:!1})(i,e))return;if(i&&Date.now()-i.ts<G("AP_CACHE_LIFETIME"))return i}catch(t){w.warn("Error get preloadInfo",t.message)}}function h0(e){let t;try{if(t=eA(LR),!t)return;const i=JSON.parse(t),r=lj(e),a=(function(o,c){for(let d=o.length-1;d>=0;d--)if(c(o[d]))return d;return-1})(i,(o=>r in o));if(a===-1)return;const s=i.splice(a,1)[0];return tA(LR,JSON.stringify(i)),s[r]}catch(i){w.warn("Error delete preload info: ".concat(t),i.message),tA(LR,"")}}function p0(e){if(e){let t=Ud.get(e);t&&(window.clearTimeout(t),t=null,Ud.delete(e)),ee(v_).call(v_,e)||e.cloudProxyServer!=="disabled"||v_.push(e)}if(Ud.size<G("AP_CACHE_NUM")&&v_.length>0){const t=v_.shift();Ud.set(t,window.setTimeout((async()=>{const{appId:i,cname:r,token:a,stringUid:s,uid:o,proxyServer:c}=t;try{await sx(i,r,a,o,c,s),Ud.has(t)&&p0(t)}catch(d){w.warn("update preload failed",d.message),dx(t)}}),G("AP_UPDATE_INTERVAL")))}}function dx(e){const t=v_.indexOf(e);t!==-1&&v_.splice(t,1);let i=Ud.get(e);i&&(window.clearTimeout(i),i=null,Ud.delete(e),p0())}function lx(e,t){const i=e.sua,r=e.ap;t&&i&&J.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:t,uid:e.intUid,errorCode:null,extend:i.req}),J.reportResourceTiming(e.ap.url,e.sid),J.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((a=>a.ip)).join(","),eventType:"disabled",unilbsServerIds:[hn.CHOOSE_SERVER,hn.CLOUD_PROXY_FALLBACK].toString()}),J.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((a=>a.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[hn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function eA(e){return window.atob(window.localStorage.getItem(e)||"")}function tA(e,t){window.localStorage.setItem(e,window.btoa(t))}function lj(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),gB(t)}function NH(e){let t=(function(){const i=ux.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(i,r){let a=i.appId;a!==void 0&&(yn(r,10),ws(r,a));let s=i.cid;s!==void 0&&(yn(r,16),yn(r,s));let o=i.cname;o!==void 0&&(yn(r,26),ws(r,o));let c=i.deviceId;c!==void 0&&(yn(r,34),ws(r,c));let d=i.elapse;d!==void 0&&(yn(r,40),C_(r,d));let l=i.fileSize;l!==void 0&&(yn(r,48),C_(r,UR(l)));let h=i.height;h!==void 0&&(yn(r,56),C_(r,UR(h)));let _=i.jpg;_!==void 0&&(yn(r,66),yn(r,_.length),_x(r,_));let f=i.networkType;f!==void 0&&(yn(r,72),C_(r,UR(f)));let m=i.osType;m!==void 0&&(yn(r,80),C_(r,UR(m)));let S=i.requestId;S!==void 0&&(yn(r,90),ws(r,S));let T=i.sdkVersion;T!==void 0&&(yn(r,98),ws(r,T));let R=i.sequence;R!==void 0&&(yn(r,104),C_(r,UR(R)));let C=i.sid;C!==void 0&&(yn(r,114),ws(r,C));let b=i.timestamp;b!==void 0&&(yn(r,120),C_(r,b));let N=i.uid;N!==void 0&&(yn(r,128),yn(r,N));let k=i.vid;k!==void 0&&(yn(r,136),yn(r,k));let P=i.width;P!==void 0&&(yn(r,144),C_(r,UR(P)));let U=i.service;U!==void 0&&(yn(r,152),yn(r,U));let W=i.callbackData;W!==void 0&&(yn(r,162),yn(r,W.length),_x(r,W));let z=i.ticket;z!==void 0&&(yn(r,170),ws(r,z));let Q=i.vendorConfigs;Q!==void 0&&(yn(r,178),ws(r,Q))})(e,t),(function(i){let r=i.bytes,a=i.limit;return r.length===a?r:r.subarray(0,a)})(t)}function DH(e){return(function(i){let r={};e:for(;!_0(i);){let a=qr(i);switch(a>>>3){case 0:break e;case 1:r.code=qr(i);break;case 2:r.msg=y_(i,qr(i));break;case 3:r.requestId=y_(i,qr(i));break;case 4:r.timestamp=mE(i,!1);break;default:MR(i,7&a)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function MR(e,t){switch(t){case 0:for(;128&xd(e););break;case 2:hx(e,qr(e));break;case 5:hx(e,4);break;case 1:hx(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function UR(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let ux=[];function hx(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function _0(e){return e.offset>=e.limit}function iA(e,t){let i=e.bytes,r=e.offset,a=e.limit,s=r+t;if(s>i.length){let o=new Uint8Array(2*s);o.set(i),e.bytes=o}return e.offset=s,s>a&&(e.limit=s),r}function px(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function _x(e,t){let i=iA(e,t.length);e.bytes.set(t,i)}function y_(e,t){let i=px(e,t),r=String.fromCharCode,a=e.bytes,s="�",o="";for(let c=0;c<t;c++){let d,l,h,_,f=a[c+i];(128&f)==0?o+=r(f):(224&f)==192?c+1>=t?o+=s:(d=a[c+i+1],(192&d)!=128?o+=s:(_=(31&f)<<6|63&d,_<128?o+=s:(o+=r(_),c++))):(240&f)==224?c+2>=t?o+=s:(d=a[c+i+1],l=a[c+i+2],(49344&(d|l<<8))!=32896?o+=s:(_=(15&f)<<12|(63&d)<<6|63&l,_<2048||_>=55296&&_<=57343?o+=s:(o+=r(_),c+=2))):(248&f)==240?c+3>=t?o+=s:(d=a[c+i+1],l=a[c+i+2],h=a[c+i+3],(12632256&(d|l<<8|h<<16))!=8421504?o+=s:(_=(7&f)<<18|(63&d)<<12|(63&l)<<6|63&h,_<65536||_>1114111?o+=s:(_-=65536,o+=r(55296+(_>>10),56320+(1023&_)),c+=3))):o+=s}return o}function ws(e,t){let i=t.length,r=0;for(let o=0;o<i;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<i&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}yn(e,r);let a=iA(e,r),s=e.bytes;for(let o=0;o<i;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<i&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[a++]=c:(c<2048?s[a++]=c>>6&31|192:(c<65536?s[a++]=c>>12&15|224:(s[a++]=c>>18&7|240,s[a++]=c>>12&63|128),s[a++]=c>>6&63|128),s[a++]=63&c|128)}}function xd(e){return e.bytes[px(e,1)]}function xR(e,t){let i=iA(e,1);e.bytes[i]=t}function qr(e){let t,i=0,r=0;do t=xd(e),i<32&&(r|=(127&t)<<i),i+=7;while(128&t);return r}function yn(e,t){for(t>>>=0;t>=128;)xR(e,127&t|128),t>>>=7;xR(e,t)}function mE(e,t){let i,r=0,a=0,s=0;return i=xd(e),r=127&i,128&i&&(i=xd(e),r|=(127&i)<<7,128&i&&(i=xd(e),r|=(127&i)<<14,128&i&&(i=xd(e),r|=(127&i)<<21,128&i&&(i=xd(e),a=127&i,128&i&&(i=xd(e),a|=(127&i)<<7,128&i&&(i=xd(e),a|=(127&i)<<14,128&i&&(i=xd(e),a|=(127&i)<<21,128&i&&(i=xd(e),s=127&i,128&i&&(i=xd(e),s|=(127&i)<<7))))))))),{low:r|a<<28,high:a>>>4|s<<24,unsigned:t}}function C_(e,t){let i=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,s=a===0?r===0?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:a<128?9:10,o=iA(e,s),c=e.bytes;switch(s){case 10:c[o+9]=a>>>7&1;case 9:c[o+8]=s!==9?128|a:127&a;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?i>>>21|128:i>>>21&127;case 3:c[o+2]=s!==3?i>>>14|128:i>>>14&127;case 2:c[o+1]=s!==2?i>>>7|128:i>>>7&127;case 1:c[o]=s!==1?128|i:127&i}}const fx={},rA={},f0=4294967296,PH=f0*f0,Ex=PH/2;VR(0,!0);const uj=VR(0),LH=FR(0,-2147483648,!1),hj=FR(-1,2147483647,!1);function VR(e,t){let i,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=rA[e],r)?r:(i=FR(e,0,!0),a&&(rA[e]=i),i):(a=-128<=(e|=0)&&e<128)&&(r=fx[e],r)?r:(i=FR(e,e<0?-1:0,!1),a&&(fx[e]=i),i)}function FR(e,t,i){return{low:0|e,high:0|t,unsigned:!!i}}function mx(e,t){if(isNaN(e))return uj;{if(e<=-Ex)return LH;if(e+1>=Ex)return hj}return e<0?uj:FR(e%f0|0,e/f0|0,t)}function E0(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}class m0 extends or{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const i=this._connectionState;this._connectionState=t,this.emit(Fo.CONNECTION_STATE_CHANGE,t,i)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(t){var i;super(),V(this,"name","AgoraRTCImageModeration"),V(this,"_connectionState",Aa.CONNECTING),V(this,"_sequence",0),V(this,"_moderationStartTime",void 0),V(this,"_workerConnection",void 0),V(this,"_workerMessageLengthLimit",void 0),V(this,"_qualityRatio",void 0),V(this,"_connectInfo",void 0),V(this,"_cancelTokenSource",co.CancelToken.source()),V(this,"_retryConfig",void 0),V(this,"_moderationInterval",void 0),V(this,"_moderationTimer",null),V(this,"_moderationMode",1),V(this,"_quality",1),V(this,"_qualityTimer",null),V(this,"_ticket",void 0),V(this,"_moderationIntervalMinimum",void 0),V(this,"_uploadFailedNum",0),V(this,"_uploadNum",0),V(this,"_uploadTimer",null),V(this,"_extraInfo",void 0),V(this,"_vendor",""),V(this,"_encoder",new TextEncoder),V(this,"_moderationId",void 0),V(this,"inspectImage",(()=>{if(this.connectionState!==Aa.CONNECTED)throw new oe(L.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===Aa.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=Mi(5,"image-moderation-"),this._workerMessageLengthLimit=G("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=G("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=G("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Mb("worker-"+this._moderationId,ln),this.on(Fo.STATE_CHANGE,((r,a)=>{w.debug("[".concat(this._moderationId,"] Moderation operation :").concat(kr[r]," ").concat(a||""))})),this.handleWorkerEvents()}async init(t,i){this.emit(Fo.STATE_CHANGE,kr.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=i,new se(((a,s)=>{this.on(Fo.CONNECTION_STATE_CHANGE,((o,c)=>{o===Aa.CONNECTED&&a()})),this.requestAP(t,r,i).then((o=>{this.connectWorker(o)})).catch((o=>{s(o)}))}))}updateConfig(t){var i;this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),w.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Aa.CONNECTED&&this.inspectImage()}async requestAP(t,i,r){const a=G("WEBCS_DOMAIN").map((d=>"https://".concat(d,"/api/v1"))),s=await(function(d,l,h,_){let{appId:f,areaCode:m,cname:S,sid:T,token:R,uid:C}=l;Xu++;const b="moderation_plugin",N={service_name:b,json_body:JSON.stringify({appId:f,areaCode:m,cname:S,command:"allocateEdge",requestId:Xu,seq:Xu,sid:T,appToken:R,ts:Date.now(),uid:C+""})};let k,P,U=d[0];return Vc((async()=>{k=Date.now();const W=await Sc(U,{data:N,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(P=Date.now()-k,W.code!==0){const he=new oe(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+W.code,{retry:!0,responseTime:P});throw w.error(he.toString()),he}const z=JSON.parse(W.json_body);if(z.code!==200){const he=new oe(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(z.code,", reason: ").concat(z.reason),{code:z.code,responseTime:P});throw w.error(he.toString()),he}if(!z.servers||!Array.isArray(z.servers)||z.servers.length===0){const he=new oe(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:z.code,responseTime:P});throw w.error(he.toString()),he}if(!z.servers.some((he=>!!he.wss))){const he=new oe(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:z.code,responseTime:P});throw w.error(he.toString()),he}const Q=G("IMAGE_MODERATION_WORKER_HOST");return{addressList:z.servers.map((he=>{let{address:Ge,wss:xe}=he;if(Ge&&xe)return"wss://".concat(Ge.replace(/\./g,"-"),".").concat(Q,":").concat(xe,"/moderation")})).filter((he=>!!he)),workerToken:z.workerToken,vid:z.vid,ticket:z.appTicket,responseTime:P}}),((W,z)=>(J.apworkerEvent(T,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(W.addressList),firstSuccess:z===0,responseTime:P,serverIp:d[z%d.length]}),!1)),((W,z)=>(J.apworkerEvent(T,{success:!1,sc:W.data&&W.data.code||200,serviceName:b,responseTime:P,serverIp:d[z%d.length]}),!!(W.code!==L.OPERATION_ABORTED&&W.code!==L.UNEXPECTED_RESPONSE||W.data&&W.data.retry)&&(U=d[(z+1)%d.length],!0))),_)})(a,t,i,r);this.emit(Fo.STATE_CHANGE,kr.AP_CONNECTED);const{addressList:o,ticket:c}=s;return this._ticket=c,o}async connectWorker(t){this.emit(Fo.STATE_CHANGE,kr.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Pt.CONNECTED,(async()=>{this.emit(Fo.STATE_CHANGE,kr.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Aa.CONNECTED})),this._workerConnection.on(Pt.CLOSED,(()=>{this.connectionState=Aa.CLOSED})),this._workerConnection.on(Pt.FAILED,(()=>{this.connectionState=Aa.CLOSED})),this._workerConnection.on(Pt.RECONNECTING,(()=>{this.connectionState=this.connectionState===Aa.CONNECTED?Aa.RECONNECTING:Aa.CONNECTING})),this._workerConnection.on(Pt.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const i=DH(new Uint8Array(t.data));G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,w.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{J.reportApiInvoke(this._connectInfo.sid||null,{name:Gt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Tr.TRACER}).onError(new oe(L.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null}),G("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else w.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(Pt.WILL_RECONNECT,((t,i,r)=>{t==="recover"&&r(t),r("tryNext")})),this._workerConnection.on(Pt.REQUEST_NEW_URLS,((t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)}))}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Bs(this,Fo.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,i);this._workerConnection.sendMessage(r,!0,!0)}else G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being published can be inspected")}async generateRequestData(t,i){let{appId:r,cname:a,cid:s,vid:o,sid:c,uid:d}=i;const l=Date.now(),h=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await OO(h,r,a),f=this._sequence+"-"+s+"-"+d+"-"+l+"-"+Mi(12,""),m={appId:r,cid:s,cname:a,deviceId:"",elapse:m0.intToLong(Number(l-this._moderationStartTime)),fileSize:h.buffer.byteLength,height:h.height,width:h.width,jpg:_,networkType:6,osType:7,requestId:f,sdkVersion:"4.24.0",sequence:this._sequence,sid:c,timestamp:mx(l),uid:d,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete m.callbackData;const S=NH(m);if(S.byteLength<this._workerMessageLengthLimit){if(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const T=(function(R){for(var C=1;C<arguments.length;C++){var b=arguments[C]!=null?arguments[C]:{};C%2?E0(Object(b),!0).forEach((function(N){V(R,N,b[N])})):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(b)):E0(Object(b)).forEach((function(N){Object.defineProperty(R,N,Object.getOwnPropertyDescriptor(b,N))}))}return R})({},m);delete T.jpg,w.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(T))}return S}{const T=this.quality*this._qualityRatio;return this.quality=T,await this.generateRequestData(t,{appId:r,cname:a,cid:s,vid:o,sid:c,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=co.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Aa.CLOSED,this.emit(Fo.STATE_CHANGE,kr.CLOSED)}}function pj(e){if(ji(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new oe(L.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new oe(L.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const _j={name:"ImageModeration",create:function(e){let{config:t}=e;return pj(t),new m0(t)}};var gx,Sx,Tx,Rx,vx,yx,Cx,bx,Ax,Ix,wx,Ox,Nx,Dx,Px,Lx,kx,Mx,Ux,xx,Vx,Fx,Bx,jx,Gx,Wx,Hx,Kx,Yx,zx,qx,Xx,Jx,Zx,Qx,$x,eV,tV,iV,rV,Ke,Ye;function Vd(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Nl(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Vd(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Vd(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}Wn.setLogger(w);let nA=(gx=Te(),Sx=Te({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof wg))return[t];t=[t]}return t.map((i=>i?Object(i).toString():"null"))}}),Tx=Te({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==ys.DATA?(Array.isArray(t)||(t=[t]),t.map((i=>i.getTrackId()))):[t.getChannelId()])}),Rx=Te({argsMap:(e,t,i,r)=>[typeof t=="object"?t.uid:t,i,r]}),vx=Te({argsMap:(e,t,i)=>[t,i]}),yx=Te({argsMap:(e,t)=>t.map((i=>{let{user:r,mediaType:a}=i;return[r?.uid,a]}))}),Cx=Te({argsMap:(e,t,i,r)=>[typeof t=="object"?t.uid:t,i,r]}),bx=Te({argsMap:(e,t)=>t.map((i=>{let{user:r,mediaType:a}=i;return{uid:r?.uid,mediaType:a}}))}),Ax=Te(),Ix=Te(),wx=Te(),Ox=Te(),Nx=Te(),Dx=Te(),Px=Te(),Lx=Te(),kx=Te(),Mx=Te(),Ux=Te(),xx=Te(),Vx=Te(),Fx=Te(),Bx=Te(),jx=Te({argsMap:(e,t)=>[t]}),Gx=Te(),Wx=Te(),Hx=Te(),Kx=Te(),Yx=Te(),zx=Te(),qx=Te(),Xx=Te(),Jx=Te({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),Zx=Te(),Qx=Te(),$x=Te(),eV=Te(),tV=Te(),iV=Te(),rV=Te({reportResult:!0}),Ke=Te(),Ye=class extends or{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let i;if(super(),V(this,"store",void 0),V(this,"_uid",void 0),V(this,"_channelName",void 0),V(this,"_uintUid",void 0),V(this,"_users",[]),V(this,"_config",void 0),V(this,"_clientId",void 0),V(this,"_appId",void 0),V(this,"_sessionId",null),V(this,"_key",void 0),V(this,"_rtmConfig",{}),V(this,"_joinInfo",void 0),V(this,"_gateway",void 0),V(this,"_statsCollector",void 0),V(this,"_configDistribute",void 0),V(this,"_leaveMutex",void 0),V(this,"_publishMutex",void 0),V(this,"_renewTokenMutex",void 0),V(this,"_subscribeMutex",void 0),V(this,"_encryptionMode","none"),V(this,"_encryptionSecret",null),V(this,"_encryptionSalt",null),V(this,"_encryptDataStream",!1),V(this,"_encryptDataStreamKey",null),V(this,"_encryptDataStreamIv",null),V(this,"_proxyServer",void 0),V(this,"_turnServer",{servers:[],mode:"auto"}),V(this,"_cloudProxyServerMode","disabled"),V(this,"_isDualStreamEnabled",!1),V(this,"_defaultStreamFallbackType",void 0),V(this,"_lowStreamParameter",void 0),V(this,"_streamFallbackTypeCacheMap",new Map),V(this,"_remoteStreamTypeCacheMap",new Map),V(this,"_axiosCancelSource",co.CancelToken.source()),V(this,"_audioVolumeIndicationInterval",void 0),V(this,"_networkQualityInterval",void 0),V(this,"_userOfflineTimeout",void 0),V(this,"_streamRemovedTimeout",void 0),V(this,"_liveTranscodeStreamingClient",void 0),V(this,"_liveRawStreamingClient",void 0),V(this,"_channelMediaRelayClient",void 0),V(this,"_networkQualitySensitivity","normal"),V(this,"_p2pChannel",void 0),V(this,"_useLocalAccessPoint",!1),V(this,"_setLocalAPVersion",void 0),V(this,"_joinAndNotLeaveYet",!1),V(this,"_numberOfJoinCount",0),V(this,"_joinResponse",null),V(this,"_remoteDefaultVideoStreamType",void 0),V(this,"_inspect",void 0),V(this,"_moderation",void 0),V(this,"_license",void 0),V(this,"_pendingPublishedUsers",[]),V(this,"ntpAlignErrorCount",0),V(this,"remoteInboundOffset",0),V(this,"_peerConnectionState",void 0),V(this,"_handleLocalTrackEnable",((a,s,o)=>{this.publish(a,!1).then(s).catch(o)})),V(this,"_handleLocalTrackDisable",((a,s,o)=>{this.unpublish(a).then(s).catch(o)})),V(this,"_handleUserOnline",(a=>{if(G("BLOCK_LOCAL_CLIENT")&&u_(a.uid,this.channelName))return void w.debug("[".concat(a.uid,"] will be ignored in local"));this.isStringUID&&typeof a.uid!="string"&&w.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find((o=>o.uid===a.uid));if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(yt.USER_JOINED,s));else{const o=new S_(a.uid,a.uint_id||a.uid);this._users.push(o),w.debug("[".concat(this._clientId,"] user online"),a.uid),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.safeEmit(yt.USER_JOINED,o)}})),V(this,"_handleUserOffline",(a=>{if(G("BLOCK_LOCAL_CLIENT")&&u_(a.uid,this.channelName))return;const s=this._users.find((o=>o.uid===a.uid));s&&(this._handleRemoveStream(a),this._handleRemoveDataChannels(a),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:t_(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),w.debug("[".concat(this._clientId,"] user offline"),a.uid,"reason:",a.reason),this.safeEmit(yt.USER_LEAVED,s,a.reason))})),V(this,"_handleAddAudioOrVideoStream",((a,s,o,c,d,l,h,_)=>{if(G("BLOCK_LOCAL_CLIENT")&&u_(s,this.channelName))return;const f=this._users.find((S=>S.uid===s));if(!f)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(a)),this.store.subscribe(f.uid,a,void 0,void 0,void 0,Date.now()),a==="video"&&this.store.firstVideoFrameDecoded(f.uid,{videoAddNotify:Date.now()});const m=a==="audio"?f.hasAudio:f.hasVideo;if(f._uintid||(f._uintid=l||s),a==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,a==="audio"?(f._audio_added_=!0,o!==void 0&&(f._audioSSRC=o),c!==void 0&&(f._cname=c),h&&(f._audioOrtc=h)):(f._video_added_=!0,o!==void 0&&(f._videoSSRC=o),c!==void 0&&(f._cname=c),_!==void 0&&(f._rtxSsrcId=_),h&&(f._videoOrtc=h)),(a==="audio"?f.hasAudio:f.hasVideo)&&!m&&(w.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(a)),this.safeEmit(yt.USER_PUBLISHED,f,a)),a==="video"?J.onGatewayStream(this._sessionId,qt.ON_ADD_VIDEO_STREAM,vr.ON_ADD_VIDEO_STREAM,{peer:l||s,ssrc:f._videoSSRC}):J.onGatewayStream(this._sessionId,qt.ON_ADD_AUDIO_STREAM,vr.ON_ADD_AUDIO_STREAM,{peer:l||s,ssrc:f._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(f,a,o).then((S=>{if(S&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(f.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Oa))return this._p2pChannel.unsubscribe(f,a,!0).then((()=>this._subscribe(f,a,!0).catch((T=>{w.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(f,a)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,a,!0).catch((S=>{w.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))),a==="video"&&!Ra()&&!Jn()){const S=this._getEncodingName(d);S?.toLocaleLowerCase()==eR.av1&&WU().then((T=>{T||this._gateway.downgradeCodec(S)}))}})),V(this,"_handleRemoveStream",(a=>{if(G("BLOCK_LOCAL_CLIENT")&&u_(a.uid,this.channelName))return;const s=this._users.find((c=>c.uid===a.uid));if(!s)return void w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));w.debug("[".concat(this._clientId,"] stream removed with uid ").concat(a.uid));let o=()=>{};s.hasAudio&&s.hasVideo?o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(yt.USER_UNPUBLISHED,s,"audio"),w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(yt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(yt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(yt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Oa&&this._p2pChannel.unsubscribe(s).then((c=>{if(c)return this._gateway.unsubscribe(c,s.uid)})),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),J.onGatewayStream(this._sessionId,qt.ON_REMOVE_STREAM,vr.ON_REMOVE_STREAM,{peer:a.uint_id||a.uid}),o()})),V(this,"_handleSetStreamLocalEnable",((a,s,o)=>{if(G("BLOCK_LOCAL_CLIENT")&&u_(s,this.channelName))return;const c=this._users.find((h=>h.uid===s));if(!c)return void w.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));w.debug("[".concat(this._clientId,"] local ").concat(a," ").concat(o?"enabled":"disabled"," with uid ").concat(s));const d=a==="audio"?c.hasAudio:c.hasVideo;if(a==="audio"){c._trust_audio_enabled_state_=!0;const h=c._audio_enabled_;if(c._audio_enabled_=o,c._audio_enabled_===h)return;{const _=c._audio_enabled_?"enable-local-audio":"disable-local-audio";w.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(yt.USER_INFO_UPDATED,s,_)}}else{c._trust_video_enabled_state_=!0;const h=c._video_enabled_;if(c._video_enabled_=o,c._video_enabled_===h)return;{const _=c._video_enabled_?"enable-local-video":"disable-local-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(yt.USER_INFO_UPDATED,s,_)}}const l=a==="audio"?c.hasAudio:c.hasVideo;return d!==l?!d&&l?(w.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(a)),void this.safeEmit(yt.USER_PUBLISHED,c,a)):(a==="video"&&c._videoTrack&&c._videoTrack._destroy(),a==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,a),w.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(a)),void this.safeEmit(yt.USER_UNPUBLISHED,c,a)):void 0})),V(this,"_handleMuteStream",((a,s,o)=>{if(G("BLOCK_LOCAL_CLIENT")&&u_(a,this.channelName))return;w.debug("[".concat(this._clientId,"] receive mute message"),a,s,o);const c=this._users.find((h=>h.uid===a));if(!c)return void w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a));const d=s==="audio"?c.hasAudio:c.hasVideo;if(s==="audio"){c._trust_audio_mute_state_=!0;const h=c._audio_muted_;if(c._audio_muted_=o,c._audio_muted_===h)return;{const _=c._audio_muted_?"mute-audio":"unmute-audio";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(_)),this.safeEmit(yt.USER_INFO_UPDATED,a,_)}}else{c._trust_video_mute_state_=!0;const h=c._video_muted_;if(c._video_muted_=o,c._video_muted_===h)return;{const _=c._video_muted_?"mute-video":"unmute-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(_)),this.safeEmit(yt.USER_INFO_UPDATED,a,_)}}const l=s==="audio"?c.hasAudio:c.hasVideo;if(d!==l){if(!d&&l)return(s==="audio"?c._audioSSRC:c._videoSSRC)?(w.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(s)),void this.safeEmit(yt.USER_PUBLISHED,c,s)):void w.warning("[".concat(this._clientId,"] remote user ").concat(a," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),s==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,s),w.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(s)),this.safeEmit(yt.USER_UNPUBLISHED,c,s)}})),V(this,"_handleP2PLost",(async a=>{w.debug("[".concat(this._clientId,"] receive p2p lost"),a),parseInt(a.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():w.warning("[".concat(this._clientId,"] P2PLost stream not found"),a)})),V(this,"_handleTokenWillExpire",(()=>{w.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(yt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),V(this,"_handleBeforeUnload",(a=>{a.type==="beforeunload"&&a.returnValue!==void 0&&a.returnValue!==""||(this.leave(),w.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),V(this,"_handleUpdateNetworkQuality",(()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(yt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const a={downlinkNetworkQuality:0,uplinkNetworkQuality:0};a.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),a.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(yt.NETWORK_QUALITY,a)})),V(this,"_handleP2PAddAudioOrVideoStream",((a,s,o,c)=>{const d=this._users.find((h=>h.uid===s));if(!d)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(a)),this.store.subscribe(d.uid,a,void 0,void 0,void 0,Date.now());const l=a==="audio"?d.hasAudio:d.hasVideo;a==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,a==="audio"?(d._audio_added_=!0,o!==void 0&&(d._audioSSRC=o),c!==void 0&&(d._audioMid=c)):(d._video_added_=!0,o!==void 0&&(d._videoSSRC=o),c!==void 0&&(d._videoMid=c)),(a==="audio"?d.hasAudio:d.hasVideo)&&!l&&(w.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(a)),this.safeEmit(yt.USER_PUBLISHED,d,a)),this._p2pChannel.hasPendingRemoteMedia(d,a)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,a,!0).catch((h=>{w.error("[".concat(this._clientId,"] resubscribe error"),h.toString())})))})),this._config=e,this._clientId=t||Mi(5,"client-"),this.store=new class{constructor(a,s,o,c){wt(this,"state",void 0),this.state={codec:a,audioCodec:s,mode:o,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:wn.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(a){this.state=(function(s,o){switch(o.type){case bt.SET_SESSION_ID:return M(M({},s),{},{sessionId:o.sessionId});case bt.SET_P2P_ID:return M(M({},s),{},{p2pId:o.p2pId});case bt.SET_UID:return M(M({},s),{},{uid:o.uid});case bt.SET_INT_UID:return M(M({},s),{},{intUid:o.intUid});case bt.SET_PUB_ID:return M(M({},s),{},{pubId:o.pubId});case bt.KEY_METRIC_CLIENT_CREATED:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{clientCreated:o.metric})});case bt.KEY_METRIC_JOIN_START:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{joinStart:o.metric})});case bt.KEY_METRIC_PRELOAD_START:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{preloadStart:o.metric})});case bt.KEY_METRIC_PRELOAD_END:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{preloadEnd:o.metric})});case bt.KEY_METRIC_JOIN_END:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{joinEnd:o.metric})});case bt.KEY_METRIC_REQUEST_AP_START:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{requestAPStart:o.metric})});case bt.KEY_METRIC_REQUEST_AP_END:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{requestAPEnd:o.metric})});case bt.KEY_METRIC_REQUEST_SUA_END:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{requestSUAEnd:o.metric})});case bt.KEY_METRIC_BEFORE_CONNECT:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{beforeConnect:o.metric})});case bt.KEY_METRIC_PEER_RECEIVER:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{peerReceiver:o.metric})});case bt.KEY_METRIC_SIGNAL_CONNECTED:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{signalConnected:o.metric})});case bt.KEY_METRIC_JOIN_REQ:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{joinReq:o.metric})});case bt.KEY_METRIC_JOIN_REP:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{joinRep:o.metric})});case bt.KEY_METRIC_JOIN_GATEWAY_START:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{joinGatewayStart:o.metric})});case bt.KEY_METRIC_JOIN_GATEWAY_END:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{joinGatewayEnd:o.metric})});case bt.KEY_METRIC_PEER_CONNECTION_START:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{peerConnectionStart:o.metric})});case bt.KEY_METRIC_PEER_CONNECTION_END:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{peerConnectionEnd:o.metric})});case bt.KEY_METRIC_DESCRIPTION_START:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{descriptionStart:o.metric})});case bt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{signalChannelOpen:o.metric})});case bt.KEY_METRIC_ICE_CONNECTION_END:return M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{iceConnectionEnd:o.metric})});case bt.KEY_METRIC_PUBLISH:{const c=s.keyMetrics.publish,d=c.findIndex((l=>l.trackId===o.metric.trackId));return d!==-1?(c[d]=M(M({},c[d]),o.metric),M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{publish:[...c]})})):M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,o.metric]})})}case bt.KEY_METRIC_SUBSCRIBE:{const c=s.keyMetrics.subscribe,d=c.findIndex((l=>l.userId===o.metric.userId&&l.type===o.metric.type));return d!==-1?(c[d]=M(M({},c[d]),o.metric),M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{subscribe:[...c]})})):M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,o.metric]})})}case bt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const c=s.keyMetrics.firstVideoFrameDecoded,d=c.findIndex((l=>l.userId===o.metric.userId));return d!==-1?(c[d]=M(M({},c[d]),o.metric),M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{firstVideoFrameDecoded:[...c]})})):M(M({},s),{},{keyMetrics:M(M({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,o.metric]})})}case bt.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case bt.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=o.mode,s;case bt.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,o.record]:(s.joinChannelServiceRecords[o.index]=M(M({},s.joinChannelServiceRecords[o.index]),o.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case bt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case bt.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case bt.SET_USE_P2P:return M(M({},s),{},{useP2P:o.val});case bt.SET_TRANSPORT_TYPE:return M(M({},s),{},{p2pTransport:o.val});default:return s}})(this.state,a)}set autoSubscribe(a){this.state.autoSubscribe=a}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(a){this.state.enableInstantMuteRestore=a}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(a){this.dispatch({type:bt.SET_SESSION_ID,sessionId:a})}get sessionId(){return this.state.sessionId}set cid(a){this.state.cid=a}get cid(){return this.state.cid}set codec(a){this.state.codec=a}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(a){this.dispatch({type:bt.SET_P2P_ID,p2pId:a})}get p2pId(){return this.state.p2pId}set dcId(a){this.dispatch({type:bt.SET_DC_ID,dcId:a})}get dcId(){return this.state.dcId}set uid(a){this.dispatch({type:bt.SET_UID,uid:a})}get uid(){return this.state.uid}set intUid(a){this.dispatch({type:bt.SET_INT_UID,intUid:a})}get intUid(){return this.state.intUid}set pubId(a){this.dispatch({type:bt.SET_PUB_ID,pubId:a})}get pubId(){return this.state.pubId}set cloudProxyServerMode(a){this.dispatch({type:bt.SET_CLOUD_PROXY_SERVER_MODE,mode:a})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(a){this.dispatch({type:bt.SET_USE_P2P,val:a})}get useP2P(){return this.state.useP2P}set p2pTransport(a){this.dispatch({type:bt.SET_TRANSPORT_TYPE,val:a})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(a){this.state.hasStartJoinChannel=a}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(a){this.state.isABTestSuccess=a}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:bt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:bt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:bt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:bt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:bt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:bt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:bt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:bt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:bt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:bt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:bt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:bt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:bt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:bt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:bt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:bt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:bt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(a,s){this.dispatch({type:bt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:M({userId:a},s)})}descriptionStart(){this.dispatch({type:bt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:bt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:bt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(a,s,o,c){this.dispatch({type:bt.KEY_METRIC_PUBLISH,metric:M(M({trackId:a,type:s},o&&{publishStart:o}),c&&{publishEnd:c})})}subscribe(a,s,o,c,d,l,h){this.dispatch({type:bt.KEY_METRIC_SUBSCRIBE,metric:M(M(M(M(M({userId:a,type:s},o&&{subscribeStart:o}),c&&{subscribeEnd:c}),d&&{firstFrame:d}),l&&{streamAdded:l}),h&&{firstDecoded:h})})}massSubscribe(a,s,o,c){a.forEach((d=>{this.dispatch({type:bt.KEY_METRIC_SUBSCRIBE,metric:M(M(M({userId:d.userId,type:d.type},s&&{subscribeStart:s}),o&&{subscribeEnd:o}),c&&{firstFrame:c})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(a,s){a.service==="gateway"&&Array.isArray(a.urls)&&(a.urls=a.urls.map((o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return typeof s!="number"?(this.dispatch({type:bt.RECORD_JOIN_CHANNEL_SERVICE,record:M(M({},a),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:bt.RECORD_JOIN_CHANNEL_SERVICE,record:a,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:bt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:bt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:bt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Wn("client-leave",this._clientId),this._publishMutex=new Wn("client-publish",this._clientId),this._renewTokenMutex=new Wn("client-renewtoken",this._clientId),this._subscribeMutex=new Wn("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),w.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(lc," build: ").concat(Eb,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{ri(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(a){w.warning("[".concat(this._clientId,"] ").concat(a.toString()))}var r;this._statsCollector=new AR(this.store),this._statsCollector.onStatsException=(a,s,o)=>{w.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(a,", msg: ").concat(s,", uid: ").concat(o)),a===Ia.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((c=>{c instanceof sR&&G("ENABLE_ENCODE_EXCEPTION")&&c.findClosestProfile()})),this.safeEmit(yt.EXCEPTION,{code:a,msg:s,uid:o})},this._statsCollector.onUploadPublishDuration=(a,s,o,c)=>{const d=this._users.find((l=>l.uid===a));d&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(d._uintid,{peerPublishDuration:o,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(d)),J.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:s,videoPublishDuration:o,peer:d._uintid}))},this._statsCollector.onVideoCodecChanged=a=>{if(G("VIDEO_STANDARD_BITRATE_VERSION")&&(a==="av1"||a==="h265"||a==="h264")){const s=this.localTracks.find((o=>o instanceof Xi));s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(a==="h264"?G("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new qO(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||ln,httpRetryConfig:e.httpRetryConfig||ln,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new AH(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},ip("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new Oa(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,i,r,a){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];B("JOIN_GATEWAY_USE_443PORT_ONLY",s),B("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const c=this._gateway.signal.websocket;return c instanceof Pg&&(c.use443PortOnly=s,c.tryDoubleDomain=o),(async function(d,l,h){Sg.get(d)||Sg.set(d,[]),bd.get(d)||bd.set(d,l),Br.get(d)||Br.set(d,0);const _=Sg.get(d),f=bd.get(d);if(!_||!f)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Br.get(d)===f){const C=$f();_.push(C),await C.promise}Br.set(d,Br.get(d)+1);for(var m=arguments.length,S=new Array(m>3?m-3:0),T=3;T<m;T++)S[T-3]=arguments[T];const R=await h(...S);return Br.set(d,Br.get(d)-1),Br.get(d)===f-1&&_.length>0&&(_[0].resolve(),_.shift()),Br.get(d)===0&&(Sg.set(d,[]),bd.set(d,0),Br.set(d,0)),R})("client.join",G("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,i,r,a)}async join(e,t,i,r,a){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o=(ub||ub||(ub=(window.location.protocol.split(":")[0]||"").toUpperCase(),ub))==="HTTPS",c=Nd()?window.isSecureContext:"Browser Not Support";(!Nd()&&!o||!window.isSecureContext)&&w.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let d;J.setAppId(e);try{if(!i&&i!==null)throw new oe(L.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));if(i&&rn(i,"token",1,2047),rn(e,"appid",1,2047),Dg(t),r&&Cl(r),a)if(typeof a=="string")rn(a,"optionalInfo",1,256),d=a;else{if(typeof a!="object")throw new oe(L.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:R,enableInstantMuteRestore:C}=a;R&&(gr(R,"autoSubscribe"),w.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(R)),this.store.autoSubscribe=R),C&&(gr(C,"enableInstantMuteRestore"),w.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(C)),this.store.enableInstantMuteRestore=C)}}}catch(R){throw J.reportApiInvoke(Yh(),{name:Gt.JOIN,options:[e,t,i,r],states:{isHttps:o,isSecureContext:c},tag:Tr.TRACER}).onError(R),R}if(this._leaveMutex.isLocked&&(w.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),w.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const R=new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw J.reportApiInvoke(Yh(),{name:Gt.JOIN,options:[e,t,i,r],states:{isHttps:o,isSecureContext:c},tag:Tr.TRACER}).onError(R),R}this._gateway.state="CONNECTING",this.store.preloadStart();const l=await cx({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const h=l?.sid||Yh();w.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId);const _=J.reportApiInvoke(h,{id:this._clientId,name:Gt.JOIN,options:[e,t,i,r],states:{isHttps:o,isSecureContext:c},tag:Tr.TRACER}),f=Nl(Nl(Nl({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!l},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:G("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(f.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(f.stringUid=r,this._uintUid?(f.uid=this._uintUid,this._uintUid=void 0):f.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(f.aesmode=this._encryptionMode,f.aespassword=await(async R=>{const C=(function(P){const U=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),W=new Uint8Array(new ArrayBuffer(U.length));for(let z=0;z<U.length;z+=1)W[z]=U.charCodeAt(z);return W})(),b=await window.crypto.subtle.importKey("spki",C,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),N=dO(R),k=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},b,N);return(function(P){let U="";for(let W=0;W<P.length;W+=1)U+=String.fromCharCode(P[W]);return window.btoa(U)})(new Uint8Array(k))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(f.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const R=new TextEncoder,C=G("USE_PURE_ENCRYPTION_MASTER_KEY")?R.encode(f.appId+this._encryptionSecret+this._encryptionSecret):R.encode(f.appId+f.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(b,N,k){const P=await window.crypto.subtle.importKey("raw",N,"PBKDF2",!1,["deriveBits","deriveKey"]),U=b==="aes-128-gcm2"?128:256,W=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:Cg,hash:"SHA-256",salt:k},P,U+yB);return new Uint8Array(W).subarray(U/8)})(this._encryptionMode,C,xc(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(b,N,k){const P=await window.crypto.subtle.importKey("raw",N,"PBKDF2",!1,["deriveBits","deriveKey"]),U=b==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:Cg,hash:"SHA-256",salt:k},P,{name:"AES-GCM",length:U},!0,["encrypt","decrypt"])})(this._encryptionMode,C,xc(this._encryptionSalt))}else c?w.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):w.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,w.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:f.stringUid});const m=this._sessionId;setTimeout((()=>{this.connectionState==="CONNECTING"&&m===this._sessionId&&J.joinChannelTimeout(this._sessionId,5)}),5e3);try{var S;let R;const C=f.cloudProxyServer;if(ee(S=["proxy3","proxy4","proxy5"]).call(S,C)){const U=G("PROXY_SERVER_TYPE3");Array.isArray(U)?f.proxyServer=U[0]:f.proxyServer=U}if(J.setProxyServer(f.proxyServer),w.setProxyServer(f.proxyServer),this.store.requestAPStart(),l){if(w.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(f.stringUid?", ".concat(f.stringUid," => ").concat(l.intUid):""," ")),f.stringUid&&!f.uid&&(f.uid=l.intUid),R={gatewayInfo:l.ap.gatewayInfo},G("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&f.turnServer.mode==="auto")if(l.ap.proxyInfo.addresses.length===0)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const U=(await YO(l.ap.proxyInfo,l.ap.gatewayInfo.uid)).map((W=>({turnServerURL:W.address,tcpport:W.tcpport||Qn.tcpport,udpport:W.udpport||Qn.udpport,username:W.username||Qn.username,password:W.password||Qn.password,forceturn:!1,security:!0})));f.turnServer={mode:"manual",servers:U}}lx(l,f.stringUid)}else{if(f.stringUid&&!f.uid){let U;[U,R]=await se.all([ej(f.stringUid,f,this._axiosCancelSource.token,this._config.httpRetryConfig||ln,this.store).finally((()=>{this.store.requestSUAEnd()})),HU(f,this._axiosCancelSource.token,this._config.httpRetryConfig||ln,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),w.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(f.stringUid," => ").concat(U)),f.uid=U,R.gatewayInfo.uid=U,R.gatewayInfo.res.uid=U}else R=await HU(f,this._axiosCancelSource.token,this._config.httpRetryConfig||ln,!0,this.store);if(!this._joinAndNotLeaveYet)throw new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(f,this._axiosCancelSource.token),this._configDistribute.on(hR.UPDATE_BITRATE_LIMIT,(U=>{this._p2pChannel.updateBitrateLimit(U)})),this._configDistribute.on(hR.UPDATE_CLIENT_ROLE_OPTIONS,(U=>{this._setClientRoleOptions(U)}))}),0),this._key=i||e;const b=R.gatewayInfo,N=f.uid?f.uid:b.uid;this._joinInfo=Nl(Nl({},f),{},{cid:b.cid,uid:N,vid:b.vid,apResponse:b.res,apGatewayAddress:b.apGatewayAddress,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),this.store.intUid=N,this.store.cid=b.cid;const k=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_.onSuccess(k),this._appId=e,this._channelName=f.cname,this._uid=k,this.store.uid=k,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ra()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const P=f.stringUid?"string uid: ".concat(f.stringUid,",uid: ").concat(f.uid):"uid: ".concat(this._uid);return w.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(P)),setTimeout((()=>{w.startUpload()}),5e3),this.store.joinEnd(),T=this,ee(vl).call(vl,T)||vl.push(T),this._cloudProxyServerMode==="disabled"&&Si().supportWebCrypto&&G("ENABLE_PRELOAD")&&p0(this._joinInfo),k}catch(R){const C=Array.isArray(R)?R[0]:R;throw C&&C.code===L.OPERATION_ABORTED?w.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),C):w.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),C),C.code!==L.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),_.onError(C),C}var T}_joinGateway(){if(!this._joinInfo||!this._key)throw new oe(L.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!G("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){w.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ra()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(t){const i=vl.indexOf(t);i!==-1&&vl.splice(i,1)})(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return w.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Oi.LEAVE),w.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof wg))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new oe(L.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new oe(L.INVALID_OPERATION,"audience can not publish stream");for(const a of i){if(!(a instanceof wg))throw new oe(L.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new oe(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}w.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map((a=>"".concat(a.getTrackId()," ")))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&i.forEach((a=>{const s=this._configDistribute.getBitrateLimit();a instanceof Xi&&s&&a.setBitrateLimit(s.uplink)}));try{await this._publishHighStream(i),w.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map((a=>"".concat(a.getTrackId()," ")))))}catch(a){throw w.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{r()}}async _publishDataChannel(e){if(e==null)throw new oe(L.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));ji(e.id,"id",0,65535,!0),gr(e.ordered,"ordered"),rn(e.metadata,"metadata",0,512),w.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex((a=>a.id===e.id))!==-1)throw new oe(L.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new oe(L.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new oe(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=(function(a){return Hb(a,!1)})(e),r=await this._p2pChannel.publishDataChannel([i]);if(r.length>0){if(typeof i._originDataChannelId!="number")throw w.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new oe(L.CREATE_DATACHANNEL_ERROR);try{await se.all(r.map((a=>this._uid&&this._gateway.publishDataChannel(this._uid,a,!0)))),await i._waitTillOpen()}catch(a){if(a.code!==L.DISCONNECT_P2P)throw a}}return w.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw w.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new oe(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof wg))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);w.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((r=>"".concat(r.getTrackId()," ")))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Mr.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),w.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((a=>"".concat(a.getTrackId())))))}}catch(r){throw w.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),w.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((i=>"".concat(i.id," ")))," "));const t=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),w.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((r=>"".concat(r.id)))))}catch(i){throw w.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{t&&t()}}async subscribe(e,t,i){if(!(e instanceof S_)){const r=this.remoteUsers.find((a=>a.uid===e));if(!r)throw new oe(L.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,t)}async presubscribe(e,t){if(Bt(t,"mediaType",["audio","video"]),this.store.useP2P)throw new oe(L.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new oe(L.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=t===Me.AUDIO,r=t===Me.VIDEO,a=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:c,cname:d,uint_id:l}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new oe(L.UNEXPECTED_RESPONSE,"no ssrc id");let h=this._users.find((f=>f.uid===e));h||(h=new S_(e,l||e),h._is_pre_created=!0,this._users.push(h)),d&&(h._cname=d),h._uintid||(h._uintid=l||e),i&&(h._audioSSRC=s,h._audio_pre_subscribed=!0,o&&(h._audioOrtc=o)),r&&(h._videoSSRC=s,h._video_pre_subscribed=!0,o&&(h._videoOrtc=o),c!=null&&(h._rtxSsrcId=c)),w.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(h,t,s,c,o);const _=i?h._audioTrack:h._videoTrack;if(!_)throw new oe(L.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0),r&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0),_}catch(s){throw w.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{a()}}async _subscribeDataChannel(e,t){var i;if(ji(t,"channelId",0,65535,!0),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((c=>c===e)))throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new oe(L.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new oe(L.INVALID_REMOTE_USER,"user is not published");const a=(i=e._dataChannels)===null||i===void 0?void 0:i.find((c=>c.id===t));if(!a)throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new oe(L.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(e,[a]);if(c&&ee(c).call(c,a.id))try{var o;if(typeof a._originDataChannelId!="number")throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new oe(L.CREATE_DATACHANNEL_ERROR);const d={id:a.id,datachannelId:a._originDataChannelId,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:(o=a.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,d,!0),await a._waitTillOpen()}catch(d){if(d?.code!==L.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[a]),d;await this._p2pChannel.unsubscribeDataChannel(e,[a]),this._p2pChannel.setPendingRemoteDataChannel(e,a.id)}return w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),a}finally{s()}}async _p2pSubscribe(e,t,i){if(Bt(t,"mediaType",["audio","video"]),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((s=>s===e))){const s=new oe(L.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new oe(L.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!i&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new oe(L.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const a=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,o,c)}catch(o){throw o}w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((o=>{w.warning("[".concat(this._clientId,"] auto set fallback failed"),o)}));const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new oe(L.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw w.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{a()}}async _subscribe(e,t,i){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Bt(t,"mediaType",["audio","video"]),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((l=>l===e))){const l=new oe(L.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new oe(L.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!(i||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const l=new oe(L.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}let a=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Me.AUDIO:Me.VIDEO,ssrcId:a};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const d=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const h=t==="audio"?e._audioSSRC:e._videoSSRC;h!==void 0&&h!==a&&(a=h,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Me.AUDIO:Me.VIDEO,ssrcId:a}),ja.markSubscribeStart(this.store.clientId,a),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,a,o,s);try{this._p2pChannel.isPreSubScribe(a)||await this._gateway.subscribe(e.uid,c,!0)}catch(_){if(_?.code!==L.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),_;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(h){throw this._p2pChannel.reportSubscribeEvent(!1,h?.code,e,t),h}w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((h=>{w.warning("[".concat(this._clientId,"] auto set fallback failed"),h)}));const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new oe(L.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),l}catch(l){throw w.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{d()}}async massSubscribe(e){if(zi(e,"subscribeList"),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),i=new Map,r=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((c=>{let{user:d,mediaType:l}=c;return"user: ".concat(d?.uid,", mediaType: ").concat(l)})).join("; ")));const a=(e=[...e]).map((c=>{let{user:d,mediaType:l}=c;return{user:d,mediaType:l}})),s=await this._p2pChannel.globalLock();try{var o;for(let d=e.length-1;d>=0;d--){const l=e[d],{user:h,mediaType:_}=l;if(Bt(_,"mediaType",["audio","video"]),!h){const T=new oe(L.INVALID_PARAMS,"user property does not exist in subscribeList item");throw w.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),T}if(!this._users.find((T=>T===h))){const T=new oe(L.INVALID_REMOTE_USER,"user is not in the channel");w.error("[".concat(this._clientId,"] can not massSubscribe ").concat(h.uid,", this user is not in the channel")),a[d].error=T,e.splice(d,1);continue}if(_==="audio"&&(!h.hasAudio||h._audioSSRC===void 0)||_==="video"&&(!h.hasVideo||h._videoSSRC===void 0)){const T=new oe(L.REMOTE_USER_IS_NOT_PUBLISHED);w.error("[".concat(this._clientId,"] can not subscribe ").concat(h.uid," with mediaType ").concat(_,", remote user is not published")),a[d].error=T,e.splice(d,1);continue}const m=Lt.Video|Lt.LwoVideo,S=i.get(h);if(S){if(_==="video"?S&m:S&Lt.Audio){e.splice(d,1),w.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(h.uid,", mediaType:").concat(_," twice"));continue}i.set(h,S|(_==="video"?m:Lt.Audio))}else i.set(h,_==="video"?m:Lt.Audio)}for(let d=e.length-1;d>=0;d--){const l=e[d],{user:h,mediaType:_}=l,f=Lt.Video|Lt.LwoVideo;if(this._p2pChannel.hasRemoteMedia(h,_)){await this._p2pChannel.unmuteRemoteNoLock(h,_);const m=i.get(h);i.set(h,_==="video"?m^f:m^Lt.Audio),e.splice(d,1)}}this.store.massSubscribe(e.map((d=>({userId:d.user.uid,type:d.mediaType}))),t);let c=Pn(o=Array.from(i.entries())).call(o,((d,l)=>{let[h,_]=l;if(_===0)return d;const f={stream_id:h.uid,stream_type:_};return _&Lt.Audio&&(f.audio_ssrc=h._audioSSRC),_&Lt.Video&&(f.video_ssrc=h._videoSSRC),d.push(f),d}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((l=>{let{user:h,mediaType:_}=l;return{user:h,mediaType:_,ssrcId:_===Me.VIDEO?h._videoSSRC:h._audioSSRC,rtxSsrcId:_===Me.VIDEO?h._rtxSsrcId:void 0}})));const d=new Map;if(c=c.filter((l=>l.video_ssrc&&!this._p2pChannel.isPreSubScribe(l.video_ssrc)||l.audio_ssrc&&!this._p2pChannel.isPreSubScribe(l.audio_ssrc)||!l.video_ssrc&&!l.audio_ssrc)),c.length>0){const l=await this._gateway.subscribeAll(c,!0);(l?.users||[]).forEach((h=>{let{stream_id:_,video_error_code:f,audio_error_code:m,error_code:S}=h;(f||m||S)&&d.set(_,{video_error_code:f,audio_error_code:m,error_code:S})}))}if(Array.from(d.entries()).length>0){const l=[];Array.from(d.entries()).forEach((h=>{let[_,f]=h;const m=this.remoteUsers.find((S=>S.uid===_));if(m){let S;f.error_code||f.video_error_code&&f.audio_error_code?S=void 0:f.video_error_code?S=Me.VIDEO:f.audio_error_code&&(S=Me.AUDIO),l.push({user:m,mediaType:S})}})),l.length>0&&await this._p2pChannel.massUnsubscribeNoLock(l)}for(const l of a){const h=d.get(l.user.uid);if(h){const _=h.error_code||l.mediaType==="audio"&&h.audio_error_code||l.mediaType==="video"&&h.video_error_code;if(_){const f=fR(_);w.error("user:".concat(l.user.uid," mediaType:").concat(l.mediaType," has massSubscribe error ").concat(f.desc)),l.error=new oe(L.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(f.desc))}}l.error||(l.mediaType==="video"?l.track=l.user.videoTrack:l.track=l.user.audioTrack)}return this.store.massSubscribe(a.filter((l=>!l.error)).map((l=>({userId:l.user.uid,type:l.mediaType}))),void 0,Date.now()),a.forEach((l=>{var h;J.subscribe(this.store.sessionId,{succ:!!l.error,ec:((h=l.error)===null||h===void 0?void 0:h.code)||null,video:l.mediaType===Me.VIDEO,audio:l.mediaType===Me.AUDIO,peerid:l.user.uid,subscribeRequestid:l.mediaType===Me.VIDEO?l.user._videoSSRC:l.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(l.user._videoSSRC)},!0)})),w.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((l=>{let{user:h,mediaType:_}=l;return"user: ".concat(h?.uid,", mediaType: ").concat(_)})).join("; "))),a}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(e),d}}finally{s(),r()}}async unsubscribe(e,t,i){if(!(e instanceof S_)){const s=this.remoteUsers.find((o=>o.uid===e));if(!s)throw new oe(L.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(t&&Bt(t,"mediaType",["audio","video"]),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((s=>s===e))){const s=new oe(L.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}w.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const a=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&t_(this._users,e),w.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===L.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{a()}}async _unsubscribeDataChannel(e,t){if(t&&ji(t,"id",0,65535,!0),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((a=>a===e))){const a=new oe(L.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}let r;if(typeof t=="number"){const a=e._dataChannels.find((s=>s.id===t));a&&(r=[a])}else r=e._dataChannels;if(r===void 0){const a=new oe(L.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),a}w.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map((a=>a.id))));try{const a=await this._p2pChannel.unsubscribeDataChannel(e,r);a&&await this._gateway.unsubscribeDataChannel(a,e.uid),w.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a))}catch(a){if(a.code===L.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}}async massUnsubscribe(e){if(zi(e,"unsubscribeList"),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");w.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((i=>{let{user:r,mediaType:a}=i;return"user: ".concat(r?.uid,", mediaType: ").concat(a,";")})).join())),e=[...e];const t=new Map;for(let i=e.length-1;i>=0;i--){const{user:r,mediaType:a}=e[i];if(!r){const c=new oe(L.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw w.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(Bt(a,"mediaType",["video","audio",void 0]),!this._users.find((c=>c===r))){w.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(i,1);continue}const o=Lt.Video|Lt.LwoVideo;if(t.has(r)){const c=t.get(r);let d;switch(a){case"video":d=c&o;break;case"audio":d=c&Lt.Audio;break;default:d=c&(Lt.Audio|o)}if(d){w.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(a," twice.")),e.splice(i,1);continue}a?a==="audio"?t.set(r,c|Lt.Audio):a==="video"&&t.set(r,c|o):t.set(r,c|Lt.Audio|o)}else a?a==="audio"?t.set(r,Lt.Audio):a==="video"&&t.set(r,o):t.set(r,Lt.Audio|o)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),w.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((r=>{let{user:a,mediaType:s}=r;return"user: ".concat(a?.uid,", mediaType: ").concat(s,";")})).join()))}catch(i){if(i.code===L.DISCONNECT_P2P)return void w.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw w.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new _e(L.INVALID_PARAMS);Gr(i.width)||Zn(i.width,"streamParameter.width"),Gr(i.height)||Zn(i.height,"streamParameter.height"),Gr(i.framerate)||Zn(i.framerate,"streamParameter.framerate"),Gr(i.bitrate)||ji(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&w.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),w.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ee.LocalVideoLowTrack)}async enableDualStream(){if(!Si().supportDualStream)throw J.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new oe(L.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new oe(L.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw J.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,J.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),w.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new oe(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ee.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw J.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,J.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),w.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(r){Bt(r,"role",["audience","host"])})(e),t&&ri(t),this.mode==="rtc"||this.mode==="p2p")throw w.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new oe(L.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new oe(L.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new oe(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&G("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Rr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),w.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&ri(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{w.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const i=t.timestamp-Date.now();return Math.abs(i)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(rn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new oe(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new oe(L.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,J.setProxyServer(this._proxyServer),w.setProxyServer(this._proxyServer),w.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new oe(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new oe(L.INVALID_OPERATION,"You have already set the proxy")}if(qT(e))return this._turnServer={servers:e,mode:"original-manual"},void w.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((i=>i.urls)).join(","),"."));e.forEach((i=>uO(i))),this._turnServer={servers:e,mode:"manual"},w.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new oe(L.INVALID_OPERATION,"you should set license before join channel");if(rn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new oe(L.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,w.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new oe(L.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new oe(L.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new oe(L.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new oe(L.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new oe(L.INVALID_OPERATION,"Stop proxy server after leave channel");J.setProxyServer(),w.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new oe(L.INVALID_PARAMS,"accessPoints is required.");zi(e.accessPoints.serverList,"accessPoints.serverList"),rn(e.accessPoints.domain,"accessPoints.domain");const t=(f,m)=>{ji(f,m,0,65535,!0)};let i=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new oe(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");G("CLOSE_AFB_FOR_LOCAL_AP")&&(B("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),B("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=e.accessPoints.domain,s=e.accessPoints.serverList.map((f=>r.test(f)?"".concat(f.replace(/\./g,"-"),".").concat(a):f)),o=s.map((f=>"".concat(f,":").concat(i)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,B("WEBCS_DOMAIN",o),B("WEBCS_DOMAIN_BACKUP_LIST",o),B("GATEWAY_DOMAINS",[a]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(zi(e.report.hostname,"report.hostname"),B("EVENT_REPORT_DOMAIN",e.report.hostname[0]),B("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(B("EVENT_REPORT_DOMAIN",s[0]),B("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let c=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),c=e.report.port),B("STATS_COLLECTOR_PORT",c),e.report?B("ENABLE_EVENT_REPORT",!0):B("ENABLE_EVENT_REPORT",!1);let d="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(zi(e.log.hostname,"log.hostname"),d=e.log.hostname[0]):d=s[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),B("LOG_UPLOAD_SERVER","".concat(d,":").concat(l));let h=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(zi(e.cds.hostname,"cds.hostname"),h=e.cds.hostname):h=s;let _=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),_=e.cds.port),B("CDS_AP",h.map((f=>"".concat(f,":").concat(_)))),e.cds?B("ENABLE_CONFIG_DISTRIBUTE",!0):B("ENABLE_CONFIG_DISTRIBUTE",!1),w.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(zi(e,"serverList"),rn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new oe(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((r=>i.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,B("WEBCS_DOMAIN",e),B("WEBCS_DOMAIN_BACKUP_LIST",e),B("GATEWAY_DOMAINS",[t]),B("EVENT_REPORT_DOMAIN",e[0]),B("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),B("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),w.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Bt(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw w.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else w.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Bt(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const i=this._users.find((r=>r.uid===e));i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(i){throw w.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}w.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Bt(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(i){throw w.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}w.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,i,r){(function(s){Bt(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),rn(t,"secret");const a=["aes-128-gcm2","aes-256-gcm2"];if(ee(a).call(a,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new oe(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new oe(L.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(gr(r,"encryptDataStream"),!ee(a).call(a,e))throw new oe(L.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||w.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,i&&(this._encryptionSalt=n_(i))}async renewToken(e){if(rn(e,"token",1,2047),!this._key||!this._joinInfo)throw new oe(L.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(G("USE_NEW_TOKEN")){w.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await rj(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ln);w.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else w.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});w.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,w.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?w.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(yt.VOLUME_INDICATOR,e)}),G("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new oe(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new oe(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new oe(L.LIVE_STREAMING_TASK_CONFLICT);const i=t?h_.TRANSCODE:h_.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(h_.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((i=>i&&i.hasUrl(e)));if(!t.length)throw new oe(L.INVALID_PARAMS,"can not find live streaming url to stop");await se.all(t.map((i=>i&&i.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){g_(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){g_(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Oa&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new oe(L.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const a=new TextEncoder;e.payload=a.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ee(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await(async function(a,s,o){var c;const d=Pn(c=Array.from(o)).call(c,((T,R)=>T+R),0),l={serverTs:0,seq:CB++,length:o.length,checkSum:d},h=new Uint8Array(yg(d,2)),_=new ArrayBuffer(tR),f=new DataView(_);f.setUint32(0,l.serverTs),f.setUint16(4,l.seq),f.setUint16(6,l.length),f.setUint16(8,l.checkSum);const m=16-o.length%16;o=Vu(o,new Uint8Array(m));const S=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:vB,additionalData:h},s,o);return Vu(new Uint8Array(_),new Uint8Array(S))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new oe(L.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Et.DATA_STREAM,{payload:n_(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-IH},!i)}sendMetadata(e){if(!this._joinInfo)throw new oe(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new oe(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Et.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:n_(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(K4),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"can not send custom report, not joined");await J.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(G("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map((i=>i.uid+""));Object.keys(e).forEach((i=>{ee(t).call(t,i)||delete e[i]}))}return e}async pickSVCLayer(e,t){Bt(t.spatialLayer,"spatialLayer",[0,1,2,3]),Bt(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(i){throw w.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:i}=e;if(gr(t,"apRTM"),ji(i,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=i,w.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(w.debug("[".concat(this._clientId,"] reset client")),(function(e){const t=yl.indexOf(e);t!==-1&&yl.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=co.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&dx(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&J.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((t=>t._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Wn("client-publish",this._clientId),this._subscribeMutex=new Wn("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var i;const r=e||Yh();e?w.debug("[".concat(this._clientId,"] new Session ").concat(r)):w.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const a=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,J.addSid(r);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1};J.sessionInit(this._sessionId,Nl({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new oe(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new oe(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");w.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await i.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Mr.PUBLISH,r,!0)}catch(a){throw i.throw(a),a}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await i.next()).value;if(r){var t;let a;try{a=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==L.DISCONNECT_P2P)throw i.throw(s),s}await i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const a of e)a instanceof Xi&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig).catch((s=>{w.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i?.code,e),i?.code===L.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new oe(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new oe(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));w.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await i.next()).value;if(r){var t;let a;try{a=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==L.DISCONNECT_P2P)throw i.throw(s),s}i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i?.code,void 0,!0),i?.code===L.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new oe(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ip("LiveStreaming").create(r));var r;return i.onLiveStreamError=(a,s)=>{J.reportApiInvoke(this._sessionId,{name:Gt.ON_LIVE_STREAM_ERROR,options:[a,s],tag:Tr.TRACER}).onSuccess(),this.safeEmit(yt.LIVE_STREAMING_ERROR,a,s)},i.onLiveStreamWarning=(a,s)=>{J.reportApiInvoke(this._sessionId,{name:Gt.ON_LIVE_STREAM_WARNING,options:[a,s],tag:Tr.TRACER}).onSuccess(),this.safeEmit(yt.LIVE_STREAMING_WARNING,a,s)},i.on(Sn.REQUEST_WORKER_MANAGER_LIST,((a,s,o)=>{if(!this._joinInfo)return o(new oe(L.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,d,l,h){const _=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((f=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(f+"/api/v1?action=uap"):"https://".concat(f,"/api/v1?action=uap")));return await xU(_,c,d,l,h)})(a,this._joinInfo,this._axiosCancelSource.token,ln).then(s).catch(o)})),i};return e===h_.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new oe(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:i}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:i}},ip("ChannelMediaRelay").create(e));r.on("state",(a=>{a===Ja.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(yt.CHANNEL_MEDIA_RELAY_STATE,a)})),r.on("event",(a=>{this.safeEmit(yt.CHANNEL_MEDIA_RELAY_EVENT,a)})),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(a,s)=>{var o;a==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:i,deleted:r}=e,a=[];if(t){const s=[];this._users.forEach((o=>{o._dataChannels.forEach((c=>{i.every((d=>d.uid!==o._uintid||d.stream_id!==c.id))&&s.push({uid:o._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})}))})),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(i)&&i.length>0&&i.forEach((s=>{const{uid:o,stream_id:c,ordered:d,max_retrans_times:l,metadata:h}=s,_=this._users.find((f=>f._uintid===o));if(!_)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(w.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),ee(a).call(a,_)||a.push(_),_._uintid||(_._uintid=o),_._dataChannels.findIndex((f=>f.id===s.stream_id))===-1){const f={id:c,ordered:!!d,maxRetransmits:l,metadata:h},m=(function(S){return Hb(S,!0)})(f);_._dataChannels.push(m),w.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published datachannel")),t||this.safeEmit(yt.USER_PUBLISHED,_,"datachannel",f)}this._p2pChannel.hasPendingRemoteDataChannel(_,s.stream_id)&&(w.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_.uid," after reconnect.")),this._subscribeDataChannel(_,s.stream_id).catch((f=>{w.error("[".concat(this._clientId,"] resubscribe datachannel error"),f.toString())})))})),t&&(this.safeEmit(yt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((s=>{const{uid:o,stream_id:c}=s,d=this._users.find((h=>h._uintid===o));if(!d)return void w.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const l=d._dataChannels.find((h=>h.id===s.stream_id));l&&(w.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(d,[l]).then((h=>{if(d._dataChannels=d._dataChannels.filter((_=>_!==l)),h)return this._gateway.unsubscribeDataChannel(h,d.uid)})),w.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(l.id)),this.safeEmit(yt.USER_UNPUBLISHED,d,"datachannel",l._config))}))}_getEncodingName(e){var t;if(!this._joinResponse)return;const i=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(i)for(const a of i){var r;if(a.payloadType===e)return a==null||(r=a.rtpMap)===null||r===void 0?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find((i=>i.uid===e.uid));if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){w.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((r=>{this.safeEmit(yt.USER_UNPUBLISHED,t,"datachannel",r._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)})),i()}}else w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Vn.UPDATE_GATEWAY_CONFIG,(()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void w.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),i=Date.now();Object.keys(t).forEach((r=>{const{value:a,type:s,expires:o}=t[r];o&&o<=i||s||uU()||!Object.prototype.hasOwnProperty.call($T,r)||(ft[r]=a,Ct[r]=a,w.debug("Update gateway parameters from config distribute",r,a))}))}catch(t){w.error("Error update config from local cache",t.message)}})()})),this._gateway.on(Vn.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(Vn.CONNECTION_STATE_CHANGE,((e,t,i)=>{var r;if(i===Oi.FALLBACK)return;const a=()=>{this.safeEmit(yt.CONNECTION_STATE_CHANGE,e,t,i)};if(J.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Gt.CONNECTION_STATE_CHANGE,options:[e,t,i],tag:Tr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:i})),w.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void a();if(e==="RECONNECTING")this._users.forEach((o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach(((o,c)=>{this._gateway.setStreamFallbackOption(c,o).catch((d=>{w.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)}))})),this._remoteStreamTypeCacheMap.forEach(((o,c)=>{this._gateway.setRemoteVideoStreamType(c,o).catch((d=>{w.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)}))})),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{w.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((o=>{w.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter((o=>!o._trust_in_room_)).forEach((o=>{w.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach((o=>{o._trust_audio_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Me.AUDIO,!1)),o._trust_video_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Me.VIDEO,!1)),o._trust_audio_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(w.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))})))}),1e3))}a()})),this._gateway.on(Vn.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new oe(L.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const r=await cx(Nl(Nl({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(i=r.ap,lx(r),this._joinInfo.preload=!0):(i=await e0(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ln,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const a=[];i.gatewayInfo.gatewayAddrs.forEach((s=>{let{address:o}=s;const[c,d]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?a.push({proxy:this._joinInfo.proxyServer,host:c,port:d}):a.push({host:c,port:d})})),e(a)}catch(i){t(i)}})),this._gateway.on(Vn.NETWORK_QUALITY,(e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(yt.NETWORK_QUALITY,e)})),this._gateway.on(Vn.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(yt.STREAM_TYPE_CHANGED,e,t),J.reportApiInvoke(this._sessionId,{name:Gt.STREAM_TYPE_CHANGE,options:[e,t],tag:Tr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Vn.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(Vn.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,i)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){i(r)}})),this._gateway.on(Vn.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let i;this._joinResponse=e,e.attributes?i=e.attributes.userAttributes.preSubSsrcs:w.debug("no attributes in joinResponse");const r=IU(e.ortc,t,i);this._p2pChannel.connect(r)})),this._gateway.on(Vn.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:i,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:o}=this._joinInfo.apResponse,c="".concat(o,"_").concat(s);if(c.length<4||c.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var a;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(s),icePwd:"".concat(o,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(a=G("FINGERPRINT"))!==null&&a!==void 0?a:i}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(d){d.code&&d.code===L.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(Dt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Dt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Dt.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc))),this._gateway.signal.on(Dt.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(Dt.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(Dt.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(Dt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Dt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Dt.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Me.AUDIO,!0))),this._gateway.signal.on(Dt.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Me.AUDIO,!1))),this._gateway.signal.on(Dt.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Me.VIDEO,!0))),this._gateway.signal.on(Dt.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Me.VIDEO,!1))),this._gateway.signal.on(Dt.RECEIVE_METADATA,(e=>{const t=xc(e.metadata);this.safeEmit(yt.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(Dt.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let i=xc(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ee(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<tR)throw new oe(L.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(tR));i=await(async function(s,o,c){const d=c.subarray(0,tR),l=d.slice(8,tR),h=(l[0]<<8)+l[1],_=(d[6]<<8)+d[7],f=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:vB,additionalData:new Uint8Array(yg(h,2))},o,c.subarray(tR));return new Uint8Array(f).subarray(0,_)})(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let r=0;if(e.ordered||e.syncWithAudio){const a=this._p2pChannel.getStats(),s=this.remoteUsers.find((c=>c.uid===e.uid)),o=a?.audioRecv.find((c=>c.ssrc===s?._audioSSRC));r=o?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),wH(Nl(Nl({},e),{},{payload:i}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(Dt.ON_CRYPT_ERROR,(()=>{Uc((()=>{w.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(yt.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(Dt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{w.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Oi.TOKEN_EXPIRE),this.safeEmit(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(Dt.ON_STREAM_FALLBACK_UPDATE,(e=>{w.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(yt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")})),this._gateway.signal.on(Dt.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),w.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(Dt.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(Dt.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(Ne.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case Et.PUBLISH:{if(!t)return;const a=t.ortc;if(a){var i,r;const s=a.some((d=>{let{stream_type:l}=d;return l===Vt.Audio})),o=a.some((d=>{let{stream_type:l}=d;return l!==Vt.Audio})),c=a.some((d=>{let{stream_type:l}=d;return l===Vt.Screen||l===Vt.ScreenLow}));t.state==="offer"&&J.publish(this._joinInfo.sid,{eventElapse:ja.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:s,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?(i=a.find((d=>{let{stream_type:l}=d;return l===Vt.Audio})))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:o?(r=a.find((d=>{let{stream_type:l}=d;return l!==Vt.Audio})))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Et.SUBSCRIBE:t&&J.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:t.stream_type===Me.AUDIO,video:t.stream_type===Me.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ja.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(Dt.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(Dt.ON_PUBLISHED_USER_LIST,(e=>{if(e==null||!e.users)return;G("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((r=>!u_(r.string_id||r.stream_id,this.channelName))));const t=[],i=[];for(const r of e.users){let a=this._users.find((h=>h._uintid===r.stream_id));a?a._trust_in_room_=!0:(a=new S_(r.string_id||r.stream_id,r.stream_id),this._users.push(a),this.store.firstVideoFrameDecoded(a.uid,{userJoinNotify:Date.now()}),this.getListeners(yt.PUBLISHED_USER_LIST).length===0&&(w.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(yt.USER_JOINED,a)));const s=Lt.Audio&r.stream_type,o=(Lt.Video|Lt.LwoVideo)&r.stream_type,c=(65280&r.stream_type)!=0,d=s&&a.hasAudio,l=o&&a.hasVideo;o&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=r.video_ssrc,a._rtxSsrcId=r.video_rtx),s&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=r.audio_ssrc),s&&!d&&this.getListeners(yt.PUBLISHED_USER_LIST).length===0&&(w.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(yt.USER_PUBLISHED,a,"audio")),o&&!l&&this.getListeners(yt.PUBLISHED_USER_LIST).length===0&&(w.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(yt.USER_PUBLISHED,a,"video")),(s&&!d||o&&!l||c)&&t.push(a),o&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&i.push({user:a,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&i.push({user:a,mediaType:"audio"})}i.length>0&&(w.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map((r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType))).join("; ")," ")),this.massSubscribe(i).catch((r=>{w.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())}))),this.getListeners(yt.PUBLISHED_USER_LIST).length>0?G("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(w.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((r=>r.uid)).join(", "))),this.safeEmit(yt.PUBLISHED_USER_LIST,t)):w.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((r=>r.uid)).join(", ")))})),this._gateway.signal.on(Dt.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof Oa&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((i=>i.toLowerCase())).filter((i=>{var r;return ee(r=Object.keys(eR)).call(r,i)})))}))}_handleP2PEvents(){this._gateway.signal.on(Dt.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(Mr.PUBLISH,((e,t,i)=>{const{uid:r}=e;e.forEach((a=>{const{kind:s,ssrcs:o,mid:c,isMuted:d}=a;this._handleP2PAddAudioOrVideoStream(s,r,o[0].ssrcId,c);const l=this._users.find((h=>h.uid===r));return l&&this.store.useP2P?this._p2pChannel.mockSubscribe(l,s,o[0].ssrcId,c).then((()=>{t()})).catch(i):t(),this._handleMuteStream(r,s,!!d)}))})),this._gateway.signal.on(Mr.CALL,(async(e,t,i)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(a){i(a)}})),this._gateway.signal.on(Ne.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(Mr.UNPUBLISH,(async(e,t,i)=>{if(this.store.useP2P){const{unpubMsg:r,uid:a}=e,s=this._users.find((o=>o.uid===a));if(!s)return w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void t();try{r.forEach((async o=>{let{stream_type:c}=o;const d=c===Vt.Audio?Me.AUDIO:Me.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(a,d,!0)})),t()}catch(o){i(o)}}})),this._gateway.signal.on(Mr.CONTROL,(async(e,t)=>{const{action:i}=e;switch(i){case hE.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Me.VIDEO,!0);break;case hE.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Me.AUDIO,!0);break;case hE.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Me.VIDEO,!1);break;case hE.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Me.AUDIO,!1)}})),this._gateway.signal.on(Mr.RESTART_ICE,(async(e,t,i)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:a}=e;r!==_t.SEND_ONLY||a?t(await this._p2pChannel.restartICE(r,a)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){i(r)}})),this._gateway.signal.on(Mr.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:i}=e;this._p2pChannel.addRemoteCandidate(t,i)}})),this._p2pChannel.on(it.RequestP2PRestartICE,(async(e,t,i)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Mr.RESTART_ICE,e,r===_t.SEND_ONLY))}catch(r){i(r)}})),this._p2pChannel.on(it.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(Mr.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(it.RequestP2PMuteLocal,(async(e,t,i)=>{try{await this._gateway.sendExtensionMessage(Mr.CONTROL,e,!0),t()}catch(r){i(r)}})),this._p2pChannel.on(it.RequestP2PUnmuteRemote,(async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===L.DISCONNECT_P2P?t():i(r)}else t()})),this._p2pChannel.on(it.RequestP2PMuteRemote,(async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===L.DISCONNECT_P2P?t():i(r)}else t()})),this._p2pChannel.on(it.StateChange,((e,t)=>{t===Ue.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(it.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(yt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(it.RequestMuteLocal,(async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===L.DISCONNECT_P2P?t():i(r)}else t()})),this._p2pChannel.on(it.RequestUnmuteLocal,(async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===L.DISCONNECT_P2P?t():i(r)}else t()})),this._p2pChannel.on(it.RequestRePublish,((e,t,i)=>{this.publish(e,!1).then(t).catch(i)})),this._p2pChannel.on(it.RequestRePublishDataChannel,((e,t,i)=>{se.all(e.map((async r=>{const a=await this._p2pChannel.publishDataChannel([r]);try{a.forEach((s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)}))}catch(s){if(s.code!==L.DISCONNECT_P2P)throw s}}))).then(t).catch(i)})),this._p2pChannel.on(it.RequestReSubscribe,(async(e,t,i)=>{try{for(const{user:r,kind:a}of e)a===Me.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){i(r)}})),this._p2pChannel.on(it.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(it.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(it.MediaReconnectStart,(e=>{this.safeEmit(yt.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(it.MediaReconnectEnd,(e=>{this.safeEmit(yt.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(it.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(it.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),i=await t.next();if(i.done)return;const r=i.value;let a;try{a=await this._gateway.restartICE({iceParameters:r})}catch(o){return void t.throw(o)}const{iceParameters:s}=(function(o){const c=o.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}})(a);await t.next({remoteIceParameters:s})})),this._p2pChannel.on(it.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(it.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:i,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:a,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:i,rtpCapabilities:r}),o=IU(a,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(it.RequestUnpublishForReconnectPC,(async(e,t,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):i()})),this._p2pChannel.on(it.P2PLost,(()=>{this.safeEmit(yt.P2P_LOST,this.store.uid)})),this._p2pChannel.on(it.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(it.ConnectionTypeChange,(e=>{this.safeEmit(yt.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(it.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(it.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(it.AudioMetadata,(e=>{this.safeEmit(yt.AUDIO_METADATA,e)})),this._p2pChannel.on(it.AudioPts,(e=>{this.safeEmit(yt.AUDIO_PTS,Number(e))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(t={config:e},ip("ContentInspect").create(t));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:r,cname:a,sid:s,token:o,uid:c,cid:d,vid:l}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:a,sid:s,token:o,uid:c,cid:d,vid:l?Number(l):0},ln)}catch(i){throw Array.isArray(i)?i[0]:i}var t}handleVideoInspectEvents(e){e.on($n.CONNECTION_STATE_CHANGE,((t,i)=>{if(this.safeEmit(yt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,i),i===ba.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(yt.CONTENT_INSPECT_ERROR,new oe(L.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on($n.INSPECT_RESULT,((t,i)=>{var r;if(i?.code===L.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return w.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(yt.CONTENT_INSPECT_RESULT,t,i)})),e.on($n.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((i=>i.trackMediaType==="video"))[0])}))}async disableContentInspect(){if(!this._inspect)throw new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(gr(e,"enabled"),e){if(!t)throw new oe(L.INVALID_PARAMS,"config is required");if(pj(t),!this._joinInfo)throw new oe(L.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(i={config:t},ip("ImageModeration").create(i));this._moderation=r,this.handleImageModerationEvents(r);const{appId:a,cname:s,sid:o,token:c,uid:d,cid:l,vid:h}=this._joinInfo;await r.init({appId:a,areaCode:"",cname:s,sid:o,token:c,uid:d,cid:l,vid:h?Number(h):0},ln)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var i;if(!this._moderation)throw new oe(L.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(Fo.CONNECTION_STATE_CHANGE,((t,i)=>{if(this.safeEmit(yt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,i),t===Aa.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new oe(L.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(Fo.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((i=>i.trackMediaType==="video"))[0])}))}setP2PTransport(e){if((function(t){Bt(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new oe(L.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,w.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return w.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){gr(e,"enabled"),B("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ze(Ye.prototype,"leave",[gx],Object.getOwnPropertyDescriptor(Ye.prototype,"leave"),Ye.prototype),Ze(Ye.prototype,"publish",[Sx],Object.getOwnPropertyDescriptor(Ye.prototype,"publish"),Ye.prototype),Ze(Ye.prototype,"unpublish",[Tx],Object.getOwnPropertyDescriptor(Ye.prototype,"unpublish"),Ye.prototype),Ze(Ye.prototype,"subscribe",[Rx],Object.getOwnPropertyDescriptor(Ye.prototype,"subscribe"),Ye.prototype),Ze(Ye.prototype,"presubscribe",[vx],Object.getOwnPropertyDescriptor(Ye.prototype,"presubscribe"),Ye.prototype),Ze(Ye.prototype,"massSubscribe",[yx],Object.getOwnPropertyDescriptor(Ye.prototype,"massSubscribe"),Ye.prototype),Ze(Ye.prototype,"unsubscribe",[Cx],Object.getOwnPropertyDescriptor(Ye.prototype,"unsubscribe"),Ye.prototype),Ze(Ye.prototype,"massUnsubscribe",[bx],Object.getOwnPropertyDescriptor(Ye.prototype,"massUnsubscribe"),Ye.prototype),Ze(Ye.prototype,"setLowStreamParameter",[Ax],Object.getOwnPropertyDescriptor(Ye.prototype,"setLowStreamParameter"),Ye.prototype),Ze(Ye.prototype,"enableDualStream",[Ix],Object.getOwnPropertyDescriptor(Ye.prototype,"enableDualStream"),Ye.prototype),Ze(Ye.prototype,"disableDualStream",[wx],Object.getOwnPropertyDescriptor(Ye.prototype,"disableDualStream"),Ye.prototype),Ze(Ye.prototype,"setClientRole",[Ox],Object.getOwnPropertyDescriptor(Ye.prototype,"setClientRole"),Ye.prototype),Ze(Ye.prototype,"_setClientRoleOptions",[Nx],Object.getOwnPropertyDescriptor(Ye.prototype,"_setClientRoleOptions"),Ye.prototype),Ze(Ye.prototype,"setProxyServer",[Dx],Object.getOwnPropertyDescriptor(Ye.prototype,"setProxyServer"),Ye.prototype),Ze(Ye.prototype,"setTurnServer",[Px],Object.getOwnPropertyDescriptor(Ye.prototype,"setTurnServer"),Ye.prototype),Ze(Ye.prototype,"setLicense",[Lx],Object.getOwnPropertyDescriptor(Ye.prototype,"setLicense"),Ye.prototype),Ze(Ye.prototype,"startProxyServer",[kx],Object.getOwnPropertyDescriptor(Ye.prototype,"startProxyServer"),Ye.prototype),Ze(Ye.prototype,"stopProxyServer",[Mx],Object.getOwnPropertyDescriptor(Ye.prototype,"stopProxyServer"),Ye.prototype),Ze(Ye.prototype,"setLocalAccessPointsV2",[Ux],Object.getOwnPropertyDescriptor(Ye.prototype,"setLocalAccessPointsV2"),Ye.prototype),Ze(Ye.prototype,"setLocalAccessPoints",[xx],Object.getOwnPropertyDescriptor(Ye.prototype,"setLocalAccessPoints"),Ye.prototype),Ze(Ye.prototype,"setRemoteDefaultVideoStreamType",[Vx],Object.getOwnPropertyDescriptor(Ye.prototype,"setRemoteDefaultVideoStreamType"),Ye.prototype),Ze(Ye.prototype,"setRemoteVideoStreamType",[Fx],Object.getOwnPropertyDescriptor(Ye.prototype,"setRemoteVideoStreamType"),Ye.prototype),Ze(Ye.prototype,"setStreamFallbackOption",[Bx],Object.getOwnPropertyDescriptor(Ye.prototype,"setStreamFallbackOption"),Ye.prototype),Ze(Ye.prototype,"setEncryptionConfig",[jx],Object.getOwnPropertyDescriptor(Ye.prototype,"setEncryptionConfig"),Ye.prototype),Ze(Ye.prototype,"renewToken",[Gx],Object.getOwnPropertyDescriptor(Ye.prototype,"renewToken"),Ye.prototype),Ze(Ye.prototype,"enableAudioVolumeIndicator",[Wx],Object.getOwnPropertyDescriptor(Ye.prototype,"enableAudioVolumeIndicator"),Ye.prototype),Ze(Ye.prototype,"startLiveStreaming",[Hx],Object.getOwnPropertyDescriptor(Ye.prototype,"startLiveStreaming"),Ye.prototype),Ze(Ye.prototype,"setLiveTranscoding",[Kx],Object.getOwnPropertyDescriptor(Ye.prototype,"setLiveTranscoding"),Ye.prototype),Ze(Ye.prototype,"stopLiveStreaming",[Yx],Object.getOwnPropertyDescriptor(Ye.prototype,"stopLiveStreaming"),Ye.prototype),Ze(Ye.prototype,"startChannelMediaRelay",[zx],Object.getOwnPropertyDescriptor(Ye.prototype,"startChannelMediaRelay"),Ye.prototype),Ze(Ye.prototype,"updateChannelMediaRelay",[qx],Object.getOwnPropertyDescriptor(Ye.prototype,"updateChannelMediaRelay"),Ye.prototype),Ze(Ye.prototype,"stopChannelMediaRelay",[Xx],Object.getOwnPropertyDescriptor(Ye.prototype,"stopChannelMediaRelay"),Ye.prototype),Ze(Ye.prototype,"sendCustomReportMessage",[Jx],Object.getOwnPropertyDescriptor(Ye.prototype,"sendCustomReportMessage"),Ye.prototype),Ze(Ye.prototype,"pickSVCLayer",[Zx],Object.getOwnPropertyDescriptor(Ye.prototype,"pickSVCLayer"),Ye.prototype),Ze(Ye.prototype,"setRTMConfig",[Qx],Object.getOwnPropertyDescriptor(Ye.prototype,"setRTMConfig"),Ye.prototype),Ze(Ye.prototype,"enableContentInspect",[$x],Object.getOwnPropertyDescriptor(Ye.prototype,"enableContentInspect"),Ye.prototype),Ze(Ye.prototype,"disableContentInspect",[eV],Object.getOwnPropertyDescriptor(Ye.prototype,"disableContentInspect"),Ye.prototype),Ze(Ye.prototype,"setImageModeration",[tV],Object.getOwnPropertyDescriptor(Ye.prototype,"setImageModeration"),Ye.prototype),Ze(Ye.prototype,"setP2PTransport",[iV],Object.getOwnPropertyDescriptor(Ye.prototype,"setP2PTransport"),Ye.prototype),Ze(Ye.prototype,"getJoinChannelServiceRecords",[rV],Object.getOwnPropertyDescriptor(Ye.prototype,"getJoinChannelServiceRecords"),Ye.prototype),Ze(Ye.prototype,"setPublishAudioFilterEnabled",[Ke],Object.getOwnPropertyDescriptor(Ye.prototype,"setPublishAudioFilterEnabled"),Ye.prototype),Ye);class BR{constructor(t,i){V(this,"id",0),V(this,"element",void 0),V(this,"peerPair",void 0),V(this,"context",void 0),V(this,"audioPlayerElement",void 0),V(this,"audioTrack",void 0),BR.count+=1,this.id=BR.count,this.element=t,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const i=document.createElement("audio");i.srcObject=new MediaStream([t.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const t=async(r,a)=>{const s=a==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new se((o=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&o(r.localDescription)}}))},i=async(r,a)=>await r.setRemoteDescription(a);try{const r=await t(this.peerPair[0],"offer");await i(this.peerPair[1],r);const a=await t(this.peerPair[1],"answer");await i(this.peerPair[0],a)}catch(r){throw new oe(L.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let i;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(i)}catch(a){throw new oe(L.LOCAL_AEC_ERROR,a.toString()).print()}if(!i)throw new oe(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=i.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,i=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){w.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((t=>{t.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var aA,g0;V(BR,"count",0);const kH=window.AudioContext||window.webkitAudioContext,fj=new(aA=Te({report:J}),Ze((g0=class{constructor(){V(this,"units",[]),V(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return w.debug("the system does not need to process local aec"),-1;this.context||(this.context=new kH);let t=this.units.find((i=>i&&i.getElement()===e));return t||(t=new BR(e,this.context),this.units.push(t)),t.startEchoCancellation(),w.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return _i().name!==bi.SAFARI}}).prototype,"processExternalMediaAEC",[aA],Object.getOwnPropertyDescriptor(g0.prototype,"processExternalMediaAEC"),g0.prototype),g0);function nV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function S0(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?nV(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nV(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}const T0=window||document;function Ej(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!T0)return;const i=n._cspEventHandlerPointer;if(i&&t)return void console.error(i,t);const r=a=>{if(!(a&&a.blockedURI&&(n.onSecurityPolicyViolation||n.getListeners(Fa.SECURITY_POLICY_VIOLATION).length>0)))return;const s=a.blockedURI;G("CSP_DETECTED_HOSTNAME_LIST").some((o=>ee(s).call(s,o)))&&(n.onSecurityPolicyViolation&&typeof n.onSecurityPolicyViolation=="function"&&n.onSecurityPolicyViolation(a),n.getListeners(Fa.SECURITY_POLICY_VIOLATION).length>0&&n.safeEmit(Fa.SECURITY_POLICY_VIOLATION,a))};i&&T0.removeEventListener("securitypolicyviolation",i),(t||e&&typeof e=="function"||n.getListeners(Fa.SECURITY_POLICY_VIOLATION).length>0)&&T0.addEventListener("securitypolicyviolation",r),n._cspEventHandlerPointer=r}var MH=Be,mj=HF,gj=RegExp.prototype,Os=function(e){return e===gj||MH(gj,e)?mj(e):e.flags},da=X(Os);function gE(e){let t=e.length;for(;--t>=0;)e[t]=0}const R0=256,jR=286,b_=30,Vg=15,GR=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),v0=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Sj=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),cp=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fd=new Array(576);gE(Fd);const A_=new Array(60);gE(A_);const I_=new Array(512);gE(I_);const Fg=new Array(256);gE(Fg);const WR=new Array(29);gE(WR);const HR=new Array(b_);function y0(e,t,i,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}let aV,sV,C0;function b0(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}gE(HR);const KR=e=>e<256?I_[e]:I_[256+(e>>>7)],Hs=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Na=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,Hs(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},$u=(e,t,i)=>{Na(e,i[2*t],i[2*t+1])},oV=(e,t)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--t>0);return i>>>1},cV=(e,t,i)=>{const r=new Array(16);let a,s,o=0;for(a=1;a<=Vg;a++)o=o+i[a-1]<<1,r[a]=o;for(s=0;s<=t;s++){let c=e[2*s+1];c!==0&&(e[2*s]=oV(r[c]++,c))}},dV=e=>{let t;for(t=0;t<jR;t++)e.dyn_ltree[2*t]=0;for(t=0;t<b_;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},lV=e=>{e.bi_valid>8?Hs(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},A0=(e,t,i,r)=>{const a=2*t,s=2*i;return e[a]<e[s]||e[a]===e[s]&&r[t]<=r[i]},I0=(e,t,i)=>{const r=e.heap[i];let a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&A0(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!A0(t,r,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=r},w0=(e,t,i)=>{let r,a,s,o,c=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+c++],r+=(255&e.pending_buf[e.sym_buf+c++])<<8,a=e.pending_buf[e.sym_buf+c++],r===0?$u(e,a,t):(s=Fg[a],$u(e,s+R0+1,t),o=GR[s],o!==0&&(a-=WR[s],Na(e,a,o)),r--,s=KR(r),$u(e,s,i),o=v0[s],o!==0&&(r-=HR[s],Na(e,r,o)));while(c<e.sym_next);$u(e,256,t)},O0=(e,t)=>{const i=t.dyn_tree,r=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,c,d,l=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)i[2*o]!==0?(e.heap[++e.heap_len]=l=o,e.depth[o]=0):i[2*o+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=l<2?++l:0,i[2*d]=1,e.depth[d]=0,e.opt_len--,a&&(e.static_len-=r[2*d+1]);for(t.max_code=l,o=e.heap_len>>1;o>=1;o--)I0(e,i,o);d=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],I0(e,i,1),c=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=c,i[2*d]=i[2*o]+i[2*c],e.depth[d]=(e.depth[o]>=e.depth[c]?e.depth[o]:e.depth[c])+1,i[2*o+1]=i[2*c+1]=d,e.heap[1]=d++,I0(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((h,_)=>{const f=_.dyn_tree,m=_.max_code,S=_.stat_desc.static_tree,T=_.stat_desc.has_stree,R=_.stat_desc.extra_bits,C=_.stat_desc.extra_base,b=_.stat_desc.max_length;let N,k,P,U,W,z,Q=0;for(U=0;U<=Vg;U++)h.bl_count[U]=0;for(f[2*h.heap[h.heap_max]+1]=0,N=h.heap_max+1;N<573;N++)k=h.heap[N],U=f[2*f[2*k+1]+1]+1,U>b&&(U=b,Q++),f[2*k+1]=U,k>m||(h.bl_count[U]++,W=0,k>=C&&(W=R[k-C]),z=f[2*k],h.opt_len+=z*(U+W),T&&(h.static_len+=z*(S[2*k+1]+W)));if(Q!==0){do{for(U=b-1;h.bl_count[U]===0;)U--;h.bl_count[U]--,h.bl_count[U+1]+=2,h.bl_count[b]--,Q-=2}while(Q>0);for(U=b;U!==0;U--)for(k=h.bl_count[U];k!==0;)P=h.heap[--N],P>m||(f[2*P+1]!==U&&(h.opt_len+=(U-f[2*P+1])*f[2*P],f[2*P+1]=U),k--)}})(e,t),cV(i,l,e.bl_count)},uV=(e,t,i)=>{let r,a,s=-1,o=t[1],c=0,d=7,l=4;for(o===0&&(d=138,l=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)a=o,o=t[2*(r+1)+1],++c<d&&a===o||(c<l?e.bl_tree[2*a]+=c:a!==0?(a!==s&&e.bl_tree[2*a]++,e.bl_tree[32]++):c<=10?e.bl_tree[34]++:e.bl_tree[36]++,c=0,s=a,o===0?(d=138,l=3):a===o?(d=6,l=3):(d=7,l=4))},hV=(e,t,i)=>{let r,a,s=-1,o=t[1],c=0,d=7,l=4;for(o===0&&(d=138,l=3),r=0;r<=i;r++)if(a=o,o=t[2*(r+1)+1],!(++c<d&&a===o)){if(c<l)do $u(e,a,e.bl_tree);while(--c!=0);else a!==0?(a!==s&&($u(e,a,e.bl_tree),c--),$u(e,16,e.bl_tree),Na(e,c-3,2)):c<=10?($u(e,17,e.bl_tree),Na(e,c-3,3)):($u(e,18,e.bl_tree),Na(e,c-11,7));c=0,s=a,o===0?(d=138,l=3):a===o?(d=6,l=3):(d=7,l=4)}};let pV=!1;const Tj=(e,t,i,r)=>{Na(e,0+(r?1:0),3),lV(e),Hs(e,i),Hs(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var UH=e=>{pV||((()=>{let t,i,r,a,s;const o=new Array(16);for(r=0,a=0;a<28;a++)for(WR[a]=r,t=0;t<1<<GR[a];t++)Fg[r++]=a;for(Fg[r-1]=a,s=0,a=0;a<16;a++)for(HR[a]=s,t=0;t<1<<v0[a];t++)I_[s++]=a;for(s>>=7;a<b_;a++)for(HR[a]=s<<7,t=0;t<1<<v0[a]-7;t++)I_[256+s++]=a;for(i=0;i<=Vg;i++)o[i]=0;for(t=0;t<=143;)Fd[2*t+1]=8,t++,o[8]++;for(;t<=255;)Fd[2*t+1]=9,t++,o[9]++;for(;t<=279;)Fd[2*t+1]=7,t++,o[7]++;for(;t<=287;)Fd[2*t+1]=8,t++,o[8]++;for(cV(Fd,287,o),t=0;t<b_;t++)A_[2*t+1]=5,A_[2*t]=oV(t,5);aV=new y0(Fd,GR,257,jR,Vg),sV=new y0(A_,v0,0,b_,Vg),C0=new y0(new Array(0),Sj,0,19,7)})(),pV=!0),e.l_desc=new b0(e.dyn_ltree,aV),e.d_desc=new b0(e.dyn_dtree,sV),e.bl_desc=new b0(e.bl_tree,C0),e.bi_buf=0,e.bi_valid=0,dV(e)},xH=(e,t,i,r)=>{let a,s,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(c=>{let d,l=4093624447;for(d=0;d<=31;d++,l>>>=1)if(1&l&&c.dyn_ltree[2*d]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(d=32;d<R0;d++)if(c.dyn_ltree[2*d]!==0)return 1;return 0})(e)),O0(e,e.l_desc),O0(e,e.d_desc),o=(c=>{let d;for(uV(c,c.dyn_ltree,c.l_desc.max_code),uV(c,c.dyn_dtree,c.d_desc.max_code),O0(c,c.bl_desc),d=18;d>=3&&c.bl_tree[2*cp[d]+1]===0;d--);return c.opt_len+=3*(d+1)+5+5+4,d})(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=i+5,i+4<=a&&t!==-1?Tj(e,t,i,r):e.strategy===4||s===a?(Na(e,2+(r?1:0),3),w0(e,Fd,A_)):(Na(e,4+(r?1:0),3),((c,d,l,h)=>{let _;for(Na(c,d-257,5),Na(c,l-1,5),Na(c,h-4,4),_=0;_<h;_++)Na(c,c.bl_tree[2*cp[_]+1],3);hV(c,c.dyn_ltree,d-1),hV(c,c.dyn_dtree,l-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),w0(e,e.dyn_ltree,e.dyn_dtree)),dV(e),r&&lV(e)},VH=(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,t===0?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(Fg[i]+R0+1)]++,e.dyn_dtree[2*KR(t)]++),e.sym_next===e.sym_end),FH=e=>{Na(e,2,3),$u(e,256,Fd),(t=>{t.bi_valid===16?(Hs(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},sA={_tr_init:UH,_tr_stored_block:Tj,_tr_flush_block:xH,_tr_tally:VH,_tr_align:FH},oA=(e,t,i,r)=>{let a=65535&e|0,s=e>>>16&65535|0,o=0;for(;i!==0;){o=i>2e3?2e3:i,i-=o;do a=a+t[r++]|0,s=s+a|0;while(--o);a%=65521,s%=65521}return a|s<<16|0};const Ks=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var la=(e,t,i,r)=>{const a=Ks,s=r+i;e^=-1;for(let o=r;o<s;o++)e=e>>>8^a[255&(e^t[o])];return-1^e},dp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},N0={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:_V,_tr_stored_block:fV,_tr_flush_block:SE,_tr_tally:TE,_tr_align:RE}=sA,{Z_NO_FLUSH:vE,Z_PARTIAL_FLUSH:BH,Z_FULL_FLUSH:Dl,Z_FINISH:Bd,Z_BLOCK:Ys,Z_OK:zs,Z_STREAM_END:eh,Z_STREAM_ERROR:lp,Z_DATA_ERROR:EV,Z_BUF_ERROR:mV,Z_DEFAULT_COMPRESSION:jH,Z_FILTERED:D0,Z_HUFFMAN_ONLY:P0,Z_RLE:GH,Z_FIXED:WH,Z_DEFAULT_STRATEGY:HH,Z_UNKNOWN:L0,Z_DEFLATED:YR}=N0,gV=286,KH=30,YH=19,zH=2*gV+1,Bg=15,Go=258,Tc=262,Pl=42,th=113,ih=666,yE=(e,t)=>(e.msg=dp[t],t),w_=e=>2*e-(e>4?9:0),CE=e=>{let t=e.length;for(;--t>=0;)e[t]=0},bE=e=>{let t,i,r,a=e.w_size;t=e.hash_size,r=t;do i=e.head[--r],e.head[r]=i>=a?i-a:0;while(--t);t=a,r=t;do i=e.prev[--r],e.prev[r]=i>=a?i-a:0;while(--t)};let ps=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const ea=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,t.pending===0&&(t.pending_out=0))},Hi=(e,t)=>{SE(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ea(e.strm)},Ur=(e,t)=>{e.pending_buf[e.pending++]=t},jg=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},k0=(e,t,i,r)=>{let a=e.avail_in;return a>r&&(a=r),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),e.state.wrap===1?e.adler=oA(e.adler,t,a,i):e.state.wrap===2&&(e.adler=la(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},Gg=(e,t)=>{let i,r,a=e.max_chain_length,s=e.strstart,o=e.prev_length,c=e.nice_match;const d=e.strstart>e.w_size-Tc?e.strstart-(e.w_size-Tc):0,l=e.window,h=e.w_mask,_=e.prev,f=e.strstart+Go;let m=l[s+o-1],S=l[s+o];e.prev_length>=e.good_match&&(a>>=2),c>e.lookahead&&(c=e.lookahead);do if(i=t,l[i+o]===S&&l[i+o-1]===m&&l[i]===l[s]&&l[++i]===l[s+1]){s+=2,i++;do;while(l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&s<f);if(r=Go-(f-s),s=f-Go,r>o){if(e.match_start=t,o=r,r>=c)break;m=l[s+o-1],S=l[s+o]}}while((t=_[t&h])>d&&--a!=0);return o<=e.lookahead?o:e.lookahead},Wg=e=>{const t=e.w_size;let i,r,a;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Tc)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),bE(e),r+=t),e.strm.avail_in===0)break;if(i=k0(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=i,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=ps(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=ps(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Tc&&e.strm.avail_in!==0)},M0=(e,t)=>{let i,r,a,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,c=e.strm.avail_in;do{if(i=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a||(a=e.strm.avail_out-a,r=e.strstart-e.block_start,i>r+e.strm.avail_in&&(i=r+e.strm.avail_in),i>a&&(i=a),i<s&&(i===0&&t!==Bd||t===vE||i!==r+e.strm.avail_in)))break;o=t===Bd&&i===r+e.strm.avail_in?1:0,fV(e,0,0,o),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,ea(e.strm),r&&(r>i&&(r=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,i-=r),i&&(k0(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(o===0);return c-=e.strm.avail_in,c&&(c>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=c&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-c,e.strm.next_in),e.strstart),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==vE&&t!==Bd&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(k0(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,s=a>e.w_size?e.w_size:a,r=e.strstart-e.block_start,(r>=s||(r||t===Bd)&&t!==vE&&e.strm.avail_in===0&&r<=a)&&(i=r>a?a:r,o=t===Bd&&e.strm.avail_in===0&&i===r?1:0,fV(e,e.block_start,i,o),e.block_start+=i,ea(e.strm)),o?3:1)},AE=(e,t)=>{let i,r;for(;;){if(e.lookahead<Tc){if(Wg(e),e.lookahead<Tc&&t===vE)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=ps(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Tc&&(e.match_length=Gg(e,i)),e.match_length>=3)if(r=TE(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=ps(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ps(e,e.ins_h,e.window[e.strstart+1]);else r=TE(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Hi(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Bd?(Hi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Hi(e,!1),e.strm.avail_out===0)?1:2},Rc=(e,t)=>{let i,r,a;for(;;){if(e.lookahead<Tc){if(Wg(e),e.lookahead<Tc&&t===vE)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=ps(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Tc&&(e.match_length=Gg(e,i),e.match_length<=5&&(e.strategy===D0||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,r=TE(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=ps(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Hi(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=TE(e,0,e.window[e.strstart-1]),r&&Hi(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=TE(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Bd?(Hi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Hi(e,!1),e.strm.avail_out===0)?1:2};function Qc(e,t,i,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=a}const cA=[new Qc(0,0,0,0,M0),new Qc(4,4,8,4,AE),new Qc(4,5,16,8,AE),new Qc(4,6,32,32,AE),new Qc(4,4,16,16,Rc),new Qc(8,16,32,32,Rc),new Qc(8,16,128,128,Rc),new Qc(8,32,128,256,Rc),new Qc(32,128,258,1024,Rc),new Qc(32,258,258,4096,Rc)];function dA(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=YR,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*zH),this.dyn_dtree=new Uint16Array(2*(2*KH+1)),this.bl_tree=new Uint16Array(2*(2*YH+1)),CE(this.dyn_ltree),CE(this.dyn_dtree),CE(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Bg+1),this.heap=new Uint16Array(2*gV+1),CE(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*gV+1),CE(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const zR=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Pl&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==th&&t.status!==ih?1:0},SV=e=>{if(zR(e))return yE(e,lp);e.total_in=e.total_out=0,e.data_type=L0;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Pl:th,e.adler=t.wrap===2?0:1,t.last_flush=-2,_V(t),zs},TV=e=>{const t=SV(e);return t===zs&&(i=>{i.window_size=2*i.w_size,CE(i.head),i.max_lazy_match=cA[i.level].max_lazy,i.good_match=cA[i.level].good_length,i.nice_match=cA[i.level].nice_length,i.max_chain_length=cA[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),t},Rj=(e,t,i,r,a,s)=>{if(!e)return lp;let o=1;if(t===jH&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),a<1||a>9||i!==YR||r<8||r>15||t<0||t>9||s<0||s>WH||r===8&&o!==1)return yE(e,lp);r===8&&(r=9);const c=new dA;return e.state=c,c.strm=e,c.status=Pl,c.wrap=o,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=a+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<a+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=s,c.method=i,TV(e)};var qH=(e,t)=>{if(zR(e)||t>Ys||t<0)return e?yE(e,lp):lp;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===ih&&t!==Bd)return yE(e,e.avail_out===0?mV:lp);const r=i.last_flush;if(i.last_flush=t,i.pending!==0){if(ea(e),e.avail_out===0)return i.last_flush=-1,zs}else if(e.avail_in===0&&w_(t)<=w_(r)&&t!==Bd)return yE(e,mV);if(i.status===ih&&e.avail_in!==0)return yE(e,mV);if(i.status===Pl&&i.wrap===0&&(i.status=th),i.status===Pl){let a=YR+(i.w_bits-8<<4)<<8,s=-1;if(s=i.strategy>=P0||i.level<2?0:i.level<6?1:i.level===6?2:3,a|=s<<6,i.strstart!==0&&(a|=32),a+=31-a%31,jg(i,a),i.strstart!==0&&(jg(i,e.adler>>>16),jg(i,65535&e.adler)),e.adler=1,i.status=th,ea(e),i.pending!==0)return i.last_flush=-1,zs}if(i.status===57){if(e.adler=0,Ur(i,31),Ur(i,139),Ur(i,8),i.gzhead)Ur(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Ur(i,255&i.gzhead.time),Ur(i,i.gzhead.time>>8&255),Ur(i,i.gzhead.time>>16&255),Ur(i,i.gzhead.time>>24&255),Ur(i,i.level===9?2:i.strategy>=P0||i.level<2?4:0),Ur(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Ur(i,255&i.gzhead.extra.length),Ur(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=la(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Ur(i,0),Ur(i,0),Ur(i,0),Ur(i,0),Ur(i,0),Ur(i,i.level===9?2:i.strategy>=P0||i.level<2?4:0),Ur(i,3),i.status=th,ea(e),i.pending!==0)return i.last_flush=-1,zs}if(i.status===69){if(i.gzhead.extra){let a=i.pending,s=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+s>i.pending_buf_size;){let c=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+c),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>a&&(e.adler=la(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex+=c,ea(e),i.pending!==0)return i.last_flush=-1,zs;a=0,s-=c}let o=new Uint8Array(i.gzhead.extra);i.pending_buf.set(o.subarray(i.gzindex,i.gzindex+s),i.pending),i.pending+=s,i.gzhead.hcrc&&i.pending>a&&(e.adler=la(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let a,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=la(e.adler,i.pending_buf,i.pending-s,s)),ea(e),i.pending!==0)return i.last_flush=-1,zs;s=0}a=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Ur(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=la(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let a,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=la(e.adler,i.pending_buf,i.pending-s,s)),ea(e),i.pending!==0)return i.last_flush=-1,zs;s=0}a=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Ur(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=la(e.adler,i.pending_buf,i.pending-s,s))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(ea(e),i.pending!==0))return i.last_flush=-1,zs;Ur(i,255&e.adler),Ur(i,e.adler>>8&255),e.adler=0}if(i.status=th,ea(e),i.pending!==0)return i.last_flush=-1,zs}if(e.avail_in!==0||i.lookahead!==0||t!==vE&&i.status!==ih){let a=i.level===0?M0(i,t):i.strategy===P0?((s,o)=>{let c;for(;;){if(s.lookahead===0&&(Wg(s),s.lookahead===0)){if(o===vE)return 1;break}if(s.match_length=0,c=TE(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,c&&(Hi(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Bd?(Hi(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Hi(s,!1),s.strm.avail_out===0)?1:2})(i,t):i.strategy===GH?((s,o)=>{let c,d,l,h;const _=s.window;for(;;){if(s.lookahead<=Go){if(Wg(s),s.lookahead<=Go&&o===vE)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(l=s.strstart-1,d=_[l],d===_[++l]&&d===_[++l]&&d===_[++l])){h=s.strstart+Go;do;while(d===_[++l]&&d===_[++l]&&d===_[++l]&&d===_[++l]&&d===_[++l]&&d===_[++l]&&d===_[++l]&&d===_[++l]&&l<h);s.match_length=Go-(h-l),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(c=TE(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(c=TE(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),c&&(Hi(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Bd?(Hi(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Hi(s,!1),s.strm.avail_out===0)?1:2})(i,t):cA[i.level].func(i,t);if(a!==3&&a!==4||(i.status=ih),a===1||a===3)return e.avail_out===0&&(i.last_flush=-1),zs;if(a===2&&(t===BH?RE(i):t!==Ys&&(fV(i,0,0,!1),t===Dl&&(CE(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),ea(e),e.avail_out===0))return i.last_flush=-1,zs}return t!==Bd?zs:i.wrap<=0?eh:(i.wrap===2?(Ur(i,255&e.adler),Ur(i,e.adler>>8&255),Ur(i,e.adler>>16&255),Ur(i,e.adler>>24&255),Ur(i,255&e.total_in),Ur(i,e.total_in>>8&255),Ur(i,e.total_in>>16&255),Ur(i,e.total_in>>24&255)):(jg(i,e.adler>>>16),jg(i,65535&e.adler)),ea(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?zs:eh)},lA=(e,t)=>{let i=t.length;if(zR(e))return lp;const r=e.state,a=r.wrap;if(a===2||a===1&&r.status!==Pl||r.lookahead)return lp;if(a===1&&(e.adler=oA(e.adler,t,i,0)),r.wrap=0,i>=r.w_size){a===0&&(CE(r.head),r.strstart=0,r.block_start=0,r.insert=0);let d=new Uint8Array(r.w_size);d.set(t.subarray(i-r.w_size,i),0),t=d,i=r.w_size}const s=e.avail_in,o=e.next_in,c=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Wg(r);r.lookahead>=3;){let d=r.strstart,l=r.lookahead-2;do r.ins_h=ps(r,r.ins_h,r.window[d+3-1]),r.prev[d&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=d,d++;while(--l);r.strstart=d,r.lookahead=2,Wg(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=c,e.avail_in=s,r.wrap=a,zs},uA={deflateInit:(e,t)=>Rj(e,t,YR,15,8,HH),deflateInit2:Rj,deflateReset:TV,deflateResetKeep:SV,deflateSetHeader:(e,t)=>zR(e)||e.state.wrap!==2?lp:(e.state.gzhead=t,zs),deflate:qH,deflateEnd:e=>{if(zR(e))return lp;const t=e.state.status;return e.state=null,t===th?yE(e,EV):zs},deflateSetDictionary:lA,deflateInfo:"pako deflate (from Nodeca project)"};const U0=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var hA={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const r in i)U0(i,r)&&(e[r]=i[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,a=e.length;r<a;r++)t+=e[r].length;const i=new Uint8Array(t);for(let r=0,a=0,s=e.length;r<s;r++){let o=e[r];i.set(o,a),a+=o.length}return i}};let qR=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{qR=!1}const O_=new Uint8Array(256);for(let e=0;e<256;e++)O_[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;O_[254]=O_[254]=1;var XR={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,i,r,a,s,o=e.length,c=0;for(a=0;a<o;a++)i=e.charCodeAt(a),(64512&i)==55296&&a+1<o&&(r=e.charCodeAt(a+1),(64512&r)==56320&&(i=65536+(i-55296<<10)+(r-56320),a++)),c+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(c),s=0,a=0;s<c;a++)i=e.charCodeAt(a),(64512&i)==55296&&a+1<o&&(r=e.charCodeAt(a+1),(64512&r)==56320&&(i=65536+(i-55296<<10)+(r-56320),a++)),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},buf2string:(e,t)=>{const i=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,a;const s=new Array(2*i);for(a=0,r=0;r<i;){let o=e[r++];if(o<128){s[a++]=o;continue}let c=O_[o];if(c>4)s[a++]=65533,r+=c-1;else{for(o&=c===2?31:c===3?15:7;c>1&&r<i;)o=o<<6|63&e[r++],c--;c>1?s[a++]=65533:o<65536?s[a++]=o:(o-=65536,s[a++]=55296|o>>10&1023,s[a++]=56320|1023&o)}}return((o,c)=>{if(c<65534&&o.subarray&&qR)return String.fromCharCode.apply(null,o.length===c?o:o.subarray(0,c));let d="";for(let l=0;l<c;l++)d+=String.fromCharCode(o[l]);return d})(s,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?t:i+O_[e[i]]>t?i:t}},RV=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const vj=Object.prototype.toString,{Z_NO_FLUSH:XH,Z_SYNC_FLUSH:JH,Z_FULL_FLUSH:ZH,Z_FINISH:x0,Z_OK:V0,Z_STREAM_END:QH,Z_DEFAULT_COMPRESSION:$H,Z_DEFAULT_STRATEGY:e3,Z_DEFLATED:F0}=N0;function B0(e){this.options=hA.assign({level:$H,method:F0,chunkSize:16384,windowBits:15,memLevel:8,strategy:e3},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new RV,this.strm.avail_out=0;let i=uA.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==V0)throw new Error(dp[i]);if(t.header&&uA.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?XR.string2buf(t.dictionary):vj.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,i=uA.deflateSetDictionary(this.strm,r),i!==V0)throw new Error(dp[i]);this._dict_set=!0}}function t3(e,t){const i=new B0(t);if(i.push(e,!0),i.err)throw i.msg||dp[i.err];return i.result}B0.prototype.push=function(e,t){const i=this.strm,r=this.options.chunkSize;let a,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?x0:XH,typeof e=="string"?i.input=XR.string2buf(e):vj.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),(s===JH||s===ZH)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(a=uA.deflate(i,s),a===QH)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),a=uA.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===V0;if(i.avail_out!==0){if(s>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},B0.prototype.onData=function(e){this.chunks.push(e)},B0.prototype.onEnd=function(e){e===V0&&(this.result=hA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var j0={deflate:t3};const G0=16209;var W0=function(e,t){let i,r,a,s,o,c,d,l,h,_,f,m,S,T,R,C,b,N,k,P,U,W,z,Q;const he=e.state;i=e.next_in,z=e.input,r=i+(e.avail_in-5),a=e.next_out,Q=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),c=he.dmax,d=he.wsize,l=he.whave,h=he.wnext,_=he.window,f=he.hold,m=he.bits,S=he.lencode,T=he.distcode,R=(1<<he.lenbits)-1,C=(1<<he.distbits)-1;e:do{m<15&&(f+=z[i++]<<m,m+=8,f+=z[i++]<<m,m+=8),b=S[f&R];t:for(;;){if(N=b>>>24,f>>>=N,m-=N,N=b>>>16&255,N===0)Q[a++]=65535&b;else{if(!(16&N)){if((64&N)==0){b=S[(65535&b)+(f&(1<<N)-1)];continue t}if(32&N){he.mode=16191;break e}e.msg="invalid literal/length code",he.mode=G0;break e}k=65535&b,N&=15,N&&(m<N&&(f+=z[i++]<<m,m+=8),k+=f&(1<<N)-1,f>>>=N,m-=N),m<15&&(f+=z[i++]<<m,m+=8,f+=z[i++]<<m,m+=8),b=T[f&C];i:for(;;){if(N=b>>>24,f>>>=N,m-=N,N=b>>>16&255,!(16&N)){if((64&N)==0){b=T[(65535&b)+(f&(1<<N)-1)];continue i}e.msg="invalid distance code",he.mode=G0;break e}if(P=65535&b,N&=15,m<N&&(f+=z[i++]<<m,m+=8,m<N&&(f+=z[i++]<<m,m+=8)),P+=f&(1<<N)-1,P>c){e.msg="invalid distance too far back",he.mode=G0;break e}if(f>>>=N,m-=N,N=a-s,P>N){if(N=P-N,N>l&&he.sane){e.msg="invalid distance too far back",he.mode=G0;break e}if(U=0,W=_,h===0){if(U+=d-N,N<k){k-=N;do Q[a++]=_[U++];while(--N);U=a-P,W=Q}}else if(h<N){if(U+=d+h-N,N-=h,N<k){k-=N;do Q[a++]=_[U++];while(--N);if(U=0,h<k){N=h,k-=N;do Q[a++]=_[U++];while(--N);U=a-P,W=Q}}}else if(U+=h-N,N<k){k-=N;do Q[a++]=_[U++];while(--N);U=a-P,W=Q}for(;k>2;)Q[a++]=W[U++],Q[a++]=W[U++],Q[a++]=W[U++],k-=3;k&&(Q[a++]=W[U++],k>1&&(Q[a++]=W[U++]))}else{U=a-P;do Q[a++]=Q[U++],Q[a++]=Q[U++],Q[a++]=Q[U++],k-=3;while(k>2);k&&(Q[a++]=Q[U++],k>1&&(Q[a++]=Q[U++]))}break}}break}}while(i<r&&a<o);k=m>>3,i-=k,m-=k<<3,f&=(1<<m)-1,e.next_in=i,e.next_out=a,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=a<o?o-a+257:257-(a-o),he.hold=f,he.bits=m};const H0=15,i3=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),r3=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),n3=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),pA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var JR=(e,t,i,r,a,s,o,c)=>{const d=c.bits;let l,h,_,f,m,S,T=0,R=0,C=0,b=0,N=0,k=0,P=0,U=0,W=0,z=0,Q=null;const he=new Uint16Array(16),Ge=new Uint16Array(16);let xe,qe,ot,xt=null;for(T=0;T<=H0;T++)he[T]=0;for(R=0;R<r;R++)he[t[i+R]]++;for(N=d,b=H0;b>=1&&he[b]===0;b--);if(N>b&&(N=b),b===0)return a[s++]=20971520,a[s++]=20971520,c.bits=1,0;for(C=1;C<b&&he[C]===0;C++);for(N<C&&(N=C),U=1,T=1;T<=H0;T++)if(U<<=1,U-=he[T],U<0)return-1;if(U>0&&(e===0||b!==1))return-1;for(Ge[1]=0,T=1;T<H0;T++)Ge[T+1]=Ge[T]+he[T];for(R=0;R<r;R++)t[i+R]!==0&&(o[Ge[t[i+R]]++]=R);if(e===0?(Q=xt=o,S=20):e===1?(Q=i3,xt=r3,S=257):(Q=n3,xt=pA,S=0),z=0,R=0,T=C,m=s,k=N,P=0,_=-1,W=1<<N,f=W-1,e===1&&W>852||e===2&&W>592)return 1;for(;;){xe=T-P,o[R]+1<S?(qe=0,ot=o[R]):o[R]>=S?(qe=xt[o[R]-S],ot=Q[o[R]-S]):(qe=96,ot=0),l=1<<T-P,h=1<<k,C=h;do h-=l,a[m+(z>>P)+h]=xe<<24|qe<<16|ot|0;while(h!==0);for(l=1<<T-1;z&l;)l>>=1;if(l!==0?(z&=l-1,z+=l):z=0,R++,--he[T]==0){if(T===b)break;T=t[i+o[R]]}if(T>N&&(z&f)!==_){for(P===0&&(P=N),m+=C,k=T-P,U=1<<k;k+P<b&&(U-=he[k+P],!(U<=0));)k++,U<<=1;if(W+=1<<k,e===1&&W>852||e===2&&W>592)return 1;_=z&f,a[_]=N<<24|k<<16|m-s|0}}return z!==0&&(a[m+z]=T-P<<24|64<<16|0),c.bits=N,0};const{Z_FINISH:yj,Z_BLOCK:K0,Z_TREES:up,Z_OK:Hg,Z_STREAM_END:a3,Z_NEED_DICT:Ll,Z_STREAM_ERROR:jd,Z_DATA_ERROR:vV,Z_MEM_ERROR:Cj,Z_BUF_ERROR:bj,Z_DEFLATED:_A}=N0,Kg=16180,kl=16190,rh=16191,fA=16192,ZR=16194,Yg=16199,QR=16200,Yn=16206,ta=16209,Aj=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function zg(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const IE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Kg||t.mode>16211?1:0},yV=e=>{if(IE(e))return jd;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Kg,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Hg},CV=e=>{if(IE(e))return jd;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,yV(e)},bV=(e,t)=>{let i;if(IE(e))return jd;const r=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?jd:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,CV(e))},Y0=(e,t)=>{if(!e)return jd;const i=new zg;e.state=i,i.strm=e,i.window=null,i.mode=Kg;const r=bV(e,t);return r!==Hg&&(e.state=null),r};let EA,z0,Ij=!0;const wj=e=>{if(Ij){EA=new Int32Array(512),z0=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(JR(1,e.lens,0,288,EA,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;JR(2,e.lens,0,32,z0,0,e.work,{bits:5}),Ij=!1}e.lencode=EA,e.lenbits=9,e.distcode=z0,e.distbits=5},Oj=(e,t,i,r)=>{let a;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>r&&(a=r),s.window.set(t.subarray(i-r,i-r+a),s.wnext),(r-=a)?(s.window.set(t.subarray(i-r,i),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0};var N_=(e,t)=>{let i,r,a,s,o,c,d,l,h,_,f,m,S,T,R,C,b,N,k,P,U,W,z=0;const Q=new Uint8Array(4);let he,Ge;const xe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(IE(e)||!e.output||!e.input&&e.avail_in!==0)return jd;i=e.state,i.mode===rh&&(i.mode=fA),o=e.next_out,a=e.output,d=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,l=i.hold,h=i.bits,_=c,f=d,W=Hg;e:for(;;)switch(i.mode){case Kg:if(i.wrap===0){i.mode=fA;break}for(;h<16;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if(2&i.wrap&&l===35615){i.wbits===0&&(i.wbits=15),i.check=0,Q[0]=255&l,Q[1]=l>>>8&255,i.check=la(i.check,Q,2,0),l=0,h=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",i.mode=ta;break}if((15&l)!==_A){e.msg="unknown compression method",i.mode=ta;break}if(l>>>=4,h-=4,U=8+(15&l),i.wbits===0&&(i.wbits=U),U>15||U>i.wbits){e.msg="invalid window size",i.mode=ta;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&l?16189:rh,l=0,h=0;break;case 16181:for(;h<16;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if(i.flags=l,(255&da(i))!==_A){e.msg="unknown compression method",i.mode=ta;break}if(57344&da(i)){e.msg="unknown header flags set",i.mode=ta;break}i.head&&(i.head.text=l>>8&1),512&da(i)&&4&i.wrap&&(Q[0]=255&l,Q[1]=l>>>8&255,i.check=la(i.check,Q,2,0)),l=0,h=0,i.mode=16182;case 16182:for(;h<32;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}i.head&&(i.head.time=l),512&da(i)&&4&i.wrap&&(Q[0]=255&l,Q[1]=l>>>8&255,Q[2]=l>>>16&255,Q[3]=l>>>24&255,i.check=la(i.check,Q,4,0)),l=0,h=0,i.mode=16183;case 16183:for(;h<16;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&da(i)&&4&i.wrap&&(Q[0]=255&l,Q[1]=l>>>8&255,i.check=la(i.check,Q,2,0)),l=0,h=0,i.mode=16184;case 16184:if(1024&da(i)){for(;h<16;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}i.length=l,i.head&&(i.head.extra_len=l),512&da(i)&&4&i.wrap&&(Q[0]=255&l,Q[1]=l>>>8&255,i.check=la(i.check,Q,2,0)),l=0,h=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&da(i)&&(m=i.length,m>c&&(m=c),m&&(i.head&&(U=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(r.subarray(s,s+m),U)),512&da(i)&&4&i.wrap&&(i.check=la(i.check,r,m,s)),c-=m,s+=m,i.length-=m),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&da(i)){if(c===0)break e;m=0;do U=r[s+m++],i.head&&U&&i.length<65536&&(i.head.name+=String.fromCharCode(U));while(U&&m<c);if(512&da(i)&&4&i.wrap&&(i.check=la(i.check,r,m,s)),c-=m,s+=m,U)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&da(i)){if(c===0)break e;m=0;do U=r[s+m++],i.head&&U&&i.length<65536&&(i.head.comment+=String.fromCharCode(U));while(U&&m<c);if(512&da(i)&&4&i.wrap&&(i.check=la(i.check,r,m,s)),c-=m,s+=m,U)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&da(i)){for(;h<16;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if(4&i.wrap&&l!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ta;break}l=0,h=0}i.head&&(i.head.hcrc=da(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=rh;break;case 16189:for(;h<32;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}e.adler=i.check=Aj(l),l=0,h=0,i.mode=kl;case kl:if(i.havedict===0)return e.next_out=o,e.avail_out=d,e.next_in=s,e.avail_in=c,i.hold=l,i.bits=h,Ll;e.adler=i.check=1,i.mode=rh;case rh:if(t===K0||t===up)break e;case fA:if(i.last){l>>>=7&h,h-=7&h,i.mode=Yn;break}for(;h<3;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}switch(i.last=1&l,l>>>=1,h-=1,3&l){case 0:i.mode=16193;break;case 1:if(wj(i),i.mode=Yg,t===up){l>>>=2,h-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=ta}l>>>=2,h-=2;break;case 16193:for(l>>>=7&h,h-=7&h;h<32;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ta;break}if(i.length=65535&l,l=0,h=0,i.mode=ZR,t===up)break e;case ZR:i.mode=16195;case 16195:if(m=i.length,m){if(m>c&&(m=c),m>d&&(m=d),m===0)break e;a.set(r.subarray(s,s+m),o),c-=m,s+=m,d-=m,o+=m,i.length-=m;break}i.mode=rh;break;case 16196:for(;h<14;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if(i.nlen=257+(31&l),l>>>=5,h-=5,i.ndist=1+(31&l),l>>>=5,h-=5,i.ncode=4+(15&l),l>>>=4,h-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ta;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;h<3;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}i.lens[xe[i.have++]]=7&l,l>>>=3,h-=3}for(;i.have<19;)i.lens[xe[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,he={bits:i.lenbits},W=JR(0,i.lens,0,19,i.lencode,0,i.work,he),i.lenbits=he.bits,W){e.msg="invalid code lengths set",i.mode=ta;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;z=i.lencode[l&(1<<i.lenbits)-1],R=z>>>24,C=z>>>16&255,b=65535&z,!(R<=h);){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if(b<16)l>>>=R,h-=R,i.lens[i.have++]=b;else{if(b===16){for(Ge=R+2;h<Ge;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if(l>>>=R,h-=R,i.have===0){e.msg="invalid bit length repeat",i.mode=ta;break}U=i.lens[i.have-1],m=3+(3&l),l>>>=2,h-=2}else if(b===17){for(Ge=R+3;h<Ge;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}l>>>=R,h-=R,U=0,m=3+(7&l),l>>>=3,h-=3}else{for(Ge=R+7;h<Ge;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}l>>>=R,h-=R,U=0,m=11+(127&l),l>>>=7,h-=7}if(i.have+m>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ta;break}for(;m--;)i.lens[i.have++]=U}}if(i.mode===ta)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=ta;break}if(i.lenbits=9,he={bits:i.lenbits},W=JR(1,i.lens,0,i.nlen,i.lencode,0,i.work,he),i.lenbits=he.bits,W){e.msg="invalid literal/lengths set",i.mode=ta;break}if(i.distbits=6,i.distcode=i.distdyn,he={bits:i.distbits},W=JR(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,he),i.distbits=he.bits,W){e.msg="invalid distances set",i.mode=ta;break}if(i.mode=Yg,t===up)break e;case Yg:i.mode=QR;case QR:if(c>=6&&d>=258){e.next_out=o,e.avail_out=d,e.next_in=s,e.avail_in=c,i.hold=l,i.bits=h,W0(e,f),o=e.next_out,a=e.output,d=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,l=i.hold,h=i.bits,i.mode===rh&&(i.back=-1);break}for(i.back=0;z=i.lencode[l&(1<<i.lenbits)-1],R=z>>>24,C=z>>>16&255,b=65535&z,!(R<=h);){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if(C&&(240&C)==0){for(N=R,k=C,P=b;z=i.lencode[P+((l&(1<<N+k)-1)>>N)],R=z>>>24,C=z>>>16&255,b=65535&z,!(N+R<=h);){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}l>>>=N,h-=N,i.back+=N}if(l>>>=R,h-=R,i.back+=R,i.length=b,C===0){i.mode=16205;break}if(32&C){i.back=-1,i.mode=rh;break}if(64&C){e.msg="invalid literal/length code",i.mode=ta;break}i.extra=15&C,i.mode=16201;case 16201:if(i.extra){for(Ge=i.extra;h<Ge;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,h-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;z=i.distcode[l&(1<<i.distbits)-1],R=z>>>24,C=z>>>16&255,b=65535&z,!(R<=h);){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if((240&C)==0){for(N=R,k=C,P=b;z=i.distcode[P+((l&(1<<N+k)-1)>>N)],R=z>>>24,C=z>>>16&255,b=65535&z,!(N+R<=h);){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}l>>>=N,h-=N,i.back+=N}if(l>>>=R,h-=R,i.back+=R,64&C){e.msg="invalid distance code",i.mode=ta;break}i.offset=b,i.extra=15&C,i.mode=16203;case 16203:if(i.extra){for(Ge=i.extra;h<Ge;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,h-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ta;break}i.mode=16204;case 16204:if(d===0)break e;if(m=f-d,i.offset>m){if(m=i.offset-m,m>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ta;break}m>i.wnext?(m-=i.wnext,S=i.wsize-m):S=i.wnext-m,m>i.length&&(m=i.length),T=i.window}else T=a,S=o-i.offset,m=i.length;m>d&&(m=d),d-=m,i.length-=m;do a[o++]=T[S++];while(--m);i.length===0&&(i.mode=QR);break;case 16205:if(d===0)break e;a[o++]=i.length,d--,i.mode=QR;break;case Yn:if(i.wrap){for(;h<32;){if(c===0)break e;c--,l|=r[s++]<<h,h+=8}if(f-=d,e.total_out+=f,i.total+=f,4&i.wrap&&f&&(e.adler=i.check=da(i)?la(i.check,a,f,o-f):oA(i.check,a,f,o-f)),f=d,4&i.wrap&&(da(i)?l:Aj(l))!==i.check){e.msg="incorrect data check",i.mode=ta;break}l=0,h=0}i.mode=16207;case 16207:if(i.wrap&&da(i)){for(;h<32;){if(c===0)break e;c--,l+=r[s++]<<h,h+=8}if(4&i.wrap&&l!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ta;break}l=0,h=0}i.mode=16208;case 16208:W=a3;break e;case ta:W=vV;break e;case 16210:return Cj;default:return jd}return e.next_out=o,e.avail_out=d,e.next_in=s,e.avail_in=c,i.hold=l,i.bits=h,(i.wsize||f!==e.avail_out&&i.mode<ta&&(i.mode<Yn||t!==yj))&&Oj(e,e.output,e.next_out,f-e.avail_out),_-=e.avail_in,f-=e.avail_out,e.total_in+=_,e.total_out+=f,i.total+=f,4&i.wrap&&f&&(e.adler=i.check=da(i)?la(i.check,a,f,e.next_out-f):oA(i.check,a,f,e.next_out-f)),e.data_type=i.bits+(i.last?64:0)+(i.mode===rh?128:0)+(i.mode===Yg||i.mode===ZR?256:0),(_===0&&f===0||t===yj)&&W===Hg&&(W=bj),W},D_={inflateReset:CV,inflateReset2:bV,inflateResetKeep:yV,inflateInit:e=>Y0(e,15),inflateInit2:Y0,inflate:N_,inflateEnd:e=>{if(IE(e))return jd;let t=e.state;return t.window&&(t.window=null),e.state=null,Hg},inflateGetHeader:(e,t)=>{if(IE(e))return jd;const i=e.state;return(2&i.wrap)==0?jd:(i.head=t,t.done=!1,Hg)},inflateSetDictionary:(e,t)=>{const i=t.length;let r,a,s;return IE(e)?jd:(r=e.state,r.wrap!==0&&r.mode!==kl?jd:r.mode===kl&&(a=1,a=oA(a,t,i,0),a!==r.check)?vV:(s=Oj(e,t,i,i),s?(r.mode=16210,Cj):(r.havedict=1,Hg)))},inflateInfo:"pako inflate (from Nodeca project)"},Nj=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Dj=Object.prototype.toString,{Z_NO_FLUSH:s3,Z_FINISH:mA,Z_OK:qg,Z_STREAM_END:gA,Z_NEED_DICT:AV,Z_STREAM_ERROR:Pj,Z_DATA_ERROR:Lj,Z_MEM_ERROR:q0}=N0;function X0(e){this.options=hA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new RV,this.strm.avail_out=0;let i=D_.inflateInit2(this.strm,t.windowBits);if(i!==qg)throw new Error(dp[i]);if(this.header=new Nj,D_.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=XR.string2buf(t.dictionary):Dj.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=D_.inflateSetDictionary(this.strm,t.dictionary),i!==qg)))throw new Error(dp[i])}function o3(e,t){const i=new X0(t);if(i.push(e),i.err)throw i.msg||dp[i.err];return i.result}X0.prototype.push=function(e,t){const i=this.strm,r=this.options.chunkSize,a=this.options.dictionary;let s,o,c;if(this.ended)return!1;for(o=t===~~t?t:t===!0?mA:s3,Dj.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),s=D_.inflate(i,o),s===AV&&a&&(s=D_.inflateSetDictionary(i,a),s===qg?s=D_.inflate(i,o):s===Lj&&(s=AV));i.avail_in>0&&s===gA&&i.state.wrap>0&&e[i.next_in]!==0;)D_.inflateReset(i),s=D_.inflate(i,o);switch(s){case Pj:case Lj:case AV:case q0:return this.onEnd(s),this.ended=!0,!1}if(c=i.avail_out,i.next_out&&(i.avail_out===0||s===gA))if(this.options.to==="string"){let d=XR.utf8border(i.output,i.next_out),l=i.next_out-d,h=XR.buf2string(i.output,d);i.next_out=l,i.avail_out=r-l,l&&i.output.set(i.output.subarray(d,d+l),0),this.onData(h)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(s!==qg||c!==0){if(s===gA)return s=D_.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},X0.prototype.onData=function(e){this.chunks.push(e)},X0.prototype.onEnd=function(e){e===qg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=hA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var c3={inflate:o3};const{deflate:d3}=j0,{inflate:l3}=c3;var u3=d3,kj=l3,Mj=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(Mj||{});class h3{constructor(){V(this,"_sequence",0),V(this,"_startTime",Date.now()),V(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const d={id:0,length:4,data:c.buffer},l={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};i.commonPacketHeader.extension=1,i.extension=l,i.payload=this.compress(t),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;G("SHOW_DATASTREAM2_LOG")&&w.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const r=new ArrayBuffer(i.commonPacketHeader.length),a=new Uint8Array(r),s=new DataView(r);let o=0;if(s.setUint16(o,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),o+=2,s.setUint32(o,i.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,i.commonStreamHeader,!0),o+=2,i.extension){const c=this.serializeExtension(i.extension);a.set(new Uint8Array(c),o),o+=c.byteLength}if(a.set(new Uint8Array(i.payload),o),o+=i.payload.byteLength,o!==i.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const i=new DataView(t);let r=0;const a=i.getUint16(r,!0);r+=2;const s={length:16383&a,reserved:(16384&a)>>14,extension:(32768&a)>>15,sequence:i.getUint16(r+2,!0)<<16|i.getUint16(r,!0)};let o,c;if(r+=4,G("SHOW_DATASTREAM2_LOG")&&w.debug("receive data header: ".concat(JSON.stringify(s))),i.getUint16(r,!0),r+=2,s.extension){c=this.deserializeExtension(t.slice(r)),r+=2+c.length,o=t.slice(r);let d=!1;if(c.datas.length>0){const l=c.datas.find((h=>h.id===0));l&&(d=(1&new DataView(l.data).getUint32(0,!0))==1)}o=d?this.decompress(o):o}else o=t.slice(8);return o}serializeExtension(t){const{profile:i,length:r,datas:a}=t,s=new ArrayBuffer(r+2),o=new Uint8Array(s),c=new DataView(s);let d=0;if(c.setUint8(d++,i),c.setUint8(d++,r),a.forEach((l=>{i?(c.setUint8(d++,l.id),c.setUint8(d++,l.length),o.set(new Uint8Array(l.data),d),d+=l.data.byteLength):(c.setUint8(d++,l.id|l.length<<4),o.set(new Uint8Array(l.data),d),d+=l.data.byteLength)})),d!==r+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(r+2));return s}deserializeExtension(t){const i=new DataView(t);let r=0;const a=i.getUint8(r);r++;const s=i.getUint8(r);r++;const o=a===Mj.TWO_BYTE,c=[],d=new DataView(t,2);let l=0;for(;l<s;){let h=0,_=0,f=new ArrayBuffer(0);o?(h=d.getUint8(l),l++,_=d.getUint8(l),l++):(h=15&d.getUint8(l),_=d.getUint8(l)>>4,l++),_>0&&(f=d.buffer.slice(l+2,l+2+_),l+=f.byteLength),c.push({id:h,length:_,data:f})}if(l!==s)throw Error("parse error");return{profile:a,length:s,datas:c}}decompress(t){return kj(new Uint8Array(t))}compress(t){return u3(new Uint8Array(t))}}const p3={name:"DataStream",create:(e,t)=>{const i=t?new X4(e):new UO(e);return i.useDataStream(new h3),i}};class _3 extends or{constructor(t,i,r){super(),V(this,"ws",void 0),V(this,"requestId",1),V(this,"heartBeatTimer",void 0),V(this,"joinInfo",void 0),V(this,"clientId",void 0),V(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),V(this,"onClose",(a=>{this.emit("close"),this.dispose()})),V(this,"onMessage",(a=>{const s=JSON.parse(a.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)})),this.joinInfo=t,this.clientId=i,this.ws=new Mb("cross-channel-".concat(this.clientId),r),this.ws.on(Pt.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(Pt.CONNECTED,this.onOpen),this.ws.on(Pt.ON_MESSAGE,this.onMessage),this.ws.on(Pt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const i=this.requestId++;return t.requestId=i,t.seq=i,this.ws.sendMessage(t),i}waitStatus(t){return new se(((i,r)=>{const a=window.setTimeout((()=>{r(new oe(L.TIMEOUT,"wait status timeout, status: ".concat(t)))}),5e3);this.once(t,(s=>{window.clearTimeout(a),s.state&&s.state!==0?r(new oe(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):i(void 0)})),this.once("dispose",(()=>{window.clearTimeout(a),r(new oe(L.WS_ABORT))}))}))}async request(t){if(this.ws.state==="closed")throw new oe(L.WS_DISCONNECT);const i=()=>new se(((o,c)=>{this.ws.once(Pt.CLOSED,(()=>c(new oe(L.WS_ABORT)))),this.ws.once(Pt.CONNECTED,o)}));this.ws.state!=="connected"&&await i();const r=this.sendMessage(t),a=new se(((o,c)=>{const d=()=>{c(new oe(L.WS_ABORT))};this.ws.once(Pt.RECONNECTING,d),this.ws.once(Pt.CLOSED,d),this.once("req_".concat(r),o),Ht(3e3).then((()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Pt.RECONNECTING,d),this.ws.off(Pt.CLOSED,d),c(new oe(L.TIMEOUT,"cross channel ws request timeout"))}))})),s=await a;if(!s||s.code!==200)throw new oe(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(Pt.REQUEST_NEW_URLS),this.ws.on(Pt.REQUEST_NEW_URLS,(i=>{i(t)})),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const i=this.requestId++;return t.requestId=i,this.ws.sendMessage(t),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class f3 extends or{set state(t){t!==this._state&&(t!==Ja.RELAY_STATE_FAILURE&&(this.errorCode=Ni.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,i,r,a,s){super(),V(this,"joinInfo",void 0),V(this,"sid",void 0),V(this,"clientId",void 0),V(this,"cancelToken",co.CancelToken.source()),V(this,"workerToken",void 0),V(this,"requestId",0),V(this,"signal",void 0),V(this,"prevChannelMediaConfig",void 0),V(this,"httpRetryConfig",void 0),V(this,"_resolution",void 0),V(this,"_state",Ja.RELAY_STATE_IDLE),V(this,"errorCode",Ni.RELAY_OK),V(this,"onStatus",(o=>{w.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",oa.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",oa.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Ni.SRC_TOKEN_EXPIRED,this.state=Ja.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Ni.DEST_TOKEN_EXPIRED,this.state=Ja.RELAY_STATE_FAILURE))})),V(this,"onReconnect",(async()=>{w.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",oa.NETWORK_DISCONNECTED),this.state=Ja.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((o=>{this.state!==Ja.RELAY_STATE_IDLE&&(w.error("auto restart channel media relay failed",o.toString()),this.errorCode=Ni.SERVER_CONNECTION_LOST,this.state=Ja.RELAY_STATE_FAILURE)}))})),this.joinInfo=t,this.clientId=i,this.sid=Yh(),this.signal=new _3(this.joinInfo,this.clientId,r),this.httpRetryConfig=a,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==Ja.RELAY_STATE_IDLE)throw new oe(L.INVALID_OPERATION);this.state=Ja.RELAY_STATE_CONNECTING,await this.connect(),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new oe(L.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new oe(L.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new oe(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ja.RELAY_STATE_RUNNING)throw new oe(L.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ja.RELAY_STATE_RUNNING)throw new oe(L.INVALID_OPERATION);const i=this.genMessage(Kn.SetVideoProfile);await this.signal.request(i),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),w.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ja.RELAY_STATE_IDLE,this.dispose()}dispose(){w.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=co.CancelToken.source(),this.state=Ja.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await bH(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",oa.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const i=this.genMessage(Kn.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(Kn.SetSdkProfile,t);await this.signal.request(r),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const a=this.genMessage(Kn.SetSourceChannel,t);await this.signal.request(a),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",oa.PACKET_JOINED_SRC_CHANNEL),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(Kn.SetSourceUserId,t);await this.signal.request(s),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(Kn.SetDestChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",oa.PACKET_JOINED_DEST_CHANNEL),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(Kn.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",oa.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ja.RELAY_STATE_RUNNING,w.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const i=this.genMessage(Kn.UpdateDestChannel,t);await this.signal.request(i),this.emit("event",oa.PACKET_UPDATE_DEST_CHANNEL),w.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Kn.StopPacketTransfer);await this.signal.request(t),w.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,i){const r=[],a=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:lc,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.24.0"&&(o.sdkVersion="0.0.1");let c=null,d=null;switch(t){case Kn.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Kn.SetSourceChannel:if(d=i&&i.getSrcChannelMediaInfo(),!d)throw new oe(L.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},o;case Kn.SetSourceUserId:if(d=i&&i.getSrcChannelMediaInfo(),!d)throw new oe(L.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:d.uid+""},o;case Kn.SetDestChannel:if(c=i&&i.getDestChannelMediaInfo(),!c)throw new oe(L.UNEXPECTED_ERROR,"can not find dest config");return c.forEach((l=>{r.push(l.channelName),a.push(l.uid+""),s.push(l.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:r,uid:a,token:s},o;case Kn.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Kn.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Kn.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Kn.UpdateDestChannel:if(c=i&&i.getDestChannelMediaInfo(),!c)throw new oe(L.UNEXPECTED_ERROR,"can not find dest config");return c.forEach((l=>{r.push(l.channelName),a.push(l.uid+""),s.push(l.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:a,token:s},o;case Kn.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const Uj={name:"ChannelMediaRelay",create:function(e){return new f3(e.joinInfo,e.clientId,e.websocketRetryConfig||ln,e.httpRetryConfig||ln,e.resolution)}};function $R(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function SA(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?$R(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$R(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}class xj extends or{constructor(t,i,r,a){super(),V(this,"spec",void 0),V(this,"token",void 0),V(this,"websocket",void 0),V(this,"pingpongTimer",void 0),V(this,"reconnectMode","retry"),V(this,"serviceMode",void 0),V(this,"reqId",0),V(this,"commandReqId",0),V(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),V(this,"handleWebSocketMessage",(s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(J.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===h_.TRANSCODE?1:2}),this.emit(Jh.PUBLISH_STREAM_STATUS,o))})),this.spec=i,this.token=t,this.serviceMode=a,this.websocket=new Mb("live-streaming",r),this.websocket.on(Pt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Pt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Pt.REQUEST_NEW_URLS,((s,o)=>{zt(this,Jh.REQUEST_NEW_ADDRESS).then(s).catch(o)})),this.websocket.on(Pt.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(t){return this.websocket.init(t)}async request(t,i,r,a){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new oe(L.UNEXPECTED_ERROR);const c=SA({command:t,sdkVersion:lc==="4.24.0"?"0.0.1":lc,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new oe(L.WS_DISCONNECT);const d=()=>new se(((f,m)=>{this.websocket.once(Pt.CLOSED,(()=>m(new oe(L.WS_ABORT)))),this.websocket.once(Pt.CONNECTED,f)}));this.websocket.state!=="connected"&&await d(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const l=new se(((f,m)=>{const S=()=>{m(new oe(L.WS_ABORT))};this.websocket.once(Pt.RECONNECTING,S),this.websocket.once(Pt.CLOSED,S),this.once("@".concat(o,"-").concat(this.spec.sid),(T=>{f(T)}))}));a&&J.workerEvent(this.spec.sid,SA(SA({},a),{},{requestId:s,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const h=Date.now();this.websocket.sendMessage(c);let _=null;try{_=await l}catch(f){if(this.websocket.state==="closed")throw f;return await d(),await this.request(t,i,r)}return a&&J.workerEvent(this.spec.sid,SA(SA({},a),{},{requestId:s,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-h})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=lc==="4.24.0"?"0.0.1":lc;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Nn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void w.warning("live stream response already exists stream");case Nn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Nn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Nn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new oe(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Nn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new oe(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Nn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new oe(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Nn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new oe(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Jh.WARNING,i,t.serverResponse.url)}case Nn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new oe(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Jh.WARNING,i,t.serverResponse.url)}case Nn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new oe(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Nn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new oe(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Nn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new oe(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Jh.WARNING,i,t.serverResponse.url)}case Nn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new oe(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Nn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new oe(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Nn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Nn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new oe(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Nn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new oe(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new oe(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Nn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new oe(L.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(lb)}),6e3)}}function _o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Wo(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?_o(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_o(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}class E3 extends or{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ln,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ln;super(),V(this,"onLiveStreamWarning",void 0),V(this,"onLiveStreamError",void 0),V(this,"spec",void 0),V(this,"retryTimeout",1e4),V(this,"connection",void 0),V(this,"httpRetryConfig",void 0),V(this,"wsRetryConfig",void 0),V(this,"streamingTasks",new Map),V(this,"isStartingStreamingTask",!1),V(this,"taskMutex",new Wn("live-streaming")),V(this,"cancelToken",co.CancelToken.source()),V(this,"transcodingConfig",void 0),V(this,"uapResponse",void 0),V(this,"lastTaskId",1),V(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=i}async setTranscodingConfig(t){const i=Wo(Wo({},lE),t);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(w.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map((o=>Wo(Wo(Wo({},gU),o),{},{zOrder:o.zOrder?o.zOrder+1:1})))),(function(o){Gr(o.width)||ji(o.width,"config.width",0,1e4),Gr(o.height)||ji(o.height,"config.height",0,1e4),Gr(o.videoBitrate)||ji(o.videoBitrate,"config.videoBitrate",1,1e6),Gr(o.videoFrameRate)||ji(o.videoFrameRate,"config.videoFrameRate"),Gr(o.lowLatency)||gr(o.lowLatency,"config.lowLatency"),Gr(o.audioSampleRate)||Bt(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Gr(o.audioBitrate)||ji(o.audioBitrate,"config.audioBitrate",1,128),Gr(o.audioChannels)||Bt(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Gr(o.videoGop)||ji(o.videoGop,"config.videoGop"),Gr(o.videoCodecProfile)||Bt(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Gr(o.userCount)||ji(o.userCount,"config.userCount",0,17),Gr(o.backgroundColor)||ji(o.backgroundColor,"config.backgroundColor",0,16777215),Gr(o.userConfigExtraInfo)||rn(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Gr(o.transcodingUsers)&&(zi(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach(((c,d)=>{Cl(c.uid),Gr(c.x)||ji(c.x,"transcodingUser[".concat(d,"].x"),0,1e4),Gr(c.y)||ji(c.y,"transcodingUser[".concat(d,"].y"),0,1e4),Gr(c.width)||ji(c.width,"transcodingUser[".concat(d,"].width"),0,1e4),Gr(c.height)||ji(c.height,"transcodingUser[".concat(d,"].height"),0,1e4),Gr(c.zOrder)||ji(c.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),Gr(c.alpha)||ji(c.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)}))),Gr(o.watermark)||SU(o.watermark,"watermark"),Gr(o.backgroundImage)||SU(o.backgroundImage,"backgroundImage"),o.images&&!Gr(o.images)&&(zi(o.images,"config.images"),o.images.forEach(((c,d)=>{SU(c,"images[".concat(d,"]"))})))})(i);const r=[];i.images&&r.push(...i.images.map((o=>Wo(Wo(Wo({},Pb),o),{},{zOrder:255})))),i.backgroundImage&&(r.push(Wo(Wo(Wo({},Pb),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(r.push(Wo(Wo(Wo({},Pb),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=r,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map((o=>Wo({},o))),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const a=(i.userConfigs||[]).map((o=>typeof o.uid=="number"?se.resolve(o.uid):ej(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await se.all(a)).forEach(((o,c)=>{i.userConfigs&&i.userConfigs[c]&&(i.userConfigs[c].uid=o)})),this.transcodingConfig=i,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(tn(s=this.streamingTasks).call(s)).map((c=>c.taskId)).join("#")});w.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((c=>{w.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,o).then((()=>{w.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))})).catch((d=>{w.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,d)}))}))}}async startLiveStreamingTask(t,i,r){if(!this.transcodingConfig&&i===h_.TRANSCODE)throw new oe(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};w.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(i));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new oe(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(c){throw s(),c}switch(i){case h_.TRANSCODE:a.transcodingConfig=Wo({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const c=new se(((l,h)=>{Ht(this.retryTimeout).then((()=>{if(r)return h(r);const _=this.statusError.get(t);return _?(this.statusError.delete(t),h(_)):void 0}))})),d=await se.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:i===h_.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),c]);this.isStartingStreamingTask=!1,w.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(t,{clientRequest:a,mode:i,url:t,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||r)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,i,c)):await this.startLiveStreamingTask(t,i,c)}}stopLiveStreamingTask(t){return new se(((i,r)=>{const a=this.streamingTasks.get(t);if(!a||!this.connection)return new oe(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=a.mode;a.abortTask=()=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:a.url}},!1,{url:t,command:"UnPublishStream",workerType:s===h_.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((o=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()})).catch(r)}))}resetAllTask(){var t;const i=Array.from(tn(t=this.streamingTasks).call(t));this.terminate();for(const r of i)this.startLiveStreamingTask(r.url,r.mode).catch((a=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,a)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=co.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new oe(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await zt(this,Sn.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=i,this.connection=new xj(i.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Jh.WARNING,((r,a)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(a,r))),this.connection.on(Jh.PUBLISH_STREAM_STATUS,(r=>this.handlePublishStreamServer(r))),this.connection.on(Jh.REQUEST_NEW_ADDRESS,((r,a)=>{if(!this.connection)return a(new oe(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));zt(this,Sn.REQUEST_WORKER_MANAGER_LIST,t).then((s=>{this.uapResponse=s,r(s.addressList)})).catch(a)})),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(t){const i=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(i),a=t.reason;switch(t.code){case Nn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new oe(L.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return w.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,o);if(!this.isStartingStreamingTask)return;this.statusError.set(i,o)}case Nn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new oe(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,a);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,o)}case Nn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Nn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(tn(s=this.streamingTasks).call(s));for(const c of o)c.abortTask?c.abortTask():(w.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new oe(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then((()=>{w.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)})).catch((d=>{w.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,d)})));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const m3={name:"LiveStreaming",create:function(e){return new E3(e.joinInfo,e.websocketRetryConfig||ln,e.httpRetryConfig||ln)}};function g3(e){let t=Bj();return(function(i,r){let a=i.appId;a!==void 0&&(Ii(r,10),hp(r,a));let s=i.cid;s!==void 0&&(Ii(r,16),Ii(r,s));let o=i.cname;o!==void 0&&(Ii(r,26),hp(r,o));let c=i.deviceId;c!==void 0&&(Ii(r,34),hp(r,c));let d=i.elapse;d!==void 0&&(Ii(r,40),P_(r,d));let l=i.fileSize;l!==void 0&&(Ii(r,48),P_(r,Xg(l)));let h=i.height;h!==void 0&&(Ii(r,56),P_(r,Xg(h)));let _=i.jpg;_!==void 0&&(Ii(r,66),Ii(r,_.length),(function(fe,$){let ne=wE(fe,$.length);fe.bytes.set($,ne)})(r,_));let f=i.networkType;f!==void 0&&(Ii(r,72),P_(r,Xg(f)));let m=i.osType;m!==void 0&&(Ii(r,80),P_(r,Xg(m)));let S=i.requestId;S!==void 0&&(Ii(r,90),hp(r,S));let T=i.sdkVersion;T!==void 0&&(Ii(r,98),hp(r,T));let R=i.sequence;R!==void 0&&(Ii(r,104),P_(r,Xg(R)));let C=i.sid;C!==void 0&&(Ii(r,114),hp(r,C));let b=i.timestamp;b!==void 0&&(Ii(r,120),P_(r,b));let N=i.uid;N!==void 0&&(Ii(r,128),Ii(r,N));let k=i.vid;k!==void 0&&(Ii(r,136),Ii(r,k));let P=i.width;P!==void 0&&(Ii(r,144),P_(r,Xg(P)));let U=i.service;U!==void 0&&(Ii(r,152),Ii(r,U));let W=i.callbackData;W!==void 0&&(Ii(r,162),hp(r,W));let z=i.jpgEncryption;z!==void 0&&(Ii(r,168),Ii(r,z));let Q=i.requestType;Q!==void 0&&(Ii(r,176),Ii(r,Q));let he=i.scorePorn;he!==void 0&&(Ii(r,185),Ml(r,he));let Ge=i.scoreSexy;Ge!==void 0&&(Ii(r,193),Ml(r,Ge));let xe=i.scoreNeutral;xe!==void 0&&(Ii(r,201),Ml(r,xe));let qe=i.scene;qe!==void 0&&(Ii(r,208),Ii(r,qe));let ot=i.ossFilePrefix;ot!==void 0&&(Ii(r,218),hp(r,ot));let xt=i.serviceVendor;if(xt!==void 0)for(let fe of xt){Ii(r,226);let $=Bj();R3(fe,$),Ii(r,$.limit),jj(r,$),OV($)}})(e,t),(function(i){let r=i.bytes,a=i.limit;return r.length===a?r:r.subarray(0,a)})(t)}function S3(e){return(function(i){let r={};e:for(;!Jg(i);){let a=Ri(i);switch(a>>>3){case 0:break e;case 1:r.code=Ri(i);break;case 2:r.msg=nh(i,Ri(i));break;case 3:{let s=Vj(i);r.data=T3(i),i.limit=s;break}default:Fj(i,7&a)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function T3(e){let t={};e:for(;!Jg(e);){let i=Ri(e);switch(i>>>3){case 0:break e;case 1:t.requestId=nh(e,Ri(e));break;case 2:t.requestType=Ri(e)>>>0;break;case 3:t.scorePorn=TA(e);break;case 4:t.scoreSexy=TA(e);break;case 5:t.scoreNeutral=TA(e);break;case 6:t.requestScene=Ri(e)>>>0;break;case 7:t.scene=Ri(e)>>>0;break;default:Fj(e,7&i)}}return t}function R3(e,t){let i=e.service;i!==void 0&&(Ii(t,8),Ii(t,i));let r=e.vendor;r!==void 0&&(Ii(t,16),Ii(t,r));let a=e.token;a!==void 0&&(Ii(t,26),hp(t,a));let s=e.callbackUrl;s!==void 0&&(Ii(t,34),hp(t,s))}function Vj(e){let t=Ri(e),i=e.limit;return e.limit=e.offset+t,i}function Fj(e,t){switch(t){case 0:for(;128&NV(e););break;case 2:J0(e,Ri(e));break;case 5:J0(e,4);break;case 1:J0(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let IV=new Float32Array(1);new Uint8Array(IV.buffer);let qs=new Float64Array(1),Qa=new Uint8Array(qs.buffer);function Xg(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let wV=[];function Bj(){const e=wV.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function OV(e){wV.push(e)}function J0(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Jg(e){return e.offset>=e.limit}function wE(e,t){let i=e.bytes,r=e.offset,a=e.limit,s=r+t;if(s>i.length){let o=new Uint8Array(2*s);o.set(i),e.bytes=o}return e.offset=s,s>a&&(e.limit=s),r}function Z0(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function nh(e,t){let i=Z0(e,t),r=String.fromCharCode,a=e.bytes,s="�",o="";for(let c=0;c<t;c++){let d,l,h,_,f=a[c+i];(128&f)==0?o+=r(f):(224&f)==192?c+1>=t?o+=s:(d=a[c+i+1],(192&d)!=128?o+=s:(_=(31&f)<<6|63&d,_<128?o+=s:(o+=r(_),c++))):(240&f)==224?c+2>=t?o+=s:(d=a[c+i+1],l=a[c+i+2],(49344&(d|l<<8))!=32896?o+=s:(_=(15&f)<<12|(63&d)<<6|63&l,_<2048||_>=55296&&_<=57343?o+=s:(o+=r(_),c+=2))):(248&f)==240?c+3>=t?o+=s:(d=a[c+i+1],l=a[c+i+2],h=a[c+i+3],(12632256&(d|l<<8|h<<16))!=8421504?o+=s:(_=(7&f)<<18|(63&d)<<12|(63&l)<<6|63&h,_<65536||_>1114111?o+=s:(_-=65536,o+=r(55296+(_>>10),56320+(1023&_)),c+=3))):o+=s}return o}function hp(e,t){let i=t.length,r=0;for(let o=0;o<i;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<i&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}Ii(e,r);let a=wE(e,r),s=e.bytes;for(let o=0;o<i;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<i&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[a++]=c:(c<2048?s[a++]=c>>6&31|192:(c<65536?s[a++]=c>>12&15|224:(s[a++]=c>>18&7|240,s[a++]=c>>12&63|128),s[a++]=c>>6&63|128),s[a++]=63&c|128)}}function jj(e,t){let i=wE(e,t.limit),r=e.bytes,a=t.bytes;for(let s=0,o=t.limit;s<o;s++)r[s+i]=a[s]}function NV(e){return e.bytes[Z0(e,1)]}function Q0(e,t){let i=wE(e,1);e.bytes[i]=t}function TA(e){let t=Z0(e,8),i=e.bytes;return Qa[0]=i[t++],Qa[1]=i[t++],Qa[2]=i[t++],Qa[3]=i[t++],Qa[4]=i[t++],Qa[5]=i[t++],Qa[6]=i[t++],Qa[7]=i[t++],qs[0]}function Ml(e,t){let i=wE(e,8),r=e.bytes;qs[0]=t,r[i++]=Qa[0],r[i++]=Qa[1],r[i++]=Qa[2],r[i++]=Qa[3],r[i++]=Qa[4],r[i++]=Qa[5],r[i++]=Qa[6],r[i++]=Qa[7]}function Ri(e){let t,i=0,r=0;do t=NV(e),i<32&&(r|=(127&t)<<i),i+=7;while(128&t);return r}function Ii(e,t){for(t>>>=0;t>=128;)Q0(e,127&t|128),t>>>=7;Q0(e,t)}function P_(e,t){let i=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,s=a===0?r===0?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:a<128?9:10,o=wE(e,s),c=e.bytes;switch(s){case 10:c[o+9]=a>>>7&1;case 9:c[o+8]=s!==9?128|a:127&a;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?i>>>21|128:i>>>21&127;case 3:c[o+2]=s!==3?i>>>14|128:i>>>14&127;case 2:c[o+1]=s!==2?i>>>7|128:i>>>7&127;case 1:c[o]=s!==1?128|i:127&i}}function Gj(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}const v3=new Map([["moderation",1],["supervise",2]]);class y3 extends or{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const i=this._connectionState;this._connectionState=t,this.emit($n.CONNECTION_STATE_CHANGE,i,t)}get inspectType(){return this._inspectType}set inspectType(t){var i;this._inspectMode=Pn(i=t.map((r=>v3.get(r)||0))).call(i,((r,a)=>r+a)),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(t){super(),V(this,"name","AgoraRTCVideoContentInspect"),V(this,"_connectionState",ba.CONNECTING),V(this,"_innerConnectionState",void 0),V(this,"sequence",0),V(this,"inspectStartTime",void 0),V(this,"workerManagerConnection",void 0),V(this,"workerConnection",void 0),V(this,"workerMessageLengthLimit",void 0),V(this,"inspectIntervalMinimum",void 0),V(this,"qualityRatio",void 0),V(this,"_connectInfo",void 0),V(this,"_cancelTokenSource",co.CancelToken.source()),V(this,"_retryConfig",void 0),V(this,"wmSequence",0),V(this,"inspectInterval",void 0),V(this,"inspectTimer",null),V(this,"ossFilePrefix",void 0),V(this,"extraInfo",void 0),V(this,"_inspectType",void 0),V(this,"_inspectMode",void 0),V(this,"_quality",1),V(this,"qualityTimer",null),V(this,"_inspectId",void 0),V(this,"_needWorkUrlOnly",!1),V(this,"inspectImage",(()=>{if(this.connectionState!==ba.CONNECTED)throw new oe(L.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===ba.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=Mi(5,"inspect-"),this.workerMessageLengthLimit=G("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=G("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=G("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Mb("worker-manager-"+this._inspectId,ln),this.on($n.STATE_CHANGE,((i,r)=>{this._innerConnectionState=i,w.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Lr[i]," ").concat(r||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new Mb("worker-"+this._inspectId,ln),this.handleWorkerEvents()}async init(t,i){this.emit($n.STATE_CHANGE,Lr.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=i,new se(((a,s)=>{this.on($n.CONNECTION_STATE_CHANGE,((o,c)=>{c===ba.CONNECTED&&a()})),this.requestAP(t,r,i).then((o=>{this.connectWorkerManager(o)})).catch((o=>{s(o)}))}))}async requestAP(t,i,r){const a=G("WEBCS_DOMAIN").map((c=>"https://".concat(c,"/api/v1"))),s=await(function(c,d,l,h){let{appId:_,areaCode:f,cname:m,sid:S,token:T,uid:R}=d;Xu++;const C="image_moderation_api",b={service_name:C,json_body:JSON.stringify({appId:_,areaCode:f,cname:m,command:"allocateEdge",requestId:Xu,seq:Xu,sid:S,token:T,ts:Date.now(),uid:R+""})};let N,k,P=c[0];return Vc((async()=>{N=Date.now();const U=await Sc(P,{data:b,cancelToken:l,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(k=Date.now()-N,U.code!==0){const he=new oe(L.UNEXPECTED_RESPONSE,"image inspect ap error, code"+U.code,{retry:!0,responseTime:k});throw w.error(he.toString()),he}const W=JSON.parse(U.json_body);if(W.code!==200){const he=new oe(L.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(W.code,", reason: ").concat(W.reason),{code:W.code,responseTime:k});throw w.error(he.toString()),he}if(!W.servers||!Array.isArray(W.servers)||W.servers.length===0){const he=new oe(L.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:W.code,responseTime:k});throw w.error(he.toString()),he}const z=G("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Q=G("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:W.servers.map((he=>{let{address:Ge,wss:xe}=he;if(Ge&&xe)return"wss://".concat(Ge.replace(/\./g,"-"),".").concat(z,":").concat(Q||xe)})).filter((he=>!!he)),workerToken:W.workerToken,vid:W.vid,responseTime:k}}),((U,W)=>(J.apworkerEvent(S,{success:!0,sc:200,serviceName:C,responseDetail:JSON.stringify(U.addressList),firstSuccess:W===0,responseTime:k,serverIp:c[W%c.length]}),!1)),((U,W)=>(J.apworkerEvent(S,{success:!1,sc:U.data&&U.data.code||200,serviceName:C,responseTime:k,serverIp:c[W%c.length]}),!!(U.code!==L.OPERATION_ABORTED&&U.code!==L.UNEXPECTED_RESPONSE||U.data&&U.data.retry)&&(P=c[(W+1)%c.length],!0))),h)})(a,t,i,r);this.emit($n.STATE_CHANGE,Lr.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit($n.STATE_CHANGE,Lr.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Pt.CONNECTED,(async()=>{this.emit($n.STATE_CHANGE,Lr.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Pt.CLOSED,(()=>{this._innerConnectionState<Lr.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(Pt.FAILED,(()=>{this._innerConnectionState<Lr.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(Pt.RECONNECTING,(()=>{this._innerConnectionState<Lr.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(Pt.ON_MESSAGE,(async t=>{this.emit($n.STATE_CHANGE,Lr.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw w.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new oe(L.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&i))throw w.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new oe(L.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const a=G("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=i.replace(/:\d+\/?$/,":".concat(a));this.emit($n.STATE_CHANGE,Lr.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit($n.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}})),this.workerManagerConnection.on(Pt.WILL_RECONNECT,((t,i,r)=>{r(t)})),this.workerManagerConnection.on(Pt.REQUEST_NEW_URLS,((t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)}))}handleWorkerEvents(){this.workerConnection.on(Pt.CONNECTED,(async()=>{this.emit($n.STATE_CHANGE,Lr.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ba.CONNECTED})),this.workerConnection.on(Pt.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const r=S3(new Uint8Array(t.data));if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&w.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit($n.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var i;const a={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=Pn(i=Object.keys(a)).call(i,((c,d)=>a[c]>a[d]?c:d),"porn"),o=Object.keys(a).find((c=>c===s));this.emit($n.INSPECT_RESULT,o)}else this.emit($n.INSPECT_RESULT,void 0,new oe(L.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit($n.INSPECT_RESULT,void 0,new oe(L.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else w.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit($n.INSPECT_RESULT,void 0,new oe(L.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(Pt.CLOSED,(()=>{this.connectionState=ba.CLOSED})),this.workerConnection.on(Pt.FAILED,(()=>{this.connectionState=ba.CLOSED})),this.workerConnection.on(Pt.RECONNECTING,(()=>{this.connectionState=this.connectionState===ba.CONNECTED?ba.RECONNECTING:ba.CONNECTING})),this.workerConnection.on(Pt.WILL_RECONNECT,((t,i,r)=>{t==="recover"&&r(t),r("tryNext")})),this.workerConnection.on(Pt.REQUEST_NEW_URLS,((t,i)=>{this.workerManagerConnection.close(),this.once($n.REQUEST_NEW_WORKER_URL,(r=>{t([r])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((r=>{this.connectWorkerManager(r,!0)})).catch((r=>{i(r)}))}))}async requestToInspectImage(){this.sequence++;const t=Bs(this,$n.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit($n.INSPECT_RESULT,void 0,new oe(L.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,i);this.workerConnection.sendMessage(r,!0,!0)}else this.emit($n.INSPECT_RESULT,void 0,new oe(L.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,i){let{appId:r,cname:a,cid:s,vid:o,sid:c,uid:d}=i;const l=Date.now(),h=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await OO(h,r,a),f=this.sequence+"-"+s+"-"+d+"-"+l+"-"+Mi(12,""),m={appId:r,cid:s,cname:a,deviceId:"",elapse:(S=Number(l-this.inspectStartTime),{low:S|=0,high:S>>31,unsigned:S>=0}),fileSize:_.byteLength,jpgEncryption:2,height:h.height,width:h.width,jpg:_,networkType:6,osType:7,requestId:f,sdkVersion:"4.24.0",sequence:this.sequence,sid:c,timestamp:mx(l),uid:d,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var S;this.extraInfo===void 0&&delete m.callbackData,this.ossFilePrefix===void 0&&delete m.ossFilePrefix;const T=g3(m);if(T.byteLength<this.workerMessageLengthLimit){if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const R=(function(C){for(var b=1;b<arguments.length;b++){var N=arguments[b]!=null?arguments[b]:{};b%2?Gj(Object(N),!0).forEach((function(k){V(C,k,N[k])})):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(N)):Gj(Object(N)).forEach((function(k){Object.defineProperty(C,k,Object.getOwnPropertyDescriptor(N,k))}))}return C})({},m);delete R.jpg,w.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(R))}return T}{const R=this.quality*this.qualityRatio;return this.quality=R,await this.generateRequestData(t,{appId:r,cname:a,cid:s,vid:o,sid:c,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=co.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ba.CLOSED,this.emit($n.STATE_CHANGE,Lr.CLOSED)}}const Wj={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(i){if(!i)throw new oe(L.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new oe(L.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(i.inspectType)];r.forEach((a=>{var s;if(!ee(s=["supervise","moderation"]).call(s,a))throw new oe(L.INVALID_PARAMS,"".concat(a," is not a valid inspect type."))})),i.inspectType=r}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new oe(L.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new y3(t)}};var Hj=X(bn.Object.getOwnPropertySymbols),C3=dt,b3=Kl.indexOf,DV=Zd,$0=ha([].indexOf),Kj=!!$0&&1/$0([1],1,-0)<0;C3({target:"Array",proto:!0,forced:Kj||!DV("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Kj?$0(this,e,t)||0:b3(this,e,t)}});var A3=Bn("Array","indexOf"),I3=Be,PV=A3,LV=Array.prototype,Yj=function(e){var t=e.indexOf;return e===LV||I3(LV,e)&&t===LV.indexOf?PV:t},zj=X(Yj);function qj(e,t){if(e==null)return{};var i,r,a=(function(o,c){if(o==null)return{};var d={};for(var l in o)if({}.hasOwnProperty.call(o,l)){if(zj(c).call(c,l)!==-1)continue;d[l]=o[l]}return d})(e,t);if(Hj){var s=Hj(e);for(r=0;r<s.length;r++)i=s[r],zj(t).call(t,i)===-1&&{}.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}let Xj=class{get localCapabilities(){return qi(this._localCapabilities)}get rtpCapabilities(){return qi(this._rtpCapabilities)}get candidates(){return qi(this._candidates)}get iceParameters(){return qi(this._iceParameters)}get dtlsParameters(){return qi(this._dtlsParameters)}constructor(e){V(this,"sessionDesc",void 0),V(this,"_localCapabilities",void 0),V(this,"_rtpCapabilities",void 0),V(this,"_candidates",void 0),V(this,"_iceParameters",void 0),V(this,"_dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname","o/i14u9pJrxRKAsu"),V(this,"firefoxSsrcMidMap",new Map),e=qi(e);const{remoteIceParameters:t,remoteDtlsParameters:i,candidates:r,remoteRTPCapabilities:a,localCapabilities:s,direction:o,setup:c,videoCodec:d,audioCodec:l}=e;let h;this.setup=c,h=o===_t.RECEIVE_ONLY?ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=a,this._candidates=r,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=s;const _=o===_t.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,f=o===_t.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,m=o===_t.RECEIVE_ONLY?a.send.videoCodecs:Al(Me.VIDEO,_,f,d),S=o===_t.RECEIVE_ONLY?a.send.audioCodecs:Al(Me.AUDIO,_,f,l);for(const T of h.mediaDescriptions)T.attributes.iceUfrag=t.iceUfrag,T.attributes.icePwd=t.icePwd,T.attributes.fingerprints=i.fingerprints,T.attributes.candidates=r,T.attributes.setup=this.setup,T.media.mediaType==="application"&&(T.attributes.sctpPort="5000"),T.media.mediaType==="video"&&(T.media.fmts=m.map((R=>R.payloadType.toString(10))),T.attributes.payloads=m,T.attributes.extmaps=_.videoExtensions),T.media.mediaType==="audio"&&(T.media.fmts=S.map((R=>R.payloadType.toString(10))),T.attributes.payloads=S,T.attributes.extmaps=_.audioExtensions,tp(T));this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1}toString(){return aE(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((t=>this.hasMid(t))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,i,r,a){i=i.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=ep(t,this.cname,G("SYNC_GROUP")?i:void 0),c=this.findPreloadMediaDesc(s);if(c){if(Ci()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),a&&(a.twcc||a.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(c,a),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(e,s,r);let l;return d===-1?(l=this.createOrRecycleSendMedia(e,s,o,"sendonly",r,a),this.updateBundleMids()):(l=qi(this.sessionDesc.mediaDescriptions[d]),l.attributes.direction="sendonly",l.attributes.ssrcs=s,l.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,a)),Ci()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),{needExchangeSDP:!0,mid:l.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((i=>{i.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,i){const r=[];return e.forEach((a=>{const s=a._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let c,d=!1;o===-1?(d=!0,c=this.createOrRecycleRecvMedia(a,[],"recvonly",t,i),this.updateBundleMids()):(c=qi(this.sessionDesc.mediaDescriptions[o]),c.attributes.direction="recvonly"),r.push({mid:c.attributes.mid,needCreateTransceiver:d})})),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((i=>e.indexOf(i.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((i=>{i.media.port="0",i.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:i,address:r,port:a,type:s,relatedAddress:o,relatedPort:c,priority:d}=new RTCIceCandidate(e),l={foundation:t??"",componentId:"1",transport:i??"",priority:d?d+"":"",connectionAddress:r??"",port:a?a+"":"",type:s?s+"":"",relAddr:o??"",relPort:c?c+"":"",extension:{}};this.candidates.some((h=>h.priority===l.priority&&h.connectionAddress===l.connectionAddress&&h.port===l.port))||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach((h=>{h.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,i,r,a){const s=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=Al(s,o,this.localCapabilities.send,s===Me.AUDIO?a:r),d=s===Me.VIDEO?o.videoExtensions:o.audioExtensions,l="".concat(++this.currentMidIndex);let h={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((f=>f.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};h=this.mungRecvMediaDsec(h,e);const _=this.findFirstClosedMedia(s);if(_){const f=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[f]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((i=>ee(e).call(e,i.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((i=>{i.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((i=>ee(e).call(e,i.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((i=>{i.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,i){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const a=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Ci()){if(a){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return a&&r.attributes.mid===i}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const i=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&i}))}predictReceivingMids(e){const t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}restartICE(e){e=qi(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,i,r,a,s){const o=this.rtpCapabilities.send,c=e===Me.VIDEO?o.videoCodecs:o.audioCodecs,d=e===Me.VIDEO?o.videoExtensions:o.audioExtensions;Ci()&&(a="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((_=>_.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:a}};l=this.mungSendMediaDesc(l,s);const h=this.findFirstClosedMedia(e);if(h){const _=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[_]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,i){const r=qi(e);return jb(r),pE(r,t),zO(r,t),Gb(r),Wb(r,i,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const i=qi(e);return Wb(i,t,this.localCapabilities.recv),tp(i),i}updateRecvMedia(e,t){const i=this.sessionDesc.mediaDescriptions.findIndex((r=>r.attributes.mid===e));if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>e.media.port!=="0")).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>Ci()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0"))}};const lr=["sdp"];var nr;function L_(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function k_(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?L_(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):L_(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}let Gd=(nr=class iN extends RU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,i,r){super(t,i),V(this,"direction",void 0),V(this,"name",void 0),V(this,"store",void 0),V(this,"spec",void 0),V(this,"peerConnection",void 0),V(this,"initialOffer",void 0),V(this,"transport",void 0),V(this,"statsFilter",void 0),V(this,"localCandidateCount",0),V(this,"_isInRestartIce",!1),V(this,"mutex",void 0),V(this,"onLocalCandidate",void 0),V(this,"remoteSDP",void 0),V(this,"pendingCandidates",[]),V(this,"localCapabilities",void 0),V(this,"isReady",!1),V(this,"restartCnt",0),V(this,"curTurnServerIndex",0),this.store=i,this.spec=t,this.mutex=new Wn("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(iN.resolvePCConfiguration(t,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??_t.SEND_ONLY,this.name=this.direction===_t.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=mO(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Ci()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const i=await OU();if(this.localCapabilities=f_(i),t){const{sdp:r}=t,a=qj(t,lr),s=(function(){const h={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=bl(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ec(_,h,"videoExtensions",f,m,S),Ec(_,h,"videoCodecs",f,m,S),Ec(_,h,"audioExtensions",f,m,S),Ec(_,h,"audioCodecs",f,m,S),G("RAISE_H264_BASELINE_PRIORITY")){const T=S.videoCodecs.findIndex((R=>R.rtpMap&&R.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&R.fmtp&&R.fmtp.parameters["profile-level-id"]==="42001f"));if(T!==-1){const R=S.videoCodecs.findIndex((C=>C.rtpMap&&C.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(R<T){w.debug("raising H264 baseline profile priority");const C=S.videoCodecs[T];S.videoCodecs.splice(T,1),S.videoCodecs.splice(R,0,C)}R!==-1&&G("FILTER_SEND_H264_BASELINE")&&(f.videoCodecs=f.videoCodecs.filter((C=>!(C.rtpMap&&C.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&C.fmtp&&C.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:f,recv:m,sendrecv:S}})({},{},r);this.remoteSDP=new Xj({remoteIceParameters:a.iceParameters,remoteDtlsParameters:a.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=__(o.sdp);await this.peerConnection.setLocalDescription(o);const d=await Ld({},{},o.sdp);this.localCapabilities=f_(d);const l=this.peerConnection.getTransceivers()[0];return l!=null&&l.receiver&&l.receiver.transport&&this.tryBindTransportEvents(l.receiver.transport),k_(k_({},c),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=__(r.sdp);return this.initialOffer=r,k_(k_({},a),{},{sdp:r.sdp})}}catch(i){throw new _e(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:r,dtlsParameters:a}=t,s=await Ld({},{},i);this.remoteSDP=new Xj({remoteIceParameters:r,remoteDtlsParameters:a,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((i=>{this.peerConnection.addIceCandidate(i)})),this.pendingCandidates=[])}catch(i){throw new _e(L.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(t,i,r){var a=this;return oo((function*(){const s=yield hi(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=a.remoteSDP.receive(t,i,r);t.forEach(((R,C)=>{if(c[C].needCreateTransceiver){const b=a.peerConnection.addTransceiver(R._mediaStreamTrack,{direction:"sendonly"});o.push(b),R._updateRtpTransceiver(b)}else{const b=a.peerConnection.getTransceivers().find((N=>N.mid===c[C].mid));if(!b)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[C].mid));o.push(b),R._updateRtpTransceiver(b)}})),Ci()&&G("SIMULCAST")===!0&&(yield hi(a.applySimulcastForFirefox(o,t)));const d=c.map((R=>R.mid)),l=yield hi(a.peerConnection.createOffer()),h=a.mungSendOfferSDP(l.sdp,t,d),_=ya(h),f=d.map((R=>{const C=_.mediaDescriptions.find((b=>b.attributes.mid===R));if(!C)throw new Error("Cannot extract ssrc from mediaDescription.");return AU(C,G("USE_PUB_RTX"))})),m=o.map(((R,C)=>{const b=d[C];return{localSSRC:f[C],id:b}}));yield hi(a.peerConnection.setLocalDescription({type:"offer",sdp:h}));try{yield m}catch(R){const C=a.remoteSDP.toString();throw yield hi(a.peerConnection.setLocalDescription({type:"offer",sdp:h})),yield hi(a.peerConnection.setRemoteDescription({type:"answer",sdp:C})),yield hi(a.stopSending(d,!0)),R}yield hi(a.applySimulcastEncodings(o,t)),yield hi(a.applySendEncodings(o,t));const S=a.remoteSDP.toString(),T=a.logSDPExchange(h,"offer","local","send");return T?.(S),yield hi(a.setRemoteDescription({type:"answer",sdp:S})),o.map(((R,C)=>{const b=d[C];return{localSSRC:f[C],id:b}}))}catch(o){throw o instanceof _e?o:new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}}))()}async stopSending(t,i){const r=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter((d=>t.indexOf(d.mid)!==-1));if(a.length!==t.length)throw new Error("Transceivers' length (".concat(a.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));a.map((d=>{var l;d.direction="inactive",(l=d.stop)===null||l===void 0||l.call(d)}));const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(a){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{r&&r()}}async receive(t,i,r,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,i,r,a);if(o){const d=this.remoteSDP.toString(),l=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(h.sdp,s,t);l?.(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find((d=>d.mid===s));if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,i,r,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,i,r,a);if(o){const c=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const l=await this.peerConnection.createAnswer(),h=this.mungReceiveAnswerSDP(l.sdp,s,t);d?.(h||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:h}),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const a=await this.peerConnection.createAnswer();r?.(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===wn.Auto&&(this.store.p2pTransport=wn.SdRtn,Si().supportPCSetConfiguration&&this.peerConnection.setConfiguration(iN.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Si().supportPCSetConfiguration&&this.peerConnection.setConfiguration(iN.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=__(i.sdp);return this.store.descriptionStart(),this.direction===_t.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===_t.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=__(i.sdp);return await this.peerConnection.setLocalDescription(i),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new _e(L.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){const r=this.peerConnection.getTransceivers().filter((a=>a.mid===t));r.length===1&&(this.isVP8Simulcast(i)?Ci()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){const r=this.peerConnection.getTransceivers().find((a=>a.mid===i));r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const i=t[0].transport.iceTransport,{local:r,remote:a}=i.getSelectedCandidatePair();return{local:k_(k_({},Fc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:k_(k_({},Fc),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,i;ee(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var i;t.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a={iceServers:[]};var s;return t.iceServers?a.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qT(t.turnServer.servers)?a.iceServers=t.turnServer.servers:(a.iceServers&&a.iceServers.push(...iN.turnServerConfigToIceServers(t.turnServer.servers,i,r)),G("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&t.turnServer.serversFromGateway&&a.iceServers.push(...iN.turnServerConfigToIceServers(t.turnServer.serversFromGateway,i,r)),ee(s=[wn.Relay,wn.SdRtn]).call(s,i)&&(a.iceTransportPolicy="relay"),G("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((o=>{o.forceturn&&(a.iceTransportPolicy="relay")})))),G("ENABLE_ENCODED_TRANSFORM")&&Si().supportWebRTCEncodedTransform&&(a.encodedInsertableStreams=!0),w.debug("P2PConnection p2pTransport is ".concat(i)),a}static turnServerConfigToIceServers(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a=[],s=t.filter((c=>c.tcpport));w.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const o=s.length>r?s[r]:s[0];switch(i){case wn.SdRtn:const c=t.filter((l=>{var h;return ee(h=l.username).call(h,"glb:")&&l.turnServerURL==l.turnServerURL})),d=c.length>r?c[r]:c[0];d&&(a.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(zu(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),a.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(zu(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case wn.Relay:o&&(a.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),a.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(zu(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(a.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),a.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(zu(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),a.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return a}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in r?r.error:r)};const i=t.iceTransport;i&&(i.onstatechange=()=>{const r=t?.iceTransport.state;var a;r&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:a}=i.getSelectedCandidatePair()||{};if(r&&a){const s=r.address+":"+r.port,o=a.address+":"+a.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify($h(s)),", remote ").concat(JSON.stringify($h(o))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var r;if(i||(i=this.peerConnection.getSenders().find((h=>h.track===t._mediaStreamTrack))),!i)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Si().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},s={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(t._encoderConfig){var o;const{bitrateMax:h,frameRate:_,scaleResolutionDownBy:f}=t._encoderConfig;h&&(s.maxBitrate=1e3*h),ee(o=t._hints).call(o,Ui.LOW_STREAM)&&(_&&(s.maxFramerate=Bo(_)),f&&f>=1&&(s.scaleResolutionDownBy=f))}if(G("DSCP_TYPE")&&fl()){var c;const h=G("DSCP_TYPE");ee(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}const d=i.getParameters(),l=(r=d.encodings)===null||r===void 0?void 0:r[0];Ci()&&!l&&(a.encodings=[s]),l&&Object.assign(l,s),Object.assign(d,a),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await i.setParameters(d)}async applySendEncodings(t,i){try{if(!Si().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){const a=t[r],s=i[r];s instanceof Xi&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,a.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,r){const a=ya(t);return i.forEach(((s,o)=>{const c=r[o],d=a.mediaDescriptions.find((l=>l.attributes.mid===c));d&&(pE(d,s),wU(d,s,this.store.codec))})),aE(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var r,a,s,o,c;const l=t[d],h=i[d];if(h instanceof Xi&&!ee(r=h._hints).call(r,Ui.LOW_STREAM)&&(a=h._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((s=h._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=h._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=h._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},f={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:f.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:f.high}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,_))}}}async applySimulcastEncodings(t,i){if(!Ci()&&t.length===i.length)for(let r=0;r<t.length;r++){const a=i[r];if(a instanceof Xi&&this.isVP8Simulcast(a)){const s=t[r],o={},c={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,o))}}}isVP8Simulcast(t){var i,r,a,s,o;return!!(t instanceof Xi&&G("SIMULCAST")&&this.store.codec==="vp8"&&!ee(i=t._hints).call(i,Ui.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,i,r,a){if(G("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(i," SDP during P2PConnection.").concat(a,`
`),t),i==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",a)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map((o=>{o.direction="inactive"}));const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();a?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map((async o=>{o.direction="sendonly"}));const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();a?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(t,i){var r;if(i=i??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var a;const s=(a=ya(i).mediaDescriptions.find((o=>o.attributes.mid===t)))===null||a===void 0?void 0:a.attributes.ssrcs;return s?.[0].ssrcId}}async setRemoteDescription(t){var i;await this.peerConnection.setRemoteDescription(t),ee(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,i,r){const a=ya(t),s=a.mediaDescriptions.find((o=>o.attributes.mid===i));return s&&r===Me.AUDIO&&s.media.mediaType==="audio"&&tp(s),aE(a)}},Ze(nr.prototype,"establish",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"establish"),nr.prototype),Ze(nr.prototype,"connect",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"connect"),nr.prototype),Ze(nr.prototype,"receive",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"receive"),nr.prototype),Ze(nr.prototype,"mockReceive",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"mockReceive"),nr.prototype),Ze(nr.prototype,"stopReceiving",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"stopReceiving"),nr.prototype),Ze(nr.prototype,"restartICE",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"restartICE"),nr.prototype),Ze(nr.prototype,"close",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"close"),nr.prototype),Ze(nr.prototype,"updateEncoderConfig",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"updateEncoderConfig"),nr.prototype),Ze(nr.prototype,"updateSendParameters",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"updateSendParameters"),nr.prototype),Ze(nr.prototype,"replaceTrack",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"replaceTrack"),nr.prototype),Ze(nr.prototype,"muteLocal",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"muteLocal"),nr.prototype),Ze(nr.prototype,"unmuteLocal",[Ga],Object.getOwnPropertyDescriptor(nr.prototype,"unmuteLocal"),nr.prototype),nr);function Ga(e,t,i){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const a=this.mutex,s=await a.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await r.apply(this,c)}finally{s()}},i}let Ul=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var kV,MV,UV,xV,VV,FV,BV,jV,GV,WV,Cr,br;function RA(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function eN(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?RA(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):RA(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}let ah=(kV=fo(Ul.SEND_ONLY),MV=fo(Ul.SEND_ONLY),UV=fo(),xV=fo(Ul.RECEIVE_ONLY),VV=fo(Ul.RECEIVE_ONLY),FV=fo(Ul.RECEIVE_ONLY),BV=fo(Ul.RECEIVE_ONLY),jV=fo(Ul.RECEIVE_ONLY),GV=fo(Ul.RECEIVE_ONLY),WV=fo(),Cr=fo(Ul.RECEIVE_ONLY),br=class extends or{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(it.StateChange,t,this._state)}constructor(e,t){super(),V(this,"isPlanB",!1),V(this,"store",void 0),V(this,"statsUploader",void 0),V(this,"sendConnection",void 0),V(this,"recvConnection",void 0),V(this,"localTrackMap",new Map),V(this,"remoteUserMap",new Map),V(this,"localDataChannels",[]),V(this,"pendingLocalTracks",[]),V(this,"pendingRemoteTracks",[]),V(this,"statsCollector",void 0),V(this,"dtlsFailedCount",0),V(this,"sendMutex",void 0),V(this,"recvMutex",void 0),V(this,"_state",Ue.Disconnected),V(this,"_restartStates",["disconnected","failed"]),V(this,"reconnectInterval",void 0),V(this,"uploadUnplinkStarted",!1),V(this,"uploadDownlinkStarted",!1),V(this,"uplinkStateUploadInterval",void 0),V(this,"downlinkStatsUploadInterval",void 0),V(this,"handleMuteLocalTrack",(async(i,r,a)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ue.Connected)return void a(new _e(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(i);if(d.length===0)return void r();const l=d.find((m=>m[0]==="videoLowTrack"));l&&l[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map((m=>{let[,{id:S}]=m;return S})));let h=!1;var o,c;i.trackMediaType==="video"?h=!((o=this.localTrackMap.get(Ee.LocalAudioTrack))===null||o===void 0||!o.track._muted):h=((c=this.localTrackMap.get(Ee.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;const _=this.createMuteMessage(d);await fi(this,it.RequestMuteLocal,_);const f=i.trackMediaType==="video"?hE.MUTE_LOCAL_VIDEO:hE.MUTE_LOCAL_AUDIO;await fi(this,it.RequestP2PMuteLocal,{action:f,message:_,isMuteAll:h}),r()}catch(d){a(d)}finally{s()}})),V(this,"handleUnmuteLocalTrack",(async(i,r,a)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ue.Connected)return void a(new _e(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(i);if(o.length===0)return void r();await this.sendConnection.unmuteLocal(o.map((l=>{let[,{id:h}]=l;return h})));const c=this.createUnmuteMessage(o),d=i.trackMediaType==="video"?hE.UNMUTE_LOCAL_VIDEO:hE.UNMUTE_LOCAL_AUDIO;await fi(this,it.RequestP2PMuteLocal,{action:d,message:c}),r()}catch(o){a(o)}finally{s()}})),V(this,"handleUpdateVideoEncoder",(async(i,r,a,s)=>{let o;typeof s=="boolean"&&s||(o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(Ee.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==i||this.state!==Ue.Connected)return void r();const{id:l,track:h}=d;l&&(await this.sendConnection.updateSendParameters(l,h),await this.sendConnection.updateEncoderConfig(l,h),this.emit(it.UpdateVideoEncoder,h)),r()}catch(d){a(d)}finally{var c;(c=o)===null||c===void 0||c()}})),V(this,"handleUpdateVideoSendParameters",(async(i,r,a)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Ee.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==i||this.state!==Ue.Connected)return void r();const{id:c,track:d}=o;c&&await this.sendConnection.updateSendParameters(c,d),r()}catch(o){a(o)}finally{s()}})),V(this,"handleReplaceTrack",(async(i,r,a,s)=>{let o;w.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;const l=Array.from(this.localTrackMap.entries()).find((h=>{let[,{track:_}]=h;return i===_}));if(!this.sendConnection||!l||l[1].id===void 0||this.state!==Ue.Connected)return void r();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(i,l[1].id)),l[0]===Ee.LocalVideoTrack&&Si().supportDualStreamEncoding){const h=this.localTrackMap.get(Ee.LocalVideoLowTrack);if(h){const _=i._mediaStreamTrack.clone();h.track._originMediaStreamTrack.stop(),h.track._mediaStreamTrack=_,h.track._originMediaStreamTrack=_,await new se(((f,m)=>{this.handleReplaceTrack(h.track,f,m,!0)}))}}r()}catch(l){a(l)}finally{var d;(d=o)===null||d===void 0||d()}})),V(this,"handleGetLocalVideoStats",(i=>{i(this.statsCollector.getLocalVideoTrackStats())})),V(this,"handleGetLocalAudioStats",(i=>{i(this.statsCollector.getLocalAudioTrackStats())})),V(this,"handleGetRemoteVideoStats",(i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid])),V(this,"handleGetRemoteAudioStats",(i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new sj(e),this.bindStatsUploaderEvents(),this.sendMutex=new Wn("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Wn("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))}))}),G("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new _e(L.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new _e(L.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let i;try{if(t){this.recvConnection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Gd(e,this.store,_t.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Ue.New,this.sendConnection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Gd(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new _e(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ue.Connected}async addRemoteCandidate(e,t){if(t===_t.RECEIVE_ONLY){if(!this.sendConnection)throw new _e(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new _e(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,i){var r=this;return oo((function*(){const a=yield hi(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Ue.Connected){r.throwIfTrackTypeNotMatch(e);const l=e.filter((h=>r.pendingLocalTracks.indexOf(h)===-1));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(l))}r.store.pubId=r.store.pubId+1,ja.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,i);if(s.length===0)return void(yield hi(r.tryToUnmuteAudio(e)));s.forEach((l=>{let{track:h,type:_}=l;const f=Date.now();r.store.publish(h.getTrackId(),_===Ee.LocalAudioTrack?"audio":"video",f)})),r.bindLocalTrackEvents(s);const o=yield hi(r.sendConnection.send(s.map((l=>{let{track:h}=l;return h})),r.store.codec,r.store.audioCodec)),c=(yield hi(o.next())).value,d=r.createGatewayPublishMessage(s,c);try{yield d}catch(l){throw o.throw(l),l?.code===L.WS_ABORT&&s.forEach((h=>{let{track:_}=h;r.pendingLocalTracks.indexOf(_)===-1&&r.pendingLocalTracks.push(_)})),r.unbindLocalTrackEvents(s),l}yield hi(o.next()),s.forEach((l=>{let{type:h}=l;r.statsCollector.addLocalStats(h)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,c),s.forEach((l=>{let{track:h,type:_}=l;const f=Date.now();r.store.publish(h.getTrackId(),_===Ee.LocalAudioTrack?"audio":"video",void 0,f)})),r.startUploadUplinkState()}finally{a()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==Ue.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((a=>!ee(e).call(e,a))));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const i=t.find((a=>a[0]==="videoLowTrack"));i&&i[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((a=>{let[,{id:s}]=a;return s}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((a=>{let[s,{track:o}]=a;return{type:s,track:o}}))),t.forEach((a=>{let[s]=a;this.statsCollector.removeLocalStats(s)})),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ue.Connected)return i&&i[1].track.close(),r;e.forEach((a=>{const s=this.pendingLocalTracks.indexOf(a);s!==-1&&this.pendingLocalTracks.splice(s,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],i=[];Array.from(this.localTrackMap.entries()).forEach((r=>{let[a,{track:s,ssrcs:o}]=r;const c={stream_type:ZU(s,a),ssrcs:o};s._muted||!s._enabled?t.push(c):i.push(c)})),t.length>0&&t.forEach((r=>{fi(this,it.RequestMuteLocal,[r])})),i.length>0&&i.forEach((r=>{fi(this,it.RequestUnmuteLocal,[r])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return oo((function*(){throw new _e(L.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(w.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await zt(this,it.RequestRePublish,this.pendingLocalTracks),this.emit(it.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new _e(L.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,i,r){var a;if(!this.recvConnection)throw new _e(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;const{track:s,mid:o,transceiver:c}=await this.recvConnection.receive(t,[{ssrcId:i}],String(e.uid),r);t===Me.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new fc(s,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new Wu(s,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const d=this.remoteUserMap.get(e);d?d.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const l=this.pendingRemoteTracks.findIndex((h=>{let{user:_,kind:f}=h;return _.uid===e.uid&&t===f}));l!==-1&&(this.pendingRemoteTracks.splice(l,1),this.emit(it.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,i,r){if(!this.recvConnection)throw new _e(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:i}],String(e.uid),r)}async unsubscribe(e,t,i){const r=this.pendingRemoteTracks.filter((s=>{let{user:o,kind:c}=s;return t!==void 0?o.uid===e.uid&&t===c:o.uid===e.uid}));if(r.forEach((s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)})),this.recvConnection||i||r.forEach((s=>{let{kind:o}=s;var c;if(o===Me.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(o===Me.VIDEO){var d;(d=e._videoTrack)===null||d===void 0||d._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const a=this.filterTobeUnSubscribedTracks(e,t);a.length!==0&&(await this.recvConnection.stopReceiving(a.map((s=>{let[,{id:o}]=s;return o}))),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach((s=>{let[o,{kind:c}]=s;var d,l;if(c===Me.VIDEO&&o._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===Me.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),i||((l=o._videoTrack)===null||l===void 0||l._destroy(),o._videoTrack=void 0);else if(c===Me.AUDIO){var h;this.unbindRemoteTrackEvents(o._audioTrack),!i&&((h=o._audioTrack)===null||h===void 0||h._destroy(),o._audioTrack=void 0)}})),a.forEach((s=>{let[,{kind:o}]=s;fi(this,it.RequestP2PMuteRemote,o)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((t=>{let[,i]=t;[Me.VIDEO,Me.AUDIO].forEach((r=>{i.has(r)?fi(this,it.RequestP2PUnmuteRemote,r):fi(this,it.RequestP2PMuteRemote,r)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new _e(L.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new _e(L.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new _e(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new _e(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Me.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||w.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Ee.LocalAudioTrack);if(t?.track instanceof xn){const i=t.track;return Array.from(this.localTrackMap.entries()).filter((r=>{let[a]=r;return a!==Ee.LocalAudioTrack})).filter((r=>{let[a]=r;return!(e&&a===Ee.LocalVideoLowTrack)})).map((r=>{let[,{track:a}]=r;return a})).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter((i=>{let[r]=i;return!(e&&r===Ee.LocalVideoLowTrack)})).map((i=>{let[,{track:r}]=i;return r}))}reportPublishEvent(e,t,i,r,a){if(e){const o=this.localTrackMap.get(Ee.LocalAudioTrack),c=r?this.localTrackMap.get(Ee.LocalVideoLowTrack):this.localTrackMap.get(Ee.LocalVideoTrack);J.publish(this.store.sessionId,{eventElapse:ja.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(Ui.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var s;i||(i=[]);const o=i.find((d=>d instanceof yr)),c=r?(s=this.localTrackMap.get(Ee.LocalVideoTrack))===null||s===void 0?void 0:s.track:i.find((d=>d instanceof Xi));J.publish(this.store.sessionId,{eventElapse:ja.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(Ui.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,r){const a=r===Me.VIDEO?i._videoSSRC:i._audioSSRC;a&&J.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Me.VIDEO,audio:r===Me.AUDIO,peerid:i.uid,subscribeRequestid:r===Me.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:ja.measureFromSubscribeStart(this.store.clientId,a)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Wn("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Wn("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ee.LocalAudioTrack);if(e?.track instanceof xn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((i=>{t.removeAudioTrack(i)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ue.Disconnected}getStats(e){var t,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ee.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ee.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Xi||t&&t.track instanceof yr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;const i=Array.from(Pi(t=this.remoteUserMap).call(t)).find((r=>r.uid===e));return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((i=>{let[r]=i;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(Ee.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=vt(e).call(e,((i,r)=>i.level-r.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(w.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ue.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[i,{track:r}]=e;switch(i){case Ee.LocalVideoTrack:ee(t=r._hints).call(t,Ui.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Ee.LocalAudioTrack:r instanceof xn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Ee.LocalVideoLowTrack:}})),this.emit(it.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,i]=e;Array.from(Pi(i).call(i)).forEach((r=>{this.setPendingRemoteMedia(t,r)})),this.emit(it.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),w.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const i of this.pendingRemoteTracks){const{user:r,kind:a}=i;if((e instanceof S_?e.uid:e)===r.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let i,r;if(e===_t.SEND_ONLY){if(!this.sendConnection)throw new _e(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new _e(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const a=await r.restartICE(t);return r.isInRestartIce=!1,a}{const a=await r.restartICE();if(a){const s=await zt(this,it.RequestP2PRestartICE,{direction:_t.RECEIVE_ONLY,iceParameter:a});await r.restartICE(s),r.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Ee.LocalVideoTrack),i=this.localTrackMap.get(Ee.LocalAudioTrack),r=e.videoSend.find((m=>{var S;return m.ssrc===(t==null||(S=t.ssrcs)===null||S===void 0?void 0:S[0].ssrcId)})),a=e.audioSend.find((m=>{var S;return m.ssrc===(i==null||(S=i.ssrcs)===null||S===void 0?void 0:S[0].ssrcId)}));if(!r||!a)return 1;const s=Bs(this,it.NeedSignalRTT),o=r?r.rttMs:void 0,c=a?a.rttMs:void 0,d=o&&c?(o+c)/2:o||c,l=(d&&s?(d+s)/2:d||s)||0,h=100*e.sendPacketLossRate*.7/50+.3*l/1500,_=h<.17?1:h<.36?2:h<.59?3:h<.1?4:5,f=t?.track;if(f&&f._encoderConfig&&f._hints.indexOf(Ui.SCREEN_TRACK)===-1){const m=f._encoderConfig.bitrateMax,S=e.bitrate.actualEncoded;if(m&&S){const T=(1e3*m-S)/(1e3*m);return dE[T<.15?0:T<.3?1:T<.45?2:T<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((i=>{let[r]=i;const a=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find((S=>S.ssrc===a)),c=e.videoRecv.find((S=>S.ssrc===s));if(!o&&!c)return void(t+=1);const d=Bs(this,it.NeedSignalRTT),l=e.rtt,h=(l&&d?(l+d)/2:l||d)||0,_=o?o.jitterMs:void 0,f=e.recvPacketLossRate;let m=.7*f*100/50+.3*h/1500;_&&(m=.6*f*100/50+.2*h/1500+.2*_/400),t+=m<.1?1:m<.17?2:m<.36?3:m<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new se(((t,i)=>{this.handleMuteLocalTrack(e,t,i)}))}filterTobePublishedTracks(e,t,i){const r=[],a=Si(),s=this.getAllTracks();e=i_(e=e.filter((d=>s.indexOf(d)===-1)));let o=!1,c=!1;for(const d of e){if(d instanceof Xi&&(this.localTrackMap.has(Ee.LocalVideoTrack)||o?new _e(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:Ee.LocalVideoTrack}),o=!0),t)){const l=this.getLowVideoTrack(d,i);r.push({track:l,type:Ee.LocalVideoLowTrack})}if(d instanceof yr){const l=this.localTrackMap.get(Ee.LocalAudioTrack);if(l){if(!(l.track instanceof xn))throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(c){const h=r.find((_=>{let{type:f}=_;return f===Ee.LocalAudioTrack}));if(!(h.track instanceof xn))throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d)}else{if(!a.webAudioMediaStreamDest||d instanceof xn||d._bypassWebAudio)r.push({track:d,type:Ee.LocalAudioTrack});else{const h=new xn;h.addAudioTrack(d),r.push({track:h,type:Ee.LocalAudioTrack})}c=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],i=this.getAllTracks();e=i_(e=e.filter((r=>i.indexOf(r)!==-1)));for(const r of e){if(r instanceof yr){const a=this.localTrackMap.get(Ee.LocalAudioTrack);if(!a)continue;a.track instanceof xn?(a.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),a.track.trackList.length===0&&(t.push([Ee.LocalAudioTrack,a]),a.track.close())):t.push([Ee.LocalAudioTrack,a])}if(r instanceof Xi){const a=this.localTrackMap.get(Ee.LocalVideoTrack);if(!a)continue;t.push([Ee.LocalVideoTrack,a]);const s=this.localTrackMap.get(Ee.LocalVideoLowTrack);s&&t.push([Ee.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach((t=>{let{track:i,type:r}=t;switch(r){case Ee.LocalVideoTrack:i.addListener(Oe.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Oe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Oe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Oe.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ee.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ee.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof xn?e.trackList.forEach((i=>{i.addListener(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Oe.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Oe.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Oe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[i,{track:r}]=t;return{track:r,type:i}}))),e.forEach((t=>{let{track:i,type:r}=t;switch(r){case Ee.LocalVideoTrack:i.off(Oe.GET_STATS,this.handleGetLocalVideoStats),i.off(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Oe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Oe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Oe.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ee.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ee.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof xn?e.trackList.forEach((t=>{t.off(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Oe.GET_STATS,this.handleGetLocalAudioStats),t.off(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Oe.GET_STATS,this.handleGetLocalAudioStats),e.off(Oe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Oe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Oe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Oe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Oe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Wu&&t.addListener(Oe.GET_STATS,(i=>{i(this.handleGetRemoteVideoStats(e))})),t instanceof fc&&t.addListener(Oe.GET_STATS,(i=>{i(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Oe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,i]=e;i.has(Me.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(Me.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((i,r)=>{var a;let s,{track:o,type:c}=i;switch(c){case Ee.LocalAudioTrack:s=Vt.Audio;break;case Ee.LocalVideoTrack:s=ee(a=o._hints).call(a,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High;break;case Ee.LocalVideoLowTrack:s=Vt.Low}return{kind:c===Ee.LocalAudioTrack?Me.AUDIO:Me.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:o.muted||!o.enabled}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var i;let r,[a,{track:s,ssrcs:o,id:c}]=t;switch(a){case Ee.LocalVideoTrack:r=ee(i=s._hints).call(i,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High;break;case Ee.LocalAudioTrack:r=Vt.Audio;break;case Ee.LocalVideoLowTrack:r=Vt.Low}return{stream_type:r,ssrcs:o,mid:c}}))}assignLocalTracks(e,t){e.forEach(((i,r)=>{let{track:a,type:s}=i;this.localTrackMap.set(s,{track:a,id:t[r].id,ssrcs:t[r].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[i]=t;this.localTrackMap.delete(i)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var i;w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(it.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ee(i=this._restartStates).call(i,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Ht(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),J.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tr.TRACER}).onSuccess(),this.emit(it.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;const r=Array.from(Pi(i=this.remoteUserMap).call(i)).find((s=>s._audioSSRC===t));var a;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(a=r.audioTrack)===null||a===void 0||a.emit(Gs.FIRST_FRAME_DECODED),J.firstRemoteFrame(this.store.sessionId,qt.FIRST_AUDIO_DECODE,vr.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:ja.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;const r=Array.from(Pi(i=this.remoteUserMap).call(i)).find((a=>a._audioSSRC===t));r&&J.firstRemoteFrame(this.store.sessionId,qt.FIRST_AUDIO_RECEIVED,vr.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:ja.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,r)=>{this.reportVideoFirstFrameDecoded(t,i,r)},e.onFirstVideoReceived=t=>{var i;const r=Array.from(Pi(i=this.remoteUserMap).call(i)).find((a=>a._videoSSRC===t));r&&J.firstRemoteFrame(this.store.sessionId,qt.FIRST_VIDEO_RECEIVED,vr.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:ja.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{const r=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&r===a||this.emit(it.ConnectionTypeChange,r),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xc(i))," -> ").concat(JSON.stringify(Xc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xc(i))," -> ").concat(JSON.stringify(Xc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(it.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===_t.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,w.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===_t.SEND_ONLY?this.restartICE(e):zt(this,it.RequestP2PRestartICE,{direction:_t.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const i=this.localTrackMap.get(Ee.LocalAudioTrack);if(e instanceof yr&&i?.track instanceof xn)return i.track.isActive||t.push([Ee.LocalAudioTrack,i]),t;const r=Array.from(this.localTrackMap.entries()).find((a=>{let[,{track:s}]=a;return e===s}));if(r&&(t.push(r),r[0]===Ee.LocalVideoTrack)){const a=this.localTrackMap.get(Ee.LocalVideoLowTrack);a&&t.push([Ee.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],i=this.localTrackMap.get(Ee.LocalAudioTrack);if(e instanceof yr&&i?.track instanceof xn)return i.track.isActive&&t.push([Ee.LocalAudioTrack,i]),t;const r=Array.from(this.localTrackMap.entries()).find((a=>{let[,{track:s}]=a;return e===s}));if(r)if(r[0]===Ee.LocalVideoTrack){t.push(r);const a=this.localTrackMap.get(Ee.LocalVideoLowTrack);a&&t.push([Ee.LocalVideoLowTrack,a])}else t.push(r);return t}createMuteMessage(e){return e.map((t=>{var i;let r,[a,{track:s,ssrcs:o,id:c}]=t;switch(a){case Ee.LocalAudioTrack:r=Vt.Audio;break;case Ee.LocalVideoTrack:r=ee(i=s._hints).call(i,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High;break;case Ee.LocalVideoLowTrack:r=Vt.Low}return{stream_type:r,ssrcs:o,mid:c}}))}createUnmuteMessage(e){return e.map((t=>{var i;let r,[a,{track:s,ssrcs:o,id:c}]=t;switch(a){case Ee.LocalAudioTrack:r=Vt.Audio;break;case Ee.LocalVideoTrack:r=ee(i=s._hints).call(i,Ui.SCREEN_TRACK)?Vt.Screen:Vt.High;break;case Ee.LocalVideoLowTrack:r=Vt.Low}return{stream_type:r,ssrcs:o,mid:c}}))}filterTobeUnSubscribedTracks(e,t){const i=[],r=this.remoteUserMap.get(e);if(!r)return i;if(t){const a=r.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(r.entries()).forEach((a=>{let[s,o]=a;i.push([e,{kind:s,id:o}])}));return i}createUnsubscribeMessage(e){const t=[];return e.forEach((i=>{let[r,{kind:a,id:s}]=i;switch(a){case Me.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Me.VIDEO,ssrcId:r._videoSSRC}));case Me.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Me.AUDIO,ssrcId:r._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((t=>{let[i,{kind:r}]=t;const a=this.remoteUserMap.get(i);a&&(a.delete(r),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ee.LocalVideoTrack),i=this.localTrackMap.get(Ee.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new se(((r,a)=>{this.handleUpdateVideoEncoder(t.track,r,a,!0)}))),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new se(((r,a)=>{this.handleUpdateVideoEncoder(i.track,r,a,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof yr){const i=this.filterTobeUnmutedTracks(e[t]);if(i.length===0)continue;const r=this.createUnmuteMessage(i);return void await fi(this,it.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(it.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(it.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ht(Od(this.dtlsFailedCount,ln)),this.emit(it.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ee.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof Xi))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof Xi)).length>1)throw new _e(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof yr)).length>1&&(e.some((t=>t instanceof yr&&t._bypassWebAudio))||!Si().webAudioMediaStreamDest))throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Xi&&this.pendingLocalTracks.some((i=>i instanceof Xi)))throw new _e(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof yr&&this.pendingLocalTracks.some((i=>i instanceof yr))&&(!Si().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((i=>i instanceof yr&&i._bypassWebAudio))))throw new _e(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const i=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Si().supportDualStreamEncoding,r=eN(eN({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=i?e._mediaStreamTrack.clone():o0(e,r);const s=Mi(8,"track-low-"),o=new Xi(a,eN(eN({},i&&{scaleResolutionDownBy:Qh(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(Sl.TRANSCEIVER_UPDATED,(c=>{e._updateRtpTransceiver(c,nR.LOW_STREAM)})),o._hints.push(Ui.LOW_STREAM),e.addListener(Oe.NEED_CLOSE,(()=>{o.close()})),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,i,r){var a;const s=Array.from(Pi(a=this.remoteUserMap).call(a)).find((o=>o._videoSSRC===e));if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find((d=>d.userId===s.uid&&d.type==="video"));J.firstRemoteVideoDecode(this.store.sessionId,qt.FIRST_VIDEO_DECODE,vr.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:i,subscribeElapse:ja.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const a=r.get(t);if(!a)return!1;const s=await this.recvConnection.getRemoteSSRC(a);return s!==void 0&&s!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new _e(L.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new _e(L.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new _e(L.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new _e(L.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new _e(L.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new _e(L.NOT_SUPPORTED)}async preConnect(e){throw new _e(L.NOT_SUPPORTED)}getEstablishParams(){throw new _e(L.NOT_SUPPORTED)}async reSubscribe(e){throw new _e(L.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new _e(L.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:i}]=e;t===Ee.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,nR.LOW_STREAM):i._updateRtpTransceiver(void 0)}))}},Ze(br.prototype,"p2pConnect",[kV],Object.getOwnPropertyDescriptor(br.prototype,"p2pConnect"),br.prototype),Ze(br.prototype,"unpublish",[MV],Object.getOwnPropertyDescriptor(br.prototype,"unpublish"),br.prototype),Ze(br.prototype,"unpublishLowStream",[UV],Object.getOwnPropertyDescriptor(br.prototype,"unpublishLowStream"),br.prototype),Ze(br.prototype,"subscribe",[xV],Object.getOwnPropertyDescriptor(br.prototype,"subscribe"),br.prototype),Ze(br.prototype,"mockSubscribe",[VV],Object.getOwnPropertyDescriptor(br.prototype,"mockSubscribe"),br.prototype),Ze(br.prototype,"unsubscribe",[FV],Object.getOwnPropertyDescriptor(br.prototype,"unsubscribe"),br.prototype),Ze(br.prototype,"muteRemote",[BV],Object.getOwnPropertyDescriptor(br.prototype,"muteRemote"),br.prototype),Ze(br.prototype,"unmuteRemote",[jV],Object.getOwnPropertyDescriptor(br.prototype,"unmuteRemote"),br.prototype),Ze(br.prototype,"hasRemoteMediaWithLock",[GV],Object.getOwnPropertyDescriptor(br.prototype,"hasRemoteMediaWithLock"),br.prototype),Ze(br.prototype,"disconnectForReconnect",[WV],Object.getOwnPropertyDescriptor(br.prototype,"disconnectForReconnect"),br.prototype),Ze(br.prototype,"remoteMediaSsrcChanged",[Cr],Object.getOwnPropertyDescriptor(br.prototype,"remoteMediaSsrcChanged"),br.prototype),br);function fo(e){return function(t,i,r){const a=t[i];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];switch(e){case Ul.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,o)}finally{d()}}case Ul.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,o)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(i)),l=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,o)}finally{d(),l()}}}},r}}class Zg extends or{constructor(t,i){super(),V(this,"signal",void 0),V(this,"token",void 0),V(this,"tokenTimeout",void 0),V(this,"tokenInterval",void 0),V(this,"_sequence",0),V(this,"userMap",new Map),V(this,"encoder",new TextEncoder),this.signal=t,this.token=i;const r=()=>{this.signal.connectionState===et.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*G("P2P_TOKEN_INTERVAL"))};r()}async send(t,i,r,a,s){var o;if(this.userMap.size===0)return;const c=Array.from(tn(o=this.userMap).call(o))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),a=a??Mi(6,""),s=s??this._sequence++;const d={_id:a,_type:t,_seq:s,_message:i,token:"".concat(this.token,"_").concat(c)};G("SHOW_P2P_LOG")&&w.debug("send message",d,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(d)).forEach((h=>{this.signal.request(Et.DATA_STREAM,{payload:n_(this.encoder.encode(h))})}));const l=new se(((h,_)=>{const f=window.setTimeout((()=>{this.off("res-@".concat(a,"_ack"),m),this.off("res-@".concat(a),T),this.off(Pd.ABORT,S),w.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(a)),this.userMap.size===0?_(new _e(L.INVALID_REMOTE_USER)):_(new _e(L.TIMEOUT))}),G("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),m=()=>{f&&window.clearTimeout(f),this.off(Pd.ABORT,S),r&&h()},S=()=>{f&&window.clearTimeout(f),this.off("res-@".concat(a,"_ack"),m),this.off("res-@".concat(a),T),_(new _e(L.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(a)))};this.once(Pd.ABORT,S),this.once("res-@".concat(a,"_ack"),m);const T=(C,b)=>{R=!0,f&&window.clearTimeout(f),this.off("res-@".concat(a,"_ack"),m),this.off(Pd.ABORT,S),C==="success"?h(b):_(new _e(L.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(a)))};let R=!1;r||(this.once("res-@".concat(a),T),Ht(G("SIGNAL_REQUEST_TIMEOUT")).then((()=>{R||w.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(a,", ").concat(d))})))}));try{return await l}catch(h){if(h.code===L.TIMEOUT)return await this.send(t,i,r,a,s);throw h}}onMessage(t){var i;const{_uid:r}=t;let a,s=this.userMap.get(r);if(s)a=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Mr.CHECK)return;const{token:l}=t;a=new Map,s={uid:r,isStart:!0,token:l,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(Dt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var o;const{id:l,total:h}=t,_=(o=a.get(l))!==null&&o!==void 0?o:[];if(_.push(t),a.has(l)||a.set(l,_),_.length!==h)return;{const f=vt(_).call(_,((m,S)=>m.index-S.index)).map((m=>m.payload)).join("");a.delete(l),(t=JSON.parse(f))._uid=r}}const{_type:c,token:d}=t;if(ee(i=[Mr.ACK,Mr.CHECK]).call(i,c))return c===Mr.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(t);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):w.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:Mi(6,""),token:this.token,_type:Mr.CHECK};G("SHOW_P2P_LOG")&&w.debug("send message",t),this.signal.request(Et.DATA_STREAM,{payload:n_(this.encoder.encode(JSON.stringify(t)))})}ack(t){const i={_id:t,_type:Mr.ACK,token:this.token};G("SHOW_P2P_LOG")&&w.debug("send message",i),this.signal.request(Et.DATA_STREAM,{payload:n_(this.encoder.encode(JSON.stringify(i)))})}response(t,i,r){this.send(Mr.RESPONSE,JSON.stringify({success:!r,message:i}),!0,t)}handleReceivedMessage(t){const i=()=>{this.userMap.forEach((l=>{const{receivedMessagesMap:h,nextExpectedSequenceNumber:_}=l;for(;h.has(_);){const f=h.get(_);h.delete(_),this.receiveMessage(f),l.nextExpectedSequenceNumber++}}))};if(!t)return void i();const{_uid:r,_seq:a}=t,s=this.userMap.get(r),{receivedMessagesMap:o,isStart:c,nextExpectedSequenceNumber:d}=s;if(a<d)return this.ack(t._id),void w.debug("[external-signal] receive old message, seq: ".concat(a,", ").concat(t._message));o.set(a,t),c&&a===d&&(this.receiveMessage(t),o.delete(d),s.nextExpectedSequenceNumber++,i())}receiveMessage(t){const{_id:i,_type:r,_message:a,_uid:s}=t;if(G("SHOW_P2P_LOG")&&w.debug("receive message",t),i){let o;switch(t._type!==Mr.ACK&&(a&&(o=JSON.parse(a)),this.ack(t._id)),t._type){case Mr.CANDIDATE:case Mr.CONTROL:this.signal.emit(r,o,s);break;case Mr.PUBLISH:case Mr.UNPUBLISH:case Mr.RESTART_ICE:case Mr.CALL:o.uid=s,zt(this.signal,r,o).then((c=>{this.response(t._id,c)})).catch((()=>{this.response(t._id,void 0,!0)}));break;case Mr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Mr.RESPONSE:{const{success:c,message:d}=o;this.emit("res-@".concat(i),c?"success":"failed",d);break}}}}splitMessage(t){if(t.length<Zg.MAX_MESSAGE_SIZE)return[t];const i=[],{remoteToken:r}=JSON.parse(t),a=Mi(6,"");let s=0,o=800;const c=Math.ceil(t.length/o);for(;t.length>0;){s++;const d={id:a,index:s,total:c,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(d).length>Zg.MAX_MESSAGE_SIZE?o-=50:(i.push(d),t=t.slice(o))}return i.map((d=>JSON.stringify(d)))}handleCheckToken(t,i){return t.token!==i?(w.debug("token changed, from ".concat(t.token," to ").concat(i)),this.reset(t.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{w.debug("token timeout, ".concat(i)),this.reset(t.uid)}),G("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await zt(this.signal,Mr.CALL,void 0),i=await this.send(Mr.CALL,t);this.signal.emit(Ne.P2P_CONNECTION,i,!0)}async reset(t,i){const r=this.userMap.get(t);r&&(this.emit(Pd.ABORT),this.signal.emit(Dt.ON_USER_OFFLINE,{uid:r.uid,reason:mH.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(w.debug("change local token from ".concat(i," to ").concat(i)),this.token=Mi(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Pd.ABORT)}}V(Zg,"MAX_SIZE",1),V(Zg,"MAX_MESSAGE_SIZE",1024);class w3 extends or{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===et.CONNECTED?this.emit(Ne.WS_CONNECTED):t===et.RECONNECTING?this.emit(Ne.WS_RECONNECTING,this._websocketReconnectReason):t===et.CLOSED&&this.emit(Ne.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",et.CLOSED),V(this,"reconnectToken",void 0),V(this,"p2pToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new hb(5)),V(this,"pingpongTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"_external_signal",void 0),V(this,"onWebsocketMessage",(r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Ne.ON_BINARY_DATA,r.data);const a=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const s="res-@".concat(a._id);this.emit(s,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){switch(a._type){case Dt.ON_DATA_STREAM:return void this.handleDataStream(a._message);case Dt.MUTE_AUDIO:case Dt.MUTE_VIDEO:case Dt.ON_P2P_LOST:case Dt.ON_USER_ONLINE:return;case Dt.ON_USER_OFFLINE:const{uid:s}=a._message;return w.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(a._type,a._message),a._type===Dt.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===Dt.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(Oi.UID_BANNED);break;case 15:this.close(Oi.IP_BANNED);break;case 16:this.close(Oi.CHANNEL_BANNED)}if(a._type===Dt.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case He.ERR_LICENSE_MISSING:this.close(Oi.LICENSE_MISSING);break;case He.ERR_LICENSE_EXPIRED:this.close(Oi.LICENSE_EXPIRED);break;case He.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Oi.LICENSE_MINUTES_EXCEEDED);break;case He.ERR_LICENSE_PERIOD_INVALID:this.close(Oi.LICENSE_PERIOD_INVALID);break;case He.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Oi.LICENSE_MULTIPLE_SDK_SERVICE);break;case He.ERR_LICENSE_ILLEGAL:this.close(Oi.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new Pg("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===et.CONNECTED&&this.reconnect("retry",Rr.OFFLINE)})),this.p2pToken=Mi(6,""),this._external_signal=new Zg(this,this.p2pToken)}async request(t,i,r,a){const s=Mi(6,""),o={_id:s,_type:t,_message:i},c=this.websocket.connectionID,d=()=>new se(((S,T)=>{if(this.connectionState===et.CONNECTED)return S();const R=()=>{this.off(Ne.WS_CLOSED,C),S()},C=()=>{this.off(Ne.WS_CONNECTED,R),T(new _e(L.WS_ABORT))};this.once(Ne.WS_CONNECTED,R),this.once(Ne.WS_CLOSED,C)}));if(this.connectionState!==et.CONNECTING&&this.connectionState!==et.RECONNECTING||t===Et.JOIN||t===Et.REJOIN||await d(),this.websocket.sendMessage(o,!0),a)return;const l=new se(((S,T)=>{let R=!1;const C=(N,k)=>{R=!0,S({isSuccess:N==="success",message:k||{}}),this.off(Ne.WS_CLOSED,b),this.off(Ne.WS_RECONNECTING,b),this.emit(Ne.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(s),C);const b=()=>{T(new _e(L.WS_ABORT,"type: ".concat(t))),this.off(Ne.WS_CLOSED,b),this.off(Ne.WS_RECONNECTING,b),this.off("res-@".concat(s),C)};this.once(Ne.WS_CLOSED,b),this.once(Ne.WS_RECONNECTING,b),Ht(G("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==c||R||(w.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ne.REQUEST_TIMEOUT,t,i))}))}));let h=null;try{h=await l}catch(S){if(this.connectionState===et.CLOSED||t===Et.LEAVE)throw new _e(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?S.throw():t===Et.JOIN||t===Et.REJOIN?null:(await d(),await this.request(t,i))}if(h.isSuccess)return h.message;const _=Number(h.message.error_code||h.message.code),f=fR(_),m=new _e(L.UNEXPECTED_RESPONSE,"".concat(f.desc,": ").concat(h.message.error_str),{code:_,data:h.message,desc:f.desc});return f.action==="success"?h.message:(w.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(f.desc,", action: ").concat(f.action)),_===He.ERR_TOO_MANY_BROADCASTERS?((t===Et.JOIN||t===Et.REJOIN)&&(this.initError=m,this.close()),m.throw()):f.action==="failed"?m.throw():f.action==="quit"?(this.initError=m,this.close(),m.throw()):(_===He.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Rr.MULTI_IP)):this.reconnect(f.action,Rr.SERVER_ERROR),t===Et.JOIN||t===Et.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new se((r=>{const a=s=>{(!i||i(s))&&(this.off(t,a),r(s))};this.on(t,a)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload($t.WRTC_STATS,i)}upload(t,i){const r={_type:t,_message:i};try{this.websocket.sendMessage(r)}catch{const s=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==et.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)}),G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){const r={_type:t,_message:i};this.websocket.sendMessage(r)}async sendExtensionMessage(t,i,r){return await this._external_signal.send(t,i,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new se(((i,r)=>{this.once(Ne.WS_CONNECTED,(()=>i(this.joinResponse))),this.once(Ne.WS_CLOSED,(()=>r(this.initError||new _e(L.WS_ABORT)))),this.connectionState=et.CONNECTING,this.websocket.init(t).catch(r)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Oi.LEAVE,this.connectionState=et.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Mi(6,""),this._external_signal.clear(),this._external_signal=new Zg(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ne.ABORT_P2P_EXECUTION);const t=await zt(this,Ne.REQUEST_JOIN_INFO),i=await this.request(Et.JOIN,t);if(!i)return this.emit(Ne.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Ne.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=et.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}async downgradeCodec(t){return!1}handleDataStream(t){try{var i;const r=xc(t.payload),a=new TextDecoder().decode(r),s=JSON.parse(a);"total"in s&&"id"in s||ee(i=Object.values(Mr)).call(i,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(Dt.ON_DATA_STREAM,t)}catch{this.emit(Dt.ON_DATA_STREAM,t)}}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const i=fR(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Oi.UID_BANNED),void this.close()):void this.reconnect(i.action,Rr.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=G("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Rr.TIMEOUT):this.request(Et.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const r=Date.now()-i;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Et.PING_BACK,{pingpongElapse:r})})).catch((r=>{}))}handleWebsocketEvents(){this.websocket.on(Pt.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(Ne.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(Pt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Pt.CLOSED,(()=>{this.connectionState=et.CLOSED})),this.websocket.on(Pt.FAILED,(()=>{this._disconnectedReason=Oi.NETWORK_ERROR,this.connectionState=et.CLOSED})),this.websocket.on(Pt.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===et.CONNECTED?this.connectionState=et.RECONNECTING:this.connectionState=et.CONNECTING})),this.websocket.on(Pt.WILL_RECONNECT,((t,i,r)=>{t!=="retry"?(w.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):w.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)})),this.websocket.on(Pt.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((t=>{if(this.emit(Ne.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof _e&&t.code===L.UNEXPECTED_RESPONSE&&t.data.code===He.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Rr.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Rr.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(Pt.REQUEST_NEW_URLS,((t,i)=>{zt(this,Ne.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)})),this.websocket.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const Jj={name:"P2PChannel",create:function(e){let{store:t,statsCollector:i}=e;return new ah(t,i)},createSubmodule:function(e){let{store:t,spec:i}=e;return new w3(i,t)}};function HV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function Zj(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?HV(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HV(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}class Ji{constructor(t){V(this,"sessionDesc",void 0),V(this,"localCapabilities",void 0),V(this,"rtpCapabilities",void 0),V(this,"candidates",void 0),V(this,"_originCandidates",void 0),V(this,"iceParameters",void 0),V(this,"dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname",void 0),t=qi(t);const{iceParameters:i,dtlsParameters:r,candidates:a,rtpCapabilities:s,setup:o,localCapabilities:c,sdkCodec:d,cname:l}=t,h=ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=a,this._originCandidates=qi(a),this.iceParameters=i,this.dtlsParameters=r,this.setup=o,this.localCapabilities=c,this.cname=l;for(let _=0;_<h.mediaDescriptions.length;_++){const f=h.mediaDescriptions[_];if(f.attributes.iceUfrag=i.iceUfrag,f.attributes.icePwd=i.icePwd,f.attributes.fingerprints=r.fingerprints,f.attributes.candidates=a,f.attributes.setup=o,f.media.mediaType==="video"){f.media.fmts=s.videoCodecs.map((T=>T.payloadType.toString(10)));const m=s.videoCodecs.filter((T=>{var R,C;return(R=T.rtpMap)===null||R===void 0?void 0:ee(C=R.encodingName.toLowerCase()).call(C,d)})),S=s.videoCodecs.filter((T=>!ee(m).call(m,T)));f.attributes.payloads=[...m,...S],f.attributes.extmaps=s.videoExtensions}f.media.mediaType==="audio"&&(f.media.fmts=s.audioCodecs.map((m=>m.payloadType.toString(10))),f.attributes.payloads=s.audioCodecs,f.attributes.extmaps=s.audioExtensions),h.mediaDescriptions[_]=this.mungMediaDesc(f)}this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1}toString(){return aE(this.sessionDesc)}send(t,i,r){const{ssrcs:a,ssrcGroups:s}=ep(i,this.cname),o=this.sessionDesc.mediaDescriptions.find((l=>t===Me.VIDEO?l.media.mediaType==="video":l.media.mediaType==="audio")),c=a[0].attributes.label,d=a[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(a),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(s),{id:c,mslabel:d}}batchSend(t){return t.map((i=>{let{kind:r,ssrcMsg:a}=i;return this.send(r,a,void 0)}))}stopSending(t){this.sessionDesc.mediaDescriptions.forEach((i=>{const r=[],a=[],s=[];i.attributes.ssrcs.forEach((o=>{ee(t).call(t,o.attributes.label||"")?s.push(o):r.push(o)})),i.attributes.ssrcGroups.forEach((o=>{var c;ee(c=s.map((d=>d.ssrcId))).call(c,o.ssrcIds[0])||a.push(o)})),i.attributes.ssrcs=r,i.attributes.ssrcGroups=a}))}mute(t){const i=this.sessionDesc.mediaDescriptions.find((r=>r.attributes.mid===t));if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(t){const i=this.sessionDesc.mediaDescriptions.find((r=>r.attributes.mid===t));if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(t,i,r){t.forEach(((a,s)=>{const o=a._mediaStreamTrack,c=this.sessionDesc.mediaDescriptions.findIndex((l=>l.attributes.mid===o.kind)),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],a);this.sessionDesc.mediaDescriptions[c]=d}))}stopReceiving(t){}updateCandidates(t){const i=this._originCandidates.filter((a=>a.transport==="udp")),r=[];if(i.forEach((a=>{r.push(Zj(Zj({},a),{},{foundation:"tcpcandidate",priority:Number(a.priority)-1+"",transport:"tcp",port:Number(a.port)+90+""}))})),i.length!==0){switch(t){case Tn.TCP_RELAY:this.candidates=r;break;case Tn.UDP_TCP_RELAY:case Tn.RELAY:this.candidates=[...i,...r];break;default:this.candidates=i}for(const a of this.sessionDesc.mediaDescriptions)a.attributes.candidates=this.candidates}}restartICE(t){t=qi(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((i=>{i.attributes.iceUfrag=t.iceUfrag,i.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const i=[];for(let r=0;r<t;r++)i.push((this.currentMidIndex+r+1).toString(10));return i}mungRecvMediaDsec(t,i){const r=qi(t);return pE(r,i),zO(r,i),r}updateRecvMedia(t,i){const r=this.sessionDesc.mediaDescriptions.findIndex((a=>a.attributes.mid===t));if(r!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],i);this.sessionDesc.mediaDescriptions[r]=a}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,i,r){const a=this.sessionDesc.mediaDescriptions.find((o=>t===Me.VIDEO?o.attributes.mid==="video":o.attributes.mid==="audio"));if(a){const o=a.attributes.ssrcs.find((c=>c.attributes.label===i));var s;o&&(o.attributes.label=r,(s=o.attributes.msid)===null||s===void 0||s.replace(i,r))}}mungMediaDesc(t){const i=qi(t);return jb(i),(function(r){const a=r.attributes.extmaps.find((s=>Bb(s.extensionName)));a&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(a),1),r.attributes.payloads.forEach((s=>{const o=s.rtcpFeedbacks.findIndex((c=>c.type==="transport-cc"));o!==-1&&s.rtcpFeedbacks.splice(o,1)}))})(i),i}getSSRC(t){for(const i of this.sessionDesc.mediaDescriptions)for(const r of i.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var Ki;function vA(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),i.push.apply(i,r)}return i}function tN(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?vA(Object(i),!0).forEach((function(r){V(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vA(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}let Wd=(Ki=class qV extends ze{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var i;return ee(i=Object.keys(eR)).call(i,t)})))]}constructor(t,i){super(t,i),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"statsFilter",void 0),V(this,"useRTX",!1),V(this,"localCapabilities",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"establishPromise",void 0),V(this,"mutex",void 0),this.store=i,this.mutex=new Wn("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(qV.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=mO(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Ci()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=__(t.sdp),r=bl(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,tN(tN({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new _e(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Ji(tN(tN({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(t,i){throw new _e(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,i){var r=this;return oo((function*(){const a=yield hi(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map((f=>r.peerConnection.addTrack(f._mediaStreamTrack))),o=yield hi(r.peerConnection.createOffer()),c=ya(o.sdp),d=t.map((f=>{const m=f._mediaStreamTrack,S=c.mediaDescriptions.find((T=>T.attributes.mid===m.kind));if(!S)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(T,R,C){const b=T.attributes.ssrcs.filter((k=>k.attributes.label===R)),N=T.attributes.ssrcGroups;if(b.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(N&&b.length>1){const k=N.find((P=>P.ssrcIds.indexOf(b[0].ssrcId)!==-1));return k?[{ssrcId:k.ssrcIds[0],rtx:C?k.ssrcIds[1]:void 0}]:[{ssrcId:b[0].ssrcId}]}return[{ssrcId:b[0].ssrcId}]})(S,m.id,r.useRTX)}));let l;try{l=yield d}catch(f){throw s.forEach((m=>{Ra()&&m.replaceTrack(null),r.peerConnection.removeTrack(m)})),f}const h=r.mungSendOfferSDP(o.sdp,t);r.remoteSDP.receive(t,i,l);const _=r.remoteSDP.toString();return yield hi(r.peerConnection.setLocalDescription({type:"offer",sdp:h})),yield hi(r.applySendEncodings(s,t)),yield hi(r.peerConnection.setRemoteDescription({type:"answer",sdp:_})),t.map(((f,m)=>{const S=f._mediaStreamTrack.id;return{localSSRC:d[m],id:S}}))}catch(s){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{a()}}))()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter((s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1}));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map((s=>{Ra()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)}));const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(t,i,r,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(t,i,a),c=new se(((h,_)=>{const f=setTimeout((()=>{_(new Error("Cannot receive track, id: ".concat(s)))}),1e4),m=S=>{const T=_i();if((T.name==="Safari"&&Number(T.version)===11||Jn())&&S.track.id!==s&&S.streams[0].id===o){var R;const C=S.streams[0].getTracks()[0];return(R=this.remoteSDP)===null||R===void 0||R.updateTrackLabel(t,s,S.track.id),this.peerConnection.removeEventListener("track",m),clearTimeout(f),void h(C)}if(S.track.id===s)return this.peerConnection.removeEventListener("track",m),clearTimeout(f),void h(S.track)};this.peerConnection.addEventListener("track",m)})),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const l=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(l),{track:await c,id:s}}catch(s){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter((r=>{var a;return t.indexOf(((a=r.track)===null||a===void 0?void 0:a.id)||"")!==-1}));if(i.length!==t.length)throw new Error("sender' length doesn't match mids' length.");i.map((r=>{if(Ra()&&r.track)r.track.enabled=!1;else{const a=r.getParameters();a.encodings.forEach((s=>s.active=!1)),r.setParameters(a)}}))}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter((s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1}));if(i.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");i.map((async s=>{if(Ra()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach((c=>c.active=!0)),await s.setParameters(o)}}));const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return oo((function*(){const r=yield hi(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=Si().supportPCSetConfiguration;if(t===Tn.RELAY&&!a)return;if(a){const l=i.peerConnection.getConfiguration(),h=t===Tn.RELAY?"relay":"all";l.iceTransportPolicy!==h&&(w.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(l.iceTransportPolicy,"] to [").concat(h,"]")),l.iceTransportPolicy=h,i.peerConnection.setConfiguration(l))}t!==Tn.RELAY&&i.remoteSDP.updateCandidates(t);const s=yield hi(i.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=__(s.sdp),{remoteIceParameters:c}=yield o.iceParameters;i.remoteSDP.restartICE(c);const d=i.remoteSDP.toString();yield hi(i.peerConnection.setLocalDescription(s)),yield hi(i.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(a){w.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),a)}finally{r()}}))()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(r.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new _e(L.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){const r=this.peerConnection.getSenders().filter((a=>{var s;return((s=a.track)===null||s===void 0?void 0:s.id)===t}));r.length===1&&await this.applySendEncodings(r,[i])}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){const r=this.peerConnection.getSenders().find((a=>{var s;return((s=a.track)===null||s===void 0?void 0:s.id)===i}));r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,i){throw new _e(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new _e(L.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const i={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qT(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...qV.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...qV.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((r=>{r.forceturn&&(i.iceTransportPolicy="relay")})))),i}static turnServerConfigToIceServers(t){const i=[];return t.forEach((r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))})),i}async updateRtpSenderEncodings(t,i){var r;if(i||(i=this.peerConnection.getSenders().find((l=>{var h;return((h=l.track)===null||h===void 0?void 0:h.id)===t._mediaStreamTrack.id}))),!i)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Si().supportSetRtpSenderParameters)return w.warn("Browser not support set rtp-sender parameters");const a={},s={};if(t instanceof Xi)switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(G("DSCP_TYPE")&&fl()){var o;const l=G("DSCP_TYPE");ee(o=["very-low","low","medium","high"]).call(o,l)&&(s.networkPriority=l)}const c=i.getParameters(),d=(r=c.encodings)===null||r===void 0?void 0:r[0];d&&Object.assign(d,s),Object.assign(c,a),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await i.setParameters(c)}async applySendEncodings(t,i){try{if(!Si().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){const a=t[r],s=i[r];a&&s&&await this.updateRtpSenderEncodings(s,a)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i){const r=ya(t);return i.forEach(((a,s)=>{const o=a._mediaStreamTrack,c=r.mediaDescriptions.find((d=>d.attributes.mid===o.kind));c&&pE(c,a)})),aE(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(t).map(((s,o)=>{let{id:c,mslabel:d}=s;const{kind:l}=t[o];return new se(((h,_)=>{const f=setTimeout((()=>{_(new Error("Cannot receive track, id: ".concat(c)))}),1e4),m=S=>{const T=_i();if(T.name==="Safari"&&Number(T.version)===11&&S.track.id!==c&&S.streams[0].id===d){var R;const C=S.streams[0].getTracks()[0];return(R=this.remoteSDP)===null||R===void 0||R.updateTrackLabel(l,c,S.track.id),this.peerConnection.removeEventListener("track",m),clearTimeout(f),void h({track:C,id:c})}if(S.track.id===c)return this.peerConnection.removeEventListener("track",m),clearTimeout(f),void h({track:S.track,id:c})};this.peerConnection.addEventListener("track",m)}))})),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),await se.all(i)}catch(i){throw new _e(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(t);return i?.[0].ssrcId}setConfiguration(t){if(Si().supportPCSetConfiguration){const i=qV.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},Ze(Ki.prototype,"connect",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"connect"),Ki.prototype),Ze(Ki.prototype,"stopSending",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"stopSending"),Ki.prototype),Ze(Ki.prototype,"receive",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"receive"),Ki.prototype),Ze(Ki.prototype,"stopReceiving",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"stopReceiving"),Ki.prototype),Ze(Ki.prototype,"muteRemote",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"muteRemote"),Ki.prototype),Ze(Ki.prototype,"unmuteRemote",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"unmuteRemote"),Ki.prototype),Ze(Ki.prototype,"muteLocal",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"muteLocal"),Ki.prototype),Ze(Ki.prototype,"unmuteLocal",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"unmuteLocal"),Ki.prototype),Ze(Ki.prototype,"close",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"close"),Ki.prototype),Ze(Ki.prototype,"updateEncoderConfig",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"updateEncoderConfig"),Ki.prototype),Ze(Ki.prototype,"updateSendParameters",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"updateSendParameters"),Ki.prototype),Ze(Ki.prototype,"replaceTrack",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"replaceTrack"),Ki.prototype),Ze(Ki.prototype,"getRemoteSSRC",[Hd],Object.getOwnPropertyDescriptor(Ki.prototype,"getRemoteSSRC"),Ki.prototype),Ki);function Hd(e,t,i){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const a=this.mutex,s=await a.lock("Locking from P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await r.apply(this,c)}finally{s()}},i}const O3={name:"PlanBConnection",create:function(e){let{store:t,spec:i}=e;return new Wd(i,t)}},N3={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Si().supportWebRTCEncodedTransform)return void w.warning("browser not support audio encoded transform");if(Ng.has(e)||!e.track)return;const i={track:e.track};if(dn()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(o){return void w.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){i.controller||(i.controller=c),e.track&&e.track.id!==i.track.id&&(w.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));const d=t.metadata&&t.metadata();d?(function(l,h){const{chunk:_,controller:f}=h,m=qh.METADATA;_.data=(function(S,T,R){const C=R.byteLength,b=C+VO+d_,N=Cb+bb+b,k=new ArrayBuffer(S.byteLength+N),P=new DataView(k);P.setUint8(0,xO),P.setUint16(1,b),P.setUint8(3,T),P.setUint16(4,C);for(let W=0;W<C;W++)P.setUint8(6+W,R[W]);const U=new Uint8Array(P.buffer);return U.set(new Uint8Array(S),N),U.buffer})(_.data,m,l),f.enqueue(_)})(d,{chunk:o,controller:c}):c.enqueue(o)}});a.readable.pipeThrough(s).pipeTo(a.writable)}else if(Ra()){if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const a=yb(),s=new MessageChannel;await new se((c=>a.onmessage=d=>{d.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(a,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=o,await new se((c=>a.onmessage=d=>{d.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var d;if(c.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id)w.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r);else if(c.data.getMetadata){const l=t.metadata&&t.metadata();l&&s.port1.postMessage({metadata:l})}},i.worker=a}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const a=Ng.get(e);if(a){Ng.delete(e);try{var s,o;(s=a.controller)===null||s===void 0||s.terminate(),(o=a.worker)===null||o===void 0||o.terminate()}catch(c){w.warning(c&&c.message)}}}Ng.set(e,i),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Si().supportWebRTCEncodedTransform)return void w.warning("browser not support audio encoded transform");if(GO.has(e))return;const i={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(dn()&&!Jn()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");ob(bi.CHROME,87,116)||(t.enableTopn=!1);let a=null;try{a=e.createEncodedStreams()}catch(o){return void w.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){i.controller||(i.controller=c),e.track&&e.track.id!==i.track.id&&(w.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r)),t.enableTopn?(function(d,l,h){var _;const f=oR(new DataView(l.data));if(!f)return h.enqueue(l);const m=d.track.id;cU.set(m,d.track);const S=(_=f.tlv.find((k=>k.tag===qh.AUDIO_LEVEL)))===null||_===void 0?void 0:_.value;let T=0;typeof S=="number"&&(T=127-S);const R=Math.round(Math.pow(10,T/60)-1),{selected:C,speaker:b}=(function(k,P){let U=Vo.get(k);if(U||(U=(function(W){const z=new FB;return Vo.set(W,z),Yc||(Yc=new lR(G("TOPN_SILENCE_THRESHOLD")||500),Yc.on("ActiveSpeakerChanged",(Q=>{Q!=null&&(Ab=Q)}))),Yc.addSpeakers([z]),z})(k)),Vo.size<=oE)return{selected:!0,speaker:U};if(!Yc)throw new Error("no active speaker detector");return Yc.levelChanged(U.id,P),ho=Yc.loudest.map((W=>W.id)),Ab&&!ee(ho).call(ho,Ab)&&ho.length>=oE&&ho.pop(),{selected:ee(ho).call(ho,U.id)||U.id===Ab,speaker:U}})(d,R),N=(function(k,P,U){const W=zc.get(k)||new jO(k,P);return W.score=U,zc.set(k,W),(function(z){if(BO.set(z,!0),!Ib)return void(Ib=Date.now());const Q=Date.now();Q-Ib>1e3&&(BO.get(z)?BO.set(z,!1):(wb(z),BO.delete(z)),Ib=Q)})(k),W})(m,d.track,b.energyScore);N.addSample(C),N.active&&(l.data=f.frame.buffer,h.enqueue(l))})(e,o,c):t.enableMetadata||t.enablePts?(function(d,l,h,_){const f=new DataView(d.data),m=f.getUint8(0);let S;if((128&m)!=0&&m!==71){const C=(function(b){if(b.byteLength<=0)return[];const N=[];let k=0;for(;k<b.byteLength;){const U=(128&b.getUint8(k))>>7,W=127&b.getUint8(k);if(!(U&&k+4<=b.byteLength)){k++;break}{const z=b.getUint32(k,!1),Q=(16776192&z)>>10,he=1023&z;N.push({pt:W,ts_offset:Q,length:he,data:new Uint8Array}),k+=4}}let P=b.byteLength-k;for(const U of N){if(U.length>P)return console.warn("Broken red payload"),[];U.length>0&&(U.data=new Uint8Array(b.buffer,b.byteOffset+k,U.length),k+=U.length,P-=U.length)}if(P>0){const U={pt:N.length>0?N[N.length-1].pt:0,ts_offset:0,length:P,data:new Uint8Array(b.buffer,b.byteOffset+k,P)};N.push(U)}return N})(f);if(C.length>0){const b=(function(N){let k=0;for(let W=0;W<N.length;W++)k+=W<N.length-1?4:1,k+=N[W].length;const P=new Uint8Array(k);let U=0;for(let W=0;W<N.length;W++)if(W<N.length-1){const z=(2147483648|(127&N[W].pt)<<24|(262143&N[W].ts_offset)<<10|1023&N[W].length)>>>0;P[U++]=z>>24&255,P[U++]=z>>16&255,P[U++]=z>>8&255,P[U++]=255&z}else P[U++]=127&N[W].pt;for(const W of N)P.set(W.data,U),U+=W.length;return P})(C.map((N=>{const k=new Uint8Array(N.length);k.set(N.data);const P=oR(new DataView(k.buffer));return P!=null&&P.frame&&(N.data=P?.frame),S=P,N})));d.data=b.buffer}}else S=oR(f),S&&(d.data=S.frame.buffer);if(l.enqueue(d),!S)return;const T=S.tlv.find((C=>C.tag===qh.METADATA));T&&h&&T.value instanceof Uint8Array&&h(T.value);const R=S.tlv.find((C=>C.tag===qh.AUDIO_64_BIT_PTS));R&&_&&R.value instanceof Uint8Array&&R.value.length==8&&_(new DataView(R.value.buffer).getBigUint64(0,!0))})(o,c,t.onMetadata,t.onPts):c.enqueue(o)}});a.readable.pipeThrough(s).pipeTo(a.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const a=yb(),s=new MessageChannel;await new se((c=>a.onmessage=d=>{d.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(a,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=o,await new se((c=>a.onmessage=d=>{d.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var d;c.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id?(w.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r)):c.data.metadata&&i.onMetadata?i.onMetadata(c.data.metadata):c.data.pts&&i.onPts&&i.onPts(c.data.pts)},i.worker=a}function r(){e.track.removeEventListener("ended",r),(function(a){const s=GO.get(a);if(s){(function(d){const l=Vo.get(d);l&&(Vo.delete(d),Yc&&(Yc.removeSpeakers([l]),Vo.size===0&&(Yc.destroy(),Yc=null)))})(a),wb(a.track.id),GO.delete(a);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){w.warning(d&&d.message)}}})(e)}GO.set(e,i),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Si().supportWebRTCEncodedTransform)return void w.warning("browser not support video encoded transform");if(cE.has(e)||!e.track)return;const i={track:e.track};if(dn()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(c){return void w.error("create video-encoded-streams error",c&&c.message)}const s=[];t.on("sei-to-send",(c=>{s.push(c)}));const o=new TransformStream({transform(c,d){i.controller||(i.controller=d),e.track&&e.track.id!==i.track.id&&(w.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));const l=Nb(new Uint8Array(c.data)),h=s.shift();if(h){const _=(function(f,m,S){switch(S){case Ob:return(function(T,R){const C=lU(R),b=C.length,N=Math.floor(b/255),k=b%255,P=new Uint8Array(6+N+1+b+T.byteLength);P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=6,P[5]=101;let U=0;for(;U<N;)P[6+U]=255,U++;return P[6+U]=k,U++,P.set(C,6+U),P.set(new Uint8Array(T),6+U+b),P.buffer})(f,m);case WO:return(function(T,R){const C=lU(R),b=C.length,N=Math.floor(b/255),k=b%255,P=new Uint8Array(7+N+1+b+1+T.byteLength);P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=78,P[5]=1,P[6]=101;let U=0;for(;U<N;)P[7+U]=255,U++;return P[7+U]=k,U++,P.set(C,7+U),U+=b,P[7+U]=128,U++,P.set(new Uint8Array(T),7+U),P.buffer})(f,m);default:return null}})(c.data,h,l);_&&(c.data=_)}d.enqueue(c)}});a.readable.pipeThrough(o).pipeTo(a.writable)}else{if(!Ra())return;{if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const a=yb(),s=new MessageChannel;await new se((c=>a.onmessage=d=>{d.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(a,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=o,await new se((c=>a.onmessage=d=>{d.data==="started"&&c(void 0)})),t.on("sei-to-send",(c=>{s.port1.postMessage({sei:c})})),s.port1.onmessage=c=>{var d;c.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id&&(w.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r))},i.worker=a}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const a=cE.get(e);if(a){cE.delete(e);try{var s,o;(s=a.controller)===null||s===void 0||s.terminate(),(o=a.worker)===null||o===void 0||o.terminate()}catch(c){w.warning(c&&c.message)}}}cE.set(e,i),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Si().supportWebRTCEncodedTransform)return void w.warning("browser not support video encoded transform");if(!e.track)return;if(Db.has(e)){const a=Db.get(e);return void(a&&(a.onSei=t.onSei))}const i={track:e.track,onSei:t.onSei};if(dn()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(o){return void w.error("create video-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){i.controller||(i.controller=c),e.track&&e.track.id!==i.track.id&&(w.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));const d=(function(l,h){switch(h){case Ob:return(function(_){const f=new DataView(_.data);let m=0;for(;m+4<_.data.byteLength;){if(f.getUint8(m+0)===0&&f.getUint8(m+1)===0&&f.getUint8(m+2)===0&&f.getUint8(m+3)===1&&f.getUint8(m+4)===6){let S=m+6,T=0,R=0;for(;(R=f.getUint8(S++))===255;)T+=255;T+=R;const C=dU(_.data,S,T);return new Uint8Array(C)}m++}return null})(l);case WO:return(function(_){const f=new DataView(_.data);let m=0;for(;m+5<_.data.byteLength;){if(f.getUint8(m+0)===0&&f.getUint8(m+1)===0&&f.getUint8(m+2)===0&&f.getUint8(m+3)===1&&f.getUint8(m+4)===78&&f.getUint8(m+5)===1&&f.getUint8(m+6)===101){let S=m+7,T=0,R=0;for(;(R=f.getUint8(S++))===255;)T+=255;T+=R;const C=dU(_.data,S,T);return new Uint8Array(C)}m++}return null})(l);default:return null}})(o,Nb(new Uint8Array(o.data)));d&&i.onSei&&i.onSei(d),c.enqueue(o)}});a.readable.pipeThrough(s).pipeTo(a.writable)}else if(Ra()){if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const a=yb(),s=new MessageChannel;await new se((c=>a.onmessage=d=>{d.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(a,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=o,await new se((c=>a.onmessage=d=>{d.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var d;c.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id?(w.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r)):c.data.sei&&i.onSei&&i.onSei(c.data.sei)},i.worker=a}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(a){const s=Db.get(a);if(s){Db.delete(a);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){w.warning(d&&d.message)}}})(e)}Db.set(e,i),e.track.addEventListener("ended",r)}},Qj={name:"InterceptFrame",create:()=>N3};dc(),B("PROCESS_ID","process-".concat(Mi(8,""),"-").concat(Mi(4,""),"-").concat(Mi(4,""),"-").concat(Mi(4,""),"-").concat(Mi(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void w.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),i=Date.now();w.debug("Loading global parameters from cache",t),Object.keys(t).forEach((r=>{if(Object.prototype.hasOwnProperty.call(Ct,r)){const{value:a,expires:s}=t[r];if(s&&s<=i)return;ft[r]=a,Ct[r]=a}}))}catch(t){w.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(ft.AREAS)&&ft.AREAS.length>0&&ZO(ft.AREAS,!0);const Cn=(e,t,i)=>{w.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),B(e,t,i)};jo(Uj,!1),jo(m3,!1),jo(_j,!1),jo(Wj,!1),jo(p3,!1),jo(Jj,!1),jo(O3,!1),jo(Qj,!1);const n=(function(e){const t=new or,i=e,r={getListeners:t.getListeners.bind(t),on:(a,s)=>((function(o,c){o===Fa.SECURITY_POLICY_VIOLATION&&Ej(c,!0)})(a,s),t.on.bind(t)(a,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return S0(S0({},i),r)})({__TRACK_LIST__:bg,VERSION:lc,BUILD:Eb,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Cn,getParameter:G,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const i=await(async function(r){let a;return Si().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),a=(await r.createOffer()).sdp):a=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,a})(t);if(!i)return e;t.close(),t=null,e=(function(r){const a={video:[],audio:[]};return r.match(/ VP8/i)&&a.video.push("VP8"),r.match(/ VP9/i)&&a.video.push("VP9"),r.match(/ AV1/i)&&a.video.push("AV1"),r.match(/ H264/i)&&a.video.push("H264"),r.match(/ H265/i)&&a.video.push("H265"),r.match(/ opus/i)&&a.audio.push("OPUS"),r.match(/ PCMU/i)&&a.audio.push("PCMU"),r.match(/ PCMA/i)&&a.audio.push("PCMA"),r.match(/ G722/i)&&a.audio.push("G722"),a})(i)}catch(t){throw new oe(L.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=J.reportApiInvoke(null,{name:Gt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Tr.TRACER});let t=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(s&&o&&c),t&&xu()&&tO(75)&&new s().close()}catch(s){return w.error("check system requirement failed: ",s),!1}let i=!1;const r=_i();r.name===bi.CHROME&&Number(r.version)>=58&&(Ad.engine.name!=="WebKit"||(function(){const s=_i();if(_l()){if(s.os===Ot.MAC_OS)return!0;if(s.os===Ot.IOS){const o=Ad.os.version&&Ad.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1})())&&(i=!0),(r.name===bi.FIREFOX&&Number(r.version)>=56||r.name===bi.OPERA&&Number(r.version)>=45||r.name===bi.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Jn()||wd())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||h1()||_i().name===bi.QQ)&&(i=!0),w.debug("checkSystemRequirements, api:",t,"browser",i);const a=t&&i;return e.onSuccess(a),a},getDevices:function(e){return Uo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Uo.getRecordingDevices(e)},getCameras:function(e){return Uo.getCamerasDevices(e)},getElectronScreenSources:bO,getPlaybackDevices:function(e){return Uo.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=Mi(5,"client-"),r=J.reportApiInvoke(null,{id:i,name:Gt.CREATE_CLIENT,options:[t],tag:Tr.TRACER});try{(function(a){Bt(a.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Bt(a.mode,"config.mode",["rtc","live","p2p"]),a.audioCodec!==void 0&&Bt(a.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),a.proxyServer!==void 0&&rn(a.proxyServer,"config.proxyServer",1,1e4),a.turnServer!==void 0&&uO(a.turnServer),a.httpRetryConfig!==void 0&&EB(a.httpRetryConfig),a.websocketRetryConfig!==void 0&&EB(a.websocketRetryConfig)})(t)}catch(a){throw r.onError(a),a}return(rO(16,0)||db(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",w.debug("browser not support vp9, force use vp8")),B("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new nA(Nl(Nl({forceWaitGatewayResponse:!0},t),{},{role:ee(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=G("CAMERA_CAPTURE_CONFIG"),i=Mi(8,"track-cam-"),r=J.reportApiInvoke(null,{id:i,tag:Tr.TRACER,name:Gt.CREATE_CAM_VIDEO_TRACK,options:[$i({},e),t]});t&&(e.encoderConfig=t);const a=Rb(e);let s=null;w.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{s=(await Wc({video:a},i)).getVideoTracks()[0]||null}catch(c){throw r.onError(c),c}if(!s){const c=new _e(L.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(c),c.throw(w)}if(e.optimizationMode&&MO(i,s,e,Gc(e.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const c=Gc(e.encoderConfig);e.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin}const o=new sR(s,e,a,e.scalabiltyMode?RO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return r.onSuccess(o.getTrackId()),w.info("create camera video success, trackId:",i),o},createCustomVideoTrack:function(e){const t=Mi(8,"track-cus-"),i=J.reportApiInvoke(null,{id:t,tag:Tr.TRACER,name:Gt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});G("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new Xi(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?RO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Ui.CUSTOM_TRACK]);return i.onSuccess(r.getTrackId()),w.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof t=="object"?(function(f){return M1(f)})(t):void 0;i&&(t="auto");const r=Mi(8,"track-scr-v-"),a=J.reportApiInvoke(null,{id:r,tag:Tr.TRACER,name:Gt.CREATE_SCREEN_VIDEO_TRACK,options:[$i({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=(function(f){const m={};f.screenSourceType&&(m.mediaSource=f.screenSourceType),f.extensionId&&dn()&&(m.extensionId=f.extensionId);const{displaySurface:S,selfBrowserSurface:T,surfaceSwitching:R,systemAudio:C,preferCurrentTab:b}=f;(Tg(107)||cb(107)||nO(93))&&(S&&(Bt(S,"displaySurface",["browser","window","monitor"]),m.displaySurface=S),T?(Bt(T,"selfBrowserSurface",["exclude","include"]),m.selfBrowserSurface=T):m.selfBrowserSurface="include",R&&(Bt(R,"surfaceSwitching",["exclude","include"]),m.surfaceSwitching=R)),(Tg(105)||cb(105)||nO(91))&&C&&(Bt(C,"systemAudio",["exclude","include"]),m.systemAudio=C),(Tg(94)||cb(94)||nO(80))&&b&&(m.preferCurrentTab=!0),f.electronScreenSourceId&&(m.sourceId=f.electronScreenSourceId);const N=f.encoderConfig?rR(f.encoderConfig):null;return m.mandatory={chromeMediaSource:"desktop",maxWidth:N?N.width:void 0,maxHeight:N?N.height:void 0},N&&(N.frameRate&&(typeof N.frameRate=="number"?(m.mandatory.maxFrameRate=N.frameRate,m.mandatory.minFrameRate=N.frameRate):(m.mandatory.maxFrameRate=N.frameRate.max||N.frameRate.ideal||N.frameRate.exact||void 0,m.mandatory.minFrameRate=N.frameRate.min||N.frameRate.ideal||N.frameRate.exact||void 0),m.frameRate=N.frameRate),N.width&&(m.width=N.width),N.height&&(m.height=N.height)),m})(e);let o=null,c=null;const d=Si();if(!d.supportShareAudio&&t==="enable"){const f=new _e(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(f),f.throw(w)}w.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const l=d.supportShareAudio&&t!=="disable";try{const f=await Wc({screen:s,screenAudio:l?i||!0:void 0},r);o=f.getVideoTracks()[0]||null,c=f.getAudioTracks()[0]||null}catch(f){throw a.onError(f),f}if(!o){const f=new _e(L.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(f),f.throw(w)}if(!c&&t==="enable"){o&&o.stop();const f=new _e(L.SHARE_AUDIO_NOT_ALLOWED);return a.onError(f),f.throw(w)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(MO(r,o,e,e.encoderConfig&&rR(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const h=new Xi(o,e.encoderConfig?rR(e.encoderConfig):{},e.scalabiltyMode?RO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[Ui.SCREEN_TRACK]);if(!c)return a.onSuccess(h.getTrackId()),w.info("create screen video track success","video:",h.getTrackId()),h;const _=new yr(c,void 0,Mi(8,"track-scr-a-"),!1);return a.onSuccess([h.getTrackId(),_.getTrackId()]),w.info("create screen video track success","video:",h.getTrackId(),"audio:",_.getTrackId()),[h,_]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=G("CAMERA_CAPTURE_CONFIG"),r=Mi(8,"track-mic-"),a=Mi(8,"track-cam-"),s=J.reportApiInvoke(null,{id:"".concat(r,"-").concat(a),tag:Tr.TRACER,name:Gt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,i]});i&&(t.encoderConfig=i);const o=Rb(t),c=LB(e);let d=null,l=null;w.info("start create camera video track(".concat(a,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const f=await Wc({audio:c,video:o},"".concat(r,"-").concat(a));d=f.getAudioTracks()[0],l=f.getVideoTracks()[0]}catch(f){throw s.onError(f),f}if(!d||!l){const f=new _e(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(f),f.throw(w)}if(t.optimizationMode&&MO(a,l,t,Gc(t.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const f=Gc(t.encoderConfig);t.encoderConfig=f,delete f.bitrateMax,delete f.bitrateMin}const h=new vb(d,e,c,r),_=new sR(l,t,o,t.scalabiltyMode?RO(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return s.onSuccess([h.getTrackId(),_.getTrackId()]),w.info("create camera video track(".concat(a,") and microphone audio track(").concat(r,") success")),[h,_]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Mi(8,"track-mic-"),i=J.reportApiInvoke(null,{id:t,tag:Tr.TRACER,name:Gt.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=LB(e);let a=null;w.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{a=(await Wc({audio:r},t)).getAudioTracks()[0]||null}catch(o){throw i.onError(o),o}if(!a){const o=new _e(L.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(o),o.throw(w)}const s=new vb(a,e,r,t);return i.onSuccess(s.getTrackId()),w.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=Mi(8,"track-cus-"),i=J.reportApiInvoke(null,{id:t,tag:Tr.TRACER,name:Gt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new yr(e.mediaStreamTrack,e.encoderConfig?s_(e.encoderConfig):{},t,!1);return w.info("create custom audio track success with config",e,"trackId",r.getTrackId()),i.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:i,encoderConfig:r}=e;let{source:a}=e;const s={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":a,cacheOnlineFile:i,encoderConfig:r},o=Mi(8,"track-buf-"),c=J.reportApiInvoke(null,{id:o,tag:Tr.TRACER,name:Gt.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(G("DISABLE_WEBAUDIO"))throw new _e(L.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");w.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",o);const d=a;if(!(a instanceof AudioBuffer))try{a=await(async function(_,f){let m=null;if(typeof _=="string"){const T=mM.get(_);if(T)return w.debug("use cached audio resource: ",_),T;try{m=(await Vc((()=>co.get(_,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(R){throw new _e(L.FETCH_AUDIO_FILE_FAILED,R.toString())}}else m=await new se(((R,C)=>{const b=new FileReader;b.onload=N=>{N.target?R(N.target.result):C(new _e(L.READ_LOCAL_AUDIO_FILE_ERROR))},b.onerror=()=>{C(new _e(L.READ_LOCAL_AUDIO_FILE_ERROR))},b.readAsArrayBuffer(_)}));const S=await(function(T){const R=Rl();return new se(((C,b)=>{R.decodeAudioData(T,(N=>{C(N)}),(N=>{b(new _e(L.DECODE_AUDIO_FILE_FAILED,N.toString()))}))}))})(m);return typeof _=="string"&&f&&mM.set(_,S),S})(a,i)}catch(_){return c.onError(_),_.throw(w)}const l=new MB(a),h=new Un(d,l,r?s_(r):{},o);return w.info("create buffer source audio track success, trackId:",o),c.onSuccess(h.getTrackId()),h},setAppType:function(e){if(w.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw w.debug("Invalid appType"),new oe(L.INVALID_PARAMS,"invalid app type",e);B("APP_TYPE",Math.floor(e))},setLogLevel:function(e){w.setLogLevel(e)},enableLogUpload:function(){G("USE_NEW_LOG")?B("UPLOAD_LOG",!0):w.enableLogUpload()},disableLogUpload:function(){G("USE_NEW_LOG")?B("UPLOAD_LOG",!1):w.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new qU},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=J.reportApiInvoke(null,{tag:Tr.TRACER,name:Gt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof yr||e instanceof fc)){const d=new oe(L.INVALID_TRACK,"the parameter is not a audio track");return i.onError(d),d.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof yr?e.getTrackLabel():"remote_track",a=e.getVolumeLevel();let s=a,o=a;const c=Date.now();return new se((d=>{const l=setInterval((()=>{const h=e.getVolumeLevel();s=h>s?h:s,o=h<o?h:o;const _=s-o>1e-4,f=Date.now()-c;if(_||f>t){clearInterval(l);const m=_,S={duration:f,deviceLabel:r,maxVolumeLevel:s,result:m};w.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),d(m)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=J.reportApiInvoke(null,{tag:Tr.TRACER,name:Gt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Xi||e instanceof Wu)){const _=new oe(L.INVALID_TRACK,"the parameter is not a video track");return i.onError(_),_.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Xi?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Ra()||_l())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([a]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let c=0,d=0;try{const _=Date.now();c=await(function(f,m,S,T){let R,C=0,b=null;return new se(((N,k)=>{function P(){C>T&&R&&(R(),N(C));const U=S.getContext("2d");if(!U){const Q=new oe(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return w.error(Q.toString()),void k(Q)}U.drawImage(f,0,0,160,120);const W=U.getImageData(0,0,S.width,S.height),z=Math.floor(W.data.length/3);if(b){for(let Q=0;Q<z;Q+=3)if(W.data[Q]!==b[Q])return C+=1,void(b=W.data);b=W.data}else b=W.data}setTimeout((()=>{R&&(R(),N(C))}),m),R=CO((()=>{P()}),30)}))})(s,t,o,4),d=Date.now()-_}catch(_){throw i.onError(_),_}dj===bi.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const l=c>4,h={duration:d,changedPicNum:c,deviceLabel:r,result:l};return w.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(h))),i.onSuccess(h),l},setArea:ZO,audioElementPlayCenter:ki,resumeAudioContext:function(){ki.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){fj.processExternalMediaAEC(e)},registerExtensions:function(e){const t=G("PLUGIN_INFO")||[];e.forEach((i=>{"name"in i&&!ee(t).call(t,i.name)&&t.push(i.name);const r=i;r.__registered__=!0,r.logger.hookLog=w.extLog,r.reporter.hookApiInvoke=J.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach((a=>{r.parameters[a]=G(a)}))})),Cn("PLUGIN_INFO",t)},ChannelMediaRelayError:Ni,ChannelMediaRelayEvent:oa,ChannelMediaRelayState:Ja,RemoteStreamFallbackType:Ag,RemoteStreamType:q4,ConnectionDisconnectedReason:Oi,AudienceLatencyLevelType:Vi,AREAS:Di,preload:async function(e,t,i,r){return ox(e,t,i,r)}});return Object.defineProperties(n,{onAudioAutoplayFailed:{get:()=>pc.onAudioAutoplayFailed,set:e=>{pc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>pc.onAutoplayFailed,set:e=>{pc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>n._onSecurityPolicyViolation,set(e){n._onSecurityPolicyViolation=e,Ej(e)}},__CLIENT_LIST__:{get:()=>G("SHOW_GLOBAL_CLIENT_LIST")?vl:[]}}),Uo.on(Mn.CAMERA_DEVICE_CHANGED,(e=>{w.info("camera device changed",JSON.stringify(e)),n.onCameraChanged&&n.onCameraChanged(e),n.safeEmit(Fa.CAMERA_CHANGED,e)})),Uo.on(Mn.RECORDING_DEVICE_CHANGED,(e=>{w.info("microphone device changed",JSON.stringify(e)),n.onMicrophoneChanged&&n.onMicrophoneChanged(e),n.safeEmit(Fa.MICROPHONE_CHANGED,e)})),Uo.on(Mn.PLAYOUT_DEVICE_CHANGED,(e=>{w.debug("playout device changed",JSON.stringify(e)),n.onPlaybackDeviceChanged&&n.onPlaybackDeviceChanged(e),n.safeEmit(Fa.PLAYBACK_DEVICE_CHANGED,e)})),ki.onAutoplayFailed=()=>{w.info("detect audio element autoplay failed"),pc.onAudioAutoplayFailed&&pc.onAudioAutoplayFailed()},Li.on("autoplay-failed",(()=>{w.info("detect webaudio autoplay failed"),pc.onAudioAutoplayFailed&&pc.onAudioAutoplayFailed(),n.safeEmit(Fa.AUTOPLAY_FAILED)})),Li.on(On.STATE_CHANGE,((e,t)=>{w.info("audio context state changed: ".concat(t," => ").concat(e)),n.onAudioContextStateChanged&&n.onAudioContextStateChanged(e,t),n.safeEmit(Fa.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),Zr.on(kn.NETWORK_STATE_CHANGE,((e,t)=>{w.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=n),n}))})(iG)),iG.exports}var YY=KY();const zY=W3(YY);/**
 * @license agora-rtc-react
 * @version 2.5.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var qY=Object.create,Z3=Object.defineProperty,XY=Object.getOwnPropertyDescriptor,JY=Object.getOwnPropertyNames,ZY=Object.getPrototypeOf,QY=Object.prototype.hasOwnProperty,$Y=(x,Y)=>()=>(Y||x((Y={exports:{}}).exports,Y),Y.exports),e2=(x,Y)=>{for(var q in Y)Z3(x,q,{get:Y[q],enumerable:!0})},j8=(x,Y,q,K)=>{if(Y&&typeof Y=="object"||typeof Y=="function")for(let X of JY(Y))!QY.call(x,X)&&X!==q&&Z3(x,X,{get:()=>Y[X],enumerable:!(K=XY(Y,X))||K.enumerable});return x},t2=(x,Y,q)=>(j8(x,Y,"default"),q),AA=(x,Y,q)=>(q=x!=null?qY(ZY(x)):{},j8(!x||!x.__esModule?Z3(q,"default",{value:x,enumerable:!0}):q,x)),IA=$Y((x,Y)=>{(function(q,K){typeof x=="object"&&typeof Y<"u"?Y.exports=K():typeof define=="function"&&define.amd?define(K):(q=typeof globalThis<"u"?globalThis:q||self).AgoraRTC=K()})(x,function(){function q(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(n)}var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function X(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var re=function(n){try{return!!n()}catch{return!0}},pe=!re(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),Pe=pe,ge=Function.prototype,de=ge.call,Re=Pe&&ge.bind.bind(de,de),ye=Pe?Re:function(n){return function(){return de.apply(n,arguments)}},Be=ye({}.isPrototypeOf),ct=function(n){return n&&n.Math===Math&&n},ke=ct(typeof globalThis=="object"&&globalThis)||ct(typeof window=="object"&&window)||ct(typeof self=="object"&&self)||ct(typeof K=="object"&&K)||ct(typeof K=="object"&&K)||(function(){return this})()||Function("return this")(),Ve=pe,Fe=Function.prototype,ht=Fe.apply,At=Fe.call,kt=typeof Reflect=="object"&&Reflect.apply||(Ve?At.bind(ht):function(){return At.apply(ht,arguments)}),Ar=ye,oi=Ar({}.toString),ts=Ar("".slice),tr=function(n){return ts(oi(n),8,-1)},is=tr,ia=ye,ha=function(n){if(is(n)==="Function")return ia(n)},Ns=typeof document=="object"&&document.all,Jt=Ns===void 0&&Ns!==void 0?function(n){return typeof n=="function"||n===Ns}:function(n){return typeof n=="function"},zo={},ir=!re(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Ds=pe,je=Function.prototype.call,tt=Ds?je.bind(je):function(){return je.apply(je,arguments)},ni={},Qr={}.propertyIsEnumerable,me=Object.getOwnPropertyDescriptor,at=me&&!Qr.call({1:2},1);ni.f=at?function(n){var e=me(this,n);return!!e&&e.enumerable}:Qr;var gt,Tt,Ft=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}},xr=re,xi=tr,_s=Object,Fn=ye("".split),mo=xr(function(){return!_s("z").propertyIsEnumerable(0)})?function(n){return xi(n)==="String"?Fn(n,""):_s(n)}:_s,Fl=function(n){return n==null},tS=Fl,tv=TypeError,Xs=function(n){if(tS(n))throw new tv("Can't call method on "+n);return n},iv=mo,oN=Xs,Js=function(n){return iv(oN(n))},Yd=Jt,Ir=function(n){return typeof n=="object"?n!==null:Yd(n)},bn={},x_=bn,oh=ke,cN=Jt,iS=function(n){return cN(n)?n:void 0},wr=function(n,e){return arguments.length<2?iS(x_[n])||iS(oh[n]):x_[n]&&x_[n][e]||oh[n]&&oh[n][e]},rv=ke.navigator,pp=rv&&rv.userAgent,$r=pp?String(pp):"",zd=ke,fs=$r,nv=zd.process,av=zd.Deno,sv=nv&&nv.versions||av&&av.version,V_=sv&&sv.v8;V_&&(Tt=(gt=V_.split("."))[0]>0&&gt[0]<4?1:+(gt[0]+gt[1])),!Tt&&fs&&(!(gt=fs.match(/Edge\/(\d+)/))||gt[1]>=74)&&(gt=fs.match(/Chrome\/(\d+)/))&&(Tt=+gt[1]);var Ps=Tt,Bl=Ps,rS=re,LE=ke.String,td=!!Object.getOwnPropertySymbols&&!rS(function(){var n=Symbol("symbol detection");return!LE(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&Bl&&Bl<41}),nS=td&&!Symbol.sham&&typeof Symbol.iterator=="symbol",NA=wr,ov=Jt,kE=Be,dN=Object,qd=nS?function(n){return typeof n=="symbol"}:function(n){var e=NA("Symbol");return ov(e)&&kE(e.prototype,dN(n))},DA=String,qo=function(n){try{return DA(n)}catch{return"Object"}},cv=Jt,PA=qo,lN=TypeError,pr=function(n){if(cv(n))return n;throw new lN(PA(n)+" is not a function")},Ls=pr,go=Fl,vc=function(n,e){var t=n[e];return go(t)?void 0:Ls(t)},ME=tt,dv=Jt,lv=Ir,LA=TypeError,_p={exports:{}},UE=ke,F_=Object.defineProperty,B_=ke,xE=function(n,e){try{F_(UE,n,{value:e,configurable:!0,writable:!0})}catch{UE[n]=e}return e},ch="__core-js_shared__",Da=_p.exports=B_[ch]||xE(ch,{});(Da.versions||(Da.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var j_=_p.exports,aS=j_,Es=function(n,e){return aS[n]||(aS[n]=e||{})},G_=Xs,uN=Object,Pa=function(n){return uN(G_(n))},kA=Pa,hN=ye({}.hasOwnProperty),Bi=Object.hasOwn||function(n,e){return hN(kA(n),e)},sS=ye,jl=0,uv=Math.random(),MA=sS(1 .toString),Xd=function(n){return"Symbol("+(n===void 0?"":n)+")_"+MA(++jl+uv,36)},hv=Es,VE=Bi,pN=Xd,UA=td,yc=nS,Cc=ke.Symbol,FE=hv("wks"),oS=yc?Cc.for||Cc:Cc&&Cc.withoutSetter||pN,ci=function(n){return VE(FE,n)||(FE[n]=UA&&VE(Cc,n)?Cc[n]:oS("Symbol."+n)),FE[n]},cS=tt,pv=Ir,So=qd,_v=vc,xA=function(n,e){var t,i;if(dv(t=n.toString)&&!lv(i=ME(t,n))||dv(t=n.valueOf)&&!lv(i=ME(t,n))||e!=="string")return i;throw new LA("Can't convert object to primitive value")},fv=TypeError,W_=ci("toPrimitive"),VA=function(n,e){if(!pv(n)||So(n))return n;var t,i=_v(n,W_);if(i){if(t=cS(i,n,e),!pv(t)||So(t))return t;throw new fv("Can't convert object to primitive value")}return xA(n,e)},FA=qd,Jd=function(n){var e=VA(n,"string");return FA(e)?e:e+""},Ev=Ir,H_=ke.document,BA=Ev(H_)&&Ev(H_.createElement),fp=function(n){return BA?H_.createElement(n):{}},_N=fp,mv=!ir&&!re(function(){return Object.defineProperty(_N("div"),"a",{get:function(){return 7}}).a!==7}),dS=ir,gv=tt,Sv=ni,K_=Ft,Y_=Js,jA=Jd,Tv=Bi,GA=mv,Ep=Object.getOwnPropertyDescriptor;zo.f=dS?Ep:function(n,e){if(n=Y_(n),e=jA(e),GA)try{return Ep(n,e)}catch{}if(Tv(n,e))return K_(!gv(Sv.f,n,e),n[e])};var Gl=re,Rv=Jt,BE=/#|\.prototype\./,ks=function(n,e){var t=lS[vv(n)];return t===uS||t!==WA&&(Rv(e)?Gl(e):!!e)},vv=ks.normalize=function(n){return String(n).replace(BE,".").toLowerCase()},lS=ks.data={},WA=ks.NATIVE="N",uS=ks.POLYFILL="P",z_=ks,HA=pr,To=pe,mp=ha(ha.bind),rs=function(n,e){return HA(n),e===void 0?n:To?mp(n,e):function(){return n.apply(e,arguments)}},pn={},yv=ir&&re(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Cv=Ir,bv=String,jE=TypeError,Vr=function(n){if(Cv(n))return n;throw new jE(bv(n)+" is not an object")},KA=ir,fN=mv,EN=yv,gp=Vr,GE=Jd,mN=TypeError,WE=Object.defineProperty,gN=Object.getOwnPropertyDescriptor,HE="enumerable",KE="configurable",q_="writable";pn.f=KA?EN?function(n,e,t){if(gp(n),e=GE(e),gp(t),typeof n=="function"&&e==="prototype"&&"value"in t&&q_ in t&&!t[q_]){var i=gN(n,e);i&&i[q_]&&(n[e]=t.value,t={configurable:KE in t?t[KE]:i[KE],enumerable:HE in t?t[HE]:i[HE],writable:!1})}return WE(n,e,t)}:WE:function(n,e,t){if(gp(n),e=GE(e),gp(t),fN)try{return WE(n,e,t)}catch{}if("get"in t||"set"in t)throw new mN("Accessors not supported");return"value"in t&&(n[e]=t.value),n};var SN=pn,TN=Ft,Xo=ir?function(n,e,t){return SN.f(n,e,TN(1,t))}:function(n,e,t){return n[e]=t,n},Wl=ke,Av=kt,RN=ha,vN=Jt,yN=zo.f,YA=z_,id=bn,CN=rs,rd=Xo,Iv=Bi,bN=function(n){var e=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new n;case 1:return new n(t);case 2:return new n(t,i)}return new n(t,i,r)}return Av(n,this,arguments)};return e.prototype=n.prototype,e},dt=function(n,e){var t,i,r,a,s,o,c,d,l,h=n.target,_=n.global,f=n.stat,m=n.proto,S=_?Wl:f?Wl[h]:Wl[h]&&Wl[h].prototype,T=_?id:id[h]||rd(id,h,{})[h],R=T.prototype;for(a in e)i=!(t=YA(_?a:h+(f?".":"#")+a,n.forced))&&S&&Iv(S,a),o=T[a],i&&(c=n.dontCallGetSet?(l=yN(S,a))&&l.value:S[a]),s=i&&c?c:e[a],(t||m||typeof o!=typeof s)&&(d=n.bind&&i?CN(s,Wl):n.wrap&&i?bN(s):m&&vN(s)?RN(s):s,(n.sham||s&&s.sham||o&&o.sham)&&rd(d,"sham",!0),rd(T,a,d),m&&(Iv(id,r=h+"Prototype")||rd(id,r,{}),rd(id[r],a,s),n.real&&R&&(t||!R[a])&&rd(R,a,s)))},AN=Math.ceil,IN=Math.floor,wN=Math.trunc||function(n){var e=+n;return(e>0?IN:AN)(e)},wv=wN,Hl=function(n){var e=+n;return e!=e||e===0?0:wv(e)},ON=Hl,zA=Math.max,qA=Math.min,X_=function(n,e){var t=ON(n);return t<0?zA(t+e,0):qA(t,e)},XA=Hl,JA=Math.min,dh=function(n){var e=XA(n);return e>0?JA(e,9007199254740991):0},NN=dh,Zs=function(n){return NN(n.length)},DN=Js,ZA=X_,QA=Zs,Sp=function(n){return function(e,t,i){var r=DN(e),a=QA(r);if(a===0)return!n&&-1;var s,o=ZA(i,a);if(n&&t!=t){for(;a>o;)if((s=r[o++])!=s)return!0}else for(;a>o;o++)if((n||o in r)&&r[o]===t)return n||o||0;return!n&&-1}},Kl={includes:Sp(!0),indexOf:Sp(!1)},PN=Kl.includes;dt({target:"Array",proto:!0,forced:re(function(){return!Array(1).includes()})},{includes:function(n){return PN(this,n,arguments.length>1?arguments[1]:void 0)}});var hS=ke,$A=bn,Bn=function(n,e){var t=$A[n+"Prototype"],i=t&&t[e];if(i)return i;var r=hS[n],a=r&&r.prototype;return a&&a[e]},Ov=Bn("Array","includes"),Nv=Ir,eI=tr,tI=ci("match"),pS=function(n){var e;return Nv(n)&&((e=n[tI])!==void 0?!!e:eI(n)==="RegExp")},LN=pS,kN=TypeError,Dv={};Dv[ci("toStringTag")]="z";var YE=String(Dv)==="[object z]",MN=YE,Jo=Jt,nd=tr,iI=ci("toStringTag"),rI=Object,nI=nd((function(){return arguments})())==="Arguments",Ms=MN?nd:function(n){var e,t,i;return n===void 0?"Undefined":n===null?"Null":typeof(t=(function(r,a){try{return r[a]}catch{}})(e=rI(n),iI))=="string"?t:nI?nd(e):(i=nd(e))==="Object"&&Jo(e.callee)?"Arguments":i},Pv=Ms,UN=String,Fr=function(n){if(Pv(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return UN(n)},Lv=ci("match"),zE=dt,kv=function(n){if(LN(n))throw new kN("The method doesn't accept regular expressions");return n},aI=Xs,Yl=Fr,J_=function(n){var e=/./;try{"/./"[n](e)}catch{try{return e[Lv]=!1,"/./"[n](e)}catch{}}return!1},Mv=ye("".indexOf);zE({target:"String",proto:!0,forced:!J_("includes")},{includes:function(n){return!!~Mv(Yl(aI(this)),Yl(kv(n)),arguments.length>1?arguments[1]:void 0)}});var sI=Bn("String","includes"),zl=Be,oI=Ov,cI=sI,Z_=Array.prototype,qE=String.prototype,xN=function(n){var e=n.includes;return n===Z_||zl(Z_,n)&&e===Z_.includes?oI:typeof n=="string"||n===qE||zl(qE,n)&&e===qE.includes?cI:e},ee=X(xN),dI=pr,lI=Pa,Uv=mo,ad=Zs,_S=TypeError,Ro="Reduce of empty array with no initial value",bc=function(n){return function(e,t,i,r){var a=lI(e),s=Uv(a),o=ad(a);if(dI(t),o===0&&i<2)throw new _S(Ro);var c=0,d=1;if(i<2)for(;;){if(c in s){r=s[c],c+=d;break}if(c+=d,o<=c)throw new _S(Ro)}for(;o>c;c+=d)c in s&&(r=t(r,s[c],c,a));return r}},Q_={left:bc()},xv=re,Zd=function(n,e){var t=[][n];return!!t&&xv(function(){t.call(null,e||function(){return 1},1)})},Ac=ke,Vv=$r,$_=tr,lh=function(n){return Vv.slice(0,n.length)===n},uh=lh("Bun/")?"BUN":lh("Cloudflare-Workers")?"CLOUDFLARE":lh("Deno/")?"DENO":lh("Node.js/")?"NODE":Ac.Bun&&typeof Bun.version=="string"?"BUN":Ac.Deno&&typeof Deno.version=="object"?"DENO":$_(Ac.process)==="process"?"NODE":Ac.window&&Ac.document?"BROWSER":"REST",Ic=uh==="NODE",VN=Q_.left;dt({target:"Array",proto:!0,forced:!Ic&&Ps>79&&Ps<83||!Zd("reduce")},{reduce:function(n){var e=arguments.length;return VN(this,n,e,e>1?arguments[1]:void 0)}});var Zo=Bn("Array","reduce"),Fv=Be,ql=Zo,ef=Array.prototype,fS=function(n){var e=n.reduce;return n===ef||Fv(ef,n)&&e===ef.reduce?ql:e},Xl=fS,Pn=X(Xl),Bv=tr,vo=Array.isArray||function(n){return Bv(n)==="Array"},tf=dt,ES=vo,mS=ye([].reverse),yo=[1,2];tf({target:"Array",proto:!0,forced:String(yo)===String(yo.reverse())},{reverse:function(){return ES(this)&&(this.length=this.length),mS(this)}});var wc=Bn("Array","reverse"),Tp=Be,Jl=wc,Qo=Array.prototype,Rp=function(n){var e=n.reverse;return n===Qo||Tp(Qo,n)&&e===Qo.reverse?Jl:e},gS=Rp,XE=X(gS),jv=Xd,ms=Es("keys"),sn=function(n){return ms[n]||(ms[n]=jv(n))},Hr=!re(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),vp=Bi,Qd=Jt,Gv=Pa,yp=Hr,SS=sn("IE_PROTO"),rf=Object,JE=rf.prototype,Zl=yp?rf.getPrototypeOf:function(n){var e=Gv(n);if(vp(e,SS))return e[SS];var t=e.constructor;return Qd(t)&&e instanceof t?t.prototype:e instanceof rf?JE:null},uI=ye,ZE=pr,Wv=Ir,Cp=function(n){return Wv(n)||n===null},Ql=String,hh=TypeError,$l=function(n,e,t){try{return uI(ZE(Object.getOwnPropertyDescriptor(n,e)[t]))}catch{}},Hv=Ir,Kv=Xs,QE=function(n){if(Cp(n))return n;throw new hh("Can't set "+Ql(n)+" as a prototype")},TS=Object.setPrototypeOf||("__proto__"in{}?(function(){var n,e=!1,t={};try{(n=$l(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch{}return function(i,r){return Kv(i),QE(r),Hv(i)&&(e?n(i,r):i.__proto__=r),i}})():void 0),$o={},ra={},ph=Bi,hI=Js,FN=Kl.indexOf,BN=ra,Yv=ye([].push),pa=function(n,e){var t,i=hI(n),r=0,a=[];for(t in i)!ph(BN,t)&&ph(i,t)&&Yv(a,t);for(;e.length>r;)ph(i,t=e[r++])&&(~FN(a,t)||Yv(a,t));return a},bp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],$E=pa,em=bp.concat("length","prototype");$o.f=Object.getOwnPropertyNames||function(n){return $E(n,em)};var sd={};sd.f=Object.getOwnPropertySymbols;var nf=wr,af=$o,jN=sd,pI=Vr,GN=ye([].concat),_I=nf("Reflect","ownKeys")||function(n){var e=af.f(pI(n)),t=jN.f;return t?GN(e,t(n)):e},eu=Bi,zv=_I,RS=zo,fI=pn,tu={},EI=pa,vS=bp,iu=Object.keys||function(n){return EI(n,vS)},mI=ir,yS=yv,gI=pn,tm=Vr,SI=Js,TI=iu;tu.f=mI&&!yS?Object.defineProperties:function(n,e){tm(n);for(var t,i=SI(e),r=TI(e),a=r.length,s=0;a>s;)gI.f(n,t=r[s++],i[t]);return n};var Co,im=wr("document","documentElement"),qv=Vr,_h=tu,$d=bp,rm=ra,Xv=im,Jv=fp,ru="prototype",nu="script",CS=sn("IE_PROTO"),sf=function(){},fh=function(n){return"<"+nu+">"+n+"</"+nu+">"},of=function(n){n.write(fh("")),n.close();var e=n.parentWindow.Object;return n=null,e},Eh=function(){try{Co=new ActiveXObject("htmlfile")}catch{}var n,e,t;Eh=typeof document<"u"?document.domain&&Co?of(Co):(e=Jv("iframe"),t="java"+nu+":",e.style.display="none",Xv.appendChild(e),e.src=String(t),(n=e.contentWindow.document).open(),n.write(fh("document.F=Object")),n.close(),n.F):of(Co);for(var i=$d.length;i--;)delete Eh[ru][$d[i]];return Eh()};rm[CS]=!0;var od=Object.create||function(n,e){var t;return n!==null?(sf[ru]=qv(n),t=new sf,sf[ru]=null,t[CS]=n):t=Eh(),e===void 0?t:_h.f(t,e)},Zv=Ir,mh=Xo,Gi=Error,on=ye("".replace),La=String(new Gi("zxcasd").stack),cf=/\n\s*at [^:]*:[^\n]*/,df=cf.test(La),Ap=Ft,bS=!re(function(){var n=new Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",Ap(1,7)),n.stack!==7)}),nm=Xo,lf=function(n,e){if(df&&typeof n=="string"&&!Gi.prepareStackTrace)for(;e--;)n=on(n,cf,"");return n},WN=bS,qn=Error.captureStackTrace,ec={},Qv=ec,RI=ci("iterator"),vI=Array.prototype,$v=function(n){return n!==void 0&&(Qv.Array===n||vI[RI]===n)},ey=Ms,am=vc,ty=Fl,bo=ec,ka=ci("iterator"),au=function(n){if(!ty(n))return am(n,ka)||am(n,"@@iterator")||bo[ey(n)]},sm=tt,AS=pr,iy=Vr,su=qo,IS=au,ry=TypeError,Ip=function(n,e){var t=arguments.length<2?IS(n):e;if(AS(t))return iy(sm(t,n));throw new ry(su(n)+" is not iterable")},yI=tt,wS=Vr,CI=vc,OS=function(n,e,t){var i,r;wS(n);try{if(!(i=CI(n,"return"))){if(e==="throw")throw t;return t}i=yI(i,n)}catch(a){r=!0,i=a}if(e==="throw")throw t;if(r)throw i;return wS(i),t},bI=rs,AI=tt,ny=Vr,II=qo,HN=$v,wI=Zs,NS=Be,OI=Ip,ay=au,DS=OS,NI=TypeError,gh=function(n,e){this.stopped=n,this.result=e},PS=gh.prototype,el=function(n,e,t){var i,r,a,s,o,c,d,l=t&&t.that,h=!(!t||!t.AS_ENTRIES),_=!(!t||!t.IS_RECORD),f=!(!t||!t.IS_ITERATOR),m=!(!t||!t.INTERRUPTED),S=bI(e,l),T=function(C){return i&&DS(i,"normal",C),new gh(!0,C)},R=function(C){return h?(ny(C),m?S(C[0],C[1],T):S(C[0],C[1])):m?S(C,T):S(C)};if(_)i=n.iterator;else if(f)i=n;else{if(!(r=ay(n)))throw new NI(II(n)+" is not iterable");if(HN(r)){for(a=0,s=wI(n);s>a;a++)if((o=R(n[a]))&&NS(PS,o))return o;return new gh(!1)}i=OI(n,r)}for(c=_?n.next:i.next;!(d=AI(c,i)).done;){try{o=R(d.value)}catch(C){DS(i,"throw",C)}if(typeof o=="object"&&o&&NS(PS,o))return o}return new gh(!1)},KN=Fr,DI=dt,uf=Be,LS=Zl,Sh=TS,kS=function(n,e,t){for(var i=zv(e),r=fI.f,a=RS.f,s=0;s<i.length;s++){var o=i[s];eu(n,o)||t&&eu(t,o)||r(n,o,a(e,o))}},wp=od,hf=Xo,pf=Ft,PI=function(n,e){Zv(e)&&"cause"in e&&mh(n,"cause",e.cause)},LI=function(n,e,t,i){WN&&(qn?qn(n,e):nm(n,"stack",lf(t,i)))},kI=el,MI=function(n,e){return n===void 0?arguments.length<2?"":e:KN(n)},sy=ci("toStringTag"),Th=Error,UI=[].push,tc=function(n,e){var t,i=uf(_f,this);Sh?t=Sh(new Th,i?LS(this):_f):(t=i?this:wp(_f),hf(t,sy,"Error")),e!==void 0&&hf(t,"message",MI(e)),LI(t,tc,t.stack,1),arguments.length>2&&PI(t,arguments[2]);var r=[];return kI(n,UI,{that:r}),hf(t,"errors",r),t};Sh?Sh(tc,Th):kS(tc,Th,{name:!0});var _f=tc.prototype=wp(Th.prototype,{constructor:pf(1,tc),message:pf(1,""),name:pf(1,"AggregateError")});DI({global:!0},{AggregateError:tc});var Rh,ou,cu,xI=Jt,MS=ke.WeakMap,oy=xI(MS)&&/native code/.test(String(MS)),US=ke,VI=Ir,YN=Xo,om=Bi,ff=j_,cm=sn,cy=ra,Ef="Object already initialized",mf=US.TypeError,FI=US.WeakMap;if(oy||ff.state){var na=ff.state||(ff.state=new FI);na.get=na.get,na.has=na.has,na.set=na.set,Rh=function(n,e){if(na.has(n))throw new mf(Ef);return e.facade=n,na.set(n,e),e},ou=function(n){return na.get(n)||{}},cu=function(n){return na.has(n)}}else{var Oc=cm("state");cy[Oc]=!0,Rh=function(n,e){if(om(n,Oc))throw new mf(Ef);return e.facade=n,YN(n,Oc,e),e},ou=function(n){return om(n,Oc)?n[Oc]:{}},cu=function(n){return om(n,Oc)}}var Ao,dy,vh,gs={set:Rh,get:ou,has:cu,enforce:function(n){return cu(n)?ou(n):Rh(n,{})},getterFor:function(n){return function(e){var t;if(!VI(e)||(t=ou(e)).type!==n)throw new mf("Incompatible receiver, "+n+" required");return t}}},yh=ir,dm=Bi,gf=Function.prototype,BI=yh&&Object.getOwnPropertyDescriptor,xS=dm(gf,"name"),Ch={PROPER:xS&&(function(){}).name==="something",CONFIGURABLE:xS&&(!yh||yh&&BI(gf,"name").configurable)},jI=Xo,An=function(n,e,t,i){return i&&i.enumerable?n[e]=t:jI(n,e,t),n},tl=re,bh=Jt,GI=Ir,Ah=od,cd=Zl,Wa=An,Ih=ci("iterator"),lm=!1;[].keys&&("next"in(vh=[].keys())?(dy=cd(cd(vh)))!==Object.prototype&&(Ao=dy):lm=!0);var ly=!GI(Ao)||tl(function(){var n={};return Ao[Ih].call(n)!==n});bh((Ao=ly?{}:Ah(Ao))[Ih])||Wa(Ao,Ih,function(){return this});var VS={IteratorPrototype:Ao,BUGGY_SAFARI_ITERATORS:lm},WI=Ms,Op=YE?{}.toString:function(){return"[object "+WI(this)+"]"},FS=YE,HI=pn.f,KI=Xo,YI=Bi,BS=Op,jS=ci("toStringTag"),Ha=function(n,e,t,i){var r=t?n:n&&n.prototype;r&&(YI(r,jS)||HI(r,jS,{configurable:!0,value:e}),i&&!FS&&KI(r,"toString",BS))},zI=VS.IteratorPrototype,qI=od,zN=Ft,XI=Ha,ns=ec,Ss=function(){return this},Sf=function(n,e,t,i){var r=e+" Iterator";return n.prototype=qI(zI,{next:zN(+!i,t)}),XI(n,r,!1,!0),ns[r]=Ss,n},JI=dt,ZI=tt,QI=Ch,$I=Sf,GS=Zl,uy=Ha,WS=An,HS=ec,ew=VS,hy=QI.PROPER,du=ew.BUGGY_SAFARI_ITERATORS,Np=ci("iterator"),KS="keys",lu="values",Tf="entries",py=function(){return this},YS=function(n,e,t,i,r,a,s){$I(t,e,i);var o,c,d,l=function(R){if(R===r&&S)return S;if(!du&&R&&R in f)return f[R];switch(R){case KS:case lu:case Tf:return function(){return new t(this,R)}}return function(){return new t(this)}},h=e+" Iterator",_=!1,f=n.prototype,m=f[Np]||f["@@iterator"]||r&&f[r],S=!du&&m||l(r),T=e==="Array"&&f.entries||m;if(T&&(o=GS(T.call(new n)))!==Object.prototype&&o.next&&(uy(o,h,!0,!0),HS[h]=py),hy&&r===lu&&m&&m.name!==lu&&(_=!0,S=function(){return ZI(m,this)}),r)if(c={values:l(lu),keys:a?S:l(KS),entries:l(Tf)},s)for(d in c)(du||_||!(d in f))&&WS(f,d,c[d]);else JI({target:e,proto:!0,forced:du||_},c);return s&&f[Np]!==S&&WS(f,Np,S,{}),HS[e]=S,c},uu=function(n,e){return{value:n,done:e}},tw=Js,dd=ec,um=gs;pn.f;var qN=YS,wh=uu,ld="Array Iterator",iw=um.set,zS=um.getterFor(ld);qN(Array,"Array",function(n,e){iw(this,{type:ld,target:tw(n),index:0,kind:e})},function(){var n=zS(this),e=n.target,t=n.index++;if(!e||t>=e.length)return n.target=null,wh(void 0,!0);switch(n.kind){case"keys":return wh(t,!1);case"values":return wh(e[t],!1)}return wh([t,e[t]],!1)},"values"),dd.Arguments=dd.Array;var hm=pn,en=function(n,e,t){return hm.f(n,e,t)},XN=wr,JN=en,rw=ir,Dp=ci("species"),Oh=Be,nw=TypeError,Rf=function(n,e){if(Oh(e,n))return n;throw new nw("Incorrect invocation")},pm=Jt,Io=j_,aw=ye(Function.toString);pm(Io.inspectSource)||(Io.inspectSource=function(n){return aw(n)});var _m=Io.inspectSource,sw=ye,_y=re,fm=Jt,qS=Ms,ow=_m,ud=function(){},Xn=wr("Reflect","construct"),Pp=/^\s*(?:class|function)\b/,cw=sw(Pp.exec),as=!Pp.test(ud),hu=function(n){if(!fm(n))return!1;try{return Xn(ud,[],n),!0}catch{return!1}},XS=function(n){if(!fm(n))return!1;switch(qS(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return as||!!cw(Pp,ow(n))}catch{return!0}};XS.sham=!0;var il,_r,Us,ic,Nh=!Xn||_y(function(){var n;return hu(hu.call)||!hu(Object)||!hu(function(){n=!0})||n})?XS:hu,dw=Nh,ZN=qo,fy=TypeError,Qs=Vr,hd=function(n){if(dw(n))return n;throw new fy(ZN(n)+" is not a constructor")},lw=Fl,rc=ci("species"),vf=function(n,e){var t,i=Qs(n).constructor;return i===void 0||lw(t=Qs(i)[rc])?e:hd(t)},aa=ye([].slice),Lp=TypeError,Ma=function(n,e){if(n<e)throw new Lp("Not enough arguments");return n},Em=/(?:ipad|iphone|ipod).*applewebkit/i.test($r),_n=ke,rl=kt,uw=rs,Dh=Jt,mm=Bi,kp=re,Ph=im,hw=aa,JS=fp,gm=Ma,pw=Em,ZS=Ic,yf=_n.setImmediate,Sm=_n.clearImmediate,QN=_n.process,Or=_n.Dispatch,In=_n.Function,Yi=_n.MessageChannel,fr=_n.String,Nr=0,_a={},nl="onreadystatechange";kp(function(){il=_n.location});var al=function(n){if(mm(_a,n)){var e=_a[n];delete _a[n],e()}},Mp=function(n){return function(){al(n)}},pd=function(n){al(n.data)},jn=function(n){_n.postMessage(fr(n),il.protocol+"//"+il.host)};yf&&Sm||(yf=function(n){gm(arguments.length,1);var e=Dh(n)?n:In(n),t=hw(arguments,1);return _a[++Nr]=function(){rl(e,void 0,t)},_r(Nr),Nr},Sm=function(n){delete _a[n]},ZS?_r=function(n){QN.nextTick(Mp(n))}:Or&&Or.now?_r=function(n){Or.now(Mp(n))}:Yi&&!pw?(ic=(Us=new Yi).port2,Us.port1.onmessage=pd,_r=uw(ic.postMessage,ic)):_n.addEventListener&&Dh(_n.postMessage)&&!_n.importScripts&&il&&il.protocol!=="file:"&&!kp(jn)?(_r=jn,_n.addEventListener("message",pd,!1)):_r=nl in JS("script")?function(n){Ph.appendChild(JS("script"))[nl]=function(){Ph.removeChild(this),al(n)}}:function(n){setTimeout(Mp(n),0)});var wo={set:yf,clear:Sm},pu=ke,Ey=ir,Nc=Object.getOwnPropertyDescriptor,Lh=function(n){if(!Ey)return pu[n];var e=Nc(pu,n);return e&&e.value},Up=function(){this.head=null,this.tail=null};Up.prototype={add:function(n){var e={item:n,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var n=this.head;if(n)return(this.head=n.next)===null&&(this.tail=null),n.item}};var Gn,xp,Vp,kh,Cf,sl=Up,Ts=/ipad|iphone|ipod/i.test($r)&&typeof Pebble<"u",Mh=/web0s(?!.*chrome)/i.test($r),xs=ke,bf=Lh,Tm=rs,Fp=wo.set,_w=sl,Rm=Em,my=Ts,nc=Mh,Af=Ic,$s=xs.MutationObserver||xs.WebKitMutationObserver,QS=xs.document,$S=xs.process,Bp=xs.Promise,Dc=bf("queueMicrotask");if(!Dc){var ol=new _w,_u=function(){var n,e;for(Af&&(n=$S.domain)&&n.exit();e=ol.get();)try{e()}catch(t){throw ol.head&&Gn(),t}n&&n.enter()};Rm||Af||nc||!$s||!QS?!my&&Bp&&Bp.resolve?((kh=Bp.resolve(void 0)).constructor=Bp,Cf=Tm(kh.then,kh),Gn=function(){Cf(_u)}):Af?Gn=function(){$S.nextTick(_u)}:(Fp=Tm(Fp,xs),Gn=function(){Fp(_u)}):(xp=!0,Vp=QS.createTextNode(""),new $s(_u).observe(Vp,{characterData:!0}),Gn=function(){Vp.data=xp=!xp}),Dc=function(n){ol.head||Gn(),ol.add(n)}}var Uh=Dc,Pc=function(n){try{return{error:!1,value:n()}}catch(e){return{error:!0,value:e}}},Oo=ke.Promise,fw=ke,_d=Oo,gy=Jt,$N=z_,eD=_m,tD=ci,eT=uh,If=Ps,xh=_d&&_d.prototype,tT=tD("species"),iT=gy(fw.PromiseRejectionEvent),Ew=$N("Promise",function(){var n=eD(_d),e=n!==String(_d);if(!e&&If===66||!xh.catch||!xh.finally)return!0;if(!If||If<51||!/native code/.test(n)){var t=new _d(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((t.constructor={})[tT]=i,!(t.then(function(){})instanceof i))return!0}return!(e||eT!=="BROWSER"&&eT!=="DENO"||iT)}),cl={CONSTRUCTOR:Ew,REJECTION_EVENT:iT},Ua={},rT=pr,mw=TypeError,nT=function(n){var e,t;this.promise=new n(function(i,r){if(e!==void 0||t!==void 0)throw new mw("Bad Promise constructor");e=i,t=r}),this.resolve=rT(e),this.reject=rT(t)};Ua.f=function(n){return new nT(n)};var wf,aT,fn=dt,fu=Ic,eo=ke,dl=tt,iD=An,rD=Ha,nD=function(n){var e=XN(n);rw&&e&&!e[Dp]&&JN(e,Dp,{configurable:!0,get:function(){return this}})},sT=pr,ll=Jt,Sy=Ir,oT=Rf,Ty=vf,Eu=wo.set,No=Uh,vm=function(n,e){try{arguments.length===1?console.error(n):console.error(n,e)}catch{}},aD=Pc,gw=sl,cT=gs,Of=Oo,dT=cl,Ry=Ua,mu="Promise",lT=dT.CONSTRUCTOR,Sw=dT.REJECTION_EVENT,ym=cT.getterFor(mu),vy=cT.set,yy=Of&&Of.prototype,gu=Of,Cm=yy,jp=eo.TypeError,bm=eo.document,Nf=eo.process,Wi=Ry.f,Cy=Wi,uT=!!(bm&&bm.createEvent&&eo.dispatchEvent),Am="unhandledrejection",hT=function(n){var e;return!(!Sy(n)||!ll(e=n.then))&&e},Im=function(n,e){var t,i,r,a=e.value,s=e.state===1,o=s?n.ok:n.fail,c=n.resolve,d=n.reject,l=n.domain;try{o?(s||(e.rejection===2&&sD(e),e.rejection=1),o===!0?t=a:(l&&l.enter(),t=o(a),l&&(l.exit(),r=!0)),t===n.promise?d(new jp("Promise-chain cycle")):(i=hT(t))?dl(i,t,c,d):c(t)):d(a)}catch(h){l&&!r&&l.exit(),d(h)}},Gp=function(n,e){n.notified||(n.notified=!0,No(function(){for(var t,i=n.reactions;t=i.get();)Im(t,n);n.notified=!1,e&&!n.rejection&&Pf(n)}))},Df=function(n,e,t){var i,r;uT?((i=bm.createEvent("Event")).promise=e,i.reason=t,i.initEvent(n,!1,!0),eo.dispatchEvent(i)):i={promise:e,reason:t},!Sw&&(r=eo["on"+n])?r(i):n===Am&&vm("Unhandled promise rejection",t)},Pf=function(n){dl(Eu,eo,function(){var e,t=n.facade,i=n.value;if(pT(n)&&(e=aD(function(){fu?Nf.emit("unhandledRejection",i,t):Df(Am,t,i)}),n.rejection=fu||pT(n)?2:1,e.error))throw e.value})},pT=function(n){return n.rejection!==1&&!n.parent},sD=function(n){dl(Eu,eo,function(){var e=n.facade;fu?Nf.emit("rejectionHandled",e):Df("rejectionhandled",e,n.value)})},fd=function(n,e,t){return function(i){n(e,i,t)}},Lc=function(n,e,t){n.done||(n.done=!0,t&&(n=t),n.value=e,n.state=2,Gp(n,!0))},Lf=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw new jp("Promise can't be resolved itself");var i=hT(e);i?No(function(){var r={done:!1};try{dl(i,e,fd(Lf,r,n),fd(Lc,r,n))}catch(a){Lc(r,a,n)}}):(n.value=e,n.state=1,Gp(n,!1))}catch(r){Lc({done:!1},r,n)}}};lT&&(Cm=(gu=function(n){oT(this,Cm),sT(n),dl(wf,this);var e=ym(this);try{n(fd(Lf,e),fd(Lc,e))}catch(t){Lc(e,t)}}).prototype,(wf=function(n){vy(this,{type:mu,done:!1,notified:!1,parent:!1,reactions:new gw,rejection:!1,state:0,value:null})}).prototype=iD(Cm,"then",function(n,e){var t=ym(this),i=Wi(Ty(this,gu));return t.parent=!0,i.ok=!ll(n)||n,i.fail=ll(e)&&e,i.domain=fu?Nf.domain:void 0,t.state===0?t.reactions.add(i):No(function(){Im(i,t)}),i.promise}),aT=function(){var n=new wf,e=ym(n);this.promise=n,this.resolve=fd(Lf,e),this.reject=fd(Lc,e)},Ry.f=Wi=function(n){return n===gu||n===void 0?new aT(n):Cy(n)}),fn({global:!0,wrap:!0,forced:lT},{Promise:gu}),rD(gu,mu,!1,!0),nD(mu);var kf=ci("iterator"),Xr=!1;try{var by=0,Ka={next:function(){return{done:!!by++}},return:function(){Xr=!0}};Ka[kf]=function(){return this},Array.from(Ka,function(){throw 2})}catch{}var oD=Oo,Ay=function(n,e){try{if(!e&&!Xr)return!1}catch{return!1}var t=!1;try{var i={};i[kf]=function(){return{next:function(){return{done:t=!0}}}},n(i)}catch{}return t},Su=cl.CONSTRUCTOR||!Ay(function(n){oD.all(n).then(void 0,function(){})}),_T=tt,Tw=pr,Rw=Ua,Iy=Pc,wy=el;dt({target:"Promise",stat:!0,forced:Su},{all:function(n){var e=this,t=Rw.f(e),i=t.resolve,r=t.reject,a=Iy(function(){var s=Tw(e.resolve),o=[],c=0,d=1;wy(n,function(l){var h=c++,_=!1;d++,_T(s,e,l).then(function(f){_||(_=!0,o[h]=f,--d||i(o))},r)}),--d||i(o)});return a.error&&r(a.value),t.promise}});var cD=dt,vw=cl.CONSTRUCTOR;Oo&&Oo.prototype,cD({target:"Promise",proto:!0,forced:vw,real:!0},{catch:function(n){return this.then(void 0,n)}});var dD=tt,yw=pr,lD=Ua,uD=Pc,Vh=el;dt({target:"Promise",stat:!0,forced:Su},{race:function(n){var e=this,t=lD.f(e),i=t.reject,r=uD(function(){var a=yw(e.resolve);Vh(n,function(s){dD(a,e,s).then(t.resolve,i)})});return r.error&&i(r.value),t.promise}});var Cw=Ua;dt({target:"Promise",stat:!0,forced:cl.CONSTRUCTOR},{reject:function(n){var e=Cw.f(this);return(0,e.reject)(n),e.promise}});var Oy=Vr,hD=Ir,pD=Ua,wm=function(n,e){if(Oy(n),hD(e)&&e.constructor===n)return e;var t=pD.f(n);return(0,t.resolve)(e),t.promise},_D=dt,Ed=Oo,Ny=cl.CONSTRUCTOR,bw=wm,Aw=wr("Promise"),Om=!Ny;_D({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return bw(Om&&this===Aw?Ed:this,n)}});var kc=tt,Iw=pr,fT=Ua,Tu=Pc,fD=el;dt({target:"Promise",stat:!0,forced:Su},{allSettled:function(n){var e=this,t=fT.f(e),i=t.resolve,r=t.reject,a=Tu(function(){var s=Iw(e.resolve),o=[],c=0,d=1;fD(n,function(l){var h=c++,_=!1;d++,kc(s,e,l).then(function(f){_||(_=!0,o[h]={status:"fulfilled",value:f},--d||i(o))},function(f){_||(_=!0,o[h]={status:"rejected",reason:f},--d||i(o))})}),--d||i(o)});return a.error&&r(a.value),t.promise}});var ED=tt,Mf=pr,ww=wr,mD=Ua,gD=Pc,SD=el,Dy="No one promise resolved";dt({target:"Promise",stat:!0,forced:Su},{any:function(n){var e=this,t=ww("AggregateError"),i=mD.f(e),r=i.resolve,a=i.reject,s=gD(function(){var o=Mf(e.resolve),c=[],d=0,l=1,h=!1;SD(n,function(_){var f=d++,m=!1;l++,ED(o,e,_).then(function(S){m||h||(h=!0,r(S))},function(S){m||h||(m=!0,c[f]=S,--l||a(new t(c,Dy)))})}),--l||a(new t(c,Dy))});return s.error&&a(s.value),i.promise}});var TD=dt,RD=kt,vD=aa,Ow=Ua,Uf=pr,Wp=Pc,xf=ke.Promise,Py=!1;TD({target:"Promise",stat:!0,forced:!xf||!xf.try||Wp(function(){xf.try(function(n){Py=n===8},8)}).error||!Py},{try:function(n){var e=arguments.length>1?vD(arguments,1):[],t=Ow.f(this),i=Wp(function(){return RD(Uf(n),void 0,e)});return(i.error?t.reject:t.resolve)(i.value),t.promise}});var Vf=Ua;dt({target:"Promise",stat:!0},{withResolvers:function(){var n=Vf.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var Nm=dt,Ff=Oo,ET=re,Ly=wr,ky=Jt,mT=vf,gT=wm,Nw=Ff&&Ff.prototype;Nm({target:"Promise",proto:!0,real:!0,forced:!!Ff&&ET(function(){Nw.finally.call({then:function(){}},function(){})})},{finally:function(n){var e=mT(this,Ly("Promise")),t=ky(n);return this.then(t?function(i){return gT(e,n()).then(function(){return i})}:n,t?function(i){return gT(e,n()).then(function(){throw i})}:n)}});var Dm=ye,Dw=Hl,Pm=Fr,yD=Xs,CD=Dm("".charAt),My=Dm("".charCodeAt),ST=Dm("".slice),Bf=function(n){return function(e,t){var i,r,a=Pm(yD(e)),s=Dw(t),o=a.length;return s<0||s>=o?n?"":void 0:(i=My(a,s))<55296||i>56319||s+1===o||(r=My(a,s+1))<56320||r>57343?n?CD(a,s):i:n?ST(a,s,s+2):r-56320+(i-55296<<10)+65536}},Hp={codeAt:Bf(!1),charAt:Bf(!0)},bD=Hp.charAt,Lm=Fr,Uy=gs,Pw=YS,TT=uu,RT="String Iterator",Lw=Uy.set,xy=Uy.getterFor(RT);Pw(String,"String",function(n){Lw(this,{type:RT,string:Lm(n),index:0})},function(){var n,e=xy(this),t=e.string,i=e.index;return i>=t.length?TT(void 0,!0):(n=bD(t,i),e.index+=n.length,TT(n,!1))});var kw=bn.Promise,vT={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},AD=ke,ID=Ha,km=ec;for(var Kp in vT)ID(AD[Kp],Kp),km[Kp]=km.Array;var jf=kw,se=X(jf),Mw=Bn("Array","values"),Vy=Ms,Fh=Bi,Bh=Be,jh=Mw,Ru=Array.prototype,Mm={DOMTokenList:!0,NodeList:!0},Gh=function(n){var e=n.values;return n===Ru||Bh(Ru,n)&&e===Ru.values||Fh(Mm,Vy(n))?jh:e},tn=X(Gh),yT=qo,Um=TypeError,Fy=aa,Uw=Math.floor,Wh=function(n,e){var t=n.length;if(t<8)for(var i,r,a=1;a<t;){for(r=a,i=n[a];r&&e(n[r-1],i)>0;)n[r]=n[--r];r!==a++&&(n[r]=i)}else for(var s=Uw(t/2),o=Wh(Fy(n,0,s),e),c=Wh(Fy(n,s),e),d=o.length,l=c.length,h=0,_=0;h<d||_<l;)n[h+_]=h<d&&_<l?e(o[h],c[_])<=0?o[h++]:c[_++]:h<d?o[h++]:c[_++];return n},CT=Wh,By=$r.match(/firefox\/(\d+)/i),bT=!!By&&+By[1],AT=/MSIE|Trident/.test($r),IT=$r.match(/AppleWebKit\/(\d+)\./),xm=!!IT&&+IT[1],jy=dt,Gf=ye,xw=pr,wD=Pa,Wf=Zs,u=function(n,e){if(!delete n[e])throw new Um("Cannot delete property "+yT(e)+" of "+yT(n))},p=Fr,E=re,g=CT,y=Zd,O=bT,H=AT,Z=Ps,le=xm,be=[],We=Gf(be.sort),Qe=Gf(be.push),De=E(function(){be.sort(void 0)}),Le=E(function(){be.sort(null)}),wi=y("sort"),ui=!E(function(){if(Z)return Z<70;if(!(O&&O>3)){if(H)return!0;if(le)return le<603;var n,e,t,i,r="";for(n=65;n<76;n++){switch(e=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(i=0;i<47;i++)be.push({k:e+i,v:t})}for(be.sort(function(a,s){return s.v-a.v}),i=0;i<be.length;i++)e=be[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});jy({target:"Array",proto:!0,forced:De||!Le||!wi||!ui},{sort:function(n){n!==void 0&&xw(n);var e=wD(this);if(ui)return n===void 0?We(e):We(e,n);var t,i,r=[],a=Wf(e);for(i=0;i<a;i++)i in e&&Qe(r,e[i]);for(g(r,(function(s){return function(o,c){return c===void 0?-1:o===void 0?1:s!==void 0?+s(o,c)||0:p(o)>p(c)?1:-1}})(n)),t=Wf(r),i=0;i<t;)e[i]=r[i++];for(;i<a;)u(e,i++);return e}});var cn=Bn("Array","sort"),Ce=Be,Se=cn,Ie=Array.prototype,Xe=function(n){var e=n.sort;return n===Ie||Ce(Ie,n)&&e===Ie.sort?Se:e},vt=X(Xe),Zi=dt,ii=ye,yi=X_,ss=RangeError,Er=String.fromCharCode,ul=String.fromCodePoint,OD=ii([].join);Zi({target:"String",stat:!0,forced:!!ul&&ul.length!==1},{fromCodePoint:function(n){for(var e,t=[],i=arguments.length,r=0;i>r;){if(e=+arguments[r++],yi(e,1114111)!==e)throw new ss(e+" is not a valid code point");t[r]=e<65536?Er(e):Er(55296+((e-=65536)>>10),e%1024+56320)}return OD(t,"")}});var dG=re,lG=ci("iterator"),Vm=!dG(function(){var n=new URL("b?a=1&b=2&c=3","https://a"),e=n.searchParams,t=new URLSearchParams("a=1&a=2&b=3"),i="";return n.pathname="c%20d",e.forEach(function(r,a){e.delete("b"),i+=a+r}),t.delete("a",2),t.delete("b",void 0),!n.toJSON||!t.has("a",1)||t.has("a",2)||!t.has("a",void 0)||t.has("b")||!e.size&&!0||!e.sort||n.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[lG]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),uG=An,Gy=dt,ND=ke,Wy=Lh,hG=wr,Fm=tt,Ya=ye,Yp=ir,DD=Vm,PD=An,pG=en,_G=function(n,e,t){for(var i in e)t&&t.unsafe&&n[i]?n[i]=e[i]:uG(n,i,e[i],t);return n},fG=Ha,EG=Sf,Hy=gs,LD=Rf,Ky=Jt,mG=Bi,gG=rs,SG=Ms,TG=Vr,kD=Ir,En=Fr,RG=od,MD=Ft,UD=Ip,vG=au,Bm=uu,vu=Ma,yG=CT,CG=ci("iterator"),yu="URLSearchParams",xD=yu+"Iterator",VD=Hy.set,fa=Hy.getterFor(yu),bG=Hy.getterFor(xD),FD=Wy("fetch"),jm=Wy("Request"),zp=Wy("Headers"),Yy=jm&&jm.prototype,BD=zp&&zp.prototype,AG=ND.TypeError,IG=ND.encodeURIComponent,wG=String.fromCharCode,OG=hG("String","fromCodePoint"),NG=parseInt,Gm=Ya("".charAt),jD=Ya([].join),ac=Ya([].push),GD=Ya("".replace),DG=Ya([].shift),WD=Ya([].splice),HD=Ya("".split),KD=Ya("".slice),PG=Ya(/./.exec),LG=/\+/g,kG=/^[0-9a-f]+$/i,YD=function(n,e){var t=KD(n,e,e+2);return PG(kG,t)?NG(t,16):NaN},MG=function(n){for(var e=0,t=128;t>0&&n&t;t>>=1)e++;return e},UG=function(n){var e=null;switch(n.length){case 1:e=n[0];break;case 2:e=(31&n[0])<<6|63&n[1];break;case 3:e=(15&n[0])<<12|(63&n[1])<<6|63&n[2];break;case 4:e=(7&n[0])<<18|(63&n[1])<<12|(63&n[2])<<6|63&n[3]}return e>1114111?null:e},zD=function(n){for(var e=(n=GD(n,LG," ")).length,t="",i=0;i<e;){var r=Gm(n,i);if(r==="%"){if(Gm(n,i+1)==="%"||i+3>e){t+="%",i++;continue}var a=YD(n,i+1);if(a!=a){t+=r,i++;continue}i+=2;var s=MG(a);if(s===0)r=wG(a);else{if(s===1||s>4){t+="�",i++;continue}for(var o=[a],c=1;c<s&&!(++i+3>e||Gm(n,i)!=="%");){var d=YD(n,i+1);if(d!=d){i+=3;break}if(d>191||d<128)break;ac(o,d),i+=2,c++}if(o.length!==s){t+="�";continue}var l=UG(o);l===null?t+="�":r=OG(l)}}t+=r,i++}return t},xG=/[!'()~]|%20/g,VG={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},FG=function(n){return VG[n]},qD=function(n){return GD(IG(n),xG,FG)},zy=EG(function(n,e){VD(this,{type:xD,target:fa(n).entries,index:0,kind:e})},yu,function(){var n=bG(this),e=n.target,t=n.index++;if(!e||t>=e.length)return n.target=null,Bm(void 0,!0);var i=e[t];switch(n.kind){case"keys":return Bm(i.key,!1);case"values":return Bm(i.value,!1)}return Bm([i.key,i.value],!1)},!0),XD=function(n){this.entries=[],this.url=null,n!==void 0&&(kD(n)?this.parseObject(n):this.parseQuery(typeof n=="string"?Gm(n,0)==="?"?KD(n,1):n:En(n)))};XD.prototype={type:yu,bindURL:function(n){this.url=n,this.update()},parseObject:function(n){var e,t,i,r,a,s,o,c=this.entries,d=vG(n);if(d)for(t=(e=UD(n,d)).next;!(i=Fm(t,e)).done;){if(a=(r=UD(TG(i.value))).next,(s=Fm(a,r)).done||(o=Fm(a,r)).done||!Fm(a,r).done)throw new AG("Expected sequence with length 2");ac(c,{key:En(s.value),value:En(o.value)})}else for(var l in n)mG(n,l)&&ac(c,{key:l,value:En(n[l])})},parseQuery:function(n){if(n)for(var e,t,i=this.entries,r=HD(n,"&"),a=0;a<r.length;)(e=r[a++]).length&&(t=HD(e,"="),ac(i,{key:zD(DG(t)),value:zD(jD(t,"="))}))},serialize:function(){for(var n,e=this.entries,t=[],i=0;i<e.length;)n=e[i++],ac(t,qD(n.key)+"="+qD(n.value));return jD(t,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Wm=function(){LD(this,Cu);var n=VD(this,new XD(arguments.length>0?arguments[0]:void 0));Yp||(this.size=n.entries.length)},Cu=Wm.prototype;if(_G(Cu,{append:function(n,e){var t=fa(this);vu(arguments.length,2),ac(t.entries,{key:En(n),value:En(e)}),Yp||this.length++,t.updateURL()},delete:function(n){for(var e=fa(this),t=vu(arguments.length,1),i=e.entries,r=En(n),a=t<2?void 0:arguments[1],s=a===void 0?a:En(a),o=0;o<i.length;){var c=i[o];if(c.key!==r||s!==void 0&&c.value!==s)o++;else if(WD(i,o,1),s!==void 0)break}Yp||(this.size=i.length),e.updateURL()},get:function(n){var e=fa(this).entries;vu(arguments.length,1);for(var t=En(n),i=0;i<e.length;i++)if(e[i].key===t)return e[i].value;return null},getAll:function(n){var e=fa(this).entries;vu(arguments.length,1);for(var t=En(n),i=[],r=0;r<e.length;r++)e[r].key===t&&ac(i,e[r].value);return i},has:function(n){for(var e=fa(this).entries,t=vu(arguments.length,1),i=En(n),r=t<2?void 0:arguments[1],a=r===void 0?r:En(r),s=0;s<e.length;){var o=e[s++];if(o.key===i&&(a===void 0||o.value===a))return!0}return!1},set:function(n,e){var t=fa(this);vu(arguments.length,1);for(var i,r=t.entries,a=!1,s=En(n),o=En(e),c=0;c<r.length;c++)(i=r[c]).key===s&&(a?WD(r,c--,1):(a=!0,i.value=o));a||ac(r,{key:s,value:o}),Yp||(this.size=r.length),t.updateURL()},sort:function(){var n=fa(this);yG(n.entries,function(e,t){return e.key>t.key?1:-1}),n.updateURL()},forEach:function(n){for(var e,t=fa(this).entries,i=gG(n,arguments.length>1?arguments[1]:void 0),r=0;r<t.length;)i((e=t[r++]).value,e.key,this)},keys:function(){return new zy(this,"keys")},values:function(){return new zy(this,"values")},entries:function(){return new zy(this,"entries")}},{enumerable:!0}),PD(Cu,CG,Cu.entries,{}),PD(Cu,"toString",function(){return fa(this).serialize()},{enumerable:!0}),Yp&&pG(Cu,"size",{get:function(){return fa(this).entries.length},configurable:!0,enumerable:!0}),fG(Wm,yu),Gy({global:!0,forced:!DD},{URLSearchParams:Wm}),!DD&&Ky(zp)){var BG=Ya(BD.has),jG=Ya(BD.set),JD=function(n){if(kD(n)){var e,t=n.body;if(SG(t)===yu)return e=n.headers?new zp(n.headers):new zp,BG(e,"content-type")||jG(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),RG(n,{body:MD(0,En(t)),headers:MD(0,e)})}return n};if(Ky(FD)&&Gy({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return FD(n,arguments.length>1?JD(arguments[1]):{})}}),Ky(jm)){var qy=function(n){return LD(this,Yy),new jm(n,arguments.length>1?JD(arguments[1]):{})};Yy.constructor=qy,qy.prototype=Yy,Gy({global:!0,dontCallGetSet:!0,forced:!0},{Request:qy})}}var Ea,GG={URLSearchParams:Wm,getState:fa},WG=bn.URLSearchParams,ZD=ir,HG=ye,KG=tt,YG=re,Xy=iu,zG=sd,qG=ni,XG=Pa,JG=mo,bu=Object.assign,QD=Object.defineProperty,ZG=HG([].concat),QG=!bu||YG(function(){if(ZD&&bu({b:1},bu(QD({},"a",{enumerable:!0,get:function(){QD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var n={},e={},t=Symbol("assign detection"),i="abcdefghijklmnopqrst";return n[t]=7,i.split("").forEach(function(r){e[r]=r}),bu({},n)[t]!==7||Xy(bu({},e)).join("")!==i})?function(n,e){for(var t=XG(n),i=arguments.length,r=1,a=zG.f,s=qG.f;i>r;)for(var o,c=JG(arguments[r++]),d=a?ZG(Xy(c),a(c)):Xy(c),l=d.length,h=0;l>h;)o=d[h++],ZD&&!KG(s,c,o)||(t[o]=c[o]);return t}:bu,$G=Vr,e5=OS,t5=ir,i5=pn,r5=Ft,Jy=function(n,e,t){t5?i5.f(n,e,r5(0,t)):n[e]=t},n5=rs,a5=tt,s5=Pa,o5=function(n,e,t,i){try{return i?e($G(t)[0],t[1]):e(t)}catch(r){e5(n,"throw",r)}},c5=$v,d5=Nh,l5=Zs,$D=Jy,u5=Ip,h5=au,eP=Array,md=ye,Zy=2147483647,p5=/[^\0-\u007E]/,tP=/[.\u3002\uFF0E\uFF61]/g,iP="Overflow: input needs wider integers to process",rP=RangeError,_5=md(tP.exec),Au=Math.floor,Qy=String.fromCharCode,nP=md("".charCodeAt),aP=md([].join),sc=md([].push),f5=md("".replace),E5=md("".split),m5=md("".toLowerCase),sP=function(n){return n+22+75*(n<26)},g5=function(n,e,t){var i=0;for(n=t?Au(n/700):n>>1,n+=Au(n/e);n>455;)n=Au(n/35),i+=36;return Au(i+36*n/(n+38))},S5=function(n){var e=[];n=(function(R){for(var C=[],b=0,N=R.length;b<N;){var k=nP(R,b++);if(k>=55296&&k<=56319&&b<N){var P=nP(R,b++);(64512&P)==56320?sc(C,((1023&k)<<10)+(1023&P)+65536):(sc(C,k),b--)}else sc(C,k)}return C})(n);var t,i,r=n.length,a=128,s=0,o=72;for(t=0;t<n.length;t++)(i=n[t])<128&&sc(e,Qy(i));var c=e.length,d=c;for(c&&sc(e,"-");d<r;){var l=Zy;for(t=0;t<n.length;t++)(i=n[t])>=a&&i<l&&(l=i);var h=d+1;if(l-a>Au((Zy-s)/h))throw new rP(iP);for(s+=(l-a)*h,a=l,t=0;t<n.length;t++){if((i=n[t])<a&&++s>Zy)throw new rP(iP);if(i===a){for(var _=s,f=36;;){var m=f<=o?1:f>=o+26?26:f-o;if(_<m)break;var S=_-m,T=36-m;sc(e,Qy(sP(m+S%T))),_=Au(S/T),f+=36}sc(e,Qy(sP(_))),o=g5(s,h,d===c),s=0,d++}}s++,a++}return aP(e,"")},T5=dt,$y=ir,R5=Vm,eC=ke,oP=rs,ma=ye,Hm=An,ga=en,v5=Rf,tC=Bi,iC=QG,Iu=function(n){var e=s5(n),t=d5(this),i=arguments.length,r=i>1?arguments[1]:void 0,a=r!==void 0;a&&(r=n5(r,i>2?arguments[2]:void 0));var s,o,c,d,l,h,_=h5(e),f=0;if(!_||this===eP&&c5(_))for(s=l5(e),o=t?new this(s):eP(s);s>f;f++)h=a?r(e[f],f):e[f],$D(o,f,h);else for(o=t?new this:[],l=(d=u5(e,_)).next;!(c=a5(l,d)).done;f++)h=a?o5(d,r,[c.value,f],!0):c.value,$D(o,f,h);return o.length=f,o},za=aa,y5=Hp.codeAt,C5=function(n){var e,t,i=[],r=E5(f5(m5(n),tP,"."),".");for(e=0;e<r.length;e++)t=r[e],sc(i,_5(p5,t)?"xn--"+S5(t):t);return aP(i,".")},to=Fr,b5=Ha,A5=Ma,cP=GG,dP=gs,I5=dP.set,Km=dP.getterFor("URL"),w5=cP.URLSearchParams,O5=cP.getState,qp=eC.URL,rC=eC.TypeError,Ym=eC.parseInt,N5=Math.floor,lP=Math.pow,Sa=ma("".charAt),qa=ma(/./.exec),Xp=ma([].join),D5=ma(1 .toString),P5=ma([].pop),wu=ma([].push),nC=ma("".replace),L5=ma([].shift),k5=ma("".split),Jp=ma("".slice),zm=ma("".toLowerCase),M5=ma([].unshift),aC="Invalid scheme",Ou="Invalid host",uP="Invalid port",hP=/[a-z]/i,U5=/[\d+-.a-z]/i,sC=/\d/,x5=/^0x/i,V5=/^[0-7]+$/,F5=/^\d+$/,pP=/^[\da-f]+$/i,B5=/[\0\t\n\r #%/:<>?@[\\\]^|]/,j5=/[\0\t\n\r #/:<>?@[\\\]^|]/,G5=/^[\u0000-\u0020]+/,W5=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,H5=/[\t\n\r]/g,Zp=function(n){var e,t,i,r;if(typeof n=="number"){for(e=[],t=0;t<4;t++)M5(e,n%256),n=N5(n/256);return Xp(e,".")}if(typeof n=="object"){for(e="",i=(function(a){for(var s=null,o=1,c=null,d=0,l=0;l<8;l++)a[l]!==0?(d>o&&(s=c,o=d),c=null,d=0):(c===null&&(c=l),++d);return d>o?c:s})(n),t=0;t<8;t++)r&&n[t]===0||(r&&(r=!1),i===t?(e+=t?":":"::",r=!0):(e+=D5(n[t],16),t<7&&(e+=":")));return"["+e+"]"}return n},qm={},_P=iC({},qm,{" ":1,'"':1,"<":1,">":1,"`":1}),fP=iC({},_P,{"#":1,"?":1,"{":1,"}":1}),oC=iC({},fP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),oc=function(n,e){var t=y5(n,0);return t>32&&t<127&&!tC(e,n)?n:encodeURIComponent(n)},Xm={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Qp=function(n,e){var t;return n.length===2&&qa(hP,Sa(n,0))&&((t=Sa(n,1))===":"||!e&&t==="|")},EP=function(n){var e;return n.length>1&&Qp(Jp(n,0,2))&&(n.length===2||(e=Sa(n,2))==="/"||e==="\\"||e==="?"||e==="#")},K5=function(n){return n==="."||zm(n)==="%2e"},cC={},mP={},dC={},gP={},SP={},lC={},TP={},RP={},Jm={},Zm={},uC={},hC={},pC={},_C={},vP={},fC={},Nu={},Rs={},yP={},gd={},io={},EC=function(n,e,t){var i,r,a,s=to(n);if(e){if(r=this.parse(s))throw new rC(r);this.searchParams=null}else{if(t!==void 0&&(i=new EC(t,!0)),r=this.parse(s,null,i))throw new rC(r);(a=O5(new w5)).bindURL(this),this.searchParams=a}};EC.prototype={type:"URL",parse:function(n,e,t){var i,r,a,s,o,c=this,d=e||cC,l=0,h="",_=!1,f=!1,m=!1;for(n=to(n),e||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,n=nC(n,G5,""),n=nC(n,W5,"$1")),n=nC(n,H5,""),i=Iu(n);l<=i.length;){switch(r=i[l],d){case cC:if(!r||!qa(hP,r)){if(e)return aC;d=dC;continue}h+=zm(r),d=mP;break;case mP:if(r&&(qa(U5,r)||r==="+"||r==="-"||r==="."))h+=zm(r);else{if(r!==":"){if(e)return aC;h="",d=dC,l=0;continue}if(e&&(c.isSpecial()!==tC(Xm,h)||h==="file"&&(c.includesCredentials()||c.port!==null)||c.scheme==="file"&&!c.host))return;if(c.scheme=h,e)return void(c.isSpecial()&&Xm[c.scheme]===c.port&&(c.port=null));h="",c.scheme==="file"?d=_C:c.isSpecial()&&t&&t.scheme===c.scheme?d=gP:c.isSpecial()?d=RP:i[l+1]==="/"?(d=SP,l++):(c.cannotBeABaseURL=!0,wu(c.path,""),d=yP)}break;case dC:if(!t||t.cannotBeABaseURL&&r!=="#")return aC;if(t.cannotBeABaseURL&&r==="#"){c.scheme=t.scheme,c.path=za(t.path),c.query=t.query,c.fragment="",c.cannotBeABaseURL=!0,d=io;break}d=t.scheme==="file"?_C:lC;continue;case gP:if(r!=="/"||i[l+1]!=="/"){d=lC;continue}d=Jm,l++;break;case SP:if(r==="/"){d=Zm;break}d=Rs;continue;case lC:if(c.scheme=t.scheme,r===Ea)c.username=t.username,c.password=t.password,c.host=t.host,c.port=t.port,c.path=za(t.path),c.query=t.query;else if(r==="/"||r==="\\"&&c.isSpecial())d=TP;else if(r==="?")c.username=t.username,c.password=t.password,c.host=t.host,c.port=t.port,c.path=za(t.path),c.query="",d=gd;else{if(r!=="#"){c.username=t.username,c.password=t.password,c.host=t.host,c.port=t.port,c.path=za(t.path),c.path.length--,d=Rs;continue}c.username=t.username,c.password=t.password,c.host=t.host,c.port=t.port,c.path=za(t.path),c.query=t.query,c.fragment="",d=io}break;case TP:if(!c.isSpecial()||r!=="/"&&r!=="\\"){if(r!=="/"){c.username=t.username,c.password=t.password,c.host=t.host,c.port=t.port,d=Rs;continue}d=Zm}else d=Jm;break;case RP:if(d=Jm,r!=="/"||Sa(h,l+1)!=="/")continue;l++;break;case Jm:if(r!=="/"&&r!=="\\"){d=Zm;continue}break;case Zm:if(r==="@"){_&&(h="%40"+h),_=!0,a=Iu(h);for(var S=0;S<a.length;S++){var T=a[S];if(T!==":"||m){var R=oc(T,oC);m?c.password+=R:c.username+=R}else m=!0}h=""}else if(r===Ea||r==="/"||r==="?"||r==="#"||r==="\\"&&c.isSpecial()){if(_&&h==="")return"Invalid authority";l-=Iu(h).length+1,h="",d=uC}else h+=r;break;case uC:case hC:if(e&&c.scheme==="file"){d=fC;continue}if(r!==":"||f){if(r===Ea||r==="/"||r==="?"||r==="#"||r==="\\"&&c.isSpecial()){if(c.isSpecial()&&h==="")return Ou;if(e&&h===""&&(c.includesCredentials()||c.port!==null))return;if(s=c.parseHost(h))return s;if(h="",d=Nu,e)return;continue}r==="["?f=!0:r==="]"&&(f=!1),h+=r}else{if(h==="")return Ou;if(s=c.parseHost(h))return s;if(h="",d=pC,e===hC)return}break;case pC:if(!qa(sC,r)){if(r===Ea||r==="/"||r==="?"||r==="#"||r==="\\"&&c.isSpecial()||e){if(h!==""){var C=Ym(h,10);if(C>65535)return uP;c.port=c.isSpecial()&&C===Xm[c.scheme]?null:C,h=""}if(e)return;d=Nu;continue}return uP}h+=r;break;case _C:if(c.scheme="file",r==="/"||r==="\\")d=vP;else{if(!t||t.scheme!=="file"){d=Rs;continue}switch(r){case Ea:c.host=t.host,c.path=za(t.path),c.query=t.query;break;case"?":c.host=t.host,c.path=za(t.path),c.query="",d=gd;break;case"#":c.host=t.host,c.path=za(t.path),c.query=t.query,c.fragment="",d=io;break;default:EP(Xp(za(i,l),""))||(c.host=t.host,c.path=za(t.path),c.shortenPath()),d=Rs;continue}}break;case vP:if(r==="/"||r==="\\"){d=fC;break}t&&t.scheme==="file"&&!EP(Xp(za(i,l),""))&&(Qp(t.path[0],!0)?wu(c.path,t.path[0]):c.host=t.host),d=Rs;continue;case fC:if(r===Ea||r==="/"||r==="\\"||r==="?"||r==="#"){if(!e&&Qp(h))d=Rs;else if(h===""){if(c.host="",e)return;d=Nu}else{if(s=c.parseHost(h))return s;if(c.host==="localhost"&&(c.host=""),e)return;h="",d=Nu}continue}h+=r;break;case Nu:if(c.isSpecial()){if(d=Rs,r!=="/"&&r!=="\\")continue}else if(e||r!=="?")if(e||r!=="#"){if(r!==Ea&&(d=Rs,r!=="/"))continue}else c.fragment="",d=io;else c.query="",d=gd;break;case Rs:if(r===Ea||r==="/"||r==="\\"&&c.isSpecial()||!e&&(r==="?"||r==="#")){if((o=zm(o=h))===".."||o==="%2e."||o===".%2e"||o==="%2e%2e"?(c.shortenPath(),r==="/"||r==="\\"&&c.isSpecial()||wu(c.path,"")):K5(h)?r==="/"||r==="\\"&&c.isSpecial()||wu(c.path,""):(c.scheme==="file"&&!c.path.length&&Qp(h)&&(c.host&&(c.host=""),h=Sa(h,0)+":"),wu(c.path,h)),h="",c.scheme==="file"&&(r===Ea||r==="?"||r==="#"))for(;c.path.length>1&&c.path[0]==="";)L5(c.path);r==="?"?(c.query="",d=gd):r==="#"&&(c.fragment="",d=io)}else h+=oc(r,fP);break;case yP:r==="?"?(c.query="",d=gd):r==="#"?(c.fragment="",d=io):r!==Ea&&(c.path[0]+=oc(r,qm));break;case gd:e||r!=="#"?r!==Ea&&(r==="'"&&c.isSpecial()?c.query+="%27":c.query+=r==="#"?"%23":oc(r,qm)):(c.fragment="",d=io);break;case io:r!==Ea&&(c.fragment+=oc(r,_P))}l++}},parseHost:function(n){var e,t,i;if(Sa(n,0)==="["){if(Sa(n,n.length-1)!=="]"||(e=(function(r){var a,s,o,c,d,l,h,_=[0,0,0,0,0,0,0,0],f=0,m=null,S=0,T=function(){return Sa(r,S)};if(T()===":"){if(Sa(r,1)!==":")return;S+=2,m=++f}for(;T();){if(f===8)return;if(T()!==":"){for(a=s=0;s<4&&qa(pP,T());)a=16*a+Ym(T(),16),S++,s++;if(T()==="."){if(s===0||(S-=s,f>6))return;for(o=0;T();){if(c=null,o>0){if(!(T()==="."&&o<4))return;S++}if(!qa(sC,T()))return;for(;qa(sC,T());){if(d=Ym(T(),10),c===null)c=d;else{if(c===0)return;c=10*c+d}if(c>255)return;S++}_[f]=256*_[f]+c,++o!=2&&o!==4||f++}if(o!==4)return;break}if(T()===":"){if(S++,!T())return}else if(T())return;_[f++]=a}else{if(m!==null)return;S++,m=++f}}if(m!==null)for(l=f-m,f=7;f!==0&&l>0;)h=_[f],_[f--]=_[m+l-1],_[m+--l]=h;else if(f!==8)return;return _})(Jp(n,1,-1)),!e))return Ou;this.host=e}else if(this.isSpecial()){if(n=C5(n),qa(B5,n)||(e=(function(r){var a,s,o,c,d,l,h,_=k5(r,".");if(_.length&&_[_.length-1]===""&&_.length--,(a=_.length)>4)return r;for(s=[],o=0;o<a;o++){if((c=_[o])==="")return r;if(d=10,c.length>1&&Sa(c,0)==="0"&&(d=qa(x5,c)?16:8,c=Jp(c,d===8?1:2)),c==="")l=0;else{if(!qa(d===10?F5:d===8?V5:pP,c))return r;l=Ym(c,d)}wu(s,l)}for(o=0;o<a;o++)if(l=s[o],o===a-1){if(l>=lP(256,5-a))return null}else if(l>255)return null;for(h=P5(s),o=0;o<s.length;o++)h+=s[o]*lP(256,3-o);return h})(n),e===null))return Ou;this.host=e}else{if(qa(j5,n))return Ou;for(e="",t=Iu(n),i=0;i<t.length;i++)e+=oc(t[i],qm);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return tC(Xm,this.scheme)},shortenPath:function(){var n=this.path,e=n.length;!e||this.scheme==="file"&&e===1&&Qp(n[0],!0)||n.length--},serialize:function(){var n=this,e=n.scheme,t=n.username,i=n.password,r=n.host,a=n.port,s=n.path,o=n.query,c=n.fragment,d=e+":";return r!==null?(d+="//",n.includesCredentials()&&(d+=t+(i?":"+i:"")+"@"),d+=Zp(r),a!==null&&(d+=":"+a)):e==="file"&&(d+="//"),d+=n.cannotBeABaseURL?s[0]:s.length?"/"+Xp(s,"/"):"",o!==null&&(d+="?"+o),c!==null&&(d+="#"+c),d},setHref:function(n){var e=this.parse(n);if(e)throw new rC(e);this.searchParams.update()},getOrigin:function(){var n=this.scheme,e=this.port;if(n==="blob")try{return new Du(n.path[0]).origin}catch{return"null"}return n!=="file"&&this.isSpecial()?n+"://"+Zp(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(n){this.parse(to(n)+":",cC)},getUsername:function(){return this.username},setUsername:function(n){var e=Iu(to(n));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var t=0;t<e.length;t++)this.username+=oc(e[t],oC)}},getPassword:function(){return this.password},setPassword:function(n){var e=Iu(to(n));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var t=0;t<e.length;t++)this.password+=oc(e[t],oC)}},getHost:function(){var n=this.host,e=this.port;return n===null?"":e===null?Zp(n):Zp(n)+":"+e},setHost:function(n){this.cannotBeABaseURL||this.parse(n,uC)},getHostname:function(){var n=this.host;return n===null?"":Zp(n)},setHostname:function(n){this.cannotBeABaseURL||this.parse(n,hC)},getPort:function(){var n=this.port;return n===null?"":to(n)},setPort:function(n){this.cannotHaveUsernamePasswordPort()||((n=to(n))===""?this.port=null:this.parse(n,pC))},getPathname:function(){var n=this.path;return this.cannotBeABaseURL?n[0]:n.length?"/"+Xp(n,"/"):""},setPathname:function(n){this.cannotBeABaseURL||(this.path=[],this.parse(n,Nu))},getSearch:function(){var n=this.query;return n?"?"+n:""},setSearch:function(n){(n=to(n))===""?this.query=null:(Sa(n,0)==="?"&&(n=Jp(n,1)),this.query="",this.parse(n,gd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var n=this.fragment;return n?"#"+n:""},setHash:function(n){(n=to(n))!==""?(Sa(n,0)==="#"&&(n=Jp(n,1)),this.fragment="",this.parse(n,io)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Du=function(n){var e=v5(this,mn),t=A5(arguments.length,1)>1?arguments[1]:void 0,i=I5(e,new EC(n,!1,t));$y||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},mn=Du.prototype,Ta=function(n,e){return{get:function(){return Km(this)[n]()},set:e&&function(t){return Km(this)[e](t)},configurable:!0,enumerable:!0}};if($y&&(ga(mn,"href",Ta("serialize","setHref")),ga(mn,"origin",Ta("getOrigin")),ga(mn,"protocol",Ta("getProtocol","setProtocol")),ga(mn,"username",Ta("getUsername","setUsername")),ga(mn,"password",Ta("getPassword","setPassword")),ga(mn,"host",Ta("getHost","setHost")),ga(mn,"hostname",Ta("getHostname","setHostname")),ga(mn,"port",Ta("getPort","setPort")),ga(mn,"pathname",Ta("getPathname","setPathname")),ga(mn,"search",Ta("getSearch","setSearch")),ga(mn,"searchParams",Ta("getSearchParams")),ga(mn,"hash",Ta("getHash","setHash"))),Hm(mn,"toJSON",function(){return Km(this).serialize()},{enumerable:!0}),Hm(mn,"toString",function(){return Km(this).serialize()},{enumerable:!0}),qp){var CP=qp.createObjectURL,bP=qp.revokeObjectURL;CP&&Hm(Du,"createObjectURL",oP(CP,qp)),bP&&Hm(Du,"revokeObjectURL",oP(bP,qp))}b5(Du,"URL"),T5({global:!0,forced:!R5,sham:!$y},{URL:Du});var Y5=dt,AP=re,z5=Ma,IP=Fr,q5=Vm,mC=wr("URL"),X5=q5&&AP(function(){mC.canParse()}),J5=AP(function(){return mC.canParse.length!==1});Y5({target:"URL",stat:!0,forced:!X5||J5},{canParse:function(n){var e=z5(arguments.length,1),t=IP(n),i=e<2||arguments[1]===void 0?void 0:IP(arguments[1]);try{return!!new mC(t,i)}catch{return!1}}});var Z5=dt,Q5=Ma,wP=Fr,$5=Vm,e6=wr("URL");Z5({target:"URL",stat:!0,forced:!$5},{parse:function(n){var e=Q5(arguments.length,1),t=wP(n),i=e<2||arguments[1]===void 0?void 0:wP(arguments[1]);try{return new e6(t,i)}catch{return null}}});var Qm=X(bn.URL);let OP=!0,NP=!0;function $m(n,e,t){let i=n.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function Sd(n,e,t){if(!n.RTCPeerConnection)return;let i=n.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(s,o){if(s!==e)return r.apply(this,arguments);let c=d=>{let l=t(d);l&&(o.handleEvent?o.handleEvent(l):o(l))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(o,c),r.apply(this,[s,c])};let a=i.removeEventListener;i.removeEventListener=function(s,o){if(s!==e||!this._eventMap||!this._eventMap[e])return a.apply(this,arguments);if(!this._eventMap[e].has(o))return a.apply(this,arguments);let c=this._eventMap[e].get(o);return this._eventMap[e].delete(o),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[s,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(s){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),s&&this.addEventListener(e,this["_on"+e]=s)},enumerable:!0,configurable:!0})}function t6(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(OP=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function i6(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(NP=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function DP(){if(typeof window=="object"){if(OP)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function gC(n,e){NP&&console.warn(n+" is deprecated, please use "+e+" instead.")}function PP(n){return Object.prototype.toString.call(n)==="[object Object]"}function LP(n){var e;return PP(n)?Pn(e=Object.keys(n)).call(e,function(t,i){let r=PP(n[i]),a=r?LP(n[i]):n[i],s=r&&!Object.keys(a).length;return a===void 0||s?t:Object.assign(t,{[i]:a})},{}):n}function SC(n,e,t){e&&!t.has(e.id)&&(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?SC(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(r=>{SC(n,n.get(r),t)})}))}function kP(n,e,t){let i=t?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;let a=[];return n.forEach(s=>{s.type==="track"&&s.trackIdentifier===e.id&&a.push(s)}),a.forEach(s=>{n.forEach(o=>{o.type===i&&o.trackId===s.id&&SC(n,o,r)})}),r}let MP=DP;function UP(n,e){let t=n&&n.navigator;if(!t.mediaDevices)return;let i=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;let o={};return Object.keys(s).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;let d=typeof s[c]=="object"?s[c]:{ideal:s[c]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);let l=function(h,_){return h?h+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(d.ideal!==void 0){o.optional=o.optional||[];let h={};typeof d.ideal=="number"?(h[l("min",c)]=d.ideal,o.optional.push(h),h={},h[l("max",c)]=d.ideal,o.optional.push(h)):(h[l("",c)]=d.ideal,o.optional.push(h))}d.exact!==void 0&&typeof d.exact!="number"?(o.mandatory=o.mandatory||{},o.mandatory[l("",c)]=d.exact):["min","max"].forEach(h=>{d[h]!==void 0&&(o.mandatory=o.mandatory||{},o.mandatory[l(h,c)]=d[h])})}),s.advanced&&(o.optional=(o.optional||[]).concat(s.advanced)),o},r=function(s,o){if(e.version>=61)return o(s);if((s=JSON.parse(JSON.stringify(s)))&&typeof s.audio=="object"){let c=function(d,l,h){l in d&&!(h in d)&&(d[h]=d[l],delete d[l])};c((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),c(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=i(s.audio)}if(s&&typeof s.video=="object"){let c=s.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});let d=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||d)){let l;if(delete s.video.facingMode,c.exact==="environment"||c.ideal==="environment"?l=["back","rear"]:c.exact!=="user"&&c.ideal!=="user"||(l=["front"]),l)return t.mediaDevices.enumerateDevices().then(h=>{h=h.filter(f=>f.kind==="videoinput");let _=h.find(f=>l.some(m=>{var S;return ee(S=f.label.toLowerCase()).call(S,m)}));return!_&&h.length&&ee(l).call(l,"back")&&(_=h[h.length-1]),_&&(s.video.deviceId=c.exact?{exact:_.deviceId}:{ideal:_.deviceId}),s.video=i(s.video),MP("chrome: "+JSON.stringify(s)),o(s)})}s.video=i(s.video)}return MP("chrome: "+JSON.stringify(s)),o(s)},a=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=(function(s,o,c){r(s,d=>{t.webkitGetUserMedia(d,o,l=>{c&&c(a(l))})})}).bind(t),t.mediaDevices.getUserMedia){let s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(o){return r(o,c=>s(c).then(d=>{if(c.audio&&!d.getAudioTracks().length||c.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(l=>{l.stop()}),new DOMException("","NotFoundError");return d},d=>se.reject(a(d))))}}}function xP(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function VP(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});let e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let r;r=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s=>s.track&&s.track.id===i.track.id):{track:i.track};let a=new Event("track");a.track=i.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[t.stream],this.dispatchEvent(a)}),t.stream.getTracks().forEach(i=>{let r;r=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s=>s.track&&s.track.id===i.id):{track:i};let a=new Event("track");a.track=i,a.receiver=r,a.transceiver={receiver:r},a.streams=[t.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Sd(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function FP(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){let e=function(r,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=r.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:r}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(s,o){let c=r.apply(this,arguments);return c||(c=e(this,s),this._senders.push(c)),c};let a=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(s){a.apply(this,arguments);let o=this._senders.indexOf(s);o!==-1&&this._senders.splice(o,1)}}let t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],t.apply(this,[r]),r.getTracks().forEach(a=>{this._senders.push(e(this,a))})};let i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(a=>{let s=this._senders.find(o=>o.track===a);s&&this._senders.splice(this._senders.indexOf(s),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){let e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){let t=e.apply(this,[]);return t.forEach(i=>i._pc=this),t},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function BP(n){if(!n.RTCPeerConnection)return;let e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){let[t,i,r]=arguments;if(arguments.length>0&&typeof t=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof t!="function"))return e.apply(this,[]);let a=function(o){let c={};return o.result().forEach(d=>{let l={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(h=>{l[h]=d.stat(h)}),c[l.id]=l}),c},s=function(o){return new Map(Object.keys(o).map(c=>[c,o[c]]))};if(arguments.length>=2){let o=function(c){i(s(a(c)))};return e.apply(this,[o,t])}return new se((o,c)=>{e.apply(this,[function(d){o(s(a(d)))},c])}).then(i,r)}}function jP(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){let t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r});let i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){let r=i.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){let r=this;return this._pc.getStats().then(a=>kP(a,r.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){let t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){let i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Sd(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){let i=this;return this._pc.getStats().then(r=>kP(r,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;let e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){let t=arguments[0],i,r,a;return this.getSenders().forEach(s=>{s.track===t&&(i?a=!0:i=s)}),this.getReceivers().forEach(s=>(s.track===t&&(r?a=!0:r=s),s.track===t)),a||i&&r?se.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():se.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function GP(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};let e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,s){if(!s)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let o=e.apply(this,arguments);return this._shimmedLocalStreams[s.id]?this._shimmedLocalStreams[s.id].indexOf(o)===-1&&this._shimmedLocalStreams[s.id].push(o):this._shimmedLocalStreams[s.id]=[s,o],o};let t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});let s=this.getSenders();t.apply(this,arguments);let o=this.getSenders().filter(c=>s.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(o)};let i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};let r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(s=>{let o=this._shimmedLocalStreams[s].indexOf(a);o!==-1&&this._shimmedLocalStreams[s].splice(o,1),this._shimmedLocalStreams[s].length===1&&delete this._shimmedLocalStreams[s]}),r.apply(this,arguments)}}function WP(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return GP(n);let t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){let c=t.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(d=>this._reverseStreams[d.id])};let i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(d=>{if(this.getSenders().find(l=>l.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){let d=new n.MediaStream(c.getTracks());this._streams[c.id]=d,this._reverseStreams[d.id]=c,c=d}i.apply(this,[c])};let r=n.RTCPeerConnection.prototype.removeStream;function a(c,d){let l=d.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{let _=c._reverseStreams[h],f=c._streams[_.id];l=l.replace(new RegExp(f.id,"g"),_.id)}),new RTCSessionDescription({type:d.type,sdp:l})}n.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},n.RTCPeerConnection.prototype.addTrack=function(c,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let l=[].slice.call(arguments,1);if(l.length!==1||!l[0].getTracks().find(_=>_===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_=>_.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let h=this._streams[d.id];if(h)h.addTrack(c),se.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let _=new n.MediaStream([c]);this._streams[d.id]=_,this._reverseStreams[_.id]=d,this.addStream(_)}return this.getSenders().find(_=>_.track===c)},["createOffer","createAnswer"].forEach(function(c){let d=n.RTCPeerConnection.prototype[c],l={[c](){let h=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[_=>{let f=a(this,_);h[0].apply(null,[f])},_=>{h[1]&&h[1].apply(null,_)},arguments[2]]):d.apply(this,arguments).then(_=>a(this,_))}};n.RTCPeerConnection.prototype[c]=l[c]});let s=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(c,d){let l=d.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{let _=c._reverseStreams[h],f=c._streams[_.id];l=l.replace(new RegExp(_.id,"g"),f.id)}),new RTCSessionDescription({type:d.type,sdp:l})})(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};let o=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){let c=o.get.apply(this);return c.type===""?c:a(this,c)}}),n.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let d;this._streams=this._streams||{},Object.keys(this._streams).forEach(l=>{this._streams[l].getTracks().find(h=>c.track===h)&&(d=this._streams[l])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function TC(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let i=n.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=r[t]})}function HP(n,e){Sd(n,"negotiationneeded",t=>{let i=t.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return t})}var KP=Object.freeze({__proto__:null,fixNegotiationNeeded:HP,shimAddTrackRemoveTrack:WP,shimAddTrackRemoveTrackWithNative:GP,shimGetDisplayMedia:function(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(typeof e=="function"?n.navigator.mediaDevices.getDisplayMedia=function(t){return e(t).then(i=>{let r=t.video&&t.video.width,a=t.video&&t.video.height,s=t.video&&t.video.frameRate;return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:s||3}},r&&(t.video.mandatory.maxWidth=r),a&&(t.video.mandatory.maxHeight=a),n.navigator.mediaDevices.getUserMedia(t)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:FP,shimGetStats:BP,shimGetUserMedia:UP,shimMediaStream:xP,shimOnTrack:VP,shimPeerConnection:TC,shimSenderReceiverGetStats:jP});function YP(n,e){let t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(r,a,s){gC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(r).then(a,s)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){let r=function(s,o,c){o in s&&!(c in s)&&(s[c]=s[o],delete s[o])},a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),r(s.audio,"autoGainControl","mozAutoGainControl"),r(s.audio,"noiseSuppression","mozNoiseSuppression")),a(s)},i&&i.prototype.getSettings){let s=i.prototype.getSettings;i.prototype.getSettings=function(){let o=s.apply(this,arguments);return r(o,"mozAutoGainControl","autoGainControl"),r(o,"mozNoiseSuppression","noiseSuppression"),o}}if(i&&i.prototype.applyConstraints){let s=i.prototype.applyConstraints;i.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o,"autoGainControl","mozAutoGainControl"),r(o,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[o])}}}}function zP(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function RC(n,e){if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let a=n.RTCPeerConnection.prototype[r],s={[r](){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};n.RTCPeerConnection.prototype[r]=s[r]});let t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){let[r,a,s]=arguments;return i.apply(this,[r||null]).then(o=>{if(e.version<53&&!a)try{o.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;o.forEach((d,l)=>{o.set(l,Object.assign({},d,{type:t[d.type]||d.type}))})}return o}).then(a,s)}}function qP(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;let e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){let i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});let t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){let i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):se.resolve(new Map)}}function XP(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;let e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){let t=e.apply(this,[]);return t.forEach(i=>i._pc=this),t}),Sd(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function JP(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(e){gC("removeStream","removeTrack"),this.getSenders().forEach(t=>{var i;t.track&&ee(i=e.getTracks()).call(i,t.track)&&this.removeTrack(t)})})}function ZP(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function QP(n){if(typeof n!="object"||!n.RTCPeerConnection)return;let e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;t===void 0&&(t=[]),t=[...t];let i=t.length>0;i&&t.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let r=e.apply(this,arguments);if(i){let{sender:a}=r,s=a.getParameters();(!("encodings"in s)||s.encodings.length===1&&Object.keys(s.encodings[0]).length===0)&&(s.encodings=t,a.sendEncodings=t,this.setParametersPromises.push(a.setParameters(s).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return r})}function $P(n){if(typeof n!="object"||!n.RTCRtpSender)return;let e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){let t=e.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function eL(n){if(typeof n!="object"||!n.RTCPeerConnection)return;let e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?se.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function tL(n){if(typeof n!="object"||!n.RTCPeerConnection)return;let e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?se.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var iL=Object.freeze({__proto__:null,shimAddTransceiver:QP,shimCreateAnswer:tL,shimCreateOffer:eL,shimGetDisplayMedia:function(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(t){if(!t||!t.video){let i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,se.reject(i)}return t.video===!0?t.video={mediaSource:e}:t.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(t)})},shimGetParameters:$P,shimGetUserMedia:YP,shimOnTrack:zP,shimPeerConnection:RC,shimRTCDataChannel:ZP,shimReceiverGetStats:XP,shimRemoveStream:JP,shimSenderGetStats:qP});function rL(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){let e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(t){var i;this._localStreams||(this._localStreams=[]),ee(i=this._localStreams).call(i,t)||this._localStreams.push(t),t.getAudioTracks().forEach(r=>e.call(this,r,t)),t.getVideoTracks().forEach(r=>e.call(this,r,t))},n.RTCPeerConnection.prototype.addTrack=function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r&&r.forEach(s=>{var o;this._localStreams?ee(o=this._localStreams).call(o,s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(t===-1)return;this._localStreams.splice(t,1);let i=e.getTracks();this.getSenders().forEach(r=>{ee(i).call(i,r.track)&&this.removeTrack(r)})})}}function nL(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var a;if(this._remoteStreams||(this._remoteStreams=[]),ee(a=this._remoteStreams).call(a,r))return;this._remoteStreams.push(r);let s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});let e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){let t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(r)>=0)return;t._remoteStreams.push(r);let a=new Event("addstream");a.stream=r,t.dispatchEvent(a)})}),e.apply(t,arguments)}}}function aL(n){if(typeof n!="object"||!n.RTCPeerConnection)return;let e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,a=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(c,d){let l=arguments.length>=2?arguments[2]:arguments[0],h=t.apply(this,[l]);return d?(h.then(c,d),se.resolve()):h},e.createAnswer=function(c,d){let l=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[l]);return d?(h.then(c,d),se.resolve()):h};let o=function(c,d,l){let h=r.apply(this,[c]);return l?(h.then(d,l),se.resolve()):h};e.setLocalDescription=o,o=function(c,d,l){let h=a.apply(this,[c]);return l?(h.then(d,l),se.resolve()):h},e.setRemoteDescription=o,o=function(c,d,l){let h=s.apply(this,[c]);return l?(h.then(d,l),se.resolve()):h},e.addIceCandidate=o}function sL(n){let e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){let t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=r=>i(oL(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(t,i,r){e.mediaDevices.getUserMedia(t).then(i,r)}).bind(e))}function oL(n){return n&&n.video!==void 0?Object.assign({},n,{video:LP(n.video)}):n}function cL(n){if(!n.RTCPeerConnection)return;let e=n.RTCPeerConnection;n.RTCPeerConnection=function(t,i){if(t&&t.iceServers){let r=[];for(let a=0;a<t.iceServers.length;a++){let s=t.iceServers[a];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(gC("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,r.push(s)):r.push(t.iceServers[a])}t.iceServers=r}return new e(t,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function dL(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function lL(n){let e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(t){if(t){t.offerToReceiveAudio!==void 0&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);let i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");t.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):t.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),t.offerToReceiveVideo!==void 0&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);let r=this.getTransceivers().find(a=>a.receiver.track.kind==="video");t.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):t.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function uL(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var hL=Object.freeze({__proto__:null,shimAudioContext:uL,shimCallbacksAPI:aL,shimConstraints:oL,shimCreateOfferLegacy:lL,shimGetUserMedia:sL,shimLocalStreamsAPI:rL,shimRTCIceServerUrls:cL,shimRemoteStreamsAPI:nL,shimTrackEventTransceiver:dL}),pL=`	
\v\f\r                　\u2028\u2029\uFEFF`,r6=Xs,n6=Fr,vC=pL,_L=ye("".replace),a6=RegExp("^["+vC+"]+"),s6=RegExp("(^|[^"+vC+"])["+vC+"]+$"),o6=function(n){return function(e){var t=n6(r6(e));return t=_L(t,a6,""),t=_L(t,s6,"$1"),t}},c6={trim:o6()},d6=Ch.PROPER,l6=re,fL=pL,u6=c6.trim;dt({target:"String",proto:!0,forced:(function(n){return l6(function(){return!!fL[n]()||"​᠎"[n]()!=="​᠎"||d6&&fL[n].name!==n})})("trim")},{trim:function(){return u6(this)}});var h6=Bn("String","trim"),p6=Be,_6=h6,yC=String.prototype,f6=function(n){var e=n.trim;return typeof n=="string"||n===yC||p6(yC,n)&&e===yC.trim?_6:e},hr=X(f6),EL={exports:{}};(function(n){let e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){let i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){let i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(t){let i;i=t.indexOf("a=candidate:")===0?t.substring(12).split(" "):t.substring(10).split(" ");let r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":r.relatedAddress=i[a+1];break;case"rport":r.relatedPort=parseInt(i[a+1],10);break;case"tcptype":r.tcpType=i[a+1];break;case"ufrag":r.ufrag=i[a+1],r.usernameFragment=i[a+1];break;default:r[i[a]]===void 0&&(r[i[a]]=i[a+1])}return r},e.writeCandidate=function(t){let i=[];i.push(t.foundation);let r=t.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);let a=t.type;return i.push("typ"),i.push(a),a!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let i=t.substring(9).split(" "),r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(t){let i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);let r=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(t){let i=t.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){let i={},r,a=t.substring(t.indexOf(" ")+1).split(";");for(let s=0;s<a.length;s++)r=a[s].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(t){let i="",r=t.payloadType;if(t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){let a=[];Object.keys(t.parameters).forEach(s=>{t.parameters[s]!==void 0?a.push(s+"="+t.parameters[s]):a.push(s)}),i+="a=fmtp:"+r+" "+a.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){let i=t.substring(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){let i="",r=t.payloadType;return t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+r+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){let i=t.indexOf(" "),r={ssrc:parseInt(t.substring(7,i),10)},a=t.indexOf(":",i);return a>-1?(r.attribute=t.substring(i+1,a),r.value=t.substring(a+1)):r.attribute=t.substring(i+1),r},e.parseSsrcGroup=function(t){let i=t.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(t){let i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(t){let i=t.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:e.matchPrefix(t+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){let r="a=setup:"+i+`\r
`;return t.fingerprints.forEach(a=>{r+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),r},e.parseCryptoLine=function(t){let i=t.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;let i=t.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){return e.matchPrefix(t+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,i){let r=e.matchPrefix(t+i,"a=ice-ufrag:")[0],a=e.matchPrefix(t+i,"a=ice-pwd:")[0];return r&&a?{usernameFragment:r.substring(12),password:a.substring(10)}:null},e.writeIceParameters=function(t){let i="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(t){let i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(t)[0].split(" ");i.profile=r[2];for(let s=3;s<r.length;s++){let o=r[s],c=e.matchPrefix(t,"a=rtpmap:"+o+" ")[0];if(c){let d=e.parseRtpMap(c),l=e.matchPrefix(t,"a=fmtp:"+o+" ");switch(d.parameters=l.length?e.parseFmtp(l[0]):{},d.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+o+" ").map(e.parseRtcpFb),i.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(d.name.toUpperCase())}}}e.matchPrefix(t,"a=extmap:").forEach(s=>{i.headerExtensions.push(e.parseExtmap(s))});let a=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(s=>{a.forEach(o=>{s.rtcpFeedback.find(c=>c.type===o.type&&c.parameter===o.parameter)||s.rtcpFeedback.push(o)})}),i},e.writeRtpDescription=function(t,i){let r="";r+="m="+t+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(s=>{r+=e.writeRtpMap(s),r+=e.writeFmtp(s),r+=e.writeRtcpFb(s)});let a=0;return i.codecs.forEach(s=>{s.maxptime>a&&(a=s.maxptime)}),a>0&&(r+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(s=>{r+=e.writeExtmap(s)}),r},e.parseRtpEncodingParameters=function(t){let i=[],r=e.parseRtpParameters(t),a=r.fecMechanisms.indexOf("RED")!==-1,s=r.fecMechanisms.indexOf("ULPFEC")!==-1,o=e.matchPrefix(t,"a=ssrc:").map(_=>e.parseSsrcMedia(_)).filter(_=>_.attribute==="cname"),c=o.length>0&&o[0].ssrc,d,l=e.matchPrefix(t,"a=ssrc-group:FID").map(_=>_.substring(17).split(" ").map(f=>parseInt(f,10)));l.length>0&&l[0].length>1&&l[0][0]===c&&(d=l[0][1]),r.codecs.forEach(_=>{if(_.name.toUpperCase()==="RTX"&&_.parameters.apt){let f={ssrc:c,codecPayloadType:parseInt(_.parameters.apt,10)};c&&d&&(f.rtx={ssrc:d}),i.push(f),a&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&c&&i.push({ssrc:c});let h=e.matchPrefix(t,"b=");return h.length&&(h=h[0].indexOf("b=TIAS:")===0?parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?1e3*parseInt(h[0].substring(5),10)*.95-16e3:void 0,i.forEach(_=>{_.maxBitrate=h})),i},e.parseRtcpParameters=function(t){let i={},r=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);let a=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;let s=e.matchPrefix(t,"a=rtcp-mux");return i.mux=s.length>0,i},e.writeRtcpParameters=function(t){let i="";return t.reducedSize&&(i+=`a=rtcp-rsize\r
`),t.mux&&(i+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(i+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),i},e.parseMsid=function(t){let i,r=e.matchPrefix(t,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};let a=e.matchPrefix(t,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(t){let i=e.parseMLine(t),r=e.matchPrefix(t,"a=max-message-size:"),a;r.length>0&&(a=parseInt(r[0].substring(19),10)),isNaN(a)&&(a=65536);let s=e.matchPrefix(t,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:i.fmt,maxMessageSize:a};let o=e.matchPrefix(t,"a=sctpmap:");if(o.length>0){let c=o[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:a}}},e.writeSctpDescription=function(t,i){let r=[];return r=t.protocol!=="DTLS/SCTP"?["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,i,r){let a,s=i!==void 0?i:2;return a=t||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+a+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,i){let r=e.splitLines(t);for(let a=0;a<r.length;a++)switch(r[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[a].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){let i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){let i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;let i=e.splitLines(t);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},n.exports=e})(EL);var mL=EL.exports,Pu=X(mL),E6=q({__proto__:null,default:Pu},[mL]);function eg(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;let e=n.RTCIceCandidate;n.RTCIceCandidate=function(t){if(typeof t=="object"&&t.candidate&&t.candidate.indexOf("a=")===0&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){let i=new e(t),r=Pu.parseCandidate(t.candidate),a=Object.assign(i,r);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(t)},n.RTCIceCandidate.prototype=e.prototype,Sd(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function CC(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Sd(n,"icecandidate",e=>{if(e.candidate){let t=Pu.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function tg(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let t=function(o){if(!o||!o.sdp)return!1;let c=Pu.splitSections(o.sdp);return c.shift(),c.some(d=>{let l=Pu.parseMLine(d);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},i=function(o){let c=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;let d=parseInt(c[1],10);return d!=d?-1:d},r=function(o){let c=65536;return e.browser==="firefox"&&(c=e.version<57?o===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),c},a=function(o,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);let l=Pu.matchPrefix(o.sdp,"a=max-message-size:");return l.length>0?d=parseInt(l[0].substr(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},s=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){let{sdpSemantics:o}=this.getConfiguration();o==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){let o=i(arguments[0]),c=r(o),d=a(arguments[0],o),l;l=c===0&&d===0?Number.POSITIVE_INFINITY:c===0||d===0?Math.max(c,d):Math.min(c,d);let h={};Object.defineProperty(h,"maxMessageSize",{get:()=>l}),this._sctp=h}return s.apply(this,arguments)}}function ig(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,r){let a=i.send;i.send=function(){let s=arguments[0],o=s.length||s.size||s.byteLength;if(i.readyState==="open"&&r.sctp&&o>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}let t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){let i=t.apply(this,arguments);return e(i,this),i},Sd(n,"datachannel",i=>(e(i.channel,i.target),i))}function bC(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;let e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{let i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{let a=r.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;let s=new Event("connectionstatechange",r);a.dispatchEvent(s)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function AC(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;let t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let r=i.sdp.split(`
`).filter(a=>hr(a).call(a)!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return t.apply(this,arguments)}}function rg(n,e){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;let t=n.RTCPeerConnection.prototype.addIceCandidate;t&&t.length!==0&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?se.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),se.resolve())})}function ng(n,e){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;let t=n.RTCPeerConnection.prototype.setLocalDescription;t&&t.length!==0&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>t.apply(this,[r]))})}var m6=Object.freeze({__proto__:null,removeExtmapAllowMixed:AC,shimAddIceCandidateNullOrEmpty:rg,shimConnectionState:bC,shimMaxMessageSize:tg,shimParameterlessSetLocalDescription:ng,shimRTCIceCandidate:eg,shimRTCIceCandidateRelayProtocol:CC,shimSendThrowTypeError:ig});(function(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},t=DP,i=(function(a){let s={browser:null,version:null};if(a===void 0||!a.navigator)return s.browser="Not a browser.",s;let{navigator:o}=a;if(o.mozGetUserMedia)s.browser="firefox",s.version=$m(o.userAgent,/Firefox\/(\d+)\./,1);else if(o.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)s.browser="chrome",s.version=$m(o.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!o.userAgent.match(/AppleWebKit\/(\d+)\./))return s.browser="Not a supported browser.",s;s.browser="safari",s.version=$m(o.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return s})(n),r={browserDetails:i,commonShim:m6,extractVersion:$m,disableLog:t6,disableWarnings:i6,sdp:E6};switch(i.browser){case"chrome":if(!KP||!TC||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),r;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),r;t("adapter.js shimming chrome."),r.browserShim=KP,rg(n,i),ng(n),UP(n,i),xP(n),TC(n,i),VP(n),WP(n,i),FP(n),BP(n),jP(n),HP(n,i),eg(n),CC(n),bC(n),tg(n,i),ig(n),AC(n,i);break;case"firefox":if(!iL||!RC||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),r;t("adapter.js shimming firefox."),r.browserShim=iL,rg(n,i),ng(n),YP(n,i),RC(n,i),zP(n),JP(n),qP(n),XP(n),ZP(n),QP(n),$P(n),eL(n),tL(n),eg(n),bC(n),tg(n,i),ig(n);break;case"safari":if(!hL||!e.shimSafari)return t("Safari shim is not included in this adapter release."),r;t("adapter.js shimming safari."),r.browserShim=hL,rg(n,i),ng(n),cL(n),lL(n),aL(n),rL(n),nL(n),dL(n),sL(n),uL(n),eg(n),CC(n),tg(n,i),ig(n),AC(n,i);break;default:t("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var IC=ke;dt({global:!0,forced:IC.globalThis!==IC},{globalThis:IC});var gL=X(ke),wC={exports:{}};(function(n,e){(function(t,i){var r="function",a="undefined",s="object",o="string",c="major",d="model",l="name",h="type",_="vendor",f="version",m="architecture",S="console",T="mobile",R="tablet",C="smarttv",b="wearable",N="embedded",k="Amazon",P="Apple",U="ASUS",W="BlackBerry",z="Browser",Q="Chrome",he="Firefox",Ge="Google",xe="Huawei",qe="LG",ot="Microsoft",xt="Motorola",fe="Opera",$="Samsung",ne="Sharp",ie="Sony",A="Xiaomi",v="Zebra",D="Facebook",j="Chromium OS",ue="Mac OS",rt=" Browser",jt=function(an){for(var gi={},Wt=0;Wt<an.length;Wt++)gi[an[Wt].toUpperCase()]=an[Wt];return gi},ar=function(an,gi){return typeof an===o&&ua(gi).indexOf(ua(an))!==-1},ua=function(an){return an.toLowerCase()},Ho=function(an,gi){if(typeof an===o)return an=an.replace(/^\s\s*/,""),typeof gi===a?an:an.substring(0,500)},sh=function(an,gi){for(var Wt,vi,zn,er,ur,Xt,Yt=0;Yt<gi.length&&!ur;){var Eo=gi[Yt],Yo=gi[Yt+1];for(Wt=vi=0;Wt<Eo.length&&!ur&&Eo[Wt];)if(ur=Eo[Wt++].exec(an))for(zn=0;zn<Yo.length;zn++)Xt=ur[++vi],typeof(er=Yo[zn])===s&&er.length>0?er.length===2?typeof er[1]==r?this[er[0]]=er[1].call(this,Xt):this[er[0]]=er[1]:er.length===3?typeof er[1]!==r||er[1].exec&&er[1].test?this[er[0]]=Xt?Xt.replace(er[1],er[2]):i:this[er[0]]=Xt?er[1].call(this,Xt,er[2]):i:er.length===4&&(this[er[0]]=Xt?er[3].call(this,Xt.replace(er[1],er[2])):i):this[er]=Xt||i;Yt+=2}},xl=function(an,gi){for(var Wt in gi)if(typeof gi[Wt]===s&&gi[Wt].length>0){for(var vi=0;vi<gi[Wt].length;vi++)if(ar(gi[Wt][vi],an))return Wt==="?"?i:Wt}else if(ar(gi[Wt],an))return Wt==="?"?i:Wt;return gi.hasOwnProperty("*")?gi["*"]:an},M_={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Qg={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,f],[/opios[\/ ]+([\w\.]+)/i],[f,[l,fe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[f,[l,fe+" GX"]],[/\bopr\/([\w\.]+)/i],[f,[l,fe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[f,[l,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[f,[l,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[l,f],[/quark(?:pc)?\/([-\w\.]+)/i],[f,[l,"Quark"]],[/\bddg\/([\w\.]+)/i],[f,[l,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[l,"UC"+z]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[f,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[l,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[l,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[f,[l,"Smart Lenovo "+z]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+z],f],[/\bfocus\/([\w\.]+)/i],[f,[l,he+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[l,fe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[l,fe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[l,"MIUI"+rt]],[/fxios\/([\w\.-]+)/i],[f,[l,he]],[/\bqihoobrowser\/?([\w\.]*)/i],[f,[l,"360"]],[/\b(qq)\/([\w\.]+)/i],[[l,/(.+)/,"$1Browser"],f],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1"+rt],f],[/samsungbrowser\/([\w\.]+)/i],[f,[l,$+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[f,[l,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[l,"Sogou Mobile"],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[l,f],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[l],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[f,l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,D],f],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[l,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[l,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[l,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[l,Q+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,Q+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[l,"Android "+z]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[f,xl,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],f],[/(wolvic|librewolf)\/([\w\.]+)/i],[l,f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[l,he+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[l,[f,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[l,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,ua]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",ua]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,ua]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[_,$],[h,R]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[d,[_,$],[h,T]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[_,P],[h,T]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[_,P],[h,R]],[/(macintosh);/i],[d,[_,P]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[_,ne],[h,T]],[/(?:honor)([-\w ]+)[;\)]/i],[d,[_,"Honor"],[h,T]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[_,xe],[h,R]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[_,xe],[h,T]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[d,/_/g," "],[_,A],[h,T]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[_,A],[h,R]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[_,"OPPO"],[h,T]],[/\b(opd2\d{3}a?) bui/i],[d,[_,"OPPO"],[h,R]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[_,"Vivo"],[h,T]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[_,"Realme"],[h,T]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[_,xt],[h,T]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[_,xt],[h,R]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[_,qe],[h,R]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[_,qe],[h,T]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[_,"Lenovo"],[h,R]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[_,"Nokia"],[h,T]],[/(pixel c)\b/i],[d,[_,Ge],[h,R]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[_,Ge],[h,T]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[_,ie],[h,T]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[_,ie],[h,R]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[_,"OnePlus"],[h,T]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[_,k],[h,R]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[_,k],[h,T]],[/(playbook);[-\w\),; ]+(rim)/i],[d,_,[h,R]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[_,W],[h,T]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[_,U],[h,R]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[_,U],[h,T]],[/(nexus 9)/i],[d,[_,"HTC"],[h,R]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[d,/_/g," "],[h,T]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[d,[_,"TCL"],[h,R]],[/(itel) ((\w+))/i],[[_,ua],d,[h,xl,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[_,"Acer"],[h,R]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[_,"Meizu"],[h,T]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[_,"Ulefone"],[h,T]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[d,[_,"Energizer"],[h,T]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[d,[_,"Cat"],[h,T]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[d,[_,"Smartfren"],[h,T]],[/droid.+; (a(?:015|06[35]|142p?))/i],[d,[_,"Nothing"],[h,T]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,d,[h,T]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,d,[h,R]],[/(surface duo)/i],[d,[_,ot],[h,R]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[_,"Fairphone"],[h,T]],[/(u304aa)/i],[d,[_,"AT&T"],[h,T]],[/\bsie-(\w*)/i],[d,[_,"Siemens"],[h,T]],[/\b(rct\w+) b/i],[d,[_,"RCA"],[h,R]],[/\b(venue[\d ]{2,7}) b/i],[d,[_,"Dell"],[h,R]],[/\b(q(?:mv|ta)\w+) b/i],[d,[_,"Verizon"],[h,R]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[_,"Barnes & Noble"],[h,R]],[/\b(tm\d{3}\w+) b/i],[d,[_,"NuVision"],[h,R]],[/\b(k88) b/i],[d,[_,"ZTE"],[h,R]],[/\b(nx\d{3}j) b/i],[d,[_,"ZTE"],[h,T]],[/\b(gen\d{3}) b.+49h/i],[d,[_,"Swiss"],[h,T]],[/\b(zur\d{3}) b/i],[d,[_,"Swiss"],[h,R]],[/\b((zeki)?tb.*\b) b/i],[d,[_,"Zeki"],[h,R]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],d,[h,R]],[/\b(ns-?\w{0,9}) b/i],[d,[_,"Insignia"],[h,R]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[_,"NextBook"],[h,R]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],d,[h,T]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],d,[h,T]],[/\b(ph-1) /i],[d,[_,"Essential"],[h,T]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[_,"Envizen"],[h,R]],[/\b(trio[-\w\. ]+) b/i],[d,[_,"MachSpeed"],[h,R]],[/\btu_(1491) b/i],[d,[_,"Rotor"],[h,R]],[/(shield[\w ]+) b/i],[d,[_,"Nvidia"],[h,R]],[/(sprint) (\w+)/i],[_,d,[h,T]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[_,ot],[h,T]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[_,v],[h,R]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[_,v],[h,T]],[/smart-tv.+(samsung)/i],[_,[h,C]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[_,$],[h,C]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,qe],[h,C]],[/(apple) ?tv/i],[_,[d,P+" TV"],[h,C]],[/crkey/i],[[d,Q+"cast"],[_,Ge],[h,C]],[/droid.+aft(\w+)( bui|\))/i],[d,[_,k],[h,C]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[_,ne],[h,C]],[/(bravia[\w ]+)( bui|\))/i],[d,[_,ie],[h,C]],[/(mitv-\w{5}) bui/i],[d,[_,A],[h,C]],[/Hbbtv.*(technisat) (.*);/i],[_,d,[h,C]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,Ho],[d,Ho],[h,C]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,C]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,d,[h,S]],[/droid.+; (shield) bui/i],[d,[_,"Nvidia"],[h,S]],[/(playstation [345portablevi]+)/i],[d,[_,ie],[h,S]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[_,ot],[h,S]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[d,[_,$],[h,b]],[/((pebble))app/i],[_,d,[h,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[_,P],[h,b]],[/droid.+; (glass) \d/i],[d,[_,Ge],[h,b]],[/droid.+; (wt63?0{2,3})\)/i],[d,[_,v],[h,b]],[/droid.+; (glass) \d/i],[d,[_,Ge],[h,b]],[/(pico) (4|neo3(?: link|pro)?)/i],[_,d,[h,b]],[/; (quest( \d| pro)?)/i],[d,[_,D],[h,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[h,N]],[/(aeobc)\b/i],[d,[_,k],[h,N]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[h,T]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[h,R]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,R]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,T]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[l,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[l,f],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[l,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,f],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[l,[f,xl,M_]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,xl,M_],[l,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,ue],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,f],[/\(bb(10);/i],[f,[l,W]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[l,he+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[l,Q+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,j],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,f],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[l,f]]},Ko=function(an,gi){if(typeof an===s&&(gi=an,an=i),!(this instanceof Ko))return new Ko(an,gi).getResult();var Wt=typeof t!==a&&t.navigator?t.navigator:i,vi=an||(Wt&&Wt.userAgent?Wt.userAgent:""),zn=Wt&&Wt.userAgentData?Wt.userAgentData:i,er=gi?(function(Xt,Yt){var Eo={};for(var Yo in Xt)Yt[Yo]&&Yt[Yo].length%2==0?Eo[Yo]=Yt[Yo].concat(Xt[Yo]):Eo[Yo]=Xt[Yo];return Eo})(Qg,gi):Qg,ur=Wt&&Wt.userAgent==vi;return this.getBrowser=function(){var Xt={};return Xt[l]=i,Xt[f]=i,sh.call(Xt,vi,er.browser),Xt[c]=(function(Yt){return typeof Yt===o?Yt.replace(/[^\d\.]/g,"").split(".")[0]:i})(Xt[f]),ur&&Wt&&Wt.brave&&typeof Wt.brave.isBrave==r&&(Xt[l]="Brave"),Xt},this.getCPU=function(){var Xt={};return Xt[m]=i,sh.call(Xt,vi,er.cpu),Xt},this.getDevice=function(){var Xt={};return Xt[_]=i,Xt[d]=i,Xt[h]=i,sh.call(Xt,vi,er.device),ur&&!Xt[h]&&zn&&zn.mobile&&(Xt[h]=T),ur&&Xt[d]=="Macintosh"&&Wt&&typeof Wt.standalone!==a&&Wt.maxTouchPoints&&Wt.maxTouchPoints>2&&(Xt[d]="iPad",Xt[h]=R),Xt},this.getEngine=function(){var Xt={};return Xt[l]=i,Xt[f]=i,sh.call(Xt,vi,er.engine),Xt},this.getOS=function(){var Xt={};return Xt[l]=i,Xt[f]=i,sh.call(Xt,vi,er.os),ur&&!Xt[l]&&zn&&zn.platform&&zn.platform!="Unknown"&&(Xt[l]=zn.platform.replace(/chrome os/i,j).replace(/macos/i,ue)),Xt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return vi},this.setUA=function(Xt){return vi=typeof Xt===o&&Xt.length>500?Ho(Xt,500):Xt,this},this.setUA(vi),this};Ko.VERSION="0.7.40",Ko.BROWSER=jt([l,f,c]),Ko.CPU=jt([m]),Ko.DEVICE=jt([d,_,h,S,T,C,R,b,N]),Ko.ENGINE=Ko.OS=jt([l,f]),n.exports&&(e=n.exports=Ko),e.UAParser=Ko;var $a=typeof t!==a&&(t.jQuery||t.Zepto);if($a&&!$a.ua){var Vl=new Ko;$a.ua=Vl.getResult(),$a.ua.get=function(){return Vl.getUA()},$a.ua.set=function(an){Vl.setUA(an);var gi=Vl.getResult();for(var Wt in gi)$a.ua[Wt]=gi[Wt]}}})(typeof window=="object"?window:K)})(wC,wC.exports);var g6=X(wC.exports),SL=wo.clear;dt({global:!0,bind:!0,forced:ke.clearImmediate!==SL},{clearImmediate:SL});var TL=ke,S6=kt,T6=Jt,R6=uh,v6=$r,y6=aa,C6=Ma,b6=TL.Function,A6=/MSIE .\./.test(v6)||R6==="BUN"&&(function(){var n=TL.Bun.version.split(".");return n.length<3||n[0]==="0"&&(n[1]<3||n[1]==="3"&&n[2]==="0")})(),I6=dt,RL=ke,vL=wo.set,w6=function(n,e){var t=1;return A6?function(i,r){var a=C6(arguments.length,1)>t,s=T6(i)?i:b6(i),o=a?y6(arguments,t):[],c=a?function(){S6(s,this,o)}:s;return n(c)}:n},yL=RL.setImmediate?w6(vL):vL;I6({global:!0,bind:!0,forced:RL.setImmediate!==yL},{setImmediate:yL});var CL=X(bn.setImmediate),O6=ke,N6=Uh,D6=pr,P6=Ma,L6=ir;dt({global:!0,dontCallGetSet:!0,forced:re(function(){return L6&&Object.getOwnPropertyDescriptor(O6,"queueMicrotask").value.length!==1})},{queueMicrotask:function(n){P6(arguments.length,1),N6(D6(n))}});var bL=X(bn.queueMicrotask);function AL(n,e){return function(){return n.apply(e,arguments)}}let{toString:k6}=Object.prototype,{getPrototypeOf:OC}=Object,{iterator:ag,toStringTag:IL}=Symbol,sg=(NC=Object.create(null),n=>{let e=k6.call(n);return NC[e]||(NC[e]=e.slice(8,-1).toLowerCase())});var NC;let Xa=n=>(n=n.toLowerCase(),e=>sg(e)===n),og=n=>e=>typeof e===n,{isArray:Lu}=Array,$p=og("undefined"),wL=Xa("ArrayBuffer"),M6=og("string"),Ln=og("function"),OL=og("number"),cg=n=>n!==null&&typeof n=="object",dg=n=>{if(sg(n)!=="object")return!1;let e=OC(n);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||IL in n||ag in n)},U6=Xa("Date"),x6=Xa("File"),V6=Xa("Blob"),F6=Xa("FileList"),B6=Xa("URLSearchParams"),[j6,G6,W6,H6]=["ReadableStream","Request","Response","Headers"].map(Xa);function e_(n,e){let t,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n!=null)if(typeof n!="object"&&(n=[n]),Lu(n))for(t=0,i=n.length;t<i;t++)e.call(null,n[t],t,n);else{let a=r?Object.getOwnPropertyNames(n):Object.keys(n),s=a.length,o;for(t=0;t<s;t++)o=a[t],e.call(null,n[o],o,n)}}function NL(n,e){e=e.toLowerCase();let t=Object.keys(n),i,r=t.length;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}let Td=gL!==void 0?gL:typeof self<"u"?self:typeof window<"u"?window:globalThis,DL=n=>!$p(n)&&n!==Td,K6=(DC=typeof Uint8Array<"u"&&OC(Uint8Array),n=>DC&&n instanceof DC);var DC;let Y6=Xa("HTMLFormElement"),PL=(n=>{let{hasOwnProperty:e}=n;return(t,i)=>e.call(t,i)})(Object.prototype),z6=Xa("RegExp"),LL=(n,e)=>{let t=Object.getOwnPropertyDescriptors(n),i={};e_(t,(r,a)=>{let s;(s=e(r,a,n))!==!1&&(i[a]=s||r)}),Object.defineProperties(n,i)},q6=Xa("AsyncFunction"),kL=(ML=typeof CL=="function",UL=Ln(Td.postMessage),ML?CL:UL?(PC="axios@".concat(Math.random()),lg=[],Td.addEventListener("message",n=>{let{source:e,data:t}=n;e===Td&&t===PC&&lg.length&&lg.shift()()},!1),n=>{lg.push(n),Td.postMessage(PC,"*")}):n=>setTimeout(n));var ML,UL,PC,lg;let X6=bL!==void 0?bL.bind(Td):typeof process<"u"&&process.nextTick||kL;var ae={isArray:Lu,isArrayBuffer:wL,isBuffer:function(n){return n!==null&&!$p(n)&&n.constructor!==null&&!$p(n.constructor)&&Ln(n.constructor.isBuffer)&&n.constructor.isBuffer(n)},isFormData:n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Ln(n.append)&&((e=sg(n))==="formdata"||e==="object"&&Ln(n.toString)&&n.toString()==="[object FormData]"))},isArrayBufferView:function(n){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&wL(n.buffer),e},isString:M6,isNumber:OL,isBoolean:n=>n===!0||n===!1,isObject:cg,isPlainObject:dg,isReadableStream:j6,isRequest:G6,isResponse:W6,isHeaders:H6,isUndefined:$p,isDate:U6,isFile:x6,isBlob:V6,isRegExp:z6,isFunction:Ln,isStream:n=>cg(n)&&Ln(n.pipe),isURLSearchParams:B6,isTypedArray:K6,isFileList:F6,forEach:e_,merge:function n(){let{caseless:e}=DL(this)&&this||{},t={},i=(r,a)=>{let s=e&&NL(t,a)||a;dg(t[s])&&dg(r)?t[s]=n(t[s],r):dg(r)?t[s]=n({},r):Lu(r)?t[s]=r.slice():t[s]=r};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&e_(arguments[r],i);return t},extend:function(n,e,t){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return e_(e,(r,a)=>{t&&Ln(r)?n[a]=AL(r,t):n[a]=r},{allOwnKeys:i}),n},trim:n=>hr(n)?hr(n).call(n):n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),inherits:(n,e,t,i)=>{n.prototype=Object.create(e.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},toFlatObject:(n,e,t,i)=>{let r,a,s,o={};if(e=e||{},n==null)return e;do{for(r=Object.getOwnPropertyNames(n),a=r.length;a-- >0;)s=r[a],i&&!i(s,n,e)||o[s]||(e[s]=n[s],o[s]=!0);n=t!==!1&&OC(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},kindOf:sg,kindOfTest:Xa,endsWith:(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;let i=n.indexOf(e,t);return i!==-1&&i===t},toArray:n=>{if(!n)return null;if(Lu(n))return n;let e=n.length;if(!OL(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},forEachEntry:(n,e)=>{let t=(n&&n[ag]).call(n),i;for(;(i=t.next())&&!i.done;){let r=i.value;e.call(n,r[0],r[1])}},matchAll:(n,e)=>{let t,i=[];for(;(t=n.exec(e))!==null;)i.push(t);return i},isHTMLForm:Y6,hasOwnProperty:PL,hasOwnProp:PL,reduceDescriptors:LL,freezeMethods:n=>{LL(n,(e,t)=>{if(Ln(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let i=n[t];Ln(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")}))})},toObjectSet:(n,e)=>{let t={},i=r=>{r.forEach(a=>{t[a]=!0})};return Lu(n)?i(n):i(String(n).split(e)),t},toCamelCase:n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,i){return t.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,findKey:NL,global:Td,isContextDefined:DL,isSpecCompliantForm:function(n){return!!(n&&Ln(n.append)&&n[IL]==="FormData"&&n[ag])},toJSONObject:n=>{let e=new Array(10),t=(i,r)=>{if(cg(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;let a=Lu(i)?[]:{};return e_(i,(s,o)=>{let c=t(s,r+1);!$p(c)&&(a[o]=c)}),e[r]=void 0,a}}return i};return t(n,0)},isAsyncFn:q6,isThenable:n=>n&&(cg(n)||Ln(n))&&Ln(n.then)&&Ln(n.catch),setImmediate:kL,asap:X6,isIterable:n=>n!=null&&Ln(n[ag])};function St(n,e,t,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}ae.inherits(St,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ae.toJSONObject(this.config),code:this.code,status:this.status}}});let xL=St.prototype,VL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{VL[n]={value:n}}),Object.defineProperties(St,VL),Object.defineProperty(xL,"isAxiosError",{value:!0}),St.from=(n,e,t,i,r,a)=>{let s=Object.create(xL);return ae.toFlatObject(n,s,function(o){return o!==Error.prototype},o=>o!=="isAxiosError"),St.call(s,n.message,e,t,i,r),s.cause=n,s.name=n.name,a&&Object.assign(s,a),s};function LC(n){return ae.isPlainObject(n)||ae.isArray(n)}function FL(n){return ae.endsWith(n,"[]")?n.slice(0,-2):n}function BL(n,e,t){return n?n.concat(e).map(function(i,r){return i=FL(i),!t&&r?"["+i+"]":i}).join(t?".":""):e}let J6=ae.toFlatObject(ae,{},null,function(n){return/^is[A-Z]/.test(n)});function ug(n,e,t){if(!ae.isObject(n))throw new TypeError("target must be an object");e=e||new FormData;let i=(t=ae.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,f){return!ae.isUndefined(f[_])})).metaTokens,r=t.visitor||d,a=t.dots,s=t.indexes,o=(t.Blob||typeof Blob<"u"&&Blob)&&ae.isSpecCompliantForm(e);if(!ae.isFunction(r))throw new TypeError("visitor must be a function");function c(_){if(_===null)return"";if(ae.isDate(_))return _.toISOString();if(!o&&ae.isBlob(_))throw new St("Blob is not supported. Use a Buffer instead.");return ae.isArrayBuffer(_)||ae.isTypedArray(_)?o&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function d(_,f,m){let S=_;if(_&&!m&&typeof _=="object"){if(ae.endsWith(f,"{}"))f=i?f:f.slice(0,-2),_=JSON.stringify(_);else if(ae.isArray(_)&&(function(T){return ae.isArray(T)&&!T.some(LC)})(_)||(ae.isFileList(_)||ae.endsWith(f,"[]"))&&(S=ae.toArray(_)))return f=FL(f),S.forEach(function(T,R){!ae.isUndefined(T)&&T!==null&&e.append(s===!0?BL([f],R,a):s===null?f:f+"[]",c(T))}),!1}return!!LC(_)||(e.append(BL(m,f,a),c(_)),!1)}let l=[],h=Object.assign(J6,{defaultVisitor:d,convertValue:c,isVisitable:LC});if(!ae.isObject(n))throw new TypeError("data must be an object");return(function _(f,m){if(!ae.isUndefined(f)){if(l.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));l.push(f),ae.forEach(f,function(S,T){(!(ae.isUndefined(S)||S===null)&&r.call(e,S,ae.isString(T)?hr(T).call(T):T,m,h))===!0&&_(S,m?m.concat(T):[T])}),l.pop()}})(n),e}function jL(n){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function kC(n,e){this._pairs=[],n&&ug(n,this,e)}let GL=kC.prototype;function Z6(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function WL(n,e,t){if(!e)return n;let i=t&&t.encode||Z6;ae.isFunction(t)&&(t={serialize:t});let r=t&&t.serialize,a;if(a=r?r(e,t):ae.isURLSearchParams(e)?e.toString():new kC(e,t).toString(i),a){let s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+a}return n}GL.append=function(n,e){this._pairs.push([n,e])},GL.toString=function(n){let e=n?function(t){return n.call(this,t,jL)}:jL;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};var HL=class{constructor(){this.handlers=[]}use(n,e,t){return this.handlers.push({fulfilled:n,rejected:e,synchronous:!!t&&t.synchronous,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){ae.forEach(this.handlers,function(e){e!==null&&n(e)})}},KL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},YL={exports:{}},Q6=dt,$6=ir,zL=pn.f;Q6({target:"Object",stat:!0,forced:Object.defineProperty!==zL,sham:!$6},{defineProperty:zL});var qL=bn.Object,eW=YL.exports=function(n,e,t){return qL.defineProperty(n,e,t)};qL.defineProperty.sham&&(eW.sham=!0);var XL=X(YL.exports),tW=TypeError,JL=vo,iW=Nh,rW=Ir,nW=ci("species"),ZL=Array,aW=function(n){var e;return JL(n)&&(e=n.constructor,(iW(e)&&(e===ZL||JL(e.prototype))||rW(e)&&(e=e[nW])===null)&&(e=void 0)),e===void 0?ZL:e},QL=function(n,e){return new(aW(n))(e===0?0:e)},sW=re,oW=Ps,cW=ci("species"),$L=function(n){return oW>=51||!sW(function(){var e=[];return(e.constructor={})[cW]=function(){return{foo:1}},e[n](Boolean).foo!==1})},dW=dt,lW=re,uW=vo,hW=Ir,pW=Pa,_W=Zs,ek=function(n){if(n>9007199254740991)throw tW("Maximum allowed index exceeded");return n},tk=Jy,fW=QL,EW=$L,mW=Ps,ik=ci("isConcatSpreadable"),gW=mW>=51||!lW(function(){var n=[];return n[ik]=!1,n.concat()[0]!==n}),SW=function(n){if(!hW(n))return!1;var e=n[ik];return e!==void 0?!!e:uW(n)};dW({target:"Array",proto:!0,forced:!gW||!EW("concat")},{concat:function(n){var e,t,i,r,a,s=pW(this),o=fW(s,0),c=0;for(e=-1,i=arguments.length;e<i;e++)if(SW(a=e===-1?s:arguments[e]))for(r=_W(a),ek(c+r),t=0;t<r;t++,c++)t in a&&tk(o,c,a[t]);else ek(c+1),tk(o,c++,a);return o.length=c,o}});var rk={},TW=tr,RW=Js,nk=$o.f,vW=aa,ak=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];rk.f=function(n){return ak&&TW(n)==="Window"?(function(e){try{return nk(e)}catch{return vW(ak)}})(n):nk(RW(n))};var ku={},yW=ci;ku.f=yW;var sk=bn,CW=Bi,bW=ku,AW=pn.f,Fi=function(n){var e=sk.Symbol||(sk.Symbol={});CW(e,n)||AW(e,n,{value:bW.f(n)})},IW=tt,wW=wr,OW=ci,NW=An,ok=function(){var n=wW("Symbol"),e=n&&n.prototype,t=e&&e.valueOf,i=OW("toPrimitive");e&&!e[i]&&NW(e,i,function(r){return IW(t,this)},{})},DW=rs,PW=mo,LW=Pa,kW=Zs,MW=QL;ye([].push);var eF=function(n){return function(e,t,i,r){for(var a,s,o=LW(e),c=PW(o),d=kW(c),l=DW(t,i),h=0,_=r||MW,f=void 0;d>h;h++)h in c&&(s=l(a=c[h],h,o));return f}},tF={forEach:eF(0)},MC=dt,Hf=ke,hg=tt,ck=ye,wT=ir,Mu=td,OT=re,Vs=Bi,Fs=Be,dk=Vr,NT=Js,DT=Jd,lk=Fr,uk=Ft,Kf=od,pg=iu,iF=$o,rF=rk,nF=sd,aF=zo,hk=pn,sF=tu,oF=ni,pk=An,cF=en,_k=Es,Vw=ra,fk=Xd,dF=ci,UW=ku,xW=Fi,VW=ok,FW=Ha,lF=gs,UC=tF.forEach,ro=sn("hidden"),no="Symbol",Yf="prototype",xC=lF.set,uF=lF.getterFor(no),hl=Object[Yf],ao=Hf.Symbol,Hh=ao&&ao[Yf],Fw=Hf.RangeError,BW=Hf.TypeError,Ek=Hf.QObject,Bw=aF.f,zf=hk.f,qf=rF.f,hF=oF.f,pF=ck([].push),Kh=_k("symbols"),Rd=_k("op-symbols"),VC=_k("wks"),mk=!Ek||!Ek[Yf]||!Ek[Yf].findChild,jw=function(n,e,t){var i=Bw(hl,e);i&&delete hl[e],zf(n,e,t),i&&n!==hl&&zf(hl,e,i)},Gw=wT&&OT(function(){return Kf(zf({},"a",{get:function(){return zf(this,"a",{value:7}).a}})).a!==7})?jw:zf,FC=function(n,e){var t=Kh[n]=Kf(Hh);return xC(t,{type:no,tag:n,description:e}),wT||(t.description=e),t},PT=function(n,e,t){n===hl&&PT(Rd,e,t),dk(n);var i=DT(e);return dk(t),Vs(Kh,i)?(t.enumerable?(Vs(n,ro)&&n[ro][i]&&(n[ro][i]=!1),t=Kf(t,{enumerable:uk(0,!1)})):(Vs(n,ro)||zf(n,ro,uk(1,Kf(null))),n[ro][i]=!0),Gw(n,i,t)):zf(n,i,t)},LT=function(n,e){dk(n);var t=NT(e),i=pg(t).concat(Tk(t));return UC(i,function(r){wT&&!hg(Ww,t,r)||PT(n,r,t[r])}),n},Ww=function(n){var e=DT(n),t=hg(hF,this,e);return!(this===hl&&Vs(Kh,e)&&!Vs(Rd,e))&&(!(t||!Vs(this,e)||!Vs(Kh,e)||Vs(this,ro)&&this[ro][e])||t)},gk=function(n,e){var t=NT(n),i=DT(e);if(t!==hl||!Vs(Kh,i)||Vs(Rd,i)){var r=Bw(t,i);return!r||!Vs(Kh,i)||Vs(t,ro)&&t[ro][i]||(r.enumerable=!0),r}},Sk=function(n){var e=qf(NT(n)),t=[];return UC(e,function(i){Vs(Kh,i)||Vs(Vw,i)||pF(t,i)}),t},Tk=function(n){var e=n===hl,t=qf(e?Rd:NT(n)),i=[];return UC(t,function(r){!Vs(Kh,r)||e&&!Vs(hl,r)||pF(i,Kh[r])}),i};Mu||(ao=function(){if(Fs(Hh,this))throw new BW("Symbol is not a constructor");var n=arguments.length&&arguments[0]!==void 0?lk(arguments[0]):void 0,e=fk(n),t=function(i){var r=this===void 0?Hf:this;r===hl&&hg(t,Rd,i),Vs(r,ro)&&Vs(r[ro],e)&&(r[ro][e]=!1);var a=uk(1,i);try{Gw(r,e,a)}catch(s){if(!(s instanceof Fw))throw s;jw(r,e,a)}};return wT&&mk&&Gw(hl,e,{configurable:!0,set:t}),FC(e,n)},pk(Hh=ao[Yf],"toString",function(){return uF(this).tag}),pk(ao,"withoutSetter",function(n){return FC(fk(n),n)}),oF.f=Ww,hk.f=PT,sF.f=LT,aF.f=gk,iF.f=rF.f=Sk,nF.f=Tk,UW.f=function(n){return FC(dF(n),n)},wT&&cF(Hh,"description",{configurable:!0,get:function(){return uF(this).description}})),MC({global:!0,wrap:!0,forced:!Mu,sham:!Mu},{Symbol:ao}),UC(pg(VC),function(n){xW(n)}),MC({target:no,stat:!0,forced:!Mu},{useSetter:function(){mk=!0},useSimple:function(){mk=!1}}),MC({target:"Object",stat:!0,forced:!Mu,sham:!wT},{create:function(n,e){return e===void 0?Kf(n):LT(Kf(n),e)},defineProperty:PT,defineProperties:LT,getOwnPropertyDescriptor:gk}),MC({target:"Object",stat:!0,forced:!Mu},{getOwnPropertyNames:Sk}),VW(),FW(ao,no),Vw[ro]=!0;var Rk=td&&!!Symbol.for&&!!Symbol.keyFor,_F=dt,jW=wr,GW=Bi,WW=Fr,fF=Es,EF=Rk,vk=fF("string-to-symbol-registry"),yk=fF("symbol-to-string-registry");_F({target:"Symbol",stat:!0,forced:!EF},{for:function(n){var e=WW(n);if(GW(vk,e))return vk[e];var t=jW("Symbol")(e);return vk[e]=t,yk[t]=e,t}});var HW=dt,KW=Bi,YW=qd,zW=qo,qW=Rk,mF=Es("symbol-to-string-registry");HW({target:"Symbol",stat:!0,forced:!qW},{keyFor:function(n){if(!YW(n))throw new TypeError(zW(n)+" is not a symbol");if(KW(mF,n))return mF[n]}});var Ck=vo,gF=Jt,SF=tr,TF=Fr,RF=ye([].push),vF=dt,yF=wr,bk=kt,CF=tt,BC=ye,kT=re,Ak=Jt,Ik=qd,wk=aa,bF=function(n){if(gF(n))return n;if(Ck(n)){for(var e=n.length,t=[],i=0;i<e;i++){var r=n[i];typeof r=="string"?RF(t,r):typeof r!="number"&&SF(r)!=="Number"&&SF(r)!=="String"||RF(t,TF(r))}var a=t.length,s=!0;return function(o,c){if(s)return s=!1,c;if(Ck(this))return c;for(var d=0;d<a;d++)if(t[d]===o)return c}}},XW=td,JW=String,Xf=yF("JSON","stringify"),Uu=BC(/./.exec),jC=BC("".charAt),AF=BC("".charCodeAt),ZW=BC("".replace),QW=BC(1 .toString),$W=/[\uD800-\uDFFF]/g,IF=/^[\uD800-\uDBFF]$/,Ok=/^[\uDC00-\uDFFF]$/,Nk=!XW||kT(function(){var n=yF("Symbol")("stringify detection");return Xf([n])!=="[null]"||Xf({a:n})!=="{}"||Xf(Object(n))!=="{}"}),Dk=kT(function(){return Xf("\uDF06\uD834")!=='"\\udf06\\ud834"'||Xf("\uDEAD")!=='"\\udead"'}),wF=function(n,e){var t=wk(arguments),i=bF(e);if(Ak(i)||n!==void 0&&!Ik(n))return t[1]=function(r,a){if(Ak(i)&&(a=CF(i,this,JW(r),a)),!Ik(a))return a},bk(Xf,null,t)},e4=function(n,e,t){var i=jC(t,e-1),r=jC(t,e+1);return Uu(IF,n)&&!Uu(Ok,r)||Uu(Ok,n)&&!Uu(IF,i)?"\\u"+QW(AF(n,0),16):n};Xf&&vF({target:"JSON",stat:!0,forced:Nk||Dk},{stringify:function(n,e,t){var i=wk(arguments),r=bk(Nk?wF:Xf,null,i);return Dk&&typeof r=="string"?ZW(r,$W,e4):r}});var OF=sd,NF=Pa;dt({target:"Object",stat:!0,forced:!td||re(function(){OF.f(1)})},{getOwnPropertySymbols:function(n){var e=OF.f;return e?e(NF(n)):[]}}),Fi("asyncIterator"),Fi("hasInstance"),Fi("isConcatSpreadable"),Fi("iterator"),Fi("match"),Fi("matchAll"),Fi("replace"),Fi("search"),Fi("species"),Fi("split");var t4=ok;Fi("toPrimitive"),t4();var i4=wr,r4=Ha;Fi("toStringTag"),r4(i4("Symbol"),"Symbol"),Fi("unscopables"),Ha(ke.JSON,"JSON",!0);var n4=bn.Symbol,a4=ci,s4=pn.f,DF=a4("metadata"),Pk=Function.prototype;Pk[DF]===void 0&&s4(Pk,DF,{value:null}),Fi("asyncDispose"),Fi("dispose"),Fi("metadata");var PF=n4,o4=ye,Lk=wr("Symbol"),kk=Lk.keyFor,c4=o4(Lk.prototype.valueOf),LF=Lk.isRegisteredSymbol||function(n){try{return kk(c4(n))!==void 0}catch{return!1}};dt({target:"Symbol",stat:!0},{isRegisteredSymbol:LF});for(var kF=Es,MF=wr,UF=ye,d4=qd,l4=ci,Hw=MF("Symbol"),GC=Hw.isWellKnownSymbol,Mk=MF("Object","getOwnPropertyNames"),xF=UF(Hw.prototype.valueOf),VF=kF("wks"),Kw=0,Yw=Mk(Hw),FF=Yw.length;Kw<FF;Kw++)try{var BF=Yw[Kw];d4(Hw[BF])&&l4(BF)}catch{}var Uk=function(n){if(GC&&GC(n))return!0;try{for(var e=xF(n),t=0,i=Mk(VF),r=i.length;t<r;t++)if(VF[i[t]]==e)return!0}catch{}return!1};dt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Uk}),Fi("customMatcher"),Fi("observable"),dt({target:"Symbol",stat:!0},{isRegistered:LF}),dt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Uk}),Fi("matcher"),Fi("metadataKey"),Fi("patternMatch"),Fi("replaceAll");var _g=X(PF),fg=X(ku.f("iterator"));function MT(n){return MT=typeof _g=="function"&&typeof fg=="symbol"?function(e){return typeof e}:function(e){return e&&typeof _g=="function"&&e.constructor===_g&&e!==_g.prototype?"symbol":typeof e},MT(n)}var WC=X(ku.f("toPrimitive"));function u4(n){var e=(function(t,i){if(MT(t)!="object"||!t)return t;var r=t[WC];if(r!==void 0){var a=r.call(t,i);if(MT(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)})(n,"string");return MT(e)=="symbol"?e:e+""}function F(n,e,t){return(e=u4(e))in n?XL(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var V=X(WG),jF={isBrowser:!0,classes:{URLSearchParams:V!==void 0?V:kC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let xk=typeof window<"u"&&typeof document<"u",HC=typeof navigator=="object"&&navigator||void 0,Vk=xk&&(!HC||["ReactNative","NativeScript","NS"].indexOf(HC.product)<0),h4=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",p4=xk&&window.location.href||"http://localhost";function GF(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Fk(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?GF(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):GF(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var so=Fk(Fk({},Object.freeze({__proto__:null,hasBrowserEnv:xk,hasStandardBrowserEnv:Vk,hasStandardBrowserWebWorkerEnv:h4,navigator:HC,origin:p4})),jF),Do=Vr,_4=tt,f4=Bi,E4=Be,m4=function(){var n=Do(this),e="";return n.hasIndices&&(e+="d"),n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.unicodeSets&&(e+="v"),n.sticky&&(e+="y"),e},WF=RegExp.prototype,Bk=function(n){var e=n.flags;return e!==void 0||"flags"in WF||f4(n,"flags")||!E4(WF,n)?e:_4(m4,n)},HF=Hp.charAt,KF=tt,YF=Vr,g4=Jt,S4=tr,T4=/./.exec,R4=TypeError,v4=dt,zF=tt,jk=ha,qF=Sf,zw=uu,KC=Xs,Gk=dh,UT=Fr,YC=Vr,y4=Ir,C4=tr,b4=pS,XF=Bk,JF=vc,A4=re,I4=vf,w4=function(n,e,t){return e+(t?HF(n,e).length:1)},O4=function(n,e){var t=n.exec;if(g4(t)){var i=KF(t,n,e);return i!==null&&YF(i),i}if(S4(n)==="RegExp")return KF(T4,n,e);throw new R4("RegExp#exec called on incompatible receiver")},ZF=gs,QF=ci("matchAll"),$F="RegExp String",Wk=$F+" Iterator",eB=ZF.set,N4=ZF.getterFor(Wk),D4=TypeError,Hk=jk("".indexOf),xT=jk("".matchAll),VT=!!xT&&!A4(function(){xT("a",/./)}),Kk=qF(function(n,e,t,i){eB(this,{type:Wk,regexp:n,string:e,global:t,unicode:i,done:!1})},$F,function(){var n=N4(this);if(n.done)return zw(void 0,!0);var e=n.regexp,t=n.string,i=O4(e,t);return i===null?(n.done=!0,zw(void 0,!0)):n.global?(UT(i[0])===""&&(e.lastIndex=w4(t,Gk(e.lastIndex),n.unicode)),zw(i,!1)):(n.done=!0,zw(i,!1))}),tB=function(n){var e,t,i,r=YC(this),a=UT(n),s=I4(r,RegExp),o=UT(XF(r));return e=new s(s===RegExp?r.source:r,o),t=!!~Hk(o,"g"),i=!!~Hk(o,"u"),e.lastIndex=Gk(r.lastIndex),new Kk(e,a,t,i)};v4({target:"String",proto:!0,forced:VT},{matchAll:function(n){var e,t,i,r,a=KC(this);if(y4(n)){if(b4(n)&&(e=UT(KC(XF(n))),!~Hk(e,"g")))throw new D4("`.matchAll` does not allow non-global regexes");if(VT)return xT(a,n);if((i=JF(n,QF))===void 0&&C4(n)==="RegExp"&&(i=tB),i)return zF(i,n,a)}else if(VT)return xT(a,n);return t=UT(a),r=new RegExp(n,"g"),zF(tB,r,t)}});var iB=Bn("String","matchAll"),P4=Be,L4=iB,Yk=String.prototype,zk=function(n){var e=n.matchAll;return typeof n=="string"||n===Yk||P4(Yk,n)&&e===Yk.matchAll?L4:e},k4=X(zk);function rB(n){function e(t,i,r,a){let s=t[a++];if(s==="__proto__")return!0;let o=Number.isFinite(+s),c=a>=t.length;return s=!s&&ae.isArray(r)?r.length:s,c?(ae.hasOwnProp(r,s)?r[s]=[r[s],i]:r[s]=i,!o):(r[s]&&ae.isObject(r[s])||(r[s]=[]),e(t,i,r[s],a)&&ae.isArray(r[s])&&(r[s]=(function(d){let l={},h=Object.keys(d),_,f=h.length,m;for(_=0;_<f;_++)m=h[_],l[m]=d[m];return l})(r[s])),!o)}if(ae.isFormData(n)&&ae.isFunction(n.entries)){let t={};return ae.forEachEntry(n,(i,r)=>{e((function(a){return k4(ae).call(ae,/\w+|\[(\w*)]/g,a).map(s=>s[0]==="[]"?"":s[1]||s[0])})(i),r,t,0)}),t}return null}let qw={transitional:KL,adapter:["xhr","http","fetch"],transformRequest:[function(n,e){let t=e.getContentType()||"",i=t.indexOf("application/json")>-1,r=ae.isObject(n);if(r&&ae.isHTMLForm(n)&&(n=new FormData(n)),ae.isFormData(n))return i?JSON.stringify(rB(n)):n;if(ae.isArrayBuffer(n)||ae.isBuffer(n)||ae.isStream(n)||ae.isFile(n)||ae.isBlob(n)||ae.isReadableStream(n))return n;if(ae.isArrayBufferView(n))return n.buffer;if(ae.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let a;if(r){if(t.indexOf("application/x-www-form-urlencoded")>-1)return(function(s,o){return ug(s,new so.classes.URLSearchParams,Object.assign({visitor:function(c,d,l,h){return so.isNode&&ae.isBuffer(c)?(this.append(d,c.toString("base64")),!1):h.defaultVisitor.apply(this,arguments)}},o))})(n,this.formSerializer).toString();if((a=ae.isFileList(n))||t.indexOf("multipart/form-data")>-1){let s=this.env&&this.env.FormData;return ug(a?{"files[]":n}:n,s&&new s,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),(function(s,o,c){if(ae.isString(s))try{return(o||JSON.parse)(s),hr(ae).call(ae,s)}catch(d){if(d.name!=="SyntaxError")throw d}return(c||JSON.stringify)(s)})(n)):n}],transformResponse:[function(n){let e=this.transitional||qw.transitional,t=e&&e.forcedJSONParsing,i=this.responseType==="json";if(ae.isResponse(n)||ae.isReadableStream(n))return n;if(n&&ae.isString(n)&&(t&&!this.responseType||i)){let r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(n)}catch(a){if(r)throw a.name==="SyntaxError"?St.from(a,St.ERR_BAD_RESPONSE,this,null,this.response):a}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:so.classes.FormData,Blob:so.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ae.forEach(["delete","get","head","post","put","patch"],n=>{qw.headers[n]={}});var zC=qw;let qk=ae.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),nB=Symbol("internals");function FT(n){var e;return n&&hr(e=String(n)).call(e).toLowerCase()}function Jf(n){return n===!1||n==null?n:ae.isArray(n)?n.map(Jf):String(n)}function BT(n,e,t,i,r){return ae.isFunction(i)?i.call(this,e,t):(r&&(e=t),ae.isString(e)?ae.isString(i)?e.indexOf(i)!==-1:ae.isRegExp(i)?i.test(e):void 0:void 0)}class jT{constructor(e){e&&this.set(e)}set(e,t,i){let r=this;function a(c,d,l){let h=FT(d);if(!h)throw new Error("header name must be a non-empty string");let _=ae.findKey(r,h);(!_||r[_]===void 0||l===!0||l===void 0&&r[_]!==!1)&&(r[_||d]=Jf(c))}let s=(c,d)=>ae.forEach(c,(l,h)=>a(l,h,d));if(ae.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(ae.isString(e)&&(e=hr(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(hr(o=e).call(o)))s((c=>{let d={},l,h,_;return c&&c.split(`
`).forEach(function(f){var m,S;_=f.indexOf(":"),l=hr(m=f.substring(0,_)).call(m).toLowerCase(),h=hr(S=f.substring(_+1)).call(S),!l||d[l]&&qk[l]||(l==="set-cookie"?d[l]?d[l].push(h):d[l]=[h]:d[l]=d[l]?d[l]+", "+h:h)}),d})(e),t);else if(ae.isObject(e)&&ae.isIterable(e)){let c,d,l={};for(let h of e){if(!ae.isArray(h))throw TypeError("Object iterator must return a key-value pair");l[d=h[0]]=(c=l[d])?ae.isArray(c)?[...c,h[1]]:[c,h[1]]:h[1]}s(l,t)}else e!=null&&a(t,e,i);var o;return this}get(e,t){if(e=FT(e)){let i=ae.findKey(this,e);if(i){let r=this[i];if(!t)return r;if(t===!0)return(function(a){let s=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,c;for(;c=o.exec(a);)s[c[1]]=c[2];return s})(r);if(ae.isFunction(t))return t.call(this,r,i);if(ae.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=FT(e)){let i=ae.findKey(this,e);return!(!i||this[i]===void 0||t&&!BT(0,this[i],i,t))}return!1}delete(e,t){let i=this,r=!1;function a(s){if(s=FT(s)){let o=ae.findKey(i,s);!o||t&&!BT(0,i[o],o,t)||(delete i[o],r=!0)}}return ae.isArray(e)?e.forEach(a):a(e),r}clear(e){let t=Object.keys(this),i=t.length,r=!1;for(;i--;){let a=t[i];e&&!BT(0,this[a],a,e,!0)||(delete this[a],r=!0)}return r}normalize(e){let t=this,i={};return ae.forEach(this,(r,a)=>{var s;let o=ae.findKey(i,a);if(o)return t[o]=Jf(r),void delete t[a];let c=e?(function(d){return hr(d).call(d).toLowerCase().replace(/([a-z\d])(\w*)/g,(l,h,_)=>h.toUpperCase()+_)})(a):hr(s=String(a)).call(s);c!==a&&delete t[a],t[c]=Jf(r),i[c]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.constructor.concat(this,...t)}toJSON(e){let t=Object.create(null);return ae.forEach(this,(i,r)=>{i!=null&&i!==!1&&(t[r]=e&&ae.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,i]=e;return t+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let t=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r.forEach(s=>t.set(s)),t}static accessor(e){let t=(this[nB]=this[nB]={accessors:{}}).accessors,i=this.prototype;function r(a){let s=FT(a);t[s]||((function(o,c){let d=ae.toCamelCase(" "+c);["get","set","has"].forEach(l=>{Object.defineProperty(o,l+d,{value:function(h,_,f){return this[l].call(this,c,h,_,f)},configurable:!0})})})(i,a),t[s]=!0)}return ae.isArray(e)?e.forEach(r):r(e),this}}jT.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ae.reduceDescriptors(jT.prototype,(n,e)=>{let{value:t}=n,i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}}),ae.freezeMethods(jT);var Mc=jT;function vd(n,e){let t=this||zC,i=e||t,r=Mc.from(i.headers),a=i.data;return ae.forEach(n,function(s){a=s.call(t,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function Xw(n){return!(!n||!n.__CANCEL__)}function Eg(n,e,t){St.call(this,n??"canceled",St.ERR_CANCELED,e,t),this.name="CanceledError"}function mg(n,e,t){let i=t.config.validateStatus;t.status&&i&&!i(t.status)?e(new St("Request failed with status code "+t.status,[St.ERR_BAD_REQUEST,St.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t)):n(t)}ae.inherits(Eg,St,{__CANCEL__:!0});let qC=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0,r=(function(a,s){a=a||10;let o=new Array(a),c=new Array(a),d,l=0,h=0;return s=s!==void 0?s:1e3,function(_){let f=Date.now(),m=c[h];d||(d=f),o[l]=_,c[l]=f;let S=h,T=0;for(;S!==l;)T+=o[S++],S%=a;if(l=(l+1)%a,l===h&&(h=(h+1)%a),f-d<s)return;let R=m&&f-m;return R?Math.round(1e3*T/R):void 0}})(50,250);return(function(a,s){let o,c,d=0,l=1e3/s,h=function(_){d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),o=null,c&&(clearTimeout(c),c=null),a.apply(null,_)};return[function(){let _=Date.now(),f=_-d;for(var m=arguments.length,S=new Array(m),T=0;T<m;T++)S[T]=arguments[T];f>=l?h(S,_):(o=S,c||(c=setTimeout(()=>{c=null,h(o)},l-f)))},()=>o&&h(o)]})(a=>{let s=a.loaded,o=a.lengthComputable?a.total:void 0,c=s-i,d=r(c);i=s,n({loaded:s,total:o,progress:o?s/o:void 0,bytes:c,rate:d||void 0,estimated:d&&o&&s<=o?(o-s)/d:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0})},t)},XC=(n,e)=>{let t=n!=null;return[i=>e[0]({lengthComputable:t,total:n,loaded:i}),e[1]]},Xk=n=>function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return ae.asap(()=>n(...t))};var aB=so.hasStandardBrowserEnv?((n,e)=>t=>(t=new Qm(t,so.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new Qm(so.origin),so.navigator&&/(msie|trident)/i.test(so.navigator.userAgent)):()=>!0,M4=so.hasStandardBrowserEnv?{write(n,e,t,i,r,a){let s=[n+"="+encodeURIComponent(e)];ae.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),ae.isString(i)&&s.push("path="+i),ae.isString(r)&&s.push("domain="+r),a===!0&&s.push("secure"),document.cookie=s.join("; ")},read(n){let e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function sB(n,e,t){let i=!(function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)})(e);return n&&(i||t==0)?(function(r,a){return a?r.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):r})(n,e):e}function Jk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}let Zk=n=>n instanceof Mc?(function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Jk(Object(i),!0).forEach(function(r){F(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Jk(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e})({},n):n;function Zf(n,e){e=e||{};let t={};function i(d,l,h,_){return ae.isPlainObject(d)&&ae.isPlainObject(l)?ae.merge.call({caseless:_},d,l):ae.isPlainObject(l)?ae.merge({},l):ae.isArray(l)?l.slice():l}function r(d,l,h,_){return ae.isUndefined(l)?ae.isUndefined(d)?void 0:i(void 0,d,0,_):i(d,l,0,_)}function a(d,l){if(!ae.isUndefined(l))return i(void 0,l)}function s(d,l){return ae.isUndefined(l)?ae.isUndefined(d)?void 0:i(void 0,d):i(void 0,l)}function o(d,l,h){return h in e?i(d,l):h in n?i(void 0,d):void 0}let c={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(d,l,h)=>r(Zk(d),Zk(l),0,!0)};return ae.forEach(Object.keys(Object.assign({},n,e)),function(d){let l=c[d]||r,h=l(n[d],e[d],d);ae.isUndefined(h)&&l!==o||(t[d]=h)}),t}var Qf=n=>{let e=Zf({},n),t,{data:i,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:s,headers:o,auth:c}=e;if(e.headers=o=Mc.from(o),e.url=WL(sB(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),ae.isFormData(i)){if(so.hasStandardBrowserEnv||so.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((t=o.getContentType())!==!1){let[d,...l]=t?t.split(";").map(h=>hr(h).call(h)).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...l].join("; "))}}if(so.hasStandardBrowserEnv&&(r&&ae.isFunction(r)&&(r=r(e)),r||r!==!1&&aB(e.url))){let d=a&&s&&M4.read(s);d&&o.set(a,d)}return e},oB=typeof XMLHttpRequest<"u"&&function(n){return new se(function(e,t){let i=Qf(n),r=i.data,a=Mc.from(i.headers).normalize(),s,o,c,d,l,{responseType:h,onUploadProgress:_,onDownloadProgress:f}=i;function m(){d&&d(),l&&l(),i.cancelToken&&i.cancelToken.unsubscribe(s),i.signal&&i.signal.removeEventListener("abort",s)}let S=new XMLHttpRequest;function T(){if(!S)return;let C=Mc.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders());mg(function(b){e(b),m()},function(b){t(b),m()},{data:h&&h!=="text"&&h!=="json"?S.response:S.responseText,status:S.status,statusText:S.statusText,headers:C,config:n,request:S}),S=null}S.open(i.method.toUpperCase(),i.url,!0),S.timeout=i.timeout,"onloadend"in S?S.onloadend=T:S.onreadystatechange=function(){S&&S.readyState===4&&(S.status!==0||S.responseURL&&S.responseURL.indexOf("file:")===0)&&setTimeout(T)},S.onabort=function(){S&&(t(new St("Request aborted",St.ECONNABORTED,n,S)),S=null)},S.onerror=function(){t(new St("Network Error",St.ERR_NETWORK,n,S)),S=null},S.ontimeout=function(){let C=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded",b=i.transitional||KL;i.timeoutErrorMessage&&(C=i.timeoutErrorMessage),t(new St(C,b.clarifyTimeoutError?St.ETIMEDOUT:St.ECONNABORTED,n,S)),S=null},r===void 0&&a.setContentType(null),"setRequestHeader"in S&&ae.forEach(a.toJSON(),function(C,b){S.setRequestHeader(b,C)}),ae.isUndefined(i.withCredentials)||(S.withCredentials=!!i.withCredentials),h&&h!=="json"&&(S.responseType=i.responseType),f&&([c,l]=qC(f,!0),S.addEventListener("progress",c)),_&&S.upload&&([o,d]=qC(_),S.upload.addEventListener("progress",o),S.upload.addEventListener("loadend",d)),(i.cancelToken||i.signal)&&(s=C=>{S&&(t(!C||C.type?new Eg(null,n,S):C),S.abort(),S=null)},i.cancelToken&&i.cancelToken.subscribe(s),i.signal&&(i.signal.aborted?s():i.signal.addEventListener("abort",s)));let R=(function(C){let b=/^([-+\w]{1,25})(:?\/\/|:)/.exec(C);return b&&b[1]||""})(i.url);R&&so.protocols.indexOf(R)===-1?t(new St("Unsupported protocol "+R+":",St.ERR_BAD_REQUEST,n)):S.send(r||null)})},U4=(n,e)=>{let{length:t}=n=n?n.filter(Boolean):[];if(e||t){let i,r=new AbortController,a=function(d){if(!i){i=!0,o();let l=d instanceof Error?d:this.reason;r.abort(l instanceof St?l:new Eg(l instanceof Error?l.message:l))}},s=e&&setTimeout(()=>{s=null,a(new St("timeout ".concat(e," of ms exceeded"),St.ETIMEDOUT))},e),o=()=>{n&&(s&&clearTimeout(s),s=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(a):d.removeEventListener("abort",a)}),n=null)};n.forEach(d=>d.addEventListener("abort",a));let{signal:c}=r;return c.unsubscribe=()=>ae.asap(o),c}},Qk=X(jf),Jw=ku.f("asyncIterator"),cB=X(Jw);function $k(n,e){this.v=n,this.k=e}function cc(n){return function(){return new oo(n.apply(this,arguments))}}function oo(n){var e,t;function i(a,s){try{var o=n[a](s),c=o.value,d=c instanceof $k;Qk.resolve(d?c.v:c).then(function(l){if(d){var h=a==="return"?"return":"next";if(!c.k||l.done)return i(h,l);l=n[h](l).value}r(o.done?"return":"normal",l)},function(l){i("throw",l)})}catch(l){r("throw",l)}}function r(a,s){switch(a){case"return":e.resolve({value:s,done:!0});break;case"throw":e.reject(s);break;default:e.resolve({value:s,done:!1})}(e=e.next)?i(e.key,e.arg):t=null}this._invoke=function(a,s){return new Qk(function(o,c){var d={key:a,arg:s,resolve:o,reject:c,next:null};t?t=t.next=d:(e=t=d,i(a,s))})},typeof n.return!="function"&&(this.return=void 0)}function di(n){return new $k(n,0)}function hi(n){var e={},t=!1;function i(r,a){return t=!0,a=new Qk(function(s){s(n[r](a))}),{done:!1,value:new $k(a,1)}}return e[_g!==void 0&&fg||"@@iterator"]=function(){return this},e.next=function(r){return t?(t=!1,r):i("next",r)},typeof n.throw=="function"&&(e.throw=function(r){if(t)throw t=!1,r;return i("throw",r)}),typeof n.return=="function"&&(e.return=function(r){return t?(t=!1,r):i("return",r)}),e}oo.prototype[typeof _g=="function"&&cB||"@@asyncIterator"]=function(){return this},oo.prototype.next=function(n){return this._invoke("next",n)},oo.prototype.throw=function(n){return this._invoke("throw",n)},oo.prototype.return=function(n){return this._invoke("return",n)};var GT=X(Jw);function JC(n){var e,t,i,r=2;for(typeof Symbol<"u"&&(t=GT,i=Symbol.iterator);r--;){if(t&&(e=n[t])!=null)return e.call(n);if(i&&(e=n[i])!=null)return new WT(e.call(n));t="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function WT(n){function e(t){if(Object(t)!==t)return se.reject(new TypeError(t+" is not an object."));var i=t.done;return se.resolve(t.value).then(function(r){return{value:r,done:i}})}return WT=function(t){this.s=t,this.n=t.next},WT.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var i=this.s.return;return i===void 0?se.resolve({value:t,done:!0}):e(i.apply(this.s,arguments))},throw:function(t){var i=this.s.return;return i===void 0?se.reject(t):e(i.apply(this.s,arguments))}},new WT(n)}let Zw=function*(n,e){let t=n.byteLength;if(!e||t<e)return void(yield n);let i,r=0;for(;r<t;)i=r+e,yield n.slice(r,i),r=i},x4=(function(){var n=cc(function*(e,t){var i,r=!1,a=!1;try{for(var s,o=JC(V4(e));r=!(s=yield di(o.next())).done;r=!1){let c=s.value;yield*hi(JC(Zw(c,t)))}}catch(c){a=!0,i=c}finally{try{r&&o.return!=null&&(yield di(o.return()))}finally{if(a)throw i}}});return function(e,t){return n.apply(this,arguments)}})(),V4=(function(){var n=cc(function*(e){if(e[GT])return void(yield*hi(JC(e)));let t=e.getReader();try{for(;;){let{done:i,value:r}=yield di(t.read());if(i)break;yield r}}finally{yield di(t.cancel())}});return function(e){return n.apply(this,arguments)}})(),dB=(n,e,t,i)=>{let r=x4(n,e),a,s=0,o=c=>{a||(a=!0,i&&i(c))};return new ReadableStream({async pull(c){try{let{done:d,value:l}=await r.next();if(d)return o(),void c.close();let h=l.byteLength;if(t){let _=s+=h;t(_)}c.enqueue(new Uint8Array(l))}catch(d){throw o(d),d}},cancel:c=>(o(c),r.return())},{highWaterMark:2})};function e1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function t1(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?e1(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):e1(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let ZC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",QC=ZC&&typeof ReadableStream=="function",lB=ZC&&(typeof TextEncoder=="function"?(uB=new TextEncoder,n=>uB.encode(n)):async n=>new Uint8Array(await new Response(n).arrayBuffer()));var uB;let i1=function(n){try{for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return!!n(...t)}catch{return!1}},hB=QC&&i1(()=>{let n=!1,e=new Request(so.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),r1=QC&&i1(()=>ae.isReadableStream(new Response("").body)),HT={stream:r1&&(n=>n.body)};var $C;ZC&&($C=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(n=>{!HT[n]&&(HT[n]=ae.isFunction($C[n])?e=>e[n]():(e,t)=>{throw new St("Response type '".concat(n,"' is not supported"),St.ERR_NOT_SUPPORT,t)})}));let pB=async(n,e)=>ae.toFiniteNumber(n.getContentLength())??(async i=>i==null?0:ae.isBlob(i)?i.size:ae.isSpecCompliantForm(i)?(await new Request(so.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:ae.isArrayBufferView(i)||ae.isArrayBuffer(i)?i.byteLength:(ae.isURLSearchParams(i)&&(i+=""),ae.isString(i)?(await lB(i)).byteLength:void 0))(e);var F4=ZC&&(async n=>{let{url:e,method:t,data:i,signal:r,cancelToken:a,timeout:s,onDownloadProgress:o,onUploadProgress:c,responseType:d,headers:l,withCredentials:h="same-origin",fetchOptions:_}=Qf(n);d=d?(d+"").toLowerCase():"text";let f,m=U4([r,a&&a.toAbortSignal()],s),S=m&&m.unsubscribe&&(()=>{m.unsubscribe()}),T;try{if(c&&hB&&t!=="get"&&t!=="head"&&(T=await pB(l,i))!==0){let k,P=new Request(e,{method:"POST",body:i,duplex:"half"});if(ae.isFormData(i)&&(k=P.headers.get("content-type"))&&l.setContentType(k),P.body){let[U,W]=XC(T,qC(Xk(c)));i=dB(P.body,65536,U,W)}}ae.isString(h)||(h=h?"include":"omit");let R="credentials"in Request.prototype;f=new Request(e,t1(t1({},_),{},{signal:m,method:t.toUpperCase(),headers:l.normalize().toJSON(),body:i,duplex:"half",credentials:R?h:void 0}));let C=await fetch(f),b=r1&&(d==="stream"||d==="response");if(r1&&(o||b&&S)){let k={};["status","statusText","headers"].forEach(z=>{k[z]=C[z]});let P=ae.toFiniteNumber(C.headers.get("content-length")),[U,W]=o&&XC(P,qC(Xk(o),!0))||[];C=new Response(dB(C.body,65536,U,()=>{W&&W(),S&&S()}),k)}d=d||"text";let N=await HT[ae.findKey(HT,d)||"text"](C,n);return!b&&S&&S(),await new se((k,P)=>{mg(k,P,{data:N,headers:Mc.from(C.headers),status:C.status,statusText:C.statusText,config:n,request:f})})}catch(R){throw S&&S(),R&&R.name==="TypeError"&&/Load failed|fetch/i.test(R.message)?Object.assign(new St("Network Error",St.ERR_NETWORK,n,f),{cause:R.cause||R}):St.from(R,R&&R.code,n,f)}});let n1={http:null,xhr:oB,fetch:F4};ae.forEach(n1,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});let Qw=n=>"- ".concat(n),_B=n=>ae.isFunction(n)||n===null||n===!1;var fB={getAdapter:n=>{n=ae.isArray(n)?n:[n];let{length:e}=n,t,i,r={};for(let a=0;a<e;a++){let s;if(t=n[a],i=t,!_B(t)&&(i=n1[(s=String(t)).toLowerCase()],i===void 0))throw new St("Unknown adapter '".concat(s,"'"));if(i)break;r[s||"#"+a]=i}if(!i){let a=Object.entries(r).map(s=>{let[o,c]=s;return"adapter ".concat(o," ")+(c===!1?"is not supported by the environment":"is not available in the build")});throw new St("There is no suitable adapter to dispatch the request "+(e?a.length>1?`since :
`+a.map(Qw).join(`
`):" "+Qw(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:n1};function $w(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Eg(null,n)}function eO(n){return $w(n),n.headers=Mc.from(n.headers),n.data=vd.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),fB.getAdapter(n.adapter||zC.adapter)(n).then(function(e){return $w(n),e.data=vd.call(n,n.transformResponse,e),e.headers=Mc.from(e.headers),e},function(e){return Xw(e)||($w(n),e&&e.response&&(e.response.data=vd.call(n,n.transformResponse,e.response),e.response.headers=Mc.from(e.response.headers))),se.reject(e)})}let a1="1.9.0",eb={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{eb[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});let tb={};eb.transitional=function(n,e,t){function i(r,a){return"[Axios v"+a1+"] Transitional option '"+r+"'"+a+(t?". "+t:"")}return(r,a,s)=>{if(n===!1)throw new St(i(a," has been removed"+(e?" in "+e:"")),St.ERR_DEPRECATED);return e&&!tb[a]&&(tb[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),!n||n(r,a,s)}},eb.spelling=function(n){return(e,t)=>(console.warn("".concat(t," is likely a misspelling of ").concat(n)),!0)};var ib={assertOptions:function(n,e,t){if(typeof n!="object")throw new St("options must be an object",St.ERR_BAD_OPTION_VALUE);let i=Object.keys(n),r=i.length;for(;r-- >0;){let a=i[r],s=e[a];if(s){let o=n[a],c=o===void 0||s(o,a,n);if(c!==!0)throw new St("option "+a+" must be "+c,St.ERR_BAD_OPTION_VALUE)}else if(t!==!0)throw new St("Unknown option "+a,St.ERR_BAD_OPTION)}},validators:eb};let yd=ib.validators,Cd=class{constructor(n){this.defaults=n||{},this.interceptors={request:new HL,response:new HL}}async request(n,e){try{return await this._request(n,e)}catch(t){if(t instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;let r=i.stack?i.stack.replace(/^.+\n/,""):"";try{t.stack?r&&!String(t.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+r):t.stack=r}catch{}}throw t}}_request(n,e){typeof n=="string"?(e=e||{}).url=n:e=n||{},e=Zf(this.defaults,e);let{transitional:t,paramsSerializer:i,headers:r}=e;t!==void 0&&ib.assertOptions(t,{silentJSONParsing:yd.transitional(yd.boolean),forcedJSONParsing:yd.transitional(yd.boolean),clarifyTimeoutError:yd.transitional(yd.boolean)},!1),i!=null&&(ae.isFunction(i)?e.paramsSerializer={serialize:i}:ib.assertOptions(i,{encode:yd.function,serialize:yd.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),ib.assertOptions(e,{baseUrl:yd.spelling("baseURL"),withXsrfToken:yd.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=r&&ae.merge(r.common,r[e.method]);r&&ae.forEach(["delete","get","head","post","put","patch","common"],f=>{delete r[f]}),e.headers=Mc.concat(a,r);let s=[],o=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(e)===!1||(o=o&&f.synchronous,s.unshift(f.fulfilled,f.rejected))});let c=[],d;this.interceptors.response.forEach(function(f){c.push(f.fulfilled,f.rejected)});let l,h=0;if(!o){let f=[eO.bind(this),void 0];for(f.unshift.apply(f,s),f.push.apply(f,c),l=f.length,d=se.resolve(e);h<l;)d=d.then(f[h++],f[h++]);return d}l=s.length;let _=e;for(h=0;h<l;){let f=s[h++],m=s[h++];try{_=f(_)}catch(S){m.call(this,S);break}}try{d=eO.call(this,_)}catch(f){return se.reject(f)}for(h=0,l=c.length;h<l;)d=d.then(c[h++],c[h++]);return d}getUri(n){return WL(sB((n=Zf(this.defaults,n)).baseURL,n.url,n.allowAbsoluteUrls),n.params,n.paramsSerializer)}};ae.forEach(["delete","get","head","options"],function(n){Cd.prototype[n]=function(e,t){return this.request(Zf(t||{},{method:n,url:e,data:(t||{}).data}))}}),ae.forEach(["post","put","patch"],function(n){function e(t){return function(i,r,a){return this.request(Zf(a||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}Cd.prototype[n]=e(),Cd.prototype[n+"Form"]=e(!0)});var gg=Cd;class KT{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new se(function(r){t=r});let i=this;this.promise.then(r=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](r);i._listeners=null}),this.promise.then=r=>{let a,s=new se(o=>{i.subscribe(o),a=o}).then(r);return s.cancel=function(){i.unsubscribe(a)},s},e(function(r,a,s){i.reason||(i.reason=new Eg(r,a,s),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=i=>{e.abort(i)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new KT(function(t){e=t}),cancel:e}}}var s1=KT;let o1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(o1).forEach(n=>{let[e,t]=n;o1[t]=e});var c1=o1;let os=(function n(e){let t=new gg(e),i=AL(gg.prototype.request,t);return ae.extend(i,gg.prototype,t,{allOwnKeys:!0}),ae.extend(i,t,null,{allOwnKeys:!0}),i.create=function(r){return n(Zf(e,r))},i})(zC);os.Axios=gg,os.CanceledError=Eg,os.CancelToken=s1,os.isCancel=Xw,os.VERSION=a1,os.toFormData=ug,os.AxiosError=St,os.Cancel=os.CanceledError,os.all=function(n){return se.all(n)},os.spread=function(n){return function(e){return n.apply(null,e)}},os.isAxiosError=function(n){return ae.isObject(n)&&n.isAxiosError===!0},os.mergeConfig=Zf,os.AxiosHeaders=Mc,os.formToJSON=n=>rB(ae.isHTMLForm(n)?new FormData(n):n),os.getAdapter=fB.getAdapter,os.HttpStatusCode=c1,os.default=os;var mr=os;let co=()=>{};function rb(){let n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:co};return n.promise=new se((e,t)=>{n.resolve=i=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,e(i),n.value=i)},n.reject=i=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,t(i))}}),n}let $f=new Map,Sg=new Map,bd=new Map,Br=(function(n){return n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.CHROMIUM_OS="Chromium OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot",n})({}),Ot=(function(n){return n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger",n})({}),bi=new g6,pl=bi.getResult(),Ad=null;function pi(n){if(!Ad){pl=bi.getResult();let e=(function(o){if(o.engine.name==="Blink"&&o.browser.name!=="WeChat")return Ot.CHROME;switch(o.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ot.CHROME;case"Safari":case"Mobile Safari":return Ot.SAFARI;case"Edge":return Ot.EDGE;case"Firefox":return Ot.FIREFOX;case"QQ":case"QQBrowser":return Ot.QQ;case"Opera":return Ot.OPERA;case"WeChat":return Ot.WECHAT;default:return o.browser.name||""}})(pl),t=_i(pl),i=(function(o){return o.os.name==="Windows"?o.os.version?o.os.name+" "+o.os.version:o.os.name:o.os.name||""})(pl),r=pl.os.version,a=_i(pl,!1),s=pl.device.type;if(!(e&&t&&i&&r))return{name:e,version:t,os:i,osVersion:r,browserVersion:a,deviceType:s};Ad={name:e,version:t,os:i,osVersion:r,browserVersion:a,deviceType:s}}return Ad}function _i(n){let e,t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=n.engine.name==="Blink"?n.engine.version||"":n.browser.version||"",t?e.split(".")[0]:e}function nb(){return pi().os}function ab(){let n=pi();return"".concat(n.os," ").concat(n.osVersion)}function sb(){let n=pi();return!!(pl.engine.name==="WebKit"&&n.os===Br.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==Ot.SAFARI||Ci()&&n.name!==Ot.SAFARI)}function _l(){return pi().name===Ot.CHROME}function dn(){return pi().name===Ot.SAFARI}function Ra(){let n=pi();if(n.name!==Ot.SAFARI||!n.browserVersion)return!1;let e=n.browserVersion.split(".");return Number(e[0])>15||Number(e[0])===15&&Number(e[1])>=4}function d1(){return pi().name===Ot.EDGE}function jr(){return pi().name===Ot.FIREFOX}function Ci(){return pi().os===Br.IOS}function Jn(n){let e=pi();return!(e.name!==Ot.CHROME||!e.osVersion)&&Number(e.version)>=n}function Tg(n){let e=pi();return!(e.name!==Ot.CHROME||!e.osVersion)&&Number(e.version)<n}function tO(n,e,t){let i=pi();return!(i.name!==n||!i.osVersion)&&(t?Number(i.version)>=e&&Number(i.version)<=t:Number(i.version)===e)}function ob(n){let e=pi();return!(e.name!==Ot.EDGE||!e.osVersion)&&Number(e.version)>=n}function cb(n){let e=pi();return!(e.name!==Ot.FIREFOX||!e.osVersion)&&Number(e.version)>=n}function iO(n){let e=pi();return!(e.name!==Ot.SAFARI||!e.osVersion)&&Number(e.version)>=n}function l1(n,e,t){let i=pi();if(i.os!==Br.IOS||!i.osVersion)return!1;let r=i.osVersion.split(".");return t?e&&Number(r[0])===n&&Number(r[1])>e||Number(r[0])>n:e?Number(r[0])===n&&Number(r[1])>=e||Number(r[0])>n:Number(r[0])>=n}function u1(n,e,t){let i=pi();if(i.os!==Br.IOS||!i.osVersion)return!1;let r=i.osVersion.split(".");return e&&Number(r[0])===n&&Number(r[1])<e||Number(r[0])<n}function rO(n,e,t){let i=pi();if(i.name!==Ot.SAFARI||!i.osVersion||!i.browserVersion)return!1;let r=i.browserVersion.split(".");return t?e&&Number(r[0])===n&&Number(r[1])<e||Number(r[0])<n:e?Number(r[0])===n&&Number(r[1])<=e||Number(r[0])<n:Number(r[0])<=n}function db(n){let e=pi();return!(e.name!==Ot.OPERA||!e.osVersion)&&Number(e.version)>=n}function nO(){let n=pi();if(n.os!==Br.IOS||!n.osVersion)return!1;let e=n.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Rg(){let n=pi();if(n.os!==Br.IOS||!n.osVersion)return!1;let e=n.osVersion.split(".");return Number(e[0])===15}function eE(){let n=pi();if(n.os!==Br.IOS||!n.osVersion)return!1;let e=n.osVersion.split(".");return Number(e[0])===16}function aO(){let n=pi();if(n.os!==Br.IOS||!n.osVersion)return!1;let e=n.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function Id(){return dn()&&navigator.maxTouchPoints>0}function wd(){return pi().name===Ot.WECHAT}function h1(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function sO(){let n=nb();return(function(){let{deviceType:e}=pi();return e==="mobile"||e==="tablet"})()||n===Br.ANDROID||n===Br.IOS||n===Br.HARMONY_OS}function xu(){let n=pi();return n.name!==Ot.EDGE&&n.name!==Ot.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function fl(){return nb()===Br.ANDROID}function tE(){let n=pi();return fl()&&(n.name===Ot.CHROME||n.name===Ot.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Rt(n,e,t){return(e=(function(i){var r=(function(a,s){if(typeof a!="object"||!a)return a;var o=a[Symbol.toPrimitive];if(o!==void 0){var c=o.call(a,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)})(i);return typeof r=="symbol"?r:r+""})(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function wt(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function we(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wt(Object(t),!0).forEach(function(i){Rt(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wt(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let M=(function(n){return n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.TOKEN_EXPIRE="TOKEN_EXPIRE",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",n.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",n})({}),L=class extends Error{constructor(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0;super(e),Rt(this,"code",void 0),Rt(this,"message",void 0),Rt(this,"data",void 0),Rt(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=t}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return n==="error"&&(e||console).error(this.toString()),n==="warning"&&(e||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function _e(n,e){if(typeof n!="boolean")throw new L(M.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function gr(n,e,t){if(!ee(t).call(t,n))throw new L(M.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(t)))}function Bt(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(n<t||n>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(r){return typeof r=="number"&&r%1==0})(n))throw new L(M.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(t,", ").concat(i,"]. integer only"))}function ji(n,e){if(typeof n!="number"){if(!(n.min||n.max||n.ideal||n.exact))throw new L(M.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));n.min!==void 0&&Bt(n.min,"".concat(e,".min"),0,1/0),n.max!==void 0&&Bt(n.max,"".concat(e,".max"),1,1/0),n.exact!==void 0&&Bt(n.exact,"".concat(e,".exact"),1,1/0),n.ideal!==void 0&&Bt(n.ideal,"".concat(e,".ideal"),1,1/0)}else Bt(n,e,1,1/0)}function Zn(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(n==null)throw new L(M.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!Gr(n,t,i,r))throw new L(M.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(t,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function rn(n,e){if(!Array.isArray(n))throw new L(M.INVALID_PARAMS,"".concat(e," should be an array"))}function zi(n){return n==null}function Gr(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof n=="string"&&n.length<=t&&n.length>=e&&(!i||(function(r){if(typeof r!="string")return!1;for(let a=0;a<r.length;a+=1){let s=r.charCodeAt(a);if(s<0||s>255)return!1}return!0})(n))}var YT=(function(n){return n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE",n})(YT||{}),vg=(function(n){return n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",n})(vg||{});let oO=new class{constructor(){Rt(this,"_clientSize",null),Rt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Rt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Rt(this,"getStyle",n=>window.getComputedStyle(n,null)),Rt(this,"checkCssVisibleProperty",n=>{var e;let t=!0,i=this.getStyle(n),{display:r,visibility:a,opacity:s,filter:o}=i;return(r==="none"||ee(e=["hidden","collapse"]).call(e,a)||Number(s)<.1)&&(t=!1),!!t&&(o&&o.split(" ").filter(c=>{var d;let l=c.split("(")[0];return ee(d=["brightness","blur","opacity"]).call(d,l)}).map(c=>{let[d,l]=c.split(/\(|\)/);return[d,Number(l.match(/^[0-9\.]+/))]}).forEach(c=>{let[d,l]=c;switch(d){case"brightness":(l<.1||l>3)&&(t=!1);break;case"blur":l>3&&(t=!1);break;case"opacity":l<.1&&(t=!1)}}),t)}),Rt(this,"checkPropertyUpToAllParentNodes",(n,e)=>{let t=!0,i=!0,r=s=>e(s),a=n;for(;a&&i;)r(a)||(t=!1,i=!1),a=a.parentElement,a||(i=!1);return t}),Rt(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),Rt(this,"getSizeAboutClient",n=>{let{width:e,height:t,left:i,right:r,top:a,bottom:s}=n.getBoundingClientRect(),o=this.getClientWidth(),c=this.getClientHeight();return{width:e,height:t,left:i,right:r,top:a,bottom:s,clientWidth:o,clientHeight:c,clientMin:Math.min(o,c)}}),Rt(this,"checkActualSize",()=>{let{width:n,height:e,clientMin:t}=this._clientSize;return this.checkSizeIsVisible(n,e,t)}),Rt(this,"elementFromPoint",(n,e)=>document.elementFromPoint?document.elementFromPoint(n,e):null),Rt(this,"checkCoverForAPoint",(n,e,t)=>{let i=this.elementFromPoint(n,e);return i!==null&&i!==t}),Rt(this,"getPointPositionList",()=>{let{width:n,height:e,left:t,top:i}=this._clientSize,r=n/6,a=e/6,s=[],o=10**6;for(let c=0;c<5;c++)for(let d=0;d<5;d++){let l=(t*o+(c===0?.1:c===4?(r*c*o-1e5)/o:r*c)*o)/o,h=(i*o+(d===0?.1:d===4?(a*d*o-1e5)/o:a*d)*o)/o;s.push({x:l,y:h})}return[...s]}),Rt(this,"checkElementCover",n=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,n)).filter(e=>!!e).length>6),Rt(this,"checkSizeIsVisible",(n,e,t)=>(n>50||t/n<=10)&&(e>50||t/e<=10)),Rt(this,"checkSizeOfPartInClient",()=>{let{left:n,right:e,top:t,bottom:i,clientHeight:r,clientWidth:a,clientMin:s}=this._clientSize,o,c,d,l;if(n<0)o=0;else{if(!(n<a))return!1;o=n}if(e<0)return!1;if(c=e<a?e:a,t<0)d=0;else{if(!(t<r))return!1;d=t}if(i<0)return!1;l=i<r?i:r;let h=c-o,_=l-d;return this.checkSizeIsVisible(h,_,s)}),Rt(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),Rt(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(YT.COVERED);{let e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(YT.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(YT.SIZE)}}return this.returnHiddenResult(YT.STYLE)}return this.returnHiddenResult(vg.UNMOUNTED)}return this.returnHiddenResult(vg.INVALID_HTML_ELEMENT)}),Rt(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function cO(n){return new TextEncoder().encode(n)}let dO=function(n,e){let t=new Uint8Array(n.byteLength+e.byteLength);return t.set(new Uint8Array(n),0),t.set(new Uint8Array(e),n.byteLength),t},lO=async n=>(function(e,t){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(t).padStart(2,"0")}),i})(await crypto.subtle.digest("SHA-256",cO(n)),16);class Sr{constructor(){Rt(this,"_events",{}),Rt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let i=this._events[e],r=this._indexOfListener(i,t);r!==-1&&i.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(s=>s);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];for(let s=0;s<t.length;s+=1){let o=t[s];o.once&&this.off(e,o.listener),o.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];[...this._events[e]||[]].forEach(a=>{a.once&&this.off(e,a.listener);try{a.listener.apply(this,i)}catch(s){console.error("safeEmit event:".concat(e," error ").concat(s?.toString()))}})}_indexOfListener(e,t){let i=e.length;for(;i--;)if(e[i].listener===t)return i;return-1}}let or=null;function zT(){if(or)return or;if(window.electron)return or=window.electron;if(!window.require)return null;try{return or=window.require("electron"),or}catch{return null}}let Jr=(function(n){return n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.PRELOAD="PRELOAD",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload",n.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",n.PRELOAD_MEDIA_FAILED="preloadMediaFailed",n.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",n})({}),Gt=(function(n){return n.TRACER="tracer",n})({});function Tr(n){return Bt(n.timeout,"config.timeout",0,1e5),Bt(n.timeoutFactor,"config.timeoutFactor",0,100,!1),Bt(n.maxRetryCount,"config.maxRetryConfig",0,1/0),Bt(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let EB=(function(n){return n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",n})({}),Vi=(function(n){return n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.FALLBACK="FALLBACK",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE",n})({});function Oi(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function qT(n){return Zn(n.turnServerURL,"turnServerURL"),Zn(n.username,"username"),Zn(n.password,"password"),n.udpport&&Bt(n.udpport,"udpport",1,99999,!0),n.forceturn&&_e(n.forceturn,"forceturn"),n.security&&_e(n.security,"security"),n.tcpport&&Bt(n.tcpport,"tcpport",1,99999,!0),!0}function uO(n){return n.level!==void 0&&gr(n.level,"level",[1,2,3]),n.delay!==void 0&&Bt(n.delay,"delay",0,3e3,!0),!0}let ri=(function(n){return n.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",n.AUDIO_METADATA="audio-metadata",n.AUDIO_PTS="audio-pts",n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",n})({}),yt=(function(n){return n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK",n.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",n})({}),Rr=(function(n){return n.ONLINE="ONLINE",n.OFFLINE="OFFLINE",n})({}),cs=(function(n){return n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE",n})({});function kn(n,e){for(var t=arguments.length,i=new Array(t>2?t-2:0),r=2;r<t;r++)i[r-2]=arguments[r];return n.getListeners(e).length===0?se.reject(new L(M.UNEXPECTED_ERROR,"can not emit promise")):new se((a,s)=>{n.emit(e,...i,a,s)})}function zt(n,e){if(n.getListeners(e).length===0)return se.resolve();for(var t=arguments.length,i=new Array(t>2?t-2:0),r=2;r<t;r++)i[r-2]=arguments[r];return kn(n,e,...i)}function fi(n,e){if(n.getListeners(e).length===0)return null;for(var t=arguments.length,i=new Array(t>2?t-2:0),r=2;r<t;r++)i[r-2]=arguments[r];return Bs(n,e,...i)}function Bs(n,e){let t=null,i=null;for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];if(n.emit(e,...a,o=>{t=o},o=>{i=o}),i!==null)throw i;if(t===null)throw new L(M.UNEXPECTED_ERROR,"handler is not sync");return t}let Kr=new class extends Sr{set networkState(n){this.emit(cs.NETWORK_STATE_CHANGE,n,this._networkState),n===Rr.ONLINE?this.emit(cs.ONLINE):n===Rr.OFFLINE&&(this.onlineWaiter=new se(e=>{this.once(cs.ONLINE,()=>{this.onlineWaiter=void 0,e(Rr.ONLINE)})}),this.emit(cs.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===Rr.ONLINE}constructor(){super(),Rt(this,"_moduleName","network-indicator"),Rt(this,"_networkState",Rr.ONLINE),Rt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Rr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Rr.OFFLINE})}};function Zr(n,e){let t=n.indexOf(e);t!==-1&&n.splice(t,1)}function t_(n){let e=[];return n.forEach(t=>{e.indexOf(t)===-1&&e.push(t)}),e}function i_(n){se!==void 0?se.resolve().then(n):setTimeout(n,0)}function cr(n){return JSON.parse(JSON.stringify(n))}function qi(n){try{return cr(n)}catch{return n}}let iE={};function r_(n,e){iE[e]||(iE[e]=!0,n())}function Uc(n){let e=window.atob(n),t=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)t[i]=e.charCodeAt(i);return t}function xc(n){let e="";for(let t=0;t<n.length;t+=1)e+=String.fromCharCode(n[t]);return window.btoa(e)}function n_(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=new TextEncoder().encode(n);if(t.length>e)t=t.slice(0,e);else if(t.length<e){let i=new Uint8Array(e);i.set(t),t=i}return t}function p1(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];let i=Pn(e).call(e,(s,o)=>s+o.length,0),r=new Uint8Array(new ArrayBuffer(i)),a=0;return e.forEach(s=>{r.set(s,a),a+=s.length}),r}function Vu(n){return window.TextEncoder?new TextEncoder().encode(n).length:n.length}function Fu(n){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&n.realFormData&&(n=n.realFormData),n.forEach(t=>{e+=typeof t=="string"?Vu(t):t.size}),e+138}function mB(n){let e=new L(M.TIMEOUT,"timeout");return new se((t,i)=>{window.setTimeout(()=>i(e),n)})}function va(n){return new se(e=>{window.setTimeout(e,n)})}function Ht(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0,t=Math.random().toString(16).substr(2,n).toLowerCase();return t.length===n?"".concat(e).concat(t):"".concat(e).concat(t)+Ht(n-t.length,"")}function Mi(){return Ht(32,"").toUpperCase()}let Yh=()=>{},lb=new class{constructor(){Rt(this,"fnMap",new Map)}throttleByKey(n,e,t,i){for(var r=arguments.length,a=new Array(r>4?r-4:0),s=4;s<r;s++)a[s-4]=arguments[s];if(this.fnMap.has(e)){let o=this.fnMap.get(e);if(o.threshold!==t){o.fn(...o.args),clearTimeout(o.timer);let c=window.setTimeout(()=>{let d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},t);this.fnMap.set(e,{fn:n,threshold:t,timer:c,args:a,skipFn:i})}else o.skipFn&&o.skipFn(...o.args),this.fnMap.set(e,we(we({},o),{},{fn:n,args:a,skipFn:i}))}else{let o=window.setTimeout(()=>{let c=this.fnMap.get(e);c&&c.fn(...c.args),this.fnMap.delete(e)},t);this.fnMap.set(e,{fn:n,threshold:t,timer:o,args:a,skipFn:i})}}},_1=lb.throttleByKey.bind(lb);function f1(n){return typeof n=="object"&&n!==null&&!(n instanceof RegExp)}function hO(n,e){if(!f1(n)||!f1(e)||Array.isArray(n)&&!Array.isArray(e)||!Array.isArray(n)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(n)){let t=[...n];for(let i=0;i<e.length;i++)t[i]=hO(n[i],e[i]);return t}{let t=we({},n);for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(n,i)?t[i]=hO(n[i],e[i]):t[i]=e[i]);return t}}function pO(n,e){let t=[0];if(t=new Array(e).fill(0),n===0)return t;let i=0;for(;n>0&&(t[i]=255&n,n>>=8,i++,i!==e););return t}function yg(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function rE(n){return Pn(n).call(n,(e,t)=>e+t,0)}function _O(n){let e="0123456789abcdef";function t(b){let N,k="";for(N=0;N<=3;N++)k+=e.charAt(b>>8*N+4&15)+e.charAt(b>>8*N&15);return k}function i(b,N){let k=(65535&b)+(65535&N);return(b>>16)+(N>>16)+(k>>16)<<16|65535&k}function r(b,N,k,P,U,W){return i((function(z,Q){return z<<Q|z>>>32-Q})(i(i(N,b),i(P,W)),U),k)}function a(b,N,k,P,U,W,z){return r(N&k|~N&P,b,N,U,W,z)}function s(b,N,k,P,U,W,z){return r(N&P|k&~P,b,N,U,W,z)}function o(b,N,k,P,U,W,z){return r(N^k^P,b,N,U,W,z)}function c(b,N,k,P,U,W,z){return r(k^(N|~P),b,N,U,W,z)}let d=(function(b){let N,k=1+(b.length+8>>6),P=new Array(16*k);for(N=0;N<16*k;N++)P[N]=0;for(N=0;N<b.length;N++)P[N>>2]|=b.charCodeAt(N)<<N%4*8;return P[N>>2]|=128<<N%4*8,P[16*k-2]=8*b.length,P})(n),l,h,_,f,m,S=1732584193,T=-271733879,R=-1732584194,C=271733878;for(l=0;l<d.length;l+=16)h=S,_=T,f=R,m=C,S=a(S,T,R,C,d[l+0],7,-680876936),C=a(C,S,T,R,d[l+1],12,-389564586),R=a(R,C,S,T,d[l+2],17,606105819),T=a(T,R,C,S,d[l+3],22,-1044525330),S=a(S,T,R,C,d[l+4],7,-176418897),C=a(C,S,T,R,d[l+5],12,1200080426),R=a(R,C,S,T,d[l+6],17,-1473231341),T=a(T,R,C,S,d[l+7],22,-45705983),S=a(S,T,R,C,d[l+8],7,1770035416),C=a(C,S,T,R,d[l+9],12,-1958414417),R=a(R,C,S,T,d[l+10],17,-42063),T=a(T,R,C,S,d[l+11],22,-1990404162),S=a(S,T,R,C,d[l+12],7,1804603682),C=a(C,S,T,R,d[l+13],12,-40341101),R=a(R,C,S,T,d[l+14],17,-1502002290),T=a(T,R,C,S,d[l+15],22,1236535329),S=s(S,T,R,C,d[l+1],5,-165796510),C=s(C,S,T,R,d[l+6],9,-1069501632),R=s(R,C,S,T,d[l+11],14,643717713),T=s(T,R,C,S,d[l+0],20,-373897302),S=s(S,T,R,C,d[l+5],5,-701558691),C=s(C,S,T,R,d[l+10],9,38016083),R=s(R,C,S,T,d[l+15],14,-660478335),T=s(T,R,C,S,d[l+4],20,-405537848),S=s(S,T,R,C,d[l+9],5,568446438),C=s(C,S,T,R,d[l+14],9,-1019803690),R=s(R,C,S,T,d[l+3],14,-187363961),T=s(T,R,C,S,d[l+8],20,1163531501),S=s(S,T,R,C,d[l+13],5,-1444681467),C=s(C,S,T,R,d[l+2],9,-51403784),R=s(R,C,S,T,d[l+7],14,1735328473),T=s(T,R,C,S,d[l+12],20,-1926607734),S=o(S,T,R,C,d[l+5],4,-378558),C=o(C,S,T,R,d[l+8],11,-2022574463),R=o(R,C,S,T,d[l+11],16,1839030562),T=o(T,R,C,S,d[l+14],23,-35309556),S=o(S,T,R,C,d[l+1],4,-1530992060),C=o(C,S,T,R,d[l+4],11,1272893353),R=o(R,C,S,T,d[l+7],16,-155497632),T=o(T,R,C,S,d[l+10],23,-1094730640),S=o(S,T,R,C,d[l+13],4,681279174),C=o(C,S,T,R,d[l+0],11,-358537222),R=o(R,C,S,T,d[l+3],16,-722521979),T=o(T,R,C,S,d[l+6],23,76029189),S=o(S,T,R,C,d[l+9],4,-640364487),C=o(C,S,T,R,d[l+12],11,-421815835),R=o(R,C,S,T,d[l+15],16,530742520),T=o(T,R,C,S,d[l+2],23,-995338651),S=c(S,T,R,C,d[l+0],6,-198630844),C=c(C,S,T,R,d[l+7],10,1126891415),R=c(R,C,S,T,d[l+14],15,-1416354905),T=c(T,R,C,S,d[l+5],21,-57434055),S=c(S,T,R,C,d[l+12],6,1700485571),C=c(C,S,T,R,d[l+3],10,-1894986606),R=c(R,C,S,T,d[l+10],15,-1051523),T=c(T,R,C,S,d[l+1],21,-2054922799),S=c(S,T,R,C,d[l+8],6,1873313359),C=c(C,S,T,R,d[l+15],10,-30611744),R=c(R,C,S,T,d[l+6],15,-1560198380),T=c(T,R,C,S,d[l+13],21,1309151649),S=c(S,T,R,C,d[l+4],6,-145523070),C=c(C,S,T,R,d[l+11],10,-1120210379),R=c(R,C,S,T,d[l+2],15,718787259),T=c(T,R,C,S,d[l+9],21,-343485551),S=i(S,h),T=i(T,_),R=i(R,f),C=i(C,m);return t(S)+t(T)+t(R)+t(C)}let gB=1,SB=console,xa=class{static setLogger(n){SB=n}constructor(n,e){Rt(this,"id",void 0),Rt(this,"lockingPromise",se.resolve()),Rt(this,"locks",0),Rt(this,"name",""),Rt(this,"lockId",void 0),this.lockId=gB++,n&&(this.name=n),e&&(this.id=e),this.logger("created")}logger(n,e){let t=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=n==="created"?"is ".concat(n,"."):"is ".concat(n,", current queue ").concat(this.locks,". ").concat(e??"");SB.debug("".concat(t," ").concat(i))}setId(n){this.id=n}get isLocked(){return this.locks>0}lock(n){let e;this.locks+=1,this.logger("locked",n);let t=new se(r=>{e=()=>{this.locks-=1,this.logger("unlocked",n),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>t),i}};function Wn(n,e){return function(t,i,r){let a=r.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let s=this[e];if(!s)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(n));let o=await s.lock("From ".concat(n,".").concat(i));try{for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];return await a.apply(this,d)}finally{o()}},r}}let Yr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function ln(n,e){let t=Math.floor(e.timeout*Math.pow(e.timeoutFactor,n));return Math.min(e.maxRetryTimeout,t)}function Od(n,e,t,i){let r=Object.assign({},Yr,i),a=r.timeout,s=async()=>{await(function(d){return new se(l=>{window.setTimeout(l,d)})})(a),a*=r.timeoutFactor,a=Math.min(r.maxRetryTimeout,a)},o=!1,c=new se(async(d,l)=>{e=e||(()=>!1),t=t||(()=>!0);for(let h=0;h<r.maxRetryCount;h+=1){if(o)return l(new L(M.OPERATION_ABORTED));try{let _=await n();if(!e(_,h)||h+1===r.maxRetryCount)return d(_);await s()}catch(_){if(!t(_,h)||h+1===r.maxRetryCount)return l(_);await s()}}});return c.cancel=()=>o=!0,c}let Vc,ub=class{constructor(n){Rt(this,"input",[]),Rt(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}mean(){var n;return this.input.length===0?0:Pn(n=this.input).call(n,(e,t)=>e+t)/this.input.length}},hb=0,XT=0;function pb(n,e,t,i){return new se((r,a)=>{e.responseType=e.responseType||"json",e.data&&!t?(e.data=JSON.stringify(e.data),hb+=Vu(e.data)):t&&(e.data.size?hb+=e.data.size:e.data instanceof FormData?hb+=Fu(e.data):hb+=Vu(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=n,mr.request(e).then(s=>{typeof s.data=="string"?XT+=Vu(s.data):s.data instanceof ArrayBuffer||s.data instanceof Uint8Array?XT+=s.data.byteLength:XT+=Vu(JSON.stringify(s.data)),r(s.data)}).catch(s=>{mr.isCancel(s)?a(new L(M.OPERATION_ABORTED,"cancel token canceled")):s.code==="ECONNABORTED"?a(new L(M.NETWORK_TIMEOUT,s.message)):s.response?a(new L(M.NETWORK_RESPONSE_ERROR,s.response.status)):a(new L(M.NETWORK_ERROR,s.message))})})}async function E1(n,e){let t=new Blob([e.data],{type:"buffer"});return await pb(n,we(we({},e),{},{data:t,headers:{"Content-Type":"application/octet-stream"}}),!0)}let TB=()=>window.isSecureContext!==void 0;function Nd(n){if(Array.isArray(n))return n.map(t=>t);if(!Dd(n))return n;let e={};for(let t in n){let i=n[t];Dd(i)||Array.isArray(i)?e[t]=Nd(i):e[t]=i}return e}function Dd(n){return!(typeof n!="object"||Array.isArray(n)||!n)}let fO=class{constructor(n){Rt(this,"input",[]),Rt(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},El={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Fc={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:El,remoteCandidate:El},updateInterval:0},JT={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},m1={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},g1={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},S1={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},EO=class{constructor(n,e){Rt(this,"onFirstVideoReceived",void 0),Rt(this,"onFirstVideoDecoded",void 0),Rt(this,"onFirstAudioReceived",void 0),Rt(this,"onFirstVideoDecodedTimeout",void 0),Rt(this,"onFirstAudioDecoded",void 0),Rt(this,"onSelectedLocalCandidateChanged",void 0),Rt(this,"onSelectedRemoteCandidateChanged",void 0),Rt(this,"videoIsReady",!1),Rt(this,"videoIsReady2",{}),Rt(this,"pc",void 0),Rt(this,"options",void 0),Rt(this,"intervalTimer",void 0),Rt(this,"stats",Nd(Fc)),Rt(this,"isFirstVideoReceived",{}),Rt(this,"isFirstVideoDecoded",{}),Rt(this,"isFirstAudioReceived",{}),Rt(this,"isFirstAudioDecoded",{}),Rt(this,"isFirstVideoDecodedTimeout",{}),Rt(this,"lossRateWindowStats",[]),this.pc=n,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new se(n=>{n({local:we({},El),remote:we({},El)})})}setVideoIsReady(n){this.videoIsReady=n}setVideoIsReady2(n,e){this.videoIsReady2[n]=e}getVideoIsReady(n){return this.videoIsReady2[n]||!1}setIsFirstAudioDecoded(n){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(n){this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let e=this.lossRateWindowStats.length,t=["videoSend","audioSend","videoRecv","audioRecv"],i=0,r=0,a=0,s=0;for(let o of t)n[o].forEach((c,d)=>{if(!this.lossRateWindowStats[e-1][o][d]||!this.lossRateWindowStats[0][o][d])return;let l=this.lossRateWindowStats[e-1][o][d].packets-this.lossRateWindowStats[0][o][d].packets,h=this.lossRateWindowStats[e-1][o][d].packetsLost-this.lossRateWindowStats[0][o][d].packetsLost;o==="videoSend"||o==="audioSend"?(i+=l,a+=h):(r+=l,s+=h),Number.isNaN(l)||Number.isNaN(l)?c.packetLostRate=0:c.packetLostRate=l<=0||h<=0?0:h/(l+h)});n.sendPacketLossRate=i<=0||a<=0?0:a/(i+a),n.recvPacketLossRate=r<=0||s<=0?0:s/(r+s)}},T1=class extends EO{constructor(){super(...arguments),Rt(this,"_stats",Fc),Rt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let n=await this._getStats(),e=this.statsResponsesToObjects(n);this._stats=Nd(Fc);let t=e.filter(r=>r.type==="ssrc");this.processSSRCStats(t);let i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)}processSSRCStats(n){n.forEach(e=>{var t;let i=ee(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{let r=Nd(m1);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{let r=Nd(JT),a=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),a){let s=a.stats,o=Date.now()-a.lts;r.framesDecodeFreezeTime=s.framesDecodeFreezeTime,r.framesDecodeInterval=s.framesDecodeInterval,r.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=o,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<a.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:we({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{let r=Nd(S1);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{let r=Nd(g1);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new se((n,e)=>{this.pc.getStats(n,e)})}statsResponsesToObjects(n){let e=[];return n.result().forEach(t=>{let i={id:t.id,timestamp:t.timestamp.valueOf().toString(),type:t.type};t.names().forEach(r=>{i[r]=t.stat(r)}),e.push(i)}),e}},_b=(function(n){return n.BANDWIDTH="bandwidth",n.CPU="cpu",n.NONE="none",n.OTHER="other",n})({}),nE=(function(n){return n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L1T3_KEY="L1T3_KEY",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY",n})({}),ZT=(function(n){return n[n.new=0]="new",n[n.connecting=1]="connecting",n[n.connected=2]="connected",n[n.disconnected=3]="disconnected",n[n.failed=4]="failed",n[n.closed=5]="closed",n})({}),Po=(function(n){return n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver",n})({});var vs=(function(n){return n[n.kNone=1]="kNone",n[n.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",n[n.kBytesToBits=8]="kBytesToBits",n})(vs||{});function zh(n,e,t,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:vs.kNone;if(!e)return;let a=Number(e[t]);if(typeof a!="number")return;let s=Number(e[i]);if(typeof s!="number")return;if(!n)return s?a/s*r:void 0;let o=Number(n[t]);if(typeof o!="number")return;let c=Number(n[i]);if(typeof c!="number")return;let d=s-c;return d?(a-o)/d*r:void 0}let QT=class extends EO{constructor(){super(...arguments),Rt(this,"_stats",Fc),Rt(this,"report",void 0),Rt(this,"lastDecodeVideoReceiverStats",new Map),Rt(this,"lastVideoFramesRecv",new Map),Rt(this,"lastVideoFramesSent",new Map),Rt(this,"lastVideoFramesDecode",new Map),Rt(this,"lastVideoFramesOutput",new Map),Rt(this,"lastVideoJBDelay",new Map),Rt(this,"lastAudioJBDelay",new Map),Rt(this,"mediaBytesSent",new Map),Rt(this,"mediaBytesRetransmit",new Map),Rt(this,"mediaBytesTargetEncode",new Map),Rt(this,"lastDecodeAudioReceiverStats",new Map),Rt(this,"lastAudioConcealment",new Map),Rt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Nd(Fc),this.report.forEach(n=>{switch(n.type){case Po.OUTBOUND:case Po.INBOUND:{let e=n.mediaType||n.kind,t=!e&&"frameWidth"in n,i=!e&&!("frameWidth"in n);n.type===Po.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(n):(e==="video"||t)&&this.processVideoOutboundStats(n):n.type===Po.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(n):(e==="video"||t)&&this.processVideoInboundStats(n));break}case Po.TRANSPORT:{let e=this.report.get(n.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case Po.CANDIDATE_PAIR:n.selected&&this.processCandidatePairStats(n)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let n=await this.pc.getStats(),e={local:we({},El),remote:we({},El)};return n.forEach(t=>{let i;if(t.type===Po.TRANSPORT&&(i=n.get(t.selectedCandidatePairId)),t.type===Po.CANDIDATE_PAIR&&t.selected&&(i=t),i){let r=(a,s)=>{a.type=s.type,a.id=s.id,s.address&&(a.address=s.address),s.candidateType&&(a.candidateType=s.candidateType),s.port&&(a.port=s.port),s.priority&&(a.priority=s.priority),s.protocol&&(a.protocol=s.protocol),s.relayProtocol&&(a.relayProtocol=s.relayProtocol)};if(i.localCandidateId){let a=n.get(i.localCandidateId);a&&r(e.local,a)}if(i.remoteCandidateId){let a=n.get(i.remoteCandidateId);a&&r(e.remote,a)}}}),e}processCandidatePairStats(n){if(this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(e=>{n.currentRoundTripTime&&(e.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{n.currentRoundTripTime&&(e.rttMs=1e3*n.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=n.id,n.localCandidateId){let e=this.report.get(n.localCandidateId);e&&this.processCandidateStats(e)}if(n.remoteCandidateId){let e=this.report.get(n.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(n){let e;n.type===Po.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),n.type===Po.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=n.type,e.id=n.id,n.address&&(e.address=n.address),n.candidateType&&(e.candidateType=n.candidateType),n.port&&(e.port=n.port),n.priority&&(e.priority=n.priority),n.protocol&&(e.protocol=n.protocol),n.relayProtocol&&(e.relayProtocol=n.relayProtocol),n.type===Po.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(we({},e),we({},this.stats.selectedCandidatePair.localCandidate)),n.type===Po.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(we({},e),we({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(n){let e=this._stats.audioRecv.find(i=>i.ssrc===n.ssrc);e||(e=Nd(S1),this._stats.audioRecv.push(e)),e.ssrc=n.ssrc,e.packets=n.packetsReceived,e.packetsLost=n.packetsLost,e.packetsDiscarded=n.packetsDiscarded,e.bytes=n.bytesReceived,e.jitterMs=1e3*n.jitter,e.retransmittedBytesReceived=n.retransmittedBytesReceived,e.retransmittedPacketsReceived=n.retransmittedPacketsReceived,e.totalProcessingDelay=n.totalProcessingDelay,e.jitterBufferEmittedCount=n.jitterBufferEmittedCount;let t=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=zh(t,e,"totalProcessingDelay","jitterBufferEmittedCount",vs.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(n,n.trackId,e),this.calculateAudioFreeze(e,t,n),n.codecId&&(e.codec=this.getCodecFromCodecStats(n.codecId)),e.receivedFrames||(e.receivedFrames=n.packetsReceived),e.droppedFrames||(e.droppedFrames=n.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof n.concealedSamples=="number"&&(e.concealedSamples=n.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,we({},e))}calculateAudioFreeze(n,e,t){let i=this.lastAudioConcealment.get(n.ssrc);if(e!=null&&i!=null){let r=i.lts,a=t.timestamp,s=a-r;if(s<=0)return;let o=n.concealedSamples-e.concealedSamples-0,c=i.nonSilent+o,d=n.totalSamplesReceived-e.totalSamplesReceived;if(d<=0)return;let l=80*d/s,h=200*d/s,_=s/d,f=0;n.freezeSamples80=e.freezeSamples80,n.freezeMs80=e.freezeMs80,c>l&&(i.plc80>0?(n.freezeSamples80+=o,n.freezeMs80+=Math.round(o*_)):(n.freezeSamples80+=c,n.freezeMs80+=Math.round(c*_)),f=i.plc80+1);let m=0;n.freezeSamples200=e.freezeSamples200,n.freezeMs200=e.freezeMs200,c>h&&(i.plc200>0?(n.freezeSamples200+=o,n.freezeMs200+=Math.round(o*_)):(n.freezeSamples200+=c,n.freezeMs200+=Math.round(c*_)),m=i.plc200+1),this.lastAudioConcealment.set(n.ssrc,{nonSilent:o,lts:a,plc80:f,plc200:m})}else n.freezeSamples80=0,n.freezeSamples200=0,n.freezeMs80=0,n.freezeMs200=0,this.lastAudioConcealment.set(n.ssrc,{nonSilent:0,lts:t.timestamp,plc80:0,plc200:0})}processVideoInboundStats(n){let e=this._stats.videoRecv.find(s=>s.ssrc===n.ssrc);e||(e=Nd(JT),this._stats.videoRecv.push(e)),e.ssrc=n.ssrc,e.packets=n.packetsReceived,e.packetsLost=n.packetsLost,e.bytes=n.bytesReceived,e.firsCount=n.firCount,e.nacksCount=n.nackCount,e.plisCount=n.pliCount,e.framesDecodeCount=n.framesDecoded,e.framesDroppedCount=n.framesDropped,e.totalInterFrameDelay=n.totalInterFrameDelay,e.totalSquaredInterFrameDelay=n.totalSquaredInterFrameDelay,e.totalFreezesDuration=n.totalFreezesDuration,e.totalProcessingDelay=n.totalProcessingDelay,e.packetsDiscarded=n.packetsDiscarded,e.framesAssembledFromMultiplePackets=n.framesAssembledFromMultiplePackets,e.totalAssemblyTime=n.totalAssemblyTime,e.keyFramesDecoded=n.keyFramesDecoded,e.retransmittedBytesReceived=n.retransmittedBytesReceived,e.retransmittedPacketsReceived=n.retransmittedPacketsReceived;let t=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),a=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){let s=e.decodedFrame?e.decodedFrame.width:0,o=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,s,o),this.isFirstVideoDecoded[e.ssrc]=!0}if(t){let s=t.stats,o=a-t.lts;e.framesDecodeFreezeTime=s.framesDecodeFreezeTime,e.framesDecodeInterval=s.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&o>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(t.lts=Date.now(),e.framesDecodeInterval=o,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):e.framesDecodeCount<s.framesDecodeCount&&(e.framesDecodeInterval=0),n.framesDecoded&&n.qpSum&&(t.stats.framesDecodeCount>n.framesDecoded?e.qpSumPerFrame=n.qpSum/n.framesDecoded:e.qpSumPerFrame=(n.qpSum-t.qpSum)/(n.framesDecoded-t.stats.framesDecodeCount))}n.totalDecodeTime&&(e.decodeMs=1e3*n.totalDecodeTime,e.avgDecodeMs=zh(t?.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=zh(t?.stats,e,"totalProcessingDelay","framesDecodeCount",vs.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=zh(t?.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",vs.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=zh(t?.stats,e,"totalInterFrameDelay","framesDecodeCount",vs.kMillisecondsFromSeconds),i&&a-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((a-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:a,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:a,rate:0}),e.framesDroppedCount&&n.framesReceived&&(r&&a-r.lts>=800?(e.outputFrameRate=Math.round((n.framesReceived-e.framesDroppedCount-r.count)/((a-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:n.framesReceived-e.framesDroppedCount,lts:a,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:n.framesReceived-e.framesDroppedCount,lts:a,rate:0})),this.processVideoTrackReceiverStats(n,n.trackId,e),n.codecId&&(e.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(e.framesRateFirefox=n.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:we({},e),lts:t?t.lts:Date.now(),qpSum:n.qpSum})}processVideoOutboundStats(n){let e=this._stats.videoSend.find(i=>i.ssrc===n.ssrc);e||(e=Nd(m1),this._stats.videoSend.push(e));let t=this.mediaBytesSent.get(n.ssrc);if(t)t.add(n.bytesSent);else{let i=new fO(10);i.add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,i)}if(n.retransmittedBytesSent!==void 0){let i=this.mediaBytesRetransmit.get(n.ssrc);if(i)i.add(n.retransmittedBytesSent);else{let r=new fO(10);r.add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,r)}}if(n.totalEncodedBytesTarget){let i=this.mediaBytesTargetEncode.get(n.ssrc);if(i)i.add(n.totalEncodedBytesTarget);else{let r=new fO(10);r.add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,r)}}if(e.ssrc=n.ssrc,e.bytes=n.bytesSent,e.packets=n.packetsSent,e.firsCount=n.firCount,e.nacksCount=n.nackCount,e.plisCount=n.pliCount,e.frameCount=n.framesEncoded,e.adaptionChangeReason=n.qualityLimitationReason,e.scalabilityMode=n.scalabilityMode,e.retransmittedBytesSent=n.retransmittedBytesSent,e.retransmittedPacketsSent=n.retransmittedPacketsSent,e.hugeFramesSent=n.hugeFramesSent,e.keyFramesEncoded=n.keyFramesEncoded,e.targetBitrate=n.targetBitrate,n.totalEncodeTime&&n.framesEncoded){let i=this.lastEncoderMs.get(n.ssrc);if(!i||i.lastFrameCount>n.framesEncoded)e.avgEncodeMs=1e3*n.totalEncodeTime/n.framesEncoded;else{let r=n.framesEncoded-i.lastFrameCount,a=n.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*a/r}}if(n.framesEncoded&&n.qpSum){let i=this.lastEncoderMs.get(n.ssrc);!i||i.lastFrameCount>n.framesEncoded?e.qpSumPerFrame=n.qpSum/n.framesEncoded:e.qpSumPerFrame=(n.qpSum-i.lastQpSum)/(n.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lastQpSum:n.qpSum,lts:Date.now()}),n.codecId&&(e.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,e),this.processVideoTrackSenderStats(n,n.trackId,e),n.remoteId)this.processRemoteInboundStats(n.remoteId,e);else{let i=this.findRemoteStatsId(n.ssrc,Po.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(n){let e=this._stats.audioSend.find(t=>t.ssrc===n.ssrc);if(e||(e=Nd(g1),this._stats.audioSend.push(e)),e.ssrc=n.ssrc,e.packets=n.packetsSent,e.bytes=n.bytesSent,e.retransmittedBytesSent=n.retransmittedBytesSent,e.retransmittedPacketsSent=n.retransmittedPacketsSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,e),n.codecId&&(e.codec=this.getCodecFromCodecStats(n.codecId)),this.processAudioTrackSenderStats(n,n.trackId,e),n.remoteId)this.processRemoteInboundStats(n.remoteId,e);else{let t=this.findRemoteStatsId(n.ssrc,Po.REMOTE_INBOUND);t&&this.processRemoteInboundStats(t,e)}}findRemoteStatsId(n,e){var t;let i=Array.from(tn(t=this.report).call(t)).find(r=>r.type===e&&r.ssrc===n);return i?i.id:null}processVideoMediaSource(n,e){let t=this.report.get(n);t&&t.width&&t.height&&t.framesPerSecond&&(e.inputFrame={width:t.width,height:t.height,frameRate:t.framesPerSecond})}processAudioMediaSource(n,e){let t=this.report.get(n);t&&(e.inputLevel=t.audioLevel)}processVideoTrackSenderStats(n,e,t){var i,r,a,s;let o=e?this.report.get(e):void 0,c=(i=o?.framesSent)!==null&&i!==void 0?i:n.framesSent;if(typeof c!="number")return;let d=(r=o?.frameWidth)!==null&&r!==void 0?r:n.frameWidth,l=(a=o?.frameHeight)!==null&&a!==void 0?a:n.frameHeight,h=(s=o?.framesPerSecond)!==null&&s!==void 0?s:n.framesPerSecond;if(typeof d=="number"&&typeof l=="number"||(d=0,l=0),h==null){let _=Date.now(),f=this.lastVideoFramesSent.get(t.ssrc);f&&_-f.lts>=800?(h=Math.round((c-f.count)/((_-f.lts)/1e3)),this.lastVideoFramesSent.set(t.ssrc,{count:c,lts:_,rate:h})):f?h=f.rate:this.lastVideoFramesSent.set(t.ssrc,{count:c,lts:_,rate:0})}t.sentFrame={width:d,height:l,frameRate:Math.max(0,h)}}processVideoTrackReceiverStats(n,e,t){var i,r,a,s,o;let c=e?this.report.get(e):void 0,d=(i=c?.framesReceived)!==null&&i!==void 0?i:n.framesReceived,l=(r=c?.frameWidth)!==null&&r!==void 0?r:n.frameWidth,h=(a=c?.frameHeight)!==null&&a!==void 0?a:n.frameHeight,_=(s=c?.jitterBufferDelay)!==null&&s!==void 0?s:n.jitterBufferDelay,f=(o=c?.jitterBufferEmittedCount)!==null&&o!==void 0?o:n.jitterBufferEmittedCount;if(typeof d=="number"){let m=this.lastVideoFramesRecv.get(t.ssrc),S=Date.now();t.framesReceivedCount=d;let T=0;m&&S-m.lts>=800?(T=Math.round((d-m.count)/((S-m.lts)/1e3)),this.lastVideoFramesRecv.set(t.ssrc,{count:d,lts:S,rate:T})):m?T=m.rate:this.lastVideoFramesRecv.set(t.ssrc,{count:d,lts:S,rate:0}),t.receivedFrame={width:l||0,height:h||0,frameRate:T||0},t.decodedFrame={width:l||0,height:h||0,frameRate:t.decodeFrameRate||0},t.outputFrame={width:l||0,height:h||0,frameRate:t.outputFrameRate||t.decodeFrameRate||0}}if(_&&f){let m=this.lastVideoJBDelay.get(t.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},S=m.jitterBufferMs,T=f-m.jitterBufferEmittedCount;T>0&&(S=1e3*(_-m.jitterBufferDelay)/T),t.jitterBufferMs=S,t.currentDelayMs=Math.round(S),this.lastVideoJBDelay.set(t.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:f,jitterBufferMs:t.currentDelayMs})}}processAudioTrackSenderStats(n,e,t){var i,r,a,s;let o=e?this.report.get(e):void 0,c=(i=(r=o?.echoReturnLoss)!==null&&r!==void 0?r:n.echoReturnLoss)!==null&&i!==void 0?i:0,d=(a=(s=o?.echoReturnLossEnhancement)!==null&&s!==void 0?s:n.echoReturnLossEnhancement)!==null&&a!==void 0?a:0;t.aecReturnLoss=c,t.aecReturnLossEnhancement=d}processAudioTrackReceiverStats(n,e,t){var i,r,a,s,o,c,d,l,h;let _=e?this.report.get(e):void 0,f=(i=_?.removedSamplesForAcceleration)!==null&&i!==void 0?i:n.removedSamplesForAcceleration,m=(r=_?.totalSamplesReceived)!==null&&r!==void 0?r:n.totalSamplesReceived,S=(a=_?.jitterBufferDelay)!==null&&a!==void 0?a:n.jitterBufferDelay,T=(s=_?.jitterBufferEmittedCount)!==null&&s!==void 0?s:n.jitterBufferEmittedCount,R=(o=_?.audioLevel)!==null&&o!==void 0?o:n?.audioLevel,C=(c=_?.totalSamplesDuration)!==null&&c!==void 0?c:n?.totalSamplesDuration,b=(d=_?.concealedSamples)!==null&&d!==void 0?d:n.concealedSamples,N=(l=_?.silentConcealedSamples)!==null&&l!==void 0?l:n.silentConcealedSamples,k=(h=_?.concealmentEvents)!==null&&h!==void 0?h:n.concealmentEvents;if(typeof m=="number"&&(t.totalSamplesReceived=m),typeof N=="number"&&(t.silentConcealedSamples=N),typeof k=="number"&&(t.concealmentEvents=k),typeof b=="number"&&(t.concealedSamples=b),f&&m&&(t.accelerateRate=f/m),S&&T){let U=this.lastAudioJBDelay.get(t.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},W=U.jitterBufferMs,z=T-U.jitterBufferEmittedCount;z>0&&(W=1e3*(S-U.jitterBufferDelay)/z),t.jitterBufferMs=Math.round(W),this.lastAudioJBDelay.set(t.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:T,jitterBufferMs:t.jitterBufferMs})}t.outputLevel=R;let P=1920;C&&m&&(P=m/C/50,t.receivedFrames=Math.round(m/P)),b&&(t.droppedFrames=Math.round(b/P))}processRemoteInboundStats(n,e){let t=this.report.get(n);t&&(e.packetsLost=t.packetsLost,t.roundTripTime&&(e.rttMs=1e3*t.roundTripTime),t.jitter&&(e.jitterMs=1e3*t.jitter),t.timestamp&&(e.timestamp=t.timestamp))}getCodecFromCodecStats(n){let e=this.report.get(n);if(!e)return"";let t=e.mimeType.match(/\/(.*)$/);return t&&t[1]?t[1]:""}updateSendBitrate(){let n=0,e=null,t=null;this.mediaBytesSent.forEach(r=>{n+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{t=t===null?r.diffMean():t+r.diffMean()});let i=e!==null?n-e:n;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),t!==null&&(this._stats.bitrate.targetEncoded=8*t/(this.options.updateInterval/1e3))}},RB=class extends EO{updateStats(){return se.resolve()}};function R1(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,a=(function(){let s=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return s&&s[0]?Number(s[0].split("/")[1]):null})();return a?a<76?new T1(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new QT(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:r}):(function(s){if(!window.RTCStatsReport)return!1;let o=s.getStats();return!!(o instanceof se||(function(c){return!!c&&(typeof c=="object"||typeof c=="function")&&typeof c.then=="function"})(o))})(n)?new QT(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new RB(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:r})}let mO="websdk_ng_install_id";function gO(){try{if(B("INSTALL_ID"))return B("INSTALL_ID");let n=window.localStorage.getItem(mO);return n||(n=Mi(),window.localStorage.setItem(mO,n)),Ct("INSTALL_ID",n),n}catch{return}}let dc=(function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;let e=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){let t=e[1],i=e[2];return"".concat(t,".").concat(i)}return"4.0.0.999"})("4.24.0"),lc=(function(){try{return JSON.parse("true")===!0}catch{return!0}})(),a_=(function(n){return n.Default="default",n.Auto="auto",n.Relay="relay",n.SdRtn="sd-rtn",n})({}),wn=(function(){let n="us".concat("erna","me"),e="pa".concat("sswo","rd"),t=["t","s","t"];t.splice(1,0,"e");let i=t.join(""),r=[];for(let o=0;o<6;o++)r.push("1");let a=r.join(""),s={};return s[n]=i,s[e]=a,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=wn;let Qn={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},$T={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},fb="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",Eb={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},dr=we(we(we(we({},Eb),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:$T,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Qn),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Ct(n,e,t){var i,r,a;ee(i=Object.keys(dr)).call(i,n)&&(!t&&ee(r=Object.keys(ml)).call(r,n)||(dr[n]=e,n!=="ENABLE_VIDEO_SEI"&&n!=="ENABLE_AUDIO_TOPN"&&n!=="ENABLE_AUDIO_METADATA"&&n!=="ENABLE_AUDIO_PTS"||e!==!0||(dr.ENABLE_ENCODED_TRANSFORM=!0),n==="USE_NEW_NETWORK_CONFIG"&&e&&(a=!!e,dr.USE_NEW_NETWORK_CONFIG=a,a&&(dr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],dr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],dr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],dr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],dr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",dr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",dr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),n==="ENABLE_PRE_SUB"&&e&&(dr.ENABLE_INSTANT_VIDEO=!0,dr.ENABLE_PREALLOC_PC=!0),n==="ENABLE_SVC"&&e&&(dr.ENABLE_AUT_CC=!0),n==="NEW_FORCE_TURN"&&e&&(dr.NEW_TURN_MODE||(dr.NEW_TURN_MODE=4))))}function B(n){return dr[n]}lc||(dr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],dr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],dr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],dr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],dr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],dr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],dr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",dr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",dr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",dr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",dr.AREAS=["NORTH_AMERICA","OVERSEA"]);let G=(function(n){return n[n.REALTIME=1]="REALTIME",n})({}),ml={};var ft=(function(n){return n.SET_SESSION_ID="SET_SESSION_ID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_INT_UID="SET_INT_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",n.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",n.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",n.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",n.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",n.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",n.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",n.SET_USE_P2P="SET_USE_P2P",n.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",n})(ft||{});let bt=(function(n){return n.h264="h264",n.h265="h265",n.vp8="vp8",n.vp9="vp9",n.av1="av1",n})({});(function(n){n.opus="opus",n.pcma="pcma",n.pcmu="pcmu",n.g722="g722"})({});let eR=128,vB=96,yB=1e3,Cg=10,tR=0;var CB=(()=>{var n={8:(i,r,a)=>{a.r(r),a.d(r,{Parser:()=>z,Printer:()=>qe,parse:()=>$,print:()=>ne});let s=`
`,o="".concat("\r").concat(s),c=" ",d;function l(ie){return ie>="0"&&ie<="9"}function h(ie){return ie>="!"&&ie<="~"}function _(ie){return h(ie)||ie>=""&&ie<="ÿ"}function f(ie){return ie==="!"||ie>="#"&&ie<="'"||ie>="*"&&ie<="+"||ie>="-"&&ie<="."||ie>="0"&&ie<="9"||ie>="A"&&ie<="Z"||ie>="^"&&ie<="~"}function m(ie){return ie>="1"&&ie<="9"}function S(ie){return ie>="A"&&ie<="Z"||ie>="a"&&ie<="z"}function T(ie){return ie==="d"||ie==="h"||ie==="m"||ie==="s"}function R(ie){return ie>""&&ie<"	"||ie>"\v"&&ie<"\f"||ie>""&&ie<"ÿ"}function C(ie){return S(ie)||l(ie)||ie==="+"||ie==="/"}function b(ie){return l(ie)||S(ie)||ie==="+"||ie==="/"||ie==="-"||ie==="_"}function N(ie){return S(ie)||l(ie)||ie==="+"||ie==="/"}function k(ie,A){var v=Object.keys(ie);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(ie);A&&(D=D.filter(function(j){return Object.getOwnPropertyDescriptor(ie,j).enumerable})),v.push.apply(v,D)}return v}function P(ie){for(var A=1;A<arguments.length;A++){var v=arguments[A]!=null?arguments[A]:{};A%2?k(Object(v),!0).forEach(function(D){U(ie,D,v[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(v)):k(Object(v)).forEach(function(D){Object.defineProperty(ie,D,Object.getOwnPropertyDescriptor(v,D))})}return ie}function U(ie,A,v){return A in ie?Object.defineProperty(ie,A,{value:v,enumerable:!0,configurable:!0,writable:!0}):ie[A]=v,ie}(function(ie){ie.VERSION="v",ie.ORIGIN="o",ie.SESSION_NAME="s",ie.INFORMATION="i",ie.URI="u",ie.EMAIL="e",ie.PHONE="p",ie.CONNECTION="c",ie.BANDWIDTH="b",ie.TIME="t",ie.REPEAT="r",ie.ZONE_ADJUSTMENTS="z",ie.KEY="k",ie.ATTRIBUTE="a",ie.MEDIA="m"})(d||(d={}));class W{consumeText(A,v){let D=v;for(;D<A.length;){let j=A[D];if(j==="\0"||j==="\r"||j===s)break;D+=1}if(D-v==0)throw new Error("Invalid text, at ".concat(A));return D}consumeUnicastAddress(A,v,D){return this.consumeTill(A,v,c)}consumeOneOrMore(A,v,D){let j=v;for(;D(A[j]);)j++;if(j-v==0)throw new Error("Invalid rule at ".concat(v,"."));return j}consumeSpace(A,v){if(A[v]===c)return v+1;throw new Error("Invalid space at ".concat(v,"."))}consumeIP4Address(A,v){let D=v;for(let j=0;j<4;j++)if(D=this.consumeDecimalUChar(A,D),j!==3){if(A[D]!==".")throw new Error("Invalid IP4 address.");D++}return D}consumeDecimalUChar(A,v){let D=v;for(let ue=0;ue<3&&l(A[D]);ue++,D++);if(D-v==0)throw new Error("Invalid decimal uchar.");let j=parseInt(A.slice(v,D));if(j>=0&&j<=255)return D;throw new Error("Invalid decimal uchar")}consumeIP6Address(A,v){let D=this.consumeHexpart(A,v);return A[D]===":"&&(D+=1,D=this.consumeIP4Address(A,D)),D}consumeHexpart(A,v){let D=v;if(A[D]===":"&&A[D+1]===":"){D+=2;try{D=this.consumeHexseq(A,D)}catch{}return D}if(D=this.consumeHexseq(A,D),A[D]===":"&&A[D+1]===":"){D+=2;try{D=this.consumeHexseq(A,D)}catch{}return D}return D}consumeHexseq(A,v){let D=v;for(;D=this.consumeHex4(A,D),A[D]===":"&&A[D+1]!==":";)D+=1;return D}consumeHex4(A,v){let D=0;for(;D<4;D++)if(!((j=A[v+D])>="0"&&j<="9"||j>="a"&&j<="f"||j>="A"&&j<="F")){if(D===0)throw new Error("Invalid hex 4");break}var j;return v+D}consumeFQDN(A,v){let D=v;for(;l(A[D])||S(A[D])||A[D]==="-"||A[D]===".";)D+=1;if(D-v<4)throw new Error("Invalid FQDN");return D}consumeExtnAddr(A,v){return this.consumeOneOrMore(A,v,_)}consumeMulticastAddress(A,v,D){switch(D){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(A,v);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(A,v);default:try{return this.consumeFQDN(A,v)}catch{return this.consumeExtnAddr(A,v)}}}consumeIP6MulticastAddress(A,v){let D=this.consumeHexpart(A,v);return A[D]==="/"?this.consumeInteger(A,D+1):D}consumeIP4MulticastAddress(A,v){let D=v+3,j=A.slice(v,D),ue=parseInt(j);if(ue<224||ue>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let rt=0;rt<3;rt++){if(A[D]!==".")throw new Error("Invalid IP4 multicast address.");D+=1,D=this.consumeDecimalUChar(A,D)}return A[D]==="/"&&(D+=1),D=this.consumeTTL(A,D),A[D]==="/"&&(D=this.consumeInteger(A,D)),D}consumeInteger(A,v){if(!m(A[v]))throw new Error("Invalid integer.");for(v+=1;l(A[v]);)v+=1;return v}consumeTTL(A,v){if(A[v]==="0")return v+1;if(!m(A[v]))throw new Error("Invalid TTL.");v+=1;for(let D=0;D<2&&l(A[v]);D++)v+=1;return v}consumeToken(A,v){return this.consumeOneOrMore(A,v,f)}consumeTime(A,v){let D=v;if(A[D]==="0")return D+1;for(m(A[D])&&(D+=1);l(A[D]);)D++;if(D-v<10)throw new Error("Invalid time");return D}consumeAddress(A,v){return this.consumeTill(A,v,c)}consumeTypedTime(A,v){let D=v;return D=this.consumeOneOrMore(A,D,l),T(A[D])?D+1:D}consumeRepeatInterval(A,v){if(!m(A[v]))throw new Error("Invalid repeat interval");for(v+=1;l(A[v]);)v+=1;return T(A[v])&&(v+=1),v}consumePort(A,v){return this.consumeOneOrMore(A,v,l)}consume(A,v,D){for(let j=0;j<D.length;j++){if(v+j>=A.length)throw new Error("consume exceeding value length");if(A[v+j]!==D[j])throw new Error("consume ".concat(D," failed at ").concat(j))}return v+D.length}consumeTill(A,v,D){let j=v;for(;j<A.length&&(typeof D!="string"||A[j]!==D)&&(typeof D!="function"||!D(A[j]));)j++;return j}}class z extends W{constructor(){super(),U(this,"records",[]),U(this,"currentLine",0)}parse(A){let v=this.probeEOL(A);this.records=A.split(v).filter($a=>!!hr($a).call($a)).map(this.parseLine),this.currentLine=0;let D=this.parseVersion(),j=this.parseOrigin(),ue=this.parseSessionName(),rt=this.parseInformation(),jt=this.parseUri(),ar=this.parseEmail(),ua=this.parsePhone(),Ho=this.parseConnection(),sh=this.parseBandWidth(),xl=this.parseTimeFields(),M_=this.parseKey(),Qg=this.parseSessionAttribute(),Ko=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:D,origin:j,sessionName:ue,information:rt,uri:jt,emails:ar,phones:ua,connection:Ho,bandwidths:sh,timeFields:xl,key:M_,attributes:Qg,mediaDescriptions:Ko}}getCurrentRecord(){let A=this.records[this.currentLine];if(!A)throw new Error("Record doesn't exit.");return A}probeEOL(A){for(let v=0;v<A.length;v++)if(A[v]===s)return A[v-1]==="\r"?o:s;throw new Error("Invalid newline character.")}parseLine(A,v){if(A.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let D=A[0];if(A[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:D,value:A.slice(2),line:v,cur:0}}parseSessionAttribute(){let A=new he;for(;this.currentLine<this.records.length;){let v=this.getCurrentRecord();if(v.type!==d.ATTRIBUTE)break;let D={attField:this.extractOneOrMore(v,j=>f(j)&&j!==":"),_cur:0};v.value[v.cur]===":"&&(v.cur+=1,D.attValue=this.extractOneOrMore(v,R)),A.parse(D),this.currentLine++}return A.digest()}parseMediaAttributes(A){let v=new Ge(A);for(;this.currentLine<this.records.length;){let D=this.getCurrentRecord();if(D.type!==d.ATTRIBUTE)break;let j={attField:this.extractOneOrMore(D,ue=>f(ue)&&ue!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,j.attValue=this.extractOneOrMore(D,R)),v.parse(j),this.currentLine++}return v.digest()}parseKey(){let A=this.getCurrentRecord();if(A.type===d.KEY){if(A.value==="prompt"||A.value==="clear:"||A.value==="base64:"||A.value==="uri:")return A.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let A=this.getCurrentRecord();if(A.type===d.ZONE_ADJUSTMENTS){let v=[];for(;;)try{let D=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let j=!1;A.value[A.cur]==="-"&&(j=!0,A.cur+=1);let ue=this.extract(A,this.consumeTypedTime);v.push({time:D,typedTime:ue,back:j})}catch{break}if(v.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,v}return[]}parseRepeat(){let A=[];for(;;){let v=this.getCurrentRecord();if(v.type!==d.REPEAT)break;{let D=this.extract(v,this.consumeRepeatInterval),j=this.parseTypedTime(v);A.push({repeatInterval:D,typedTimes:j}),this.currentLine++}}return A}parseTypedTime(A){let v=[];for(;;)try{this.consumeSpaceForRecord(A),v.push(this.extract(A,this.consumeTypedTime))}catch{break}if(v.length===0)throw new Error("Invalid typed time.");return v}parseTime(){let A=this.getCurrentRecord(),v=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let D=this.extract(A,this.consumeTime);return this.currentLine++,{startTime:v,stopTime:D}}parseBandWidth(){let A=[];for(;this.currentLine<this.records.length;){let v=this.getCurrentRecord();if(v.type!==d.BANDWIDTH)break;{let D=this.extractOneOrMore(v,f);if(v.value[v.cur]!==":")throw new Error("Invalid bandwidth field.");v.cur++;let j=this.extractOneOrMore(v,l);A.push({bwtype:D,bandwidth:j}),this.currentLine++}}return A}parseVersion(){let A=this.getCurrentRecord();if(A.type!==d.VERSION)throw new Error("first sdp record must be version");let v=A.value.slice(0,this.consumeOneOrMore(A.value,0,l));if(v.length!==A.value.length)throw new Error('invalid proto version, "v='.concat(A.value,'"'));return this.currentLine++,v}parseOrigin(){let A=this.getCurrentRecord();if(A.type!==d.ORIGIN)throw new Error("second line of sdp must be origin");let v=this.extractOneOrMore(A,_);this.consumeSpaceForRecord(A);let D=this.extractOneOrMore(A,l);this.consumeSpaceForRecord(A);let j=this.extractOneOrMore(A,l);this.consumeSpaceForRecord(A);let ue=this.extractOneOrMore(A,f);this.consumeSpaceForRecord(A);let rt=this.extractOneOrMore(A,f);this.consumeSpaceForRecord(A);let jt=this.extract(A,this.consumeUnicastAddress);return this.currentLine++,{username:v,sessId:D,sessVersion:j,nettype:ue,addrtype:rt,unicastAddress:jt}}parseSessionName(){let A=this.getCurrentRecord();if(A.type===d.SESSION_NAME){let v=this.extract(A,this.consumeText);return this.currentLine++,v}}parseInformation(){let A=this.getCurrentRecord();if(A.type!==d.INFORMATION)return;let v=this.extract(A,this.consumeText);return this.currentLine++,v}parseUri(){let A=this.getCurrentRecord();if(A.type===d.URI)return this.currentLine++,A.value}parseEmail(){let A=[];for(;;){let v=this.getCurrentRecord();if(v.type!==d.EMAIL)break;A.push(v.value),this.currentLine++}return A}parsePhone(){let A=[];for(;;){let v=this.getCurrentRecord();if(v.type!==d.PHONE)break;A.push(v.value),this.currentLine++}return A}parseConnection(){let A=this.getCurrentRecord();if(A.type===d.CONNECTION){let v=this.extractOneOrMore(A,f);this.consumeSpaceForRecord(A);let D=this.extractOneOrMore(A,f);this.consumeSpaceForRecord(A);let j=this.extract(A,this.consumeAddress);return this.currentLine++,{nettype:v,addrtype:D,address:j}}}parseMedia(){let A=this.getCurrentRecord(),v=this.extract(A,this.consumeToken);this.consumeSpaceForRecord(A);let D=this.extract(A,this.consumePort);A.value[A.cur]==="/"&&(A.cur+=1,D+=this.extract(A,this.consumeInteger)),this.consumeSpaceForRecord(A);let j=[];for(j.push(this.extract(A,this.consumeToken));A.value[A.cur]==="/";)A.cur+=1,j.push(this.extract(A,this.consumeToken));if(j.length===0)throw new Error("Invalid proto");let ue=this.parseFmt(A);return this.currentLine++,{mediaType:v,port:D,protos:j,fmts:ue}}parseTimeFields(){let A=[];for(;this.getCurrentRecord().type===d.TIME;){let v=this.parseTime(),D=this.parseRepeat(),j=this.parseZone();A.push({time:v,repeats:D,zones:j})}return A}parseMediaDescription(){let A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===d.MEDIA;){let v=this.parseMedia(),D=this.parseInformation(),j=this.parseConnections(),ue=this.parseBandWidth(),rt=this.parseKey(),jt=this.parseMediaAttributes(v);A.push({media:v,information:D,connections:j,bandwidths:ue,key:rt,attributes:jt})}return A}parseConnections(){let A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===d.CONNECTION;)A.push(this.parseConnection());return A}parseFmt(A){let v=[];for(;;)try{this.consumeSpaceForRecord(A),v.push(this.extract(A,this.consumeToken))}catch{break}if(v.length===0)throw new Error("Invalid fmts");return v}extract(A,v){for(var D=arguments.length,j=new Array(D>2?D-2:0),ue=2;ue<D;ue++)j[ue-2]=arguments[ue];let rt=v.call(this,A.value,A.cur,...j),jt=A.value.slice(A.cur,rt);return A.cur=rt,jt}extractOneOrMore(A,v){let D=this.consumeOneOrMore(A.value,A.cur,v),j=A.value.slice(A.cur,D);return A.cur=D,j}consumeSpaceForRecord(A){if(A.value[A.cur]!==c)throw new Error("Invalid space at ".concat(A.cur,"."));A.cur+=1}}class Q extends W{constructor(){super(...arguments),U(this,"attributes",void 0),U(this,"digested",!1)}extractOneOrMore(A,v,D){let j=this.consumeOneOrMore(A.attValue,A._cur,v),ue=A.attValue.slice(A._cur,j),[rt,jt]=D||[];if(typeof rt=="number"&&ue.length<rt)throw new Error("error in length, should be more or equal than ".concat(rt," characters."));if(typeof jt=="number"&&ue.length>jt)throw new Error("error in length, should be less or equal than ".concat(jt," characters."));return A._cur=j,ue}consumeAttributeSpace(A){if(A.attValue[A._cur]!==c)throw new Error("Invalid space at ".concat(A._cur,"."));A._cur+=1}extract(A,v){if(!A.attValue)throw new Error("Nothing to extract from attValue.");for(var D=arguments.length,j=new Array(D>2?D-2:0),ue=2;ue<D;ue++)j[ue-2]=arguments[ue];let rt=v.call(this,A.attValue,A._cur,...j),jt=A.attValue.slice(A._cur,rt);return A._cur=rt,jt}atEnd(A){if(!A.attValue)throw new Error;return A._cur>=A.attValue.length}peekChar(A){if(!A.attValue)throw new Error;return A.attValue[A._cur]}peek(A,v){if(!A.attValue)throw new Error;for(let D=0;D<v.length;D++)if(v[D]!==A.attValue[A._cur+D])return!1;return!0}parseIceUfrag(A){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(A,C,[4,256])}parseIcePwd(A){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(A,C,[22,256])}parseIceOptions(A){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let v=[];for(;!this.atEnd(A);){v.push(this.extractOneOrMore(A,C));try{this.consumeAttributeSpace(A)}catch(D){if(this.atEnd(A))break;throw D}}this.attributes.iceOptions=v}parseFingerprint(A){let v=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);let D=this.extract(A,this.consumeTill);this.attributes.fingerprints.push({hashFunction:v,fingerprint:D})}parseExtmap(A){let v=this.extractOneOrMore(A,l),D;this.peekChar(A)==="/"&&(this.extract(A,this.consume,"/"),D=this.extract(A,this.consumeToken)),this.consumeAttributeSpace(A);let j=this.extract(A,this.consumeTill,c),ue=P(P({entry:parseInt(v,10)},D&&{direction:D}),{},{extensionName:j});this.peekChar(A)===c&&(this.consumeAttributeSpace(A),ue.extensionAttributes=this.extract(A,this.consumeTill)),this.attributes.extmaps.push(ue)}parseSetup(A){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let v=this.extract(A,this.consumeTill);if(v!=="active"&&v!=="passive"&&v!=="actpass"&&v!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=v}}class he extends Q{constructor(){super(...arguments),U(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"group":this.parseGroup(A);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"fingerprint":this.parseFingerprint(A);break;case"setup":this.parseSetup(A);break;case"tls-id":this.parseTlsId(A);break;case"identity":this.parseIdentity(A);break;case"extmap":this.parseExtmap(A);break;case"msid-semantic":this.parseMsidSemantic(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(v){throw console.error("parsing session attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),v}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(A){let v=this.extract(A,this.consumeToken),D=[];for(;!this.atEnd(A)&&this.peekChar(A)===c;)this.consumeAttributeSpace(A),D.push(this.extract(A,this.consumeToken));this.attributes.groups.push({semantic:v,identificationTag:D})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(A){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(A,b)}parseIdentity(A){let v=this.extractOneOrMore(A,N),D=[];for(;!this.atEnd(A)&&this.peekChar(A)===c;){this.consumeAttributeSpace(A);let j=this.extract(A,this.consumeToken);this.extract(A,this.consume,"=");let ue=this.extractOneOrMore(A,rt=>rt!==c&&R(rt));D.push({name:j,value:ue})}this.attributes.identities.push({assertionValue:v,extensions:D})}parseMsidSemantic(A){this.peekChar(A)===c&&this.consumeAttributeSpace(A);let v={semantic:this.extract(A,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(A)}catch{break}if(this.peekChar(A)==="*"){this.extract(A,this.consume,"*"),v.applyForAll=!0;break}{let D=this.extract(A,this.consumeTill,c);v.identifierList.push(D)}}this.attributes.msidSemantic=v}}class Ge extends Q{constructor(A){super(),U(this,"attributes",void 0),A.protos.indexOf("RTP")!==-1||A.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"extmap":this.parseExtmap(A);break;case"setup":this.parseSetup(A);break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"candidate":this.parseCandidate(A);break;case"remote-candidate":this.parseRemoteCandidate(A);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(A);break;case"rtpmap":this.parseRtpmap(A);break;case"ptime":this.parsePtime(A);break;case"maxptime":this.parseMaxPtime(A);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(A);break;case"ssrc":this.parseSSRC(A);break;case"fmtp":this.parseFmtp(A);break;case"rtcp-fb":this.parseRtcpFb(A);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(A);break;case"mid":this.parseMid(A);break;case"msid":this.parseMsid(A);break;case"imageattr":this.parseImageAttr(A);break;case"rid":this.parseRid(A);break;case"simulcast":this.parseSimulcast(A);break;case"sctp-port":this.parseSctpPort(A);break;case"max-message-size":this.parseMaxMessageSize(A);break;case"ssrc-group":this.parseSSRCGroup(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(v){throw console.error("parsing media attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),v}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}parseCandidate(A){let v=this.extractOneOrMore(A,C,[1,32]);this.consumeAttributeSpace(A);let D=this.extractOneOrMore(A,l,[1,5]);this.consumeAttributeSpace(A);let j=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);let ue=this.extractOneOrMore(A,l,[1,10]);this.consumeAttributeSpace(A);let rt=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);let jt=this.extract(A,this.consumePort);this.consumeAttributeSpace(A),this.extract(A,this.consume,"typ"),this.consumeAttributeSpace(A);let ar={foundation:v,componentId:D,transport:j,priority:ue,connectionAddress:rt,port:jt,type:this.extract(A,this.consumeToken),extension:{}};for(this.peek(A," raddr")&&(this.extract(A,this.consume," raddr"),this.consumeAttributeSpace(A),ar.relAddr=this.extract(A,this.consumeAddress)),this.peek(A," rport")&&(this.extract(A,this.consume," rport"),this.consumeAttributeSpace(A),ar.relPort=this.extract(A,this.consumePort));this.peekChar(A)===c;){this.consumeAttributeSpace(A);let ua=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A),ar.extension[ua]=this.extractOneOrMore(A,h)}this.attributes.candidates.push(ar)}parseRemoteCandidate(A){let v=[];for(;;){let D=this.extractOneOrMore(A,l,[1,5]);this.consumeAttributeSpace(A);let j=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);let ue=this.extract(A,this.consumePort);v.push({componentId:D,connectionAddress:j,port:ue});try{this.consumeAttributeSpace(A)}catch{break}}this.attributes.remoteCandidatesList.push(v)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(A){let v=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);let D=this.extract(A,this.consumeTill,"/");this.extract(A,this.consume,"/");let j={encodingName:D,clockRate:this.extractOneOrMore(A,l)};this.atEnd(A)||this.peekChar(A)!=="/"||(this.extract(A,this.consume,"/"),j.encodingParameters=parseInt(this.extract(A,this.consumeTill),10));let ue=this.attributes.payloads.find(rt=>rt.payloadType===parseInt(v,10));ue?ue.rtpMap=j:this.attributes.payloads.push({payloadType:parseInt(v,10),rtpMap:j,rtcpFeedbacks:[]})}parsePtime(A){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(A,this.consumeTill)}parseMaxPtime(A){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(A,this.consumeTill)}parseDirection(A){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=A.attField}parseSSRC(A){let v=this.extractOneOrMore(A,l);this.consumeAttributeSpace(A);let D=this.extract(A,this.consumeTill,":"),j;this.peekChar(A)===":"&&(this.extract(A,this.consume,":"),j=this.extract(A,this.consumeTill));let ue=this.attributes.ssrcs.find(rt=>rt.ssrcId===parseInt(v,10));ue?ue.attributes[D]=j:this.attributes.ssrcs.push({ssrcId:parseInt(v,10),attributes:{[D]:j}})}parseFmtp(A){let v=this.extract(A,this.consumeTill,c);this.consumeAttributeSpace(A);let D=this.extract(A,this.consumeTill),j={};D.split(";").forEach(rt=>{let[jt,ar]=rt.split("=");jt=hr(jt).call(jt);let ua=typeof ar=="string"?hr(ar).call(ar):null;typeof jt=="string"&&jt.length>0&&(j[jt]=ua)});let ue=this.attributes.payloads.find(rt=>rt.payloadType===parseInt(v,10));ue?ue.fmtp={parameters:j}:this.attributes.payloads.push({payloadType:parseInt(v,10),rtcpFeedbacks:[],fmtp:{parameters:j}})}parseFmtParameters(A){let v={},D=this.extract(A,this.consumeTill,"=");A._cur++;let j=this.extract(A,this.consumeTill,";");for(v[D]=j;A.attValue[A._cur]===";";){let ue=this.extract(A,this.consumeTill,"=");A._cur++;let rt=this.extract(A,this.consumeTill,";");v[ue]=rt}return v}parseRtcpFb(A){let v="";v=this.peekChar(A)==="*"?this.extract(A,this.consume,"*"):this.extract(A,this.consumeTill,c),this.consumeAttributeSpace(A);let D=this.extract(A,this.consumeTill,c),j;if(D==="trr-int")j={type:D,interval:this.extract(A,this.consumeTill)};else{let ue={type:D};this.peekChar(A)===c&&(this.consumeAttributeSpace(A),ue.parameter=this.extract(A,this.consumeToken),this.peekChar(A)===c&&(ue.additional=this.extract(A,this.consumeTill))),j=ue}if(v==="*")this.attributes.rtcpFeedbackWildcards.push(j);else{let ue=this.attributes.payloads.find(rt=>rt.payloadType===parseInt(v,10));ue?ue.rtcpFeedbacks.push(j):this.attributes.payloads.push({payloadType:parseInt(v,10),rtcpFeedbacks:[j]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(A){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let v={port:this.extract(A,this.consumePort)};this.peekChar(A)===c&&(this.consumeAttributeSpace(A),v.netType=this.extractOneOrMore(A,f),this.consumeAttributeSpace(A),v.addressType=this.extractOneOrMore(A,f),this.consumeAttributeSpace(A),v.address=this.extract(A,this.consumeAddress)),this.attributes.rtcp=v}parseMsid(A){let v={id:this.extractOneOrMore(A,f,[1,64])};this.peekChar(A)===c&&(this.consumeAttributeSpace(A),v.appdata=this.extractOneOrMore(A,f,[1,64])),this.attributes.msids.push(v)}parseImageAttr(A){this.attributes.imageattr.push(A.attValue)}parseRid(A){let v=this.extractOneOrMore(A,j=>S(j)||l(j)||j==="_"||j==="-");this.consumeAttributeSpace(A);let D={id:v,direction:this.extract(A,this.consumeToken),params:[]};if(this.peekChar(A)===c){if(this.consumeAttributeSpace(A),this.peek(A,"pt=")){this.extract(A,this.consume,"pt=");let j=[];for(;;){let ue=this.extract(A,this.consumeToken);j.push(ue);try{this.extract(A,this.consume,",")}catch{break}}D.payloads=j,this.peekChar(A)===c&&this.extract(A,this.consume,c)}for(;;){let j=this.extract(A,this.consumeToken);switch(j){case"depend":{let ue={type:j,rids:this.extract(A,this.consume,"=").split(",")};D.params.push(ue);break}default:{let ue={type:j};this.peekChar(A)==="="&&(this.extract(A,this.consume,"="),ue.val=this.extract(A,this.consumeTill,";")),D.params.push(ue)}}try{this.extract(A,this.consume,";")}catch{break}}}this.attributes.rids.push(D)}parseSimulcast(A){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=A.attValue,this.extract(A,this.consumeTill)}parseSctpPort(A){this.attributes.sctpPort=this.extractOneOrMore(A,l,[1,5])}parseMaxMessageSize(A){this.attributes.maxMessageSize=this.extractOneOrMore(A,l,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(A){this.attributes.mid=this.extract(A,this.consumeToken)}parseSSRCGroup(A){let v=this.extract(A,this.consumeToken),D=[];for(;;)try{this.consumeAttributeSpace(A);let j=this.extract(A,this.consumeInteger);D.push(parseInt(j,10))}catch{break}this.attributes.ssrcGroups.push({semantic:v,ssrcIds:D})}}function xe(ie,A,v){return A in ie?Object.defineProperty(ie,A,{value:v,enumerable:!0,configurable:!0,writable:!0}):ie[A]=v,ie}class qe{constructor(){xe(this,"eol",o)}print(A,v){let D="";return v&&(this.eol=v),D+=this.printVersion(A.version),D+=this.printOrigin(A.origin),D+=this.printSessionName(A.sessionName),D+=this.printInformation(A.information),D+=this.printUri(A.uri),D+=this.printEmail(A.emails),D+=this.printPhone(A.phones),D+=this.printConnection(A.connection),D+=this.printBandwidth(A.bandwidths),D+=this.printTimeFields(A.timeFields),D+=this.printKey(A.key),D+=this.printSessionAttributes(A.attributes),D+=this.printMediaDescription(A.mediaDescriptions),D}printVersion(A){return"v=".concat(A).concat(this.eol)}printOrigin(A){return"o=".concat(A.username," ").concat(A.sessId," ").concat(A.sessVersion," ").concat(A.nettype," ").concat(A.addrtype," ").concat(A.unicastAddress).concat(this.eol)}printSessionName(A){return A?"s=".concat(A).concat(this.eol):""}printInformation(A){return A?"i=".concat(A).concat(this.eol):""}printUri(A){return A?"u=".concat(A).concat(this.eol):""}printEmail(A){let v="";for(let D of A)v+="e=".concat(D).concat(this.eol);return v}printPhone(A){let v="";for(let D of A)v+="e=".concat(D).concat(this.eol);return v}printConnection(A){return A?"c=".concat(A.nettype," ").concat(A.addrtype," ").concat(A.address).concat(this.eol):""}printBandwidth(A){let v="";for(let D of A)v+="b=".concat(D.bwtype,":").concat(D.bandwidth).concat(this.eol);return v}printTimeFields(A){let v="";for(let D of A){v+="t=".concat(D.time.startTime," ").concat(D.time.startTime).concat(this.eol);for(let j of D.repeats)v+="r=".concat(j.repeatInterval," ").concat(j.typedTimes.join(" ")).concat(this.eol);D.zoneAdjustments&&(v+="z=",v+="z=".concat(D.zoneAdjustments.map(j=>"".concat(j.time," ").concat(j.back?"-":""," ").concat(j.typedTime)).join(" ")).concat(this.eol),v+=this.eol)}return v}printKey(A){return A?"k=".concat(A).concat(this.eol):""}printAttributes(A){let v="";for(let D of A)v+="a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol);return v}printMediaDescription(A){let v="";for(let D of A)v+=this.printMedia(D.media),v+=this.printInformation(D.information),v+=this.printConnections(D.connections),v+=this.printBandwidth(D.bandwidths),v+=this.printKey(D.key),v+=this.printMediaAttributes(D);return v}printConnections(A){let v="";for(let D of A)v+=this.printConnection(D);return v}printMedia(A){return"m=".concat(A.mediaType," ").concat(A.port," ").concat(A.protos.join("/")," ").concat(A.fmts.join(" ")).concat(this.eol)}printSessionAttributes(A){return new xt(this.eol).print(A)}printMediaAttributes(A){return new fe(this.eol).print(A)}}class ot{constructor(A){xe(this,"eol",void 0),this.eol=A}printIceUfrag(A){return A===void 0?"":"a=ice-ufrag:".concat(A).concat(this.eol)}printIcePwd(A){return A===void 0?"":"a=ice-pwd:".concat(A).concat(this.eol)}printIceOptions(A){return A===void 0?"":"a=ice-options:".concat(A.join(c)).concat(this.eol)}printFingerprints(A){return A.length>0?A.map(v=>"a=fingerprint:".concat(v.hashFunction).concat(c).concat(v.fingerprint)).join(this.eol)+this.eol:""}printExtmap(A){return A.map(v=>"a=extmap:".concat(v.entry).concat(v.direction?"/".concat(v.direction):"").concat(c).concat(v.extensionName).concat(v.extensionAttributes?"".concat(c).concat(v.extensionAttributes):"").concat(this.eol)).join("")}printSetup(A){return A===void 0?"":"a=setup:".concat(A).concat(this.eol)}printUnrecognized(A){return A.map(v=>"a=".concat(v.attField).concat(v.attValue?":".concat(v.attValue):"").concat(this.eol)).join("")}}class xt extends ot{print(A){let v="";return v+=this.printGroups(A.groups),v+=this.printMsidSemantic(A.msidSemantic),v+=this.printIceLite(A.iceLite),v+=this.printIceUfrag(A.iceUfrag),v+=this.printIcePwd(A.icePwd),v+=this.printIceOptions(A.iceOptions),v+=this.printFingerprints(A.fingerprints),v+=this.printSetup(A.setup),v+=this.printTlsId(A.tlsId),v+=this.printIdentity(A.identities),v+=this.printExtmap(A.extmaps),v+=this.printUnrecognized(A.unrecognized),v}printGroups(A){let v="";return A.length>0&&(v+=A.map(D=>"a=group:".concat(D.semantic).concat(D.identificationTag.map(j=>"".concat(c).concat(j)).join("")).concat(this.eol)).join("")),v}printIceLite(A){return A===void 0?"":"a=ice-lite"+this.eol}printTlsId(A){return A?"a=tls-id:".concat(A).concat(this.eol):""}printIdentity(A){return A.length===0?"":A.map(v=>"a=identity:".concat(v.assertionValue).concat(v.extensions.map(D=>"".concat(c).concat(D.name).concat(D.value?"=".concat(D.value):"")))).join(this.eol)+this.eol}printMsidSemantic(A){if(!A)return"";let v="a=msid-semantic:".concat(A.semantic);return A.applyForAll?v+="".concat(c,"*"):A.identifierList.length>0&&(v+=A.identifierList.map(D=>"".concat(c).concat(D))),v+this.eol}}class fe extends ot{print(A){let v=A.attributes,D="";return D+=this.printRTCP(v.rtcp),D+=this.printIceUfrag(v.iceUfrag),D+=this.printIcePwd(v.icePwd),D+=this.printIceOptions(v.iceOptions),D+=this.printCandidates(v.candidates),D+=this.printRemoteCandidatesList(v.remoteCandidatesList),D+=this.printEndOfCandidates(v.endOfCandidates),D+=this.printFingerprints(v.fingerprints),D+=this.printSetup(v.setup),D+=this.printMid(v.mid),D+=this.printExtmap(v.extmaps),D+=this.printRTPRelated(v),D+=this.printPtime(v.ptime),D+=this.printMaxPtime(v.maxPtime),D+=this.printDirection(v.direction),D+=this.printSSRCGroups(v.ssrcGroups),D+=this.printSSRC(v.ssrcs),D+=this.printRTCPMux(v.rtcpMux),D+=this.printRTCPMuxOnly(v.rtcpMuxOnly),D+=this.printRTCPRsize(v.rtcpRsize),D+=this.printMSId(v.msids),D+=this.printImageattr(v.imageattr),D+=this.printRid(v.rids),D+=this.printSimulcast(v.simulcast),D+=this.printSCTPPort(v.sctpPort),D+=this.printMaxMessageSize(v.maxMessageSize),D+=this.printUnrecognized(v.unrecognized),D}printCandidates(A){return A.map(v=>"a=candidate:".concat(v.foundation).concat(c).concat(v.componentId).concat(c).concat(v.transport).concat(c).concat(v.priority).concat(c).concat(v.connectionAddress).concat(c).concat(v.port).concat(c,"typ").concat(c).concat(v.type).concat(v.relAddr?"".concat(c,"raddr").concat(c).concat(v.relAddr):"").concat(v.relPort?"".concat(c,"rport").concat(c).concat(v.relPort):"").concat(Object.keys(v.extension).map(D=>"".concat(c).concat(D).concat(c).concat(v.extension[D])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(A){return A.map(v=>"a=remote-candidates:".concat(v.join(c)).concat(this.eol)).join("")}printEndOfCandidates(A){return A===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(A){if(!A.payloads)return"";let v=A.payloads,D="";D+=A.rtcpFeedbackWildcards.map(j=>this.printRTCPFeedback("*",j)).join("");for(let j of v)D+=this.printRtpMap(j.payloadType,j.rtpMap),D+=this.printFmtp(j.payloadType,j.fmtp),D+=j.rtcpFeedbacks.map(ue=>this.printRTCPFeedback(j.payloadType,ue)).join("");return D}printFmtp(A,v){if(!v)return"";let D=Object.keys(v.parameters);return D.length===1&&v.parameters[D[0]]===null?"a=fmtp:".concat(A).concat(c).concat(D[0]).concat(this.eol):"a=fmtp:".concat(A).concat(c).concat(Object.keys(v.parameters).map(j=>"".concat(j,"=").concat(v.parameters[j])).join(";")).concat(this.eol)}printRtpMap(A,v){return v?"a=rtpmap:".concat(A).concat(c).concat(v.encodingName,"/").concat(v.clockRate).concat(v.encodingParameters?"/".concat(v.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(A,v){let D="a=rtcp-fb:".concat(A).concat(c),j=v;return j.type==="trr-int"?D+="ttr-int".concat(c).concat(j.interval):(D+="".concat(j.type),j.parameter&&(D+="".concat(c).concat(j.parameter),j.additional&&(D+="".concat(c).concat(j.additional)))),D+this.eol}printPtime(A){return A===void 0?"":"a=ptime:".concat(A).concat(this.eol)}printMaxPtime(A){return A===void 0?"":"a=maxptime:".concat(A).concat(this.eol)}printDirection(A){return A===void 0?"":"a=".concat(A).concat(this.eol)}printSSRC(A){return A.map(v=>Object.keys(v.attributes).map(D=>"a=ssrc:".concat(v.ssrcId.toString(10)).concat(c).concat(D).concat(v.attributes[D]?":".concat(v.attributes[D]):"").concat(this.eol)).join("")).join("")}printRTCPMux(A){return A===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(A){return A===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(A){return A===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(A){if(A===void 0)return"";let v="a=rtcp:".concat(A.port);return A.netType&&(v+="".concat(c).concat(A.netType)),A.addressType&&(v+="".concat(c).concat(A.addressType)),A.address&&(v+="".concat(c).concat(A.address)),v+this.eol}printMSId(A){return A.map(v=>"a=msid:".concat(v.id).concat(v.appdata?"".concat(c).concat(v.appdata):"").concat(this.eol)).join("")}printImageattr(A){return A.map(v=>"a=imageattr:".concat(v).concat(this.eol)).join("")}printRid(A){return A.map(v=>{let D="a=rid:".concat(v.id).concat(c).concat(v.direction);return v.payloads&&(D+="".concat(c,"pt=").concat(v.payloads.join(","))),v.params.length>0&&(D+="".concat(c).concat(v.params.map(j=>j.type==="depend"?"depend=".concat(j.rids.join(",")):"".concat(j.type,"=").concat(j.val)).join(";"))),D+this.eol}).join("")}printSimulcast(A){return A===void 0?"":"a=simulcast:".concat(A).concat(this.eol)}printSCTPPort(A){return A===void 0?"":"a=sctp-port:".concat(A).concat(this.eol)}printMaxMessageSize(A){return A===void 0?"":"a=max-message-size:".concat(A).concat(this.eol)}printMid(A){return A===void 0?"":"a=mid:".concat(A).concat(this.eol)}printSSRCGroups(A){return A.map(v=>"a=ssrc-group:".concat(v.semantic).concat(v.ssrcIds.map(D=>"".concat(c).concat(D.toString(10))).join("")).concat(this.eol)).join("")}}function $(ie){return new z().parse(ie)}function ne(ie,A){return new qe().print(ie,A)}}},e={};function t(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return n[i](r,r.exports,t),r.exports}return t.d=(i,r)=>{for(var a in r)t.o(r,a)&&!t.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:r[a]})},t.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),t.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t(8)})();function lo(n){return CB.parse(n)}function ya(n,e){return CB.print(n,e)}var aE=Bn("Array","keys"),B4=Ms,j4=Bi,G4=Be,W4=aE,v1=Array.prototype,y1={DOMTokenList:!0,NodeList:!0},H4=function(n){var e=n.keys;return n===v1||G4(v1,n)&&e===v1.keys||j4(y1,B4(n))?W4:e},Lo=X(H4);function Pi(n,e,t){return(e=(function(i){var r=(function(a,s){if(typeof a!="object"||!a)return a;var o=a[Symbol.toPrimitive];if(o!==void 0){var c=o.call(a,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)})(i);return typeof r=="symbol"?r:r+""})(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Wr(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Mt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Wr(Object(t),!0).forEach(function(i){Pi(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Wr(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let Ut=new class extends Sr{constructor(){super(...arguments),Pi(this,"currentUploadLogID",0)}reportLogUploadError(n){let{errorRange:e}=n;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",n))}};class bB{constructor(e){Pi(this,"logger",void 0),Pi(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function C1(){let n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function SO(){let n=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?e?.[0]+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}let Bc={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},ko=Date.now(),sE=n=>{for(let e in Bc)if(Object.prototype.hasOwnProperty.call(Bc,e)&&Bc[e]===n)return e;return"DEFAULT"},I=new class{constructor(){Pi(this,"proxyServerURL",void 0),Pi(this,"logLevel",Bc.DEBUG),Pi(this,"uploadState","collecting"),Pi(this,"uploadLogWaitingList",[]),Pi(this,"uploadLogUploadingList",[]),Pi(this,"uploadErrorCount",0),Pi(this,"currentLogID",0),Pi(this,"url",void 0),Pi(this,"extLog",(n,e)=>{this.appendLogToWaitingList(n,...e)})}debug(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];let i=[Bc.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];let i=[Bc.INFO].concat(e);this.log.apply(this,i)}warning(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];let i=[Bc.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];let i=[Bc.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];let i=[Bc.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){Ct("UPLOAD_LOG",!0)}disableLogUpload(){Ct("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new bB(this).prefix(n)}log(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];if(Date.now()-ko<100)return void setTimeout(()=>{this.log(...e)},Date.now()-ko);let i=Math.max(0,Math.min(4,e[0]));if(e[0]=C1()+" Agora-SDK [".concat(sE(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;let r=C1()+" %cAgora-SDK [".concat(sE(i),"]:"),a=[];if(!B("USE_NEW_LOG"))switch(i){case Bc.DEBUG:a=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,a);break;case Bc.INFO:a=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,a);break;case Bc.WARNING:a=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,a);break;case Bc.ERROR:a=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];if(Date.now()-ko<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-ko);let i=Math.max(0,Math.min(4,e[0]));e[0]=C1()+" Agora-SDK [".concat(sE(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(n){if(!B("UPLOAD_LOG"))return;for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];Array.isArray(t[0])?t[0][0]=SO()+" Agora-SDK [".concat(sE(n),"]:"):t[0]=SO()+" Agora-SDK [".concat(sE(n),"]:");let r="";t.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),r+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:n,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let n=this.uploadLogUploadingList,e={sdk_version:dc,process_id:B("PROCESS_ID"),payload:JSON.stringify(n)};return Od(async()=>{let t=await mr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(B("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(B("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(t.data!=="OK"){let i=new Error("unexpected upload log response");throw i.response=t,i}},()=>(this.uploadLogUploadingList=[],!1),t=>{let i={status:-1,message:t.message,errorRange:n.map(r=>r.log_item_id)};return t.response?(i.status=t.response.status,i.data=t.response.data,i.headers=t.response.headers):t.request&&(i.status=t.request.status),Ut.reportLogUploadError(i),!0},{timeout:B("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:B("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,B("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var w;function AB(n){return Zn(n.reportId,"params.reportId",0,100,!1),Zn(n.category,"params.category",0,100,!1),Zn(n.event,"params.event",0,100,!1),Zn(n.label,"params.label",0,100,!1),Bt(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(w={}).FREE="free",w.UPLOADING="uploading",(function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"})({});let K4={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Hn=(function(n){return n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats",n.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",n.AB_TEST="ab_test",n})({}),qt=(function(n){return n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats",n.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",n.AB_TEST="io.agora.pb.Wrtc.ABTest",n})({});(function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let vr=(function(n){return n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",n})({});function pt(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,t,i){let r=i.value;if(typeof r=="function"){let a=n.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var s,o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];let l=c;if(n.argsMap)try{l=n.argsMap(this,...c)}catch(_){I.warning(_),l=[]}try{JSON.stringify(l)}catch{I.warning("arguments for method ".concat(a,".").concat(String(t)," not serializable for apiInvoke.")),l=[]}let h=(n.report||Te).reportApiInvoke(this._sessionId||null,{id:this._clientId||((s=this.store)===null||s===void 0?void 0:s.clientId)||this._ID,name:"".concat(a,".").concat(String(t)),options:l,tag:Gt.TRACER,reportResult:n.reportResult},n.throttleTime);try{let _=r.apply(this,c);return _ instanceof se?_.then(f=>(h.onSuccess(n.reportResult&&f),f)).catch(f=>{throw h.onError(f),f}):(h.onSuccess(n.reportResult&&_),_)}catch(_){throw h.onError(_),_}}}return i}}let Te=new class{constructor(){Pi(this,"baseInfoMap",new Map),Pi(this,"proxyServer",void 0),Pi(this,"eventUploadTimer",void 0),Pi(this,"setSessionIdTimer",void 0),Pi(this,"url",void 0),Pi(this,"sids",new Set),Pi(this,"backupUrl",void 0),Pi(this,"_appId",void 0),Pi(this,"_aid",0),Pi(this,"keyEventUploadPendingItems",[]),Pi(this,"normalEventUploadPendingItems",[]),Pi(this,"apiInvokeUploadPendingItems",[]),Pi(this,"apiInvokeCount",0),Pi(this,"apiInvokeLoggedCount",0),Pi(this,"ltsList",[]),Pi(this,"lastSendNormalEventTime",Date.now()),Pi(this,"customReportCounterTimer",void 0),Pi(this,"customReportCount",0),Pi(this,"extApiInvoke",async n=>{for(let e of n){let t=Mt(Mt({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Gt.TRACER});this.sendApiInvoke(t)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),B("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),B("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(n){return this.baseInfoMap.get(n)}setAppId(n){this._appId=n,this._aid=parseInt(n.replace(/[a-fA-F0-9]{8}/g,e=>{let[t,i]=e;return t+i}),16)||0}reportApiInvoke(n,e,t){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;let i=Date.now();this.apiInvokeCount+=1;let r=this.apiInvokeCount,a=!!B("SHOW_REPORT_INVOKER_LOG"),s=!!B("SHOW_REPORT_USER_INVOKER_LOG"),o=a||s&&e.id;o&&(this.apiInvokeLoggedCount+=1);let c=this.apiInvokeLoggedCount;function d(f,m){if(o){let S="[apiInvoke-".concat(c,"]");if(e.id&&(S+="[".concat(e.id,"]")),e.name&&(S+="[".concat(e.name,"]"),e.name===Jr.JOIN))return I.info("".concat(S," ").concat(f));I.info("".concat(S," ").concat(f),f==="start"?e.options:m||"")}}let l=()=>({tag:e.tag,invokeId:r,sid:n,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});d("start");let h=!1;va(e.timeout).then(()=>{h||(this.sendApiInvoke(Mt(Mt({},l()),{},{error:M.API_INVOKE_TIMEOUT,success:!1})),d("timeout"))});let _=new L(M.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:f=>{let m=()=>{if(h)throw _;return h=!0,this.sendApiInvoke(Mt(Mt({},l()),{},{success:!0},e.reportResult&&{result:f})),d("onSuccess"),f};return t?_1(m,e.name+"Success",t,()=>h=!0):m()},onError:f=>{let m=()=>{if(h)throw f;h=!0,this.sendApiInvoke(Mt(Mt({},l()),{},{success:!1,error:f})),d("onFailure",f.toString())};return t?_1(m,e.name+"Error",t,()=>h=!0):m()}}}sessionInit(n,e){if(this.baseInfoMap.has(n))return;let t=Date.now(),i=this.createBaseInfo(n,t);i.cname=e.cname;let r=Object.assign({},{willUploadConsoleLog:B("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:lc?"global":"oversea",areas:B("AREAS")&&B("AREAS").join(",")},e.extend),{stringUid:a,channelProfile:s,channelMode:o,isABTestSuccess:c,lsid:d,clientRole:l}=e,h=Date.now(),_=Mt(Mt({},i),{},{eventType:Hn.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:fb,lts:h,elapse:h-t,extend:JSON.stringify(r),mode:e.mode,process:B("PROCESS_ID"),appType:B("APP_TYPE"),success:!0,version:dc,stringUid:a,channelProfile:s,channelMode:o,isABTestSuccess:c,lsid:d,clientType:ee(f=window.navigator.userAgent).call(f,"AgoraWebView")?42:20,clientRole:l,serviceId:B("PROCESS_ID"),extensionID:B("PLUGIN_INFO").join(",")||""});var f;this.send({type:qt.SESSION,data:_},!0)}joinChooseServer(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt({},i),{},{role:e.role,eventType:Hn.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-t.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0,resourceTimingInfo:e.resourceTimingInfo||void 0});this.send({type:qt.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt({},i),{},{eventType:Hn.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-t.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:qt.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;let r=Date.now(),{firstSuccess:a,addr:s,isProxy:o}=e,c=r-t.startTime,d=Mt(Mt({},i),{},{eventType:Hn.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:c,eventElapse:r-e.lts,firstSuccess:a,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:gO(),isABTestSuccess:e.isABTestSuccess?1:0}),l=d.success?1:0;if(e.succ&&(t.lastJoinSuccessTime=r),a)this.send({type:qt.JOIN_GATEWAY,data:d},!0);else{let h;if(s)if(o){let f=s.match(/h=(\d{1,3}-){3}\d{1,3}/g),m=s.match(/p=[0-9]{1,6}/g);h={isSuccess:l,gatewayIp:f&&f.length?f[0].split("=")[1].replace(/-/g,"."):"",port:m&&m.length?m[0].split("=")[1]:"",isProxy:o?1:0}}else{let f=s.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),m=s.match(/(:|p=)[0-9]{1,6}/g);h={isSuccess:l,gatewayIp:f&&f.length?f[0].split("//")[1].replace(/-/g,"."):"",port:m&&m.length?m[0].split(/:|p=/g)[1]:"",isProxy:o?1:0}}else h={isSuccess:l,gatewayIp:"",port:"",isProxy:o?1:0};delete d.success,delete d.eventType,delete d.firstSuccess,d.vid=Number(d.vid);let _=Object.assign({},d,h,{eventType:Hn.REJOIN_GATEWAY});this.send({type:qt.RE_JOIN_GATEWAY,data:_},!0)}}joinChannelTimeout(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=Date.now(),r=Mt(Mt({},t.info),{},{lts:i,timeout:e,elapse:i-t.startTime});this.send({type:qt.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt({},i),{},{eventType:Hn.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-t.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:qt.PUBLISH,data:a},!0)}subscribe(n,e,t){let i=this.baseInfoMap.get(n);if(!i)return;let r=i.info,a=Date.now(),s=Mt(Mt({},r),{},{eventType:Hn.SUBSCRIBE,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},t&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?s.peerSuid=e.peerid:s.peer=e.peerid,this.send({type:qt.SUBSCRIBE,data:s},!0)}wsCompressorInit(n){var e;let t=[...Lo(e=this.baseInfoMap).call(e)],i=t.length?t[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;let a=r.info,s=Date.now(),o=Mt(Mt({},a),{},{eventType:Hn.WS_COMPRESSOR_INIT,lts:s,eventElapse:n.eventElapse,elapse:s-r.startTime,status:n.status?1:2});this.send({type:qt.WS_COMPRESSOR_INIT,data:o},!0)}firstXLAPeerFirstVideoFrame(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=e.peerPubStatusMs-(t.lastJoinSuccessTime||r),s=Mt(Mt({},i),{},{elapse:r-t.startTime,eventType:Hn.XLA_PEER_FIRST_VIDEO_FRAME,lts:r,peer:e.peer,width:e.width,height:e.height,ssrc:e.ssrc,p2pid:e.p2pid,peerPublishDuration:e.peerPublishDuration,joinChannelSuccessElapse:a,peerPubStatusMs:e.peerPubStatusMs-e.joinChannelStart,availablePublish:e.peerPublishDuration>a?1:0,preloadStart:Math.max(e.preloadStart-e.joinChannelStart,0),preloadEnd:Math.max(e.preloadEnd-e.joinChannelStart,0),encrypt:Math.max(e.apStart-e.joinChannelStart,0),ap:Math.max(e.apEnd-e.joinChannelStart,0),sua:Math.max(e.suaEnd-e.joinChannelStart,0),beforeConnect:Math.max(e.beforeConnect-e.joinChannelStart,0),peerRecevier:Math.max(e.peerReceiver-e.joinChannelStart,0),ice:Math.max(e.ice-e.joinChannelStart,0),pc:Math.max(e.pc-e.joinChannelStart,0),signalConnected:Math.max(e.signalConnected-e.joinChannelStart,0),joinReq:Math.max(e.joinReq-e.joinChannelStart,0),joinRes:Math.max(e.joinRes-e.joinChannelStart,0),userJoinNotify:Math.max(e.userJoinNotify-e.joinChannelStart,0),videoSsrcNotify:Math.max(e.videoAddNotify-e.joinChannelStart,0),subscribeDelayMs:Math.max(e.subscribeStart-e.videoAddNotify,0),subscribeStart:Math.max(e.subscribeStart-e.joinChannelStart,0),subscribeEnd:Math.max(e.subscribeEnd-e.joinChannelStart,0),firstReceived:Math.max(e.firstReceived-e.joinChannelStart,0),firstDecoded:Math.max(e.firstDecoded-e.joinChannelStart,0),firstPreRender:Math.max(e.firstPreRender-e.joinChannelStart,0),firstRender:Math.max(e.firstRender-e.joinChannelStart,0),playDelayMs:Math.max(e.playStart-e.subscribeEnd,0),playStart:Math.max(e.playStart-e.joinChannelStart,0),playEnd:Math.max(e.playEnd-e.joinChannelStart,0),isPreSub:e.isPreSub?1:0,isPrePc:e.isPrePc?1:0,isPreInstantVideo:e.isPreInstantVideo?1:0});this.send({type:qt.XLA_PEER_FIRST_VIDEO_FRAME,data:s},!0)}firstRemoteVideoDecode(n,e,t,i){let r=this.baseInfoMap.get(n);if(!r)return;let a=r.info,s=Date.now(),o=Mt(Mt(Mt({},a),i),{},{elapse:s-r.startTime,eventType:e,lts:s,firstDecodeFrame:Math.max((i.firstFrame||s)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:t,data:o},!0)}firstRemoteFrame(n,e,t,i){let r=this.baseInfoMap.get(n);if(!r)return;let a=r.info,s=Date.now(),o=Mt(Mt(Mt({},a),i),{},{elapse:s-r.startTime,eventType:e,lts:s});this.send({type:t,data:o},!0)}abTest(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt(Mt({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-t.startTime,eventType:Hn.AB_TEST,lts:r});this.send({type:qt.AB_TEST,data:a},!0)}pcStats(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt(Mt({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-t.startTime,eventType:Hn.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:qt.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(n,e){if(n){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt(Mt({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Hn.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:qt.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(n,e,t,i){let r=this.baseInfoMap.get(n);if(!r)return;let a=r.info,s=Date.now(),o=Mt(Mt(Mt({},a),i),{},{eventType:e,lts:s});this.send({type:t,data:o},!0)}streamSwitch(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt({},i),{},{eventType:Hn.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-t.startTime,success:e.succ});this.send({type:qt.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt({},i),{},{eventType:Hn.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-t.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:qt.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt({},i),{},{eventType:Hn.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-t.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:qt.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(n){this.proxyServer=n,n?I.debug("reportProxyServerurl: ".concat(n)):I.debug("disable reportProxyServerurl: ".concat(n))}peerPublishStatus(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-t.startTime,joinChannelSuccessElapse:r-(t.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:qt.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now();(function(a,s,o){let c=a[s];if(!c||typeof c!="string")return[a];a[s]="";let d=Vu(JSON.stringify(a)),l=0,h=[],_=0;for(let f=0;f<c.length;f++)_+=c.charCodeAt(f)<=127?1:3,_<=o-d||(h[h.length]=we(we({},a),{},{[s]:c.substring(l,f)}),l=f,_=c.charCodeAt(f)<=127?1:3);return l!==c.length-1&&(h[h.length]=we(we({},a),{},{[s]:c.substring(l)})),h})(Mt(Mt(Mt({},i),e),{},{elapse:r-t.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:qt.WORKER_EVENT,data:a},!0))}apworkerEvent(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt(Mt({},i),e),{},{elapse:r-t.startTime,lts:r});this.send({type:qt.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt(Mt({},i),e),{},{elapse:r-t.startTime,lts:r,extend:e.extend||void 0});this.send({type:qt.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(n,e){let t=this.baseInfoMap.get(n);if(!t)return;let i=t.info,r=Date.now(),a=Mt(Mt(Mt({},i),e),{},{elapse:r-t.startTime,lts:r});this.send({type:qt.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(n,e){if(this.customReportCount+=e.length,this.customReportCount>B("CUSTOM_REPORT_LIMIT"))throw new L(M.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let t=Date.now(),i=e.map(r=>({type:qt.USER_ANALYTICS,data:Mt(Mt({sid:n},r),{},{lts:t})}));try{B("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw I.error("send custom report message failed",r.toString()),new L(M.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(n){let e=B("NOT_REPORT_EVENT");if(n.tag&&ee(e)&&ee(e).call(e,n.tag))return!1;if(n.sid===null)return this.apiInvokeUploadPendingItems.push(n),!1;let t=this.baseInfoMap.get(n.sid);if(!t)return this.apiInvokeUploadPendingItems.push(n),!1;let{cname:i,uid:r,cid:a}=t.info,s;if(n.lts=n.lts||Date.now(),n.error)if(n.error instanceof L){let{code:c,message:d}=n.error;s=c||d||n.error.toString()}else s=n.error.toString();let o={invokeId:n.invokeId,sid:n.sid,cname:i,cid:a,uid:r,lts:n.lts,success:n.success,elapse:n.lts-t.startTime,execElapse:n.lts-n.apiInvokeTime,apiName:n.name,options:n.options?JSON.stringify(n.options):void 0,execStates:n.states?JSON.stringify(n.states):void 0,execResult:n.result?JSON.stringify(n.result):void 0,errorCode:n.error?s:void 0,errorMsg:n.error?JSON.stringify(n.error):void 0};return this.send({type:qt.API_INVOKE,data:o},!1),!0}addSid(n){this.sids.add(n)}removeSid(n){this.sids.delete(n)}appendSessionId(){let n=this.apiInvokeUploadPendingItems;if(n.length===0)return;let e=Array.from(this.sids).find(t=>t!==null);e&&n.forEach(t=>{t&&(t.sid=e,this.sendApiInvoke(Object.assign({},t)))}),n.length=0}send(n,e){if(e)return this.keyEventUploadPendingItems.push(n),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(n),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(n,e){let t=[],i=[];for(;n.length;){let a=n.shift();t.length<20?t.push(a):i.push(a)}n.push(...i);for(let a of[...t]){var r;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),vt(r=this.ltsList).call(r,(s,o)=>s-o))}return e||(this.lastSendNormalEventTime=Date.now()),B("ENABLE_EVENT_REPORT")&&t.length&&(B("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(t):this.postDataToStatsCollector(t)).catch((a=>s=>{B("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-B("NORMAL_EVENT_QUEUE_CAPACITY")),I.warning("report: drop normal events"))))})(t)),n}async postDataToStatsCollector2(n){Kr.networkState===Rr.OFFLINE&&await se.race([Kr.onlineWaiter,va(2*Yr.maxRetryTimeout)]);let e=r=>{let a=new Uint8Array;return r.forEach(s=>{let o=cO(JSON.stringify(s.data)),c=new ArrayBuffer(5),d=(h=>{let _=0;return Object.entries(qt).forEach(f=>{let[m,S]=f;S===h.type&&(_=vr[m])}),_})(s),l=new DataView(c);l.setUint16(0,o.byteLength,!0),l.setUint8(2,255&d),l.setUint8(3,d>>>8&255),l.setUint8(4,d>>>16&255),a=dO(a,new Uint8Array(c)),a=dO(a,o)}),a},t="event",i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(t):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(t);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(t):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(t));try{await pb(i,{timeout:1e4,data:e(n),headers:Mt(Mt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(r===1)throw a;continue}return}}async postDataToStatsCollector(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=(o=>{let c=o&&o.data.sid&&this.baseInfoMap.get(o.data.sid);return c&&c.info.vid&&+c.info.vid||0})(n[0]),i=t?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:n.map(o=>JSON.stringify(o)),vid:t,aid:i};Kr.networkState===Rr.OFFLINE&&await se.race([Kr.onlineWaiter,va(2*Yr.maxRetryTimeout)]);let a=e?"/events/proto-raws":"/events/messages",s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(B("EVENT_REPORT_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(a));for(let o=0;o<2;o+=1){o===1&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(B("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(a)));try{e?await E1(s,{timeout:1e4,data:r}):await pb(s,{timeout:1e4,data:r})}catch(c){if(o===1)throw c;continue}return}}createBaseInfo(n,e){let t=Object.assign({},K4);return t.sid=n,this.baseInfoMap.set(n,{info:t,startTime:e}),t}reportResourceTiming(n,e){let t=performance.getEntriesByName(n),i=t[t.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:Gt.TRACER}).onSuccess()}};Ut.on("REPORT_LOG_UPLOAD",n=>{n.networkState=Kr.networkState,Te.reportApiInvoke(null,{name:"logUploadError",options:n,tag:Gt.TRACER}).onSuccess("logUploadError")});class J extends L{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Pi(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,I)}throw(){super.throw(I)}}let oe={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Nt(){return oe}function Si(){return"setSinkId"in HTMLAudioElement.prototype&&(!B("RESTRICTION_SET_PLAYBACK_DEVICE")||(_l()||d1())&&!sO())}function mb(){return!oe.supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&xu()}function iR(n){return!(jr()||Tg(87)||mb()||!B("ENABLE_PRE_SUB")&&(n==null||!n.autoSubscribe||B("FORCE_DISABLE_AUTO_SUB")))}function TO(n){return!!B("ENABLE_INSTANT_VIDEO")||!(n==null||!n.autoSubscribe||B("FORCE_DISABLE_AUTO_SUB"))}let sa=(function(n){return n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change",n})({});function On(n,e,t){return{sampleRate:n,stereo:e,bitrate:t}}function ai(n,e,t,i,r){return{width:n,height:e,frameRate:t,bitrateMin:i,bitrateMax:r}}function Kt(n,e,t,i,r){return{width:{max:n},height:{max:e},frameRate:t,bitrateMin:i,bitrateMax:r}}function jc(n,e){return{numSpatialLayers:n,numTemporalLayers:e}}let b1={"90p":ai(160,90),"90p_1":ai(160,90),"120p":ai(160,120,15,30,65),"120p_1":ai(160,120,15,30,65),"120p_3":ai(120,120,15,30,50),"120p_4":ai(212,120),"180p":ai(320,180,15,30,140),"180p_1":ai(320,180,15,30,140),"180p_3":ai(180,180,15,30,100),"180p_4":ai(240,180,15,30,120),"240p":ai(320,240,15,40,200),"240p_1":ai(320,240,15,40,200),"240p_3":ai(240,240,15,40,140),"240p_4":ai(424,240,15,40,220),"360p":ai(640,360,15,80,400),"360p_1":ai(640,360,15,80,400),"360p_3":ai(360,360,15,80,260),"360p_4":ai(640,360,30,80,600),"360p_6":ai(360,360,30,80,400),"360p_7":ai(480,360,15,80,320),"360p_8":ai(480,360,30,80,490),"360p_9":ai(640,360,15,80,800),"360p_10":ai(640,360,24,80,800),"360p_11":ai(640,360,24,80,1e3),"480p":ai(640,480,15,100,500),"480p_1":ai(640,480,15,100,500),"480p_2":ai(640,480,30,100,1e3),"480p_3":ai(480,480,15,100,400),"480p_4":ai(640,480,30,100,750),"480p_6":ai(480,480,30,100,600),"480p_8":ai(848,480,15,100,610),"480p_9":ai(848,480,30,100,930),"480p_10":ai(640,480,10,100,400),"720p":ai(1280,720,15,120,1130),"720p_auto":ai(1280,720,30,900,3e3),"720p_1":ai(1280,720,15,120,1130),"720p_2":ai(1280,720,30,120,2e3),"720p_3":ai(1280,720,30,120,1710),"720p_5":ai(960,720,15,120,910),"720p_6":ai(960,720,30,120,1380),"1080p":ai(1920,1080,15,120,2080),"1080p_1":ai(1920,1080,15,120,2080),"1080p_2":ai(1920,1080,30,120,3e3),"1080p_3":ai(1920,1080,30,120,3150),"1080p_5":ai(1920,1080,60,120,4780),"1440p":ai(2560,1440,30,120,4850),"1440p_1":ai(2560,1440,30,120,4850),"1440p_2":ai(2560,1440,60,120,7350),"4k":ai(3840,2160,30,120,8910),"4k_1":ai(3840,2160,30,120,8910),"4k_3":ai(3840,2160,60,120,13500)},Y4={"480p":Kt(640,480,5),"480p_1":Kt(640,480,5),"480p_2":Kt(640,480,30),"480p_3":Kt(640,480,15),"720p":Kt(1280,720,5),"720p_auto":ai(1280,720,30,900,3e3),"720p_1":Kt(1280,720,5),"720p_2":Kt(1280,720,30),"720p_3":Kt(1280,720,15),"1080p":Kt(1920,1080,5),"1080p_1":Kt(1920,1080,5),"1080p_2":Kt(1920,1080,30),"1080p_3":Kt(1920,1080,15)},z4={"1SL1TL":jc(1,1),"3SL3TL":jc(3,3),"2SL3TL":jc(2,3)};function gl(n){return n||(n="480p_1"),typeof n=="string"?Object.assign({},b1[n]):n}function Gc(n){return typeof n=="string"?Object.assign({},Y4[n]):n}function rR(n){return typeof n=="string"?Object.assign({},z4[n]):n}let RO={speech_low_quality:On(16e3,!1),speech_standard:On(32e3,!1,18),music_standard:On(48e3,!1),standard_stereo:On(48e3,!0,56),high_quality:On(48e3,!1,128),high_quality_stereo:On(48e3,!0,192)};function vO(n){return typeof n=="string"?Object.assign({},RO[n]):n}let s_=[];function bg(n){return gr(n,"mediaSource",["screen","window","application"]),!0}let Je=(function(n){return n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_RTC_STATS="@get_rtc_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track",n})({}),Oe=(function(n){return n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream",n.SCREEN_LOW_TRACK="screen_low_track",n})({}),Ui=(function(n){return n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM",n})({}),nR=(function(n){return n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",n[n.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",n[n.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",n[n.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",n[n.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",n[n.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",n})({}),q4=(function(n){return n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY",n[n.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",n[n.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",n[n.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",n[n.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",n[n.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",n[n.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",n})({}),Ag=(function(n){return n.TRANSCEIVER_UPDATED="transceiver-updated",n.SEI_TO_SEND="sei-to-send",n.SEI_RECEIVED="sei-received",n.TRACK_UPDATED="track-updated",n})({}),Sl=(function(n){return n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed",n})({}),js=(function(n){return n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.VIDEO_STATE_CHANGED="video-state-changed",n.PLAY_START="play-start",n.PLAY_END="play-end",n.FIRST_FRAME_RENDER="first-frame-render",n})({}),Gs=(function(n){return n.AUDIO="audio",n.VIDEO="video",n.DATA="data",n})({}),ys=(function(n){return n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source",n})({});(function(n){n.UPDATE_TRACK_SOURCE="update-track-source"})({});let Mo={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},gb={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},yO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},IB={uplinkNetworkQuality:0,downlinkNetworkQuality:0},wB={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Cs=(function(n){return n.ON_TRACK="on_track",n.ON_NODE="on_node",n})({}),nn=(function(n){return n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints",n})({}),Ws=(function(n){return n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND",n})({}),Bu=(function(n){return n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",n})({}),Mn=(function(n){return n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata",n})({}),un=(function(n){return n[n.VideoStateStopped=0]="VideoStateStopped",n[n.VideoStateStarting=1]="VideoStateStarting",n[n.VideoStateDecoding=2]="VideoStateDecoding",n[n.VideoStateFrozen=3]="VideoStateFrozen",n})({}),Tl={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},aR=(function(n){return n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error",n})({});function si(n,e,t,i,r){var a,s,o={};return Object.keys(i).forEach(function(c){o[c]=i[c]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=Pn(a=XE(s=t.slice()).call(s)).call(a,function(c,d){return d(n,e,c)||c},o),r&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),o.initializer===void 0?(Object.defineProperty(n,e,o),null):o}function te(n,e,t){return(e=(function(i){var r=(function(a,s){if(typeof a!="object"||!a)return a;var o=a[Symbol.toPrimitive];if(o!==void 0){var c=o.call(a,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)})(i);return typeof r=="symbol"?r:r+""})(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ce(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Qi(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ce(Object(t),!0).forEach(function(i){te(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ce(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class $i extends Sr{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Ag.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),te(this,"trackMediaType",void 0),te(this,"_ID",void 0),te(this,"_rtpTransceiver",void 0),te(this,"_lowRtpTransceiver",void 0),te(this,"_hints",[]),te(this,"_isClosed",!1),te(this,"_originMediaStreamTrack",void 0),te(this,"mediaStreamTrack",void 0),te(this,"_external",{}),this._ID=t||Ht(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,(function(i){ee(s_).call(s_,i)||s_.push(i)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||r_(()=>{var t;Te.reportApiInvoke(null,{name:Jr.GET_MEDIA_STREAM_TRACK,options:[],tag:Gt.TRACER}).onSuccess(((t=this._mediaStreamTrack)===null||t===void 0?void 0:t.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Ui.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(e){let t=s_.indexOf(e);t!==-1&&s_.splice(t,1)})(this),this.emit(Sl.CLOSED),this.removeAllListeners(Ag.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===Ui.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Ag.TRANSCEIVER_UPDATED,e,t)}}class Ig extends $i{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),te(this,"_enabled",!0),te(this,"_muted",!1),te(this,"_isExternalTrack",!1),te(this,"_isClosed",!1),te(this,"_enabledMutex",void 0),te(this,"processor",void 0),te(this,"_processorContext",void 0),te(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new xa("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return(e=(t=this._originMediaStreamTrack)===null||t===void 0?void 0:t.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,I.debug("[".concat(this.getTrackId(),"] close")),this.emit(Je.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zt(this,Je.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}stateCheck(e,t){if(I.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),_e(t,e),this._enabled&&this._muted&&e==="enabled"&&t===!1)throw new L(M.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",I);if(!this._enabled&&!this._muted&&e==="muted"&&t===!0)throw new L(M.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",I)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():se.resolve([])}}let wg=window.AudioContext||window.webkitAudioContext,uc=null,li=new class extends Sr{constructor(){super(...arguments),te(this,"prevState",void 0),te(this,"curState",void 0),te(this,"currentTime",void 0),te(this,"currentTimeStuckAt",void 0),te(this,"interruptDetectorTrack",void 0),te(this,"onLocalAudioTrackMute",()=>{I.info("ios15-interruption-start"),this.emit(sa.IOS_15_16_INTERRUPTION_START)}),te(this,"onLocalAudioTrackUnmute",async()=>{I.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?I.info("ios15-interruption-end-canceled"):(uc&&await uc.suspend(),this.emit(sa.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(n){I.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){I.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Li(){if(!uc){if((function(){if(!wg)return void I.error("your browser is not support web audio");I.info("create audio context");let n=Qi({},B("WEBAUDIO_INIT_OPTIONS"));I.debug("audio context init option:",JSON.stringify(n)),uc=new wg(n),li.curState=uc.state,uc.onstatechange=()=>{li.prevState=li.curState,li.curState=uc?uc.state:void 0;let{prevState:e,curState:t}=li,i=t==="running",r=t==="interrupted",a=e==="running",s=e==="suspended",o=e==="interrupted",c=pi().osVersion;(Ci()||Id())&&a&&r&&(I.info("ios".concat(c,"-interruption-start")),li.emit(sa.IOS_INTERRUPTION_START)),(Ci()||Id())&&(s||o)&&i&&(I.info("ios".concat(c,"-interruption-end")),li.emit(sa.IOS_INTERRUPTION_END)),e!==t&&li.emit(sa.STATE_CHANGE,t,e)},setInterval(()=>{var e;let t=(e=uc)===null||e===void 0?void 0:e.currentTime;li.currentTime!==t?(li.currentTimeStuckAt&&(I.debug("AudioContext current time resume at ".concat(t)),li.currentTimeStuckAt=void 0),li.currentTime=t):(t!==li.currentTimeStuckAt&&(Te.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:Gt.TRACER}).onSuccess(),I.warning("AudioContext current time stuck at ".concat(t))),li.currentTimeStuckAt=t)},5e3),(async function(e){let t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],i,r=!1,a=!1,s=!1;function o(S){e.state==="running"?c(!1):Ci()||Id()?e.state==="suspended"&&(c(!0),S&&e.resume().then(d,d)):e.state!=="closed"&&(c(!0),S&&e.resume().then(d,d))}function c(S){if(r!==S){r=S;for(let T=0,R=t;T<R.length;T+=1){let C=R[T];S?window.addEventListener(C,l,{capture:!0,passive:!0}):window.removeEventListener(C,l,{capture:!0,passive:!0})}}}function d(){o(!1)}function l(){o(!0)}function h(S){if(!s)if(i.paused)if(S){let T;_(!1),s=!0;try{T=i.play(),T?T.then(f,f):(i.addEventListener("playing",f),i.addEventListener("abort",f),i.addEventListener("error",f))}catch{f()}}else _(!0);else _(!1)}function _(S){if(a!==S){a=S;for(let T=0,R=t;T<R.length;T++){let C=R[T];S?window.addEventListener(C,m,{capture:!0,passive:!0}):window.removeEventListener(C,m,{capture:!0,passive:!0})}}}function f(){i.removeEventListener("playing",f),i.removeEventListener("abort",f),i.removeEventListener("error",f),s=!1,h(!1)}function m(){h(!0)}if(Ci()){let S=e.createMediaStreamDestination(),T=document.createElement("div");T.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=T.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=S.stream,h(!0)}li.on(sa.STATE_CHANGE,function(){o(!0)}),o(!1)})(uc)})(),!uc)throw new L(M.NOT_SUPPORTED,"can not create audio context");return uc}return uc}function Rl(n){if((function(){if(o_!==null)return o_;let i=Li(),r=i.createBufferSource(),a=i.createGain(),s=i.createGain();r.connect(a),r.connect(s),r.disconnect(a);let o=!1;try{r.disconnect(a)}catch{o=!0}return r.disconnect(),o_=o,o})())return;let e=n.connect,t=n.disconnect;n.connect=(i,r,a)=>{var s;return n._inputNodes||(n._inputNodes=[]),ee(s=n._inputNodes).call(s,i)||(i instanceof AudioNode?(n._inputNodes.push(i),e.call(n,i,r,a)):e.call(n,i,r)),n},n.disconnect=(i,r,a)=>{t.call(n),i?Zr(n._inputNodes,i):n._inputNodes=[];for(let s of n._inputNodes)e.call(n,s)}}let o_=null;function Sb(n,e){let t=!1,i=1/e;if(B("DISABLE_WEBAUDIO")){let r=window.setInterval(()=>{t?window.clearInterval(r):n(performance.now()/1e3)},1e3*i)}else{let r=Li(),a=r.createGain();a.gain.value=0,a.connect(r.destination);let s=()=>{if(t)return void(a=null);let o=r.createOscillator();o.onended=s,o.connect(a),o.start(0),o.stop(r.currentTime+i),n(r.currentTime)};s()}return()=>{t=!0}}class CO{constructor(){te(this,"context",void 0),te(this,"analyserNode",void 0),te(this,"sourceNode",void 0),this.context=Li(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ci()||Id()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}let t=Pn(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(t=this.sourceNode)===null||t===void 0||t.connect(this.analyserNode)}catch{I.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class A1 extends Sr{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(t=this._processedNode)===null||t===void 0||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),te(this,"outputNode",void 0),te(this,"outputTrack",void 0),te(this,"isPlayed",!1),te(this,"sourceNode",void 0),te(this,"context",void 0),te(this,"audioBufferNode",void 0),te(this,"destNode",void 0),te(this,"audioOutputLevel",0),te(this,"volumeLevelAnalyser",void 0),te(this,"_processedNode",void 0),te(this,"playNode",void 0),te(this,"isDestroyed",!1),te(this,"onNoAudioInput",void 0),te(this,"isNoAudioInput",!1),te(this,"_noAudioInputCount",0),this.context=Li(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Rl(this.outputNode),this.volumeLevelAnalyser=new CO}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t=>{this.emit(ys.ON_AUDIO_BUFFER,(function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){let a=i.outputBuffer.getChannelData(r);for(let s=0;s<a.length;s+=1)a[s]=0}return i.inputBuffer})(t))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Nt().webAudioMediaStreamDest)throw new L(M.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&i_(()=>{li.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ci()||Id()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let t=this.volumeLevelAnalyser.getAnalyserNode(),i;t.getFloatTimeDomainData?(i=new Float32Array(t.fftSize),t.getFloatTimeDomainData(i)):(i=new Uint8Array(t.fftSize),t.getByteTimeDomainData(i));let r=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await va(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;(e=this.processedNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class I1 extends A1{get isFreeze(){return!1}constructor(e,t,i){var r;if(super(),te(this,"sourceNode",void 0),te(this,"track",void 0),te(this,"clonedTrack",void 0),te(this,"audioElement",void 0),te(this,"isCurrentTrackCloned",!1),te(this,"isRemoteTrack",!1),te(this,"originVolumeLevelAnalyser",void 0),te(this,"rebuildWebAudio",async()=>{if(I.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void I.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>I.info("resume success")),I.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let o=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?o.stop():this.isCurrentTrackCloned=!0;let c=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(c),Rl(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let d=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(d,this.context.currentTime),Rl(this.outputNode),this.emit(ys.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=c,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new L(M.UNEXPECTED_ERROR);this.track=e;let a=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(a),Rl(this.sourceNode),i){let o=i.clone();o.enabled=!0,this.clonedTrack=o,I.debug("create an unmuted track ".concat(o.id," from the original track ").concat(i.id," to get the volume"));let c=this.context.createMediaStreamSource(new MediaStream([o]));Rl(c),this.originVolumeLevelAnalyser=new CO,this.originVolumeLevelAnalyser.updateSource(c)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;let s=pi();t&&s.os===Br.IOS&&Number((r=s.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(li.on(sa.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(o=>{o||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),Rl(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ys.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),li.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),I.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let i=this.context.createMediaStreamSource(new MediaStream([t]));Rl(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function w1(n,e,t){let i=(a,s)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||s:a:s,r={audio:!!t&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function OB(n,e){let t=await NB(n.mediaSource),{sourceId:i,audio:r}=await(function(a){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new se((o,c)=>{let d=document.createElement("div");d.innerText="share screen",d.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let l=document.createElement("div");l.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let h=document.createElement("div");h.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",h.setAttribute("style","height: 12%;");let _=document.createElement("div");_.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let f=document.createElement("div");f.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let m=document.createElement("button");m.innerHTML="cancel",m.setAttribute("style","width: 85px;"),m.onclick=()=>{document.body.removeChild(R);let C=new Error("NotAllowedError");C.name="NotAllowedError",c(C)};let S=s,T=document.createElement("div");if(s){let C=document.createElement("input");C.setAttribute("type","checkbox");let b=document.createElement("span");C.setAttribute("style","margin-right: 6px;"),b.innerText="Share audio",C.checked=S,C.onchange=()=>{S=C.checked},T.appendChild(C),T.appendChild(b)}f.appendChild(T),f.appendChild(m),l.appendChild(h),l.appendChild(_),l.appendChild(f);let R=document.createElement("div");R.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),R.appendChild(d),R.appendChild(l),document.body.appendChild(R),a.map(C=>{if(C.id){let b=document.createElement("div");b.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let N=C.thumbnail;try{let{width:k}=N.getSize();k>1920&&(N=N.resize({width:1920}))}catch(k){throw k&&k.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),k}b.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+N.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+C.name.replace(/[\u00A0-\u9999<>\&]/g,function(k){return"&#"+k.charCodeAt(0)+";"})+"</span>",b.onclick=()=>{document.body.removeChild(R),o({sourceId:C.id,audio:S})},_.appendChild(b)}})})})(t,e);return await w1(i,n,r)}async function NB(n){let e=["window","screen"];n!=="application"&&n!=="window"||(e=["window"]),n==="screen"&&(e=["screen"]);let t=zT();if(!t)throw console.error("failed to fetch electron, please mount it to window"),new L(M.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=t.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||t.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new se((a,s)=>{t.desktopCapturer.getSources({types:e},(o,c)=>{o?s(o):a(c)})}));try{return await i}catch(a){throw new L(M.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}let bO=new xa("safari"),AO=!1,O1=!1;async function hc(n,e){let t=0,i=null;for(;t<2;)try{i=await Wc(n,e,t>0);break}catch(r){if(r instanceof L)throw I.error("[".concat(e,"] ").concat(r.toString())),r;let a=IO(r.name||r.code||r,r.message);if(a.code===M.MEDIA_OPTION_INVALID){I.debug("[".concat(e,"] detect media option invalid, retry")),t+=1,await va(500);continue}throw I.error("[".concat(e,"] ").concat(a.toString())),a}if(!i)throw new L(M.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function Wc(n,e,t){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new L(M.NOT_SUPPORTED,"can not find getUserMedia");t&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));let i=Nt(),r=new MediaStream;if(n.audioSource&&r.addTrack(n.audioSource),n.videoSource&&r.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return I.debug("Using Video Source/ Audio Source"),r;if(n.screen)if(zT())n.screen.sourceId?c_(r,await w1(n.screen.sourceId,n.screen,!!n.screenAudio)):c_(r,await OB(n.screen,!!n.screenAudio));else if(_l()&&n.screen.extensionId&&n.screen.mandatory){if(!i.getStreamFromExtension)throw new L(M.NOT_SUPPORTED,"This browser does not support screen sharing");I.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));let _=await(s=n.screen.extensionId,o=e,new se((f,m)=>{try{chrome.runtime.sendMessage(s,{getStream:!0},S=>{if(!S||!S.streamId)return I.error("[".concat(o,"] No response from Chrome Plugin. Plugin not installed properly"),S),void m(new L(M.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));f(S.streamId)})}catch(S){I.error("[".concat(o,"] AgoraRTC screensharing plugin is not accessible(").concat(s,")"),S.toString()),m(new L(M.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=_,c_(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(i.getDisplayMedia){var a;n.screen.mediaSource&&bg(n.screen.mediaSource);let _={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:(a=n.screen.displaySurface)!==null&&a!==void 0?a:n.screen.mediaSource==="screen"?"monitor":n.screen.mediaSource},{selfBrowserSurface:f,surfaceSwitching:m,systemAudio:S,preferCurrentTab:T}=n.screen,R={selfBrowserSurface:f,surfaceSwitching:m,systemAudio:S,preferCurrentTab:T};!f&&delete R.selfBrowserSurface,!m&&delete R.surfaceSwitching,!S&&delete R.systemAudio,!T&&delete R.preferCurrentTab,I.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:_,audio:n.screenAudio,controls:R})),c_(r,await navigator.mediaDevices.getDisplayMedia(Qi({video:_,audio:n.screenAudio},R)))}else{if(!jr())throw I.error("[".concat(e,"] This browser does not support screenSharing")),new L(M.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&bg(n.screen.mediaSource);let _={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};I.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(_))),c_(r,await navigator.mediaDevices.getUserMedia(_))}}var s,o;if(!n.video&&!n.audio)return r;let c={video:n.video,audio:n.audio},d=B("MEDIA_DEVICE_CONSTRAINTS");if(d)try{typeof d=="string"&&(d=JSON.parse(d)),c=hO(c,d)}catch{}I.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(c)),pi();let l,h=null;(dn()||Ci()||sb())&&(h=await bO.lock());try{l=await navigator.mediaDevices.getUserMedia(c)}catch(_){throw h&&h(),_}return c.audio&&(AO=!0),c.video&&(O1=!0),c_(r,l),h&&h(),r}function IO(n,e){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new L(M.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new L(M.DEVICE_NOT_FOUND,"".concat(n,": ").concat(e));case"NotSupportedError":return new L(M.NOT_SUPPORTED,"".concat(n,": ").concat(e));case"NotReadableError":return new L(M.NOT_READABLE,"".concat(n,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new L(M.PERMISSION_DENIED,"".concat(n,": ").concat(e));case"ConstraintNotSatisfiedError":return new L(M.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(e));default:return I.error("getUserMedia unexpected error",n),new L(M.UNEXPECTED_ERROR,"".concat(n,": ").concat(e))}}function c_(n,e){let t=n.getVideoTracks()[0],i=n.getAudioTracks()[0],r=e.getVideoTracks()[0],a=e.getAudioTracks()[0];a&&(i&&n.removeTrack(i),n.addTrack(a)),r&&(t&&n.removeTrack(t),n.addTrack(r))}let bs=new class extends Sr{get state(){return this._state}set state(n){n!==this._state&&(this.emit(Bu.STATE_CHANGE,n),this._state=n)}constructor(){super(),te(this,"_state",Ws.IDLE),te(this,"isAccessMicrophonePermission",!1),te(this,"isAccessCameraPermission",!1),te(this,"lastAccessMicrophonePermission",!1),te(this,"lastAccessCameraPermission",!1),te(this,"checkdeviceMatched",!1),te(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(B("ENUMERATE_DEVICES_INTERVAL")||(fl()||nb()===Br.HARMONY_OS)&&xu())&&this.updateDevicesInfo()},B("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>I.error(n.toString()))}async enumerateDevices(n,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new L(M.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i),a=!this.isAccessMicrophonePermission&&n,s=!this.isAccessCameraPermission&&e;r.audio&&(a=!1),r.video&&(s=!1);let o=null,c=null,d=null;if(!t&&(a||s)){if(bO.isLocked&&(I.debug("[device manager] wait GUM lock"),(await bO.lock())(),I.debug("[device manager] GUM unlock")),AO&&(a=!1,this.isAccessMicrophonePermission=!0),O1&&(s=!1,this.isAccessCameraPermission=!0),I.debug("[device manager] check media device permissions",n,e,a,s),a&&s){try{d=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(l){let h=IO(l.name||l.code||l,l.message);if(h.code===M.PERMISSION_DENIED)throw h;I.warning("getUserMedia failed in getDevices",h)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{o=await navigator.mediaDevices.getUserMedia({audio:n})}catch(l){let h=IO(l.name||l.code||l,l.message);if(h.code===M.PERMISSION_DENIED)throw h;I.warning("getUserMedia failed in getDevices",h)}this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({video:e})}catch(l){let h=IO(l.name||l.code||l,l.message);if(h.code===M.PERMISSION_DENIED)throw h;I.warning("getUserMedia failed in getDevices",h)}this.isAccessCameraPermission=!0}I.debug("[device manager] mic permission",n,"cam permission",e)}try{let l=await navigator.mediaDevices.enumerateDevices();return o&&o.getTracks().forEach(h=>h.stop()),c&&c.getTracks().forEach(h=>h.stop()),d&&d.getTracks().forEach(h=>h.stop()),o=null,c=null,d=null,l}catch(l){return o&&o.getTracks().forEach(h=>h.stop()),c&&c.getTracks().forEach(h=>h.stop()),d&&d.getTracks().forEach(h=>h.stop()),o=null,c=null,d=null,new L(M.ENUMERATE_DEVICES_FAILED,l.toString()).throw()}}async getRecordingDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,n)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(n){let e=null;return this.deviceInfoMap.forEach(t=>{t.device.label===n&&(e=t.device.deviceId)}),e}async getDeviceById(n){let e=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===n);if(!e)throw new L(M.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return e}async init(){this.state=Ws.INITING;try{await this.updateDevicesInfo(),this.state=Ws.INITEND}catch(n){throw I.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=Ws.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new L(M.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){let n=await this.enumerateDevices(!0,!0,!0),e=Date.now(),t=[];if(n[0]&&n[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let r=n.find(s=>s.kind==="audioinput"&&s.deviceId==="default"),a=n.find(s=>s.kind==="audiooutput"&&s.deviceId==="default");r&&a?a.groupId===r.groupId?I.debug("[device-check] default input ".concat(r.label," and output ").concat(a.label," is the same group")):I.debug("[device-check] default input ".concat(r.label," and output ").concat(a.label," is not the same group")):I.debug("[device-check] default input or output not found")}let i=this.checkMediaDeviceInfoIsOk(n);if(n.forEach(r=>{if(!r.deviceId)return;let a=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){let s={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),s),t.push(s)}a&&(a.updateAt=e)}),this.deviceInfoMap.forEach((r,a)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",t.push(r))}),this.state!==Ws.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));t.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Bu.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Bu.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Bu.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(n){let e=n.filter(r=>r.kind==="audioinput"),t=n.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(let r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(let r of t)if(r.label&&r.deviceId){i.video=!0;break}return i}},Uo=!1,xo=new class extends Sr{constructor(){super(...arguments),te(this,"onAutoplayFailed",void 0),te(this,"onAudioAutoplayFailed",void 0)}};function pc(){if(pi(),!Uo){let n=e=>{e.preventDefault(),Uo=!1,tE()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};Uo=!0,tE()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),I.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),xo.onAutoplayFailed?xo.onAutoplayFailed():xo.onAudioAutoplayFailed?I.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):I.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),xo.emit("autoplay-failed")}}function N1(n,e,t,i){if(!n)return;let r=Te.getBaseInfoBySessionId(n);if(!r)return;let a=r.info,s=Date.now(),o=Qi(Qi({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:s,elapse:s-r.startTime,cbRegistered:xo.onAutoplayFailed||xo.onAudioAutoplayFailed?1:-1,errorMsg:t,mediaType:e,trackId:i,extend:void 0});Te.send({type:qt.AUTOPLAY_FAILED,data:o},!0)}let DB=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],uo=new class{constructor(){te(this,"onAutoplayFailed",void 0),te(this,"elementMap",new Map),te(this,"elementStateMap",new Map),te(this,"elementsNeedToResume",[]),te(this,"sinkIdMap",new Map),te(this,"autoResumeAfterInterruption",n=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,i]=e,r=this.elementStateMap.get(t),a=i.srcObject.getAudioTracks()[0],s=a&&a.readyState;if(I.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(s," ").concat(n)),s==="live"){if(n)return i.pause(),void i.play();if(li.curState==="running")return Rg()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[e,t]=n,i=t.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(I.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),t.pause(),t.play())})}),this.autoResumeAudioElement(),li.on(sa.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),li.on(sa.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),li.on(sa.STATE_CHANGE,()=>{Ci()&&li.prevState==="suspended"&&li.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(n,e){let t=this.elementMap.get(n);if(this.sinkIdMap.set(n,e),t)try{await t.setSinkId(e)}catch(i){throw new L(M.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(n,e,t,i){if(this.elementMap.has(e))return;let r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([n]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,Mn.INIT),this.setVolume(e,t);let a=this.sinkIdMap.get(e);if(a)try{r.setSinkId(a).catch(o=>{I.warning("[".concat(e,"] set sink id failed"),o.toString())})}catch(o){I.warning("[".concat(e,"] set sink id failed"),o.toString())}let s=r.play();s&&s.then&&s.catch(o=>{i&&N1(i,"audio",o.message,e),I.warning("audio element play warning",o.toString()),this.elementMap.has(e)&&o.name==="NotAllowedError"&&(I.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),i_(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),pc()}))})}updateTrack(n,e){let t=this.elementMap.get(n);t&&(t.srcObject=new MediaStream([e]))}isPlaying(n){return this.elementMap.has(n)&&this.elementStateMap.get(n)==="playing"}setVolume(n,e){let t=this.elementMap.get(n);t&&(e=Math.max(0,Math.min(100,e)),t.volume=e/100)}stop(n){let e=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!e)return;let t=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(t,1),e.srcObject=null,e.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,e){DB.forEach(t=>{e.addEventListener(t,i=>{let r=this.elementStateMap.get(n),a=i.type==="pause"?"paused":i.type;if(I.debug("[".concat(n,"] audio-element-status change ").concat(r," => ").concat(a)),i.type==="error"){let s=e?.error;s&&I.error("[".concat(n,"] media error, code: ").concat(s.code,", message: ").concat(s.message))}this.elementStateMap.set(n,a)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){let n=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(t=>{I.debug("Auto resume audio element success")}).catch(t=>{I.warning("Auto resume audio element failed!",t)})}),this.elementsNeedToResume=[]};new se(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{tE()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function ki(){return function(n,e,t){let i=t.value;return typeof i=="function"&&(t.value=function(){this._isClosed&&new L(M.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",I);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];let o=i.apply(this,a);return o instanceof se?new se((c,d)=>{o.then(c).catch(d)}):o}),t}}class zr extends Sr{constructor(e){super(),te(this,"name","VideoProcessorDestination"),te(this,"ID","0"),te(this,"_source",void 0),te(this,"videoContext",void 0),te(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new L(M.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new L(M.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Cs.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Cs.ON_TRACK,void 0)}}class D1 extends Sr{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),te(this,"constraintsMap",new Map),te(this,"statsRegistry",[]),te(this,"usageRegistry",[]),te(this,"trackId",void 0),te(this,"direction",void 0),te(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await kn(this,nn.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var i;return I.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),zt(this,nn.REQUEST_UPDATE_CONSTRAINTS,Array.from(tn(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return I.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),zt(this,nn.REQUEST_UPDATE_CONSTRAINTS,Array.from(tn(t=this.constraintsMap).call(t)))}registerStats(e,t,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:i})}unregisterStats(e,t){let i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:i,type:r,cb:a}of this.statsRegistry)try{let s=a();e.push({processorID:t,processorName:i,type:r,stats:s})}catch(s){I.error(new L(M.UNEXPECTED_ERROR,s.message))}return e}registerUsage(e,t){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let i=t();i instanceof se&&(i=await i),e.push(Qi(Qi({},i),{},{direction:this.direction}))}catch(i){I.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class P1 extends Sr{constructor(e){super(),te(this,"name","AudioProcessorDestination"),te(this,"ID","0"),te(this,"inputTrack",void 0),te(this,"inputNode",void 0),te(this,"audioProcessorContext",void 0),te(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new L(M.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new L(M.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Cs.ON_TRACK,void 0),this.emit(Cs.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Cs.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Cs.ON_NODE,this.inputNode))}}class L1 extends Sr{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,i){super(),te(this,"constraintsMap",new Map),te(this,"statsRegistry",[]),te(this,"audioContext",void 0),te(this,"trackId",void 0),te(this,"direction",void 0),te(this,"usageRegistry",[]),te(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=i}async getConstraints(){return kn(this,nn.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var i;return I.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),zt(this,nn.REQUEST_UPDATE_CONSTRAINTS,Array.from(tn(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),zt(this,nn.REQUEST_UPDATE_CONSTRAINTS,Array.from(tn(t=this.constraintsMap).call(t)))}registerStats(e,t,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:i})}unregisterStats(e,t){let i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:i,type:r,cb:a}of this.statsRegistry)try{let s=a();e.push({processorID:t,processorName:i,type:r,stats:s})}catch(s){I.error(new L(M.UNEXPECTED_ERROR,s.message))}return e}registerUsage(e,t){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let i=t();i instanceof se&&(i=await i),e.push(Qi(Qi({},i),{},{direction:this.direction}))}catch(i){I.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class wO extends Sr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),te(this,"context",void 0),te(this,"processSourceNode",void 0),te(this,"outputTrack",void 0),te(this,"processedNode",void 0),te(this,"clonedTrack",void 0),te(this,"outputNode",void 0),this.outputNode=new k1}setVolume(){}createOutputTrack(){throw new L(M.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class k1{disconnect(){}connect(){}}function PB(n){return new se((e,t)=>{let i=!1,r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);let a=Ci()?"canplay":"playing";r.addEventListener(a,()=>{let s=r.videoWidth,o=r.videoHeight;!s&&jr()||(i=!0,r.srcObject=null,r.remove(),e([s,o]))}),r.srcObject=new MediaStream([n]),r.play().catch(Yh),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function Tb(n){let e={};n.facingMode&&(e.facingMode=n.facingMode),n.cameraId&&(e.deviceId={exact:n.cameraId});let t=gl(n.encoderConfig);return t.width!=null&&(e.width=t.width),t.height!=null&&(e.height=t.height),!h1()&&t.frameRate&&(e.frameRate=t.frameRate),d1()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),jr()&&(e.frameRate={ideal:30,max:30}),e}function Rb(n){let e={};return h1()||(n.AGC!==void 0&&(e.autoGainControl=n.AGC),n.AEC!==void 0&&(e.echoCancellation=n.AEC),n.ANS!==void 0&&(e.noiseSuppression=n.ANS,_l()&&n.ANS&&(e.googHighpassFilter=n.ANS))),e}function M1(n){let e=Rb(n);if(n.encoderConfig){let t=vO(n.encoderConfig);e.channelCount=t.stereo?2:1,e.sampleRate=t.sampleRate,e.sampleSize=t.sampleSize}return n.microphoneId&&(e.deviceId={exact:n.microphoneId}),fl()&&(e.sampleRate=void 0),e}let LB=n=>{let e=n._encoderConfig;if(!e)return;let{frameRate:t,width:i,height:r}=n.getMediaStreamTrackSettings(),{frameRate:a=t,width:s=i,height:o=r}=e;if(!a||!s||!o)return;s=yg(s),o=yg(o),a=yg(a);let{max:c,min:d}=(function(f,m,S){let T=200*Math.pow(S/15,.6)*Math.pow(f*m/640/360,.75);return{min:Math.floor(T),max:Math.floor(4*T)}})(s,o,a),{bitrateMax:l,bitrateMin:h}=e||{};l||I.debug("calculate bitrate: [w: ".concat(s,", h: ").concat(o,", fps: ").concat(a,"] => [brMax: ").concat(l,", brMin: ").concat(h,"]"));let{maxFramerate:_}=B("ENCODER_CONFIG_LIMIT");return _&&typeof _=="number"&&(a=Math.min(a,_)),{frameRate:a,bitrateMax:l||c,bitrateMin:h||d,scaleResolutionDownBy:1,scale:0}},kB=async(n,e,t)=>await(async(i,r,a)=>{let s=(function(d){let l=[];for(let h=0;h<d.length;h+=2)l.push(parseInt(d.slice(h,h+2),16));return Uint8Array.from(l)})(_O(""+r+a)).slice(0,16),o=s.slice(0,12),c=await window.crypto.subtle.importKey("raw",s,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},c,i))})(n.buffer,e,t),OO=n=>{let e=document.createElement("canvas");return e.width=2,e.height=2,new se((t,i)=>{e.toBlob(async r=>{if(e.remove(),r){let a=await NO(r);t({buffer:a,width:e.width,height:e.height})}else i(new L(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,1)})},NO=async n=>{let e=await n.arrayBuffer();return new Uint8Array(e)};var U1,x1,V1,F1,B1,j1,G1,W1,H1,K1,Y1,z1,q1,X1,J1,Z1,Q1,$1,Dr,Pr,eM,tM,iM,rM,nM,ju,Gu,aM,sM,oM,cM,dM,lM,uM,hM,pM,_M,fM,EM,Ca;let Ti=(U1=pt({argsMap:(n,e)=>[n.getTrackId(),e],throttleTime:300}),x1=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),V1=ki(),F1=Wn("LocalAudioTrack","_enabledMutex"),B1=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),j1=ki(),G1=Wn("LocalAudioTrack","_enabledMutex"),W1=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),H1=ki(),K1=ki(),Y1=ki(),z1=pt({argsMap:n=>[n.getTrackId()]}),q1=ki(),X1=pt({argsMap:n=>[n.getTrackId()]}),J1=ki(),Z1=pt({argsMap:n=>[n.getTrackId()]}),Q1=pt({argsMap:(n,e)=>[n.getTrackId(),e.name]}),$1=pt({argsMap:n=>[n.getTrackId()]}),si((Dr=class extends Ig{get _source(){return this.initWebAudio()}set _source(n){this._trackSource=n}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?uo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(n,e,t,i){super(n,t),te(this,"trackMediaType",Gs.AUDIO),te(this,"_encoderConfig",void 0),te(this,"_trackSource",void 0),te(this,"metadata",[]),te(this,"_enabled",!0),te(this,"_volume",100),te(this,"_useAudioElement",!0),te(this,"_bypassWebAudio",!1),te(this,"processor",void 0),te(this,"_processorContext",void 0),te(this,"_processorDestination",void 0),te(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new wO,B("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),dn()&&!uc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(n){Bt(n,"volume",0,1e3),this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&uo.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void I.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,zt(this,Je.NEED_REPLACE_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(t=>{I.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),t)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(n){if(!this._useAudioElement||!Si())throw new L(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");await uo.setSinkID(this.getTrackId(),n)}async setEnabled(n,e,t){return this._setEnabled(n,e,t)}async _setEnabled(n,e,t){if(!t){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){this._originMediaStreamTrack.enabled=!0;try{t||(this._enabled=!0),await zt(this,Je.NEED_ENABLE_TRACK,this),I.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(n," success"))}catch(i){throw t||(this._enabled=!1),I.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,t||(this._enabled=!1);try{await zt(this,Je.NEED_DISABLE_TRACK,this)}catch(i){throw t||(this._enabled=!0),I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,I.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await zt(this,Je.NEED_MUTE_TRACK,this):await zt(this,Je.NEED_UNMUTE_TRACK,this))}getStats(){return r_(()=>{I.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),fi(this,Je.GET_STATS)||Qi({},Mo)}setAudioFrameCallback(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!n)return this._source.removeAllListeners(ys.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ys.ON_AUDIO_BUFFER),this._source.on(ys.ON_AUDIO_BUFFER,t=>n(t))}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] start audio playback in element")),uo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?uo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let n=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&uo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(n,e){this._originMediaStreamTrack!==n&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:n,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zt(this,Je.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(n))}renewMediaStreamTrack(n){return se.resolve(void 0)}pipe(n){if(this._bypassWebAudio)throw new L(M.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===n)return n;if(n._source)throw new L(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(!this.processor)return;let e=this.processor;(n=this._source.processSourceNode)===null||n===void 0||n.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(n){n.on(Cs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await zt(this,Je.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zt(this,Je.NEED_REPLACE_TRACK,this))}),n.on(Cs.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(n){n.removeAllListeners(Cs.ON_TRACK),n.removeAllListeners(Cs.ON_NODE)}bindProcessorContextEvents(n){n.on(nn.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(n){n.removeAllListeners(nn.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof wO&&(this._trackSource=new I1(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let n=new L1(this._source.context,this.getTrackId(),"local"),e=new P1(n);return this._processorContext=n,this._processorDestination=e,this.bindProcessorContextEvents(n),this.bindProcessorDestinationEvents(e),this._source.on(ys.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:n})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(uo.stop(this.getTrackId()),this._source.play()),zt(this,Je.NEED_REPLACE_MIXING_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(t=>{I.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),t)})),{processorContext:n,processorDestination:e}}}).prototype,"setVolume",[U1],Object.getOwnPropertyDescriptor(Dr.prototype,"setVolume"),Dr.prototype),si(Dr.prototype,"setPlaybackDevice",[x1,V1],Object.getOwnPropertyDescriptor(Dr.prototype,"setPlaybackDevice"),Dr.prototype),si(Dr.prototype,"setEnabled",[F1,B1,j1],Object.getOwnPropertyDescriptor(Dr.prototype,"setEnabled"),Dr.prototype),si(Dr.prototype,"setMuted",[G1,W1,H1],Object.getOwnPropertyDescriptor(Dr.prototype,"setMuted"),Dr.prototype),si(Dr.prototype,"getStats",[K1],Object.getOwnPropertyDescriptor(Dr.prototype,"getStats"),Dr.prototype),si(Dr.prototype,"setAudioFrameCallback",[Y1],Object.getOwnPropertyDescriptor(Dr.prototype,"setAudioFrameCallback"),Dr.prototype),si(Dr.prototype,"play",[z1,q1],Object.getOwnPropertyDescriptor(Dr.prototype,"play"),Dr.prototype),si(Dr.prototype,"stop",[X1,J1],Object.getOwnPropertyDescriptor(Dr.prototype,"stop"),Dr.prototype),si(Dr.prototype,"close",[Z1],Object.getOwnPropertyDescriptor(Dr.prototype,"close"),Dr.prototype),si(Dr.prototype,"pipe",[Q1],Object.getOwnPropertyDescriptor(Dr.prototype,"pipe"),Dr.prototype),si(Dr.prototype,"unpipe",[$1],Object.getOwnPropertyDescriptor(Dr.prototype,"unpipe"),Dr.prototype),Dr),yr=(Pr=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),eM=ki(),tM=Wn("MicrophoneAudioTrack","_enabledMutex"),iM=pt({argsMap:(n,e,t)=>[n.getTrackId(),e,t]}),rM=ki(),nM=pt({argsMap:n=>[n.getTrackId()]}),si((ju=class extends Ti{get __className__(){return"MicrophoneAudioTrack"}constructor(n,e,t,i){super(n,e.encoderConfig?vO(e.encoderConfig):{},i,B("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),te(this,"_config",void 0),te(this,"_deviceName","default"),te(this,"_constraints",void 0),te(this,"_originalConstraints",void 0),te(this,"_enabled",!0),this._config=e,this._constraints=t,this._originalConstraints=t,this._deviceName=n.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Rg()||eE())&&li.bindInterruptDetectorTrack(this)}async setDevice(n){if(I.info("[".concat(this.getTrackId(),"] start set device to ").concat(n)),this._enabled)try{let e=await bs.getDeviceById(n),t={};t.audio=Qi({},this._constraints),t.audio.deviceId={exact:n},this._originMediaStreamTrack.stop();let i=null;try{i=await hc(t,this.getTrackId())}catch(r){throw I.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await hc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(e){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{let e=await bs.getDeviceById(n);this._deviceName=e.label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(e){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}I.info("[".concat(this.getTrackId(),"] set device to ").concat(n," success"))}async setEnabled(n,e,t){if(e)return I.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(n);if(!t){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),n),B("AUTO_RESET_AUDIO_ROUTE")&&(Ci()||Id())){let s=navigator.audioSession;s&&(n||(s.type="playback"),s.type="auto")}if(!n){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),t||(this._enabled=!1);try{await zt(this,Je.NEED_DISABLE_TRACK,this)}catch(s){throw I.error("[".concat(this.getTrackId(),"] setEnabled false failed"),s.toString()),s}return}let r=Qi({},this._constraints),a=bs.searchDeviceIdByName(this._deviceName);a&&!r.deviceId&&(r.deviceId=a);try{t||(this._enabled=!0);let s=await hc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),await zt(this,Je.NEED_ENABLE_TRACK,this)}catch(s){throw t||(this._enabled=!1),I.error("[".concat(this.getTrackId(),"] setEnabled true failed"),s.toString()),s}I.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Rg()||eE())&&li.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ci()||Id())&&this._enabled&&!this._isClosed&&li.duringInterruption){let n=async()=>{li.off(sa.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};li.on(sa.IOS_INTERRUPTION_END,n)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}async renewMediaStreamTrack(n){let e=n||this._constraints,t=bs.searchDeviceIdByName(this._deviceName);if(t&&!e.deviceId&&(e.deviceId=t),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();let i=await hc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(n){super.bindProcessorContextEvents(n),n.on(nn.REQUEST_UPDATE_CONSTRAINTS,async(e,t,i)=>{try{let r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(r){i(r)}})}unbindProcessorContextEvents(n){super.unbindProcessorContextEvents(n),n.removeAllListeners(nn.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Pr,eM],Object.getOwnPropertyDescriptor(ju.prototype,"setDevice"),ju.prototype),si(ju.prototype,"setEnabled",[tM,iM,rM],Object.getOwnPropertyDescriptor(ju.prototype,"setEnabled"),ju.prototype),si(ju.prototype,"close",[nM],Object.getOwnPropertyDescriptor(ju.prototype,"close"),ju.prototype),ju),vb=(Gu=pt({argsMap:(n,e)=>[n.getTrackId(),e,n.duration]}),aM=ki(),sM=pt({argsMap:n=>[n.getTrackId()]}),oM=ki(),cM=pt({argsMap:n=>[n.getTrackId()]}),dM=ki(),lM=pt({argsMap:n=>[n.getTrackId()]}),uM=ki(),hM=pt({argsMap:n=>[n.getTrackId()]}),pM=ki(),_M=pt({argsMap:n=>[n.getTrackId()]}),fM=pt({argsMap:n=>[n.getTrackId()]}),EM=ki(),si((Ca=class extends Ti{get __className__(){return"BufferSourceAudioTrack"}constructor(n,e,t,i){super(e.createOutputTrack(),t,i),te(this,"source",void 0),te(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=n,this._bufferSource=e,this._bufferSource.on(ys.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(Sl.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(n){this._bufferSource.seekAudioBuffer(n)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(n){Bt(n,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(n)}}).prototype,"startProcessAudioBuffer",[Gu,aM],Object.getOwnPropertyDescriptor(Ca.prototype,"startProcessAudioBuffer"),Ca.prototype),si(Ca.prototype,"pauseProcessAudioBuffer",[sM,oM],Object.getOwnPropertyDescriptor(Ca.prototype,"pauseProcessAudioBuffer"),Ca.prototype),si(Ca.prototype,"seekAudioBuffer",[cM,dM],Object.getOwnPropertyDescriptor(Ca.prototype,"seekAudioBuffer"),Ca.prototype),si(Ca.prototype,"resumeProcessAudioBuffer",[lM,uM],Object.getOwnPropertyDescriptor(Ca.prototype,"resumeProcessAudioBuffer"),Ca.prototype),si(Ca.prototype,"stopProcessAudioBuffer",[hM,pM],Object.getOwnPropertyDescriptor(Ca.prototype,"stopProcessAudioBuffer"),Ca.prototype),si(Ca.prototype,"close",[_M],Object.getOwnPropertyDescriptor(Ca.prototype,"close"),Ca.prototype),si(Ca.prototype,"setAudioBufferPlaybackSpeed",[fM,EM],Object.getOwnPropertyDescriptor(Ca.prototype,"setAudioBufferPlaybackSpeed"),Ca.prototype),Ca);class Un extends Ti{get __className__(){return"MixingAudioTrack"}get isActive(){for(let e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){let e=Li().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Ht(8,"track-mix-")),te(this,"trackList",void 0),te(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(I.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):I.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){I.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}Zr(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){let e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof Un?t.emit(Ag.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class xn extends A1{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(ys.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),te(this,"audioBuffer",void 0),te(this,"sourceNode",void 0),te(this,"startPlayTime",0),te(this,"startPlayOffset",0),te(this,"pausePlayTime",0),te(this,"options",void 0),te(this,"currentLoopCount",0),te(this,"currentPlaybackSpeed",100),te(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):I.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let MB=new Map;function mM(n,e){if(n.length===0||e.length===0)return 1/0;let t=rE(n),i=rE(e);return Math.floor(i/t)}class DO{get rendFrameRate(){let e=Math.max(1,mM(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Mn.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(I.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,(t=this.onVideoStateChanged)===null||t===void 0||t.call(this,this.videoState))}constructor(e){te(this,"trackId",void 0),te(this,"config",void 0),te(this,"onFirstVideoFrameDecoded",void 0),te(this,"onFirstVideoFrameRender",void 0),te(this,"onVideoStateChanged",void 0),te(this,"freezeTimeCounterList",[]),te(this,"renderFreezeAccTime",0),te(this,"renderFreezeAccTime2",0),te(this,"isKeepLastFrame",!1),te(this,"isDestroyed",!1),te(this,"timeUpdatedCount",0),te(this,"freezeTime",0),te(this,"playbackTime",0),te(this,"lastTimeUpdatedTime",0),te(this,"autoplayFailed",!1),te(this,"videoTrack",void 0),te(this,"videoElement",void 0),te(this,"cacheVideoElement",void 0),te(this,"internal",!1),te(this,"_render_interframe_delays",[]),te(this,"_render_interframe_delays_sizes",[]),te(this,"_videoState",un.VideoStateStopped),te(this,"videoElementCheckInterval",void 0),te(this,"videoElementFreezeTimeout",void 0),te(this,"_videoElementStatus",Mn.NONE),te(this,"_isInPage",!0),te(this,"isGettingVideoDimensions",!1),te(this,"startGetVideoDimensions",()=>{let t=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return I.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t,500)};!this.isGettingVideoDimensions&&t()}),te(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&li.curState==="running"&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ab())),aO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),te(this,"handleVideoEvents",t=>{switch(t.type){case"play":case"playing":t.type==="play"&&I.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Mn.PLAYING;break;case"loadeddata":if(this.videoState=un.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Mn.CANPLAY;break;case"stalled":this.videoElementStatus=Mn.STALLED;break;case"suspend":this.videoElementStatus=Mn.SUSPEND;break;case"pause":this.videoElementStatus=Mn.PAUSED,Ci()||Id()||dn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Mn.WAITING;break;case"abort":this.videoElementStatus=Mn.ABORT;break;case"ended":this.videoElementStatus=Mn.ENDED;break;case"emptied":this.videoElementStatus=Mn.EMPTIED;break;case"error":{let i=this.videoElement.error;i&&(this.videoElementStatus=Mn.ERROR,I.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{let i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);let r=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,fc.lastVisibleTime<fc.lastHiddenTime||a<fc.lastHiddenTime||a<fc.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(r>B("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;let s=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(s),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ab())),aO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),li.on(sa.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),li.on(sa.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch(r=>{e&&N1(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(I.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):I.warning("[".concat(this.trackId,"] play warning: "),r)});let i=pi();if((i.name==="Safari"&&Number(i.version)===15||Rg())&&t&&t.then){let r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(r).catch(r)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return I.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let i=t.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;let r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new se((a,s)=>{i.toBlob(async o=>{if(i.remove(),o){let c=await NO(o);a({buffer:c,width:i.width,height:i.height})}else s(new L(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await OO(e)}destroy(){this.isDestroyed=!0,li.off(sa.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),li.off(sa.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=un.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Mn.INIT,!this.videoElementCheckInterval&&(PO.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)},1e3),B("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let a,s=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",s),this.videoElementFreezeTimeout=window.setTimeout(o,B("VIDEO_FREEZE_DURATION")))},o=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===un.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=un.VideoStateFrozen:document.addEventListener("visibilitychange",s))},c=(d,l)=>{if(this.videoElementStatus===Mn.PLAYING){if(a){let f=l.presentationTime-a.presentationTime,m=l.presentedFrames-a.presentedFrames;this._render_interframe_delays_sizes.push(m),this._render_interframe_delays.push(f);let S=rE(this._render_interframe_delays_sizes),T=S-this._render_interframe_delays_sizes[0];if(S>30&&T>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===un.VideoStateStarting&&(this.videoState=un.VideoStateDecoding),this.videoState===un.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(o,B("VIDEO_FREEZE_DURATION"))),f<B("VIDEO_FREEZE_DURATION")&&this.videoState===un.VideoStateFrozen&&(this.videoState=un.VideoStateDecoding),f>B("VIDEO_FREEZE_DURATION")&&fc.lastVisibleTime>=fc.lastHiddenTime&&a.timestamp>fc.lastVisibleTime&&a.timestamp>fc.lastHiddenTime){let R=Math.min(66,mM(this._render_interframe_delays_sizes,this._render_interframe_delays)),C=Math.max(0,f-(m-1)*R);this.renderFreezeAccTime2+=C>R?C:0,this.renderFreezeAccTime+=f}}a=Qi(Qi({},l),{},{timestamp:d})}else this.isSkipCalcRenderFreezeTime()&&(a=Qi(Qi({},l),{},{timestamp:d}));var h,_;B("ENABLE_VIDEO_FRAME_CALLBACK")&&((h=(_=this.videoElement).requestVideoFrameCallback)===null||h===void 0||h.call(_,c))};(e=(t=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(t,c)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),fl()&&!B("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let i=pi();i.name==="Safari"&&Number(i.version)===15||Rg()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jr()&&this.videoElement.load());let r=this.videoElement.play();r!==void 0&&r.catch(a=>{I.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){PO.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Mn.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Mn.DESTROYED||this.internal}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{I.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{I.error(i)}),this.autoplayFailed=!1,tE()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};tE()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),pc()}}let PO=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class LO extends DO{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(e),te(this,"container",void 0),te(this,"slot",void 0),this.slot=e.element,this.internal=t,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;var i;!this.internal||this.slot?(t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()):(this.slot=t,t&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await OO(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),(e=this.slot)===null||e===void 0||e.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",B("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(e=this.slot)===null||e===void 0||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var kO,gM,SM,TM,RM,vM,yM,CM,bM,AM,IM,wM,OM,NM,DM,PM,LM,kM,MM,UM,xM,VM,FM,BM,jM,GM,WM,HM,Zt,Qt,KM,YM,zM,qM,XM,JM,ZM,_c;let Ai=(kO=pt({argsMap:(n,e,t)=>[n.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",t]}),gM=ki(),SM=pt({argsMap:n=>[n.getTrackId()]}),TM=Wn("LocalVideoTrack","_enabledMutex"),RM=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),vM=ki(),yM=Wn("LocalVideoTrack","_enabledMutex"),CM=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),bM=ki(),AM=pt({argsMap:(n,e)=>[n.getTrackId(),e,n._saveEncodeBitrateRatio]}),IM=ki(),wM=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),OM=ki(),NM=ki(),DM=pt({argsMap:(n,e,t)=>[n.getTrackId(),e,t]}),PM=ki(),LM=ki(),kM=ki(),MM=pt({argsMap:n=>[n.getTrackId()]}),UM=ki(),xM=ki(),VM=ki(),FM=ki(),BM=ki(),jM=pt({argsMap:(n,e)=>[n.getTrackId(),e.name]}),GM=pt({argsMap:n=>[n.getTrackId()]}),WM=pt({argsMap:n=>[n.getTrackId()]}),HM=pt({argsMap:(n,e,t)=>[n.getTrackId(),e.label,t]}),Zt=class G8 extends Ig{get videoHeight(){if(dn()){let{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(dn()){let{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Mn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,i,r,a,s){if(super(e,a),te(this,"trackMediaType",Gs.VIDEO),te(this,"_player",void 0),te(this,"isUseScaleResolutionDownBy",!1),te(this,"_videoVisibleTimer",null),te(this,"_previousVideoVisibleStatus",void 0),te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),te(this,"_encoderConfig",void 0),te(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),te(this,"_optimizationMode",void 0),te(this,"_saveEncodeBitrateRatio",1),te(this,"_videoHeight",void 0),te(this,"_videoWidth",void 0),te(this,"_forceBitrateLimit",void 0),te(this,"_enabled",!0),te(this,"_processorDestination",void 0),te(this,"_processorContext",void 0),dn()){let{width:o,height:c}=e.getSettings();this._videoWidth=o,this._videoHeight=c}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=r,this._hints=s||[],t&&this._hints.indexOf(Oe.CUSTOM_TRACK)!==-1?this._encoderConfig=cr(t):this._encoderConfig=t,this._hints.indexOf(Oe.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(tO(Ot.CHROME,115)&&nb().indexOf("Windows")!==-1){let o=(function(c,d){if("VideoFrame"in window&&"TransformStream"in window&&Nt().supportWebRTCInsertableStream){let l=new MediaStreamTrackProcessor(c),h=new MediaStreamTrackGenerator({kind:"video"}),_,f,m=Date.now(),S=()=>{T&&(clearInterval(T),T=void 0),_&&(_.close(),_=void 0),c.stop(),f=void 0,h.removeEventListener("ended",S)},T=window.setInterval(()=>{if(f&&_&&Date.now()-m>1e3)try{h.readyState==="live"?f.enqueue(_.clone()):S()}catch{S()}},1e3),R=new TransformStream({transform:(C,b)=>{h.readyState==="live"?(f=b,m=Date.now(),_===void 0?(_=C,b.enqueue(C.clone())):(b.enqueue(_),_=C)):C.close()}});return h.addEventListener("ended",S),l.readable.pipeThrough(R).pipeTo(h.writable),h}})(e);o&&(I.info("local screen video track begin to inject frame"),this._mediaStreamTrack=o)}t&&this._hints.indexOf(Oe.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(t),this._processorContext=new D1(this.getTrackId(),"local"),this._processorDestination=new zr(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let r=document.getElementById(e);r?e=r:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let i=Qi(Qi(Qi({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new DO(i):this._player=new LO(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let r=this.getVideoElementVisibleStatus();this.safeEmit(Sl.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await zt(this,Je.NEED_DISABLE_TRACK,this)}catch(i){throw I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return t||(this._enabled=!1),void I.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await zt(this,Je.NEED_ENABLE_TRACK,this)}catch(i){throw I.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}I.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,I.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await zt(this,Je.NEED_MUTE_TRACK,this):await zt(this,Je.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),I.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await zt(this,Je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(I)}}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new L(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=gl(e),B("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){let i=Tb({encoderConfig:e});(dn()||Ci()||Id())&&(i.deviceId=void 0),I.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){let a=new L(M.UNEXPECTED_ERROR,r.toString());throw I.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=e,this._hints.indexOf(Oe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await zt(this,Je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(I)}}getStats(){return r_(()=>{I.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),fi(this,Je.GET_STATS)||Qi({},gb)}async setBeautyEffect(e){I.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await OO(e)}async findClosestProfile(){let{width:e,height:t,frameRate:i}=this.getMediaStreamTrackSettings(),{width:r,height:a,frameRate:s}=this._encoderConfig||{},o=yg(this._videoWidth||e||r||0),c=yg(this._videoHeight||t||a||0),d=(function(l,h,_){if(!Array.isArray(B("VIDEO_ENCODER_CONFIG_LIST"))||B("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let f=Math.min(l,h);return!(f>=480)&&Qi(Qi({},B("VIDEO_ENCODER_CONFIG_LIST").find(m=>m.height>f)),{},{frameRate:_})})(o,c,yg(i||s||15));if(d)return I.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(o,"x").concat(c," => ").concat(JSON.stringify(d))),this.setEncoderConfiguration(d)}async setBitrateLimit(e){I.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void I.error(M.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let t=this._optimizationMode;try{this._optimizationMode=e,await zt(this,Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=t,I.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}I.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return I.error(M.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,I.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){PB(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(Yh)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new L(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");I.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=gl(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Oe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await zt(this,Je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(I)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:e,height:t,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!t||!i)return;let{bitrateMax:r,bitrateMin:a}=this._encoderConfig;if(a==null||r==null){let{max:s,min:o}=(function(c,d,l,h,_){let f=B("BITRATE_ADAPTER_TYPE");if(f==="DEFAULT_BITRATE")return{min:h,max:_};if(_===void 0){let m=Math.floor(200*Math.pow(l/15,.6)*Math.pow(c*d/640/360,.75));_=f==="STANDARD_BITRATE"?4*m:2*m,h=h??m}else h=h??Math.floor(_/10);return{min:h,max:_}})(e,t,i,a,r);if(this._encoderConfig.bitrateMin=o,this._encoderConfig.bitrateMax=s,B("VIDEO_STANDARD_BITRATE_VERSION")&&a==null&&r==null){let[c,d]=(function(l,h,_){let f=4*Math.floor(2e5*Math.pow(_/15,.6)*Math.pow(l*h/230400,.75)),m=l*h,S=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),T=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),R=tn(S).call(S).next().value,C=1;if(S.has(m))R=S.get(m);else{var b;let Q=vt(b=Array.from(S.entries())).call(b,(Ge,xe)=>{let[qe]=Ge,[ot]=xe;return qe-ot}),he=Q.find(Ge=>{let[xe]=Ge;return xe>m});if(he){let Ge=Q.indexOf(he);if(Ge>0){let xe=Q[Ge-1],qe=(m-xe[0])/(he[0]-xe[0]);R=xe[1]+qe*(he[1]-xe[1])}else R=he[1]}else R=Q[Q.length-1][1]}if(T.has(m))C=T.get(m);else{var N;let Q=vt(N=Array.from(T.entries())).call(N,(Ge,xe)=>{let[qe]=Ge,[ot]=xe;return qe-ot}),he=Q.find(Ge=>{let[xe]=Ge;return xe>m});if(he){let Ge=Q.indexOf(he);if(Ge>0){let xe=Q[Ge-1],qe=(m-xe[0])/(he[0]-xe[0]);C=xe[1]+qe*(he[1]-xe[1])}else C=he[1]}else C=Q[Q.length-1][1]}let k=B("VIDEO_NEW_BITRATE_RATIO");k&&k>0&&(R=k/100);let P=Math.floor(f*R),U=Math.floor(65e4*Math.pow(l*h/230400,.5)*Math.pow(_/15,.69)),W=P,z=B("VIDEO_STANDARD_BITRATE_VERSION");return z&&z>0&&(z===1?W=f:z===2?W=P:z===3&&(W=U)),[Math.floor(W/1e3),C]})(e,t,i);this._encoderConfig.bitrateMax=c,this._encoderConfig.bitrateMin=o?Math.min(o,c):c,this._saveEncodeBitrateRatio=d,I.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else I.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(i,"] => [brMax: ").concat(s,", brMin: ").concat(o,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,t;let i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i?.parentElement},{element:a,slot:s}=r;if(this.isPlaying&&a instanceof HTMLVideoElement&&s instanceof HTMLElement){let o=oO.checkOneElementVisible(a),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;let d=Te.reportApiInvoke(null,{tag:Gt.TRACER,name:Jr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(i){throw new L(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new L(M.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Qi(Qi({},i),gl(e))),i=qi(i);let r=Ht(8,"track-video-cloned-"),a=new G8(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,qi(this._scalabilityMode),this._optimizationMode,r,qi(this._hints));return e&&i&&a.setEncoderConfiguration(i),I.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(t)),a}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new L(M.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new L(M.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(r_(()=>{Te.reportApiInvoke(null,{name:Jr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Gt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!B("ENABLE_VIDEO_SEI")||!B("ENABLE_ENCODED_TRANSFORM"))return void I.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new L(M.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let t=this.getRTCRtpTransceiver();if(!t)return void I.warning("Video track is not published, SEI can not be send");let i=t.sender.getParameters();if(i.codecs.length===0)return;let r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"||r==="video/h265"?this.safeEmit("sei-to-send",e):I.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Cs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await zt(this,Je.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zt(this,Je.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cs.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(nn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(nn.REQUEST_CONSTRAINTS)}},si(Zt.prototype,"play",[kO,gM],Object.getOwnPropertyDescriptor(Zt.prototype,"play"),Zt.prototype),si(Zt.prototype,"stop",[SM],Object.getOwnPropertyDescriptor(Zt.prototype,"stop"),Zt.prototype),si(Zt.prototype,"setEnabled",[TM,RM,vM],Object.getOwnPropertyDescriptor(Zt.prototype,"setEnabled"),Zt.prototype),si(Zt.prototype,"setMuted",[yM,CM,bM],Object.getOwnPropertyDescriptor(Zt.prototype,"setMuted"),Zt.prototype),si(Zt.prototype,"setSaveEncodeBitrateRatio",[AM,IM],Object.getOwnPropertyDescriptor(Zt.prototype,"setSaveEncodeBitrateRatio"),Zt.prototype),si(Zt.prototype,"setEncoderConfiguration",[wM,OM],Object.getOwnPropertyDescriptor(Zt.prototype,"setEncoderConfiguration"),Zt.prototype),si(Zt.prototype,"getStats",[NM],Object.getOwnPropertyDescriptor(Zt.prototype,"getStats"),Zt.prototype),si(Zt.prototype,"setBeautyEffect",[DM,PM],Object.getOwnPropertyDescriptor(Zt.prototype,"setBeautyEffect"),Zt.prototype),si(Zt.prototype,"getCurrentFrameData",[LM],Object.getOwnPropertyDescriptor(Zt.prototype,"getCurrentFrameData"),Zt.prototype),si(Zt.prototype,"getCurrentFrameImage",[kM],Object.getOwnPropertyDescriptor(Zt.prototype,"getCurrentFrameImage"),Zt.prototype),si(Zt.prototype,"findClosestProfile",[MM,UM],Object.getOwnPropertyDescriptor(Zt.prototype,"findClosestProfile"),Zt.prototype),si(Zt.prototype,"setBitrateLimit",[xM],Object.getOwnPropertyDescriptor(Zt.prototype,"setBitrateLimit"),Zt.prototype),si(Zt.prototype,"setOptimizationMode",[VM],Object.getOwnPropertyDescriptor(Zt.prototype,"setOptimizationMode"),Zt.prototype),si(Zt.prototype,"setScalabiltyMode",[FM],Object.getOwnPropertyDescriptor(Zt.prototype,"setScalabiltyMode"),Zt.prototype),si(Zt.prototype,"updateMediaStreamTrackResolution",[BM],Object.getOwnPropertyDescriptor(Zt.prototype,"updateMediaStreamTrackResolution"),Zt.prototype),si(Zt.prototype,"pipe",[jM],Object.getOwnPropertyDescriptor(Zt.prototype,"pipe"),Zt.prototype),si(Zt.prototype,"unpipe",[GM],Object.getOwnPropertyDescriptor(Zt.prototype,"unpipe"),Zt.prototype),si(Zt.prototype,"close",[WM],Object.getOwnPropertyDescriptor(Zt.prototype,"close"),Zt.prototype),si(Zt.prototype,"replaceTrack",[HM],Object.getOwnPropertyDescriptor(Zt.prototype,"replaceTrack"),Zt.prototype),Zt),Xi=(Qt=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),KM=ki(),YM=Wn("CameraVideoTrack","_enabledMutex"),zM=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),qM=ki(),XM=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),JM=ki(),ZM=pt({argsMap:n=>[n.getTrackId()]}),_c=class W8 extends Ai{get __className__(){return"CameraVideoTrack"}constructor(e,t,i,r,a,s){super(e,gl(t.encoderConfig),r,a,s),te(this,"_config",void 0),te(this,"_originalConstraints",void 0),te(this,"_constraints",void 0),te(this,"_enabled",!0),te(this,"_deviceName","default"),te(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Rg()||eE())&&!(function(){let o=pi();if(o.os!==Br.IOS||!o.osVersion)return!1;let c=o.osVersion.split(".");return Number(c[0])===15&&Number(c[1])>=2})()&&wd()&&this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=gl(this._config.encoderConfig),li.on(sa.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),li.on(sa.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(I.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{let t=await bs.getDeviceById(e),i={};i.video=Qi({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await hc(i,this.getTrackId())}catch(a){throw I.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),r=await hc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await bs.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}I.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){I.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));let t={video:Qi(Qi({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await hc(t,this.getTrackId())}catch(r){throw I.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await hc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Qi({},t.video),I.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let i=await hc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await zt(this,Je.NEED_ENABLE_TRACK,this)}catch(i){throw I.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),I.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await zt(this,Je.NEED_DISABLE_TRACK,this)}catch(i){throw I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}I.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new L(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=gl(e),B("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);let i=cr(this._config);i.encoderConfig=e;let r=Tb(i);(dn()||Ci()||Id())&&(r.deviceId=void 0),I.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(a){let s=new L(M.UNEXPECTED_ERROR,a.toString());throw I.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(Oe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await zt(this,Je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(I)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ci()||Id())&&this._enabled&&!this._isClosed&&li.duringInterruption){let e=async()=>{li.off(sa.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};li.on(sa.IOS_INTERRUPTION_END,e)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,i=bs.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId={exact:i}),this._enabled){let r=await hc({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),li.off(sa.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),li.off(sa.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Qi(Qi({},i),gl(e))),i=qi(i);let r=Ht(8,"track-cam-cloned-"),a=new W8(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,qi(Qi(Qi({},this._config),{},{encoderConfig:i})),qi(this._constraints),qi(this._scalabilityMode),this._optimizationMode,r);return e&&i&&a.setEncoderConfiguration(i),I.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(t)),a}bindProcessorContextEvents(){this.processorContext.on(nn.REQUEST_UPDATE_CONSTRAINTS,async(e,t,i)=>{try{let r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(r){i(r)}}),this.processorContext.on(nn.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},si(_c.prototype,"setDevice",[Qt,KM],Object.getOwnPropertyDescriptor(_c.prototype,"setDevice"),_c.prototype),si(_c.prototype,"setEnabled",[YM,zM,qM],Object.getOwnPropertyDescriptor(_c.prototype,"setEnabled"),_c.prototype),si(_c.prototype,"setEncoderConfiguration",[XM,JM],Object.getOwnPropertyDescriptor(_c.prototype,"setEncoderConfiguration"),_c.prototype),si(_c.prototype,"close",[ZM],Object.getOwnPropertyDescriptor(_c.prototype,"close"),_c.prototype),_c);function sR(n,e,t,i){t.optimizationMode&&(i&&i.width&&i.height?(t.encoderConfig=Qi(Qi({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),t.optimizationMode!=="motion"&&t.optimizationMode!=="detail"||(e.contentHint=t.optimizationMode,e.contentHint===t.optimizationMode?I.debug("[".concat(n,"] set content hint to"),t.optimizationMode):I.debug("[".concat(n,"] set content hint failed")))):I.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}var MO,QM,$M,eU,Hc,Kc,tU,iU,rU,nU,aU,ds;class ls extends $i{getUserId(){return this._userId}constructor(e,t,i,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(Ht(5,""))),te(this,"_userId",void 0),te(this,"_uintId",void 0),te(this,"_isDestroyed",!1),te(this,"store",void 0),te(this,"processor",void 0),te(this,"processorContext",void 0),this._userId=t,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,I.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Og=(MO=pt({argsMap:(n,e,t)=>[n.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",t]}),QM=pt({argsMap:n=>[n.getTrackId()]}),$M=pt({argsMap:(n,e)=>[n.getTrackId(),e.name]}),eU=pt({argsMap:n=>[n.getTrackId()]}),si((Hc=class extends ls{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Mn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(n,e,t,i,r){super(n,e,t,i),te(this,"_videoVisibleTimer",null),te(this,"_previousVideoVisibleStatus",void 0),te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),te(this,"trackMediaType",Gs.VIDEO),te(this,"_videoWidth",void 0),te(this,"_videoHeight",void 0),te(this,"_player",void 0),te(this,"_prePlayer",void 0),te(this,"processorDestination",void 0),te(this,"processorContext",void 0),this._prePlayer=r,this.updateMediaStreamTrackResolution(),this.processorContext=new D1(this.getTrackId(),"remote"),this.processorDestination=new zr(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return r_(()=>{I.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),fi(this,Je.GET_STATS)||Qi({},wB)}play(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(js.PLAY_START),typeof n=="string"){let i=document.getElementById(n);i?n=i:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));let t=Qi(Qi({fit:"cover"},e),{},{trackId:this.getTrackId(),element:n});if(this._player)this._player.updateConfig(t);else{let i=!1,r=!1;n instanceof HTMLVideoElement?(this._player=new DO(t),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,r=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(t)):this._player=new LO(t),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(js.FIRST_FRAME_DECODED),r&&this.safeEmit(js.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=a=>{this.safeEmit(js.VIDEO_STATE_CHANGED,a)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i=this.getVideoElementVisibleStatus();this.safeEmit(js.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(js.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){PB(this._originMediaStreamTrack).then(n=>{let[e,t]=n;this._videoHeight=t,this._videoWidth=e}).catch(Yh)}_updatePlayerSource(){I.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var n,e;let t=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:t?.parentElement},{element:r,slot:a}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&a instanceof HTMLElement){let s=oO.checkOneElementVisible(r),o=Object.assign({},s);if(o.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=o.visible;let c=Te.reportApiInvoke(null,{tag:Gt.TRACER,name:Jr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});o.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(o.reason))}return o}return}catch(t){throw new L(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,t.message)}}pipe(n){if(this.processor===n)return n;if(n._source)throw new L(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;let n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Cs.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cs.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(n){this.emit(Ag.SEI_RECEIVED,n)}}).prototype,"play",[MO],Object.getOwnPropertyDescriptor(Hc.prototype,"play"),Hc.prototype),si(Hc.prototype,"stop",[QM],Object.getOwnPropertyDescriptor(Hc.prototype,"stop"),Hc.prototype),si(Hc.prototype,"pipe",[$M],Object.getOwnPropertyDescriptor(Hc.prototype,"pipe"),Hc.prototype),si(Hc.prototype,"unpipe",[eU],Object.getOwnPropertyDescriptor(Hc.prototype,"unpipe"),Hc.prototype),Hc),Wu=(Kc=pt({argsMap:(n,e)=>[n.getTrackId(),e],throttleTime:300}),tU=pt({argsMap:(n,e)=>[n.getTrackId(),e]}),iU=pt({argsMap:n=>[n.getTrackId()]}),rU=pt({argsMap:n=>[n.getTrackId()]}),nU=pt({argsMap:(n,e)=>[n.getTrackId(),e.name]}),aU=pt({argsMap:n=>[n.getTrackId()]}),si((ds=class extends ls{get isPlaying(){return this._useAudioElement?uo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(n,e,t,i){super(n,e,t,i),te(this,"trackMediaType",Gs.AUDIO),te(this,"_source",void 0),te(this,"_useAudioElement",!0),te(this,"_volume",100),te(this,"processorContext",void 0),te(this,"processorDestination",void 0),te(this,"_played",!1),te(this,"_bypassWebAudio",!1),B("DISABLE_WEBAUDIO")?(this._source=new wO,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new I1(n,!0),B("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ys.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(js.FIRST_FRAME_DECODED)}),this.processorContext=new L1(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new P1(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ys.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!n)return this._source.removeAllListeners(ys.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ys.ON_AUDIO_BUFFER),this._source.on(ys.ON_AUDIO_BUFFER,t=>n(t))}setVolume(n){this._volume=n,this._useAudioElement?uo.setVolume(this.getTrackId(),n):this._source.setVolume(n/100)}async setPlaybackDevice(n){if(!this._useAudioElement||!Si())throw new L(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");await uo.setSinkID(this.getTrackId(),n)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return r_(()=>{I.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),fi(this,Je.GET_STATS)||Qi({},yO)}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] use audio element to play")),uo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?uo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let n=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&uo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(n){if(this._bypassWebAudio)throw new L(M.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===n)return n;if(n._source)throw new L(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(this._bypassWebAudio)throw new L(M.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let e=this.processor;(n=this._source.processSourceNode)===null||n===void 0||n.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Cs.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Cs.ON_NODE,n=>{this._source.processedNode=n;let e=!n;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cs.ON_TRACK),this.processorDestination.removeAllListeners(Cs.ON_NODE)}}).prototype,"setVolume",[Kc],Object.getOwnPropertyDescriptor(ds.prototype,"setVolume"),ds.prototype),si(ds.prototype,"setPlaybackDevice",[tU],Object.getOwnPropertyDescriptor(ds.prototype,"setPlaybackDevice"),ds.prototype),si(ds.prototype,"play",[iU],Object.getOwnPropertyDescriptor(ds.prototype,"play"),ds.prototype),si(ds.prototype,"stop",[rU],Object.getOwnPropertyDescriptor(ds.prototype,"stop"),ds.prototype),si(ds.prototype,"pipe",[nU],Object.getOwnPropertyDescriptor(ds.prototype,"pipe"),ds.prototype),si(ds.prototype,"unpipe",[aU],Object.getOwnPropertyDescriptor(ds.prototype,"unpipe"),ds.prototype),ds),fc=new class extends Sr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),te(this,"_lastHiddenTime",0),te(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),I.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Hu extends Sr{constructor(e,t){super(),te(this,"trackMediaType",Gs.DATA),te(this,"_version",1),te(this,"_type",3),te(this,"_config",void 0),te(this,"_originDataChannel",void 0),te(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),te(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),te(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return B("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new se((e,t)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();let i=setTimeout(()=>{var r;t(new L(M.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new L(M.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new L(M.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[aR.OPEN,aR.CLOSE,aR.ERROR].forEach(t=>{let i=()=>{this.emit(t)};this._datachannelEventMap.set(t,i),e.addEventListener(t,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[i,r]=t;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class UB extends Hu{constructor(e){super(e),te(this,"_messageListener",void 0),this._messageListener=t=>{if(t.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let i=t.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(B("SHOW_DATASTREAM2_LOG")&&I.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let a=t.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(aR.MESSAGE,a)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class X4 extends Hu{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);let i=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function UO(){let n=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Qm.revokeObjectURL(n),0),new Worker(Qm.createObjectURL(n))}let yb=71,xO=1,Cb=2,bb=1,VO=2;var d_=(function(n){return n[n.AUDIO_LEVEL=1]="AUDIO_LEVEL",n[n.METADATA=2]="METADATA",n[n.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",n})(d_||{});function qh(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=n.getUint8(0);if(t!==yb)return;let i=n.getUint16(1),r=xO+Cb+i,a=new Uint8Array(n.byteLength-r);a.set(new Uint8Array(n.buffer,r,n.byteLength-r));let s={m:t,tlvLen:i,tlv:[],frame:a},o=xO+Cb;for(;o<r;){let c=n.getUint8(o),d=n.getUint16(o+bb),l=bb+VO;if(c===d_.AUDIO_LEVEL){let h=n.getUint8(o+l);for(let _=1;_<d;_++)h=h<<8|n.getUint8(o+l+_);s.tlv.push({tag:c,length:d,value:e?127^h>>1:127&h})}else if(c===d_.METADATA||c===d_.AUDIO_64_BIT_PTS){let h=new Uint8Array(d);for(let _=0;_<d;_++)h[_]=n.getUint8(o+l+_);s.tlv.push({tag:c,length:d,value:h})}o+=l+d}return s}let oR=new Map,Ng=127,Xh=1e-10,l_=139/13,cR=new Map;function dR(n,e,t){let i="".concat(n,"-").concat(e,"-").concat(t),r=0;return cR.has(i)?r=cR.get(i):(r=Math.log((function(a,s){let o=a-s;s<o&&(s=o);let c=1;for(let d=a,l=1;d>s;d--,l++)c=c*d/l;return c})(e,n))+n*Math.log(.5)+(e-n)*Math.log(1-.5)-Math.log(t)+t*n,cR.set(i,r)),r<Xh&&(r=Xh),r}function FO(n,e,t){let i=e.length,r=n.length/i,a=!1;for(let s=0,o=0;s<i;s++){let c=0;for(let d=o+r;o<d;o++)n[o]>t&&c++;e[s]!==c&&(e[s]=c,a=!0)}return a}window.cache=cR;let xB=0;class VB{constructor(e){te(this,"id",void 0),te(this,"immediates",[]),te(this,"lastNonSilence",-1),te(this,"immediateSpeechActivityScore",Xh),te(this,"lastLevelChangedTime",Date.now()),te(this,"levels",[]),te(this,"longs",[]),te(this,"longSpeechActivityScore",Xh),te(this,"mediums",[]),te(this,"mediumSpeechActivityScore",Xh),te(this,"minLevel",0),te(this,"nextMinLevel",0),te(this,"nextMinLevelWindowLength",0),te(this,"energyScore",0),this.id=e||"".concat(xB++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let e=this.immediates,t=this.levels,i=this.minLevel+l_,r=!1;for(let a=0;a<e.length;++a){let s=t[a];s<i&&(s=0);let o=Math.floor(s/l_);e[a]!==o&&(e[a]=o,r=!0)}return r}computeLongs(){return FO(this.mediums,this.longs,4)}computeMediums(){return FO(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=dR(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=dR(this.longs[0],10,47),this.longSpeechActivityScore>Xh&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=dR(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(XE(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let i=e;return e<0&&(i=0),e>Ng&&(i=Ng),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+l_?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let t=Math.sqrt(this.minLevel*this.nextMinLevel);t<0?t=0:t>Ng&&(t=Ng),this.minLevel=t,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class FB{constructor(e){te(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{let t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class sU{constructor(e,t,i){te(this,"isDominant",void 0),te(this,"energyRanking",void 0),te(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=i}}class oU extends Sr{constructor(e){super(),te(this,"dominantId",null),te(this,"lastDecisionTime",0),te(this,"lastLevelChangedTime",0),te(this,"lastLevelIdleTime",0),te(this,"relativeSpeechActivities",[]),te(this,"speakers",new Map),te(this,"enableSilence",!1),te(this,"timeoutToSilenceInterval",0),te(this,"decisionMaker",null),te(this,"loudest",[]),te(this,"numLoudestToTrack",3),te(this,"energyExpireTimeMs",250),te(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,t!=null&&(this.energyExpireTimeMs=t),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(t=>t.id===e)}levelChanged(e,t){let i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());let a=r.levelChanged(t,i);return this.updateLoudestList(r,a,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(t=>{this.speakers.has(t.id)||this.speakers.set(t.id,t)})}removeSpeakers(e){e.forEach(t=>{this.speakers.delete(t.id)})}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new VB(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,i){let r=e.id===this.dominantId;if(t<0){let c=0;for(;c<this.loudest.length&&this.loudest[c]!==e;)++c;return new sU(r,c,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new sU(r,0,e.energyScore);let a=i-this.energyExpireTimeMs,s=0;for(;s<this.loudest.length;){let c=this.loudest[s];if(c.getLastLevelChangedTime()<a&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(s,1);else if(c.id!==e.id)++s;else if(this.loudest.splice(s,1),this.loudest.length<this.numLoudestToTrack)break}let o=0;for(;o<this.loudest.length&&!(this.loudest[o].energyScore<e.energyScore);)++o;return o<this.numLoudestToTrack&&(this.loudest.splice(o,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new sU(r,o,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new FB(this),this.decisionMaker.execute())}makeDecision(e){let t=null,i=null,r=this.speakers.size,a=null;if(r===0)a=null;else if(r===1){var s;let o=tn(s=this.speakers).call(s).next().value;this.enableSilence&&o&&(a=o.id,o.evaluateSpeechActivityScores(e),e-o.lastNonSilence>this.timeoutToSilenceInterval&&(a=null))}else{let o=this.dominantId==null?null:this.speakers.get(this.dominantId);if(o==null){let l=this.speakers.entries().next();l.value&&(a=l.value[0],o=l.value[1])}else a=o.id;o?.evaluateSpeechActivityScores(e);let c=this.relativeSpeechActivities,d=2;for(let l of this.speakers.entries()){let[h,_]=l;if(_===o)continue;_.evaluateSpeechActivityScores(e);for(let T=0;T<c.length;++T){let R=o==null?Xh:o.getSpeechActivityScore(T);c[T]=Math.log(_.getSpeechActivityScore(T)/R)}let f=c[0],m=c[1],S=c[2];f>3&&m>2&&S>0&&m>d&&(d=m,a=h)}this.enableSilence&&o!=null&&a===o.id&&e-o.lastNonSilence>this.timeoutToSilenceInterval&&(a=null)}a==null&&!this.enableSilence||a===this.dominantId||(t=this.dominantId,this.dominantId=a,i=this.dominantId),i==null&&!this.enableSilence||i===t||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){let e=Date.now(),t=300-(e-this.lastLevelIdleTime),i=0;t<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=t;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){let t=[];for(let r of tn(i=this.speakers).call(i)){var i;let a=e-r.getLastLevelChangedTime();36e5<a&&(this.dominantId==null||r.id!==this.dominantId)?t.push(r.id):300<a&&r.levelTimedOut()}t.forEach(r=>this.speakers.delete(r))}}let lR=new Map,Vo=null,Yc=null,Ab=3,oE=[],ho=new Map,zc=new Map;class BO{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){te(this,"id",void 0),te(this,"track",void 0),te(this,"score",0),te(this,"active",!0),te(this,"muted",!1),te(this,"timer",0),te(this,"actives",0),te(this,"inactives",0),this.id=e,this.track=t,this.setActive(ho.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let e=this.active;this.active=this.activeRate>=.8;let{actives:t,inactives:i}=(function(){let r=[],a=[];return Array.from(tn(ho).call(ho)).forEach(s=>{s.active?r.push(s):a.push(s)}),{actives:r,inactives:a}})();if(t.length>3){let r;t.forEach(a=>{(!r||r.score>a.score)&&(r=a)}),r&&r.setActive(!1)}if(t.length<3&&i.length>0){let r;i.forEach(a=>{(!r||r.score<a.score)&&a.id!==this.id&&(r=a)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let e=(function(t){let i;return Array.from(tn(ho).call(ho)).forEach(r=>{!r.active||r.id===t||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i})(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let e=(function(t){let i;return Array.from(tn(ho).call(ho)).forEach(r=>{r.active||r.id===t||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i})(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let jO;function Ib(n){let e=ho.get(n);e&&(ho.delete(n),e.clearTimer())}let wb=new Map,GO=new Map,cU="video/h264",Ob="video/h265";function WO(n,e,t){let i=new Uint8Array(n,e,t),r=[],a=0;for(;r.length<t;)a+3<t&&i[a]===0&&i[a+1]===0&&i[a+2]===3&&(i[a+3]===0||i[a+3]===1||i[a+3]===2||i[a+3]===3)?(r.push(i[a],i[a+1],i[a+3]),a+=4):(r.push(i[a]),a++);return new Uint8Array(r)}function dU(n){let e=n.length,t=[],i=0;for(;i<e;)i+2<e&&n[i]===0&&n[i+1]===0&&(n[i+2]===0||n[i+2]===1||n[i+2]===2||n[i+2]===3)?(t.push(n[i],n[i+1],3,n[i+2]),i+=3):(t.push(n[i]),i++);return new Uint8Array(t)}function lU(n){if(n.length<5)return"";let e=-1;for(let r=0;r<n.length-3;r++){if(n[r]===0&&n[r+1]===0&&n[r+2]===1){e=r;break}if(r<n.length-4&&n[r]===0&&n[r+1]===0&&n[r+2]===0&&n[r+3]===1){e=r;break}}if(e===-1)return"";let t=e+(n[e+2]===0?4:3);if(t>=n.length)return"";let i=n[t];return 128&i?"":(i>>1&63)>=32||t+1<n.length&&!(248&n[t+1])?Ob:(31&i)<=31?cU:""}let Nb=new Map,cE=new Map;(function(){let n=pi();oe.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),oe.getStreamFromExtension=n.name===Ot.CHROME&&Number(n.version)>34,oe.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch{}return e.close(),t})(),oe.supportMinBitrate=n.name===Ot.CHROME||n.name===Ot.EDGE,oe.supportSetRtpSenderParameters=(function(){let e=pi();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!xu()||!(!dn()&&!sb())||e.name===Ot.FIREFOX&&Number(e.version)>=64)})(),n.name===Ot.SAFARI&&(Number(n.version)>=14?oe.supportDualStream=!0:oe.supportDualStream=!1),oe.webAudioMediaStreamDest=(function(){let e=pi();return!(e.name===Ot.SAFARI&&Number(e.version)<12)})(),oe.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",oe.supportWebGL=typeof WebGLRenderingContext<"u",oe.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,xu()||(oe.webAudioWithAEC=!0),oe.supportShareAudio=(function(){let e=pi();return(e.os===Br.WIN_10||e.os===Br.WIN_81||e.os===Br.WIN_7||e.os===Br.LINUX||e.os===Br.MAC_OS||e.os===Br.CHROMIUM_OS)&&e.name===Ot.CHROME&&Number(e.version)>=74})(),oe.supportDataChannel=!!(Jn(76)||cb(68)||iO(14)),oe.supportPCSetConfiguration=(function(){let e=window.RTCPeerConnection;return!jr()&&!!e&&e.prototype.setConfiguration instanceof Function})(),oe.supportWebRTCEncodedTransform=Jn(87)||Ra()||cb(117),oe.supportWebRTCInsertableStream=(function(){let e=pi();return(e.name===Ot.CHROME||e.name===Ot.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),oe.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,oe.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,i_(()=>{oe.supportDualStreamEncoding=(function(){let e=pi();return!!B("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&B("CHROME_DUAL_STREAM_USE_ENCODING"))})(),I.debug("browser ua: ",navigator.userAgent),I.info("browser info: ",n),I.info("browser compatibility: ",oe)})})();let Db=["CHINA","GLOBAL"],BB=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],dE=[],vl=[];function yl(n,e){return!!e&&dE.some(t=>t.uid===n&&t.channelName===e)}function u_(){return vl.length>0}var uU=tF.forEach,jB=Zd("forEach")?[].forEach:function(n){return uU(this,n,arguments.length>1?arguments[1]:void 0)};dt({target:"Array",proto:!0,forced:[].forEach!==jB},{forEach:jB});var GB=Bn("Array","forEach"),J4=Ms,Z4=Bi,Q4=Be,$4=GB,hU=Array.prototype,pU={DOMTokenList:!0,NodeList:!0},eH=function(n){var e=n.forEach;return n===hU||Q4(hU,n)&&e===hU.forEach||Z4(pU,J4(n))?$4:e},tH=X(eH),iH=Pa,WB=iu;dt({target:"Object",stat:!0,forced:re(function(){WB(1)})},{keys:function(n){return WB(iH(n))}});var HB=X(bn.Object.keys),rH=X(Xl),nH=X(gS),aH=dt,KB=vo,YB=Nh,sH=Ir,zB=X_,qB=Zs,oH=Js,cH=Jy,dH=ci,lH=aa,uH=$L("slice"),hH=dH("species"),_U=Array,fU=Math.max;aH({target:"Array",proto:!0,forced:!uH},{slice:function(n,e){var t,i,r,a=oH(this),s=qB(a),o=zB(n,s),c=zB(e===void 0?s:e,s);if(KB(a)&&(t=a.constructor,(YB(t)&&(t===_U||KB(t.prototype))||sH(t)&&(t=t[hH])===null)&&(t=void 0),t===_U||t===void 0))return lH(a,o,c);for(i=new(t===void 0?_U:t)(fU(c-o,0)),r=0;o<c;o++,r++)o in a&&cH(i,r,a[o]);return i.length=r,i}});var pH=Bn("Array","slice"),_H=Be,fH=pH,EU=Array.prototype,mU=function(n){var e=n.slice;return n===EU||_H(EU,n)&&e===EU.slice?fH:e},EH=X(mU);function $e(n,e,t,i,r){var a,s,o,c={};return tH(a=HB(i)).call(a,function(d){c[d]=i[d]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=rH(s=nH(o=EH(t).call(t)).call(o)).call(s,function(d,l){return l(n,e,d)||d},c),r&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(r):void 0,c.initializer=void 0),c.initializer===void 0?(XL(n,e,c),null):c}let Ze=(function(n){return n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",n})({}),uR=(function(n){return n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR",n})({}),qc=(function(n){return n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",n})({}),gn=(function(n){return n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",n})({}),nt=(function(n){return n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",n})({}),He=(function(n){return n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed",n})({}),et=(function(n){return n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.PRE_CONNECT_PC="pre_connect_pc",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",n.RECOVER_NOTIFICATION="recover_notification",n})({}),Ne=(function(n){return n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.PRE_SUBSCRIBE="pre_subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag",n.DOWNGRADE_CODEC="downgrade_codec",n})({}),Et=(function(n){return n.WRTC_STATS="wrtc_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats",n})({}),$t=(function(n){return n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list",n})({}),Dt=(function(n){return n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY",n})({}),_t=(function(n){return n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",n})({});function Pt(n){if(typeof n!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw I.error("Invalid Channel Name ".concat(n)),new J(M.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Dg(n){if(e=n,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||Gr(n,1,255)))throw new J(M.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof n=="string"&&I.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Cl=(function(n){return n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n})({}),h_={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},gU={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Pb(n,e){Zn(n.url,"".concat(e,".url"),1,1e3,!1),zi(n.x)||Bt(n.x,"".concat(e,".x"),0,1e4),zi(n.y)||Bt(n.y,"".concat(e,".y"),0,1e4),zi(n.width)||Bt(n.width,"".concat(e,".width"),0,1e4),zi(n.height)||Bt(n.height,"".concat(e,".height"),0,1e4),zi(n.zOrder)||Bt(n.zOrder,"".concat(e,".zOrder"),0,255),zi(n.alpha)||Bt(n.alpha,"".concat(e,".alpha"),0,1,!1)}let SU={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},lE=(function(n){return n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address",n})({}),Jh=(function(n){return n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",n})({}),Sn=(function(n){return n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",n})({});function Nn(n){if(!n.channelName)throw new J(M.INVALID_PARAMS,"invalid channelName in info");if(typeof n.uid!="number")throw new J(M.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&Zn(n.token,"info.token",1,2047),Dg(n.uid),Pt(n.channelName),!0}let As=(function(n){return n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile",n})({}),Kn=(function(n){return n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",n})({}),oa=(function(n){return n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",n})({}),Ja=(function(n){return n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",n})({}),Ni=(function(n){return n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low",n})({}),Vt=(function(n){return n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.PRE_CONNECT_PC="pre-connect_pc",n.UPDATE_GATEWAY_CONFIG="update-gateway-config",n})({}),Vn=(function(n){return n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON",n})({}),Dn=(function(n){return n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7",n})({}),Lt=(function(n){return n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS",n})({}),Di=[Lt.AFRICA,Lt.ASIA,Lt.CHINA,Lt.EUROPE,Lt.GLOBAL,Lt.INDIA,Lt.JAPAN,Lt.NORTH_AMERICA,Lt.OCEANIA,Lt.OVERSEA,Lt.SOUTH_AMERICA],Va=(function(n){return n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL",n})({}),ca={CHINA:{},ASIA:{CODE:Va.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Va.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Va.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Va.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Va.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Va.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Va.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Va.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Va.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Va.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Va.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Va.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Va.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};lc&&(ca.CHINA={CODE:Va.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let uE=(function(n){return n.UPDATE_BITRATE_LIMIT="update_bitrate_limit",n.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",n})({});function hR(n){return!!n&&!(!n.uplink||!n.id)&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0}class TU extends Sr{constructor(e,t){super(),F(this,"onICEConnectionStateChange",void 0),F(this,"onConnectionStateChange",void 0),F(this,"onDTLSTransportStateChange",void 0),F(this,"onDTLSTransportError",void 0),F(this,"onICETransportStateChange",void 0),F(this,"onFirstAudioReceived",void 0),F(this,"onFirstVideoReceived",void 0),F(this,"onFirstAudioDecoded",void 0),F(this,"onFirstVideoDecoded",void 0),F(this,"onFirstVideoRender",void 0),F(this,"onFirstVideoDecodedTimeout",void 0),F(this,"onSelectedLocalCandidateChanged",void 0),F(this,"onSelectedRemoteCandidateChanged",void 0),F(this,"onICECandidateError",void 0),F(this,"getLocalVideoStats",void 0)}}class RU extends TU{constructor(e,t){super(e,t),F(this,"establishPromise",void 0)}}let ze=(function(n){return n.VIDEO="video",n.AUDIO="audio",n})({}),Me=(function(n){return n.UDP_RELAY="udp_relay",n.UDP_TCP_RELAY="udp_tcp_relay",n.TCP_RELAY="tcp_relay",n.RELAY="relay",n})({}),Tn=(function(n){return n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.TCP_RESTART=3]="TCP_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",n})({}),Zh=["disconnected","failed"],Ae=(function(n){return n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack",n})({}),Ee=(function(n){return n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected",n})({}),Ue=(function(n){return n.AudioMetadata="audioMetadata",n.AudioPts="audioPts",n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.RequestUpload="requestUpload",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE",n})({}),it=(function(n){return n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED",n})({}),ba=(function(n){return n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED",n})({}),Lr=(function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url",n})({}),$n=(function(n){return n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback",n.PRE_CONNECT_PC="transmitter:pre_connect_pc",n})({}),Ku=(function(n){return n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",n.SECURITY_POLICY_VIOLATION="security-policy-violation",n})({}),Fa=(function(n){return n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED",n})({}),Aa=(function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url",n})({}),Fo=(function(n){return n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED",n})({}),kr=(function(n){return n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.RESPONSE="response",n.JOIN="join",n.CHECK="check",n})({}),Mr=(function(n){return n.ABORT="abort",n})({}),Pd=(function(n){return n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n})({}),hE=(function(n){return n.P2P_TOKEN_TIMEOUT="p2p_token_timeout",n.P2P_TOKEN_CHANGED="p2p_token_changed",n})({}),mH={[Ze.ACCESS_POINT]:{[gn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[gn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[gn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[gn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[gn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[gn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[gn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ze.UNILBS]:{[qc.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[qc.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[qc.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[qc.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[qc.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[qc.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[qc.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[qc.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[qc.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[qc.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[qc.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[qc.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ze.STRING_UID_ALLOCATOR]:{[uR.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[uR.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[uR.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function pR(n){let e=mH[Math.floor(n/1e4)];if(!e)return{desc:"unknown error",retry:!1};let t=e[n%1e4];if(!t){if(Math.floor(n/1e4)===Ze.ACCESS_POINT){let i=n%1e4;if(i.toString()[0]==="1")return{desc:n.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:n.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return t}let _R={[nt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[nt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[nt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[nt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[nt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[nt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[nt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[nt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[nt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[nt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[nt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[nt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[nt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[nt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[nt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[nt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[nt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[nt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[nt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[nt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[nt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[nt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[nt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[nt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[nt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[nt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[nt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[nt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[nt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[nt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[nt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[nt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[nt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[nt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[nt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[nt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[nt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[nt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[nt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[nt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[nt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[nt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[nt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[nt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[nt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[nt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[nt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[nt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[nt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[nt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[nt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[nt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[nt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[nt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[nt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[nt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[nt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[nt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[nt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[nt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[nt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[nt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[nt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Lb(n){return _R[n]||{desc:"UNKNOWN_ERROR_".concat(n),action:"failed"}}function fR(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function HO(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fR(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):fR(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function kb(n,e){if(typeof n=="string")return n;let{proxy:t,host:i,port:r}=n;if(e){let a=B("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(a,"/ws/?p=").concat(Number(r)+150)}return t?"wss://".concat(t,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}let vU=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,gH=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,SH=/wss:\/\/(.+):([0-9]+)\/?/,TH=/wss:\/\/(.[^\/]+)\/?/,RH=0;class vH{constructor(e,t){F(this,"id",0),F(this,"store",void 0),F(this,"recordIndex",void 0),F(this,"websockets",[]),F(this,"try443PortDuration",2e3),F(this,"forceCloseWSDuration",5e3),F(this,"try443PortTimeout",null),F(this,"forceCloseTimeout",null),F(this,"isTry443PortFailed",!1),F(this,"isNormalPortFailed",!1),F(this,"useDoubleDomain",!1),F(this,"useProxy",!1),F(this,"startTime",Date.now()),this.id=++RH,this.try443PortDuration=B("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;let t=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];I.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,i){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:i});let r=B("GATEWAY_DOMAINS"),a=Date.now(),s=[],o=r.find(_=>{var f;return ee(f=e.host).call(f,_)});o||(this.useDoubleDomain=!1);let c=[];if(this.useDoubleDomain)r.forEach(_=>{c.push(kb(HO(HO({},e),{},{host:e.host.replace(o,_)}),t))});else{let _=HO({},e);if(t&&o){let f=r.find(m=>m!==o);f&&(_.host=_.host.replace(o,f))}c.push(kb(_,t))}try{c.forEach(_=>{let f=new WebSocket(_);f.binaryType="arraybuffer",s.push(f),this.logger("ws is connecting:",f.url)})}catch(_){if(this.logger("ws create failed"),s.forEach(f=>f.close()),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,i);if(!t&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new J(M.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}let d=rb();this.store&&this.store.recordJoinChannelService({urls:s.map(_=>_.url),service:"gateway"},this.recordIndex),s.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(f=>{f!==_&&(f.onopen=null,f.onclose=null,f.onmessage=null,f.close(),this.logger("close backup websocket: ".concat(f.url)))}),this.websockets.length=0,d.resolve(_)},_.onclose=f=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(_.readyState));let m=s.every(S=>S.readyState===WebSocket.CLOSED||S.readyState===WebSocket.CLOSING);this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(m)),m&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(f.reason)),d.reject({code:f.code,reason:Vn.A_ROUND_WS_FAILED})):!t&&m&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),h()),t?this.isTry443PortFailed=m:this.isNormalPortFailed=m},_.onmessage=f=>this.logger("".concat(_.url," onmessage: ").concat(f.data))}),this.websockets.push(...s);let l=()=>{this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())},h=()=>{if(d.isResolved)return l();pi().os===Br.MAC_OS&&jr()&&l(),this.createWebSocket(e,!0,!0).then(_=>{d.resolve(_)}).catch(_=>{this.isNormalPortFailed&&d.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",d.isResolved),this.forceCloseTimeout=null,l()},this.forceCloseWSDuration)};return i||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,l()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",d.isResolved),this.try443PortTimeout=null,h()},this.try443PortDuration)})(),d.promise}chooseBestWebsocket(e,t,i,r){return this.useDoubleDomain=!!t,typeof e=="string"&&(e=(function(a){let s,o,c;return[,s,o,c]=a.match(vU)||[],s||([,o,c]=a.match(gH)||[]),o&&c||([,o,c]=a.match(SH)||[]),o&&c||([,o]=a.match(TH)||[]),o||I.warning("un-destructible url: ",a),{proxy:s,host:o,port:c||"443"}})(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(I.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function XB(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}class yU extends Sr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;ee(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(_t.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(_t.CONNECTED):this._state==="closed"?this.emit(_t.CLOSED):this._state==="failed"&&this.emit(_t.FAILED))}resetReconnectCount(e){I.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],s=arguments.length>5?arguments[5]:void 0;super(),F(this,"_websocketUrl",null),F(this,"connectionID",0),F(this,"currentURLIndex",0),F(this,"urls",[]),F(this,"_reconnectMode","tryNext"),F(this,"reconnectReason",void 0),F(this,"_initMutex",void 0),F(this,"name",void 0),F(this,"_state","closed"),F(this,"reconnectInterrupter",void 0),F(this,"websocket",void 0),F(this,"retryConfig",void 0),F(this,"reconnectCount",0),F(this,"forceCloseTimeout",5e3),F(this,"onlineReconnectListener",void 0),F(this,"useCompress",void 0),F(this,"tryDoubleDomain",!1),F(this,"use443PortOnly",!1),F(this,"wsInflateLength",0),F(this,"wsDeflateLength",0),F(this,"closeEstablishingWs",()=>{}),F(this,"store",void 0),F(this,"joinGatewayRecordIndex",void 0),this.store=s,this.name=e,this.retryConfig=(function(h){for(var _=1;_<arguments.length;_++){var f=arguments[_]!=null?arguments[_]:{};_%2?XB(Object(f),!0).forEach(function(m){F(h,m,f[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(f)):XB(Object(f)).forEach(function(m){Object.defineProperty(h,m,Object.getOwnPropertyDescriptor(f,m))})}return h})({},t),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=a,this._initMutex=new xa("websocket",s?s.clientId:void 0);let{timeout:o,timeoutFactor:c}=t,d=Math.max(300,Math.floor(3*o/5)),l=Math.max(1.2,Math.floor(8*c)/10);Rr.ONLINE&&(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=l),Kr.on(cs.NETWORK_STATE_CHANGE,(h,_)=>{h!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(h)),h===Rr.ONLINE?(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=o,this.retryConfig.timeoutFactor=c))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{var r;let a=rb(),s=this.urls[this.currentURLIndex];(r=this.store)===null||r===void 0||r.beforeConnect(),(function(o){return!(mb()||B("USE_NEW_TOKEN")||!B("ENABLE_PREALLOC_PC")&&(o==null||!o.autoSubscribe||B("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit($n.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(a.resolve).catch(a.reject),this.once(_t.CLOSED,()=>{a.reject(new L(M.WS_DISCONNECT))}),this.once(_t.CONNECTED,a.resolve),await a.promise}catch{}finally{i()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let i=this.websocket;t?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void I.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),I.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);let i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new L(M.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new L(M.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;let i=rb();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let r=l=>{var h;(h=this.store)===null||h===void 0||h.signalChannelOpen(),I.debug("[".concat(this.name,"] websocket opened:"),l),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},a=async l=>{var h;if(I.debug("[".concat(this.name,"] websocket close ").concat((h=this.websocket)===null||h===void 0?void 0:h.url,", code: ").concat(l.code,", reason: ").concat(l.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new L(M.WS_DISCONNECT,"websocket close: ".concat(l.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=l.reason,this.state="reconnecting");let _=fi(this,_t.WILL_RECONNECT,this.reconnectMode,l.reason)||this.reconnectMode,f=await this.reconnectWithAction(_);if(this.state==="closed")return void I.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!f)return i.reject(new L(M.WS_DISCONNECT,"websocket reconnect failed: ".concat(l.code))),this.close(!0);i.resolve()}},s=l=>{this.emit(_t.ON_MESSAGE,l)},o=l=>{I.warn("[".concat(this.connectionID,"] ws open error ").concat(l))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),B("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=B("GATEWAY_WSS_ADDRESS")),I.debug("[".concat(this.name,"] start connect, url:"),e);let c=(t=this.store)===null||t===void 0?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var d;this._websocketUrl=kb(e);let l=await this.chooseBestWebsocketConnection(e);this.websocket=l,r&&r(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=s,this.websocket.onerror=o,(d=this.store)===null||d===void 0||d.recordJoinChannelService({endTs:Date.now(),status:"success"},c),this.joinGatewayRecordIndex=c}catch(l){let h=this.state==="closed",_=l instanceof L,f=_&&l.code===M.WS_ABORT,m=_&&l.code===M.WS_ERR,S=_?l.message:l&&(l.reason||l.toString());I.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(S)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:f?"aborted":"error",errors:[l]},c),h||m?(i.reject(h?new L(M.WS_DISCONNECT,"websocket is closed: ".concat(S)):new L(M.WS_ERR,"init websocket failed: ".concat(S))),m&&I.error("[".concat(this.name,"] init websocket failed: ").concat(S))):a&&a(l)}return i.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;I.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Kr.isOnline||!Kr.onlineWaiter||(this.onlineReconnectListener=Kr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,t){let s=ln(this.reconnectCount,this.retryConfig);I.debug("[".concat(this.name,"] wait ").concat(s,"ms to reconnect websocket, mode: ").concat(e)),await se.race([va(s),this.onlineReconnectListener||new se(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;let r=async(s,o)=>{this.emit(_t.RECONNECT_CREATE_CONNECTION,o),await this.createWebSocketConnection(s)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);I.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(I.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await kn(this,_t.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(s){var a;I.error("[".concat(this.name,"] reconnect failed ").concat(s&&s.toString()));let o=s==null||(a=s.data)===null||a===void 0?void 0:a.desc;return Array.isArray(o)&&ee(o).call(o,"dynamic key expired")?(this.emit(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class KO extends yU{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){let i=rb(),r=(function(s,o){return new vH(s,o)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new L(M.WS_ABORT,"choose best websocket aborted"))};let a=B("GATEWAY_DOMAINS");return I.debug("[choose-best-ws] currentDomain: ",e,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Pg extends yU{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new se((i,r)=>{let a=!1,s=[];this.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),s.forEach(m=>{m.onclose=null,m.onopen=null,m.onmessage=null,m.close()}),r(new L(M.WS_ABORT,"choose best websocket aborted"))};let o=B("GATEWAY_DOMAINS"),c,d=e.indexOf("?h="),l=o.find(m=>d!==-1?ee(e).call(e,m,d):ee(e).call(e,m));I.debug("[choose-best-ws] currentDomain: ",l,", domains: ",o);let h=!this.tryDoubleDomain||!l;if(!h&&l){var _;let m=Date.now();try{o.forEach(S=>{let T=d===-1?e.replace(l,S):e.substr(0,d)+e.substr(d).replace(l,S),R=new WebSocket(T);R.binaryType="arraybuffer",s.push(R),I.debug("[choose-best-ws] ws is connecting:",R.url)})}catch{for(I.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach(S=>S.close());s.length;)s.pop();h=!0}(_=this.store)===null||_===void 0||_.recordJoinChannelService({urls:s.map(S=>S.url),service:"gateway"},t),s.forEach(S=>{S.onopen=()=>{if(a)return;let T=Date.now()-m;I.debug("[choose-best-ws] ws open cost ".concat(T,"ms")),s.filter(R=>R!==S).forEach(R=>{I.debug("[choose-best-ws]close backup websocket: ".concat(R.url)),R.close()}),a=!0,i(S)},S.onclose=T=>{c=T,!a&&(s.find(R=>!(R.readyState===WebSocket.CLOSED||R.readyState===WebSocket.CLOSING))||(I.debug("[choose-best-ws] all websocket is closed"),a=!0,r(c)))},S.onmessage=T=>{I.debug("[choose-best-ws]".concat(S.url," onmessage: ").concat(T.data))}}),va(this.forceCloseTimeout).then(()=>{s.forEach(S=>{S.readyState!==WebSocket.OPEN&&S.close()})})}if(h){var f;let m;I.debug("[choose-best-ws] use single url: ",e),(f=this.store)===null||f===void 0||f.recordJoinChannelService({urls:[e],service:"gateway"},t);try{m=new WebSocket(e),s.push(m),m.binaryType="arraybuffer"}catch(S){let T=new L(M.WS_ERR,"init websocket failed! Error: ".concat(S.toString()));return I.error("[".concat(this.name,"]").concat(T)),void r(T)}m.onopen=()=>{i(m)},m.onclose=S=>{r(S)},m.onmessage=S=>{I.debug("[choose-best-ws]".concat(m.url," onmessage: ").concat(S.data))},va(this.forceCloseTimeout).then(()=>{m&&m.readyState!==WebSocket.OPEN&&m.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class Mb extends Sr{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===He.CONNECTED?this.emit(et.WS_CONNECTED):e===He.RECONNECTING?this.emit(et.WS_RECONNECTING,this._websocketReconnectReason):e===He.CLOSED&&this.emit(et.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),F(this,"_disconnectedReason",void 0),F(this,"_websocketReconnectReason",void 0),F(this,"_connectionState",He.CLOSED),F(this,"reconnectToken",void 0),F(this,"websocket",void 0),F(this,"openConnectionTime",void 0),F(this,"clientId",void 0),F(this,"lastMsgTime",Date.now()),F(this,"uploadCache",[]),F(this,"uploadCacheInterval",void 0),F(this,"rttRolling",new ub(5)),F(this,"pingpongTimer",void 0),F(this,"wsInflateDataTimer",void 0),F(this,"pingpongTimeoutCount",0),F(this,"ortc",void 0),F(this,"joinResponse",void 0),F(this,"multiIpOption",void 0),F(this,"initError",void 0),F(this,"spec",void 0),F(this,"store",void 0),F(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(et.ON_BINARY_DATA,i.data);let r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){let a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===$t.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===$t.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Vi.UID_BANNED);break;case 15:this.close(Vi.IP_BANNED);break;case 16:this.close(Vi.CHANNEL_BANNED)}if(r._type===$t.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case nt.ERR_LICENSE_MISSING:this.close(Vi.LICENSE_MISSING);break;case nt.ERR_LICENSE_EXPIRED:this.close(Vi.LICENSE_EXPIRED);break;case nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Vi.LICENSE_MINUTES_EXCEEDED);break;case nt.ERR_LICENSE_PERIOD_INVALID:this.close(Vi.LICENSE_PERIOD_INVALID);break;case nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Vi.LICENSE_MULTIPLE_SDK_SERVICE);break;case nt.ERR_LICENSE_ILLEGAL:this.close(Vi.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new KO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===He.CONNECTED&&this.reconnect("retry",yt.OFFLINE)})}async request(e,t,i,r){let a=Ht(6,""),s={_id:a,_type:e,_message:t},o=this.websocket.connectionID,c=()=>new se((m,S)=>{if(this.connectionState===He.CONNECTED)return m();let T=()=>{this.off(et.WS_CLOSED,R),m()},R=()=>{this.off(et.WS_CONNECTED,T),S(new J(M.WS_ABORT))};this.once(et.WS_CONNECTED,T),this.once(et.WS_CLOSED,R),e!==Ne.PUBLISH&&e!==Ne.PUBLISH_DATASTREAM&&e!==Ne.SUBSCRIBE&&e!==Ne.SUBSCRIBE_DATASTREAM&&e!==Ne.UNSUBSCRIBE&&e!==Ne.UNSUBSCRIBE_DATASTREAM&&e!==Ne.UNPUBLISH&&e!==Ne.UNPUBLISH_DATASTREAM&&e!==Ne.CONTROL&&e!==Ne.RESTART_ICE||this.once(et.DISCONNECT_P2P,()=>{S(new J(M.DISCONNECT_P2P))}),e!==Ne.PUBLISH&&e!==Ne.RESTART_ICE||this.once(et.ABORT_P2P_EXECUTION,()=>{S(new J(M.DISCONNECT_P2P))})});if(this.connectionState!==He.CONNECTING&&this.connectionState!==He.RECONNECTING||e===Ne.JOIN||e===Ne.REJOIN||await c(),this.websocket.sendMessage(s,!0),r)return;let d=new se((m,S)=>{let T=!1,R=(b,N)=>{T=!0,m({isSuccess:b==="success",message:N||{}}),this.off(et.WS_CLOSED,C),this.off(et.WS_RECONNECTING,C),this.emit(et.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),R);let C=()=>{S(new J(M.WS_ABORT,"type: ".concat(e))),this.off(et.WS_CLOSED,C),this.off(et.WS_RECONNECTING,C),this.off("res-@".concat(a),R)};this.once(et.WS_CLOSED,C),this.once(et.WS_RECONNECTING,C),va(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==o||T||(I.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(et.REQUEST_TIMEOUT,e,t))})}),l=null;try{l=await d}catch(m){if(this.connectionState===He.CLOSED||e===Ne.LEAVE)throw new J(M.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?m.throw():e===Ne.JOIN||e===Ne.REJOIN?null:(await c(),await this.request(e,t))}if(l.isSuccess)return l.message;let h=Number(l.message.error_code||l.message.code),_=Lb(h),f=new J(M.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(l.message.error_str),{code:h,data:l.message,desc:_.desc});return _.action==="success"?l.message:(I.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(h,", message: ").concat(_.desc,", action: ").concat(_.action)),h===nt.ERR_TOO_MANY_BROADCASTERS?((e===Ne.JOIN||e===Ne.REJOIN)&&(this.initError=f,this.close()),f.throw()):_.action==="failed"?f.throw():_.action==="quit"?(this.initError=f,this.close(),f.throw()):(h===nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yt.MULTI_IP)):this.reconnect(_.action,yt.SERVER_ERROR),e===Ne.JOIN||e===Ne.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new se(i=>{let r=a=>{(!t||t(a))&&(this.off(e,r),i(a))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Et.WRTC_STATS,t)}upload(e,t){let i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{let r=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==He.CONNECTED)return;let a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let i={_type:e,_message:t};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new se((t,i)=>{this.once(et.WS_CONNECTED,()=>t(this.joinResponse)),this.once(et.WS_CLOSED,r=>i(this.initError||new J(M.WS_ABORT,r))),this.connectionState=He.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Vi.LEAVE,this.connectionState=He.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(et.ABORT_P2P_EXECUTION),this.store.signalConnected();let e=await kn(this,et.REQUEST_JOIN_INFO);this.store.joinReq();let t=await this.request(Ne.JOIN,e);if(this.ortc=e?.ortc,this.store.joinRep(),!t)return this.emit(et.REPORT_JOIN_GATEWAY,Vn.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(et.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=He.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new J(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=Bs(this,et.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(Ne.REJOIN,e);return!!t&&(this.connectionState=He.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(i=>{this.emit($t.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit($t.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit($t.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit($t.MUTE_AUDIO,{uid:i.uid}):this.emit($t.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit($t.MUTE_VIDEO,{uid:i.uid}):this.emit($t.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit($t.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit($t.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit($t.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit($t.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit($t.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){if(!this.ortc)return!1;let t={downgrade_codec:e,ortc:this.ortc};return!!await this.request(Ne.DOWNGRADE_CODEC,t)}handleNotification(e){I.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Lb(e.code);if(e.code===28&&"detail"in e&&(I.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(et.RECOVER_NOTIFICATION,e.detail)),t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Vi.UID_BANNED),void this.close()):void this.reconnect(t.action,yt.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=B("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(I.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yt.TIMEOUT):this.request(Ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-t;this.rttRolling.add(i),B("REPORT_STATS")&&this.send(Ne.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();e!==0&&t!==0&&this.upload(Et.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,e=>{this.emit(et.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=He.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Vi.NETWORK_ERROR,this.connectionState=He.CLOSED}),this.websocket.on(_t.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===He.CONNECTED?this.connectionState=He.RECONNECTING:this.connectionState=He.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(e,t,i)=>{let r=Bs(this,et.IS_P2P_DISCONNECTED),a=r||e!=="retry";r&&e==="retry"&&(I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=Vn.P2P_DISCONNECTED),a&&(I.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(et.REPORT_JOIN_GATEWAY,t||Vn.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(et.DISCONNECT_P2P)),i(e)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",yt.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(et.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof J){if(e.code===M.UNEXPECTED_RESPONSE&&e.data.code===nt.ERR_NO_AUTHORIZED)return this.initError=new J(M.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Vi.TOKEN_EXPIRE);I.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yt.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(_t.REQUEST_NEW_URLS,(e,t)=>{kn(this,et.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on($n.PRE_CONNECT_PC,()=>{this.emit(et.PRE_CONNECT_PC)})}}let yH=(function(n){return n.NATIVE_RTC="native_rtc",n.NATIVE_RTM="native_rtm",n.WEB_RTC="web_rtc",n.WEB_RTM="web_rtm",n})({}),Rn=(function(n){return n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",n})({});function hn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Ub(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?hn(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):hn(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Yu(n){return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(B("TURN_DOMAIN")):(I.debug("Cannot recognized as ip address: ".concat(n,", use as host2")),n)}function zu(n){try{let e=B("GATEWAY_DOMAINS").concat(B("TURN_DOMAIN")).find(t=>ee(n).call(n,t));return e?n.split(".".concat(e))[0].replace(/-/g,"."):n}catch{return I.debug("serverUrlToIp error, fallback to url",n),n}}function ER(n,e){n.addresses||(n.addresses=[]);let t=(function(o,c){if(B("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return o.map(h=>{let{ip:_,port:f}=h;return{address:"".concat(_,":").concat(f)}});let d=B("GATEWAY_DOMAINS"),l=d[1]&&ee(c).call(c,d[1])?1:0;return o.map(h=>{let{domain_prefix:_,port:f,ip:m}=h;if(_)return{address:"".concat(_,".").concat(d[l++%d.length],":").concat(f)};let S=/^[\.\:\d]+$/.test(m),T=S?"".concat(m.replace(/[^\d]/g,"-"),".").concat(d[l++%d.length],":").concat(f):"".concat(m,":").concat(f);return S||I.debug("Cannot recognized as ip address: ".concat(m,", use as host3")),{ip:m,port:f,address:T}})})(n.addresses,e),i=Array.isArray(n.detail)&&n.detail[18];if(i&&typeof i=="string"){let o=i.split(";");for(let c=0;c<o.length;c++){var r;let d=hr(r=o[c]).call(r);t[c]&&d&&(t[c].ip6=d)}}let a=n.detail&&n.detail.candidate,s;if(a){let[o,c]=a.split(":");o&&c&&(s={port:Number(c),ip:o,address:"".concat(o,":").concat(c)})}return{gatewayAddrs:t,apGatewayAddress:s,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function po(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function Bo(n){let e=n._encoderConfig;if(!e)return{};let t={resolution:e.width&&e.height?"".concat(po(e.width),"x").concat(po(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(t.maxFrameRate=e.frameRate,t.minFrameRate=e.frameRate):e.frameRate&&(t.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,t.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),t}function CU(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function mR(n,e){let t,i,r;switch(e){case Rn.CHOOSE_SERVER:i=4096,r="choose server";break;case Rn.CLOUD_PROXY:i=1048576,r="proxy";break;case Rn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case Rn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new J(M.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(a=>{a.buffer&&a.buffer.flag===i&&(t={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(s=>Ub(Ub({},s),{},{ticket:a.buffer.cert})),server_ts:n.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:Ub(Ub({},a.buffer.detail),n.detail),flag:a.buffer.flag,opid:n.opid,cert:a.buffer.cert})}),!t)throw new J(M.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return t}async function gR(n,e){return await se.all(n.addresses.map(async t=>({address:Yu(t.ip),tcpport:t.port,udpport:t.port,username:e&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():wn.username,password:e&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await lO(e.toString()):wn.password})))}function YO(n,e){let t=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||t.height,r=e.videoWidth||t.width;return i&&r?Math.max(Math.min(i,r)/Math.min(po(n.height),po(n.width)),1):(I.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Qh(n){let{candidateType:e,relayProtocol:t,type:i,address:r,port:a,protocol:s}=n,o={candidateType:e,relayProtocol:t,protocol:s};if(i!=="local-candidate"){let c=r.split(".");c.length>=4&&(c[1]="*",c[2]="*"),o.address=c.join("."),o.port=a}return o}function Xc(n){let e=n.split(":"),t=n.split(/[-.]/),i=ee(n).call(n,"-")?"-":".",r=n;return e.length>1?t.length>1?(t[1]="**",r=t[0]+i+"**:"+e[e.length-1]):r=e.length>2?e[0]+i+"**:"+e[e.length-1]:"**:"+e[e.length-1]:t.length>1&&(r=t[0]+i+"**"),r}function $h(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:B("SVC_MODE");if(B("ENABLE_SVC"))return(function(e){return e in nE})(n)?n:nE.L1T3}let xb={[ze.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ze.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function Vb(n,e,t){e.forEach(i=>{var r;let a=xb[n].find(o=>{var c;let{key:d}=o;return ee(c=i.extensionName).call(c,d)});if(!a)return;let s=t.find(o=>{let{extensionName:c}=o;return ee(c).call(c,a.key)});s&&ee(r=s.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=s.extensionName)})}function p_(n,e){e.forEach(t=>{var i;let r=xb[n].find(a=>{var s;let{key:o}=a;return ee(s=t.extensionName).call(s,o)});ee(i=t.extensionName).call(i,"gdpr_forbidden")&&r&&(t.extensionName=r.extensionName)})}function Lg(n){return n==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ee(n).call(n,"abs-send-time")}function Fb(n){return n==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ee(n).call(n,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function Bb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function bU(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Bb(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Bb(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function SR(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,{filterRTX:r,filterVideoFec:a,filterAudioFec:s,filterAudioCodec:o,filterVideoCodec:c,unsupportedVideoUplinkCodec:d,unsupportedVideoDownlinkCodec:l}=e,{useXR:h}=t,_=[],f=[],m=[],S=[],T=!1,R=!1;if(lo(n).mediaDescriptions.forEach(b=>{i&&i!==b.attributes.direction||(b.media.mediaType!=="video"||T||(f=b.attributes.payloads,S=b.attributes.extmaps,T=!0),b.media.mediaType!=="audio"||R||(_=b.attributes.payloads,m=b.attributes.extmaps,R=!0))}),!S||f.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!m||_.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(f.forEach(b=>{var N;(N=b.rtpMap)!==null&&N!==void 0&&N.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),h&&b.rtcpFeedbacks.push({type:"rrtr"})}),_.forEach(b=>{var N;(N=b.rtpMap)!==null&&N!==void 0&&N.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),h&&b.rtcpFeedbacks.push({type:"rrtr"})}),r&&(_=_.filter(b=>{var N;return((N=b.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())!=="rtx"}),f=f.filter(b=>{var N;return((N=b.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())!=="rtx"})),a){let b=f.filter(P=>{var U;return/(red)|(ulpfec)|(flexfec)/i.test(((U=P.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")}),N=Al(b,f).map(P=>P.payloadType),k=[...b.map(P=>P.payloadType),...N];f=f.filter(P=>!ee(k).call(k,P.payloadType))}if(s&&(_=_.filter(b=>{var N;return!/(red)|(ulpfec)|(flexfec)/i.test(((N=b.rtpMap)===null||N===void 0?void 0:N.encodingName)||"")})),o&&o?.length>0&&(_=_.filter(b=>{var N;return ee(o).call(o,((N=b.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())||"")})),c&&c?.length>0){let b=f.filter(N=>{var k;return ee(c).call(c,((k=N.rtpMap)===null||k===void 0?void 0:k.encodingName.toLowerCase())||"")});f=b.concat(r?[]:Al(b,f))}let C=B("UNSUPPORTED_VIDEO_CODEC");if(C&&C.length>0){let b=f.filter(P=>P.rtpMap&&ee(C).call(C,P.rtpMap.encodingName.toLowerCase())),N=Al(b,f),k=b.concat(N).map(P=>P.payloadType);f=f.filter(P=>!ee(k).call(k,P.payloadType)),I.debug("unsupportedVideoCodec: ".concat(C,", toBeRemoved: ").concat(k))}if(d&&d.length>0&&i==="sendonly"){let b=f.filter(P=>P.rtpMap&&ee(d).call(d,P.rtpMap.encodingName.toLowerCase())),N=Al(b,f),k=b.concat(N).map(P=>P.payloadType);f=f.filter(P=>!ee(k).call(k,P.payloadType)),I.debug("unsupportedVideoUplinkCodec: ".concat(d,", toBeRemoved: ").concat(k))}if(l&&l.length>0&&i==="recvonly"){let b=f.filter(P=>P.rtpMap&&ee(l).call(l,P.rtpMap.encodingName.toLowerCase())),N=Al(b,f),k=b.concat(N).map(P=>P.payloadType);f=f.filter(P=>!ee(k).call(k,P.payloadType)),I.debug("unsupportedVideoDownlinkCodec: ".concat(l,", toBeRemoved: ").concat(k))}return{audioCodecs:_,videoCodecs:f,audioExtensions:m,videoExtensions:S}}function bl(n){let e=lo(n),t,i;for(let r of e.mediaDescriptions){if(!t){let a=r.attributes.iceUfrag,s=r.attributes.icePwd;if(!a||!s)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:a,icePwd:s}}if(!i){let a=r.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:i}}function __(n,e){let t=[],i=n.attributes.ssrcGroups.filter(s=>s.semantic==="FID"),r=n.attributes.ssrcGroups.find(s=>s.semantic==="SIM"),a=n.attributes.ssrcs;if(r)r.ssrcIds.forEach(s=>{var o;let c=(o=i.find(d=>d.ssrcIds[0]===s))===null||o===void 0?void 0:o.ssrcIds[1];t.push({ssrcId:s,rtx:e?c:void 0})});else if(i.length>0){let s=i[0].ssrcIds[0],o=i[0].ssrcIds[1];t.push({ssrcId:s,rtx:e?o:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");t.push({ssrcId:a[0].ssrcId})}return t}function AU(n,e,t){let{cname:i}=n,r=[];e&&(r=IU(e)),r.length===0&&(r=n.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}})),I.debug("Using candidates from gateway."));let a={fingerprints:n.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},s={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd},o;switch(n.dtlsParameters.role){case"server":o="passive";break;case"client":o="active";break;case"auto":o="actpass"}let c=Ec(n.rtpCapabilities),d=[];return Array.isArray(t)&&t.length>0&&t.forEach(l=>{d.push({kind:ze.VIDEO,ssrcMsg:[{ssrcId:l.v,rtx:l.v_rtx}],mslabel:"".concat(l.v,"_").concat(l.a)},{kind:ze.AUDIO,ssrcMsg:[{ssrcId:l.a}],mslabel:"".concat(l.v,"_").concat(l.a)})}),{dtlsParameters:a,iceParameters:s,candidates:r,rtpCapabilities:c,setup:o,cname:i,preSSRCs:d}}function IU(n){let e=[];return n.ip&&typeof n.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip,port:n.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(Xc(n.ip),":").concat(n.port)),n.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip6,port:n.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(Xc(n.ip6),":").concat(n.port)))),e}function TR(n,e,t){let i=[],r=[];return n.forEach(a=>{let{ssrcId:s,rtx:o}=a,c=Ht(8,"track-"),d={ssrcId:s,attributes:bU({label:c,mslabel:t=t||Ht(10,""),msid:"".concat(t," ").concat(c)},e&&{cname:e})};if(i.push(d),o!==void 0){let l={ssrcId:o,attributes:bU({label:c,mslabel:t,msid:"".concat(t," ").concat(c)},e&&{cname:e})};i.push(l),r.push({semantic:"FID",ssrcIds:[s,o]})}}),n.length>1&&r.push({semantic:"SIM",ssrcIds:n.map(a=>{let{ssrcId:s}=a;return s})}),{ssrcs:i,ssrcGroups:r}}function ep(n,e){e instanceof Ti&&n.attributes.payloads.forEach(t=>{var i;let r=(i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;t.fmtp||(t.fmtp={parameters:{}}),r==="opus"&&typeof B("OPUS_PTIME")=="number"?t.fmtp.parameters.ptime=B("OPUS_PTIME"):t.fmtp.parameters.minptime="10",t.fmtp.parameters.useinbandfec="1";let a=e._encoderConfig;a&&(r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(a.bitrate&&!jr()&&(t.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(t.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),t.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1")),e instanceof yr&&r==="opus"&&e._config.DTX&&(t.fmtp.parameters.usedtx="1"))})}function pE(n){let e=n.attributes.unrecognized.findIndex(t=>t.attField==="x-google-flag"&&t.attValue==="conference");e!==-1&&n.attributes.unrecognized.splice(e,1)}function jb(n,e){var t;if(!(e instanceof Ai&&e._encoderConfig&&e._hints.indexOf(Oe.SCREEN_TRACK)===-1))return;let i=e._encoderConfig;Nt().supportMinBitrate&&i.bitrateMin&&n.attributes.payloads.forEach(r=>{var a,s;ee(a=["h264","h265","vp8","vp9","av1"]).call(a,((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Nt().supportMinBitrate&&!ee(t=e._hints).call(t,Oe.LOW_STREAM)&&i.bitrateMax&&n.attributes.payloads.forEach(r=>{var a,s;ee(a=["h264","h265","vp8","vp9","av1"]).call(a,((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(B("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function zO(n){if(n.media.mediaType!=="video")return;let e=pi();if(e.name!==Ot.SAFARI&&e.os!==Br.IOS)return;let t=n.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));t!==-1&&n.attributes.extmaps.splice(t,1)}function Gb(n,e,t){if(!e)return;let i,r;if(n.media.mediaType==="video"?(i=t.videoExtensions,r=t.videoCodecs):(i=t.audioExtensions,r=t.audioCodecs),e.twcc===!0){let a=i.find(s=>Fb(s.extensionName));if(a){let s=a.extensionName;n.attributes.extmaps.find(o=>Fb(o.extensionName))||n.attributes.extmaps.push({entry:a.entry,extensionName:s}),(function(o,c){return c.filter(d=>!!o.find(l=>l.payloadType===d.payloadType&&!!l.rtcpFeedbacks.find(h=>h.type==="transport-cc")))})(r,n.attributes.payloads).forEach(o=>{o.rtcpFeedbacks.find(c=>c.type==="transport-cc")||o.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){let a=n.attributes.extmaps.findIndex(s=>Fb(s.extensionName));a!==-1&&n.attributes.extmaps.splice(a,1),n.attributes.payloads.forEach(s=>{let o=s.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");o!==-1&&s.rtcpFeedbacks.splice(o,1)})}if(e.remb===!0){let a=i.find(s=>Lg(s.extensionName));if(a){let s=a.extensionName;n.attributes.extmaps.find(o=>o.extensionName===s)||n.attributes.extmaps.push({entry:a.entry,extensionName:s}),(function(o,c){return c.filter(d=>!!o.find(l=>l.payloadType===d.payloadType&&!!l.rtcpFeedbacks.find(h=>h.type==="goog-remb")))})(r,n.attributes.payloads).forEach(o=>{o.rtcpFeedbacks.find(c=>c.type==="goog-remb")||o.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){let a=n.attributes.extmaps.findIndex(s=>Lg(s.extensionName));a!==-1&&n.attributes.extmaps.splice(a,1),n.attributes.payloads.forEach(s=>{let o=s.rtcpFeedbacks.findIndex(c=>c.type==="goog-remb");o!==-1&&s.rtcpFeedbacks.splice(o,1)})}}function Wb(n,e,t){if(jr()||n.media.mediaType!=="video"||!(e instanceof Ai)||t!=="vp9"&&t!=="vp8"||t==="vp8"&&!B("SIMULCAST")||t==="vp9"&&B("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;let i=t==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=n.attributes.ssrcs[0],a=n.attributes.ssrcGroups.find(o=>o.semantic==="FID"&&o.ssrcIds[0]===r.ssrcId),s={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let o=1;o<i;o++)n.attributes.ssrcs.push({ssrcId:r.ssrcId+o,attributes:cr(r.attributes)}),s.ssrcIds.push(r.ssrcId+o),a&&(n.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+o,attributes:cr(r.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+o,a.ssrcIds[1]+o]}));n.attributes.ssrcGroups.unshift(s)}async function wU(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=new RTCPeerConnection;t.addTransceiver("video",{direction:"sendonly"}),t.addTransceiver("audio",{direction:"sendonly"}),t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});let i=(await t.createOffer()).sdp,{send:r,recv:a,sendrecv:s}=(function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0,l=SR(d,o,c,"sendonly"),h=SR(d,o,c,"recvonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ld(l,h,"videoExtensions",_,f,m),Ld(l,h,"videoCodecs",_,f,m),Ld(l,h,"audioExtensions",_,f,m),Ld(l,h,"audioCodecs",_,f,m),B("RAISE_H264_BASELINE_PRIORITY")){let S=[],T=[];if(m.videoCodecs.forEach((R,C)=>{var b;if(((b=R.rtpMap)===null||b===void 0?void 0:b.encodingName.toLocaleLowerCase())==="h264"){var N,k;let P=m.videoCodecs[C+1],U=P&&PU(R,P),W=(N=R.fmtp)===null||N===void 0?void 0:N.parameters["profile-level-id"],z=(k=R.fmtp)===null||k===void 0?void 0:k.parameters["packetization-mode"];!W||W!==B("FIRST_H264_PROFILE_LEVEL_ID")||B("FIRST_PACKETIZATION_MODE")&&z!==B("FIRST_PACKETIZATION_MODE")?U?T.push([R,P]):T.push([R]):U?S.push([R,P]):S.push([R])}}),S.length>0&&T.length>0){I.debug("raising H264 baseline profile priority"),m.videoCodecs.forEach((C,b)=>{var N;if(((N=C.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"){let k=PU(C,m.videoCodecs[b+1]),P=S.shift()||T.shift()||[];P.length>0&&(k?m.videoCodecs.splice(b,2,...P):m.videoCodecs.splice(b,1,...P))}});let R=f.videoCodecs.filter(C=>{var b,N;return((b=C.rtpMap)===null||b===void 0?void 0:b.encodingName.toLocaleLowerCase())==="h264"&&((N=C.fmtp)===null||N===void 0?void 0:N.parameters["profile-level-id"])!==B("FIRST_H264_PROFILE_LEVEL_ID")});if(R.length>0){let C=Al(R,f.videoCodecs).map(N=>N.payloadType),b=[...R.map(N=>N.payloadType),...C];f.videoCodecs=f.videoCodecs.filter(N=>!ee(b).call(b,N.payloadType))}B("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(C=>{var b,N;return!(((b=C.rtpMap)===null||b===void 0?void 0:b.encodingName.toLocaleLowerCase())==="h264"&&((N=C.fmtp)===null||N===void 0?void 0:N.parameters["profile-level-id"])!==B("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:_,recv:f,sendrecv:m}}return{send:_,recv:f,sendrecv:m}})(n,e,i);try{t.close()}catch{}return{send:r,recv:a,sendrecv:s}}function OU(){let n={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=SR(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ld(n,e,"videoExtensions",t,i,r),Ld(n,e,"videoCodecs",t,i,r),Ld(n,e,"audioExtensions",t,i,r),Ld(n,e,"audioCodecs",t,i,r),B("RAISE_H264_BASELINE_PRIORITY")){let a=r.videoCodecs.findIndex(s=>s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&s.fmtp&&s.fmtp.parameters["profile-level-id"]==="42001f");if(a!==-1){let s=r.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(s<a){I.debug("raising H264 baseline profile priority");let o=r.videoCodecs[a];r.videoCodecs.splice(a,1),r.videoCodecs.splice(s,0,o)}s!==-1&&(i.videoCodecs=i.videoCodecs.filter(o=>!(o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:t,recv:i,sendrecv:r}}function Ld(n,e,t,i,r,a){if(t==="videoExtensions"||t==="audioExtensions"){let s=[];return n[t].forEach(o=>{e[t].some((c,d)=>{if(o.entry===c.entry&&o.extensionName===c.extensionName)return s.push(d),!0})?a[t].push(o):i[t].push(o)}),void e[t].forEach((o,c)=>{s.indexOf(c)===-1&&r[t].push(o)})}if(t==="videoCodecs"||t==="audioCodecs"){let s=[];return n[t].forEach(o=>{e[t].some((c,d)=>{if(o.payloadType===c.payloadType&&JSON.stringify(o)===JSON.stringify(c))return s.push(d),!0})?a[t].push(o):i[t].push(o)}),void e[t].forEach((o,c)=>{s.indexOf(c)===-1&&r[t].push(o)})}}function Ec(n){let{send:e,recv:t,sendrecv:i}=n;if(!i){if(!e||!t)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:t}}let r,a;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...i.audioCodecs],a.videoCodecs=[...t.videoCodecs,...i.videoCodecs],a.audioExtensions=[...t.audioExtensions,...i.audioExtensions],a.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):a=i,{send:r,recv:a}}function f_(n){n.media.mediaType==="audio"&&n.attributes.payloads.filter(e=>{var t;return((t=e.rtpMap)===null||t===void 0?void 0:t.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function tp(n,e,t,i){let r=[];if(n===ze.VIDEO){if(B("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(a=>{var s;return ee(s=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(s,i)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===B("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let a=[],s=[],o=[],c=[];if(t.videoCodecs.forEach(d=>{let l=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"";ee(l).call(l,i)?a.push(d):ee(l).call(l,"vp9")?s.push(d):ee(l).call(l,"vp8")?o.push(d):ee(l).call(l,"h264")&&c.push(d)}),a.length===0){let d="";s.length!==0?(a=s,d="vp9"):o.length!==0?(a=o,d="vp8"):c.length!==0&&(a=c,d="h264"),I.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(d))}a.length!==0&&(r=e.videoCodecs.filter(d=>a.some(l=>l.payloadType===d.payloadType)))}if(r.length===0&&(I.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),B("USE_PUB_RTX")||B("USE_SUB_RTX")){let a=Al(r,e.videoCodecs);r=[...r,...a]}}else{r=e.audioCodecs.filter(s=>{var o;return ee(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,i)});let a=e.audioCodecs.filter(s=>{var o;return ee(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,"red")});r.length===0&&(I.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(s=>{var o;return ee(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,"opus")})),B("ENABLE_AUDIO_RED")&&a.length!==0&&(r=[...a,...r])}return r}function Al(n,e){let t=n.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&ee(t).call(t,i.fmtp&&i.fmtp.parameters.apt))}async function mc(n,e,t){let i=e.toString(),r=NU(i,"offer","remote","exchangeSDP");await n.setRemoteDescription({type:"offer",sdp:i});let a=await n.createAnswer();if(!a.sdp)throw new Error("cannot get answer sdp");let s=a.sdp;s=E_(s,t||{}),r?.(s||""),await n.setLocalDescription({type:"answer",sdp:s})}function E_(n,e,t){let i=lo(n),{useXR:r}=e;return i.mediaDescriptions.forEach(a=>{var s;a.attributes.mid&&(Array.isArray(t)&&!ee(t).call(t,a.attributes.mid)||(a.media.mediaType==="audio"&&f_(a),r&&ee(s=["audio","video"]).call(s,a.media.mediaType)&&a.attributes.payloads.forEach(o=>{o.rtcpFeedbacks.findIndex(c=>c.type==="rrtr")===-1&&o.rtcpFeedbacks.push({type:"rrtr"})})))}),ya(i)}function NU(n,e,t,i){if(B("SDP_LOGGING"))return I.upload("exchanging ".concat(t," ").concat(e," SDP during P2PConnection.").concat(i,`
`),n),e==="offer"?r=>{NU(r,"answer",t==="local"?"remote":"local",i)}:void 0}function DU(n){let e=B("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(t=>ee(n).call(n,t))}function PU(n,e){try{var t;return((t=n.fmtp)===null||t===void 0?void 0:t.parameters.apt)===e.payloadType.toString()}catch{return!1}}function LU(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function gc(n,e){return typeof B(n)===e?B(n):void 0}function Jc(){try{let n=B("EXPERIMENTS")||{};return typeof n=="string"||Array.isArray(n)?{}:(function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?LU(Object(i),!0).forEach(function(r){F(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):LU(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e})({},n)}catch(n){return I.debug("handle gateway attributes failed: ",n),{}}}let JB={};function m_(n){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&I.debug("install service ".concat(n.name)),JB[n.name]=n}function jo(n){let e=JB[n];if(!e)throw new L(M.INVALID_OPERATION,"".concat(n," not found, please use AgoraRTC.use(").concat(n,"Service) to load it first"));return e}function ip(n,e){return jo("DataStream").create(n,e)}function Hb(){return jo("InterceptFrame").create()}function Kb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Za(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Kb(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Kb(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let Ba=new Map;class kU extends Sr{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(Vt.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(Vt.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){I.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var i,r,a;super(),F(this,"store",void 0),F(this,"joinInfo",void 0),F(this,"key",void 0),F(this,"ntpOffset",0),F(this,"signal",void 0),F(this,"role",void 0),F(this,"isPreallocation",void 0),F(this,"isPreSub",void 0),F(this,"inChannelInfo",{joinAt:null,duration:0}),F(this,"spec",void 0),F(this,"_state","DISCONNECTED"),F(this,"_statsCollector",void 0),F(this,"_disconnectedReason",void 0),F(this,"isSignalRecover",!1),F(this,"hasChangeBGPAddress",!1),F(this,"trafficStatsInterval",void 0),F(this,"networkQualityInterval",void 0),F(this,"_joinGatewayStartTime",0),F(this,"_signalTimeout",!1),F(this,"_clientRoleOptions",void 0),F(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(i={spec:Za(Za({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},(r=(a=jo("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(a,i)):new Mb(Za(Za({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let r=Date.now(),a=Ba.get(e.cname);if(a||(a=new Map,Ba.set(e.cname,a)),this._isProactiveJoin=!0,a.has(e.uid)){let d=new J(M.UID_CONFLICT);throw Te.joinGateway(e.sid,{lts:r,succ:!1,ec:d.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),d}a.set(e.uid,!0),this.joinInfo=e,this.key=t;let s=0;this.joinGatewayStartTime=r;let o=e.proxyServer;try{I.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(s));let d=e.gatewayAddrs.map(l=>{let{address:h}=l,[_,f]=h.split(":"),m={host:_,port:f};return e.proxyServer&&(m.proxy=e.proxyServer),m});s=(await this.signal.init(d)).uid,I.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(s," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(d){var c;throw I.error("[".concat(this.store.clientId,"] User join failed"),d.toString()),Te.joinGateway(e.sid,{lts:r,succ:!1,ec:((c=d.data)===null||c===void 0?void 0:c.desc)||d.code,errorMsg:d.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!o,signalChannel:"0",preload:e.preload}),a.delete(e.uid),this.signal.close(),d}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),I.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(d=>{I.warning("[".concat(this.store.clientId,"] get traffic stats error"),d.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Vt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Vt.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Vt.NETWORK_QUALITY,{uplinkNetworkQuality:CU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:CU(this._statsCollector.trafficStats.B_dnq)}):this.emit(Vt.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),s}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){t!==Vi.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==He.CONNECTED||await(function(i,r){return r===1/0?i:se.race([i,mB(r)])})(this.signal.request(Ne.LEAVE,void 0,!0),3e3)}catch(i){I.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(t),t!==Vi.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:B("PUB_EXTEND"),twcc:!!B("PUBLISH_TWCC"),rtx:!!B("USE_PUB_RTX")};try{return(await this.signal.request(Ne.PUBLISH,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===nt.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw a}}async publishDataChannel(e,t,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let a={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:(r=t.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(Ne.PUBLISH_DATASTREAM,a,!0)}catch(s){if(i&&s.data&&s.data.code===nt.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),s.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw s}}async unpublish(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ne.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(i){I.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await se.all(e.map(t=>this.signal.request(Ne.UNPUBLISH_DATASTREAM,{channel_id:t},!0)))}catch(t){I.warning("unpublish datachannels warning: ",t)}}async presubscribe(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX")||void 0,extend:B("SUB_EXTEND"),svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return await this.signal.request(Ne.PRE_SUBSCRIBE,r,!0)}catch(a){if(i&&a.data&&a.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(e,t,!1);throw a}}async subscribe(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX"),extend:B("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return(await this.signal.request(Ne.SUBSCRIBE,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw a}}async subscribeDataChannel(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(Ne.SUBSCRIBE_DATASTREAM,r,!0)}catch(a){if(i&&a.data&&a.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw a}}async subscribeAll(e,t){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!B("USE_SUB_RTX"),twcc:!!B("SUBSCRIBE_TWCC"),svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return await this.signal.request(Ne.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(t&&r.data&&r.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){let t=(function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,a=i.width,s=i.height,o=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(o=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(o=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,r||(o=!1)),o?{stream_type:0,width:a,height:s,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0})(e);if(t)return this.signal.request(Ne.SET_VIDEO_PROFILE,t);I.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(Ne.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(i){I.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await se.all(e.map(i=>this.signal.request(Ne.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:t},!0)))}catch(i){I.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(Ne.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){I.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(Ne.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ne.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Ne.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),B("CLIENT_ROLE_OPTIONS")&&(I.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(B("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},B("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),B("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},B("CLIENT_ROLE_OPTIONS")),I.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(B("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0;let a=Object.assign({},t);delete a.delay,delete a.level,await this.signal.request(Ne.SET_CLIENT_ROLE,Za(Za({role:e,level:r,delay:i},a),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(Ne.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Ne.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(Ne.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(Ne.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Ne.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Za({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ne.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=Ba.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e=(function(t){let i;return i=t.startsWith("dc")?t.match(/(dc\:\/\/)?([^:]+):(\d+)/):t.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:wn.username,password:wn.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Za(Za({},wn),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let e=await this.signal.request(Ne.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(t=>{let i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===t.peer_uid);i&&i.B_st!==t.B_st&&i_(()=>{this.emit(Vt.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t,i;if(!this.joinInfo||!this.key)throw new J(M.UNEXPECTED_ERROR,"can not generate join message, no join info");let r=Object.assign({},this.joinInfo.apResponse),a=B("REPORT_APP_SCENARIO");if(typeof a!="string")try{a=JSON.stringify(a)}catch{a=void 0}var s;a&&a.length>128&&(a=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Vt.UPDATE_GATEWAY_CONFIG),s=this.store.clientId,ee(vl).call(vl,s)||vl.push(s);let o=iR(this.store),c=!((t=this.isPreallocation)===null||t===void 0||!t.call(this)),d=TO(this.store),l=Jc(),h=Jn(87)||Ra()||cb(117),_=((function(){let m=pi();if(m.name!==Ot.SAFARI||!m.browserVersion)return!1;let S=m.browserVersion.split(".");return Number(S[0])>18||Number(S[0])===18&&Number(S[1])>=4})()||l1(18,4,!1))&&rO(18,6,!0)&&this.spec.codec==="h264"&&B("ENABLE_ABSSENDTIME_AS_SENTTS"),f=Za({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:dc,browser:navigator.userAgent,process_id:B("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:B("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:Za(Za({enableEncodedTransform:(!!B("ENABLE_AUDIO_METADATA")||!!B("ENABLE_AUDIO_PTS"))&&h||!!B("ENABLE_AUDIO_TOPN")&&tO(Ot.CHROME,87,116)||void 0,enableAudioMetadata:!!B("ENABLE_AUDIO_METADATA")&&h,enableAudioPts:!!B("ENABLE_AUDIO_PTS")&&h,topnSmoothLevel:B("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:B("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:B("TOPN_SWITCH_HOLD_MS"),topnAudioGain:B("TOPN_AUDIO_GAIN"),enablePublishedUserList:B("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:B("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:gc("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:gc("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:gc("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:B("USE_PUB_RTX")===!0||B("USE_SUB_RTX")===!0||void 0,disableFEC:B("DISABLE_FEC"),enableNTPReport:!!B("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:d,enableFulllinkAvSync:!!B("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:gc("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!B("FORCE_ENABLE_AUT_CC")||!mb()&&(!!B("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!B("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:gc("USE_XR","boolean"),enableLossbasedBwe:gc("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!B("FORCE_ENABLE_AUT_CC")||!mb()&&(!!B("ENABLE_AUT_CC")||void 0),enableCCFallback:gc("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:o?gc("PRE_SUB_NUM","number"):void 0,enablePubTWCC:gc("PUBLISH_TWCC","boolean"),enableSubTWCC:gc("SUBSCRIBE_TWCC","boolean"),enablePubRTX:gc("USE_PUB_RTX","boolean"),enableSubRTX:gc("USE_SUB_RTX","boolean"),enableSubSVC:B("ENABLE_SVC")?B("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0,enableSvcExtended:B("ENABLE_SVC")&&Array.isArray(B("SVC_EXTENDED"))&&B("SVC_EXTENDED").length!==0?B("SVC_EXTENDED"):void 0},l),{},{audioDuplicate:gc("ENABLE_AUDIO_RED","boolean")?(i=gc("AUDIO_DUPLICATE_NUM","number"))!==null&&i!==void 0?i:2:void 0,senttsUsesAbsSendTime:!!_||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(f.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(f.aes_mode=this.joinInfo.aesmode,B("ENCRYPT_AES")?(f.aes_secret=this.joinInfo.aespassword,f.aes_encrypt=!0):f.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(f.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(f.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(f.default_video_stream=this.joinInfo.defaultVideoStream),f}getRejoinMessage(){if(!this.joinInfo)throw new J(M.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(et.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(et.WS_RECONNECTING,e=>{this.joinInfo&&Te.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||yt.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Te.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(et.WS_CLOSED,e=>{let t;switch(e){case Vi.LEAVE:t=yt.LEAVE;break;case Vi.UID_BANNED:case Vi.IP_BANNED:case Vi.CHANNEL_BANNED:case Vi.SERVER_ERROR:t=yt.SERVER_ERROR;break;case Vi.FALLBACK:t=yt.FALLBACK;break;case Vi.LICENSE_MISSING:case Vi.LICENSE_EXPIRED:case Vi.LICENSE_MINUTES_EXCEEDED:case Vi.LICENSE_PERIOD_INVALID:case Vi.LICENSE_MULTIPLE_SDK_SERVICE:case Vi.LICENSE_ILLEGAL:case Vi.TOKEN_EXPIRE:t=e;break;default:t=yt.NETWORK_ERROR}I.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+yt.NETWORK_ERROR)),this.joinInfo&&Te.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Vi.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==Vi.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(et.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let e=B("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(I.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(Te.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void I.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Ct("EVENT_REPORT_DOMAIN",e[1]),Ct("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Ct("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on($t.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(et.REQUEST_RECOVER,(e,t,i)=>{if(!this.joinInfo)return i(new J(M.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,kn(this,Vt.REQUEST_NEW_GATEWAY_LIST).then(t).catch(i)}),this.signal.on(et.REQUEST_JOIN_INFO,async(e,t,i)=>{var r,a,s;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let o=cr((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(B("NEW_TURN_MODE")&&o&&((a=this.joinInfo)===null||a===void 0?void 0:a.cloudProxyServer)==="disabled"){var c;let _=o.servers.map(S=>"turnServerURL"in S&&B("USE_TURN_IP")?Za(Za({},S),{},{turnServerURL:zu(S.turnServerURL)}):S),f=(c=o.serversFromGateway)===null||c===void 0?void 0:c.map(S=>B("USE_TURN_IP")?Za(Za({},S),{},{turnServerURL:zu(S.turnServerURL)}):S),m=this.signal.currentURLIndex;_.length>0&&(_=[_[m%_.length]],o.servers=_),Array.isArray(f)&&f.length>0&&(f=[f[0]],o.serversFromGateway=f),I.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(m))}let{iceParameters:d,dtlsParameters:l,rtpCapabilities:h}=await kn(this,Vt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:o,cloudProxyServer:(s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:l,rtpCapabilities:h,version:"2"}}))}catch(_){t(_)}}),this.signal.on(et.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(et.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let i,r="";var a;e instanceof J?(i=((a=e.data)===null||a===void 0?void 0:a.desc)||e.code,r=e.message):i=e,Te.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(et.IS_P2P_DISCONNECTED,e=>{e(Bs(this,Vt.IS_P2P_DISCONNECTED))}),this.signal.on(et.DISCONNECT_P2P,()=>{this.emit(Vt.DISCONNECT_P2P)}),this.signal.on(et.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(et.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(et.JOIN_RESPONSE,e=>{let t=this.getCurrentGatewayAddress();this.emit(Vt.JOIN_RESPONSE,e,t)}),this.signal.on(et.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,t;this.updateTurnConfigFromSignal();let r=this.getCurrentGatewayAddress(),a=cr((e=this.joinInfo)===null||e===void 0?void 0:e.turnServer);if(B("NEW_TURN_MODE")&&a&&((t=this.joinInfo)===null||t===void 0?void 0:t.cloudProxyServer)==="disabled"){var i;let o=a.servers.map(l=>"turnServerURL"in l&&B("USE_TURN_IP")?Za(Za({},l),{},{turnServerURL:zu(l.turnServerURL)}):l),c=(i=a.serversFromGateway)===null||i===void 0?void 0:i.map(l=>B("USE_TURN_IP")?Za(Za({},l),{},{turnServerURL:zu(l.turnServerURL)}):l),d=this.signal.currentURLIndex;o.length>0&&(o=[o[d%o.length]],a.servers=o),Array.isArray(c)&&c.length>0&&(c=[c[0]],a.serversFromGateway=c),I.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(d,",in pre pc"))}let s=B("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){let o=IU(r);this.emit(Vt.PRE_CONNECT_PC,{candidates:o,fingerprint:s,turnServer:a})}}}),this.signal.on(et.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof B("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(B("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(Ne.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(i){throw I.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(Ne.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(i){throw I.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(Ne.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(i){throw I.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(Ne.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(i){throw I.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){let t={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Ne.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){throw I.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,t){let i={action:e.find(r=>r.stream_type===Ni.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(r){throw I.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,t){let i={action:e.find(r=>r.stream_type===Ni.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(r){throw I.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,t){let i={action:e===ze.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(r){throw I.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,t){let i={action:e===ze.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(r){throw I.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Ne.RESTART_ICE,t,!0)}catch(i){throw I.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,t){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,t||yt.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!B("GATEWAY_WSS_ADDRESS"))return B("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(I.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Ne.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let qO=0,RR=0;function kd(n,e,t,i){return new se((r,a)=>{e.timeout=e.timeout||B("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!t?(e.data=JSON.stringify(e.data),qO+=Vu(e.data)):t&&(e.data.size?qO+=e.data.size:e.data instanceof FormData?qO+=Fu(e.data):qO+=Vu(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=n,mr.request(e).then(s=>{typeof s.data=="string"?RR+=Vu(s.data):s.data instanceof ArrayBuffer||s.data instanceof Uint8Array?RR+=s.data.byteLength:RR+=Vu(JSON.stringify(s.data)),i&&r({data:s.data,headers:s.headers}),r(s.data)}).catch(s=>{mr.isCancel(s)?a(new J(M.OPERATION_ABORTED,"cancel token canceled")):s.code==="ECONNABORTED"?a(new J(M.NETWORK_TIMEOUT,s.message)):s.response?a(new J(M.NETWORK_RESPONSE_ERROR,s.response.status)):a(new J(M.NETWORK_ERROR,s.message))})})}(function(){var n;function e(fe){var $=0;return function(){return $<fe.length?{done:!1,value:fe[$++]}:{done:!0}}}var t=typeof Object.defineProperties=="function"?Object.defineProperty:function(fe,$,ne){return fe==Array.prototype||fe==Object.prototype||(fe[$]=ne.value),fe},i,r=(function(fe){fe=[typeof globalThis=="object"&&globalThis,fe,typeof window=="object"&&window,typeof self=="object"&&self,typeof K=="object"&&K];for(var $=0;$<fe.length;++$){var ne=fe[$];if(ne&&ne.Math==Math)return ne}throw Error("Cannot find global object")})(this);function a(fe,$){if($)e:{var ne=r;fe=fe.split(".");for(var ie=0;ie<fe.length-1;ie++){var A=fe[ie];if(!(A in ne))break e;ne=ne[A]}($=$(ie=ne[fe=fe[fe.length-1]]))!=ie&&$!=null&&t(ne,fe,{configurable:!0,writable:!0,value:$})}}function s(fe){return(fe={next:fe})[Symbol.iterator]=function(){return this},fe}function o(fe){var $=typeof Symbol<"u"&&Symbol.iterator&&fe[Symbol.iterator];return $?$.call(fe):{next:e(fe)}}if(a("Symbol",function(fe){function $(A,v){this.A=A,t(this,"description",{configurable:!0,writable:!0,value:v})}if(fe)return fe;$.prototype.toString=function(){return this.A};var ne="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ie=0;return function A(v){if(this instanceof A)throw new TypeError("Symbol is not a constructor");return new $(ne+(v||"")+"_"+ie++,v)}}),a("Symbol.iterator",function(fe){if(fe)return fe;fe=Symbol("Symbol.iterator");for(var $="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ne=0;ne<$.length;ne++){var ie=r[$[ne]];typeof ie=="function"&&typeof ie.prototype[fe]!="function"&&t(ie.prototype,fe,{configurable:!0,writable:!0,value:function(){return s(e(this))}})}return fe}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var c;e:{var d={};try{d.__proto__={a:!0},c=d.a;break e}catch{}c=!1}i=c?function(fe,$){if(fe.__proto__=$,fe.__proto__!==$)throw new TypeError(fe+" is not extensible");return fe}:null}var l=i;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _(fe){if(fe.m)throw new TypeError("Generator is already running");fe.m=!0}function f(fe,$){return fe.h=3,{value:$}}function m(fe){this.g=new h,this.G=fe}function S(fe,$,ne,ie){try{var A=$.call(fe.g.j,ne);if(!(A instanceof Object))throw new TypeError("Iterator result "+A+" is not an object");if(!A.done)return fe.g.m=!1,A;var v=A.value}catch(D){return fe.g.j=null,fe.g.s(D),T(fe)}return fe.g.j=null,ie.call(fe.g,v),T(fe)}function T(fe){for(;fe.g.h;)try{var $=fe.G(fe.g);if($)return fe.g.m=!1,{value:$.value,done:!1}}catch(ne){fe.g.v=void 0,fe.g.s(ne)}if(fe.g.m=!1,fe.g.l){if($=fe.g.l,fe.g.l=null,$.F)throw $.D;return{value:$.return,done:!0}}return{value:void 0,done:!0}}function R(fe){this.next=function($){return fe.o($)},this.throw=function($){return fe.s($)},this.return=function($){return(function(ne,ie){_(ne.g);var A=ne.g.j;return A?S(ne,"return"in A?A.return:function(v){return{value:v,done:!0}},ie,ne.g.return):(ne.g.return(ie),T(ne))})(fe,$)},this[Symbol.iterator]=function(){return this}}function C(fe,$){return $=new R(new m($)),l&&fe.prototype&&l($,fe.prototype),$}if(h.prototype.o=function(fe){this.v=fe},h.prototype.s=function(fe){this.l={D:fe,F:!0},this.h=this.C||this.u},h.prototype.return=function(fe){this.l={return:fe},this.h=this.u},m.prototype.o=function(fe){return _(this.g),this.g.j?S(this,this.g.j.next,fe,this.g.o):(this.g.o(fe),T(this))},m.prototype.s=function(fe){return _(this.g),this.g.j?S(this,this.g.j.throw,fe,this.g.o):(this.g.s(fe),T(this))},a("Array.prototype.entries",function(fe){return fe||function(){return(function($,ne){$ instanceof String&&($+="");var ie=0,A=!1,v={next:function(){if(!A&&ie<$.length){var D=ie++;return{value:ne(D,$[D]),done:!1}}return A=!0,{done:!0,value:void 0}}};return v[Symbol.iterator]=function(){return v},v})(this,function($,ne){return[$,ne]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var b=function(fe,$){for(var ne=0;ne<fe.length;ne++)$(fe[ne])},N=function(fe){return fe.replace(/\r?\n|\r/g,`\r
`)},k=function(fe,$,ne){return $ instanceof Blob?(ne=ne!==void 0?ne+"":typeof $.name=="string"?$.name:"blob",$.name===ne&&Object.prototype.toString.call($)!=="[object Blob]"||($=new File([$],ne)),[String(fe),$]):[String(fe),String($)]},P=function(fe,$){if(fe.length<$)throw new TypeError($+" argument required, but only "+fe.length+" present.")},U=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,W=U.FormData,z=U.XMLHttpRequest&&U.XMLHttpRequest.prototype.send,Q=U.Request&&U.fetch,he=U.navigator&&U.navigator.sendBeacon,Ge=U.Element&&U.Element.prototype,xe=U.Symbol&&Symbol.toStringTag;xe&&(Blob.prototype[xe]||(Blob.prototype[xe]="Blob"),"File"in U&&!File.prototype[xe]&&(File.prototype[xe]="File"));try{new File([],"")}catch{U.File=function(fe,$,ne){return fe=new Blob(fe,ne||{}),Object.defineProperties(fe,{name:{value:$},lastModified:{value:+(ne&&ne.lastModified!==void 0?new Date(ne.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),xe&&Object.defineProperty(fe,xe,{value:"File"}),fe}}var qe=function(fe){return fe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},ot=function(fe){this.i=[];var $=this;fe&&b(fe.elements,function(ne){if(ne.name&&!ne.disabled&&ne.type!=="submit"&&ne.type!=="button"&&!ne.matches("form fieldset[disabled] *"))if(ne.type==="file"){var ie=ne.files&&ne.files.length?ne.files:[new File([],"",{type:"application/octet-stream"})];b(ie,function(A){$.append(ne.name,A)})}else ne.type==="select-multiple"||ne.type==="select-one"?b(ne.options,function(A){!A.disabled&&A.selected&&$.append(ne.name,A.value)}):ne.type==="checkbox"||ne.type==="radio"?ne.checked&&$.append(ne.name,ne.value):(ie=ne.type==="textarea"?N(ne.value):ne.value,$.append(ne.name,ie))})};if((n=ot.prototype).append=function(fe,$,ne){P(arguments,2),this.i.push(k(fe,$,ne))},n.delete=function(fe){P(arguments,1);var $=[];fe=String(fe),b(this.i,function(ne){ne[0]!==fe&&$.push(ne)}),this.i=$},n.entries=function fe(){var $,ne=this;return C(fe,function(ie){if(ie.h==1&&($=0),ie.h!=3)return $<ne.i.length?ie=f(ie,ne.i[$]):(ie.h=0,ie=void 0),ie;$++,ie.h=2})},n.forEach=function(fe,$){P(arguments,1);for(var ne=o(this),ie=ne.next();!ie.done;ie=ne.next()){var A=o(ie.value);ie=A.next().value,A=A.next().value,fe.call($,A,ie,this)}},n.get=function(fe){P(arguments,1);var $=this.i;fe=String(fe);for(var ne=0;ne<$.length;ne++)if($[ne][0]===fe)return $[ne][1];return null},n.getAll=function(fe){P(arguments,1);var $=[];return fe=String(fe),b(this.i,function(ne){ne[0]===fe&&$.push(ne[1])}),$},n.has=function(fe){P(arguments,1),fe=String(fe);for(var $=0;$<this.i.length;$++)if(this.i[$][0]===fe)return!0;return!1},n.keys=function fe(){var $,ne,ie,A,v=this;return C(fe,function(D){if(D.h==1&&($=o(v),ne=$.next()),D.h!=3)return ne.done?void(D.h=0):(ie=ne.value,A=o(ie),f(D,A.next().value));ne=$.next(),D.h=2})},n.set=function(fe,$,ne){P(arguments,2),fe=String(fe);var ie=[],A=k(fe,$,ne),v=!0;b(this.i,function(D){D[0]===fe?v&&(v=!ie.push(A)):ie.push(D)}),v&&ie.push(A),this.i=ie},n.values=function fe(){var $,ne,ie,A,v=this;return C(fe,function(D){if(D.h==1&&($=o(v),ne=$.next()),D.h!=3)return ne.done?void(D.h=0):(ie=ne.value,(A=o(ie)).next(),f(D,A.next().value));ne=$.next(),D.h=2})},ot.prototype._asNative=function(){for(var fe=new W,$=o(this),ne=$.next();!ne.done;ne=$.next()){var ie=o(ne.value);ne=ie.next().value,ie=ie.next().value,fe.append(ne,ie)}return fe},ot.prototype._blob=function(){var fe="----formdata-polyfill-"+Math.random(),$=[],ne="--"+fe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ie,A){return typeof ie=="string"?$.push(ne+qe(N(A))+`"\r
\r
`+N(ie)+`\r
`):$.push(ne+qe(N(A))+'"; filename="'+qe(ie.name)+`"\r
Content-Type: `+(ie.type||"application/octet-stream")+`\r
\r
`,ie,`\r
`)}),$.push("--"+fe+"--"),new Blob($,{type:"multipart/form-data; boundary="+fe})},ot.prototype[Symbol.iterator]=function(){return this.entries()},ot.prototype.toString=function(){return"[object FormData]"},Ge&&!Ge.matches&&(Ge.matches=Ge.matchesSelector||Ge.mozMatchesSelector||Ge.msMatchesSelector||Ge.oMatchesSelector||Ge.webkitMatchesSelector||function(fe){for(var $=(fe=(this.document||this.ownerDocument).querySelectorAll(fe)).length;0<=--$&&fe.item($)!==this;);return-1<$}),xe&&(ot.prototype[xe]="FormData"),z){var xt=U.XMLHttpRequest.prototype.setRequestHeader;U.XMLHttpRequest.prototype.setRequestHeader=function(fe,$){xt.call(this,fe,$),fe.toLowerCase()==="content-type"&&(this.B=!0)},U.XMLHttpRequest.prototype.send=function(fe){fe instanceof ot?(fe=fe._blob(),this.B||this.setRequestHeader("Content-Type",fe.type),z.call(this,fe)):z.call(this,fe)}}Q&&(U.fetch=function(fe,$){return $&&$.body&&$.body instanceof ot&&($.body=$.body._blob()),Q.call(this,fe,$)}),he&&(U.navigator.sendBeacon=function(fe,$){return $ instanceof ot&&($=$._asNative()),he.call(this,fe,$)}),U.FormData=ot}})();let Sc=()=>{let n=B("AREAS");return n.length===0&&n.push(Lt.GLOBAL),Pn(n).call(n,(e,t,i)=>{let r=vR(t);return r?i===0?r:"".concat(e,",").concat(r):e},"")},vR=n=>n===Lt.OVERSEA?"".concat(Va.ASIA,",").concat(Va.EUROPE,",").concat(Va.AFRICA,",").concat(Va.NORTH_AMERICA,",").concat(Va.SOUTH_AMERICA,",").concat(Va.OCEANIA):Va[n],ZB=n=>{let e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(t=>{let i=ca[t],r=Object.keys(i);r&&r.map(a=>{a!=="CODE"&&(e[a]=e[a].concat(i[a]))})}),e},XO={GLOBAL:{ASIA:[Lt.CHINA,Lt.JAPAN,Lt.INDIA,Lt.KOREA,Lt.HKMC],EUROPE:[],NORTH_AMERICA:[Lt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},kg=Object.keys(XO[Lt.GLOBAL]),yR=[Lt.CHINA,Lt.NORTH_AMERICA,Lt.EUROPE,Lt.ASIA,Lt.JAPAN,Lt.INDIA,Lt.OCEANIA,Lt.SOUTH_AMERICA,Lt.AFRICA,Lt.KOREA,Lt.HKMC,Lt.US],MU=function(n,e){let t=[];if(ee(n).call(n,Lt.GLOBAL)){let a=[Lt.GLOBAL,Lt.OVERSEA],s=Object.keys(ca);if(e===Lt.GLOBAL)throw new J(M.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Lt.CHINA)t=[Lt.OVERSEA];else if(r=e,ee(kg).call(kg,r)){let o=(i=e,XO[Lt.GLOBAL][i]||[]),c=[...a,e,...o];t=s.filter(d=>!ee(c).call(c,d))}else if((function(o){let c=!1;return kg.forEach(d=>{var l;ee(l=XO[Lt.GLOBAL][d]).call(l,o)&&(c=!0)}),c})(e)){let o=(function(d){let l;return kg.forEach(h=>{var _;ee(_=XO[Lt.GLOBAL][h]).call(_,d)&&(l=h)}),l})(e),c=[...a,o,e];t=s.filter(d=>!ee(c).call(c,d))}else t=n;t=(function(o){let c=[];return yR.forEach(d=>{ee(o).call(o,d)&&c.push(d)}),c.concat(o.filter(d=>!ee(yR).call(yR,d)))})(t)}else t=n;var i,r;return t};function QB(n){var e,t;if(!n&&ee(e=B("AREAS")).call(e,Lt.EXTENSIONS))return I.debug("update area from ap : reset"),void JO(Db,!0);if(!ee(t=B("AREAS")).call(t,Lt.GLOBAL)||!n)return;let i=ca.EXTENSIONS;i&&(i={CODE:vR(Lt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},I.debug("update area from ap success: ".concat(n,",config is "),i),Ct("AREAS",[Lt.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Ct(r,i[r][0]):Ct(r,i[r])}))}function JO(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=Te.reportApiInvoke(null,{name:Jr.SET_AREA,options:n,tag:Gt.TRACER});try{let i=[];if(typeof n=="string"&&(i=[n]),Array.isArray(n)&&(n.forEach(a=>{if(!ee(Di).call(Di,a))throw new J(M.INVALID_PARAMS,"invalid area code")}),i=n),Object.prototype.toString.call(n)==="[object Object]"){let{areaCode:a,excludedArea:s}=n;if(!a)throw new J(M.INVALID_PARAMS,"area code is needed");let o=a;typeof a=="string"&&(o=[a]),i=s?MU(o,s):o}if(!e){if(ml.AREAS){let a=new J(M.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return t.onError(a),void I.warning("setArea is prohibited because of config-distribute")}if(ee(i).call(i,Lt.GLOBAL)&&B("AREAS")===Lt.EXTENSIONS){let a=new J(M.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return t.onError(a),void I.warning("setArea is prohibited because of ap extensions")}}Ct("AREAS",i,e);let r=ZB(i);Object.keys(r).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?Ct(a,r[a][0]):Ct(a,r[a])}),I.debug("set area success:",i.join(","))}catch(i){throw t.onError(i),i}t.onSuccess()}function ZO(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function qu(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ZO(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ZO(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let Il=1;function UU(n,e,t,i,r){Il+=1;let a={sid:t.sid,command:"convergeAllocateEdge",uid:"666",appId:t.appId,ts:Math.floor(Date.now()/1e3),seq:Il,requestId:Il,version:dc,cname:t.cname},s={service_name:e,json_body:JSON.stringify(a)},o,c,d=n[0];return Od(async()=>{o=Date.now();let l=await kd(d,{data:s,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-o,l.code!==0){let f=new J(M.UNEXPECTED_RESPONSE,"live streaming ap error, code"+l.code,{retry:!0,responseTime:c});throw I.error(f.toString()),f}let h=JSON.parse(l.json_body);if(h.code!==200){let f=new J(M.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(h.code,", reason: ").concat(h.reason),{code:h.code,responseTime:c});throw I.error(f.toString()),f}if(!h.servers||h.servers.length===0){let f=new J(M.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:h.code,responseTime:c});throw I.error(f.toString()),f}let _=(function(f,m){return{addressList:f.servers.map(S=>"wss://".concat(S.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(S.wss,"?serviceName=").concat(encodeURIComponent(m))),workerToken:f.workerToken,vid:f.vid}})(h,e);return B("LIVE_STREAMING_ADDRESS")&&(_.addressList=B("LIVE_STREAMING_ADDRESS")instanceof Array?B("LIVE_STREAMING_ADDRESS"):[B("LIVE_STREAMING_ADDRESS")]),qu(qu({},_),{},{responseTime:c})},(l,h)=>(Te.apworkerEvent(t.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(l.addressList),firstSuccess:h===0,responseTime:c,serverIp:n[h%n.length]}),!1),(l,h)=>(Te.apworkerEvent(t.sid,{success:!1,sc:l.data&&l.data.code||200,serviceName:e,responseTime:c,serverIp:n[h%n.length]}),!!(l.code!==M.OPERATION_ABORTED&&l.code!==M.UNEXPECTED_RESPONSE||l.data&&l.data.retry)&&(d=n[(h+1)%n.length],!0)),r)}let xU=1;function QO(n,e,t,i){let{url:r,areaCode:a}=n,{clientId:s,sid:o}=e,c=Date.now(),d,l=e.role,[h,_]=jU(e,a,[Rn.CHOOSE_SERVER]),f=Kr.networkState;return Od(async()=>{f&&Kr.networkState===Rr.OFFLINE&&Kr.onlineWaiter&&await se.race([Kr.onlineWaiter,va(i&&i.maxRetryTimeout||Yr.maxRetryTimeout)]),f=Kr.networkState;let{data:m,headers:S}=await kd(r,{data:h,cancelToken:t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=S.http3==="1"?1:-1,Te.reportResourceTiming(r,o),FU(m,r,e,c,[Rn.CHOOSE_SERVER],d);let T=mR(m,Rn.CHOOSE_SERVER);return $O(T),ER(T,r)},m=>(m&&Te.joinChooseServer(o,{role:l,lts:c,succ:!0,csAddr:r,opid:_,serverList:m.gatewayAddrs.map(S=>S.address),ec:null,cid:m.cid.toString(),uid:m.uid.toString(),csIp:m.csIp,unilbsServerIds:[Rn.CHOOSE_SERVER].toString(),isHttp3:d,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:m.res.detail&&m.res.detail[38]}),!1),m=>m.code!==M.OPERATION_ABORTED&&(m.code===M.CAN_NOT_GET_GATEWAY_SERVER?m.data.retry:(Te.joinChooseServer(o,{role:l,lts:c,succ:!1,csAddr:r,serverList:null,opid:_,ec:m.code,csIp:m.data&&m.data.csIp,unilbsServerIds:[Rn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:f}),isHttp3:d,corssRegionTagReq:e.apRequestDetail}),I.warning("[".concat(s||"sid-".concat(o.slice(0,6)),"] Choose server network error, retry"),m),!0)),i)}function VU(n,e,t,i){let r,{url:a,areaCode:s,serviceIds:o}=n,c=Date.now(),d=e.role,[l,h]=jU(e,s,o),_;return Od(async()=>{_&&Kr.networkState===Rr.OFFLINE&&Kr.onlineWaiter&&await se.race([Kr.onlineWaiter,va(i&&i.maxRetryTimeout||Yr.maxRetryTimeout)]),_=Kr.networkState;let{data:f,headers:m}=await kd(a,{data:l,cancelToken:t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=m.http3==="1"?1:-1,Te.reportResourceTiming(a,e.sid),FU(f,a,e,c,o,r);let S=mR(f,Rn.CHOOSE_SERVER),T=mR(f,e.cloudProxyServer==="proxy5"?Rn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Rn.CLOUD_PROXY:Rn.CLOUD_PROXY_FALLBACK),R=performance.getEntriesByName(a),C=R[R.length-1],b;return C&&(b={name:C.name,protocol:"nextHopProtocol"in C?C.nextHopProtocol:"",dnscost:"domainLookupEnd"in C&&"domainLookupStart"in C&&typeof C.domainLookupEnd=="number"&&typeof C.domainLookupStart=="number"?C.domainLookupEnd-C.domainLookupStart:-1,tcpTlsCost:"connectEnd"in C&&"connectStart"in C&&typeof C.connectEnd=="number"&&typeof C.connectStart=="number"?C.connectEnd-C.connectStart:-1,reqCost:"requestStart"in C&&typeof C.requestStart=="number"&&"responseEnd"in C&&typeof C.responseEnd=="number"?C.responseEnd-C.requestStart:-1,handleCost:"leave_ts"in f&&"enter_ts"in f&&typeof f.leave_ts=="number"&&typeof f.enter_ts=="number"?f.leave_ts-f.enter_ts:-1}),$O(S),{gatewayInfo:ER(S,a),proxyInfo:T,url:a,resourceTimingInfo:b}},f=>(f.gatewayInfo&&Te.joinChooseServer(e.sid,{role:d,lts:c,succ:!0,csAddr:a,serverList:f.gatewayInfo.gatewayAddrs.map(m=>m.address),ec:null,opid:h,cid:f.gatewayInfo.cid.toString(),uid:f.gatewayInfo.uid.toString(),csIp:f.gatewayInfo.csIp,unilbsServerIds:o.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:f.gatewayInfo.res.detail&&f.gatewayInfo.res.detail[38],resourceTimingInfo:f.resourceTimingInfo?JSON.stringify(f.resourceTimingInfo):void 0}),f.proxyInfo&&Te.joinWebProxyAP(e.sid,{lts:c,sucess:1,apServerAddr:a,turnServerAddrList:f.proxyInfo.addresses.map(m=>m.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:o.toString()}),!1),f=>f.code!==M.OPERATION_ABORTED&&(f.code===M.CAN_NOT_GET_GATEWAY_SERVER?f.data.retry:(Te.joinWebProxyAP(e.sid,{lts:c,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:f.code,eventType:e.cloudProxyServer,unilbsServerIds:o.toString(),extend:JSON.stringify({networkState:_})}),I.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),f),!0)),i)}let FU=(n,e,t,i,r,a)=>{let{sid:s,clientId:o,cloudProxyServer:c}=t,d=[],l=h=>{h.flag===4096?Te.joinChooseServer(s,{role:t.role,lts:i,succ:!1,csAddr:e,opid:n.opid,serverList:null,ec:h.error.message,csIp:h.error.data&&h.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:a,corssRegionTagReq:t.apRequestDetail}):h.flag!==1048576&&h.flag!==4194304&&h.flag!==4194310||Te.joinWebProxyAP(s,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:h.error.code,eventType:c,unilbsServerIds:r.toString()})};if(n.response_body.forEach(h=>{let _=h.buffer.code;if(h.uri===23&&_===0&&!h.buffer.edges_services)if(h.buffer.flag===4194310)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),h.buffer.edges_services=[];else{let f={error:new J(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:n.detail[502]}),flag:h.buffer.flag};d.push(f),l(f)}if(_!==0){let f=pR(_),m={error:new J(M.CAN_NOT_GET_GATEWAY_SERVER,f.desc,{desc:f.desc,retry:f.retry,csIp:n.detail[502]}),flag:h.buffer.flag};h.buffer.flag===4194310?I.warning(m.error.toString()):d.push(m),l(m)}}),d.length)throw I.warning("[".concat(o||"sid-".concat(s.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(d.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message,", retry: ").concat(h.error.data.retry)).join(" | "))),new J(M.CAN_NOT_GET_GATEWAY_SERVER,d.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message)).join(" | "),{retry:!!d.find(h=>h.error.data.retry),csIp:n.detail[502],desc:[...new Set(d.map(h=>{var _;return h==null||(_=h.error)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.desc}).filter(h=>!!h))]})},$O=n=>{var e,t,i,r;if(n.addresses&&n.addresses.length===0&&n.code===0)throw new J(M.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(B("AP_AREA")&&((i=n.detail)!==null&&i!==void 0&&i[23]&&typeof((r=n.detail)===null||r===void 0?void 0:r[23])=="string"?QB(n.detail[23].toLowerCase()):QB()),(e=n.detail)!==null&&e!==void 0&&e[19]&&typeof((t=n.detail)===null||t===void 0?void 0:t[19])=="string"){let s=n.detail[19],o=s?.split(";");for(let c=0;c<o.length;c++){var a;let d=hr(a=o[c]).call(a);n.addresses[c]&&o&&(n.addresses[c].fingerprint=d)}}if(B("GATEWAY_ADDRESS")&&B("GATEWAY_ADDRESS").length>0){I.debug("assign gateway address to",B("GATEWAY_ADDRESS"));let s=B("GATEWAY_ADDRESS").map(o=>{var c,d;let l=(c=(d=n.addresses.find(h=>h.ip===o.ip&&h.port===o.port))===null||d===void 0?void 0:d.fingerprint)!==null&&c!==void 0?c:"";return{ip:o.ip,port:o.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:l}});n.addresses=s}},BU=(n,e)=>{if(n.response_body&&n.response_body.length){let t=n.response_body[0];if(t.buffer.code!==0){let i=pR(t.buffer.code);throw new J(M.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return t.buffer.ticket}throw I.debug("update ticket request received ap response without response body:",e),new J(M.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},jU=(n,e,t)=>{let i=Math.floor(Math.random()*1e12),r=n.role==="host"?"1":n.role==="audience"?"2":void 0,a={appid:n.appId,client_ts:Date.now(),opid:i,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:qu(qu(qu({6:n.stringUid,11:e,12:B("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},n.apRequestDetail?{33:n.apRequestDetail}:{}),n.apRTM?{26:"RTM2"}:{}),key:n.token,service_ids:t,uid:n.uid||0}}]};a.request_bodies.forEach(o=>{n.multiIP&&n.multiIP.gateway_ip&&(o.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});let s=new FormData;return s.append("request",JSON.stringify(a)),[s,i]},GU=(n,e)=>{let t=Math.floor(Math.random()*1e12),i={appid:n.appId,client_ts:Date.now(),opid:t,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:e,uid:n.uid||0,edges_services:n.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,t]},CR=0;function Xu(n){return se.all(n.map(e=>e.then(t=>{throw t},t=>t))).then(e=>{throw e},e=>e)}let rp=async n=>{let{fragementLength:e,referenceList:t,asyncMapHandler:i,allFailedhandler:r,promisesCollector:a}=n,s=0,o=e,c,d=0,l=async()=>{let h=(()=>{let _=s*o,f=_+o;return t.slice(_,f).map(i)})();a&&a.push(...h);try{c=await Xu(h)}catch(_){if(d+=o,s++,!(d>=t.length))return void await l();r(_)}h.forEach(_=>_.cancel())};return await l(),c},bR=async n=>{let{referenceList:e,asyncMapHandler:t,closeFn:i}=n,r=e.length,a=0,s=async()=>{let o=t(e.shift());try{return await o}catch(c){if(a++,a>=r||i!=null&&i(c))throw c;return s()}};return s()};async function $B(){if(typeof VideoDecoder>"u")return!0;let n,e=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],r=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],a=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],s=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new se((o,c)=>{let d;(async function(){n&&n.state!=="closed"||await(async function(){n=new VideoDecoder({output:h=>{h.close(),clearTimeout(d),o(!0)},error:h=>{clearTimeout(d),o(!1)}}),await n.configure({codec:"av01.0.05M.08",width:160,height:90})})();let l=[e,t,i,r,a,s];for(let h=0;h<l.length;h++){let _=new EncodedVideoChunk({type:h==0?"key":"delta",timestamp:33333*h,duration:33333,data:new Uint8Array(l[h])});try{await n.decode(_)}catch{return void o(!1)}}})(),d=setTimeout(()=>{o(!1)},5e3)})}async function WU(n,e,t,i){return{gatewayInfo:await(async function(r,a,s,o){let c=null,d=[],l=async()=>{let _=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(S=>({url:r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(S+"/api/v2/transpond/webrtc?v=2"):"https://".concat(S,"/api/v2/transpond/webrtc?v=2"),areaCode:Sc()})),f=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_.map(S=>S.url)}),m=await rp({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:_,asyncMapHandler:S=>(I.debug("[".concat(r.clientId,"] Connect to choose_server:"),S.url),QO(S,r,a,s)),allFailedhandler:S=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:S},f),S[0]},promisesCollector:d});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},f),m},h=async()=>{if(await va(1e3),c!==null)return c;let _=B("WEBCS_DOMAIN_BACKUP_LIST").map(S=>({url:r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(S+"/api/v2/transpond/webrtc?v=2"):"https://".concat(S,"/api/v2/transpond/webrtc?v=2"),areaCode:Sc()})),f=o.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:_.map(S=>S.url)}),m=await rp({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:_,asyncMapHandler:S=>(I.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),S.url),QO(S,r,a,s)),allFailedhandler:S=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:S},f),S[0]},promisesCollector:d});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},f),m};try{return c=await Xu([l(),h()]),d.length&&d.forEach(_=>_.cancel&&typeof _.cancel=="function"&&_.cancel()),c}catch(_){throw _[0]}})(n,e,t,i)}}async function e0(n,e,t,i,r){let a=n.cloudProxyServer;if(a==="disabled"){if(n.useLocalAccessPoint)return await WU(n,e,t,r);if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:_,proxyInfo:f}=await KU(n,e,t,r);if(n.turnServer&&n.turnServer.mode!=="auto")return{gatewayInfo:_};let m=f.map(S=>({turnServerURL:S.address,tcpport:S.tcpport||wn.tcpport,udpport:S.udpport||wn.udpport,username:S.username||wn.username,password:S.password||wn.password,forceturn:!1,security:!0}));if(r.useP2P){var s;let S=(s=n.uid)!==null&&s!==void 0?s:_.uid,T="glb:".concat(S.toString()),R=await lO(T),C=f.map(b=>({turnServerURL:b.address,tcpport:b.tcpport||wn.tcpport,udpport:b.udpport||wn.udpport,username:T,password:R,forceturn:!1,security:!0}));m.push(...C)}return n.turnServer={mode:"manual",servers:m},{gatewayInfo:_}}return await WU(n,e,t,r)}let{proxyInfo:o,gatewayInfo:c}=await KU(n,e,t,r),d={gatewayInfo:c},l=o.map(_=>({turnServerURL:_.address,tcpport:a==="proxy3"?void 0:_.tcpport?_.tcpport:wn.tcpport,udpport:a==="proxy4"?void 0:_.udpport?_.udpport:wn.udpport,username:_.username||wn.username,password:_.password||wn.password,forceturn:a!=="proxy4",security:a==="proxy5"}));if(r.useP2P){var h;let _=(h=n.uid)!==null&&h!==void 0?h:c.uid,f="glb:".concat(_.toString()),m=await lO(f),S=o.map(T=>({turnServerURL:T.address,tcpport:a==="proxy3"?void 0:T.tcpport||wn.tcpport,udpport:a==="proxy4"?void 0:T.udpport||wn.udpport,username:f,password:m,forceturn:a!=="proxy4",security:a==="proxy5"}));l.push(...S)}return n.turnServer={mode:"manual",servers:l},I.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(a)),d}async function HU(n,e,t,i,r){let a=B("ACCOUNT_REGISTER").slice(0,B("AJAX_REQUEST_CONCURRENT")),s=[];s=e.proxyServer?a.map(c=>"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1")):a.map(c=>"https://".concat(c,"/api/v1"));let o=r?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s});try{let c=await(async function(d,l,h,_,f){let m=Date.now(),S={sid:h.sid,opid:10,appid:h.appId,string_uid:l},T=d[0],R=await Od(()=>kd(T+"".concat(T.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(C,b)=>{if(C.code===0){if(C.uid<=0||C.uid>=Math.pow(2,32))throw I.error("Invalid Uint Uid ".concat(l," => ").concat(C.uid),C),Te.reqUserAccount(S.sid,{lts:m,success:!1,serverAddr:T,stringUid:S.string_uid,uid:C.uid,errorCode:M.INVALID_UINT_UID_FROM_STRING_UID,extend:S}),new J(M.INVALID_UINT_UID_FROM_STRING_UID);return Te.reqUserAccount(S.sid,{lts:m,success:!0,serverAddr:T,stringUid:S.string_uid,uid:C.uid,errorCode:null,extend:S}),!1}let N=pR(C.code);return N.retry&&(T=d[(b+1)%d.length]),Te.reqUserAccount(S.sid,{lts:m,success:!1,serverAddr:T,stringUid:S.string_uid,uid:C.uid,errorCode:N.desc,extend:S}),N.retry},(C,b)=>C.code!==M.OPERATION_ABORTED&&(Te.reqUserAccount(S.sid,{lts:m,success:!1,serverAddr:T,stringUid:S.string_uid,uid:null,errorCode:C.code,extend:S}),T=d[(b+1)%d.length],!0),f);if(R.code!==0){let C=pR(R.code);throw new J(M.UNEXPECTED_RESPONSE,C.desc)}return R})(s,n,e,t,i);return r?.recordJoinChannelService({status:"success",endTs:Date.now()},o),c.uid}catch(c){throw r?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c]},o),c}}async function ej(n,e,t){let i=B("ACCOUNT_REGISTER"),r=[];r=e.proxyServer?i.map(a=>"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v1")):i.map(a=>"https://".concat(a,"/api/v1"));try{return await bR({referenceList:r,asyncMapHandler:a=>(async function(s,o,c,d){let l=Date.now(),h={sid:c.sid,opid:10,appid:c.appId,string_uid:o};try{let _=await kd(s+"".concat(s.indexOf("?")===-1?"?":"&","action=stringuid"),{data:h,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(_.code!==0){let f=pR(_.code);throw new J(M.UNEXPECTED_RESPONSE,"preload sua error:".concat(f.desc),f)}if(_.uid<=0||_.uid>=Math.pow(2,32))throw new J(M.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:l,url:s,req:h,uid:_.uid,elapse:Date.now()-l}}catch(_){throw _}})(a,n,e,t),closeFn:a=>a.code===M.OPERATION_ABORTED||a.code===M.UNEXPECTED_RESPONSE&&!a.data.retry})}catch(a){throw a}}async function CH(n,e,t){let i=B("CDS_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(c=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(c+"/api/v1"):"https://".concat(c,"/api/v1?action=config")),r=i.map(c=>(function(d,l,h,_){let f=pi(),m={flag:64,cipher_method:0,features:qu(qu(qu(qu(qu({install_id:gO(),device:f.name,system:f.os,system_general:navigator.userAgent,vendor:l.appId,version:dc,cname:l.cname,session_id:l.sid,proxyServer:l.proxyServer,sdk_type:yH.WEB_RTC,browser_name:f.name,browser_version:f.version,user_agent:navigator.userAgent,channel_name:l.cname},l.stringUid&&{string_uid:l.stringUid}),l.uid&&{uid:l.uid+""}),f.os&&{os_name:f.os}),f.osVersion&&{os_version:f.osVersion}),{},{detail:""})};return Od(()=>kd(d,{data:m,timeout:1e3,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,S=>S.code!==M.OPERATION_ABORTED,_)})(c,n,e,t)),a=null,s=null,o={};try{a=await Xu(r)}catch(c){if(c.code===M.OPERATION_ABORTED)throw c;s=c}if(r.forEach(c=>c.cancel()),Te.reportApiInvoke(n.sid,{name:Jr.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:a}}).onSuccess(),a&&a.test_tags)try{o=(function(c){if(!c.test_tags)return{};let d=c.test_tags,l=Object.keys(d),h={};return l.forEach(_=>{var f;let m=hr(f=_.slice(4)).call(f),S=JSON.parse(d[_]),T=S[1];h[m]={tag:S[0]||"",value:T}}),h})(a)}catch{}return o}async function tj(n,e){let t=B("WEBCS_DOMAIN").concat(B("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Sc(),serviceIds:[Rn.CHOOSE_SERVER,Rn.CLOUD_PROXY_FALLBACK]}));try{return await bR({referenceList:t,asyncMapHandler:i=>(async function(r,a,s){let o,{url:c,areaCode:d,serviceIds:l}=r,h=Date.now(),[_,f]=jU(a,d,l),m=Kr.networkState;try{m&&Kr.networkState===Rr.OFFLINE&&Kr.onlineWaiter&&await se.race([Kr.onlineWaiter,va(Yr.maxRetryTimeout)]),m=Kr.networkState;let{data:S,headers:T}=await kd(c,{data:_,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=T.http3==="1"?1:-1,(b=>{let N=[];if(b.response_body.forEach(k=>{let P=k.buffer.code;if(k.uri===23&&P===0&&!k.buffer.edges_services)if(k.buffer.flag===4194310)k.buffer.edges_services=[];else{let U={error:new J(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:b.detail[502]}),flag:k.buffer.flag};N.push(U)}if(P!==0){let U=pR(P),W={error:new J(M.CAN_NOT_GET_GATEWAY_SERVER,U.desc,{desc:U.desc,retry:U.retry,csIp:b.detail[502]}),flag:k.buffer.flag};k.buffer.flag===4194310?I.warning(W.error.toString()):N.push(W)}}),N.length)throw new J(M.CAN_NOT_GET_GATEWAY_SERVER,N.map(k=>"flag: ".concat(k.flag,", message: ").concat(k.error.message)).join(" | "),{retry:!!N.find(k=>k.error.data.retry),csIp:b.detail[502],desc:[...new Set(N.map(k=>{var P;return k==null||(P=k.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(k=>!!k))]})})(S);let R=mR(S,Rn.CHOOSE_SERVER),C=mR(S,Rn.CLOUD_PROXY_FALLBACK);return $O(R),{gatewayInfo:ER(R,c),proxyInfo:C,opid:f,requestTime:h,url:c,isHttp3:o,elapse:Date.now()-h}}catch(S){throw S}})(i,n,e),closeFn:i=>i.code===M.OPERATION_ABORTED||i.code===M.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(i){throw i}}async function KU(n,e,t,i){let r=B("PROXY_SERVER_TYPE3"),a=(f,m,S)=>{let T=S||r;return Array.isArray(T)&&(T=m%2==0&&r[1]||r[0]),"https://".concat(T,"/ap/?url=").concat(f)},s=null,o=[],c=async()=>{let f=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((T,R)=>{let C;return C=n.cloudProxyServer==="disabled"&&n.proxyServer?a("".concat(T,"/api/v2/transpond/webrtc?v=2"),R,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(T,"/api/v2/transpond/webrtc?v=2"):a("".concat(T,"/api/v2/transpond/webrtc?v=2"),R),{url:C,areaCode:Sc(),serviceIds:[Rn.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Rn.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Rn.CLOUD_PROXY:Rn.CLOUD_PROXY_FALLBACK]}}),m=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:f.map(T=>T.url)}),S=await rp({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:T=>(I.debug("[".concat(n.clientId,"] Connect to choose_server:"),T.url),VU(T,n,e,t)),allFailedhandler:T=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:T},m),T[0]},promisesCollector:o});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},m),S},d=async()=>{if(await va(1e3),s!==null)return s;let f=B("WEBCS_DOMAIN_BACKUP_LIST").map((T,R)=>{let C;return C=n.cloudProxyServer==="disabled"&&n.proxyServer?a("".concat(T,"/api/v2/transpond/webrtc?v=2"),R,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(T,"/api/v2/transpond/webrtc?v=2"):a("".concat(T,"/api/v2/transpond/webrtc?v=2"),R),{url:C,areaCode:Sc(),serviceIds:[Rn.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Rn.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Rn.CLOUD_PROXY:Rn.CLOUD_PROXY_FALLBACK]}}),m=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:f.map(T=>T.url)}),S=await rp({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:T=>(I.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),T.url),VU(T,n,e,t)),allFailedhandler:T=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:T},m),T[0]},promisesCollector:o});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},m),S},l,h,_;try{({gatewayInfo:l,proxyInfo:h,url:_}=await Xu([c(),d()]))}catch(f){throw f[0]}if(o.length&&o.forEach(f=>f.cancel&&typeof f.cancel=="function"&&f.cancel()),!l||!h)throw new J(M.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=_,n.cloudProxyServer!=="disabled"&&Array.isArray(r)&&_){let f=/^https?:\/\/(.+?)(\/.*)?$/.exec(_)[1];ee(r).call(r,f)&&(n.proxyServer=f,I.setProxyServer(f),Te.setProxyServer(f))}return s={gatewayInfo:l,proxyInfo:await gR(h,l.uid)},s}async function ij(n,e,t){let i=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(a=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap")),r=i.map(a=>(function(s,o,c,d){let l={command:"convergeAllocateEdge",sid:o.sid,appId:o.appId,token:o.token,ts:Date.now(),version:dc,cname:o.cname,uid:o.uid.toString(),requestId:xU,seq:xU};xU+=1;let h={service_name:"tele_channel",json_body:JSON.stringify(l)};return Od(async()=>{let _=await kd(s,{data:h,cancelToken:c,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_.code!==0){let m=new J(M.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_.code,{retry:!0});throw I.error(m.toString()),m}let f=JSON.parse(_.json_body);if(f.code!==200){let m=new J(M.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(f.code,", reason: ").concat(f.reason));throw I.error(m.toString()),m}if(!f.servers||f.servers.length===0){let m=new J(M.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw I.error(m.toString()),m}return{vid:f.vid,workerToken:f.workerToken,addressList:(B("CHANNEL_MEDIA_RELAY_SERVERS")||f.servers).map(m=>"wss://".concat(m.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(m.wss))}},void 0,_=>!!(_.code!==M.OPERATION_ABORTED&&_.code!==M.UNEXPECTED_RESPONSE||_.data&&_.data.retry),d)})(a,n,e,t));try{let a=await Xu(r);return r.forEach(s=>s.cancel()),a}catch(a){throw a[0]}}async function bH(n,e,t){let i=null,r=[],a=async s=>{let o=B(s?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(c=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(c+"/api/v2/transpond/webrtc?v=2"):"https://".concat(c,"/api/v2/transpond/webrtc?v=2"));return s&&(await va(1e3),i!==null)?i:await rp({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:c=>(I.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(s?"backup":""," choose_server:"),c),(function(d,l,h,_){let[f]=GU(l,[Rn.CHOOSE_SERVER]),m=Kr.networkState;return Od(async()=>{m&&Kr.networkState===Rr.OFFLINE&&Kr.onlineWaiter&&await se.race([Kr.onlineWaiter,va(_&&_.maxRetryTimeout||Yr.maxRetryTimeout)]),m=Kr.networkState;let S=await kd(d,{data:f,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0);return BU(S,d)},()=>!1,S=>S.code!==M.OPERATION_ABORTED&&(S.code===M.UPDATE_TICKET_FAILED?S.data.retry:(I.warning("[".concat(l.clientId,"] update ticket network error, retry"),S),!0)),_)})(c,n,e,t)),allFailedhandler:c=>{throw c[0]},promisesCollector:r})};try{return i=await Xu([a(!1),a(!0)]),r.length&&r.forEach(s=>s.cancel&&typeof s.cancel=="function"&&s.cancel()),i}catch(s){throw s[0]}}function rj(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function t0(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?rj(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):rj(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class YU extends Sr{get isSuccess(){return!!this.configs}constructor(e,t){super(),F(this,"configs",void 0),F(this,"store",void 0),F(this,"joinInfo",void 0),F(this,"cancelToken",void 0),F(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),F(this,"interval",void 0),F(this,"mutex",void 0),F(this,"mutableParamsRead",!1),F(this,"configCache",{}),F(this,"limit_bitrate",void 0),this.mutex=new xa("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),B("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},B("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Te.reportApiInvoke(null,{options:void 0,name:Jr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Gt.TRACER}).onSuccess(JSON.stringify(ml))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void I.debug("[config-distribute] get config distribute interrupted have no joininfo");let e,t=await this.mutex.lock();try{e=await CH(this.joinInfo,this.cancelToken,this.retryConfig),I.debug("[config-distribute] get config distribute",JSON.stringify(e));let i=(function(r){var a;let s=vt(a=Object.keys(r).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(a);for(let d=0;d<s.length;d++)for(let l=s.length-1;l>d;l--){let h=s[l],_=r[h].value;if(typeof _.__priority=="number"){let f=_.__priority,m=s[l-1],S=r[m].value;if(typeof S.__priority=="number"){if(!(f>S.__priority))continue;{let T=h;s[l]=s[l-1],s[l-1]=T}}else{let T=h;s[l]=s[l-1],s[l-1]=T}}}let o=Date.now(),c={};return s.forEach(d=>{let l=r[d].value.__expires;l&&l<=o||(c[d]=r[d])}),c})(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){let r=new J(M.NETWORK_RESPONSE_ERROR,i);I.warning("[config-distribute] ".concat(r.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){hR(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(uE.UPDATE_BITRATE_LIMIT,e):this.emit(uE.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&t0({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{let t={},i=Object.keys(e),r=[];i.forEach(a=>{let s=e[a].value;t[a]=s;let o=s.__id;if(o&&this.configCache[a]&&this.configCache[a].__id===o)return;let c=s.__type,d=e[a].value,l=e[a].tag,h=0;c?c===G.REALTIME&&(h=1):Object.keys(d).some(_=>Object.prototype.hasOwnProperty.call(Eb,_)||!u_()&&Object.prototype.hasOwnProperty.call(Qn,_)?(h=1,!0):void 0),r.push({tag:l,isApplied:h,feature:a,params:JSON.stringify(s)})}),r.forEach(a=>{let{tag:s,feature:o,params:c,isApplied:d}=a;this.store.sessionId&&Te.abTest(this.store.sessionId,{intSucc:1,isApplied:d,tag:s,feature:o,params:c,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=t}catch(t){I.debug("handleABTestConfigDistribute error",t)}}cacheGlobalParameterConfig(e){let t=(function(r){let a={};return Object.keys(r).forEach(s=>{let o=r[s].value,c=o.__expires,d=o.__type;Object.keys(o).forEach(l=>{l==="__id"||l==="__type"||l==="__priority"||l==="__expires"||Object.prototype.hasOwnProperty.call(a,l)||(a[l]=t0(t0({value:o[l]},c&&{expires:c}),d&&{type:d}))})}),a})(e);try{var i;let r=(i=t.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete t.LIMIT_BITRATE,r&&hR(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),(function(o){try{let c=Date.now();Object.keys(o).forEach(d=>{let{value:l,type:h,expires:_}=o[d];_&&_<=c||((h===G.REALTIME||Object.prototype.hasOwnProperty.call(Eb,d))&&(ml[d]=l,dr[d]=l,I.debug("Update realtime parameters from config distribute",d,l)),h||u_()||!Object.prototype.hasOwnProperty.call(Qn,d)||(ml[d]=l,dr[d]=l,I.debug("Update gateway parameters from config distribute",d,l)))})}catch(c){I.error("Error update config immediately: ".concat(o),c.message)}})(t);let a=JSON.stringify(t),s=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",s),I.debug("Caching global parameters ".concat(a))}catch(r){I.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{let t=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(dr,i)){let{value:r,expires:a}=e[i];if(a&&a<=t)return;(function(s,o){try{return typeof s=="object"&&typeof o=="object"&&JSON.stringify(s)===JSON.stringify(o)}catch{return!1}})(dr[i],r)||(ml[i]=r,dr[i]=r,this.emit(uE.UPDATE_CLIENT_ROLE_OPTIONS,r),I.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(t){I.error("Error handling global parameter config:",t.message)}}}class AH extends Sr{constructor(){super(...arguments),F(this,"resultStorage",new Map)}setLocalAudioStats(e,t,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,t))}setLocalVideoStats(e,t,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i)),!t.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(i))}setRemoteAudioStats(e,t){let i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(t))}record(e,t,i){if(B("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let r=this.resultStorage.get(e);if(!r)return;r.result.push(i);let a=e==="VIDEO_ENCODE_FAILED"?B("ENCODE_EXCEPTION_TIMES"):5;if(r.result.length>=a){var s;let o=ee(s=r.result).call(s,!0);r.isPrevNormal&&!o&&this.emit("exception",zU[e],e,t),!r.isPrevNormal&&o&&this.emit("exception",zU[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=o,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,t){return t instanceof Un&&!t.isActive||!!t.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,t){let i=null;t._encoderConfig&&t._encoderConfig.frameRate&&(i=po(t._encoderConfig.frameRate));let r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var t;return!(!e.codecType||ee(t=B("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(t,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||e.sendFrameRate!==0||e.sendResolutionWidth!==0||e.sendResolutionHeight!==0}checkSendVideoBitrate(e,t){return!!t.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,t){return t instanceof Un&&!t.isActive||!!t.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}let zU={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Ia=new class{markSubscribeStart(n,e){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(e))}markPublishStart(n,e){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(e))}measureFromSubscribeStart(n,e){let t=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(e));if(t.length>0){let i=t[t.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(n,e){let t=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(e));if(t.length>0){let i=t[t.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function ja(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function _E(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ja(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ja(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Ju{constructor(e){F(this,"store",void 0),F(this,"onStatsException",void 0),F(this,"onUploadPublishDuration",void 0),F(this,"onStatsChanged",void 0),F(this,"onVideoCodecChanged",void 0),F(this,"localStats",new Map),F(this,"remoteStats",new Map),F(this,"updateStatsInterval",void 0),F(this,"trafficStats",void 0),F(this,"trafficStatsPeerList",[]),F(this,"uplinkStats",void 0),F(this,"exceptionMonitor",void 0),F(this,"p2pChannel",void 0),F(this,"scalabilityMode",nE.L1T1),F(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new AH,this.exceptionMonitor.on("exception",(t,i,r)=>{this.onStatsException&&this.onStatsException(t,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ae.LocalAudioTrack)||_E({},Mo)}getLocalVideoTrackStats(){return this.localStats.get(Ae.LocalVideoTrack)||_E({},gb)}getRemoteAudioTrackStats(e){let t=(a,s)=>{if(!this.trafficStats)return s;let o=this.trafficStats.peer_delay.find(c=>c.peer_uid===a);return o&&(s.publishDuration=o.B_ppad+(Date.now()-this.trafficStats.timestamp)),s},i={};if(e){var r;let a=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;a&&(i[e]=t(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[s,{audioStats:o}]=a;o&&(i[s]=t(s,o))});return i}getRemoteNetworkQualityStats(e){let t={};if(e){var i;let r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{networkStats:s}]=r;s&&(t[a]=s)});return t}getRemoteVideoTrackStats(e){let t=(a,s)=>{if(!this.trafficStats)return s;let o=this.trafficStats.peer_delay.find(c=>c.peer_uid===a);return o&&(s.publishDuration=o.B_ppvd+(Date.now()-this.trafficStats.timestamp)),s},i={};if(e){var r;let a=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;a&&(i[e]=t(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[s,{videoStats:o}]=a;o&&(i[s]=t(s,o))});return i}getRTCStats(){let e=0,t=0,i=0,r=0,a=this.localStats.get(Ae.LocalAudioTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate);let s=this.localStats.get(Ae.LocalVideoTrack);s&&(e+=s.sendBytes,t+=s.sendBitrate);let o=this.localStats.get(Ae.LocalVideoLowTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate),this.remoteStats.forEach(d=>{let{audioStats:l,videoStats:h}=d;l&&(i+=l.receiveBytes,r+=l.receiveBitrate),h&&(i+=h.receiveBytes,r+=h.receiveBitrate)});let c=1;return this.trafficStats&&(c+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c,SendBitrate:t,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(t=>t.B_ppad!==void 0||t.B_ppvd!==void 0),e.peer_delay.filter(t=>this.trafficStatsPeerList.indexOf(t.peer_uid)===-1).forEach(t=>{var i;let r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(t.peer_uid),a=r!=null&&r.videoSSRC?Ia.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,s=r!=null&&r.audioSSRC?Ia.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;t.B_ppad!==void 0&&t.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(t.peer_uid,t.B_ppad,t.B_ppvd,a>s?a:s),this.trafficStatsPeerList.push(t.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&I.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,i){if(!e)return!1;let r=!!i&&t.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||t.framesDecodeCount>i.framesDecodeCount;return r||!a}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[i,r]=t;switch(i){case Ae.LocalVideoTrack:case Ae.LocalVideoLowTrack:{let o=r,c=_E({},gb),d=e.getStats(),l=e.getLocalMedia(i);if(d){let h=d.videoSend.find(_=>_.ssrc===l?.ssrcs[0].ssrcId);if(h){let _=e.getLocalVideoSize(),f=e.getEncoderConfig(Ae.LocalVideoTrack);var a;(h.codec==="H264"||h.codec==="H265"||h.codec==="VP8"||h.codec==="VP9"||h.codec==="AV1X"||h.codec==="AV1")&&(c.codecType=h.codec,o?.codecType!==h.codec&&((a=this.onVideoCodecChanged)===null||a===void 0||a.call(this,h.codec.toLocaleLowerCase()))),c.sendBytes=h.bytes,c.sendBitrate=o?8*Math.max(0,c.sendBytes-o.sendBytes):0,h.inputFrame?(c.captureFrameRate=h.inputFrame.frameRate,c.captureResolutionHeight=h.inputFrame.height,c.captureResolutionWidth=h.inputFrame.width):_&&(c.captureResolutionWidth=_.width,c.captureResolutionHeight=_.height),h.sentFrame?(c.sendFrameRate=h.sentFrame.frameRate,c.sendResolutionHeight=h.sentFrame.height,c.sendResolutionWidth=h.sentFrame.width):_&&(c.sendResolutionWidth=_.width,c.sendResolutionHeight=_.height),h.avgEncodeMs&&(c.encodeDelay=h.avgEncodeMs),f&&f.bitrateMax?c.targetSendBitrate=1e3*f.bitrateMax:h.targetBitrate&&(c.targetSendBitrate=h.targetBitrate),c.sendPackets=h.packets,c.sendPacketsLost=h.packetsLost,c.sendJitterMs=h.jitterMs,c.sendRttMs=h.rttMs,c.totalDuration=o?o.totalDuration+1:1,c.totalFreezeTime=o?o.totalFreezeTime:0,this.isLocalVideoFreeze(h)&&(c.totalFreezeTime+=1),h.scalabilityMode&&this.scalabilityMode!==h.scalabilityMode&&(I.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(h.scalabilityMode)),this.scalabilityMode=h.scalabilityMode)}this.trafficStats&&(c.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(i,c),(o?.sendResolutionWidth!==c.sendResolutionWidth||o?.sendResolutionHeight!==c.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:c.sendResolutionWidth,height:c.sendResolutionHeight})),c&&l&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,l.track,c);break}case Ae.LocalAudioTrack:{let o=r,c=_E({},Mo),d=e.getStats(),l=e.getLocalMedia(i);if(d){let h=d.audioSend.find(_=>_.ssrc===l?.ssrcs[0].ssrcId);if(h){if(h.codec!=="opus"&&h.codec!=="aac"&&h.codec!=="PCMU"&&h.codec!=="PCMA"&&h.codec!=="G722"||(c.codecType=h.codec),h.inputLevel)c.sendVolumeLevel=Math.round(32767*h.inputLevel);else{let _=e.getLocalAudioVolume();_&&(c.sendVolumeLevel=Math.round(32767*_))}c.sendBytes=h.bytes,c.sendPackets=h.packets,c.sendPacketsLost=h.packetsLost,c.sendJitterMs=h.jitterMs,c.sendRttMs=h.rttMs,c.sendBitrate=o?8*Math.max(0,c.sendBytes-o.sendBytes):0}}this.trafficStats&&(c.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ae.LocalAudioTrack,c),c&&l&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,l.track,c);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var i,r;let[a,{videoStats:s,audioStats:o,videoPcStats:c}]=t,d=o,l=s,h=c,_=_E({},yO),f=_E({},wB),m=_E({},IB),{audioTrack:S,videoTrack:T,audioSSRC:R,videoSSRC:C}=e.getRemoteMedia(a),b;b=this.store.useP2P?e.getStats(!0):e.getStats();let N=(i=b)===null||i===void 0?void 0:i.audioRecv.find(W=>W.ssrc===R),k=(r=b)===null||r===void 0?void 0:r.videoRecv.find(W=>W.ssrc===C),P=this.trafficStats&&this.trafficStats.peer_delay.find(W=>W.peer_uid===a);if(N&&(N.codec!=="opus"&&N.codec!=="aac"&&N.codec!=="PCMU"&&N.codec!=="PCMA"&&N.codec!=="G722"||(_.codecType=N.codec),N.outputLevel?_.receiveLevel=Math.round(32767*N.outputLevel):S&&(_.receiveLevel=Math.round(32767*S.getVolumeLevel())),_.receiveBytes=N.bytes,_.receivePackets=N.packets,_.receivePacketsLost=N.packetsLost,_.receivePacketsDiscarded=N.packetsDiscarded,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=d?8*Math.max(0,_.receiveBytes-d.receiveBytes):0,_.totalDuration=d?d.totalDuration+1:1,_.totalFreezeTime=d?d.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=N.jitterBufferMs,_.totalDuration>10&&Ju.isRemoteAudioFreeze(S)&&(_.totalFreezeTime+=1)),k){var U;k.codec!=="H264"&&k.codec!=="H265"&&k.codec!=="VP8"&&k.codec!=="VP9"&&k.codec!=="AV1X"&&k.codec!=="AV1"||(f.codecType=k.codec),f.receiveBytes=k.bytes,f.receiveBitrate=l?8*Math.max(0,f.receiveBytes-l.receiveBytes):0,f.decodeFrameRate=k.decodeFrameRate<0?0:k.decodeFrameRate,f.renderFrameRate=k.decodeFrameRate<0?0:k.decodeFrameRate,k.outputFrame&&(f.renderFrameRate=k.outputFrame.frameRate),k.receivedFrame?(f.receiveFrameRate=k.receivedFrame.frameRate,f.receiveResolutionHeight=k.receivedFrame.height,f.receiveResolutionWidth=k.receivedFrame.width):T&&(f.receiveResolutionHeight=T._videoHeight||0,f.receiveResolutionWidth=T._videoWidth||0),k.framesRateFirefox!==void 0&&(f.receiveFrameRate=Math.round(k.framesRateFirefox)),f.receivePackets=k.packets,f.receivePacketsLost=k.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost);let W=l?l.totalFreezeTime:0,z=l?l.totalDuration:0;f.totalDuration=l?l.totalDuration+1:1,f.totalFreezeTime=(U=k.totalFreezesDuration)!==null&&U!==void 0?U:W||0,f.receiveDelay=k.jitterBufferMs||0;let Q=!!C&&e.getRemoteVideoIsReady(C);k.totalFreezesDuration===void 0&&T&&Q&&Ju.isRemoteVideoFreeze(T,k,h)&&(f.totalFreezeTime+=1),f.freezeRate=Math.max(0,Math.min((f.totalFreezeTime-W)/(f.totalDuration-z),1))}P&&(_.end2EndDelay=P.B_ad,f.end2EndDelay=P.B_vd,_.transportDelay=P.B_ed,f.transportDelay=P.B_ed,_.currentPacketLossRate=P.B_ealr4/100,f.currentPacketLossRate=P.B_evlr4/100,m.uplinkNetworkQuality=P.B_punq?P.B_punq:0,m.downlinkNetworkQuality=P.B_pdnq?P.B_pdnq:0),this.remoteStats.set(a,{audioStats:_,videoStats:f,videoPcStats:k,networkStats:m}),S&&this.exceptionMonitor.setRemoteAudioStats(S,_),T&&this.exceptionMonitor.setRemoteVideoStats(T,f)})}}class AR{constructor(){F(this,"destChannelMediaInfos",new Map),F(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Nn(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Nn(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Pt(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function qU(n){if(!(n instanceof AR))return new J(M.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let e=n.getSrcChannelMediaInfo(),t=n.getDestChannelMediaInfo();if(!e)return new J(M.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(t.size===0)return new J(M.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class g_{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){F(this,"uid",void 0),F(this,"_uintid",void 0),F(this,"_trust_in_room_",!0),F(this,"_trust_audio_enabled_state_",!0),F(this,"_trust_video_enabled_state_",!0),F(this,"_trust_audio_mute_state_",!0),F(this,"_trust_video_mute_state_",!0),F(this,"_audio_muted_",!1),F(this,"_video_muted_",!1),F(this,"_audio_enabled_",!0),F(this,"_video_enabled_",!0),F(this,"_audio_added_",!1),F(this,"_video_added_",!1),F(this,"_is_pre_created",!1),F(this,"_video_pre_subscribed",!1),F(this,"_audio_pre_subscribed",!1),F(this,"_trust_video_stream_added_state_",!0),F(this,"_trust_audio_stream_added_state_",!0),F(this,"_audioTrack",void 0),F(this,"_videoTrack",void 0),F(this,"_dataChannels",[]),F(this,"_audioSSRC",void 0),F(this,"_videoSSRC",void 0),F(this,"_audioOrtc",void 0),F(this,"_videoOrtc",void 0),F(this,"_cname",void 0),F(this,"_rtxSsrcId",void 0),F(this,"_videoMid",void 0),F(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function S_(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function i0(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?S_(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):S_(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let IR="9",wR=2e4,OR=4e4;function Yb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function np(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Yb(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Yb(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var Zc=(function(n){return n[n.DOWN=0]="DOWN",n[n.UP=1]="UP",n})(Zc||{});let T_=new Map;function zb(n,e,t,i){let{scale:r}=n;if(r===0&&i===Zc.UP||r>=e.length-1&&i===Zc.DOWN)return n;let a=np(np({},n),{},{scale:i===Zc.DOWN?++r:--r});switch(t){case"maintain-framerate":a=np(np({},a),e[r].motion);break;case"maintain-resolution":a=np(np({},a),e[r].detail);break;case"balanced":a=np(np({},a),e[r].balanced)}return a}function XU(n,e){if(e){let t={overUse:0,underUse:0,adaptationList:JU(e)};T_.set(n,t)}else T_.delete(n)}function JU(n){let e=np({},n),{bitrateMax:t,frameRate:i,scaleResolutionDownBy:r,bitrateMin:a}=e,{MIN_FRAME_RATE:s,MAX_THRESHOLD_FRAMERATE:o,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:d,BITRATE_MAX_THRESHOLD:l,BWE_SCALE_UP_THRESHOLD:h,BWE_SCALE_DOWN_THRESHOLD:_,PERF_SCALE_DOWN_THRESHOLD:f,PERF_SCALE_UP_THRESHOLD:m,BALANCE_BITRATE_FACTOR:S,BALANCE_FRAMERATE_FACTOR:T,BALANCE_RESOLUTION_FACTOR:R,MOTION_RESOLUTION_FACTOR:C,MOTION_BITRATE_FACTOR:b,DETAIL_FRAMERATE_FACTOR:N,DETAIL_BITRATE_FACTOR:k}=$T,P=Math.min(e.frameRate,o),U=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(_,1)*t),bwe_up:t,fps_down:Math.round(Math.pow(f,1)*P),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:t,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:t,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:t,bitrateMin:a}}];for(let W=1;W<=c;W++){let z={bwe_up:Math.round(Math.pow(h,W)*t),bwe_down:Math.round(Math.pow(_,W+1)*t),fps_up:Math.round(Math.pow(m,W)*P),fps_down:Math.round(Math.pow(f,W+1)*P)},Q={scaleResolutionDownBy:r/Math.pow(R,W),frameRate:Math.max(Math.round(Math.pow(T,W)*i),s),bitrateMax:Math.max(Math.round(Math.pow(S,W)*t),l),bitrateMin:Math.max(Math.round(Math.pow(S,W)*a),d)},he={scaleResolutionDownBy:r/Math.pow(C,W),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(b,W)*t),l),bitrateMin:Math.max(Math.round(Math.pow(b,W)*a),d)},Ge={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(N,W)*i),s),bitrateMax:Math.max(Math.round(Math.pow(k,W)*t),l),bitrateMin:Math.max(Math.round(Math.pow(k,W)*a),d)};U.push({scale:W,threshold:z,balanced:Q,motion:he,detail:Ge})}return U}function nj(n,e,t,i,r,a){let s=T_.get(n)||{overUse:0,underUse:0,adaptationList:JU(r)},{adaptationList:o}=s;T_.set(n,s);let{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:d}=$T,{scale:l}=i,h,_;return typeof e=="number"&&e>0&&(function(f,m,S,T){if(m>=S.length)return!1;let{threshold:{fps_down:R}}=S[m];return B("FORCE_AG_HIGH_FRAMERATE")&&T==="maintain-framerate"&&(R=S[0].threshold.fps_down),f<R})(e,l,o,a)&&(s.overUse++,_=_b.CPU,s.overUse>c)||typeof t=="number"&&t>0&&(function(f,m,S){if(m>=S.length)return!1;let{threshold:{bwe_down:T}}=S[m];return f<T})(t,l,o)&&(s.overUse++,_=_b.BANDWIDTH,s.overUse>c)?(s.overUse=0,s.underUse=0,h=zb(i,o,a,Zc.DOWN),[h,_]):(typeof e=="number"&&e>0&&typeof t=="number"&&t>0&&(function(f,m,S,T){if(m===0)return;let{threshold:{fps_up:R}}=S[m];return B("FORCE_AG_HIGH_FRAMERATE")&&T==="maintain-framerate"&&(R=S[1].threshold.fps_up),f>R})(e,l,o,a)&&(function(f,m,S){if(m===0)return;let{threshold:{bwe_up:T}}=S[m];return f>T})(t,l,o)&&(s.underUse++,s.underUse>d&&(s.overUse=0,s.underUse=0,h=zb(i,o,a,Zc.UP),h.scale===0&&(_=_b.NONE))),[h,_])}function aj(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function r0(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?aj(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):aj(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let NR=new Map;function Mg(n,e){let t=NR.get(n);if(t){let{timer:i}=t;window.clearTimeout(i),NR.delete(n)}e.qualityLimitationReason=_b.NONE,XU(n)}function n0(n,e){var t;let i;switch(e){case Ae.LocalAudioTrack:i=Ni.Audio;break;case Ae.LocalVideoTrack:i=ee(t=n._hints).call(t,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High;break;case Ae.LocalVideoLowTrack:i=Ni.Low}return i}function ZU(n){let e=Nt();if(n.some(t=>t._bypassWebAudio))throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function qb(n,e){ZU(n);let t=new Un;return n.forEach(i=>t.addAudioTrack(i)),t}let QU=!Nt().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&xu();function a0(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var t;return QU?(t={spec:e,store:n},jo("PlanBConnection").create(t)):new wa(e,n)}function DR(n){return n&&(n.iceConnectionState==="disconnected"||n.iceConnectionState==="checking"||n.iceConnectionState==="failed")}function s0(n){try{if(n.iceServers)return!1;if(n.turnServer&&n.turnServer.mode!=="off"){if(Oi(n.turnServer.servers))return!1;if(B("FORCE_TURN_TCP")||n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var Ei;function mi(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function wl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mi(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):mi(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let wa=(Ei=class CA extends RU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return(e=(t=this.peerConnection.getReceivers()[0])===null||t===void 0||(t=t.transport)===null||t===void 0?void 0:t.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return ee(t=Object.keys(bt)).call(t,e)}))]}constructor(e,t){super(e,t),F(this,"id",Ht(5,"connection-")),F(this,"store",void 0),F(this,"peerConnection",void 0),F(this,"forceTurn",!1),F(this,"remoteSDP",void 0),F(this,"initialOffer",void 0),F(this,"transportEventReceiver",void 0),F(this,"statsFilter",void 0),F(this,"extension",{useXR:B("USE_XR")}),F(this,"localCapabilities",void 0),F(this,"remoteCodecs",void 0),F(this,"localCandidateCount",0),F(this,"allCandidatesReceived",!1),F(this,"isPreallocation",!1),F(this,"preMediaMap",new Map),F(this,"dataStreamChannelMap",new Map),F(this,"establishPromise",void 0),F(this,"recoveredDataChannelIds",[]),F(this,"currentDataChannelId",1),F(this,"supportAV1RtpSpec",!1),F(this,"mutex",void 0),F(this,"qualityLimitationReason",_b.NONE),F(this,"isFirstConnected",!1),this.store=t,this.forceTurn=s0(e),this.mutex=new xa("P2PConnection-mutex",t.clientId),this.peerConnection=new RTCPeerConnection(CA.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=R1(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,e.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,!this.remoteSDP)return void I.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t));if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){let i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);let a=this.remoteSDP.toString();r?.(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else I.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=bl(i.sdp),a=await wU({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterVideoCodec:B("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:B("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:B("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Ec(a),this.initialOffer=i,B("ENABLE_SVC")&&this.store.codec=="av1"){let o=await(async function(){try{let c=new RTCPeerConnection;c.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:nE.L1T3}]});let d=await c.createOffer();if(!d.sdp)return void c.close();let l=lo(d.sdp).mediaDescriptions[0];if(!l)return;let h=l.attributes.extmaps.find(_=>_.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return c.close(),h}catch{return}})();var e;o&&(this.supportAV1RtpSpec=!0,(e=a.send)===null||e===void 0||e.videoExtensions.push(o))}let s;return i.sdp&&DU(i.sdp)&&(s=cr(a),(t=s).send&&(p_(ze.VIDEO,t.send.videoExtensions),p_(ze.AUDIO,t.send.audioExtensions)),t.recv&&(p_(ze.VIDEO,t.recv.videoExtensions),p_(ze.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(p_(ze.VIDEO,t.sendrecv.videoExtensions),p_(ze.AUDIO,t.sendrecv.audioExtensions))),wl(wl({},r),{},{rtpCapabilities:s||a,offerSDP:i.sdp})}catch(i){throw new L(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&DU(this.initialOffer.sdp)&&(t=e.rtpCapabilities,i=this.localCapabilities,t.send&&(Vb(ze.VIDEO,t.send.videoExtensions,i.send.videoExtensions),Vb(ze.AUDIO,t.send.audioExtensions,i.send.audioExtensions)),t.recv&&(Vb(ze.VIDEO,t.recv.videoExtensions,i.recv.videoExtensions),Vb(ze.AUDIO,t.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return cr(this._localCapabilities)}get rtpCapabilities(){return cr(this._rtpCapabilities)}get candidates(){return cr(this._candidates)}get iceParameters(){return cr(this._iceParameters)}get dtlsParameters(){return cr(this._dtlsParameters)}constructor(c){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1],l=arguments.length>2&&arguments[2]!==void 0&&arguments[2];F(this,"sessionDesc",void 0),F(this,"_localCapabilities",void 0),F(this,"_rtpCapabilities",void 0),F(this,"_candidates",void 0),F(this,"_originCandidates",void 0),F(this,"_iceParameters",void 0),F(this,"_isUseExtmapAllowMixed",void 0),F(this,"_isUseLocalCodecs",void 0),F(this,"_dtlsParameters",void 0),F(this,"setup",void 0),F(this,"currentMidIndex",void 0),F(this,"cname",void 0),F(this,"useLocalCodecsMids",[]),F(this,"preloadSsrcs",[]),F(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=d,this._isUseLocalCodecs=l,c=cr(c);let{iceParameters:h,dtlsParameters:_,candidates:f,rtpCapabilities:m,setup:S,localCapabilities:T,cname:R}=c;this._rtpCapabilities=m,this._candidates=f,this._originCandidates=cr(f),this._iceParameters=h,this._dtlsParameters=_,this._localCapabilities=T,this.setup=S,this.cname=R,[this.sessionDesc]=this.updateRemoteRTPCapabilities(m),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(c){return c.length===this.preloadSsrcs.length&&c.every(d=>{var l;return ee(l=this.preloadSsrcs).call(l,d)})}preloadRemoteMedia(c){let d=0,l=[],h=[];for(;c>0;){let _=[i0({ssrcId:OR+d},B("USE_SUB_RTX")?{rtx:OR+d+1}:{})],f="".concat(OR+d,"_").concat(wR+d),{ssrcs:m,ssrcGroups:S}=TR(_,this.cname,B("SYNC_GROUP")?f:void 0),T=this.preCreateOrRecycleSendMedia("video",m,S,void 0),R=[{ssrcId:wR+d}],C="".concat(OR+d,"_").concat(wR+d),{ssrcs:b,ssrcGroups:N}=TR(R,this.cname,B("SYNC_GROUP")?C:void 0),k=this.preCreateOrRecycleSendMedia("audio",b,N,void 0);c--,d+=2,l.push(T,k),h.push(m[0].ssrcId,b[0].ssrcId)}return this.useLocalCodecsMids.push(...l),this.preloadSsrcs=h,{mids:l,preSSRCs:h,isAvailable:!0}}preCreateOrRecycleSendMedia(c,d,l,h){let _=this.rtpCapabilities.send.videoCodecs,f=this._isUseLocalCodecs||_.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;I.debug("create or recycle send media without remote rtp capabilities, ssrcs ",d[0].ssrcId);let m=c===ze.VIDEO?f.videoCodecs:f.audioCodecs,S=c===ze.VIDEO?f.videoExtensions:f.audioExtensions;this.currentMidIndex+=1;let T="".concat(this.currentMidIndex),R={media:{mediaType:c,port:IR,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:S,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(T)}};return R=this.mungSendMediaDesc(R,h),this.sessionDesc.mediaDescriptions.push(R),this.updateBundleMids(),T}toString(){return ya(this.sessionDesc)}send(c,d,l,h){let{ssrcs:_,ssrcGroups:f}=TR(d,this.cname,B("SYNC_GROUP")?l:void 0),m=this.findPreloadMediaDesc(_);if(m){if(jr()&&this.firefoxSsrcMidMap.set(_[0].ssrcId,m.attributes.mid),h&&(h.twcc||h.remb)){let S=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[S]=this.mungSendMediaDesc(m,h),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{let S=this.findAvailableMediaIndex(c,_),T;return S===-1||S===1&&(dn()||(function(){let R=pi();return!(R.name!==Ot.CHROME||!R.osVersion)&&Number(R.version)<=90})()||B("ENABLE_ENCODED_TRANSFORM")&&_l())||S===0&&!(function(R){let C=pi();return!(C.name!==Ot.FIREFOX||!C.osVersion)&&Number(C.version)===R})(138)&&B("USE_SUB_RTX")||nO()?(T=this.createOrRecycleSendMedia(c,_,f,"sendonly",h),this.updateBundleMids()):(T=cr(this.sessionDesc.mediaDescriptions[S]),T.attributes.direction="sendonly",T.attributes.ssrcs=_,T.attributes.ssrcGroups=f,this.sessionDesc.mediaDescriptions[S]=this.mungSendMediaDesc(T,h)),jr()&&this.firefoxSsrcMidMap.set(_[0].ssrcId,T.attributes.mid),{mid:T.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:c,needExchangeSDP:d}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:c.attributes.mid,needExchangeSDP:d}}batchSend(c){let d=c.map(_=>{let{kind:f,ssrcMsg:m,mslabel:S}=_;return this.send(f,m,S)}),l=[],h=!1;return d.forEach(_=>{let{mid:f,needExchangeSDP:m}=_;m&&(h=!0),l.push(f)}),{mids:l,needExchangeSDP:h}}stopSending(c){let d=this.sessionDesc.mediaDescriptions.filter(l=>l.attributes.mid&&c.indexOf(l.attributes.mid)!==-1);if(d.length!==c.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");d.forEach(l=>{l.attributes.mid==="0"||jr()||nO()?l.attributes.ssrcs=[]:(l.attributes.ssrcs=[],l.attributes.direction="inactive",l.media.port="0")}),this.updateBundleMids()}mute(c){let d=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===c);if(!d)throw new Error("mediaDescription not found with ".concat(c," in remote SDP when calling RemoteSDP.mute."));d.attributes.direction="inactive"}unmute(c){let d=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===c);if(!d)throw new Error("mediaDescription not found with ".concat(c," in remote SDP when calling RemoteSDP.unmute."));d.attributes.direction="sendonly"}muteRemote(c){let d=this.sessionDesc.mediaDescriptions.filter(l=>ee(c).call(c,l.attributes.mid||""));if(d.length!==c.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");d.forEach(l=>{l.attributes.direction="inactive"})}unmuteRemote(c){let d=this.sessionDesc.mediaDescriptions.filter(l=>ee(c).call(c,l.attributes.mid||""));if(d.length!==c.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");d.forEach(l=>{l.attributes.direction="recvonly"})}receive(c,d,l,h){c.forEach((_,f)=>{this.createOrRecycleRecvMedia(_,[],"recvonly",d,l,h[f])}),this.updateBundleMids()}stopReceiving(c){let d=this.sessionDesc.mediaDescriptions.filter(l=>c.indexOf(l.attributes.mid)!==-1);if(d.length!==c.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");d.forEach(l=>{l.media.port="0",l.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(c){let d=this.sessionDesc||lo((l=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(l?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var l;this._rtpCapabilities=c;let h=!1,_=this.rtpCapabilities.send,f=this.localCapabilities.send,m=this.localCapabilities.recv,S=m.videoCodecs,T=m.audioCodecs,R=m.videoExtensions,C=m.audioExtensions;for(let P of d.mediaDescriptions){var b;if(P.attributes.direction!=="sendonly"||typeof P.attributes.mid!="string"||!ee(b=this.useLocalCodecsMids).call(b,P.attributes.mid)){if(h=!0,P.attributes.iceUfrag=this._iceParameters.iceUfrag,P.attributes.icePwd=this._iceParameters.icePwd,P.attributes.fingerprints=this._dtlsParameters.fingerprints,P.attributes.candidates=this._candidates,P.attributes.setup=this.setup,P.media.mediaType==="application"&&(P.attributes.sctpPort="5000"),P.media.mediaType==="video")if(this._isUseLocalCodecs&&P.attributes.direction==="sendonly"){var N;P.media.fmts=S.map(W=>W.payloadType.toString(10)),P.attributes.payloads=S,P.attributes.extmaps=R;let U=P.attributes.mid;typeof U!="string"||ee(N=this.useLocalCodecsMids).call(N,U)||this.useLocalCodecsMids.push(U)}else if(_.videoCodecs.length===0){let U=f.videoCodecs.filter(W=>{var z,Q;return(z=W.rtpMap)===null||z===void 0?void 0:ee(Q=z.encodingName.toLowerCase()).call(Q,"vp8")})||[f.videoCodecs[0]];P.media.fmts=U.map(W=>W.payloadType.toString(10)),P.attributes.payloads=U,P.attributes.extmaps=[]}else P.media.fmts=_.videoCodecs.map(U=>U.payloadType.toString(10)),P.attributes.payloads=_.videoCodecs,P.attributes.extmaps=_.videoExtensions;if(P.media.mediaType==="audio")if(this._isUseLocalCodecs&&P.attributes.direction==="sendonly"){var k;P.media.fmts=T.map(W=>W.payloadType.toString(10)),P.attributes.payloads=T,P.attributes.extmaps=C;let U=P.attributes.mid;typeof U!="string"||ee(k=this.useLocalCodecsMids).call(k,U)||this.useLocalCodecsMids.push(U)}else if(_.audioCodecs.length===0){let U=f.audioCodecs.filter(W=>{var z,Q;return(z=W.rtpMap)===null||z===void 0?void 0:ee(Q=z.encodingName.toLowerCase()).call(Q,"opus")})||[f.audioCodecs[0]];P.media.fmts=U.map(W=>W.payloadType.toString(10)),P.attributes.payloads=U,P.attributes.extmaps=[]}else P.media.fmts=_.audioCodecs.map(U=>U.payloadType.toString(10)),P.attributes.payloads=_.audioCodecs,P.attributes.extmaps=_.audioExtensions,f_(P)}}return this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1,[this.sessionDesc,h]}updateCandidates(c){let d=this._originCandidates.filter(h=>h.transport==="udp"),l=[];if(d.forEach(h=>{l.push(i0(i0({},h),{},{foundation:"tcpcandidate",priority:Number(h.priority)-1+"",transport:"tcp",port:Number(h.port)+90+""}))}),d.length!==0){switch(c){case Me.TCP_RELAY:this._candidates=l;break;case Me.UDP_TCP_RELAY:case Me.RELAY:this._candidates=[...d,...l];break;default:this._candidates=d}for(let h of this.sessionDesc.mediaDescriptions)h.attributes.candidates=this.candidates}}restartICE(c){c=cr(c),this._iceParameters=c,this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.iceUfrag=c.iceUfrag,d.attributes.icePwd=c.icePwd})}predictReceivingMids(c){let d=[];for(let l=0;l<c;l++)d.push((this.currentMidIndex+l+1).toString(10));return d}findAvailableMediaIndex(c,d){return this.sessionDesc.mediaDescriptions.findIndex(l=>{let h=l.media.mediaType===c&&l.media.port!=="0"&&(l.attributes.direction==="sendonly"||l.attributes.direction==="sendrecv")&&l.attributes.ssrcs.length===0;if(jr()){if(h){let _=this.firefoxSsrcMidMap.get(d[0].ssrcId);return!(_||l.attributes.mid!=="0"&&l.attributes.mid!=="1")||!(!_||_!==l.attributes.mid)}return!1}return h})}createOrRecycleDataChannel(){for(let l of this.sessionDesc.mediaDescriptions)if(l.media.mediaType==="application")return{mediaDesc:l,needExchangeSDP:!1};this.currentMidIndex+=1;let c="".concat(this.currentMidIndex),d={media:{mediaType:"application",port:IR,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(c),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(d),{mediaDesc:d,needExchangeSDP:!0}}createOrRecycleRecvMedia(c,d,l,h,_,f){let m=c._mediaStreamTrack.kind,S=this.rtpCapabilities.recv,T=tp(m,S,this.localCapabilities.send,m===ze.VIDEO?h:_),R=m===ze.VIDEO?S.videoExtensions:S.audioExtensions;this.currentMidIndex+=1;let C="".concat(this.currentMidIndex),b={media:{mediaType:m,port:IR,protos:["UDP","TLS","RTP","SAVPF"],fmts:T.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:T,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(C)}};b=this.mungRecvMediaDsec(b,c,f);let N=this.findFirstClosedMedia(m);if(N){let k=this.sessionDesc.mediaDescriptions.indexOf(N);this.sessionDesc.mediaDescriptions[k]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateRemoteDtlsParameters(c){let d=new Set(this._dtlsParameters.fingerprints.map(_=>_.fingerprint)),l=new Set(c.map(_=>_.fingerprint)),h=!1;d.size!==l.size&&(h=!0);for(let _ of d)l.has(_)||(h=!0);return h}updateRemoteCodec(c,d,l){let h=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").filter(b=>{var N;return ee(N=Object.keys(bt)).call(N,b)}))],_=new Set(d);if(h.every(b=>_.has(b)))return I.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(d)),!1;let f=this._rtpCapabilities.recv.videoCodecs.filter(b=>d.some(N=>{var k;return ee(k=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(k,N)}));if(f.length===0)return I.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(h," codecs: ").concat(d)),!1;let m=[...new Set(f.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||""))],S;if(I.debug("updateRemoteCodec, from ".concat(h," to ").concat(m)),c.length===0)S=this.sessionDesc.mediaDescriptions.filter(b=>b.media.mediaType==="video"&&b.attributes.direction==="recvonly");else if(S=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&b.media.mediaType==="video"&&ee(c).call(c,b.attributes.mid)&&b.attributes.direction==="recvonly"),S.length!==c.length)return I.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(c,", codecs: ").concat(d)),!1;if(B("USE_PUB_RTX")||B("USE_SUB_RTX")){let b=Al(f,this.rtpCapabilities.recv.videoCodecs);f.push(...b)}this._rtpCapabilities.recv.videoCodecs=f;let T=this.localCapabilities.send,R=this.rtpCapabilities.recv,C=tp(ze.VIDEO,R,T,l);return S.forEach(b=>{let N=C.map(k=>k.payloadType.toString(10));I.debug("updateRemoteCodec mid: ".concat(b.attributes.mid,", from"),b.attributes.payloads,"to",C),b.attributes.payloads=C,b.media.fmts=N}),!0}createOrRecycleSendMedia(c,d,l,h,_){let f=this.rtpCapabilities.send.videoCodecs,m=this._isUseLocalCodecs||f.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,S=c===ze.VIDEO?m.videoCodecs:m.audioCodecs,T=c===ze.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;let R="".concat(this.currentMidIndex),C={media:{mediaType:c,port:IR,protos:["UDP","TLS","RTP","SAVPF"],fmts:S.map(N=>N.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:T,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:S,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:h,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(R)}};C=this.mungSendMediaDesc(C,_);let b=this.findFirstClosedMedia(c);if(b){let N=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[N]=C}else this.sessionDesc.mediaDescriptions.push(C);return C}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(c=>c.media.port!=="0").map(c=>c.attributes.mid)}mungRecvMediaDsec(c,d,l){let h=cr(c);return pE(h),ep(h,d),jb(h,d),zO(h),Gb(h,l,this.localCapabilities.send),h}mungSendMediaDesc(c,d){let l=cr(c);return Gb(l,d,this.localCapabilities.recv),f_(l),l}updateRecvMedia(c,d){let l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c);if(l!==-1){let h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],d);this.sessionDesc.mediaDescriptions[l]=h}}bumpMid(c){this.currentMidIndex+=c}findFirstClosedMedia(c){return this.sessionDesc.mediaDescriptions.find(d=>jr()?d.media.port==="0"&&d.media.mediaType===c:d.media.port==="0")}findPreloadMediaDesc(c){return this.sessionDesc.mediaDescriptions.find(d=>{var l;return((l=d.attributes)===null||l===void 0||(l=l.ssrcs[0])===null||l===void 0?void 0:l.ssrcId)===c[0].ssrcId})}getSSRC(c){var d;return(d=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===c))===null||d===void 0?void 0:d.attributes.ssrcs}}(wl(wl({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!B("ENABLE_PRE_SUB_WITH_PRE_PC")||!B("PRE_USE_LOCAL_CODECS"))&&iR(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let r=this.remoteSDP.toString(),a=E_(this.initialOffer.sdp,this.extension),s=this.logSDPExchange(a||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),s?.(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});let o=this.peerConnection.getTransceivers()[0];if(o!=null&&o.receiver&&this.tryBindTransportEvents(o.receiver),iR(this.store))if(e.preallocation&&B("ENABLE_PRE_SUB_WITH_PRE_PC")){let c=B("PRE_SUB_NUM"),{mids:d,preSSRCs:l}=this.remoteSDP.preloadRemoteMedia(c);await mc(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(l)),this.presetMedia(d,l)}else{let{preSSRCs:c=[]}=e,d=c.map(h=>h.ssrcMsg[0].ssrcId);if(c.length===0)return;let{mids:l}=this.remoteSDP.batchSend(c.map(h=>Object.assign({},h)));await mc(this.peerConnection,this.remoteSDP,this.extension),I.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(l,d)}}catch(r){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var t,i}presetMedia(e,t){e.forEach((i,r)=>{this.peerConnection.getTransceivers().forEach(a=>{if(a.mid!=null&&i===a.mid&&a.receiver.track){let s=a.receiver.track,o;s.kind==="video"&&B("ENABLE_PRE_RENDER")&&(o=new LO({trackId:"track-".concat(s.kind,"-unknown-").concat(this.store.clientId,"_").concat(Ht(5,""))},!0),o.updateVideoTrack(s),o.onFirstVideoFrameRender=()=>{var c;let d=this.preMediaMap.get(t[r]);d&&(d.firstVideoRender=Date.now()),(c=this.onFirstVideoRender)===null||c===void 0||c.call(this,t[r])},o.play(this.store.sessionId||void 0)),this.preMediaMap.set(t[r],{mid:i,track:s,player:o,transceiver:a})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let t=!1,{rtpCapabilities:i}=e;if([,t]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let s=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);t=t||s}let{preSSRCs:r=[]}=e,a=r.map(s=>s.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(a)){let s=[],o=[];if(Array.from(this.preMediaMap.entries()).every(c=>{let[d,{mid:l,player:h,track:_}]=c;return s.push(l),o.push(d),this.preMediaMap.delete(d),h&&h.destroy(),!0}),s.length>0&&(this.remoteSDP.stopSending(s),await mc(this.peerConnection,this.remoteSDP,this.extension),I.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(o)),Te.reportApiInvoke(this.store.sessionId,{name:Jr.PRELOAD_MEDIA_FAILED,options:[r,o],tag:Gt.TRACER}).onSuccess()),r.length>0){let{mids:c}=this.remoteSDP.batchSend(r.map(d=>Object.assign({},d)));await mc(this.peerConnection,this.remoteSDP,this.extension),I.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(a)),this.presetMedia(c,a)}}t?(await mc(this.peerConnection,this.remoteSDP,this.extension),I.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):I.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(t.toString()))}}send(e,t,i){var r=this;return cc(function*(){let a=yield di(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let s=[],o=$h();e.forEach(T=>{let R=r.peerConnection.addTransceiver(T._mediaStreamTrack,wl({direction:"sendonly"},T.trackMediaType==="video"&&r.supportAV1RtpSpec&&o?{sendEncodings:[{scalabilityMode:o}]}:{}));s.push(R),T._updateRtpTransceiver(R)}),jr()&&B("SIMULCAST")===!0&&(yield di(r.applySimulcastForFirefox(s,e)));let c=yield di(r.peerConnection.createOffer()),d=r.remoteSDP.predictReceivingMids(e.length),l=r.mungSendOfferSDP(c.sdp,e,d),h=lo(l),_=d.map(T=>{let R=h.mediaDescriptions.find(C=>C.attributes.mid===T);if(!R)throw new Error("Cannot extract ssrc from mediaDescription.");return __(R,B("USE_PUB_RTX"))}),f;try{f=yield _}catch(T){f=[],r.remoteSDP.receive(e,t,i,f);let R=r.remoteSDP.toString();throw yield di(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield di(r.peerConnection.setRemoteDescription({type:"answer",sdp:R})),yield di(r.stopSending(d,!0)),T}r.remoteSDP.receive(e,t,i,f);let m=r.remoteSDP.toString(),S=r.logSDPExchange(l,"offer","local","send");return yield di(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield di(r.applySimulcastEncodings(s,e)),yield di(r.applySendEncodings(s,e)),S?.(m),yield di(r.peerConnection.setRemoteDescription({type:"answer",sdp:m})),s.map((T,R)=>{let C=d[R];return{localSSRC:_[R],id:C,transceiver:T}})}catch(s){throw s instanceof L?s:new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{a()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")I.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let a=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof a!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:a,negotiated:!0,ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}t.forEach(a=>{a._updateOriginDataChannel(i)});let{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){let a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});let s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s),I.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else I.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof L?i:new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{let t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(t){throw t instanceof L?t:new L(M.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(t.toString()))}}async stopSending(e,t){let i=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getTransceivers().filter(c=>e.indexOf(c.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(c=>{var d;Mg(this.id+c.mid,this),c.direction="inactive",(d=c.stop)===null||d===void 0||d.call(c)});let a=await this.peerConnection.createOffer(),s=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);let o=this.remoteSDP.toString();s?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,t,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:a,needExchangeSDP:s}=this.remoteSDP.send(e,t,i,r);s&&(await mc(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));let o=this.peerConnection.getTransceivers().find(c=>c.mid===a);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:a,transceiver:o}}catch(a){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:t,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await mc(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(r=>{let a=this.peerConnection.getTransceivers().find(s=>s.mid===r);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:r,transceiver:a}})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(a=>{Array.from(this.preMediaMap.entries()).some(s=>{let[o,{mid:c,player:d}]=s;if(c===a)return this.preMediaMap.delete(o),d&&d.destroy(),!0})}),this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();i?.(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);let t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();i?.(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);let t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();i?.(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(s=>{s.direction="inactive"});let i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);let a=this.remoteSDP.toString();r?.(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(s,o)=>{s.direction="sendonly"});let i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);let a=this.remoteSDP.toString();r?.(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return cc(function*(){let i=yield di(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let r=Nt().supportPCSetConfiguration,a=B("FORCE_TURN_TCP")||t.forceTurn;if(e===Me.RELAY&&!r)return;if(r&&!a){let h=e===Me.RELAY?"relay":"all",_=t.peerConnection.getConfiguration();_.iceTransportPolicy!==h&&(I.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(h,"]")),_.iceTransportPolicy=h,t.peerConnection.setConfiguration(_))}t.remoteSDP.updateCandidates(e);let s=yield di(t.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=bl(s.sdp),{remoteIceParameters:c}=yield o.iceParameters;t.remoteSDP.restartICE(c);let d=t.remoteSDP.toString(),l=t.logSDPExchange(s.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield di(t.peerConnection.setLocalDescription(s)),l?.(d),yield di(t.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(r){I.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Me.TCP_RELAY),await mc(this.peerConnection,this.remoteSDP,this.extension)}catch(t){I.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),t)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(t=>{Mg(this.id+t.mid,this)}),this.preMediaMap.forEach(t=>{let{player:i}=t;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return wl(wl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let a=this.remoteSDP.toString(),s=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),s?.(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new L(M.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){let i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(t)?jr()||await this.applySimulcastEncodings(i,[t]):await this.applySendEncodings(i,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let i=this.peerConnection.getTransceivers().find(r=>r.mid===t);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let t=e[0].transport.iceTransport,{local:i,remote:r}=t.getSelectedCandidatePair();return{local:wl(wl({},El),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:wl(wl({},El),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;let i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"",a=Xc(e.url||"");I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(a||"",", host_candidate:").concat(r)),(t=this.onICECandidateError)===null||t===void 0||t.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){let t={iceServers:[]},i=e.cloudProxyServer||"disabled";return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&(Oi(e.turnServer.servers)?t.iceServers=e.turnServer.servers:B("NEW_TURN_MODE")&&t.iceServers&&i==="disabled"?(B("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&t.iceServers.push(...CA.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):t.iceServers.push(...CA.newTurnServerConfigToIceServers(e.turnServer.servers)),B("NEW_FORCE_TURN")&&(t.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(t.iceServers&&t.iceServers.push(...CA.turnServerConfigToIceServers(e.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...CA.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(t.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Nt().supportWebRTCEncodedTransform&&(t.encodedInsertableStreams=!0),t}static turnServerConfigToIceServers(e){let t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Yu(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!B("FORCE_TURN_TCP")&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}static newTurnServerConfigToIceServers(e){let t=[];return e.forEach(i=>{let r=B("NEW_TURN_MODE");r===1?t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Yu(i.turnServerURL),":443?transport=tcp")}):r===4&&(t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Yu(i.turnServerURL),":443?transport=tcp")}))}),t}tryBindTransportEvents(e){let t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in r?r.error:r)};let i=t.iceTransport;i&&(i.onstatechange=()=>{let r=t?.iceTransport.state;var a;r&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:r,remote:a}=i.getSelectedCandidatePair()||{};if(r&&a){let s=r.address+":"+r.port,o=a.address+":"+a.port;I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Xc(s)),", remote ").concat(JSON.stringify(Xc(o))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var i,r;if(t||(t=this.peerConnection.getSenders().find(S=>S.track===e._mediaStreamTrack)),!t)return I.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Nt().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let a={},s={};switch(e._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;case"balanced":a.degradationPreference="balanced"}let o=(function(S,T){return S.getTransceivers().find(R=>R.sender.track===T||R.receiver.track===T)})(this.peerConnection,e._mediaStreamTrack),c=LB(e);if((function(S){var T;return!(!B("ENABLE_AG_ADAPTATION")||!(S instanceof Xi||ee(T=S._hints).call(T,Oe.CUSTOM_TRACK))||!B("FORCE_SUPPORT_AG_ADAPTATION")&&!(l1(14,0,!1)&&u1(17,4)||iO(14)&&rO(17,4,!0)))})(e)&&o&&t&&c&&this.getLocalVideoStats&&ee(i=["vp8","vp9"]).call(i,this.store.codec)){var d;let S=a.degradationPreference||(ee(d=e._hints).call(d,Oe.CUSTOM_TRACK)?B("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(T,R,C,b,N,k){if(Mg(T,C),N(R),b!=="balanced"&&b!=="maintain-framerate"&&b!=="maintain-resolution")return;let P=-1;XU(T,R);let U=window.setInterval(()=>{let z=NR.get(T);if(!B("ENABLE_AG_ADAPTATION")||!z)return Mg(T,C),void N(R);let Q=k();if(Q.sendPackets>0&&Q.OutgoingAvailableBandwidth>0){if(P===-1)return void(P=Date.now());if(Date.now()-P<1e3)return;let he=Q.sendFrameRate,Ge=Q.OutgoingAvailableBandwidth,[xe,qe]=nj(T,he,Ge,z.adaptationConfig,R,b);qe&&(C.qualityLimitationReason=qe),xe&&z.adaptationConfig.scale!==xe.scale&&(I.debug("[".concat(T,"] applyAdaptation: ").concat(C.qualityLimitationReason,`
           sendFps `).concat(he,", bwe ").concat(Ge,", switch from ").concat(z.adaptationConfig.scale," to ").concat(xe.scale," ")),z.adaptationConfig=r0(r0({},z.adaptationConfig),xe),N(xe))}},B("CHECK_LOCAL_STATS_INTERVAL")),W=r0({},R);NR.set(T,{timer:U,adaptationConfig:W,originConfig:R,adaptationFunc:N}),I.debug("[".concat(T,"] start adaptation, originConfig: ").concat(JSON.stringify(R),", degradationPreference: ").concat(b))})(this.id+o.mid,c,this,S,T=>{t&&this.updateAdaptation(t,T)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;let{bitrateMax:S,frameRate:T,scaleResolutionDownBy:R}=e._encoderConfig;S&&(s.maxBitrate=1e3*S),(ee(l=e._hints).call(l,Oe.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(T&&(s.maxFramerate=po(T)),R&&R>=1&&(s.scaleResolutionDownBy=R))}let{maxFramerate:h}=B("ENCODER_CONFIG_LIMIT");if(h&&typeof h=="number"&&(s.maxFramerate=s.maxFramerate?Math.min(s.maxFramerate,h):h),B("DSCP_TYPE")&&xu()){var _;let S=B("DSCP_TYPE");ee(_=["very-low","low","medium","high"]).call(_,S)&&(s.networkPriority=S)}let f=t.getParameters(),m=(r=f.encodings)===null||r===void 0?void 0:r[0];jr()&&!m&&(a.encodings=[s]),m&&Object.assign(m,s),Object.assign(f,a),I.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await t.setParameters(f),await(async function(S,T,R){try{var C;if(!Nt().supportSetRtpSenderParameters||!(function(U){return U==="vp9"||U==="av1"})(S)||!B("ENABLE_SVC"))return;let b={},N={},k=T.getParameters(),P=(C=k.encodings)===null||C===void 0?void 0:C[0];N.scalabilityMode=$h(R),P&&Object.assign(P,N),Object.assign(k,b),await T.setParameters(k),I.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(k.encodings)))}catch(b){I.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",b)}})(this.store.codec,t,B("SVC_MODE"))}async updateAdaptation(e,t){var i,r;if(!e)return I.debug("[updateAdaptation] no rtpSender found");if(!Nt().supportSetRtpSenderParameters)return I.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let a={},{bitrateMax:s,frameRate:o,scaleResolutionDownBy:c}=t;s&&(a.maxBitrate=1e3*s),o&&(a.maxFramerate=po(o)),c&&c>=1&&ee(i=["vp8","vp9"]).call(i,this.store.codec)&&(a.scaleResolutionDownBy=c);let d=e.getParameters(),l=(r=d.encodings)===null||r===void 0?void 0:r[0];l&&Object.assign(l,a),Object.assign(d,{});try{await e.setParameters(d),I.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(d.encodings)))}catch(h){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?I.debug("[updateAdaptation] peerConnection not connected}"):I.debug("[updateAdaptation] updateRtpSenderEncodings failed",h):I.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!Nt().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){let r=e[i],a=t[i];a instanceof Ai&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,r.sender)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,i){let r=lo(e);return t.forEach((a,s)=>{let o=i[s],c=r.mediaDescriptions.find(d=>d.attributes.mid===o);c&&(ep(c,a),Wb(c,a,this.store.codec))}),ya(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let c=0;c<e.length;c++){var i,r,a,s,o;let d=e[c],l=t[c];if(l instanceof Ai&&!ee(i=l._hints).call(i,Oe.LOW_STREAM)&&(r=l._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=l._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(s=l._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=l._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1&&this.store.codec==="vp8"){let h={},_={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];let f=d.sender.getParameters();await d.sender.setParameters(Object.assign(f,h))}}}async applySimulcastEncodings(e,t){if(!jr()&&e.length===t.length)for(let i=0;i<e.length;i++){let r=t[i];if(r instanceof Ai&&this.isVP8Simulcast(r)){let a=e[i],s={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];let c=a.sender.getParameters();await a.sender.setParameters(Object.assign(c,s))}}}isVP8Simulcast(e){var t,i,r,a,s;return!!(e instanceof Ai&&B("SIMULCAST")&&this.store.codec==="vp8"&&!ee(t=e._hints).call(t,Oe.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((s=e._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1)}logSDPExchange(e,t,i,r){if(B("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return t&&t.length!==0?t[0].ssrcId:void 0}setConfiguration(e){if(Nt().supportPCSetConfiguration){let t=CA.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}e.isPreallocation&&(this.isPreallocation=!0)}},$e(Ei.prototype,"updateRemoteRTPCapabilities",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"updateRemoteRTPCapabilities"),Ei.prototype),$e(Ei.prototype,"connect",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"connect"),Ei.prototype),$e(Ei.prototype,"updateRemoteConnect",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"updateRemoteConnect"),Ei.prototype),$e(Ei.prototype,"createDataChannels",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"createDataChannels"),Ei.prototype),$e(Ei.prototype,"receive",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"receive"),Ei.prototype),$e(Ei.prototype,"batchReceive",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"batchReceive"),Ei.prototype),$e(Ei.prototype,"stopReceiving",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"stopReceiving"),Ei.prototype),$e(Ei.prototype,"muteRemote",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"muteRemote"),Ei.prototype),$e(Ei.prototype,"unmuteRemote",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"unmuteRemote"),Ei.prototype),$e(Ei.prototype,"muteLocal",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"muteLocal"),Ei.prototype),$e(Ei.prototype,"unmuteLocal",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"unmuteLocal"),Ei.prototype),$e(Ei.prototype,"close",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"close"),Ei.prototype),$e(Ei.prototype,"updateEncoderConfig",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"updateEncoderConfig"),Ei.prototype),$e(Ei.prototype,"updateSendParameters",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"updateSendParameters"),Ei.prototype),$e(Ei.prototype,"replaceTrack",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"replaceTrack"),Ei.prototype),$e(Ei.prototype,"updateAdaptation",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"updateAdaptation"),Ei.prototype),$e(Ei.prototype,"getRemoteSSRC",[vn],Object.getOwnPropertyDescriptor(Ei.prototype,"getRemoteSSRC"),Ei.prototype),Ei);function vn(n,e,t){let i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){let r=this.mutex,a=await r.lock("From P2PConnection.".concat(e));try{for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return await i.apply(this,o)}finally{a()}},t}function Is(n,e){let t=document.createElement("video"),i=document.createElement("canvas");t.setAttribute("style","display:none"),i.setAttribute("style","display:none"),t.setAttribute("muted",""),t.muted=!0,t.setAttribute("autoplay",""),t.autoplay=!0,t.setAttribute("playsinline",""),i.width=po(e.width),i.height=po(e.height);let r=po(e.framerate||15);document.body.append(t),document.body.append(i);let a=n._mediaStreamTrack;t.srcObject=new MediaStream([a]),t.play();let s=i.getContext("2d");if(!s)throw new J(M.UNEXPECTED_ERROR,"can not get canvas context");let o=Nt(),c=i.captureStream(o.supportRequestFrame?0:r).getVideoTracks()[0];c.canvas||(c.canvas=i),i.startCapture=()=>{if(!t)return i.stopCapture&&i.stopCapture();if(t.paused&&t.play(),t.videoHeight>2&&t.videoWidth>2){let l=t.videoWidth,h=t.videoHeight/l,_=i.width*h;Math.abs(_-i.height)>=2&&(I.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(_)),i.height=_)}s.drawImage(t,0,0,i.width,i.height),c.requestFrame&&c.requestFrame(),a!==n._mediaStreamTrack&&(a=n._mediaStreamTrack,t.srcObject=new MediaStream([a]))},i.stopCapture=Sb(()=>i.startCapture&&i.startCapture(),r);let d=c.stop;return c.stop=()=>{d.call(c),t&&(t.remove(),t.srcObject=null,t=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),I.debug("clean low stream renderer")},c}var o0=(function(n){return n[n.Video_Send_Type=190]="Video_Send_Type",n})(o0||{}),Ol=(function(n){return n[n.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",n[n.Video_Send_Freeze=2082]="Video_Send_Freeze",n[n.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",n[n.Video_Recv_Freeze=2084]="Video_Recv_Freeze",n[n.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",n[n.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",n[n.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",n[n.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",n})(Ol||{}),mt=(function(n){return n[n.Video_Send_Retransmit=2062]="Video_Send_Retransmit",n[n.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",n[n.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",n[n.Video_Send_Transmit=2066]="Video_Send_Transmit",n[n.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",n[n.Video_Capture_Height=2033]="Video_Capture_Height",n[n.Video_Capture_Width=2035]="Video_Capture_Width",n[n.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",n[n.Video_Send_Low_Height=2073]="Video_Send_Low_Height",n[n.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",n[n.Video_Send_Low_Width=2077]="Video_Send_Low_Width",n[n.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",n[n.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",n[n.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",n[n.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",n[n.Video_Send_Width=2003]="Video_Send_Width",n[n.Video_Send_Height=2004]="Video_Send_Height",n[n.Video_Send_Disabled=2095]="Video_Send_Disabled",n[n.Video_Send_Adaptation=2032]="Video_Send_Adaptation",n[n.Video_Send_Player_Status=2128]="Video_Send_Player_Status",n[n.Video_Send_Nacks=2009]="Video_Send_Nacks",n[n.Video_Send_Plis=2010]="Video_Send_Plis",n[n.Video_Send_Firs=2011]="Video_Send_Firs",n[n.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",n[n.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",n[n.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",n[n.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",n[n.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",n[n.Video_Send_Bitrate=2012]="Video_Send_Bitrate",n[n.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",n[n.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",n[n.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",n[n.Audio_Send_Level=2038]="Audio_Send_Level",n[n.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",n[n.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",n[n.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",n[n.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",n[n.Audio_Send_Freeze=2081]="Audio_Send_Freeze",n[n.Audio_Send_Disabled=2096]="Audio_Send_Disabled",n[n.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",n[n.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",n[n.Video_Recv_Height=2019]="Video_Recv_Height",n[n.Video_Recv_Width=2018]="Video_Recv_Width",n[n.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",n[n.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",n[n.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",n[n.Video_Recv_Nacks=2026]="Video_Recv_Nacks",n[n.Video_Recv_Plis=2027]="Video_Recv_Plis",n[n.Video_Recv_Firs=2028]="Video_Recv_Firs",n[n.Video_Recv_Disabled=2101]="Video_Recv_Disabled",n[n.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",n[n.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",n[n.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",n[n.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",n[n.Audio_Render_Level=2043]="Audio_Render_Level",n[n.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",n[n.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",n[n.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",n[n.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",n[n.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",n[n.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",n[n.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",n[n.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",n[n.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",n[n.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",n[n.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",n[n.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",n})(mt||{}),st=(function(n){return n[n.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",n[n.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",n[n.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",n[n.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",n[n.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",n[n.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",n[n.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",n[n.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",n[n.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",n[n.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",n[n.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",n[n.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",n[n.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",n[n.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",n[n.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",n[n.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",n[n.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",n[n.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",n[n.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",n[n.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",n[n.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",n})(st||{}),rr=(function(n){return n[n.RTT=2006]="RTT",n[n.CONN_TYPE=801]="CONN_TYPE",n[n.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",n})(rr||{}),us=(function(n){return n[n.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",n})(us||{});let ap=1e3,sp=6,fE=3,Xb=Math.max(sp,fE,60);function ut(n,e,t){t!=null&&Number.isFinite(t)&&(n[e]=Math.round(Math.max(0,t)))}function lt(n){let e={[rr.CONN_TYPE]:0,[rr.RTT]:n.rtt,[rr.STATS_UPDATE_INTERVAL]:n.updateInterval?Math.round(Math.max(0,n.updateInterval)):void 0};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{let t=n.selectedCandidatePair.localCandidate.relayProtocol;t==="udp"&&(e[rr.CONN_TYPE]=1),t==="tcp"&&(e[rr.CONN_TYPE]=3),t==="tls"&&(e[rr.CONN_TYPE]=4);break}case"srflx":e[rr.CONN_TYPE]=2;break;case"unknown":e[rr.CONN_TYPE]=5;break;default:e[rr.CONN_TYPE]=0}return e}function $U(n){let e=0;switch(n){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class ex extends Sr{constructor(e){super(),F(this,"store",void 0),F(this,"uploadWRTCStatsTimer",void 0),F(this,"uploadOutboundDenoiserStatsTimer",void 0),F(this,"uploadExtStatsTimer",void 0),F(this,"uploadExtUsageStatsTimer",void 0),F(this,"uploadInboundExtStatsTimer",void 0),F(this,"requestStats",void 0),F(this,"requestTransportStats",void 0),F(this,"requestLocalMedia",void 0),F(this,"requestRemoteMedia",void 0),F(this,"requestAllTracks",void 0),F(this,"requestVideoIsReady",void 0),F(this,"requestUploadStats",void 0),F(this,"requestUpload",void 0),F(this,"uploadOutboundStarted",!1),F(this,"uploadInboundStarted",!1),F(this,"uploadTransportStarted",!1),F(this,"uploadBaseStatsStarted",!1),F(this,"uploadExtensionUsageStarted",!1),F(this,"lastRecvStats",void 0),F(this,"lastSendStats",void 0),F(this,"lastRefRecvStats",void 0),F(this,"lastRefSendStats",void 0),F(this,"lastNormalRecvStats",void 0),F(this,"lastNormalSendStats",void 0),F(this,"lastExtendStats",{}),F(this,"needUploadStats",{}),F(this,"needUploadRenderFreezeTime",!0),F(this,"lastUploadCompensateTime",-1),F(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t=e%fE==0,i=e%sp==0,r=e%60==0,a,s;if(this.uploadTransportStarted&&(a=this.requestStats(),this.store.useP2P&&(s=this.requestStats(!0))),!a&&this.uploadOutboundStarted&&(a=this.requestStats()),!s&&this.uploadInboundStarted&&(s=this.requestStats(!0)),a||s){var o;let c={};if(this.uploadTransportStarted&&a){let l=this.getTransportStats(a,s,t);l&&(c.misc=[l])}if(this.uploadOutboundStarted&&a){let l=this.getOutboundStats(a,i?this.lastNormalSendStats:void 0,t?this.lastRefSendStats:void 0,this.lastSendStats,r);l&&(c.outbound=[l])}if(this.uploadInboundStarted&&s){this.uploadCompensateStats(e);let l=this.getInboundStats(s,i?this.lastNormalRecvStats:void 0,t?this.lastRefRecvStats:void 0,this.lastRecvStats);l&&(c.inbound=l)}let d=(o=this.requestTransportStats)===null||o===void 0?void 0:o.call(this).connectState;d&&(Array.isArray(c.misc)?c.misc[0]&&c.misc[0].addition&&(c.misc[0].addition[us.RTC_PEER_CONNECTION_STATE]=ZT[d]):c.misc=[{addition:{[us.RTC_PEER_CONNECTION_STATE]:ZT[d]}}]),this.needUploadStats.sendType&&(Array.isArray(c.outbound)&&c.outbound[0]&&c.outbound[0].high&&(c.outbound[0].high[o0.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(c)}this.lastRecvStats=s,this.lastSendStats=a,i&&(this.lastNormalRecvStats=s,this.lastNormalSendStats=a),t&&(this.lastRefRecvStats=s,this.lastRefSendStats=a)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,i;let r=(t=this.requestTransportStats)===null||t===void 0?void 0:t.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[us.RTC_PEER_CONNECTION_STATE]:ZT[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===Xb+1&&(e=1)},ap)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let t=e%fE==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!t)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let r=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*r;let a=this.requestStats(!0);new Array(r).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let s={};if(this.uploadInboundStarted&&a){let o=this.requestRemoteMedia()||[],c=[];o.forEach(d=>{let[l,h]=d,_={peer:l.uid};if(l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)&&h.has(ze.VIDEO)&&l.videoTrack){let f=(function(m,S,T){if(!S.videoRecv.find(C=>C.ssrc===m))return;let R={};if(T&&T._player){let C=T._player,{renderFreezeAccTime2:b,videoElementStatus:N}=C;if(fc.visibility==="visible"&&N===Mn.PLAYING&&Nt().supportRequestVideoFrameCallback){let k=Math.min(6e3,b);C.renderFreezeAccTime2=Math.max(0,b-k),ut(R,Ol.Video_Render_Freeze_Time_Render2,k),B("USE_NEW_RENDER_FREEZE_TIME")&&ut(R,Ol.Video_Render_Freeze_Time_Render,k)}}return R})(l._videoSSRC,a,l.videoTrack);f&&(_.video=f)}_.video&&c.push(_)}),c.length>0&&(s.inbound=c,this.requestUploadStats(s))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,t,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[rr.RTT]:e.rtt,[rr.CONN_TYPE]:void 0,[rr.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};let r=lt(e);if(this.store.useP2P){if(t){let a=lt(t);r[rr.CONN_TYPE]+=a[rr.CONN_TYPE]<<3}r[rr.CONN_TYPE]+=110}else r[rr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,i,r,a){if(!this.requestUploadStats||!this.requestLocalMedia)return;let s=this.requestLocalMedia();if(!s||s.length===0)return;let o,c,d;return s.forEach(l=>{let[h,{track:_,ssrcs:f}]=l;switch(h){case Ae.LocalVideoLowTrack:case Ae.LocalVideoTrack:if(h===Ae.LocalVideoTrack){var m;let S=(function(b,N,k,P,U,W){let z=N.videoSend.find(xe=>xe.ssrc===b);if(!z)return;let Q={},{sentFrame:he,inputFrame:Ge}=z;if(P&&(ut(Q,Ol.Video_Send_Qp_Sum,z.qpSumPerFrame),Ge&&he)){let xe=Ge.frameRate,qe=he.frameRate;Q[Ol.Video_Send_Freeze]=(function(ot,xt){let fe=!0;return fe=!(ot<=5)&&(ot<=10?xt<3:ot<=20?xt<4:xt<5),fe})(xe,qe)?1:0}if(U){switch(he&&(ut(Q,mt.Video_Send_Height,he.height),ut(Q,mt.Video_Send_Width,he.width),ut(Q,mt.Video_Send_Frame_Rate,he.frameRate)),Q[mt.Video_Send_Disabled]=k._originMediaStreamTrack&&!k._originMediaStreamTrack.enabled||k._mediaStreamTrack&&!k._mediaStreamTrack.enabled?1:0,z.adaptionChangeReason){case"none":Q[mt.Video_Send_Adaptation]=0;break;case"cpu":Q[mt.Video_Send_Adaptation]=1;break;case"bandwidth":Q[mt.Video_Send_Adaptation]=2;break;case"other":Q[mt.Video_Send_Adaptation]=3}let xe=0;z.adaptionChangeReason&&(xe+=$U(z.adaptionChangeReason)),N.qualityLimitationReason&&(xe+=$U(N.qualityLimitationReason)<<3),Q[mt.Video_Send_Adaptation]=xe,Q[mt.Video_Send_Player_Status]=Tl[k._player?k._player.videoElementStatus:"uninit"],ut(Q,mt.Video_Send_Nacks,z.nacksCount),ut(Q,mt.Video_Send_Plis,z.plisCount),ut(Q,mt.Video_Send_Firs,z.firsCount),ut(Q,mt.Video_Send_Avg_Encode,z.avgEncodeMs),ut(Q,mt.Video_Send_Huge_Frame_Sent,z.hugeFramesSent),ut(Q,mt.Video_Send_Bytes_Retransmit,z.retransmittedBytesSent),ut(Q,mt.Video_Send_Packages_Retransmit,z.retransmittedPacketsSent),ut(Q,mt.Video_Send_Key_Frames_Encoded,z.keyFramesEncoded);let qe=U.videoSend.find(ot=>ot.ssrc===b);if(qe){let ot=ap*fE;qe.timestamp&&z.timestamp&&(ot=z.timestamp-qe.timestamp),qe.packets!=null&&z.packets!=null&&ut(Q,mt.Video_Send_Package_Rate,1e3*(z.packets-qe.packets)/ot),z.packetsLost!=null&&qe.packetsLost!=null&&ut(Q,mt.Video_Send_Package_Lost,z.packetsLost-qe.packetsLost),qe.bytes!=null&&z.bytes!=null&&ut(Q,mt.Video_Send_Bitrate,8*(z.bytes-qe.bytes)/ot)}}return Q})(f[0].ssrcId,e,_,t,i),T=_.__className__==="CameraVideoTrack"?3:ee(m=_._hints).call(m,Oe.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==T||a)&&(this.needUploadStats={sendType:T},this.lastExtendStats.sendType=T);let R=_&&(function(b,N,k,P){let U=N.videoSend.find(z=>z.ssrc===b);if(!U)return null;let W={};if(P){let z=U.inputFrame,Q=z&&z.height||k.videoHeight||0,he=z&&z.width||k.videoWidth||0,Ge=z&&z.frameRate||0;ut(W,mt.Video_Capture_Height,Q),ut(W,mt.Video_Capture_Width,he),ut(W,mt.Video_Capture_Frame_Rate,Ge)}return W})(f[0].ssrcId,e,_,!!i),C=(function(b,N){let k={};return N&&(ut(k,mt.Video_Send_Retransmit,b.bitrate.retransmit),ut(k,mt.Video_Send_Target_Encoded,b.bitrate.targetEncoded),ut(k,mt.Video_Send_Actual_Encoded,b.bitrate.actualEncoded),ut(k,mt.Video_Send_Transmit,b.bitrate.transmit),ut(k,mt.Video_Send_Bandwidth,b.sendBandwidth)),k})(e,!!i);c=Object.assign({},S,R,C)}else d=(function(S,T,R,C,b){let N=T.videoSend.find(P=>P.ssrc===S);if(!N)return;let k={};if(C){let P=N.sentFrame;P&&(ut(k,mt.Video_Send_Low_Height,P.height),ut(k,mt.Video_Send_Low_Width,P.width),ut(k,mt.Video_Send_Low_Frame_Rate,P.frameRate));let U=C.videoSend.find(W=>W.ssrc===S);if(U){let W=ap*sp;U.timestamp&&N.timestamp&&(W=N.timestamp-U.timestamp),U.packets!=null&&N.packets!=null&&ut(k,mt.Video_Send_Low_Package_Rate,1e3*(N.packets-U.packets)/W),N.packetsLost!=null&&U.packetsLost!=null&&ut(k,mt.Video_Send_Low_Package_Lost,N.packetsLost-U.packetsLost),U.bytes!=null&&N.bytes!=null&&ut(k,mt.Video_Send_Low_Bitrate,8*(N.bytes-U.bytes)/W)}}return k})(f[0].ssrcId,e,0,i);break;case Ae.LocalAudioTrack:o=_&&(function(S,T,R,C,b,N){let k=T.audioSend.find(U=>U.ssrc===S);if(!k)return;let P={};if(b){P[mt.Audio_Send_Disabled]=R._originMediaStreamTrack&&!R._originMediaStreamTrack.enabled||R._mediaStreamTrack&&!R._mediaStreamTrack.enabled?1:0;let U=100*R._source.getAccurateVolumeLevel(),W=k.inputLevel;if(W!=null){let Q=Math.ceil(50*Math.log10(100*W+1));ut(P,mt.Audio_Send_Level,Q)}ut(P,mt.Audio_Capture_PCM_Level,U),ut(P,mt.Audio_Send_AEC_Return_Loss,k.aecReturnLoss),ut(P,mt.Audio_Send_AEC_Return_Loss_Enhancement,k.aecReturnLossEnhancement),ut(P,mt.Audio_Send_Bytes_Retransmit,k.retransmittedBytesSent),ut(P,mt.Audio_Send_Packages_Retransmit,k.retransmittedPacketsSent),P[mt.Audio_Send_Freeze]=0;let z=b.audioSend.find(Q=>Q.ssrc===S);if(z){let Q=ap*sp;z.timestamp&&k.timestamp&&(Q=k.timestamp-z.timestamp),z.bytes!=null&&k.bytes!=null&&ut(P,mt.Audio_Send_Bitrate,8*(k.bytes-z.bytes)/Q),z.packets!=null&&k.packets!=null&&ut(P,mt.Audio_Send_Package_Rate,1e3*(k.packets-z.packets)/Q)}}return P})(f[0].ssrcId,e,_,0,i)}}),{high:c,low:d,audio:o}}getInboundStats(e,t,i,r){if(!this.requestRemoteMedia)return;let a=this.requestRemoteMedia()||[],s=[];return a.forEach(o=>{let[c,d]=o,l={peer:c.uid};if(d.has(ze.VIDEO)&&c.videoTrack){let h=c._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(c._videoSSRC)||!1,_=c.videoTrack?(function(f,m,S,T,R,C,b,N){let k=m.videoRecv.find(xe=>xe.ssrc===f);if(!k)return;let P={},{receivedFrame:U,outputFrame:W,decodeFrameRate:z}=k;ut(P,st.Video_Render_Frame_Rate_Decode,z),k.framesRateFirefox&&ut(P,st.Video_Recv_Frame_Rate,k.framesRateFirefox),U&&ut(P,st.Video_Recv_Frame_Rate,U.frameRate),ut(P,st.Video_Recv_Frame_Dropped,k.framesDroppedCount),ut(P,st.Video_Recv_Bytes_Retransmit,k.retransmittedBytesReceived),ut(P,st.Video_Recv_Packages_Retransmit,k.retransmittedPacketsReceived),ut(P,st.Video_Recv_Packages_Discarded,k.packetsDiscarded),ut(P,st.Video_Recv_Avg_Decode,k.avgDecodeMs),ut(P,st.Video_Recv_Avg_Processing_Delay,k.avgProcessingDelayMs),ut(P,st.Video_Recv_Avg_Assembly_Time,k.avgFramesAssembledFromMultiplePacketsMs),ut(P,st.Video_Recv_Avg_Inter_Frame_Delay,k.avgInterFrameDelayMs),ut(P,st.Video_Recv_Key_Frames_Decoded,k.keyFramesDecoded);let Q=N&&N.videoRecv.find(xe=>xe.ssrc===f);if(Q){let xe=m.timestamp-N.timestamp||ap;k.packetsLost!=null&&Q.packetsLost!=null&&ut(P,st.Video_Recv_Package_Lost,k.packetsLost-Q.packetsLost),Q.bytes!=null&&k.bytes!=null&&ut(P,st.Video_Recv_Bitrate,8*(k.bytes-Q.bytes)/xe),Q.packets!=null&&k.packets!=null&&ut(P,st.Video_Recv_Package_Rate,1e3*(k.packets-Q.packets)/xe)}let he=C&&C.videoRecv.find(xe=>xe.ssrc===f);if(he&&(ut(P,Ol.Video_Recv_Qp_Sum,k.qpSumPerFrame),P[Ol.Video_Recv_Freeze]=T&&Ju.isRemoteVideoFreeze(S,k,he)?1:0),b){var Ge;let xe=b.videoRecv.find(ot=>ot.ssrc===f);U?(ut(P,mt.Video_Recv_Height,U.height),ut(P,mt.Video_Recv_Width,U.width)):S&&(ut(P,mt.Video_Recv_Height,S._videoHeight||0),ut(P,mt.Video_Recv_Width,S._videoWidth||0)),W&&ut(P,mt.Video_Recv_Frame_Rate_Output,W.frameRate);let qe=(Ge=S._player)===null||Ge===void 0?void 0:Ge.rendFrameRate.toFixed(0);if(qe&&ut(P,mt.Video_Render_Frame_Rate_Render,+qe),ut(P,mt.Video_Recv_Jitter_Buffer,k.jitterBufferMs),ut(P,mt.Video_Recv_Current_Delay,k.currentDelayMs),ut(P,mt.Video_Recv_Firs,k.firsCount),ut(P,mt.Video_Recv_Nacks,k.nacksCount),ut(P,mt.Video_Recv_Plis,k.plisCount),S){P[mt.Video_Recv_Disabled]=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?0:1;let ot=S._player;if(ot){let{freezeTimeCounterList:xt,renderFreezeAccTime:fe,renderFreezeAccTime2:$,videoElementStatus:ne}=ot;if(xt&&xt.length>0&&ut(P,Ol.Video_Render_Freeze_Time,xt.splice(0,1)[0]),R&&fc.visibility==="visible"&&ne===Mn.PLAYING&&Nt().supportRequestVideoFrameCallback){let ie=Math.min(6e3,$);ot.renderFreezeAccTime2=Math.max(0,$-ie),ut(P,Ol.Video_Render_Freeze_Time_Render2,ie);let A=Math.min(6e3,fe);ot.renderFreezeAccTime=Math.max(0,fe-A),ut(P,Ol.Video_Render_Freeze_Time_Render,B("USE_NEW_RENDER_FREEZE_TIME")?ie:A)}if(typeof k.totalFreezesDuration=="number"){let ie=xe&&xe.totalFreezesDuration?k.totalFreezesDuration-xe.totalFreezesDuration:k.totalFreezesDuration;ut(P,mt.Video_Render_Freeze_Duration,1e3*ie)}}}if(P[mt.Video_Recv_Player_Status]=Tl[S._player?S._player.videoElementStatus:"uninit"],xe&&k.totalInterFrameDelay!==void 0&&k.totalSquaredInterFrameDelay!==void 0&&xe.totalInterFrameDelay!==void 0&&xe.totalSquaredInterFrameDelay!==void 0){let ot=k.totalInterFrameDelay-xe.totalInterFrameDelay,xt=k.totalSquaredInterFrameDelay-xe.totalSquaredInterFrameDelay,fe=k.framesDecodeCount-xe.framesDecodeCount,$=ot/fe*1e3,ne=Math.round(1e3*Math.sqrt((xt-Math.pow(ot,2)/fe)/fe));!isNaN(ne)&&$+ne>Math.max(3*$,$+150)&&(P[mt.Video_Recv_I_Frame_Delay]=ne)}}return P})(c._videoSSRC,e,c.videoTrack,h===!0,this.needUploadRenderFreezeTime,t,i,r):void 0;_&&(l.video=_)}if(d.has(ze.AUDIO)&&c.audioTrack){let h=c.audioTrack?(function(_,f,m,S,T,R){let C=f.audioRecv.find(P=>P.ssrc===_);if(!C)return;let b={};ut(b,st.Audio_Recv_Jitter,C.jitterMs),ut(b,st.Audio_Recv_Bytes_Retransmit,C.retransmittedBytesReceived),ut(b,st.Audio_Recv_Packages_Retransmit,C.retransmittedPacketsReceived),ut(b,st.Audio_Recv_Packages_Discarded,C.packetsDiscarded),ut(b,st.Audio_Recv_Avg_Processing_Delay,C.avgProcessingDelayMs);let N=R&&R.audioRecv.find(P=>P.ssrc===_);if(N){let P=ap;C.packets!=null&&N.packets!=null&&ut(b,st.Audio_Recv_Package_Rate,1e3*(C.packets-N.packets)/P),C.packetsLost!=null&&N.packetsLost!=null&&ut(b,st.Audio_Recv_Package_Lost,C.packetsLost-N.packetsLost)}if(S){let{receivedFrames:P,droppedFrames:U}=C;P!=null&&U!=null&&(b[Ol.Audio_Recv_Freeze]=(k=P)===0||100*U/k>20?1:0)}var k;if(T){let P=100*m._source.getAccurateVolumeLevel(),U=C.outputLevel;if(U!=null){let z=Math.ceil(50*Math.log10(100*U+1));ut(b,mt.Audio_Render_Level,z)}ut(b,mt.Audio_Recv_PCM_Level,P),m&&(b[mt.Audio_Recv_Disabled]=m._originMediaStreamTrack.enabled&&m._mediaStreamTrack.enabled?0:1),ut(b,mt.Audio_Recv_Jitter_Buffer,C.jitterBufferMs),ut(b,mt.Audio_Recv_Current_Delay,C.jitterBufferMs),b[mt.Audio_Recv_Player_Status]=Tl[uo.getPlayerState(m.getTrackId())];let W=T.audioRecv.find(z=>z.ssrc===_);if(W){W.bytes!=null&&C.bytes!=null&&ut(b,mt.Audio_Recv_Bitrate,8*(C.bytes-W.bytes)/(ap*fE));let z=C.concealedSamples-W.concealedSamples;z>0&&ut(b,mt.Audio_Recv_Concealed_Samples,z);let Q=C.totalSamplesReceived-W.totalSamplesReceived;Q>0&&ut(b,mt.Audio_Recv_Total_Samples_Received,Q);let he=C.freezeSamples80-W.freezeSamples80;he>0&&ut(b,mt.Audio_Render_Freeze_Samples_80ms,he);let Ge=C.freezeSamples200-W.freezeSamples200;Ge>0&&ut(b,mt.Audio_Render_Freeze_Samples_200ms,Ge);let xe=C.freezeMs80-W.freezeMs80;ut(b,mt.Audio_Render_Freeze_Time_80ms,xe<0?0:xe);let qe=C.freezeMs200-W.freezeMs200;ut(b,mt.Audio_Render_Freeze_Time_200ms,qe<0?0:qe)}}return b})(c._audioSSRC,e,c.audioTrack,t,i,r):void 0;h&&(l.audio=h)}(l.video||l.audio)&&s.push(l)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,s}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find(t=>t instanceof yr);if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(Et.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(t=>{this.requestUpload&&this.requestUpload(t.type,t.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[t,i]=e;i.has(ze.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(ze.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let t=Date.now(),i={connectionInterval:B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t},r=[],a=this.requestAllTracks&&this.requestAllTracks()||[];for(let d of a)!d.muted&&d.enabled&&(r=r.concat(await d.getProcessorUsage()));let s=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[d,l]of s)l.has(ze.VIDEO)&&d.videoTrack&&(r=r.concat(await d.videoTrack.getProcessorUsage())),l.has(ze.AUDIO)&&d.audioTrack&&(r=r.concat(await d.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=(function(d,l){let h={};for(let{id:S,value:T,level:R,direction:C}of d){var _;let b=(_=l.get(S))!==null&&_!==void 0?_:0,N=T===2?b+B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:b;var f,m;l.set(S,N),h[S]?(T===2&&(h[S].value=T),R>h[S].level&&(h[S].level=R),C==="remote"&&(h[S].remoteUidCount+=1),h[S].totalTs=(f=l.get(S))!==null&&f!==void 0?f:0):h[S]={value:T,level:R,remoteUidCount:C==="local"?0:1,totalTs:(m=l.get(S))!==null&&m!==void 0?m:0}}return Object.keys(h).map(S=>{let{level:T,value:R,totalTs:C}=h[S];return{id:S,level:T,value:R,totalTs:C}})})(r,e);let o=Date.now(),c=o>t?o:t+1;this.requestUpload&&this.requestUpload(Et.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:c})},B("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let sj=B("ICE_RESTART_INTERVAL"),c0=new Map,R_=new Map,Md=[Me.UDP_TCP_RELAY,Me.TCP_RELAY,Me.RELAY],op=B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Nt().supportPCSetConfiguration;function d0(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=c0.get(n.id);t&&(window.clearTimeout(t),c0.delete(n.id));let i=R_.get(n.id);e&&i&&i.index===Md.length-1&&(I.debug("[".concat(n.id,"] reset ICE restart policy")),R_.delete(n.id))}function tx(n,e,t){if(c0.size===0&&R_.size===0&&(Array.isArray(B("RESTART_SEQUENCE"))&&B("RESTART_SEQUENCE").length>0&&!(function(o,c){if(o.length!==c.length)return!1;for(let d=0;d<o.length;d+=1){let l=o[d];if(o.filter(h=>h===l).length!==c.filter(h=>h===l).length)return!1}return!0})(Md,B("RESTART_SEQUENCE"))&&(Md=B("RESTART_SEQUENCE").filter(o=>{var c;if(ee(c=Object.values(Me)).call(c,o))return!0}),I.debug("use reconnection policy from config distribution, queues: ".concat(Md.join(" => ")))),op=B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Nt().supportPCSetConfiguration),Md.length===0)return void t();let i,{index:r=0,type:a}=R_.get(n.id)||{};if(op&&a===Me.RELAY)return void t();let s=a&&r>=Md.length-1;if(op)a=Me.RELAY;else{if(s)return void t();a?(r++,a=Md[r]):(a=Md[0],r=0)}I.debug("[".concat(n.id,"] choose ICE restart policy: ").concat(a,", index: ").concat(r)),e(a),R_.set(n.id,{index:r,type:a}),i=window.setTimeout(()=>tx(n,e,t),sj),c0.set(n.id,i)}var ei;function ti(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Zu(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ti(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ti(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Qu(n){var e,t,i,r=2;for(typeof Symbol<"u"&&(t=GT,i=Symbol.iterator);r--;){if(t&&(e=n[t])!=null)return e.call(n);if(i&&(e=n[i])!=null)return new Jb(e.call(n));t="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Jb(n){function e(t){if(Object(t)!==t)return se.reject(new TypeError(t+" is not an object."));var i=t.done;return se.resolve(t.value).then(function(r){return{value:r,done:i}})}return Jb=function(t){this.s=t,this.n=t.next},Jb.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var i=this.s.return;return i===void 0?se.resolve({value:t,done:!0}):e(i.apply(this.s,arguments))},throw:function(t){var i=this.s.return;return i===void 0?se.reject(t):e(i.apply(this.s,arguments))}},new Jb(n)}let EE=(ei=class extends Sr{get state(){return this._state}set state(n){let e=this._state;this._state=n,this.emit(Ue.StateChange,e,this._state)}constructor(n,e){super(),F(this,"isPlanB",void 0),F(this,"store",void 0),F(this,"statsUploader",void 0),F(this,"connection",void 0),F(this,"localTrackMap",new Map),F(this,"remoteUserMap",new Map),F(this,"localDataChannels",[]),F(this,"remoteDataChannelMap",new Map),F(this,"pendingLocalTracks",[]),F(this,"pendingRemoteTracks",[]),F(this,"pendingLocalDataChannels",[]),F(this,"pendingRemoteDataChannels",[]),F(this,"statsCollector",void 0),F(this,"shouldForwardP2PCreation",void 0),F(this,"iceFailedCount",0),F(this,"dtlsFailedCount",0),F(this,"mutex",void 0),F(this,"_state",Ee.Disconnected),F(this,"_pcStatsUploadType",B("NEW_ICE_RESTART")?Tn.FIRST_CONNECTION:Tn.OLD_FIRST_CONNECTION),F(this,"_isStartRestartIce",!1),F(this,"_restartTimer",void 0),F(this,"_isTryConnecting",!1),F(this,"_iceError",null),F(this,"_forceTurn",!1),F(this,"_isWaitPcToRePub",!1),F(this,"handleMuteLocalTrack",async(t,i,r)=>{let a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ee.Connected)return void r(new L(M.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let s=this.filterTobeMutedTracks(t);if(s.length===0)return void i();let o=s.find(d=>d[0]==="videoLowTrack");if(o){let d=o[1];this.store.enableInstantMuteRestore?(d.track._originMediaStreamTrack.enabled=!1,I.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):d.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?I.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(s.map(d=>{let[,{id:l}]=d;return l}));let c=this.createMuteMessage(s);await zt(this,Ue.RequestMuteLocal,c),i()}catch(s){r(s)}finally{a()}}),F(this,"handleUnmuteLocalTrack",async(t,i,r)=>{let a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ee.Connected)return void r(new L(M.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let s=this.filterTobeUnmutedTracks(t);if(s.length===0)return void i();let o=s.find(d=>d[0]==="videoLowTrack");if(o){let d=o[1];if(this.store.enableInstantMuteRestore)d.track._originMediaStreamTrack.enabled=!0,I.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(d.track._originMediaStreamTrack.stop(),!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nt().supportDualStreamEncoding){let l=t._mediaStreamTrack.clone();d.track._mediaStreamTrack=l,d.track._originMediaStreamTrack=l}else{let l=Is(t,Bs(this,Ue.RequestLowStreamParameter));d.track._mediaStreamTrack=l,d.track._originMediaStreamTrack=l}await new se((l,h)=>{this.handleReplaceTrack(d.track,l,h,!0)})}}this.store.enableInstantMuteRestore?I.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(s.map(d=>{let[,{id:l}]=d;return l}));let c=this.createUnmuteMessage(s);await zt(this,Ue.RequestUnmuteLocal,c),i()}catch(s){r(s)}finally{a()}}),F(this,"handleUpdateVideoEncoder",async(t,i,r,a)=>{let s;a||(s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let c=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.connection||!c||c.track!==t||this.state!==Ee.Connected)return void i();let{id:d,track:l}=c;await this.connection.updateSendParameters(d,l),await this.connection.updateEncoderConfig(d,l),this.emit(Ue.UpdateVideoEncoder,l),i()}catch(c){r(c)}finally{var o;(o=s)===null||o===void 0||o()}}),F(this,"handleUpdateVideoSendParameters",async(t,i,r)=>{let a=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let s=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.connection||!s||s.track!==t||this.state!==Ee.Connected)return void i();let{id:o,track:c}=s;await this.connection.updateSendParameters(o,c),i()}catch(s){r(s)}finally{a()}}),F(this,"handleReplaceMixingTrack",async(t,i,r,a)=>{if(!this.connection||this.state!==Ee.Connected)return void i();let s=qb([t]),o;I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(s.getTrackId(),"]")),typeof a=="boolean"&&a||(o=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(t,s),i()}catch(d){r(d)}finally{var c;(c=o)===null||c===void 0||c()}}),F(this,"handleReplaceTrack",async(t,i,r,a)=>{let s;I.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),typeof a=="boolean"&&a||(s=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;let d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return t===h});if(!this.connection||!d||this.state!==Ee.Connected)return void i();if(await((o=this.connection)===null||o===void 0?void 0:o.replaceTrack(t,d[1].id)),this.isPlanB){let l=d[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(d[0],l)}if(d[0]===Ae.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nt().supportDualStreamEncoding){let l=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(l){let h=t._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=h,l.track._originMediaStreamTrack=h,await new se((_,f)=>{this.handleReplaceTrack(l.track,_,f,!0)})}}i()}catch(d){r(d)}finally{var c;(c=s)===null||c===void 0||c()}}),F(this,"handleGetRTCStats",t=>{t(this.statsCollector.getRTCStats())}),F(this,"handleGetLocalVideoStats",t=>{t(this.statsCollector.getLocalVideoTrackStats())}),F(this,"handleGetLocalAudioStats",t=>{t(this.statsCollector.getLocalAudioTrackStats())}),F(this,"handleGetRemoteVideoStats",t=>this.statsCollector.getRemoteVideoTrackStats(t.uid)[t.uid]),F(this,"handleGetRemoteAudioStats",t=>this.statsCollector.getRemoteAudioTrackStats(t.uid)[t.uid]),this.store=n,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new ex(this.store),this.bindStatsUploaderEvents(),this.mutex=new xa("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Nt().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&xu(),this.shouldForwardP2PCreation=B("FORWARD_P2P_CREATION")&&Nt().supportPCSetConfiguration&&sO(),this.shouldForwardP2PCreation&&(this.connection=a0(this.store),this.emit(Ue.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(n,e){var t;this.state=Ee.New,this._forceTurn=s0(n),I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let i=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||e)&&((i||e)&&this.connection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=a0(this.store,n),this.emit(Ue.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new L(M.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=B("NEW_ICE_RESTART")?Tn.FIRST_CONNECTION:Tn.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(n),this.connection.establishPromise}async connect(n){if(!this.connection)throw new L(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Ee.Connected){if(this.connection instanceof wa&&this.connection.checkDtlsParameters(n.dtlsParameters.fingerprints))return I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Te.reportApiInvoke(this.store.sessionId,{name:Jr.MISMATCH_DTLS_PARAMETERS,options:[n.dtlsParameters.fingerprints],tag:Gt.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Ue.RequestReconnect)});await this.connection.updateRemoteConnect(n)}else this.store.peerConnectionStart(),await this.connection.connect(n),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ee.Connected}updateRemoteRTPCapabilities(n){let e=Array.from(this.localTrackMap.entries()).filter(r=>{var a;let[s]=r;return ee(a=[Ae.LocalVideoLowTrack,Ae.LocalVideoTrack]).call(a,s)}),t=e.map(r=>{let[,{id:a}]=r;return a}),i=e.map(r=>{let[a]=r;return a});if(this.connection instanceof wa){if(Te.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(n)}),!ee(n).call(n,this.store.codec)){let r=["vp9","vp8","h264"].find(a=>ee(n).call(n,a));r&&(this.store.codec=r,I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(t,n)}}async getEstablishParams(){var n;if(this.connection instanceof wa&&this.connection.peerConnectionState!=="closed"&&ee(n=[Ee.New,Ee.Connected]).call(n,this.state))return this.connection.establishPromise}async publishDataChannel(n){if(!this.connection||this.state!==Ee.Connected){if(this.state===Ee.Disconnected)throw new L(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return n.forEach(t=>{var i;ee(i=this.pendingLocalDataChannels).call(i,t)||this.pendingLocalDataChannels.push(t)}),[]}let e=this.filterTobePublishedDataChannels(n);return e.length===0?[]:(e.forEach(t=>{let i=Date.now();this.store.publish(t.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(t=>{this.localDataChannels.push(t);let i=Date.now();this.store.publish(t.id+"","datachannel",void 0,i)}),n.map(t=>({streamId:t.id,ordered:t.ordered,maxRetransmits:t.maxRetransmits,metadata:t.metadata,channelId:t._originDataChannelId})))}publish(n,e,t){var i=this;return cc(function*(){let r=yield di(i.mutex.lock("From P2PChannel.publish"));try{var a;let s=i.connection&&ee(a=["disconnected","failed"]).call(a,i.connection.peerConnectionState);if(!i.connection||i.state!==Ee.Connected||s){if(i.state===Ee.Disconnected)throw new L(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(n);let c=n.filter(d=>i.pendingLocalTracks.indexOf(d)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(c),void(s&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Ia.markPublishStart(i.store.clientId,i.store.pubId);let o=i.filterTobePublishedTracks(n,e,t);if(o.length===0)return void(yield di(i.tryToUnmuteAudio(n)));yield*hi(Qu(i.doPublish(i.connection,o)))}finally{r()}})()}doPublish(n,e){var t=this;return cc(function*(){e.forEach(_=>{let{track:f,type:m}=_,S=Date.now();t.store.publish(f.getTrackId(),m===Ae.LocalAudioTrack?"audio":"video",S)}),t.bindLocalTrackEvents(e);let i=e.map(_=>{let{track:f}=_;return f}),r=yield di(n.send(i,t.store.codec,t.store.audioCodec)),a=(yield di(r.next())).value,s=t.createGatewayPublishMessage(e,a),o;try{o=yield s}catch(_){throw r.throw(_),_?.code===M.WS_ABORT&&e.forEach(f=>{let{track:m}=f;t.pendingLocalTracks.indexOf(m)===-1&&t.pendingLocalTracks.push(m)}),t.unbindLocalTrackEvents(e),_}let c=t.mapPubResToRemoteConfig(s,o,i),d=(yield di(r.next(c))).value;if(t.state===Ee.Disconnected)throw new L(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");B("ENABLE_VIDEO_SEI");let l=B("ENABLE_ENCODED_TRANSFORM"),h=B("ENABLE_AUDIO_METADATA");i.forEach(async _=>{let f=_.getRTCRtpTransceiver();if(!f||!l)return;let{interceptLocalVideoFrame:m,interceptLocalAudioFrame:S}=Hb();_.trackMediaType===ze.VIDEO?await m(f.sender,_):_.trackMediaType===ze.AUDIO&&await S(f.sender,{metadata:h?()=>{let T=_.metadata.shift();return T&&T.value}:void 0})}),e.forEach(_=>{let{type:f}=_;t.statsCollector.addLocalStats(f)}),t.assignLocalTracks(e,d),t.statsUploader.startUploadOutboundStats(),e.forEach(_=>{let{track:f,type:m}=_,S=Date.now();t.store.publish(f.getTrackId(),m===Ae.LocalAudioTrack?"audio":"video",void 0,S)})})()}async updateVideoStreamParameter(n,e){let t=this.localTrackMap.get(e);if(!t||!this.connection)return;if(!(t.track instanceof Ai))return I.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:i}=t,r=(function(a,s){let o={};return a.height&&a.width&&(o.scaleResolutionDownBy=YO(a,s)),o.maxFramerate=a.framerate?po(a.framerate):void 0,o.maxBitrate=a.bitrate?1e3*a.bitrate:void 0,o})(n,i);if(i._encoderConfig||(i._encoderConfig={}),e!==Ae.LocalVideoLowTrack||!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nt().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{let a=i._originMediaStreamTrack;if(!a.canvas)return I.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(s,o){let c=s.canvas;o.width&&(c.width=po(o.width)),o.height&&(c.height=po(o.height)),o.framerate&&(c.stopCapture&&c.stopCapture(),c.stopCapture=Sb(()=>{!c.startCapture&&c.stopCapture&&c.stopCapture(),c.startCapture&&c.startCapture()},po(o.framerate)))})(a,n)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),I.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(n){var e=this;return cc(function*(){if(!e.connection||e.state!==Ee.Connected)return;let t=yield di(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let r=e.localTrackMap.get(Ae.LocalVideoTrack);if(!r)throw new L(M.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(Ae.LocalVideoLowTrack))throw new L(M.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));let a=[{track:e.getLowVideoTrack(r.track,n),type:Ae.LocalVideoLowTrack}];if(yield*hi(Qu(e.doPublish(e.connection,a))),r.track.muted||!r.track.enabled){var i;let s=(i=e.localTrackMap.get(Ae.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;s!==void 0&&(yield di(e.connection.muteLocal([s])))}}finally{t()}})()}async republish(){this.pendingLocalTracks.length>0&&(I.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await kn(this,Ue.RequestRePublish,this.pendingLocalTracks),this.emit(Ue.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(I.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await kn(this,Ue.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(n){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){let{user:t,kind:i}=this.pendingRemoteTracks[e];(i!==ze.AUDIO||t._audio_added_&&t._audioSSRC)&&(i!==ze.VIDEO||t._video_added_&&t._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(n)await kn(this,Ue.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:e,kind:t}of this.pendingRemoteTracks)await this.subscribe(e,t,t===ze.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(Ue.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(n){if(!this.connection||this.state!==Ee.Connected)return void n.forEach(i=>{let r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});let e=this.filterTobeUnpublishedTracks(n);if(e.length===0)return;let t=e.find(i=>i[0]==="videoLowTrack");return t&&t[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(n){if(!this.connection||this.state!==Ee.Connected)return void n.forEach(t=>{let i=this.pendingLocalDataChannels.indexOf(t);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});let e=this.filterTobeUnpublishedDataChannels(n);return e.length!==0?(e.forEach(t=>{let i=this.localDataChannels.indexOf(t);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(t=>t.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ee.Connected)return;let n=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(!n)return;n.track.close();let e=[[Ae.LocalVideoLowTrack,n]];return this.doUnpublish(this.connection,e)}async doUnpublish(n,e){let t=this.createGatewayUnpublishMessage(e);return await n.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:a}]=i;return{type:r,track:a}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),t}async subscribeDataChannel(n,e){if(!this.connection||this.state!==Ee.Connected)throw new L(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let t=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(n))!==null&&r!==void 0&&r.get(i.id))});if(t.length!==0)return await this.connection.createDataChannels(n.uid,t),t.forEach(i=>{var r;this.remoteDataChannelMap.has(n)?(r=this.remoteDataChannelMap.get(n))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(n,new Map([[i.id,i]]));let a=this.pendingRemoteDataChannels.findIndex(s=>{let{user:o,id:c}=s;return o.uid===n.uid&&c===i.id});a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),t.map(i=>i.id)}async subscribe(n,e,t,i,r){var a;if(!this.connection||this.state!==Ee.Connected)throw new L(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(n))!==null&&a!==void 0&&a.has(e))return;let s,o,c,d,l=this.connection.getPreMedia(t);if(l)I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(t,", no need to send sub to gateway.")),c=l.transceiver,s=l.track,o=l.mid,d=l.player,l.firstVideoRender&&this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:l.firstVideoRender});else if(r){let f=r.find(S=>{let{stream_type:T}=S;return T===e});if(!f)throw new L(M.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(n.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));let m=await this.connection.receive(e,f.ssrcs,String(n._uintid),f.attributes);this.connection instanceof wa&&(c=m.transceiver),s=m.track,o=m.id}else{let f=await this.connection.receive(e,[{ssrcId:t,rtx:i}],String(n._uintid),void 0);this.connection instanceof wa&&(c=f.transceiver),s=f.track,o=f.id}if(e===ze.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(s):(n._audioTrack=new Wu(s,n.uid,n._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),c&&n._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(s):(n._videoTrack=new Og(s,n.uid,n._uintid,this.store,d),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId())),n._videoTrack.once(js.PLAY_START,()=>{this.store.firstVideoFrameDecoded(n.uid,{playStart:Date.now()})}),n._videoTrack.once(js.PLAY_END,()=>{this.store.firstVideoFrameDecoded(n.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(n)}),d?n._videoTrack.once(js.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(n.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(n)}):n._videoTrack.once(js.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(n.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(n)})),c&&n._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(n,n._videoTrack)),c&&B("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:f,interceptRemoteAudioFrame:m}=Hb();e==ze.VIDEO?await f(c.receiver,{onSei:B("ENABLE_VIDEO_SEI")&&(S=>{var T;return(T=n._videoTrack)===null||T===void 0?void 0:T._onSei(S)})}):e==ze.AUDIO&&await m(c.receiver,{enableTopn:!!B("ENABLE_AUDIO_TOPN"),enableMetadata:!!B("ENABLE_AUDIO_METADATA"),enablePts:!!B("ENABLE_AUDIO_PTS"),onMetadata:S=>{this.safeEmit(Ue.AudioMetadata,S)},onPts:S=>{this.safeEmit(Ue.AudioPts,S)}})}let h=this.remoteUserMap.get(n);h?h.set(e,o):this.remoteUserMap.set(n,new Map([[e,o]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats();let _=this.pendingRemoteTracks.findIndex(f=>{let{user:m,kind:S}=f;return m.uid===n.uid&&e===S});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Ue.MediaReconnectEnd,n.uid))}async massSubscribe(n){return this.massSubscribeNoLock(n)}async massSubscribeNoLock(n){if(!this.connection||this.state!==Ee.Connected)throw new L(M.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");n=n.filter(r=>{var a;let{user:s,mediaType:o}=r;return!((a=this.remoteUserMap.get(s))!==null&&a!==void 0&&a.has(o))});let e=[],t=new Map;n.forEach(r=>{if(!this.connection)return;let a=this.connection.getPreMedia(r.ssrcId);if(a){let{track:s,mid:o,transceiver:c,player:d}=a;t.set(r.ssrcId,{track:s,id:o,transceiver:c,player:d})}else e.push(r)});let i=await this.connection.batchReceive(e.map(r=>{let{user:a,mediaType:s,ssrcId:o,rtxSsrcId:c}=r;return{kind:s,ssrcMsg:[{ssrcId:o,rtx:c}],mslabel:String(a._uintid)}}));e.forEach((r,a)=>{t.set(r.ssrcId,i[a])});for(let{user:r,mediaType:a,ssrcId:s}of n){let o=t.get(s);if(!o)return void I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(a,", ").concat(s));let{track:c,id:d,transceiver:l,player:h}=o;if(l&&B("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:m,interceptRemoteAudioFrame:S}=Hb();a==ze.VIDEO?await m(l.receiver,{onSei:B("ENABLE_VIDEO_SEI")&&(T=>{var R;return(R=r._videoTrack)===null||R===void 0?void 0:R._onSei(T)})}):a==ze.AUDIO&&await S(l.receiver,{enableTopn:!!B("ENABLE_AUDIO_TOPN"),enableMetadata:!!B("ENABLE_AUDIO_METADATA"),enablePts:!!B("ENABLE_AUDIO_PTS"),onMetadata:T=>{this.safeEmit(Ue.AudioMetadata,T)},onPts:T=>{this.safeEmit(Ue.AudioPts,T)}})}if(a===ze.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(c):(r._audioTrack=new Wu(c,r.uid,r._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),l&&r._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(c):(r._videoTrack=new Og(c,r.uid,r._uintid,this.store,h),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),l&&r._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(r,r._videoTrack)),B("ENABLE_VIDEO_SEI")&&l){let{interceptRemoteVideoFrame:m,interceptRemoteAudioFrame:S}=Hb();a==ze.VIDEO?await m(l.receiver,{onSei:T=>{var R;(R=r._videoTrack)===null||R===void 0||R._onSei(T)}}):a==ze.AUDIO&&await S(l.receiver)}let _=this.remoteUserMap.get(r);_?_.set(a,d):this.remoteUserMap.set(r,new Map([[a,d]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();let f=this.pendingRemoteTracks.findIndex(m=>{let{user:S,kind:T}=m;return S.uid===r.uid&&a===T});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Ue.MediaReconnectEnd,r.uid))}}async unsubscribe(n,e,t){let i=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:c}=s;return e!==void 0?o.uid===n.uid&&e===c:o.uid===n.uid});if(i.forEach(s=>{let o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.connection&&this.state===Ee.Connected||t||i.forEach(s=>{let{kind:o}=s;var c;if(o===ze.AUDIO)(c=n._audioTrack)===null||c===void 0||c._destroy(),n._audioTrack=void 0;else if(o===ze.VIDEO){var d;(d=n._videoTrack)===null||d===void 0||d._destroy(),n._videoTrack=void 0}}),!this.connection||this.state!==Ee.Connected)return;let r=this.filterTobeUnSubscribedTracks(n,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(s=>{let[,{id:o}]=s;return o}));let a=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(s=>{let[o,{kind:c}]=s;var d,l;if(c===ze.VIDEO&&o._videoSSRC&&((d=this.connection)===null||d===void 0||d.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===ze.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),t||((l=o._videoTrack)===null||l===void 0||l._destroy(),o._videoTrack=void 0);else if(c===ze.AUDIO){var h;this.unbindRemoteTrackEvents(o._audioTrack),!t&&((h=o._audioTrack)===null||h===void 0||h._destroy(),o._audioTrack=void 0)}}),a}async unsubscribeDataChannel(n,e){if(e.forEach(r=>{let a=this.pendingRemoteDataChannels.findIndex(s=>s.id===r.id);a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),!this.connection)return;let t=this.filterTobeUnSubscribedDataChannels(n,e);if(t.length===0)return;e.forEach(r=>{r._close()});let i=this.remoteDataChannelMap.get(n);return t.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(n),await this.connection.stopDataChannels(n.uid)),t.map(r=>r.id)}async massUnsubscribe(n){return this.massUnsubscribeNoLock(n)}async massUnsubscribeNoLock(n){let e=[];for(let{user:r,mediaType:a}of n){let s=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:d}=o;return a!==void 0?c.uid===r.uid&&a===d:c.uid===r.uid});s.forEach(o=>{let c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),e=e.concat(s)}if(!this.connection||this.state!==Ee.Connected)return void e.forEach(r=>{let{user:a,kind:s}=r;var o;if(s===ze.AUDIO)(o=a._audioTrack)===null||o===void 0||o._destroy(),a._audioTrack=void 0;else if(s===ze.VIDEO){var c;(c=a._videoTrack)===null||c===void 0||c._destroy(),a._videoTrack=void 0}});let t=Pn(n).call(n,(r,a)=>{let{user:s,mediaType:o}=a,c=this.filterTobeUnSubscribedTracks(s,o);return r.concat(c)},[]);if(t.length===0)return;await this.connection.stopReceiving(t.map(r=>{let[,{id:a}]=r;return a}));let i=this.createUnsubscribeAllMessage(t);return this.withdrawRemoteTracks(t),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),t.forEach(r=>{let[a,{kind:s}]=r;var o,c;if(s===ze.VIDEO&&a._videoSSRC&&((o=this.connection)===null||o===void 0||o.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),s===ze.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(c=a._videoTrack)===null||c===void 0||c._destroy(),a._videoTrack=void 0;else if(s===ze.AUDIO){var d;this.unbindRemoteTrackEvents(a._audioTrack),(d=a._audioTrack)===null||d===void 0||d._destroy(),a._audioTrack=void 0}}),i}isPreSubScribe(n){return!this.connection||this.state!==Ee.Connected?!1:!!this.connection.getPreMedia(n)}async muteRemote(n,e){if(!this.connection)return;let t=this.remoteUserMap.get(n);if(!t)return void I.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid,"."));if(!t.get(e))return void I.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid," media type ").concat(e,"."));let i=e===ze.VIDEO?n._videoSSRC:n._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(n,e){return this.unmuteRemoteNoLock(n,e)}async unmuteRemoteNoLock(n,e){if(!this.connection)return;let t=this.remoteUserMap.get(n);if(!t)return void I.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid,"."));t.get(e)||I.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(e,"."))}addAudioMetadata(n){let e=this.localTrackMap.get(Ae.LocalAudioTrack),t=e&&e.track;t&&t.metadata.push(n)}getAllTracks(n){let e=this.localTrackMap.get(Ae.LocalAudioTrack);if(e?.track instanceof Un){let t=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==Ae.LocalAudioTrack}).filter(i=>{let[r]=i;return!(n&&r===Ae.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(t.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[i]=t;return!(n&&i===Ae.LocalVideoLowTrack)}).map(t=>{let[,{track:i}]=t;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(n,e,t,i,r){if(n){let s=this.localTrackMap.get(Ae.LocalAudioTrack),o=i?this.localTrackMap.get(Ae.LocalVideoLowTrack):this.localTrackMap.get(Ae.LocalVideoTrack);Te.publish(this.store.sessionId,{eventElapse:Ia.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:e,audioName:s?.track.getTrackLabel(),videoName:o?.track.getTrackLabel(),screenshare:o?.track._hints.indexOf(Oe.SCREEN_TRACK)!==-1,audio:!!s,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;t||(t=[]);let s=t.find(c=>c instanceof Ti),o=i?(a=this.localTrackMap.get(Ae.LocalVideoTrack))===null||a===void 0?void 0:a.track:t.find(c=>c instanceof Ai);Te.publish(this.store.sessionId,{eventElapse:Ia.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:e,audioName:s?.getTrackLabel(),videoName:o?.getTrackLabel(),screenshare:o?._hints.indexOf(Oe.SCREEN_TRACK)!==-1,audio:!!s,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(n,e,t,i){let r=i===ze.VIDEO?t._videoSSRC:t._audioSSRC;r&&Te.subscribe(this.store.sessionId,{succ:n,ec:e,video:i===ze.VIDEO,audio:i===ze.AUDIO,peerid:t.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:Ia.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new xa("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=a0(this.store),this.emit(Ue.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let n=this.localTrackMap.get(Ae.LocalAudioTrack);if(n?.track instanceof Un){if(n.track.trackList.length>0){let e=n.track;n.track.trackList.forEach(t=>{e.removeAudioTrack(t)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ee.Disconnected}getStats(){var n;return(n=this.connection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(n){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){let n=this.localTrackMap.get(Ae.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){let n=this.localTrackMap.get(Ae.LocalVideoTrack);if(n)return{width:n.track.videoWidth||0,height:n.track.videoHeight||0}}getEncoderConfig(n){let e=this.localTrackMap.get(n);return e&&e.track instanceof Ai||e&&e.track instanceof Ti?e.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,e){if(!n)return this.remoteUserMap.size>0;let t=this.remoteUserMap.get(n);return!!t&&(!e||t.has(e))}async hasRemoteMediaWithLock(n,e){if(!n)return this.remoteUserMap.size>0;let t=this.remoteUserMap.get(n);return!!t&&(!e||t.has(e))}getRemoteMedia(n){var e;let t=Array.from(Lo(e=this.remoteUserMap).call(e)).find(i=>i.uid===n);return t?{audioTrack:t.audioTrack,audioSSRC:t._audioSSRC,videoTrack:t.videoTrack,videoSSRC:t._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(t=>{let[i]=t;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}),e=this.localTrackMap.get(Ae.LocalAudioTrack);return e&&n.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=vt(n).call(n,(t,i)=>t.level-i.level),n}async disconnectForReconnect(){this.connection&&(I.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ee.Reconnecting,B("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[e]=n;var t;e._videoTrack&&e._videoTrack._player&&((t=e._videoTrack._player.getVideoElement())===null||t===void 0||t.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=a0(this.store),this.emit(Ue.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(n=>{var e;let[t,{track:i}]=n;switch(t){case Ae.LocalVideoTrack:ee(e=i._hints).call(e,Oe.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case Ae.LocalAudioTrack:i instanceof Un?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case Ae.LocalVideoLowTrack:}}),this.emit(Ue.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[e,t]=n;Array.from(Lo(t).call(t)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Ue.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(n=>{this.pendingLocalDataChannels.push(n)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(n=>{let[e,t]=n;Array.from(Lo(t).call(t)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),I.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(n,e){for(let t of this.pendingRemoteDataChannels){let{user:i,id:r}=t;if((n instanceof g_?n.uid:n)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(n,e){this.hasPendingRemoteDataChannel(n,e)||this.pendingRemoteDataChannels.push({user:n,id:e})}hasPendingRemoteMedia(n,e){for(let t of this.pendingRemoteTracks){let{user:i,kind:r}=t;if((n instanceof g_?n.uid:n)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(n,e){this.hasPendingRemoteMedia(n,e)||this.pendingRemoteTracks.push({user:n,kind:e})}restartICE(n){var e=this;return cc(function*(){if(!e.connection||e.state!==Ee.Connected)return;let t=yield di(e.mutex.lock("From P2PChannel.restartICE")),i;try{i=yield di(e.connection.restartICE(n));let a=yield di(i.next());if(a.done)return;let s=a.value,o=yield s;switch(DR(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),n){case Me.UDP_TCP_RELAY:e._pcStatsUploadType=Tn.UDP_TCP_RESTART;break;case Me.TCP_RELAY:e._pcStatsUploadType=Tn.TCP_RESTART;break;case Me.RELAY:e._pcStatsUploadType=Tn.RELAY_RESTART;break;default:e._pcStatsUploadType=Tn.OLD_RESTART}e._isTryConnecting=!0,i.next(o)}catch(a){var r;(r=i)===null||r===void 0||r.throw(a)}finally{t()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let n=this.connection.getStats(),e=this.localTrackMap.get(Ae.LocalVideoTrack),t=this.localTrackMap.get(Ae.LocalAudioTrack),i=n.videoSend.find(f=>f.ssrc===e?.ssrcs[0].ssrcId),r=n.audioSend.find(f=>f.ssrc===t?.ssrcs[0].ssrcId);if(!i||!r)return 1;let a=fi(this,Ue.NeedSignalRTT),s=i?i.rttMs:void 0,o=r?r.rttMs:void 0,c=s&&o?(s+o)/2:s||o,d=(c&&a?(c+a)/2:c||a)||0,l=100*n.sendPacketLossRate*.7/50+.3*d/1500,h=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,_=e?.track;if(_&&_._encoderConfig&&_._hints.indexOf(Oe.SCREEN_TRACK)===-1){let f=_._encoderConfig.bitrateMax,m=n.bitrate.actualEncoded;if(f&&m){let S=(1e3*f-m)/(1e3*f);return BB[S<.15?0:S<.3?1:S<.45?2:S<.6?3:4][h]}}return h}getDownlinkNetworkQuality(){if(!this.connection)return 0;let n=this.connection.getStats(),e=0;return Array.from(this.remoteUserMap.entries()).forEach(t=>{let[i]=t,r=i._audioSSRC,a=i._videoSSRC,s=n.audioRecv.find(m=>m.ssrc===r),o=n.videoRecv.find(m=>m.ssrc===a);if(!s&&!o)return void(e+=1);let c=fi(this,Ue.NeedSignalRTT),d=n.rtt,l=(d&&c?(d+c)/2:d||c)||0,h=s?s.jitterMs:void 0,_=n.recvPacketLossRate,f=.7*_*100/50+.3*l/1500;h&&(f=.6*_*100/50+.2*l/1500+.2*h/400),e+=f<.1?1:f<.17?2:f<.36?3:f<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(n){return new se((e,t)=>{this.handleMuteLocalTrack(n,e,t)})}async replaceTrack(n,e){var t;if(I.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(n.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Ee.Connected)return;let i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:s}]=a;return n===s});if(!i)return;let r=i[0];if(n!==e&&(this.unbindLocalTrackEvents([{track:n,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((t=this.connection)===null||t===void 0?void 0:t.replaceTrack(e,i[1].id)),this.isPlanB){let a=i[1];a.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,a)}if(r===Ae.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nt().supportDualStreamEncoding){let a=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(a){let s=n._mediaStreamTrack.clone();a.track._originMediaStreamTrack.stop(),a.track._mediaStreamTrack=s,a.track._originMediaStreamTrack=s,await new se((o,c)=>{this.handleReplaceTrack(a.track,o,c,!0)})}}}filterTobePublishedTracks(n,e,t){let i=[],r=this.getAllTracks();n=t_(n=n.filter(c=>r.indexOf(c)===-1));let a,s=!1,o=this.localTrackMap.get(Ae.LocalAudioTrack);for(let c of n){if(c instanceof Ai&&(this.localTrackMap.has(Ae.LocalVideoTrack)||s?new L(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:c,type:Ae.LocalVideoTrack}),s=!0),e)){let d=this.getLowVideoTrack(c,t);i.push({track:d,type:Ae.LocalVideoLowTrack})}if(c instanceof Ti)if(o){let d=o.track;if(d instanceof Un)ZU([c]),d.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{let l=qb([d,c]);I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),this.replaceTrack(d,l)}}else a instanceof Un?(ZU([c]),a.addAudioTrack(c)):a||!c._useAudioElement&&Nt().webAudioMediaStreamDest&&!c._bypassWebAudio?a=qb(a?[c,a]:[c]):a=c}return a&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),i.push({track:a,type:Ae.LocalAudioTrack})),i}filterTobeUnpublishedTracks(n){let e=[],t=this.getAllTracks();n=t_(n=n.filter(i=>t.indexOf(i)!==-1));for(let i of n){if(i instanceof Ti){let r=this.localTrackMap.get(Ae.LocalAudioTrack);if(!r)continue;r.track instanceof Un?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([Ae.LocalAudioTrack,r]),r.track.close())):e.push([Ae.LocalAudioTrack,r])}if(i instanceof Ai){let r=this.localTrackMap.get(Ae.LocalVideoTrack);if(!r)continue;e.push([Ae.LocalVideoTrack,r]);let a=this.localTrackMap.get(Ae.LocalVideoLowTrack);a&&e.push([Ae.LocalVideoLowTrack,a])}}return e}filterTobePublishedDataChannels(n){return n=(n=t_(n)).filter(e=>this.localDataChannels.findIndex(t=>t.id===e.id)===-1)}filterTobeUnpublishedDataChannels(n){return n=(n=(n=t_(n)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(n){n.forEach(e=>{let{track:t,type:i}=e;switch(i){case Ae.LocalVideoTrack:t.addListener(Je.GET_STATS,this.handleGetLocalVideoStats),t.addListener(Je.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case Ae.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(n,e){n instanceof Un?n.trackList.forEach(t=>{t.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Je.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(Je.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(n.addListener(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Je.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:i}]=e;return{track:i,type:t}})),n.forEach(e=>{let{track:t,type:i}=e;switch(i){case Ae.LocalVideoTrack:t.off(Je.GET_STATS,this.handleGetLocalVideoStats),t.off(Je.GET_RTC_STATS,this.handleGetRTCStats),t.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case Ae.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(n){n instanceof Un?n.trackList.forEach(e=>{e.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Je.GET_STATS,this.handleGetLocalAudioStats),e.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(Je.GET_STATS,this.handleGetLocalAudioStats),n.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Je.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),n.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,e){e instanceof Og&&e.addListener(Je.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(n))}),e instanceof Wu&&e.addListener(Je.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(Je.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[e,t]=n;t.has(ze.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),t.has(ze.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(n,e){return n.map((t,i)=>{var r;let a,s,{track:o,type:c}=t;switch(c){case Ae.LocalAudioTrack:a=Ni.Audio,s={dtx:o instanceof yr&&o._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ae.LocalVideoTrack:a=ee(r=o._hints).call(r,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High,s=Zu(Zu({},Bo(o)),{},{codec:this.store.codec,svc_mode:$h()});break;case Ae.LocalVideoLowTrack:a=Ni.Low,s=Zu(Zu({},Bo(o)),{},{codec:this.store.codec,svc_mode:$h()})}return{stream_type:a,attributes:s,ssrcs:e[i]}})}createGatewayUnpublishMessage(n){return n.map(e=>{var t;let i,[r,{track:a,ssrcs:s,id:o}]=e;switch(r){case Ae.LocalVideoTrack:i=ee(t=a._hints).call(t,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High;break;case Ae.LocalAudioTrack:i=Ni.Audio;break;case Ae.LocalVideoLowTrack:i=Ni.Low}return{stream_type:i,ssrcs:s,mid:o}})}assignLocalTracks(n,e){n.forEach((t,i)=>{let{track:r,type:a}=t;this.localTrackMap.set(a,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(n){n.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(n){n.onConnectionStateChange=async e=>{if(I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Ue.PeerConnectionStateChange,e),e==="connecting"&&n instanceof wa&&!jr()&&B("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&n.extendCandidate()},B("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),n instanceof wa&&d0(n,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Tn.DISCONNECTED_OR_FAILED,fi(this,Ue.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let t=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));Te.reportApiInvoke(this.store.sessionId,{name:Jr.REPUB_AFTER_PC_CONNECTED,options:t.concat(i),tag:Gt.TRACER}).onSuccess(),this.republish()}if(B("NEW_ICE_RESTART")&&n instanceof wa&&!jr()&&!this._forceTurn){if(ee(Zh).call(Zh,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let t=r=>{DR(n)&&(I.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),fi(this,Ue.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ue.RequestRestartICE,r))},i=()=>{DR(n)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),I.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ue.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{tx(n,t,i)},800))}}else{if(e==="disconnected"&&n.iceConnectionState==="disconnected")return setTimeout(()=>{n.iceConnectionState==="disconnected"&&B("ICE_RESTART")&&fi(this,Ue.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ue.RequestRestartICE)},800),void setTimeout(()=>{n.peerConnectionState==="disconnected"&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ue.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ue.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},n.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Te.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Gt.TRACER}).onSuccess(),this.emit(Ue.IceConnectionStateChange,e)},n.onICETransportStateChange=e=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},n.onDTLSTransportStateChange=e=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},n.onDTLSTransportError=e=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},n.onFirstAudioDecoded=e=>{var t;let i=Array.from(Lo(t=this.remoteUserMap).call(t)).find(a=>a._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(js.FIRST_FRAME_DECODED),Te.firstRemoteFrame(this.store.sessionId,Hn.FIRST_AUDIO_DECODE,qt.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Ia.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=e=>{var t;let i=Array.from(Lo(t=this.remoteUserMap).call(t)).find(r=>r._audioSSRC===e);i&&Te.firstRemoteFrame(this.store.sessionId,Hn.FIRST_AUDIO_RECEIVED,qt.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Ia.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(e,t,i)=>{var r;let a=Array.from(Lo(r=this.remoteUserMap).call(r)).find(s=>s._videoSSRC===e);a&&this.store.firstVideoFrameDecoded(a.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,t,i)},n.onFirstVideoRender=e=>{var t;let i=Array.from(Lo(t=this.remoteUserMap).call(t)).find(r=>r._videoSSRC===e);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i))},n.onFirstVideoReceived=e=>{var t;let i=Array.from(Lo(t=this.remoteUserMap).call(t)).find(r=>r._videoSSRC===e);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),Te.firstRemoteFrame(this.store.sessionId,Hn.FIRST_VIDEO_RECEIVED,qt.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Ia.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},n.onSelectedLocalCandidateChanged=(e,t)=>{let i=e.candidateType==="relay",r=t.candidateType==="relay";t.candidateType!=="unknown"&&i===r||this.emit(Ue.ConnectionTypeChange,i),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Qh(t))," -> ").concat(JSON.stringify(Qh(e)),")"))},n.onSelectedRemoteCandidateChanged=(e,t)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Qh(t))," -> ").concat(JSON.stringify(Qh(e)),")"))},n.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},n.getLocalVideoStats=()=>{let e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return Zu(Zu({},e),t)},n.onICECandidateError=e=>{this._iceError=e}}resetConnection(n){n instanceof wa&&(function(e){R_.delete(e.id),d0(e)})(n),n.close(),this.emit(Ue.PeerConnectionStateChange,"closed"),(function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0})(n),this._isWaitPcToRePub=!1}filterTobeMutedTracks(n){let e=[];if(this.getAllTracks().indexOf(n)===-1)return e;let t=this.localTrackMap.get(Ae.LocalAudioTrack);if(n instanceof Ti&&t?.track instanceof Un)return t.track.isActive||e.push([Ae.LocalAudioTrack,t]),e;let i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return n===a});if(i&&(e.push(i),i[0]===Ae.LocalVideoTrack)){let r=this.localTrackMap.get(Ae.LocalVideoLowTrack);r&&e.push([Ae.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(n){let e=[],t=this.localTrackMap.get(Ae.LocalAudioTrack);if(n instanceof Ti&&t?.track instanceof Un)return t.track.isActive&&e.push([Ae.LocalAudioTrack,t]),e;let i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return n===a});if(i)if(i[0]===Ae.LocalVideoTrack){e.push(i);let r=this.localTrackMap.get(Ae.LocalVideoLowTrack);r&&e.push([Ae.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(n){return n.map(e=>{var t;let i,[r,{track:a,ssrcs:s,id:o}]=e;switch(r){case Ae.LocalAudioTrack:i=Ni.Audio;break;case Ae.LocalVideoTrack:i=ee(t=a._hints).call(t,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High;break;case Ae.LocalVideoLowTrack:i=Ni.Low}return{stream_type:i,ssrcs:s,mid:o}})}createUnmuteMessage(n){return n.map(e=>{var t;let i,[r,{track:a,ssrcs:s,id:o}]=e;switch(r){case Ae.LocalAudioTrack:i=Ni.Audio;break;case Ae.LocalVideoTrack:i=ee(t=a._hints).call(t,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High;break;case Ae.LocalVideoLowTrack:i=Ni.Low}return{stream_type:i,ssrcs:s,mid:o}})}filterTobeUnSubscribedTracks(n,e){let t=[],i=this.remoteUserMap.get(n);if(!i)return t;if(e){let r=i.get(e);if(!r)return t;t.push([n,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[a,s]=r;t.push([n,{kind:a,id:s}])});return t}filterTobeUnSubscribedDataChannels(n,e){let t=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(n))!==null&&r!==void 0&&r.has(i.id)&&t.push(i)}),t}createUnsubscribeMessage(n){let e=[];return n.forEach(t=>{let[i,{kind:r,id:a}]=t;switch(r){case ze.VIDEO:return void(i._videoSSRC&&e.push({stream_type:ze.VIDEO,ssrcId:i._videoSSRC}));case ze.AUDIO:return void(i._audioSSRC&&e.push({stream_type:ze.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(n){let e=new Map;return n.forEach(t=>{let[i,{kind:r}]=t;if(e.has(i)){let a=e.get(i);r===ze.VIDEO?a|=Dn.Video:a|=Dn.Audio,e.set(i,a)}else r===ze.VIDEO?e.set(i,Dn.Video):e.set(i,Dn.Audio)}),{users:Array.from(e.entries()).map(t=>{let[i,r]=t;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(n){n.forEach(e=>{let[t,{kind:i}]=e,r=this.remoteUserMap.get(t);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(n){let e=this.localTrackMap.get(Ae.LocalVideoTrack),t=this.localTrackMap.get(Ae.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(n.uplink),await new se((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),t&&n.low_stream_uplink&&(await t.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}),await new se((i,r)=>{this.handleUpdateVideoEncoder(t.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof wa&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof wa&&this.connection.isPreSub()}mapPubResToRemoteConfig(n,e,t){return n.map((i,r)=>{var a;let{stream_type:s}=i,o=(a=e.find(c=>{let{stream_type:d}=c;return s===d}))===null||a===void 0?void 0:a.attributes;if(o&&B("DISABLE_SCREEN_SHARE_REMB")){let c=t[r]._hints;(ee(c).call(c,Oe.SCREEN_TRACK)||ee(c).call(c,Oe.SCREEN_LOW_TRACK))&&(o.remb=!1,I.debug("disable remb for screen share, hints:",c))}return o})}async tryToUnmuteAudio(n){for(let t=0;t<n.length;t++)if(n[t]instanceof Ti){var e;let i=this.filterTobeUnmutedTracks(n[t]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(a=>{let[,{id:s}]=a;return s})));let r=this.createUnmuteMessage(i);return void await zt(this,Ue.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,e)=>this.emit(Ue.RequestUpload,n,e),this.statsUploader.requestUploadStats=n=>this.emit(Ue.RequestUploadStats,n),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var n;return{connectState:((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await va(ln(this.dtlsFailedCount,Yr)),this.emit(Ue.RequestReconnect)}async reconnectP2P(){let n=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(n);Array.from(this.remoteUserMap.entries()),e.length>0&&await kn(this,Ue.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(Ue.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ae.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof Ai)}throwIfTrackTypeNotMatch(n){if(n.filter(e=>e instanceof Ai).length>1)throw new L(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(e=>e instanceof Ti).length>1&&(n.some(e=>e instanceof Ti&&e._bypassWebAudio)||!Nt().webAudioMediaStreamDest))throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let e of n){if(e instanceof Ai&&this.pendingLocalTracks.some(t=>t instanceof Ai))throw new L(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Ti&&this.pendingLocalTracks.some(t=>t instanceof Ti)&&(!Nt().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(t=>t instanceof Ti&&t._bypassWebAudio)))throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,e){var t;let i=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nt().supportDualStreamEncoding,r=Zu(Zu({},{width:160,height:120,framerate:15,bitrate:50}),e),a;a=i?n._mediaStreamTrack.clone():Is(n,r);let s=Ht(8,"track-low-"),o=new Ai(a,Zu(Zu({},i&&{scaleResolutionDownBy:YO(r,n)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(Ag.TRANSCEIVER_UPDATED,c=>{n._updateRtpTransceiver(c,Ui.LOW_STREAM)}),o._hints.push(Oe.LOW_STREAM),ee(t=n._hints).call(t,Oe.SCREEN_TRACK)&&o._hints.push(Oe.SCREEN_LOW_TRACK),n.on("sei-to-send",c=>{o.emit("sei-to-send",c)}),n.addListener(Je.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(n,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof wa){var r,a,s,o;let c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:d,dtlsTransportState:l,peerConnectionState:h}=this.connection,{local:_,remote:f}=await this.connection.getSelectedCandidatePair();Te.pcStats(this.store.sessionId,{startTime:c,eventElapse:n-c||0,iceconnectionsate:d,dtlsstate:l,connectionstate:h,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=_?.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(a=_.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(_.address,":").concat(_.port),selectedRemoteCandidateProtocol:(s=f.protocol)!==null&&s!==void 0?s:"",selectedRemoteCandidateType:(o=f.candidateType)!==null&&o!==void 0?o:"",selectedRemoteCandidateAddress:"".concat(f.address,":").concat(f.port),restartCnt:t,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(n){let e=this.store.keyMetrics,t=e.firstVideoFrameDecoded.find(l=>l.userId===n.uid);if(!t)return;let{isInternalUpload:i,isExternalUpload:r}=t;if(i&&r)return;let{subscribeEnd:a,firstPreRender:s,peerPublishDuration:o,peerPubStatusMs:c}=t,{firstRender:d=0}=t;if(a&&(d||s)&&o&&c){t.isInternalUpload=!0;let{playEnd:l}=t;l&&(t.isExternalUpload=!0);let{firstPreRender:h=0}=t;d=h||d;let _=n.videoTrack,f={peer:n._uintid,width:_?._videoWidth||0,height:_?._videoHeight||0,ssrc:n._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:o,peerPubStatusMs:c,joinChannelStart:e.joinStart||0,preloadStart:e.preloadStart||0,preloadEnd:e.preloadEnd||0,apStart:e.requestAPStart||0,apEnd:e.requestAPEnd||0,suaEnd:e.requestSUAEnd||0,beforeConnect:e.beforeConnect||0,peerReceiver:e.peerReceiver||0,ice:e.iceConnectionEnd||0,pc:e.peerConnectionEnd||0,signalConnected:e.signalConnected||0,joinReq:e.joinReq||0,joinRes:e.joinRep||0,userJoinNotify:t.userJoinNotify||0,videoAddNotify:t.videoAddNotify||0,subscribeStart:t.subscribeStart||0,subscribeEnd:t.subscribeEnd||0,firstReceived:t.firstReceived||0,firstDecoded:t.firstDecoded||0,firstPreRender:h||0,firstRender:l?Math.max(d,l):Math.max(d,a),playStart:t.playStart||0,playEnd:t.playEnd||0,isPreSub:!(!n._videoSSRC||!this.isPreSubScribe(n._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:TO(this.store)};Te.firstXLAPeerFirstVideoFrame(this.store.sessionId,f)}}reportVideoFirstFrameDecoded(n,e,t,i){var r;let a=Array.from(Lo(r=this.remoteUserMap).call(r)).find(s=>s._videoSSRC===n);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());let s=this.store.keyMetrics,o=s.subscribe.find(c=>c.userId===a.uid&&c.type==="video");Te.firstRemoteVideoDecode(this.store.sessionId,Hn.FIRST_VIDEO_DECODE,qt.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:t,subscribeElapse:Ia.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:o?.subscribeEnd||0,subscriberStart:o?.subscribeStart||0,videoAddNotify:o?.streamAdded||0,state:i?1:0,firstFrame:o?.firstFrame||0})}}async remoteMediaSsrcChanged(n,e,t){if(!this.connection)return!1;let i=this.remoteUserMap.get(n);if(!i)return!1;let r=i.get(e);if(!r)return!1;let a=await this.connection.getRemoteSSRC(r);return a!==void 0&&a!==t}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[e,{track:t}]=n;e===Ae.LocalVideoLowTrack?t._updateRtpTransceiver(void 0,Ui.LOW_STREAM):t._updateRtpTransceiver(void 0)})}},$e(ei.prototype,"startP2PConnection",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"startP2PConnection"),ei.prototype),$e(ei.prototype,"connect",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"connect"),ei.prototype),$e(ei.prototype,"updateRemoteRTPCapabilities",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"updateRemoteRTPCapabilities"),ei.prototype),$e(ei.prototype,"publishDataChannel",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"publishDataChannel"),ei.prototype),$e(ei.prototype,"unpublish",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"unpublish"),ei.prototype),$e(ei.prototype,"unpublishDataChannel",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"unpublishDataChannel"),ei.prototype),$e(ei.prototype,"unpublishLowStream",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"unpublishLowStream"),ei.prototype),$e(ei.prototype,"subscribeDataChannel",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"subscribeDataChannel"),ei.prototype),$e(ei.prototype,"subscribe",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"subscribe"),ei.prototype),$e(ei.prototype,"massSubscribe",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"massSubscribe"),ei.prototype),$e(ei.prototype,"unsubscribe",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"unsubscribe"),ei.prototype),$e(ei.prototype,"unsubscribeDataChannel",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"unsubscribeDataChannel"),ei.prototype),$e(ei.prototype,"massUnsubscribe",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"massUnsubscribe"),ei.prototype),$e(ei.prototype,"muteRemote",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"muteRemote"),ei.prototype),$e(ei.prototype,"unmuteRemote",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"unmuteRemote"),ei.prototype),$e(ei.prototype,"hasRemoteMediaWithLock",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"hasRemoteMediaWithLock"),ei.prototype),$e(ei.prototype,"disconnectForReconnect",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"disconnectForReconnect"),ei.prototype),$e(ei.prototype,"updateBitrateLimit",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"updateBitrateLimit"),ei.prototype),$e(ei.prototype,"remoteMediaSsrcChanged",[Oa],Object.getOwnPropertyDescriptor(ei.prototype,"remoteMediaSsrcChanged"),ei.prototype),ei);function Oa(n,e,t){let i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){let r=this.mutex,a=await r.lock("From P2PChannel.".concat(e));try{for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return await i.apply(this,o)}finally{a()}},t}function hs(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function ix(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?hs(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):hs(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let oj=Date.now(),IH=20,rx=new Map,PR=new Map;async function Zb(n){let e=rx.get(n),t=Array.isArray(e)&&e[e.length-1],i=PR.get(n);if(!t)return void(i.isSyncing=!1);let r={uid:t.uid,payload:t.payload};i.firstRecvTs===0&&(i.firstRecvTs=t.recvTs,i.firstSendTs=t.sendTs);let a=t.sendTs-i.firstSendTs,s=a-(Date.now()-i.firstRecvTs);s>0&&(i.firstRecvTs=Date.now()-a);let o=t.mediaDelay+s;o<=0?(e.pop(),nx(t.context,r),o=0):o=Math.min(o,IH),setTimeout(()=>e.length&&Zb(n),o)}function nx(n,e){n.safeEmit(ri.STREAM_MESSAGE,e.uid,e.payload),n.onStreamMessage&&n.onStreamMessage(e)}function cj(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return nx(t,{uid:n.uid,payload:n.payload});let i="".concat(t.id,"-").concat(n.uid),r=rx.get(i)||[],a=r.findIndex(d=>n.sendTs>=d.sendTs),s=ix(ix({},n),{},{context:t,mediaDelay:e,recvTs:Date.now()});a===-1?r.push(s):r.splice(a,0,s),rx.set(i,r);let o=!1;var c;PR.has(i)?o=!((c=PR.get(i))===null||c===void 0||!c.isSyncing):PR.set(i,{isSyncing:o,firstRecvTs:0,firstSendTs:0}),o||Zb(i)}let wH=pi().name;function dj(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function ax(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dj(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):dj(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let Ug="websdk_ng_cache_parameter",LR=B("MAX_PRELOAD_ASYNC_LENGTH"),OH=1e4,xg=new Map,Ud=[],v_=null,Qb=0,$b=0,kR=new Map,l0=(function(n,e){let t=[],i=0,r=async()=>{let a=t.shift();a&&await a(),t.length>0&&i<e?r():i--};return async function(){for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return new se(async(c,d)=>{t.push(async()=>{try{let l=await n(...s);c(l)}catch(l){d(l)}}),i<e&&(i++,r())})}})(u0,LR),sx=mr.CancelToken.source();async function u0(n,e,t,i,r,a){try{if(!B("ENABLE_PRELOAD"))return;if(!Nt().supportWebCrypto)return void r_(()=>{I.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!t&&t!==null)throw new L(M.INVALID_PARAMS,"Invalid token: ".concat(t,". If you don not use token, set it to null"));t&&Zn(t,"token",1,2047),Zn(n,"appid",1,2047),Pt(e),i&&Dg(i);let s=Mi();I.debug("preload channel ".concat(e,", uid is ").concat(i));let o={appId:n,cname:e,token:t||n,uid:typeof i!="string"?i:null,sid:s,proxyServer:r},c,d;typeof i=="string"?(o.stringUid=i,[d,c]=await se.all([ej(i,{sid:s,appId:n},sx.token),tj(ax(ax({},o),{},{token:t||n,uid:0}),sx.token)]),o.uid=d.uid,c.gatewayInfo.uid=o.uid,c.gatewayInfo.res.uid=o.uid):(a&&(o.stringUid=a),c=await tj(o,sx.token));let l={sid:s,appId:n,cname:e,token:t||n,uid:o.stringUid||i,intUid:o.uid||c.gatewayInfo.uid,stringUid:o.stringUid,ts:Date.now(),sua:d,ap:c};await(async function(h){let _;try{h.uid&&cx({appId:h.appId,cname:h.cname,token:h.token,uid:h.uid,stringUid:h.stringUid});let f=tA(h),m=await(async function(T,R){try{let C=await window.crypto.subtle.importKey("raw",n_(R),"AES-GCM",!1,["encrypt"]),b=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},C,Uc(window.btoa(JSON.stringify(T))));return xc(new Uint8Array(b))}catch{return}})(h,h.token||h.appId);if(!m)return;_=lx(Ug);let S=_?JSON.parse(_):[];S.push({[f]:m}),S.length>B("AP_CACHE_NUM")&&S.shift(),eA(Ug,JSON.stringify(S))}catch(f){I.warn("Error caching server parameters:",f.message),eA(Ug,"")}})(l),Qb++}catch(s){throw $b++,(function(o){v_||(v_=window.setTimeout(()=>{let d="";kR.forEach((l,h)=>{d+="".concat(h,": ").concat(l," ;")}),Te.reportApiInvoke(null,{name:Jr.PRELOAD,options:{success:Qb,failed:$b,err:d}}).onError(o),Qb=0,$b=0,kR.clear(),v_=null},OH));let c=kR.get(o.code)||0;kR.set(o.code,c+1)})(s),s}}async function ox(n){try{if(B("AP_REQUEST_DETAIL")||B("ENABLE_ROLE_SELECT_EDGE"))return;let e=cx(n);if(!e||n.cloudProxyServer!=="disabled")return;let t=await(async function(i,r){try{let a=await window.crypto.subtle.importKey("raw",n_(r),"AES-GCM",!1,["decrypt"]),s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},a,Uc(i));return JSON.parse(window.atob(xc(new Uint8Array(s))))}catch{return}})(e,n.token||n.appId);if(!t||!(function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1})(t,n))return;if(t&&Date.now()-t.ts<B("AP_CACHE_LIFETIME"))return t}catch(e){I.warn("Error get preloadInfo",e.message)}}function cx(n){let e;try{if(e=lx(Ug),!e)return;let t=JSON.parse(e),i=tA(n),r=(function(s,o){for(let c=s.length-1;c>=0;c--)if(o(s[c]))return c;return-1})(t,s=>i in s);if(r===-1)return;let a=t.splice(r,1)[0];return eA(Ug,JSON.stringify(t)),a[i]}catch(t){I.warn("Error delete preload info: ".concat(e),t.message),eA(Ug,"")}}function h0(n){if(n){let e=xg.get(n);e&&(window.clearTimeout(e),e=null,xg.delete(n)),ee(Ud).call(Ud,n)||n.cloudProxyServer!=="disabled"||Ud.push(n)}if(xg.size<B("AP_CACHE_NUM")&&Ud.length>0){let e=Ud.shift();xg.set(e,window.setTimeout(async()=>{let{appId:t,cname:i,token:r,stringUid:a,uid:s,proxyServer:o}=e;try{await l0(t,i,r,s,o,a),xg.has(e)&&h0(e)}catch(c){I.warn("update preload failed",c.message),p0(e)}},B("AP_UPDATE_INTERVAL")))}}function p0(n){let e=Ud.indexOf(n);e!==-1&&Ud.splice(e,1);let t=xg.get(n);t&&(window.clearTimeout(t),t=null,xg.delete(n),h0())}function dx(n,e){let t=n.sua,i=n.ap;e&&t&&Te.reqUserAccount(n.sid,{lts:t.requestTime,elapse:t.elapse,success:!0,serverAddr:t.url,stringUid:e,uid:n.intUid,errorCode:null,extend:t.req}),Te.reportResourceTiming(n.ap.url,n.sid),Te.joinWebProxyAP(n.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[Rn.CHOOSE_SERVER,Rn.CLOUD_PROXY_FALLBACK].toString()}),Te.joinChooseServer(n.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Rn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function lx(n){return window.atob(window.localStorage.getItem(n)||"")}function eA(n,e){window.localStorage.setItem(n,window.btoa(e))}function tA(n){let e="".concat(n.appId,"_").concat(n.cname);return typeof n.uid=="string"&&(e+="_s_".concat(n.uid)),typeof n.uid=="number"&&(e+="_".concat(n.uid)),n.token&&(e+="_".concat(n.token)),_O(e)}function lj(n){let e=(function(){let t=UR.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(t,i){let r=t.appId;r!==void 0&&(qr(i,10),y_(i,r));let a=t.cid;a!==void 0&&(qr(i,16),qr(i,a));let s=t.cname;s!==void 0&&(qr(i,26),y_(i,s));let o=t.deviceId;o!==void 0&&(qr(i,34),y_(i,o));let c=t.elapse;c!==void 0&&(qr(i,40),mE(i,c));let d=t.fileSize;d!==void 0&&(qr(i,48),mE(i,MR(d)));let l=t.height;l!==void 0&&(qr(i,56),mE(i,MR(l)));let h=t.jpg;h!==void 0&&(qr(i,66),qr(i,h.length),px(i,h));let _=t.networkType;_!==void 0&&(qr(i,72),mE(i,MR(_)));let f=t.osType;f!==void 0&&(qr(i,80),mE(i,MR(f)));let m=t.requestId;m!==void 0&&(qr(i,90),y_(i,m));let S=t.sdkVersion;S!==void 0&&(qr(i,98),y_(i,S));let T=t.sequence;T!==void 0&&(qr(i,104),mE(i,MR(T)));let R=t.sid;R!==void 0&&(qr(i,114),y_(i,R));let C=t.timestamp;C!==void 0&&(qr(i,120),mE(i,C));let b=t.uid;b!==void 0&&(qr(i,128),qr(i,b));let N=t.vid;N!==void 0&&(qr(i,136),qr(i,N));let k=t.width;k!==void 0&&(qr(i,144),mE(i,MR(k)));let P=t.service;P!==void 0&&(qr(i,152),qr(i,P));let U=t.callbackData;U!==void 0&&(qr(i,162),qr(i,U.length),px(i,U));let W=t.ticket;W!==void 0&&(qr(i,170),y_(i,W));let z=t.vendorConfigs;z!==void 0&&(qr(i,178),y_(i,z))})(n,e),(function(t){let i=t.bytes,r=t.limit;return i.length===r?i:i.subarray(0,r)})(e)}function NH(n){return(function(t){let i={};e:for(;!hx(t);){let r=xR(t);switch(r>>>3){case 0:break e;case 1:i.code=xR(t);break;case 2:i.msg=_x(t,xR(t));break;case 3:i.requestId=_x(t,xR(t));break;case 4:i.timestamp=yn(t,!1);break;default:DH(t,7&r)}}return i})({bytes:e=n,offset:0,limit:e.length});var e}function DH(n,e){switch(e){case 0:for(;128&ws(n););break;case 2:ux(n,xR(n));break;case 5:ux(n,4);break;case 1:ux(n,8);break;default:throw new Error("Unimplemented type: "+e)}}function MR(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let UR=[];function ux(n,e){if(n.offset+e>n.limit)throw new Error("Skip past limit");n.offset+=e}function hx(n){return n.offset>=n.limit}function _0(n,e){let t=n.bytes,i=n.offset,r=n.limit,a=i+e;if(a>t.length){let s=new Uint8Array(2*a);s.set(t),n.bytes=s}return n.offset=a,a>r&&(n.limit=a),i}function iA(n,e){let t=n.offset;if(t+e>n.limit)throw new Error("Read past limit");return n.offset+=e,t}function px(n,e){let t=_0(n,e.length);n.bytes.set(e,t)}function _x(n,e){let t=iA(n,e),i=String.fromCharCode,r=n.bytes,a="�",s="";for(let o=0;o<e;o++){let c,d,l,h,_=r[o+t];128&_?(224&_)==192?o+1>=e?s+=a:(c=r[o+t+1],(192&c)!=128?s+=a:(h=(31&_)<<6|63&c,h<128?s+=a:(s+=i(h),o++))):(240&_)==224?o+2>=e?s+=a:(c=r[o+t+1],d=r[o+t+2],(49344&(c|d<<8))!=32896?s+=a:(h=(15&_)<<12|(63&c)<<6|63&d,h<2048||h>=55296&&h<=57343?s+=a:(s+=i(h),o+=2))):(248&_)==240?o+3>=e?s+=a:(c=r[o+t+1],d=r[o+t+2],l=r[o+t+3],(12632256&(c|d<<8|l<<16))!=8421504?s+=a:(h=(7&_)<<18|(63&c)<<12|(63&d)<<6|63&l,h<65536||h>1114111?s+=a:(h-=65536,s+=i(55296+(h>>10),56320+(1023&h)),o+=3))):s+=a:s+=i(_)}return s}function y_(n,e){let t=e.length,i=0;for(let s=0;s<t;s++){let o=e.charCodeAt(s);o>=55296&&o<=56319&&s+1<t&&(o=(o<<10)+e.charCodeAt(++s)-56613888),i+=o<128?1:o<2048?2:o<65536?3:4}qr(n,i);let r=_0(n,i),a=n.bytes;for(let s=0;s<t;s++){let o=e.charCodeAt(s);o>=55296&&o<=56319&&s+1<t&&(o=(o<<10)+e.charCodeAt(++s)-56613888),o<128?a[r++]=o:(o<2048?a[r++]=o>>6&31|192:(o<65536?a[r++]=o>>12&15|224:(a[r++]=o>>18&7|240,a[r++]=o>>12&63|128),a[r++]=o>>6&63|128),a[r++]=63&o|128)}}function ws(n){return n.bytes[iA(n,1)]}function xd(n,e){let t=_0(n,1);n.bytes[t]=e}function xR(n){let e,t=0,i=0;do e=ws(n),t<32&&(i|=(127&e)<<t),t+=7;while(128&e);return i}function qr(n,e){for(e>>>=0;e>=128;)xd(n,127&e|128),e>>>=7;xd(n,e)}function yn(n,e){let t,i=0,r=0,a=0;return t=ws(n),i=127&t,128&t&&(t=ws(n),i|=(127&t)<<7,128&t&&(t=ws(n),i|=(127&t)<<14,128&t&&(t=ws(n),i|=(127&t)<<21,128&t&&(t=ws(n),r=127&t,128&t&&(t=ws(n),r|=(127&t)<<7,128&t&&(t=ws(n),r|=(127&t)<<14,128&t&&(t=ws(n),r|=(127&t)<<21,128&t&&(t=ws(n),a=127&t,128&t&&(t=ws(n),a|=(127&t)<<7))))))))),{low:i|r<<28,high:r>>>4|a<<24,unsigned:e}}function mE(n,e){let t=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,a=r===0?i===0?t<16384?t<128?1:2:t<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,s=_0(n,a),o=n.bytes;switch(a){case 10:o[s+9]=r>>>7&1;case 9:o[s+8]=a!==9?128|r:127&r;case 8:o[s+7]=a!==8?i>>>21|128:i>>>21&127;case 7:o[s+6]=a!==7?i>>>14|128:i>>>14&127;case 6:o[s+5]=a!==6?i>>>7|128:i>>>7&127;case 5:o[s+4]=a!==5?128|i:127&i;case 4:o[s+3]=a!==4?t>>>21|128:t>>>21&127;case 3:o[s+2]=a!==3?t>>>14|128:t>>>14&127;case 2:o[s+1]=a!==2?t>>>7|128:t>>>7&127;case 1:o[s]=a!==1?128|t:127&t}}let C_={},fx={},rA=4294967296,f0=rA*rA,PH=f0/2;hj(0,!0);let Ex=hj(0),uj=VR(0,-2147483648,!1),LH=VR(-1,2147483647,!1);function hj(n,e){let t,i,r;return e?(r=0<=(n>>>=0)&&n<256)&&(i=fx[n],i)?i:(t=VR(n,0,!0),r&&(fx[n]=t),t):(r=-128<=(n|=0)&&n<128)&&(i=C_[n],i)?i:(t=VR(n,n<0?-1:0,!1),r&&(C_[n]=t),t)}function VR(n,e,t){return{low:0|n,high:0|e,unsigned:!!t}}function FR(n,e){if(isNaN(n))return Ex;{if(n<=-9223372036854776e3)return uj;if(n+1>=PH)return LH}return n<0?Ex:VR(n%rA|0,n/rA|0,e)}function mx(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}class E0 extends Sr{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(Aa.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),F(this,"name","AgoraRTCImageModeration"),F(this,"_connectionState",Fa.CONNECTING),F(this,"_sequence",0),F(this,"_moderationStartTime",void 0),F(this,"_workerConnection",void 0),F(this,"_workerMessageLengthLimit",void 0),F(this,"_qualityRatio",void 0),F(this,"_connectInfo",void 0),F(this,"_cancelTokenSource",mr.CancelToken.source()),F(this,"_retryConfig",void 0),F(this,"_moderationInterval",void 0),F(this,"_moderationTimer",null),F(this,"_moderationMode",1),F(this,"_quality",1),F(this,"_qualityTimer",null),F(this,"_ticket",void 0),F(this,"_moderationIntervalMinimum",void 0),F(this,"_uploadFailedNum",0),F(this,"_uploadNum",0),F(this,"_uploadTimer",null),F(this,"_extraInfo",void 0),F(this,"_vendor",""),F(this,"_encoder",new TextEncoder),F(this,"_moderationId",void 0),F(this,"inspectImage",()=>{if(this.connectionState!==Fa.CONNECTED)throw new J(M.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Fa.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ht(5,"image-moderation-"),this._workerMessageLengthLimit=B("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=B("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(t=e.interval)!==null&&t!==void 0?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=B("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Pg("worker-"+this._moderationId,Yr),this.on(Aa.STATE_CHANGE,(i,r)=>{I.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Fo[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(Aa.STATE_CHANGE,Fo.CONNECT_AP),this._connectInfo=e;let i=this._cancelTokenSource.token;return this._retryConfig=t,new se((r,a)=>{this.on(Aa.CONNECTION_STATE_CHANGE,(s,o)=>{s===Fa.CONNECTED&&r()}),this.requestAP(e,i,t).then(s=>{this.connectWorker(s)}).catch(s=>{a(s)})})}updateConfig(e){var t;this._moderationInterval=(t=e.interval)!==null&&t!==void 0?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),I.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Fa.CONNECTED&&this.inspectImage()}async requestAP(e,t,i){let r=B("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),a=await(function(c,d,l,h){let{appId:_,areaCode:f,cname:m,sid:S,token:T,uid:R}=d;CR++;let C="moderation_plugin",b={service_name:C,json_body:JSON.stringify({appId:_,areaCode:f,cname:m,command:"allocateEdge",requestId:CR,seq:CR,sid:S,appToken:T,ts:Date.now(),uid:R+""})},N,k,P=c[0];return Od(async()=>{N=Date.now();let U=await kd(P,{data:b,cancelToken:l,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(k=Date.now()-N,U.code!==0){let Q=new J(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+U.code,{retry:!0,responseTime:k});throw I.error(Q.toString()),Q}let W=JSON.parse(U.json_body);if(W.code!==200){let Q=new J(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(W.code,", reason: ").concat(W.reason),{code:W.code,responseTime:k});throw I.error(Q.toString()),Q}if(!W.servers||!Array.isArray(W.servers)||W.servers.length===0){let Q=new J(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:W.code,responseTime:k});throw I.error(Q.toString()),Q}if(!W.servers.some(Q=>!!Q.wss)){let Q=new J(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:W.code,responseTime:k});throw I.error(Q.toString()),Q}let z=B("IMAGE_MODERATION_WORKER_HOST");return{addressList:W.servers.map(Q=>{let{address:he,wss:Ge}=Q;if(he&&Ge)return"wss://".concat(he.replace(/\./g,"-"),".").concat(z,":").concat(Ge,"/moderation")}).filter(Q=>!!Q),workerToken:W.workerToken,vid:W.vid,ticket:W.appTicket,responseTime:k}},(U,W)=>(Te.apworkerEvent(S,{success:!0,sc:200,serviceName:C,responseDetail:JSON.stringify(U.addressList),firstSuccess:W===0,responseTime:k,serverIp:c[W%c.length]}),!1),(U,W)=>(Te.apworkerEvent(S,{success:!1,sc:U.data&&U.data.code||200,serviceName:C,responseTime:k,serverIp:c[W%c.length]}),!!(U.code!==M.OPERATION_ABORTED&&U.code!==M.UNEXPECTED_RESPONSE||U.data&&U.data.retry)&&(P=c[(W+1)%c.length],!0)),h)})(r,e,t,i);this.emit(Aa.STATE_CHANGE,Fo.AP_CONNECTED);let{addressList:s,ticket:o}=a;return this._ticket=o,s}async connectWorker(e){this.emit(Aa.STATE_CHANGE,Fo.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(_t.CONNECTED,async()=>{this.emit(Aa.STATE_CHANGE,Fo.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Fa.CONNECTED}),this._workerConnection.on(_t.CLOSED,()=>{this.connectionState=Fa.CLOSED}),this._workerConnection.on(_t.FAILED,()=>{this.connectionState=Fa.CLOSED}),this._workerConnection.on(_t.RECONNECTING,()=>{this.connectionState=this.connectionState===Fa.CONNECTED?Fa.RECONNECTING:Fa.CONNECTING}),this._workerConnection.on(_t.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let t=NH(new Uint8Array(e.data));B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,t.code===void 0||t.code===0||(this._uploadFailedNum++,I.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Te.reportApiInvoke(this._connectInfo.sid||null,{name:Jr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:Gt.TRACER}).onError(new J(M.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},B("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else I.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(_t.WILL_RECONNECT,(e,t,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(_t.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){let e=fi(this,Aa.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being played can be inspected"));this._sequence++;let i=await this.generateRequestData(e,t);this._workerConnection.sendMessage(i,!0,!0)}else B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:i,cname:r,cid:a,vid:s,sid:o,uid:c}=t,d=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),h=await kB(l,i,r),_=this._sequence+"-"+a+"-"+c+"-"+d+"-"+Ht(12,""),f={appId:i,cid:a,cname:r,deviceId:"",elapse:E0.intToLong(Number(d-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:h,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.0",sequence:this._sequence,sid:o,timestamp:FR(d),uid:c,vid:s,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete f.callbackData;let m=lj(f);if(m.byteLength<this._workerMessageLengthLimit){if(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let S=(function(T){for(var R=1;R<arguments.length;R++){var C=arguments[R]!=null?arguments[R]:{};R%2?mx(Object(C),!0).forEach(function(b){F(T,b,C[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(C)):mx(Object(C)).forEach(function(b){Object.defineProperty(T,b,Object.getOwnPropertyDescriptor(C,b))})}return T})({},f);delete S.jpg,I.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(S))}return m}{let S=this.quality*this._qualityRatio;return this.quality=S,await this.generateRequestData(e,{appId:i,cname:r,cid:a,vid:s,sid:o,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Fa.CLOSED,this.emit(Aa.STATE_CHANGE,Fo.CLOSED)}}function m0(n){if(Bt(n.interval,"interval",1e3,1/0),n&&n.extraInfo&&n.extraInfo.length>1024)throw new J(M.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(n&&n.vendor&&n.vendor.length>1024)throw new J(M.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let pj={name:"ImageModeration",create:function(n){let{config:e}=n;return m0(e),new E0(e)}};var _j,gx,Sx,Tx,Rx,vx,yx,Cx,bx,Ax,Ix,wx,Ox,Nx,Dx,Px,Lx,kx,Mx,Ux,xx,Vx,Fx,Bx,jx,Gx,Wx,Hx,Kx,Yx,zx,qx,Xx,Jx,Zx,Qx,$x,eV,tV,iV,rV,Ke;function Ye(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Vd(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ye(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ye(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}xa.setLogger(I);let Nl=(_j=pt(),gx=pt({argsMap:(n,e)=>{if(!Array.isArray(e)){if(!(e instanceof Ig))return[e];e=[e]}return e.map(t=>t?Object(t).toString():"null")}}),Sx=pt({argsMap:(n,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Gs.DATA?(Array.isArray(e)||(e=[e]),e.map(t=>t.getTrackId())):[e.getChannelId()])}),Tx=pt({argsMap:(n,e,t,i)=>[typeof e=="object"?e.uid:e,t,i]}),Rx=pt({argsMap:(n,e,t)=>[e,t]}),vx=pt({argsMap:(n,e)=>e.map(t=>{let{user:i,mediaType:r}=t;return[i?.uid,r]})}),yx=pt({argsMap:(n,e,t,i)=>[typeof e=="object"?e.uid:e,t,i]}),Cx=pt({argsMap:(n,e)=>e.map(t=>{let{user:i,mediaType:r}=t;return{uid:i?.uid,mediaType:r}})}),bx=pt(),Ax=pt(),Ix=pt(),wx=pt(),Ox=pt(),Nx=pt(),Dx=pt(),Px=pt(),Lx=pt(),kx=pt(),Mx=pt(),Ux=pt(),xx=pt(),Vx=pt(),Fx=pt(),Bx=pt({argsMap:(n,e)=>[e]}),jx=pt(),Gx=pt(),Wx=pt(),Hx=pt(),Kx=pt(),Yx=pt(),zx=pt(),qx=pt(),Xx=pt({argsMap:(n,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),Jx=pt(),Zx=pt(),Qx=pt(),$x=pt(),eV=pt(),tV=pt(),iV=pt({reportResult:!0}),rV=pt(),Ke=class extends Sr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var n;return((n=this._config)===null||n===void 0?void 0:n.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(n,e){let t;if(super(),F(this,"store",void 0),F(this,"_uid",void 0),F(this,"_channelName",void 0),F(this,"_uintUid",void 0),F(this,"_users",[]),F(this,"_config",void 0),F(this,"_clientId",void 0),F(this,"_appId",void 0),F(this,"_sessionId",null),F(this,"_key",void 0),F(this,"_rtmConfig",{}),F(this,"_joinInfo",void 0),F(this,"_gateway",void 0),F(this,"_statsCollector",void 0),F(this,"_configDistribute",void 0),F(this,"_leaveMutex",void 0),F(this,"_publishMutex",void 0),F(this,"_renewTokenMutex",void 0),F(this,"_subscribeMutex",void 0),F(this,"_encryptionMode","none"),F(this,"_encryptionSecret",null),F(this,"_encryptionSalt",null),F(this,"_encryptDataStream",!1),F(this,"_encryptDataStreamKey",null),F(this,"_encryptDataStreamIv",null),F(this,"_proxyServer",void 0),F(this,"_turnServer",{servers:[],mode:"auto"}),F(this,"_cloudProxyServerMode","disabled"),F(this,"_isDualStreamEnabled",!1),F(this,"_defaultStreamFallbackType",void 0),F(this,"_lowStreamParameter",void 0),F(this,"_streamFallbackTypeCacheMap",new Map),F(this,"_remoteStreamTypeCacheMap",new Map),F(this,"_axiosCancelSource",mr.CancelToken.source()),F(this,"_audioVolumeIndicationInterval",void 0),F(this,"_networkQualityInterval",void 0),F(this,"_userOfflineTimeout",void 0),F(this,"_streamRemovedTimeout",void 0),F(this,"_liveTranscodeStreamingClient",void 0),F(this,"_liveRawStreamingClient",void 0),F(this,"_channelMediaRelayClient",void 0),F(this,"_networkQualitySensitivity","normal"),F(this,"_p2pChannel",void 0),F(this,"_useLocalAccessPoint",!1),F(this,"_setLocalAPVersion",void 0),F(this,"_joinAndNotLeaveYet",!1),F(this,"_numberOfJoinCount",0),F(this,"_joinResponse",null),F(this,"_remoteDefaultVideoStreamType",void 0),F(this,"_inspect",void 0),F(this,"_moderation",void 0),F(this,"_license",void 0),F(this,"_pendingPublishedUsers",[]),F(this,"ntpAlignErrorCount",0),F(this,"remoteInboundOffset",0),F(this,"_peerConnectionState",void 0),F(this,"_handleLocalTrackEnable",(r,a,s)=>{this.publish(r,!1).then(a).catch(s)}),F(this,"_handleLocalTrackDisable",(r,a,s)=>{this.unpublish(r).then(a).catch(s)}),F(this,"_handleUserOnline",r=>{if(B("BLOCK_LOCAL_CLIENT")&&yl(r.uid,this.channelName))return void I.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&I.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let a=this._users.find(s=>s.uid===r.uid);if(a)a._trust_in_room_=!0,a._is_pre_created&&(a._is_pre_created=!1,this.safeEmit(ri.USER_JOINED,a));else{let s=new g_(r.uid,r.uint_id||r.uid);this._users.push(s),I.debug("[".concat(this._clientId,"] user online"),r.uid),this.store.firstVideoFrameDecoded(s.uid,{userJoinNotify:Date.now()}),this.safeEmit(ri.USER_JOINED,s)}}),F(this,"_handleUserOffline",r=>{if(B("BLOCK_LOCAL_CLIENT")&&yl(r.uid,this.channelName))return;let a=this._users.find(s=>s.uid===r.uid);a&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),a._audio_pre_subscribed||a._video_pre_subscribed?a._is_pre_created=!0:Zr(this._users,a),this._remoteStreamTypeCacheMap.delete(a.uid),this._streamFallbackTypeCacheMap.delete(a.uid),I.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(ri.USER_LEAVED,a,r.reason))}),F(this,"_handleAddAudioOrVideoStream",(r,a,s,o,c,d,l,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&yl(a,this.channelName))return;let _=this._users.find(m=>m.uid===a);if(!_)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(r)),this.store.subscribe(_.uid,r,void 0,void 0,void 0,Date.now()),r==="video"&&this.store.firstVideoFrameDecoded(_.uid,{videoAddNotify:Date.now()});let f=r==="audio"?_.hasAudio:_.hasVideo;if(_._uintid||(_._uintid=d||a),r==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,r==="audio"?(_._audio_added_=!0,s!==void 0&&(_._audioSSRC=s),o!==void 0&&(_._cname=o),l&&(_._audioOrtc=l)):(_._video_added_=!0,s!==void 0&&(_._videoSSRC=s),o!==void 0&&(_._cname=o),h!==void 0&&(_._rtxSsrcId=h),l&&(_._videoOrtc=l)),(r==="audio"?_.hasAudio:_.hasVideo)&&!f&&(I.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(r)),this.safeEmit(ri.USER_PUBLISHED,_,r)),r==="video"?Te.onGatewayStream(this._sessionId,Hn.ON_ADD_VIDEO_STREAM,qt.ON_ADD_VIDEO_STREAM,{peer:d||a,ssrc:_._videoSSRC}):Te.onGatewayStream(this._sessionId,Hn.ON_ADD_AUDIO_STREAM,qt.ON_ADD_AUDIO_STREAM,{peer:d||a,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,r,s).then(m=>{if(m&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof EE))return this._p2pChannel.unsubscribe(_,r,!0).then(()=>this._subscribe(_,r,!0).catch(S=>{I.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,r)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,r,!0).catch(m=>{I.error("[".concat(this._clientId,"] resubscribe error"),m.toString())})),r==="video"&&!dn()&&!Ci()){let m=this._getEncodingName(c);m?.toLocaleLowerCase()==bt.av1&&$B().then(S=>{S||this._gateway.downgradeCodec(m)})}}),F(this,"_handleRemoveStream",r=>{if(B("BLOCK_LOCAL_CLIENT")&&yl(r.uid,this.channelName))return;let a=this._users.find(o=>o.uid===r.uid);if(!a)return void I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));I.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let s=()=>{};a.hasAudio&&a.hasVideo?s=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(ri.USER_UNPUBLISHED,a,"audio"),I.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(ri.USER_UNPUBLISHED,a,"video")}:a.hasVideo?s=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(ri.USER_UNPUBLISHED,a,"video")}:a.hasAudio&&(s=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(ri.USER_UNPUBLISHED,a,"audio")}),a._video_pre_subscribed||a._audio_pre_subscribed||(a._trust_audio_stream_added_state_=!0,a._trust_video_stream_added_state_=!0,a._audio_added_=!1,a._video_added_=!1,this._p2pChannel instanceof EE&&this._p2pChannel.unsubscribe(a).then(o=>{if(o)return this._gateway.unsubscribe(o,a.uid)}),a._audioSSRC=void 0,a._videoSSRC=void 0,a._audioOrtc=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),Te.onGatewayStream(this._sessionId,Hn.ON_REMOVE_STREAM,qt.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),s()}),F(this,"_handleSetStreamLocalEnable",(r,a,s)=>{if(B("BLOCK_LOCAL_CLIENT")&&yl(a,this.channelName))return;let o=this._users.find(l=>l.uid===a);if(!o)return void I.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));I.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(s?"enabled":"disabled"," with uid ").concat(a));let c=r==="audio"?o.hasAudio:o.hasVideo;if(r==="audio"){o._trust_audio_enabled_state_=!0;let l=o._audio_enabled_;if(o._audio_enabled_=s,o._audio_enabled_===l)return;{let h=o._audio_enabled_?"enable-local-audio":"disable-local-audio";I.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(a,", msg: ").concat(h)),this.safeEmit(ri.USER_INFO_UPDATED,a,h)}}else{o._trust_video_enabled_state_=!0;let l=o._video_enabled_;if(o._video_enabled_=s,o._video_enabled_===l)return;{let h=o._video_enabled_?"enable-local-video":"disable-local-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(h)),this.safeEmit(ri.USER_INFO_UPDATED,a,h)}}let d=r==="audio"?o.hasAudio:o.hasVideo;return c!==d?!c&&d?(I.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(r)),void this.safeEmit(ri.USER_PUBLISHED,o,r)):(r==="video"&&o._videoTrack&&o._videoTrack._destroy(),r==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,r),I.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(r)),void this.safeEmit(ri.USER_UNPUBLISHED,o,r)):void 0}),F(this,"_handleMuteStream",(r,a,s)=>{if(B("BLOCK_LOCAL_CLIENT")&&yl(r,this.channelName))return;I.debug("[".concat(this._clientId,"] receive mute message"),r,a,s);let o=this._users.find(l=>l.uid===r);if(!o)return void I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));let c=a==="audio"?o.hasAudio:o.hasVideo;if(a==="audio"){o._trust_audio_mute_state_=!0;let l=o._audio_muted_;if(o._audio_muted_=s,o._audio_muted_===l)return;{let h=o._audio_muted_?"mute-audio":"unmute-audio";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(h)),this.safeEmit(ri.USER_INFO_UPDATED,r,h)}}else{o._trust_video_mute_state_=!0;let l=o._video_muted_;if(o._video_muted_=s,o._video_muted_===l)return;{let h=o._video_muted_?"mute-video":"unmute-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(h)),this.safeEmit(ri.USER_INFO_UPDATED,r,h)}}let d=a==="audio"?o.hasAudio:o.hasVideo;if(c!==d){if(!c&&d)return(a==="audio"?o._audioSSRC:o._videoSSRC)?(I.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(a)),void this.safeEmit(ri.USER_PUBLISHED,o,a)):void I.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(a," unmute message  before add stream message, ").concat(a," SSRC doesn't exist yet."));a==="video"&&o._videoTrack&&!o._video_pre_subscribed&&o._videoTrack._destroy(),a==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,a),I.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(a)),this.safeEmit(ri.USER_UNPUBLISHED,o,a)}}),F(this,"_handleP2PLost",async r=>{I.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():I.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),F(this,"_handleTokenWillExpire",()=>{I.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ri.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),F(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),I.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),F(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(ri.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ri.NETWORK_QUALITY,r)}),F(this,"_handleP2PAddAudioOrVideoStream",(r,a,s,o)=>{let c=this._users.find(l=>l.uid===a);if(!c)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(r)),this.store.subscribe(c.uid,r,void 0,void 0,void 0,Date.now());let d=r==="audio"?c.hasAudio:c.hasVideo;r==="audio"?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,r==="audio"?(c._audio_added_=!0,s!==void 0&&(c._audioSSRC=s),o!==void 0&&(c._audioMid=o)):(c._video_added_=!0,s!==void 0&&(c._videoSSRC=s),o!==void 0&&(c._videoMid=o)),(r==="audio"?c.hasAudio:c.hasVideo)&&!d&&(I.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(r)),this.safeEmit(ri.USER_PUBLISHED,c,r)),this._p2pChannel.hasPendingRemoteMedia(c,r)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,r,!0).catch(l=>{I.error("[".concat(this._clientId,"] resubscribe error"),l.toString())}))}),this._config=n,this._clientId=e||Ht(5,"client-"),this.store=new class{constructor(r,a,s,o){Rt(this,"state",void 0),this.state={codec:r,audioCodec:a,mode:s,clientId:o,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:a_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(r){this.state=(function(a,s){switch(s.type){case ft.SET_SESSION_ID:return we(we({},a),{},{sessionId:s.sessionId});case ft.SET_P2P_ID:return we(we({},a),{},{p2pId:s.p2pId});case ft.SET_UID:return we(we({},a),{},{uid:s.uid});case ft.SET_INT_UID:return we(we({},a),{},{intUid:s.intUid});case ft.SET_PUB_ID:return we(we({},a),{},{pubId:s.pubId});case ft.KEY_METRIC_CLIENT_CREATED:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{clientCreated:s.metric})});case ft.KEY_METRIC_JOIN_START:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{joinStart:s.metric})});case ft.KEY_METRIC_PRELOAD_START:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{preloadStart:s.metric})});case ft.KEY_METRIC_PRELOAD_END:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{preloadEnd:s.metric})});case ft.KEY_METRIC_JOIN_END:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{joinEnd:s.metric})});case ft.KEY_METRIC_REQUEST_AP_START:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{requestAPStart:s.metric})});case ft.KEY_METRIC_REQUEST_AP_END:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{requestAPEnd:s.metric})});case ft.KEY_METRIC_REQUEST_SUA_END:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{requestSUAEnd:s.metric})});case ft.KEY_METRIC_BEFORE_CONNECT:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{beforeConnect:s.metric})});case ft.KEY_METRIC_PEER_RECEIVER:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{peerReceiver:s.metric})});case ft.KEY_METRIC_SIGNAL_CONNECTED:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{signalConnected:s.metric})});case ft.KEY_METRIC_JOIN_REQ:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{joinReq:s.metric})});case ft.KEY_METRIC_JOIN_REP:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{joinRep:s.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_START:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{joinGatewayStart:s.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_END:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{joinGatewayEnd:s.metric})});case ft.KEY_METRIC_PEER_CONNECTION_START:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{peerConnectionStart:s.metric})});case ft.KEY_METRIC_PEER_CONNECTION_END:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{peerConnectionEnd:s.metric})});case ft.KEY_METRIC_DESCRIPTION_START:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{descriptionStart:s.metric})});case ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{signalChannelOpen:s.metric})});case ft.KEY_METRIC_ICE_CONNECTION_END:return we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{iceConnectionEnd:s.metric})});case ft.KEY_METRIC_PUBLISH:{let o=a.keyMetrics.publish,c=o.findIndex(d=>d.trackId===s.metric.trackId);return c!==-1?(o[c]=we(we({},o[c]),s.metric),we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{publish:[...o]})})):we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{publish:[...a.keyMetrics.publish,s.metric]})})}case ft.KEY_METRIC_SUBSCRIBE:{let o=a.keyMetrics.subscribe,c=o.findIndex(d=>d.userId===s.metric.userId&&d.type===s.metric.type);return c!==-1?(o[c]=we(we({},o[c]),s.metric),we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{subscribe:[...o]})})):we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{subscribe:[...a.keyMetrics.subscribe,s.metric]})})}case ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let o=a.keyMetrics.firstVideoFrameDecoded,c=o.findIndex(d=>d.userId===s.metric.userId);return c!==-1?(o[c]=we(we({},o[c]),s.metric),we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{firstVideoFrameDecoded:[...o]})})):we(we({},a),{},{keyMetrics:we(we({},a.keyMetrics),{},{firstVideoFrameDecoded:[...a.keyMetrics.firstVideoFrameDecoded,s.metric]})})}case ft.RESET_FIRST_VIDEO_FRAME_DECODED:return a.keyMetrics.firstVideoFrameDecoded=[],a;case ft.SET_CLOUD_PROXY_SERVER_MODE:return a.cloudProxyServerMode=s.mode,a;case ft.RECORD_JOIN_CHANNEL_SERVICE:return typeof s.index!="number"?a.joinChannelServiceRecords=[...a.joinChannelServiceRecords,s.record]:(a.joinChannelServiceRecords[s.index]=we(we({},a.joinChannelServiceRecords[s.index]),s.record),a.joinChannelServiceRecords=[...a.joinChannelServiceRecords]),a;case ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return a.joinChannelServiceRecords=[],a;case ft.RESET_KEY_METRICS:return a.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},a;case ft.SET_USE_P2P:return we(we({},a),{},{useP2P:s.val});case ft.SET_TRANSPORT_TYPE:return we(we({},a),{},{p2pTransport:s.val});default:return a}})(this.state,r)}set autoSubscribe(r){this.state.autoSubscribe=r}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(r){this.state.enableInstantMuteRestore=r}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(r){this.dispatch({type:ft.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:ft.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:ft.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:ft.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:ft.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:ft.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:ft.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:ft.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:ft.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ft.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ft.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ft.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ft.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ft.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(r,a){this.dispatch({type:ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:we({userId:r},a)})}descriptionStart(){this.dispatch({type:ft.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,a,s,o){this.dispatch({type:ft.KEY_METRIC_PUBLISH,metric:we(we({trackId:r,type:a},s&&{publishStart:s}),o&&{publishEnd:o})})}subscribe(r,a,s,o,c,d,l){this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:we(we(we(we(we({userId:r,type:a},s&&{subscribeStart:s}),o&&{subscribeEnd:o}),c&&{firstFrame:c}),d&&{streamAdded:d}),l&&{firstDecoded:l})})}massSubscribe(r,a,s,o){r.forEach(c=>{this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:we(we(we({userId:c.userId,type:c.type},a&&{subscribeStart:a}),s&&{subscribeEnd:s}),o&&{firstFrame:o})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,a){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(s=>s.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof a!="number"?(this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:we(we({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(a<0||a>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:a}),a)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ft.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ft.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(n.codec,n.audioCodec,n.mode,this._clientId),this._leaveMutex=new xa("client-leave",this._clientId),this._publishMutex=new xa("client-publish",this._clientId),this._renewTokenMutex=new xa("client-renewtoken",this._clientId),this._subscribeMutex=new xa("client-subscribe",this._clientId),this.store.clientCreated(),n.proxyServer&&this.setProxyServer(n.proxyServer,!0),n.turnServer&&this.setTurnServer(n.turnServer,!0),I.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(dc," build: ").concat(fb,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),n.clientRoleOptions)try{uO(n.clientRoleOptions),t=Object.assign({},n.clientRoleOptions)}catch(r){I.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new Ju(this.store),this._statsCollector.onStatsException=(r,a,s)=>{I.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(a,", uid: ").concat(s)),r===zU.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(o=>{o instanceof Xi&&B("ENABLE_ENCODE_EXCEPTION")&&o.findClosestProfile()}),this.safeEmit(ri.EXCEPTION,{code:r,msg:a,uid:s})},this._statsCollector.onUploadPublishDuration=(r,a,s,o)=>{let c=this._users.find(d=>d.uid===r);c&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(c._uintid,{peerPublishDuration:s,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(c)),Te.peerPublishStatus(this._sessionId,{subscribeElapse:o,audioPublishDuration:a,videoPublishDuration:s,peer:c._uintid}))},this._statsCollector.onVideoCodecChanged=r=>{if(B("VIDEO_STANDARD_BITRATE_VERSION")&&(r==="av1"||r==="h265"||r==="h264")){let a=this.localTracks.find(s=>s instanceof Ai);a&&a._saveEncodeBitrateRatio!==1&&a.setSaveEncodeBitrateRatio(r==="h264"?B("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=n.mode==="p2p",this._gateway=new kU(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:n.websocketRetryConfig||Yr,httpRetryConfig:n.httpRetryConfig||Yr,forceWaitGatewayResponse:n.forceWaitGatewayResponse===void 0||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:t}),this._configDistribute=new YU(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},jo("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new EE(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(n,e,t,i,r){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],s=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ct("JOIN_GATEWAY_USE_443PORT_ONLY",a),Ct("JOIN_GATEWAY_USE_DUAL_DOMAIN",s);let o=this._gateway.signal.websocket;return o instanceof KO&&(o.use443PortOnly=a,o.tryDoubleDomain=s),(async function(c,d,l){$f.get(c)||$f.set(c,[]),Sg.get(c)||Sg.set(c,d),bd.get(c)||bd.set(c,0);let h=$f.get(c),_=Sg.get(c);if(!h||!_)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(bd.get(c)===_){let R=rb();h.push(R),await R.promise}bd.set(c,bd.get(c)+1);for(var f=arguments.length,m=new Array(f>3?f-3:0),S=3;S<f;S++)m[S-3]=arguments[S];let T=await l(...m);return bd.set(c,bd.get(c)-1),bd.get(c)===_-1&&h.length>0&&(h[0].resolve(),h.shift()),bd.get(c)===0&&($f.set(c,[]),Sg.set(c,0),bd.set(c,0)),T})("client.join",B("JOIN_MAX_CONCURRENCY"),this.join.bind(this),n,e,t,i,r)}async join(n,e,t,i,r){let a=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);let s=(Vc||Vc||(Vc=(window.location.protocol.split(":")[0]||"").toUpperCase(),Vc))==="HTTPS",o=TB()?window.isSecureContext:"Browser Not Support";(!TB()&&!s||!window.isSecureContext)&&I.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let c;Te.setAppId(n);try{if(!t&&t!==null)throw new J(M.INVALID_PARAMS,"Invalid token: ".concat(t,". If you don not use token, set it to null"));if(t&&Zn(t,"token",1,2047),Zn(n,"appid",1,2047),Pt(e),i&&Dg(i),r)if(typeof r=="string")Zn(r,"optionalInfo",1,256),c=r;else{if(typeof r!="object")throw new J(M.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:T,enableInstantMuteRestore:R}=r;T&&(_e(T,"autoSubscribe"),I.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(T)),this.store.autoSubscribe=T),R&&(_e(R,"enableInstantMuteRestore"),I.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(R)),this.store.enableInstantMuteRestore=R)}}}catch(T){throw Te.reportApiInvoke(Mi(),{name:Jr.JOIN,options:[n,e,t,i],states:{isHttps:s,isSecureContext:o},tag:Gt.TRACER}).onError(T),T}if(this._leaveMutex.isLocked&&(I.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),I.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let T=new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Te.reportApiInvoke(Mi(),{name:Jr.JOIN,options:[n,e,t,i],states:{isHttps:s,isSecureContext:o},tag:Gt.TRACER}).onError(T),T}this._gateway.state="CONNECTING",this.store.preloadStart();let d=await ox({appId:n,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:t||n,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let l=d?.sid||Mi();I.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(a)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);let h=Te.reportApiInvoke(l,{id:this._clientId,name:Jr.JOIN,options:[n,e,t,i],states:{isHttps:s,isSecureContext:o},tag:Gt.TRACER}),_=Vd(Vd(Vd({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:n,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:t||n,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:B("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(_.stringUid=i,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async T=>{let R=(function(k){let P=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),U=new Uint8Array(new ArrayBuffer(P.length));for(let W=0;W<P.length;W+=1)U[W]=P.charCodeAt(W);return U})(),C=await window.crypto.subtle.importKey("spki",R,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),b=cO(T),N=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},C,b);return(function(k){let P="";for(let U=0;U<k.length;U+=1)P+=String.fromCharCode(k[U]);return window.btoa(P)})(new Uint8Array(N))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let T=new TextEncoder,R=B("USE_PURE_ENCRYPTION_MASTER_KEY")?T.encode(_.appId+this._encryptionSecret+this._encryptionSecret):T.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(C,b,N){let k=await window.crypto.subtle.importKey("raw",b,"PBKDF2",!1,["deriveBits","deriveKey"]),P=C==="aes-128-gcm2"?128:256,U=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:yB,hash:"SHA-256",salt:N},k,P+vB);return new Uint8Array(U).subarray(P/8)})(this._encryptionMode,R,Uc(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(C,b,N){let k=await window.crypto.subtle.importKey("raw",b,"PBKDF2",!1,["deriveBits","deriveKey"]),P=C==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:yB,hash:"SHA-256",salt:N},k,{name:"AES-GCM",length:P},!0,["encrypt","decrypt"])})(this._encryptionMode,R,Uc(this._encryptionSalt))}else o?I.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):I.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,I.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:n,stringUid:_.stringUid});let f=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&f===this._sessionId&&Te.joinChannelTimeout(this._sessionId,5)},5e3);try{var m;let T,R=_.cloudProxyServer;if(ee(m=["proxy3","proxy4","proxy5"]).call(m,R)){let P=B("PROXY_SERVER_TYPE3");Array.isArray(P)?_.proxyServer=P[0]:_.proxyServer=P}if(Te.setProxyServer(_.proxyServer),I.setProxyServer(_.proxyServer),this.store.requestAPStart(),d){if(I.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(d.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=d.intUid),T={gatewayInfo:d.ap.gatewayInfo},B("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(d.ap.proxyInfo.addresses.length===0)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let P=(await gR(d.ap.proxyInfo,d.ap.gatewayInfo.uid)).map(U=>({turnServerURL:U.address,tcpport:U.tcpport||wn.tcpport,udpport:U.udpport||wn.udpport,username:U.username||wn.username,password:U.password||wn.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:P}}dx(d,_.stringUid)}else{if(_.stringUid&&!_.uid){let P;[P,T]=await se.all([HU(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||Yr,this.store).finally(()=>{this.store.requestSUAEnd()}),e0(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Yr,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),I.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(P)),_.uid=P,T.gatewayInfo.uid=P,T.gatewayInfo.res.uid=P}else T=await e0(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Yr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(uE.UPDATE_BITRATE_LIMIT,P=>{this._p2pChannel.updateBitrateLimit(P)}),this._configDistribute.on(uE.UPDATE_CLIENT_ROLE_OPTIONS,P=>{this._setClientRoleOptions(P)})},0),this._key=t||n;let C=T.gatewayInfo,b=_.uid?_.uid:C.uid;this._joinInfo=Vd(Vd({},_),{},{cid:C.cid,uid:b,vid:C.vid,apResponse:C.res,apGatewayAddress:C.apGatewayAddress,uni_lbs_ip:C.uni_lbs_ip,gatewayAddrs:C.gatewayAddrs}),this.store.intUid=b,this.store.cid=C.cid;let N=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));h.onSuccess(N),this._appId=n,this._channelName=_.cname,this._uid=N,this.store.uid=N,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(dn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let k=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return I.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(k)),setTimeout(()=>{I.startUpload()},5e3),this.store.joinEnd(),S=this,ee(dE).call(dE,S)||dE.push(S),this._cloudProxyServerMode==="disabled"&&Nt().supportWebCrypto&&B("ENABLE_PRELOAD")&&h0(this._joinInfo),N}catch(T){let R=Array.isArray(T)?T[0]:T;throw R&&R.code===M.OPERATION_ABORTED?I.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),R):I.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),R),R.code!==M.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),h.onError(R),R}var S}_joinGateway(){if(!this._joinInfo||!this._key)throw new J(M.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!B("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){I.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(dn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(e){let t=dE.indexOf(e);t!==-1&&dE.splice(t,1)})(this),this._statsCollector.stopUpdateStats();let n=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return I.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void n();await this._gateway.leave(this.connectionState!=="CONNECTED",Vi.LEAVE),I.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),n()}async publish(n){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(n)){if(!(n instanceof Ig))return this._publishDataChannel(n);n=[n]}if(n.length===0)throw new J(M.INVALID_PARAMS,"param list is empty");let t=n;if(this._gateway.role==="audience")throw new J(M.INVALID_OPERATION,"audience can not publish stream");for(let r of t){if(!(r instanceof Ig))throw new J(M.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new J(M.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}I.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(t.map(r=>"".concat(r.getTrackId()," "))));let i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&t.forEach(r=>{let a=this._configDistribute.getBitrateLimit();r instanceof Ai&&a&&r.setBitrateLimit(a.uplink)});try{await this._publishHighStream(t),I.info("[".concat(this._clientId,"] Publish success, id ").concat(t.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw I.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(n){if(n==null)throw new J(M.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(n)));Bt(n.id,"id",0,65535,!0),_e(n.ordered,"ordered"),Zn(n.metadata,"metadata",0,512),I.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(n.id));let e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===n.id)!==-1)throw new J(M.INVALID_PARAMS,"Invalid id: ".concat(n.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new J(M.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new J(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let t=(function(r){return ip(r,!1)})(n),i=await this._p2pChannel.publishDataChannel([t]);if(i.length>0){if(typeof t._originDataChannelId!="number")throw I.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new J(M.CREATE_DATACHANNEL_ERROR);try{await se.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await t._waitTillOpen()}catch(r){if(r.code!==M.DISCONNECT_P2P)throw r}}return I.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(t){throw I.error("[".concat(this._clientId,"] publish datachannels error"),t.toString()),t}finally{e()}}async unpublish(n){if(!this._joinInfo||this._uid===void 0)throw new J(M.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(n)if(Array.isArray(n))e=n;else{if(!(n instanceof Ig))return this._unpublishDataChannel([n]);e=[n]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);I.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));let t=await this._publishMutex.lock();try{if(this.store.useP2P){let i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(kr.UNPUBLISH,{unpubMsg:i},!0)}else{let i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),I.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw I.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{t&&t()}}async _unpublishDataChannel(n){n!==void 0&&n.length!==0||(n=this._p2pChannel.getAllDataChannels()),I.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(n.map(t=>"".concat(t.id," "))," "));let e=await this._publishMutex.lock();try{let t=await this._p2pChannel.unpublishDataChannel(n);t&&await this._gateway.unpublishDataChannel(t),I.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(n.map(i=>"".concat(i.id))))}catch(t){throw I.error("[".concat(this._clientId,"] unpublish dataChannel error"),t.toString()),t}finally{e&&e()}}async subscribe(n,e,t){if(!(n instanceof g_)){let i=this.remoteUsers.find(r=>r.uid===n);if(!i)throw new J(M.INVALID_REMOTE_USER,"user is not in the channel");n=i}return e==="datachannel"?this._subscribeDataChannel(n,t):this._subscribe(n,e)}async presubscribe(n,e){if(gr(e,"mediaType",["audio","video"]),this.store.useP2P)throw new J(M.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new J(M.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let t=e===ze.AUDIO,i=e===ze.VIDEO,r=await this._subscribeMutex.lock();try{let{ssrcId:a,ortc:s,rtxSsrcId:o,cname:c,uint_id:d}=await this._gateway.presubscribe(n,e,!0);if(a==null)throw new J(M.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find(_=>_.uid===n);l||(l=new g_(n,d||n),l._is_pre_created=!0,this._users.push(l)),c&&(l._cname=c),l._uintid||(l._uintid=d||n),t&&(l._audioSSRC=a,l._audio_pre_subscribed=!0,s&&(l._audioOrtc=s)),i&&(l._videoSSRC=a,l._video_pre_subscribed=!0,s&&(l._videoOrtc=s),o!=null&&(l._rtxSsrcId=o)),I.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(a)),await this._p2pChannel.subscribe(l,e,a,o,s);let h=t?l._audioTrack:l._videoTrack;if(!h)throw new J(M.UNEXPECTED_ERROR,"can not find remote track in user");return t&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),i&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),h}catch(a){throw I.error("[".concat(this._clientId,"] presub user ").concat(n," error"),a),a}finally{r()}}async _subscribeDataChannel(n,e){var t;if(Bt(e,"channelId",0,65535,!0),!this._joinInfo)throw new J(M.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===n))throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),new J(M.INVALID_REMOTE_USER,"user is not in the channel");if(!n.hasAudio&&!n.hasVideo&&n._dataChannels.length===0)throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),new J(M.INVALID_REMOTE_USER,"user is not published");let i=(t=n._dataChannels)===null||t===void 0?void 0:t.find(s=>s.id===e);if(!i)throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, remote datachannel is not published")),new J(M.REMOTE_USER_IS_NOT_PUBLISHED);let r=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: datachannel"));try{let s=await this._p2pChannel.subscribeDataChannel(n,[i]);if(s&&ee(s).call(s,i.id))try{var a;if(typeof i._originDataChannelId!="number")throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, cannot get RTCDatachannel")),new J(M.CREATE_DATACHANNEL_ERROR);let o={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(a=i.metadata)!==null&&a!==void 0?a:""};await this._gateway.subscribeDataChannel(n.uid,o,!0),await i._waitTillOpen()}catch(o){if(o?.code!==M.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(n,[i]),o;await this._p2pChannel.unsubscribeDataChannel(n,[i]),this._p2pChannel.setPendingRemoteDataChannel(n,i.id)}return I.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: datachannel")),i}finally{r()}}async _p2pSubscribe(n,e,t){if(gr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new J(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(r=>r===n)){let r=new J(M.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),r}if(!n.hasAudio&&!n.hasVideo){let r=new J(M.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),r}if(!t&&(e==="audio"&&!n.hasAudio||e==="video"&&!n.hasVideo)){let r=new J(M.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(e,", remote track is not published")),r}let i=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(n,e))await this._p2pChannel.unmuteRemote(n,e);else try{let a=e==="audio"?n._audioSSRC:n._videoSSRC,s=e==="audio"?n._audioMid:n._videoMid;this.store.subscribe(n.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(n,e,a,s)}catch(a){throw a}I.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(n.uid,this._defaultStreamFallbackType).catch(a=>{I.warning("[".concat(this._clientId,"] auto set fallback failed"),a)});let r=e==="audio"?n._audioTrack:n._videoTrack;if(!r)throw new J(M.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(r){throw I.error("[".concat(this._clientId,"] subscribe user ").concat(n.uid," error"),r),r}finally{i()}}async _subscribe(n,e,t){if(this.store.useP2P)return this._p2pSubscribe(n,e);if(gr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new J(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===n)){let c=new J(M.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),c}if(!n.hasAudio&&!n.hasVideo){let c=new J(M.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),c}if(!(t||(e!=="audio"||n.hasAudio&&n._audioSSRC!==void 0)&&(e!=="video"||n.hasVideo&&n._videoSSRC!==void 0))){let c=new J(M.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(e,", remote track is not published")),c}let i=e==="audio"?n._audioSSRC:n._videoSSRC,r=e==="audio"?n._audioOrtc:n._videoOrtc,a=e==="video"?n._rtxSsrcId:void 0,s={stream_type:e==="audio"?ze.AUDIO:ze.VIDEO,ssrcId:i};e==="video"&&this.store.firstVideoFrameDecoded(n.uid,{subscribeStart:Date.now()});let o=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(n,e))await this._p2pChannel.unmuteRemote(n,e);else try{let d=e==="audio"?n._audioSSRC:n._videoSSRC;d!==void 0&&d!==i&&(i=d,r=e==="audio"?n._audioOrtc:n._videoOrtc,a=e==="video"?n._rtxSsrcId:void 0,s={stream_type:e==="audio"?ze.AUDIO:ze.VIDEO,ssrcId:i}),Ia.markSubscribeStart(this.store.clientId,i),this.store.subscribe(n.uid,e,Date.now()),await this._p2pChannel.subscribe(n,e,i,a,r);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(n.uid,s,!0)}catch(l){if(l?.code!==M.WS_ABORT)throw await this._p2pChannel.unsubscribe(n,e),l;await this._p2pChannel.unsubscribe(n,e,!0),this._p2pChannel.setPendingRemoteMedia(n,e)}this.store.subscribe(n.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,n,e)}catch(d){throw this._p2pChannel.reportSubscribeEvent(!1,d?.code,n,e),d}I.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(n.uid,this._defaultStreamFallbackType).catch(d=>{I.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});let c=e==="audio"?n._audioTrack:n._videoTrack;if(!c)throw new J(M.UNEXPECTED_ERROR,"can not find remote track in user object");return e==="video"&&(this.store.firstVideoFrameDecoded(n.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(n)),c}catch(c){throw I.error("[".concat(this._clientId,"] subscribe user ").concat(n.uid," error"),c),c}finally{o()}}async massSubscribe(n){if(rn(n,"subscribeList"),!this._joinInfo)throw new J(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let e=Date.now(),t=new Map,i=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"]start massSubscribe user ").concat(n.map(o=>{let{user:c,mediaType:d}=o;return"user: ".concat(c?.uid,", mediaType: ").concat(d)}).join("; ")));let r=(n=[...n]).map(o=>{let{user:c,mediaType:d}=o;return{user:c,mediaType:d}}),a=await this._p2pChannel.globalLock();try{var s;for(let c=n.length-1;c>=0;c--){let d=n[c],{user:l,mediaType:h}=d;if(gr(h,"mediaType",["audio","video"]),!l){let m=new J(M.INVALID_PARAMS,"user property does not exist in subscribeList item");throw I.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),m}if(!this._users.find(m=>m===l)){let m=new J(M.INVALID_REMOTE_USER,"user is not in the channel");I.error("[".concat(this._clientId,"] can not massSubscribe ").concat(l.uid,", this user is not in the channel")),r[c].error=m,n.splice(c,1);continue}if(h==="audio"&&(!l.hasAudio||l._audioSSRC===void 0)||h==="video"&&(!l.hasVideo||l._videoSSRC===void 0)){let m=new J(M.REMOTE_USER_IS_NOT_PUBLISHED);I.error("[".concat(this._clientId,"] can not subscribe ").concat(l.uid," with mediaType ").concat(h,", remote user is not published")),r[c].error=m,n.splice(c,1);continue}let _=Dn.Video|Dn.LwoVideo,f=t.get(l);if(f){if(h==="video"?f&_:f&Dn.Audio){n.splice(c,1),I.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(l.uid,", mediaType:").concat(h," twice"));continue}t.set(l,f|(h==="video"?_:Dn.Audio))}else t.set(l,h==="video"?_:Dn.Audio)}for(let c=n.length-1;c>=0;c--){let d=n[c],{user:l,mediaType:h}=d,_=Dn.Video|Dn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(l,h)){await this._p2pChannel.unmuteRemoteNoLock(l,h);let f=t.get(l);t.set(l,h==="video"?f^_:f^Dn.Audio),n.splice(c,1)}}this.store.massSubscribe(n.map(c=>({userId:c.user.uid,type:c.mediaType})),e);let o=Pn(s=Array.from(t.entries())).call(s,(c,d)=>{let[l,h]=d;if(h===0)return c;let _={stream_id:l.uid,stream_type:h};return h&Dn.Audio&&(_.audio_ssrc=l._audioSSRC),h&Dn.Video&&(_.video_ssrc=l._videoSSRC),c.push(_),c},[]);try{n.length>0&&await this._p2pChannel.massSubscribeNoLock(n.map(d=>{let{user:l,mediaType:h}=d;return{user:l,mediaType:h,ssrcId:h===ze.VIDEO?l._videoSSRC:l._audioSSRC,rtxSsrcId:h===ze.VIDEO?l._rtxSsrcId:void 0}}));let c=new Map;if(o=o.filter(d=>d.video_ssrc&&!this._p2pChannel.isPreSubScribe(d.video_ssrc)||d.audio_ssrc&&!this._p2pChannel.isPreSubScribe(d.audio_ssrc)||!d.video_ssrc&&!d.audio_ssrc),o.length>0&&((await this._gateway.subscribeAll(o,!0))?.users||[]).forEach(l=>{let{stream_id:h,video_error_code:_,audio_error_code:f,error_code:m}=l;(_||f||m)&&c.set(h,{video_error_code:_,audio_error_code:f,error_code:m})}),Array.from(c.entries()).length>0){let d=[];Array.from(c.entries()).forEach(l=>{let[h,_]=l,f=this.remoteUsers.find(m=>m.uid===h);if(f){let m;_.error_code||_.video_error_code&&_.audio_error_code?m=void 0:_.video_error_code?m=ze.VIDEO:_.audio_error_code&&(m=ze.AUDIO),d.push({user:f,mediaType:m})}}),d.length>0&&await this._p2pChannel.massUnsubscribeNoLock(d)}for(let d of r){let l=c.get(d.user.uid);if(l){let h=l.error_code||d.mediaType==="audio"&&l.audio_error_code||d.mediaType==="video"&&l.video_error_code;if(h){let _=Lb(h);I.error("user:".concat(d.user.uid," mediaType:").concat(d.mediaType," has massSubscribe error ").concat(_.desc)),d.error=new J(M.SUBSCRIBE_FAILED,"code ".concat(h,": ").concat(_.desc))}}d.error||(d.mediaType==="video"?d.track=d.user.videoTrack:d.track=d.user.audioTrack)}return this.store.massSubscribe(r.filter(d=>!d.error).map(d=>({userId:d.user.uid,type:d.mediaType})),void 0,Date.now()),r.forEach(d=>{var l;Te.subscribe(this.store.sessionId,{succ:!!d.error,ec:((l=d.error)===null||l===void 0?void 0:l.code)||null,video:d.mediaType===ze.VIDEO,audio:d.mediaType===ze.AUDIO,peerid:d.user.uid,subscribeRequestid:d.mediaType===ze.VIDEO?d.user._videoSSRC:d.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(d.user._videoSSRC)},!0)}),I.info("[".concat(this._clientId,"] massSubscribe success ").concat(n.map(d=>{let{user:l,mediaType:h}=d;return"user: ".concat(l?.uid,", mediaType: ").concat(h)}).join("; "))),r}catch(c){throw await this._p2pChannel.massUnsubscribeNoLock(n),c}}finally{a(),i()}}async unsubscribe(n,e,t){if(!(n instanceof g_)){let r=this.remoteUsers.find(a=>a.uid===n);if(!r)throw new J(M.INVALID_REMOTE_USER,"user is not in the channel");n=r}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(n,t)}else await this._unsubscribeDataChannel(n,t);if(e&&gr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new J(M.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(r=>r===n)){let r=new J(M.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),r}I.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: ").concat(e));let i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(n,e);else{let r=await this._p2pChannel.unsubscribe(n,e);r&&await this._gateway.unsubscribe(r,n.uid),e&&e!=="audio"||(n._audio_pre_subscribed=!1),e&&e!=="video"||(n._video_pre_subscribed=!1),n._is_pre_created&&Zr(this._users,n),I.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(n.uid,", mediaType: ").concat(e))}}catch(r){if(r.code===M.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(this._clientId,"] unsubscribe user ").concat(n.uid," error"),r.toString()),r}finally{i()}}async _unsubscribeDataChannel(n,e){if(e&&Bt(e,"id",0,65535,!0),!this._joinInfo)throw new J(M.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===n)){let i=new J(M.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),i}let t;if(typeof e=="number"){let i=n._dataChannels.find(r=>r.id===e);i&&(t=[i])}else t=n._dataChannels;if(t===void 0){let i=new J(M.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid," with channelId ").concat(e,", remote datachannel is not published")),i}I.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(t.map(i=>i.id)));try{let i=await this._p2pChannel.unsubscribeDataChannel(n,t);i&&await this._gateway.unsubscribeDataChannel(i,n.uid),I.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===M.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(this._clientId,"] unsubscribe user ").concat(n.uid," error"),i.toString()),i}}async massUnsubscribe(n){if(rn(n,"unsubscribeList"),!this._joinInfo)throw new J(M.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");I.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(n.map(t=>{let{user:i,mediaType:r}=t;return"user: ".concat(i?.uid,", mediaType: ").concat(r,";")}).join())),n=[...n];let e=new Map;for(let t=n.length-1;t>=0;t--){let{user:i,mediaType:r}=n[t];if(!i){let s=new J(M.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw I.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),s}if(gr(r,"mediaType",["video","audio",void 0]),!this._users.find(s=>s===i)){I.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),n.splice(t,1);continue}let a=Dn.Video|Dn.LwoVideo;if(e.has(i)){let s=e.get(i),o;switch(r){case"video":o=s&a;break;case"audio":o=s&Dn.Audio;break;default:o=s&(Dn.Audio|a)}if(o){I.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),n.splice(t,1);continue}r?r==="audio"?e.set(i,s|Dn.Audio):r==="video"&&e.set(i,s|a):e.set(i,s|Dn.Audio|a)}else r?r==="audio"?e.set(i,Dn.Audio):r==="video"&&e.set(i,a):e.set(i,Dn.Audio|a)}try{let t=await this._p2pChannel.massUnsubscribe(n);t&&await this._gateway.massUnsubscribe(t),I.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(n.map(i=>{let{user:r,mediaType:a}=i;return"user: ".concat(r?.uid,", mediaType: ").concat(a,";")}).join()))}catch(t){if(t.code===M.DISCONNECT_P2P)return void I.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw I.error("[".concat(this._clientId,"] massUnsubscribe error"),t.toString()),t}}async setLowStreamParameter(n){(function(t){if(!t)throw new L(M.INVALID_PARAMS);zi(t.width)||ji(t.width,"streamParameter.width"),zi(t.height)||ji(t.height,"streamParameter.height"),zi(t.framerate)||ji(t.framerate,"streamParameter.framerate"),zi(t.bitrate)||Bt(t.bitrate,"streamParameter.bitrate")})(n),(!n.width&&n.height||n.width&&!n.height)&&I.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),I.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(n));let e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&n.bitrate&&e.bitrate<n.bitrate&&(n.bitrate=e.bitrate),this._lowStreamParameter=n,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(n,Ae.LocalVideoLowTrack)}async enableDualStream(){if(!Nt().supportDualStream)throw Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new J(M.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new J(M.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(n){throw Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),n}this._isDualStreamEnabled=!0,Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),I.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new J(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ae.LocalVideoLowTrack))try{let n=await this._p2pChannel.unpublishLowStream();n&&await this._gateway.unpublish(n,this._joinInfo.stringUid||this._joinInfo.uid)}catch(n){throw Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),n}this._isDualStreamEnabled=!1,Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),I.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(n,e){if((function(i){gr(i,"role",["audience","host"])})(n),e&&uO(e),this.mode==="rtc"||this.mode==="p2p")throw I.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new J(M.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&n==="host")throw new J(M.INVALID_OPERATION,"host mode can not set audience latency level");if(n==="audience"&&this._p2pChannel.hasLocalMedia())throw new J(M.INVALID_OPERATION,"can not set client role to audience when publishing stream");let t=this._config.role;this._joinInfo&&(this._joinInfo.role=n),n!==t&&B("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(n,e),this._config.role=n,this._gateway.reconnect("recover",yt.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(n,e),this._config.role=n),I.info("[".concat(this._clientId,"] set client role to ").concat(n,", level: ").concat(e&&e.level))}async _setClientRoleOptions(n){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{n&&uO(n),await this._gateway.setClientRole(this._config.role,n),e=!0}catch{}finally{I.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(n))}}getRemoteInboundOffset(){var n;let e=(n=this._p2pChannel.getStats())===null||n===void 0?void 0:n.audioSend[0];if(!e||!e.timestamp)return 0;let t=e.timestamp-Date.now();return Math.abs(t)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?t:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(n,e){if(Zn(n,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new J(M.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new J(M.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=n,Te.setProxyServer(this._proxyServer),I.setProxyServer(this._proxyServer),I.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(n,e){if(Array.isArray(n)||(n=[n]),!e){if(this.connectionState!=="DISCONNECTED")throw new J(M.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new J(M.INVALID_OPERATION,"You have already set the proxy")}if(Oi(n))return this._turnServer={servers:n,mode:"original-manual"},void I.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(n.map(t=>t.urls).join(","),"."));n.forEach(t=>qT(t)),this._turnServer={servers:n,mode:"manual"},I.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(n){if(this.connectionState!=="DISCONNECTED")throw new J(M.INVALID_OPERATION,"you should set license before join channel");if(Zn(n,"license",32,32),!/^[A-Za-z\d]+$/.test(n))throw new J(M.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=n,I.info("[".concat(this._clientId,"] set license success"),n)}startProxyServer(n){if(this.connectionState!=="DISCONNECTED")throw new J(M.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new J(M.INVALID_OPERATION,"You have already set the proxy");let e=[3,4,5],t;switch(n===void 0&&(n=3),n){case 1:case 2:throw new J(M.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new J(M.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new J(M.INVALID_OPERATION,"Stop proxy server after leave channel");Te.setProxyServer(),I.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(n){if(!n.accessPoints)throw new J(M.INVALID_PARAMS,"accessPoints is required.");rn(n.accessPoints.serverList,"accessPoints.serverList"),Zn(n.accessPoints.domain,"accessPoints.domain");let e=(_,f)=>{Bt(_,f,0,65535,!0)},t=443;if(n.accessPoints.port&&(e(n.accessPoints.port,"accessPoints.port"),t=n.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new J(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");B("CLOSE_AFB_FOR_LOCAL_AP")&&(Ct("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ct("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=n.accessPoints.domain,a=n.accessPoints.serverList.map(_=>i.test(_)?"".concat(_.replace(/\./g,"-"),".").concat(r):_),s=a.map(_=>"".concat(_,":").concat(t));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ct("WEBCS_DOMAIN",s),Ct("WEBCS_DOMAIN_BACKUP_LIST",s),Ct("GATEWAY_DOMAINS",[r]),n.report&&n.report.hostname&&Array.isArray(n.report.hostname)&&n.report.hostname.length?(rn(n.report.hostname,"report.hostname"),Ct("EVENT_REPORT_DOMAIN",n.report.hostname[0]),Ct("EVENT_REPORT_BACKUP_DOMAIN",n.report.hostname[1]||n.report.hostname[0])):(Ct("EVENT_REPORT_DOMAIN",a[0]),Ct("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let o=6443;n.report&&n.report.port&&(e(n.report.port,"report.port"),o=n.report.port),Ct("STATS_COLLECTOR_PORT",o),n.report?Ct("ENABLE_EVENT_REPORT",!0):Ct("ENABLE_EVENT_REPORT",!1);let c="";n.log&&n.log.hostname&&Array.isArray(n.log.hostname)&&n.log.hostname.length?(rn(n.log.hostname,"log.hostname"),c=n.log.hostname[0]):c=a[0];let d=6444;n.log&&n.log.port&&(e(n.log.port,"log.port"),d=n.log.port),Ct("LOG_UPLOAD_SERVER","".concat(c,":").concat(d));let l=[];n.cds&&n.cds.hostname&&Array.isArray(n.cds.hostname)&&n.cds.hostname.length?(rn(n.cds.hostname,"cds.hostname"),l=n.cds.hostname):l=a;let h=443;n.cds&&n.cds.port&&(e(n.cds.port,"cds.port"),h=n.cds.port),Ct("CDS_AP",l.map(_=>"".concat(_,":").concat(h))),n.cds?Ct("ENABLE_CONFIG_DISTRIBUTE",!0):Ct("ENABLE_CONFIG_DISTRIBUTE",!1),I.info("set local access point v2 success")}setLocalAccessPoints(n,e){if(rn(n,"serverList"),Zn(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new J(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let t=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(i=>t.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ct("WEBCS_DOMAIN",n),Ct("WEBCS_DOMAIN_BACKUP_LIST",n),Ct("GATEWAY_DOMAINS",[e]),Ct("EVENT_REPORT_DOMAIN",n[0]),Ct("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),Ct("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),I.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(n){if(gr(n,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=n,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(n),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw I.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else I.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(n))}async setRemoteVideoStreamType(n,e){gr(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(n,e),setTimeout(()=>{let t=this._users.find(i=>i.uid===n);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(t){throw I.error("[".concat(this._clientId,"] set remote video stream type error"),t.toString()),t}I.info("[".concat(this._clientId,"] set remote ").concat(n," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(n,e)}async setStreamFallbackOption(n,e){gr(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(n,e)}catch(t){throw I.error("[".concat(this._clientId,"] set stream fallback option"),t.toString()),t}I.info("[".concat(this._clientId,"] set remote ").concat(n," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(n,e)}setEncryptionConfig(n,e,t,i){(function(a){gr(a,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(n),Zn(e,"secret");let r=["aes-128-gcm2","aes-256-gcm2"];if(ee(r).call(r,n)){if(!t||!(t instanceof Uint8Array&&t.length===32))throw new J(M.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(t)throw new J(M.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(_e(i,"encryptDataStream"),!ee(r).call(r,n))throw new J(M.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||I.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=n,this._encryptionSecret=e,t&&(this._encryptionSalt=xc(t))}async renewToken(n){if(Zn(n,"token",1,2047),!this._key||!this._joinInfo)throw new J(M.INVALID_OPERATION,"renewToken should not be called before user join");let e=this._key;this._key=n,this._joinInfo&&(this._joinInfo.token=n);let t=await this._renewTokenMutex.lock();try{if(B("USE_NEW_TOKEN")){I.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let i=await bH(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yr);I.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:n,ticket:i})}else I.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:n});I.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,I.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{t()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?I.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let n=this._p2pChannel.getAudioLevels();this.safeEmit(ri.VOLUME_INDICATOR,n)},B("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let n=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return n.Duration=Math.round(e.duration/1e3),n}async startLiveStreaming(n,e){if(!e){if(this.codec!=="h264")throw new J(M.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new J(M.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(n)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(n))throw new J(M.LIVE_STREAMING_TASK_CONFLICT);let t=e?Cl.TRANSCODE:Cl.RAW;return this._createLiveStreamingClient(t).startLiveStreamingTask(n,t)}setLiveTranscoding(n){return this._createLiveStreamingClient(Cl.TRANSCODE).setTranscodingConfig(n)}async stopLiveStreaming(n){let e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(n));if(!e.length)throw new J(M.INVALID_PARAMS,"can not find live streaming url to stop");await se.all(e.map(t=>t&&t.stopLiveStreamingTask(n)))}async startChannelMediaRelay(n){qU(n),await this._createChannelMediaRelayClient().startChannelMediaRelay(n)}async updateChannelMediaRelay(n){qU(n),await this._createChannelMediaRelayClient().updateChannelMediaRelay(n)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(n){this._p2pChannel instanceof EE&&this._p2pChannel.addAudioMetadata(n)}async sendStreamMessage(n){var e;let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new J(M.INVALID_OPERATION,"can not send data stream, not joined");if((typeof n=="string"||n instanceof Uint8Array)&&(n={payload:n}),typeof n.payload=="string"){let r=new TextEncoder;n.payload=r.encode(n.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ee(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,n.payload=await(async function(r,a,s){var o;let c=Pn(o=Array.from(s)).call(o,(S,T)=>S+T,0),d={serverTs:0,seq:tR++,length:s.length,checkSum:c},l=new Uint8Array(pO(c,2)),h=new ArrayBuffer(Cg),_=new DataView(h);_.setUint32(0,d.serverTs),_.setUint16(4,d.seq),_.setUint16(6,d.length),_.setUint16(8,d.checkSum);let f=16-s.length%16;s=p1(s,new Uint8Array(f));let m=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:eR,additionalData:l},a,s);return p1(new Uint8Array(h),new Uint8Array(m))})(this._encryptDataStreamIv,this._encryptDataStreamKey,n.payload)),new Blob([n.payload]).size>1024)throw new J(M.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ne.DATA_STREAM,{payload:xc(n.payload),syncWithAudio:n.syncWithAudio,sendTs:Date.now()-oj},!t)}sendMetadata(n){if(!this._joinInfo)throw new J(M.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([n]).size>1024)throw new J(M.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ne.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:xc(n)})}async sendCustomReportMessage(n){if(Array.isArray(n)||(n=[n]),n.forEach(AB),!this._joinInfo)throw new J(M.INVALID_OPERATION,"can not send custom report, not joined");await Te.sendCustomReportMessage(this._joinInfo.sid,n)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let n=this._statsCollector.getRemoteNetworkQualityStats();if(B("DELETE_NEQ_AFTER_USER_LEAVE")){let e=this._users.map(t=>t.uid+"");Object.keys(n).forEach(t=>{ee(e).call(e,t)||delete n[t]})}return n}async pickSVCLayer(n,e){gr(e.spatialLayer,"spatialLayer",[0,1,2,3]),gr(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(n,e)}catch(t){throw I.error("[".concat(this._clientId,"] pick SVC layer failed"),t.toString()),t}}async setRTMConfig(n){let{apRTM:e=!1,rtmFlag:t}=n;if(_e(e,"apRTM"),Bt(t,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=t,I.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(n)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=t,this._gateway.setRTM2Flag(t)}_reset(){if(I.debug("[".concat(this._clientId,"] reset client")),(function(n){let e=vl.indexOf(n);e!==-1&&vl.splice(e,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=mr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&p0(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Te.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy(),n._dataChannels&&(n._dataChannels.forEach(e=>e._close()),n._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new xa("client-publish",this._clientId),this._subscribeMutex=new xa("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(n,e){var t;let i=n||Mi();n?I.debug("[".concat(this._clientId,"] new Session ").concat(i)):I.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));let r=n?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Te.addSid(i);let a={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:e?.stringUid||((t=this._joinInfo)===null||t===void 0?void 0:t.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};Te.sessionInit(this._sessionId,Vd({cname:e.channel,appid:e.appId},a)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(n){if(!this._joinInfo||this._uid===void 0)throw new J(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new J(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");I.debug("[".concat(this._clientId,"] publish high stream"));try{let t=await this._p2pChannel.publish(n,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let i=(await t.next()).value;if(i){try{await this._gateway.sendExtensionMessage(kr.PUBLISH,i,!0)}catch(r){throw t.throw(r),r}await t.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let i=(await t.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==M.DISCONNECT_P2P)throw t.throw(a),a}await t.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let r of n)r instanceof Ai&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(a=>{I.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,t?.code,n),t?.code===M.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new J(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(M.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));I.debug("[".concat(this._clientId,"] publish low stream"));let n=this._configDistribute.getLowStreamConfigDistribute();n&&n.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&n.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=n.bitrate));try{let t=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await t.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==M.DISCONNECT_P2P)throw t.throw(a),a}t.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,t?.code,void 0,!0),t?.code===M.WS_ABORT)return;throw t}}_createLiveStreamingClient(n){let e=()=>{if(!this._joinInfo||!this._appId)return new J(M.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},jo("LiveStreaming").create(i));var i;return t.onLiveStreamError=(r,a)=>{Te.reportApiInvoke(this._sessionId,{name:Jr.ON_LIVE_STREAM_ERROR,options:[r,a],tag:Gt.TRACER}).onSuccess(),this.safeEmit(ri.LIVE_STREAMING_ERROR,r,a)},t.onLiveStreamWarning=(r,a)=>{Te.reportApiInvoke(this._sessionId,{name:Jr.ON_LIVE_STREAM_WARNING,options:[r,a],tag:Gt.TRACER}).onSuccess(),this.safeEmit(ri.LIVE_STREAMING_WARNING,r,a)},t.on(Jh.REQUEST_WORKER_MANAGER_LIST,(r,a,s)=>{if(!this._joinInfo)return s(new J(M.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(o,c,d,l){let h=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(_=>c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap"));return await UU(h,o,c,d,l)})(r,this._joinInfo,this._axiosCancelSource.token,Yr).then(a).catch(s)}),t};return n===Cl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new J(M.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),i=(n={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:t}},jo("ChannelMediaRelay").create(n));i.on("state",r=>{r===oa.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(ri.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(ri.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,a)=>{var s;r==="resolution"&&((s=this._channelMediaRelayClient)===null||s===void 0||s.setVideoProfile(a))}}var n;return this._channelMediaRelayClient}_handleUpdateDataChannel(n,e){let{added:t,deleted:i}=n,r=[];if(e){let a=[];this._users.forEach(s=>{s._dataChannels.forEach(o=>{t.every(c=>c.uid!==s._uintid||c.stream_id!==o.id)&&a.push({uid:s._uintid,stream_id:o.id,ordered:o.ordered,max_retrans_times:o.maxRetransmits,metadata:o.metadata})})}),a.length>0&&this._handleUpdateDataChannel({added:[],deleted:a})}Array.isArray(t)&&t.length>0&&t.forEach(a=>{let{uid:s,stream_id:o,ordered:c,max_retrans_times:d,metadata:l}=a,h=this._users.find(_=>_._uintid===s);if(!h)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(I.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(s)),ee(r).call(r,h)||r.push(h),h._uintid||(h._uintid=s),h._dataChannels.findIndex(_=>_.id===a.stream_id)===-1){let _={id:o,ordered:!!c,maxRetransmits:d,metadata:l},f=(function(m){return ip(m,!0)})(_);h._dataChannels.push(f),I.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published datachannel")),e||this.safeEmit(ri.USER_PUBLISHED,h,"datachannel",_)}this._p2pChannel.hasPendingRemoteDataChannel(h,a.stream_id)&&(I.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(h.uid," after reconnect.")),this._subscribeDataChannel(h,a.stream_id).catch(_=>{I.error("[".concat(this._clientId,"] resubscribe datachannel error"),_.toString())}))}),e&&(this.safeEmit(ri.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(a=>{let{uid:s,stream_id:o}=a,c=this._users.find(l=>l._uintid===s);if(!c)return void I.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let d=c._dataChannels.find(l=>l.id===a.stream_id);d&&(I.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(s)),this._p2pChannel.unsubscribeDataChannel(c,[d]).then(l=>{if(c._dataChannels=c._dataChannels.filter(h=>h!==d),l)return this._gateway.unsubscribeDataChannel(l,c.uid)}),I.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished datachannel ,id:").concat(d.id)),this.safeEmit(ri.USER_UNPUBLISHED,c,"datachannel",d._config))})}_getEncodingName(n){var e;if(!this._joinResponse)return;let t=(e=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||e===void 0?void 0:e.videoCodecs;if(t)for(let r of t){var i;if(r.payloadType===n)return r==null||(i=r.rtpMap)===null||i===void 0?void 0:i.encodingName}}_handleRemoveDataChannels(n){let e=this._users.find(t=>t.uid===n.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){I.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(n.uid));let t=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(ri.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),t()}}else I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Vt.UPDATE_GATEWAY_CONFIG,()=>{(function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void I.error("Error loading sdk config",e.message)}if(n)try{let e=JSON.parse(window.atob(n)),t=Date.now();Object.keys(e).forEach(i=>{let{value:r,type:a,expires:s}=e[i];s&&s<=t||a||u_()||!Object.prototype.hasOwnProperty.call(Qn,i)||(ml[i]=r,dr[i]=r,I.debug("Update gateway parameters from config distribute",i,r))})}catch(e){I.error("Error update config from local cache",e.message)}})()}),this._gateway.on(Vt.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Vt.CONNECTION_STATE_CHANGE,(n,e,t)=>{var i;if(t===Vi.FALLBACK)return;let r=()=>{this.safeEmit(ri.CONNECTION_STATE_CHANGE,n,e,t)};if(Te.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Jr.CONNECTION_STATE_CHANGE,options:[n,e,t],tag:Gt.TRACER}).onSuccess(JSON.stringify({cur:n,prev:e,reason:t})),I.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(n)),n==="DISCONNECTED")return this._reset(),void r();if(n==="RECONNECTING")this._users.forEach(s=>{s._trust_in_room_=!1,s._trust_audio_enabled_state_=!1,s._trust_video_enabled_state_=!1,s._trust_audio_mute_state_=!1,s._trust_video_mute_state_=!1,s._trust_audio_stream_added_state_=!1,s._trust_video_stream_added_state_=!1,s._is_pre_created||(s._audio_pre_subscribed||(s._audioSSRC=void 0,s._audioOrtc=void 0),s._video_pre_subscribed||(s._videoSSRC=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),s._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(n==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((s,o)=>{this._gateway.setStreamFallbackOption(o,s).catch(c=>{I.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),c)})}),this._remoteStreamTypeCacheMap.forEach((s,o)=>{this._gateway.setRemoteVideoStreamType(o,s).catch(c=>{I.warning("[".concat(this._clientId,"] auto set remote stream type failed"),c)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{I.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(s=>{I.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(s))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(s=>!s._trust_in_room_).forEach(s=>{I.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(s.uid)),this._handleUserOffline({uid:s.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(s=>{s._trust_audio_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(s.uid)),this._handleMuteStream(s.uid,ze.AUDIO,!1)),s._trust_video_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(s.uid)),this._handleMuteStream(s.uid,ze.VIDEO,!1)),s._trust_audio_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(s.uid)),this._handleSetStreamLocalEnable("audio",s.uid,!0)),s._trust_video_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(s.uid)),this._handleSetStreamLocalEnable("video",s.uid,!0)),s._trust_video_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(s.uid)),this._handleResetAddStream(s,"video")),s._trust_audio_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(s.uid)),this._handleResetAddStream(s,"audio")),s._video_added_||s._audio_added_||(I.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(s.uid)),this._handleRemoveStream({uid:s.uid,uint_id:s._uintid}))}))},1e3))}r()}),this._gateway.on(Vt.REQUEST_NEW_GATEWAY_LIST,async(n,e)=>{if(!this._joinInfo)return e(new J(M.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t,i=await ox(Vd(Vd({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(t=i.ap,dx(i),this._joinInfo.preload=!0):(t=await WU(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);let r=[];t.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:s}=a,[o,c]=s.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:o,port:c}):r.push({host:o,port:c})}),n(r)}catch(t){e(t)}}),this._gateway.on(Vt.NETWORK_QUALITY,n=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(ri.NETWORK_QUALITY,n)}),this._gateway.on(Vt.STREAM_TYPE_CHANGE,(n,e)=>{this.safeEmit(ri.STREAM_TYPE_CHANGED,n,e),Te.reportApiInvoke(this._sessionId,{name:Jr.STREAM_TYPE_CHANGE,options:[n,e],tag:Gt.TRACER}).onSuccess(JSON.stringify({uid:n,streamType:e}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Vt.IS_P2P_DISCONNECTED,n=>{this._p2pChannel.isP2PDisconnected()?n(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?n(!1):n(!0)}),this._gateway.on(Vt.REQUEST_P2P_CONNECTION_PARAMS,async(n,e,t)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(n)),e(i)}catch(i){t(i)}}),this._gateway.on(Vt.JOIN_RESPONSE,(n,e)=>{if(this.store.useP2P)return;let t;this._joinResponse=n,n.attributes?t=n.attributes.userAttributes.preSubSsrcs:I.debug("no attributes in joinResponse");let i=AU(n.ortc,e,t);this._p2pChannel.connect(i)}),this._gateway.on(Vt.PRE_CONNECT_PC,async n=>{let{candidates:e,fingerprint:t,turnServer:i}=n;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){let{cert:a,cid:s}=this._joinInfo.apResponse,o="".concat(s,"_").concat(a);if(o.length<4||o.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var r;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(a),icePwd:"".concat(s,"_").concat(a)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=B("FINGERPRINT"))!==null&&r!==void 0?r:t}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(c){c.code&&c.code===M.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on($t.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on($t.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on($t.ON_ADD_AUDIO_STREAM,n=>this._handleAddAudioOrVideoStream("audio",n.uid,n.ssrcId,n.cname,n.pt,n.uint_id,n.ortc)),this._gateway.signal.on($t.ON_ADD_VIDEO_STREAM,n=>this._handleAddAudioOrVideoStream("video",n.uid,n.ssrcId,n.cname,n.pt,n.uint_id,n.ortc,n.rtxSsrcId)),this._gateway.signal.on($t.ON_REMOTE_DATASTREAM_UPDATE,n=>{this._handleUpdateDataChannel(n)}),this._gateway.signal.on($t.ON_REMOTE_FULL_DATASTREAM_INFO,n=>{this._handleUpdateDataChannel({added:n.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on($t.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on($t.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on($t.MUTE_AUDIO,n=>this._handleMuteStream(n.uid,ze.AUDIO,!0)),this._gateway.signal.on($t.UNMUTE_AUDIO,n=>this._handleMuteStream(n.uid,ze.AUDIO,!1)),this._gateway.signal.on($t.MUTE_VIDEO,n=>this._handleMuteStream(n.uid,ze.VIDEO,!0)),this._gateway.signal.on($t.UNMUTE_VIDEO,n=>this._handleMuteStream(n.uid,ze.VIDEO,!1)),this._gateway.signal.on($t.RECEIVE_METADATA,n=>{let e=Uc(n.metadata);this.safeEmit(ri.RECEIVE_METADATA,n.uid,e)}),this._gateway.signal.on($t.ON_DATA_STREAM,async n=>{var e;if(!n)return;let t=Uc(n.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ee(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(n.payload.length<Cg)throw new J(M.UNEXPECTED_RESPONSE,"payload length ".concat(n.payload.length," is less than header length ").concat(Cg));t=await(async function(r,a,s){let o=s.subarray(0,Cg),c=o.slice(8,Cg),d=(c[0]<<8)+c[1],l=(o[6]<<8)+o[7],h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:r,tagLength:eR,additionalData:new Uint8Array(pO(d,2))},a,s.subarray(Cg));return new Uint8Array(h).subarray(0,l)})(this._encryptDataStreamIv,this._encryptDataStreamKey,t)}let i=0;if(n.ordered||n.syncWithAudio){let r=this._p2pChannel.getStats(),a=this.remoteUsers.find(o=>o.uid===n.uid);i=r?.audioRecv.find(o=>o.ssrc===a?._audioSSRC)?.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),cj(Vd(Vd({},n),{},{payload:t}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on($t.ON_CRYPT_ERROR,()=>{r_(()=>{I.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ri.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on($t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{I.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Vi.TOKEN_EXPIRE),this.safeEmit(ri.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on($t.ON_STREAM_FALLBACK_UPDATE,n=>{I.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(n.stream_id,", attr: ").concat(n.stream_type)),this.safeEmit(ri.STREAM_FALLBACK,n.stream_id,n.stream_type===1?"fallback":"recover")}),this._gateway.signal.on($t.ON_PUBLISH_STREAM,n=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:n.proxy})),I.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(n))))}),this._gateway.signal.on($t.ENABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!0)}),this._gateway.signal.on($t.DISABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!1)}),this._gateway.signal.on(et.REQUEST_TIMEOUT,(n,e)=>{if(this._joinInfo)switch(n){case Ne.PUBLISH:{if(!e)return;let r=e.ortc;if(r){var t,i;let a=r.some(c=>{let{stream_type:d}=c;return d===Ni.Audio}),s=r.some(c=>{let{stream_type:d}=c;return d!==Ni.Audio}),o=r.some(c=>{let{stream_type:d}=c;return d===Ni.Screen||d===Ni.ScreenLow});e.state==="offer"&&Te.publish(this._joinInfo.sid,{eventElapse:Ia.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:M.TIMEOUT,audio:a,video:s,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:o,audioName:a?(t=r.find(c=>{let{stream_type:d}=c;return d===Ni.Audio}))===null||t===void 0||(t=t.ssrcs[0])===null||t===void 0?void 0:t.ssrcId.toString():void 0,videoName:s?(i=r.find(c=>{let{stream_type:d}=c;return d!==Ni.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Ne.SUBSCRIBE:e&&Te.subscribe(this._joinInfo.sid,{succ:!1,ec:M.TIMEOUT,audio:e.stream_type===ze.AUDIO,video:e.stream_type===ze.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:Ia.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on($t.ON_P2P_OK,n=>{this.uid,this._uid}),this._gateway.signal.on($t.ON_PUBLISHED_USER_LIST,n=>{if(n==null||!n.users)return;B("BLOCK_LOCAL_CLIENT")&&(n.users=n.users.filter(i=>!yl(i.string_id||i.stream_id,this.channelName)));let e=[],t=[];for(let i of n.users){let r=this._users.find(l=>l._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new g_(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.store.firstVideoFrameDecoded(r.uid,{userJoinNotify:Date.now()}),this.getListeners(ri.PUBLISHED_USER_LIST).length===0&&(I.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(ri.USER_JOINED,r)));let a=Dn.Audio&i.stream_type,s=(Dn.Video|Dn.LwoVideo)&i.stream_type,o=(65280&i.stream_type)!=0,c=a&&r.hasAudio,d=s&&r.hasVideo;s&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),a&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),a&&!c&&this.getListeners(ri.PUBLISHED_USER_LIST).length===0&&(I.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(ri.USER_PUBLISHED,r,"audio")),s&&!d&&this.getListeners(ri.PUBLISHED_USER_LIST).length===0&&(I.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(ri.USER_PUBLISHED,r,"video")),(a&&!c||s&&!d||o)&&e.push(r),s&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&t.push({user:r,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&t.push({user:r,mediaType:"audio"})}t.length>0&&(I.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(t.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(t).catch(i=>{I.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(ri.PUBLISHED_USER_LIST).length>0?B("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(I.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(ri.PUBLISHED_USER_LIST,e)):I.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on($t.ON_RTP_CAPABILITY_CHANGE,n=>{let{video_codec:e}=n;this._p2pChannel instanceof EE&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(t=>t.toLowerCase()).filter(t=>{var i;return ee(i=Object.keys(bt)).call(i,t)}))})}_handleP2PEvents(){this._gateway.signal.on($t.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(kr.PUBLISH,(n,e,t)=>{let{uid:i}=n;n.forEach(r=>{let{kind:a,ssrcs:s,mid:o,isMuted:c}=r;this._handleP2PAddAudioOrVideoStream(a,i,s[0].ssrcId,o);let d=this._users.find(l=>l.uid===i);return d&&this.store.useP2P?this._p2pChannel.mockSubscribe(d,a,s[0].ssrcId,o).then(()=>{e()}).catch(t):e(),this._handleMuteStream(i,a,!!c)})}),this._gateway.signal.on(kr.CALL,async(n,e,t)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},n))}catch(r){t(r)}}),this._gateway.signal.on(et.P2P_CONNECTION,async n=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(n)}),this._gateway.signal.on(kr.UNPUBLISH,async(n,e,t)=>{if(this.store.useP2P){let{unpubMsg:i,uid:r}=n,a=this._users.find(s=>s.uid===r);if(!a)return I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async s=>{let{stream_type:o}=s,c=o===Ni.Audio?ze.AUDIO:ze.VIDEO;await this._p2pChannel.unsubscribe(a,c),this._handleMuteStream(r,c,!0)}),e()}catch(s){t(s)}}}),this._gateway.signal.on(kr.CONTROL,async(n,e)=>{let{action:t}=n;switch(t){case Pd.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,ze.VIDEO,!0);break;case Pd.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,ze.AUDIO,!0);break;case Pd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,ze.VIDEO,!1);break;case Pd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,ze.AUDIO,!1)}}),this._gateway.signal.on(kr.RESTART_ICE,async(n,e,t)=>{if(this.store.useP2P)try{let{direction:i,iceParameter:r}=n;i!==Dt.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){t(i)}}),this._gateway.signal.on(kr.CANDIDATE,n=>{if(this.store.useP2P){let{candidate:e,direction:t}=n;this._p2pChannel.addRemoteCandidate(e,t)}}),this._p2pChannel.on(Ue.RequestP2PRestartICE,async(n,e,t)=>{try{let{direction:i}=n;e(await this._gateway.sendExtensionMessage(kr.RESTART_ICE,n,i===Dt.SEND_ONLY))}catch(i){t(i)}}),this._p2pChannel.on(Ue.LocalCandidate,n=>{this._gateway.sendExtensionMessage(kr.CANDIDATE,JSON.stringify(n),!0)}),this._p2pChannel.on(Ue.RequestP2PMuteLocal,async(n,e,t)=>{try{await this._gateway.sendExtensionMessage(kr.CONTROL,n,!0),e()}catch(i){t(i)}}),this._p2pChannel.on(Ue.RequestP2PUnmuteRemote,async(n,e,t)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(n,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===M.DISCONNECT_P2P?e():t(i)}else e()}),this._p2pChannel.on(Ue.RequestP2PMuteRemote,async(n,e,t)=>{if(this._joinInfo)try{await this._gateway.muteRemote(n,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===M.DISCONNECT_P2P?e():t(i)}else e()}),this._p2pChannel.on(Ue.StateChange,(n,e)=>{e===Ee.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ue.PeerConnectionStateChange,n=>{let e=this._peerConnectionState;n!==e&&(this.safeEmit(ri.PEERCONNECTION_STATE_CHANGE,n,e),this._peerConnectionState=n)}),this._p2pChannel.on(Ue.RequestMuteLocal,async(n,e,t)=>{if(this._joinInfo)try{await this._gateway.muteLocal(n,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===M.DISCONNECT_P2P?e():t(i)}else e()}),this._p2pChannel.on(Ue.RequestUnmuteLocal,async(n,e,t)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(n,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===M.DISCONNECT_P2P?e():t(i)}else e()}),this._p2pChannel.on(Ue.RequestRePublish,(n,e,t)=>{this.publish(n,!1).then(e).catch(t)}),this._p2pChannel.on(Ue.RequestRePublishDataChannel,(n,e,t)=>{se.all(n.map(async i=>{let r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(a=>{this._uid&&this._gateway.publishDataChannel(this._uid,a,!0)})}catch(a){if(a.code!==M.DISCONNECT_P2P)throw a}})).then(e).catch(t)}),this._p2pChannel.on(Ue.RequestReSubscribe,async(n,e,t)=>{try{for(let{user:i,kind:r}of n)r===ze.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){t(i)}}),this._p2pChannel.on(Ue.RequestUpload,(n,e)=>{this._gateway.upload(n,e)}),this._p2pChannel.on(Ue.RequestUploadStats,n=>{this._gateway.uploadWRTCStats(n)}),this._p2pChannel.on(Ue.MediaReconnectStart,n=>{this.safeEmit(ri.MEDIA_RECONNECT_START,n)}),this._p2pChannel.on(Ue.MediaReconnectEnd,n=>{this.safeEmit(ri.MEDIA_RECONNECT_END,n)}),this._p2pChannel.on(Ue.NeedSignalRTT,n=>{n(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ue.RequestRestartICE,async n=>{if(this.store.useP2P)return;let e=await this._p2pChannel.restartICE(n),t=await e.next();if(t.done)return;let i=t.value,r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(s){return void e.throw(s)}let{iceParameters:a}=(function(s){let o=s.iceParameters;return{iceParameters:{iceUfrag:o.iceUfrag,icePwd:o.icePwd}}})(r);await e.next({remoteIceParameters:a})}),this._p2pChannel.on(Ue.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ue.RequestReconnectPC,async()=>{var n;let{iceParameters:e,dtlsParameters:t,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer}),{gatewayEstablishParams:r,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:t,rtpCapabilities:i}),s=AU(r,a);await this._p2pChannel.connect(s),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ue.RequestUnpublishForReconnectPC,async(n,e,t)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(n,this._uid),e()):t()}),this._p2pChannel.on(Ue.P2PLost,()=>{this.safeEmit(ri.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ue.UpdateVideoEncoder,n=>{n._encoderConfig&&this._gateway.setVideoProfile(n._encoderConfig)}),this._p2pChannel.on(Ue.ConnectionTypeChange,n=>{this.safeEmit(ri.IS_USING_CLOUD_PROXY,n)}),this._p2pChannel.on(Ue.RequestLowStreamParameter,n=>{n(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ue.QueryClientConnectionState,n=>{n(this.connectionState)}),this._p2pChannel.on(Ue.AudioMetadata,n=>{this.safeEmit(ri.AUDIO_METADATA,n)}),this._p2pChannel.on(Ue.AudioPts,n=>{this.safeEmit(ri.AUDIO_PTS,Number(n))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(n){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let t=(e={config:n},jo("ContentInspect").create(e));this._inspect=t,this.handleVideoInspectEvents(t);let{appId:i,cname:r,sid:a,token:s,uid:o,cid:c,vid:d}=this._joinInfo;await t.init({appId:i,areaCode:"",cname:r,sid:a,token:s,uid:o,cid:c,vid:d?Number(d):0},Yr)}catch(t){throw Array.isArray(t)?t[0]:t}var e}handleVideoInspectEvents(n){n.on(Lr.CONNECTION_STATE_CHANGE,(e,t)=>{if(this.safeEmit(ri.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,t),t===it.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(ri.CONTENT_INSPECT_ERROR,new J(M.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));n.inspectImage()}}),n.on(Lr.INSPECT_RESULT,(e,t)=>{var i;if(t?.code===M.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return I.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(ri.CONTENT_INSPECT_RESULT,e,t)}),n.on(Lr.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(t=>t.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}async setImageModeration(n,e){if(_e(n,"enabled"),n){if(!e)throw new J(M.INVALID_PARAMS,"config is required");if(m0(e),!this._joinInfo)throw new J(M.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{let i=(t={config:e},jo("ImageModeration").create(t));this._moderation=i,this.handleImageModerationEvents(i);let{appId:r,cname:a,sid:s,token:o,uid:c,cid:d,vid:l}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:a,sid:s,token:o,uid:c,cid:d,vid:l?Number(l):0},Yr)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var t;if(!this._moderation)throw new J(M.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(n){n.on(Aa.CONNECTION_STATE_CHANGE,(e,t)=>{if(this.safeEmit(ri.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,t),e===Fa.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new J(M.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");n.inspectImage()}}),n.on(Aa.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(t=>t.trackMediaType==="video")[0])})}setP2PTransport(n){if((function(e){gr(e,"transport",["default","auto","relay","sd-rtn"])})(n),this.mode!=="p2p")throw new J(M.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=n,I.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(n))}getJoinChannelServiceRecords(){return I.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(n){_e(n,"enabled"),Ct("ENABLE_PUBLISH_AUDIO_FILTER",n),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(n)}_handleResetAddStream(n,e){switch(e){case"audio":n._audio_added_=!1,n._trust_audio_stream_added_state_=!0;break;case"video":n._video_added_=!1,n._trust_video_stream_added_state_=!0}}},$e(Ke.prototype,"leave",[_j],Object.getOwnPropertyDescriptor(Ke.prototype,"leave"),Ke.prototype),$e(Ke.prototype,"publish",[gx],Object.getOwnPropertyDescriptor(Ke.prototype,"publish"),Ke.prototype),$e(Ke.prototype,"unpublish",[Sx],Object.getOwnPropertyDescriptor(Ke.prototype,"unpublish"),Ke.prototype),$e(Ke.prototype,"subscribe",[Tx],Object.getOwnPropertyDescriptor(Ke.prototype,"subscribe"),Ke.prototype),$e(Ke.prototype,"presubscribe",[Rx],Object.getOwnPropertyDescriptor(Ke.prototype,"presubscribe"),Ke.prototype),$e(Ke.prototype,"massSubscribe",[vx],Object.getOwnPropertyDescriptor(Ke.prototype,"massSubscribe"),Ke.prototype),$e(Ke.prototype,"unsubscribe",[yx],Object.getOwnPropertyDescriptor(Ke.prototype,"unsubscribe"),Ke.prototype),$e(Ke.prototype,"massUnsubscribe",[Cx],Object.getOwnPropertyDescriptor(Ke.prototype,"massUnsubscribe"),Ke.prototype),$e(Ke.prototype,"setLowStreamParameter",[bx],Object.getOwnPropertyDescriptor(Ke.prototype,"setLowStreamParameter"),Ke.prototype),$e(Ke.prototype,"enableDualStream",[Ax],Object.getOwnPropertyDescriptor(Ke.prototype,"enableDualStream"),Ke.prototype),$e(Ke.prototype,"disableDualStream",[Ix],Object.getOwnPropertyDescriptor(Ke.prototype,"disableDualStream"),Ke.prototype),$e(Ke.prototype,"setClientRole",[wx],Object.getOwnPropertyDescriptor(Ke.prototype,"setClientRole"),Ke.prototype),$e(Ke.prototype,"_setClientRoleOptions",[Ox],Object.getOwnPropertyDescriptor(Ke.prototype,"_setClientRoleOptions"),Ke.prototype),$e(Ke.prototype,"setProxyServer",[Nx],Object.getOwnPropertyDescriptor(Ke.prototype,"setProxyServer"),Ke.prototype),$e(Ke.prototype,"setTurnServer",[Dx],Object.getOwnPropertyDescriptor(Ke.prototype,"setTurnServer"),Ke.prototype),$e(Ke.prototype,"setLicense",[Px],Object.getOwnPropertyDescriptor(Ke.prototype,"setLicense"),Ke.prototype),$e(Ke.prototype,"startProxyServer",[Lx],Object.getOwnPropertyDescriptor(Ke.prototype,"startProxyServer"),Ke.prototype),$e(Ke.prototype,"stopProxyServer",[kx],Object.getOwnPropertyDescriptor(Ke.prototype,"stopProxyServer"),Ke.prototype),$e(Ke.prototype,"setLocalAccessPointsV2",[Mx],Object.getOwnPropertyDescriptor(Ke.prototype,"setLocalAccessPointsV2"),Ke.prototype),$e(Ke.prototype,"setLocalAccessPoints",[Ux],Object.getOwnPropertyDescriptor(Ke.prototype,"setLocalAccessPoints"),Ke.prototype),$e(Ke.prototype,"setRemoteDefaultVideoStreamType",[xx],Object.getOwnPropertyDescriptor(Ke.prototype,"setRemoteDefaultVideoStreamType"),Ke.prototype),$e(Ke.prototype,"setRemoteVideoStreamType",[Vx],Object.getOwnPropertyDescriptor(Ke.prototype,"setRemoteVideoStreamType"),Ke.prototype),$e(Ke.prototype,"setStreamFallbackOption",[Fx],Object.getOwnPropertyDescriptor(Ke.prototype,"setStreamFallbackOption"),Ke.prototype),$e(Ke.prototype,"setEncryptionConfig",[Bx],Object.getOwnPropertyDescriptor(Ke.prototype,"setEncryptionConfig"),Ke.prototype),$e(Ke.prototype,"renewToken",[jx],Object.getOwnPropertyDescriptor(Ke.prototype,"renewToken"),Ke.prototype),$e(Ke.prototype,"enableAudioVolumeIndicator",[Gx],Object.getOwnPropertyDescriptor(Ke.prototype,"enableAudioVolumeIndicator"),Ke.prototype),$e(Ke.prototype,"startLiveStreaming",[Wx],Object.getOwnPropertyDescriptor(Ke.prototype,"startLiveStreaming"),Ke.prototype),$e(Ke.prototype,"setLiveTranscoding",[Hx],Object.getOwnPropertyDescriptor(Ke.prototype,"setLiveTranscoding"),Ke.prototype),$e(Ke.prototype,"stopLiveStreaming",[Kx],Object.getOwnPropertyDescriptor(Ke.prototype,"stopLiveStreaming"),Ke.prototype),$e(Ke.prototype,"startChannelMediaRelay",[Yx],Object.getOwnPropertyDescriptor(Ke.prototype,"startChannelMediaRelay"),Ke.prototype),$e(Ke.prototype,"updateChannelMediaRelay",[zx],Object.getOwnPropertyDescriptor(Ke.prototype,"updateChannelMediaRelay"),Ke.prototype),$e(Ke.prototype,"stopChannelMediaRelay",[qx],Object.getOwnPropertyDescriptor(Ke.prototype,"stopChannelMediaRelay"),Ke.prototype),$e(Ke.prototype,"sendCustomReportMessage",[Xx],Object.getOwnPropertyDescriptor(Ke.prototype,"sendCustomReportMessage"),Ke.prototype),$e(Ke.prototype,"pickSVCLayer",[Jx],Object.getOwnPropertyDescriptor(Ke.prototype,"pickSVCLayer"),Ke.prototype),$e(Ke.prototype,"setRTMConfig",[Zx],Object.getOwnPropertyDescriptor(Ke.prototype,"setRTMConfig"),Ke.prototype),$e(Ke.prototype,"enableContentInspect",[Qx],Object.getOwnPropertyDescriptor(Ke.prototype,"enableContentInspect"),Ke.prototype),$e(Ke.prototype,"disableContentInspect",[$x],Object.getOwnPropertyDescriptor(Ke.prototype,"disableContentInspect"),Ke.prototype),$e(Ke.prototype,"setImageModeration",[eV],Object.getOwnPropertyDescriptor(Ke.prototype,"setImageModeration"),Ke.prototype),$e(Ke.prototype,"setP2PTransport",[tV],Object.getOwnPropertyDescriptor(Ke.prototype,"setP2PTransport"),Ke.prototype),$e(Ke.prototype,"getJoinChannelServiceRecords",[iV],Object.getOwnPropertyDescriptor(Ke.prototype,"getJoinChannelServiceRecords"),Ke.prototype),$e(Ke.prototype,"setPublishAudioFilterEnabled",[rV],Object.getOwnPropertyDescriptor(Ke.prototype,"setPublishAudioFilterEnabled"),Ke.prototype),Ke);class nA{constructor(e,t){F(this,"id",0),F(this,"element",void 0),F(this,"peerPair",void 0),F(this,"context",void 0),F(this,"audioPlayerElement",void 0),F(this,"audioTrack",void 0),nA.count+=1,this.id=nA.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{let t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;let e=async(i,r)=>{let a=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new se(s=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&s(i.localDescription)}})},t=async(i,r)=>await i.setRemoteDescription(r);try{let i=await e(this.peerPair[0],"offer");await t(this.peerPair[1],i);let r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(i){throw new J(M.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(r){throw new J(M.LOCAL_AEC_ERROR,r.toString()).print()}if(!t)throw new J(M.LOCAL_AEC_ERROR,"no dest node when local aec").print();let i=t.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){I.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var BR,aA;F(nA,"count",0);let g0=window.AudioContext||window.webkitAudioContext,kH=new(BR=pt({report:Te}),$e((aA=class{constructor(){F(this,"units",[]),F(this,"context",void 0)}processExternalMediaAEC(n){if(!this._doesEnvironmentNeedAEC())return I.debug("the system does not need to process local aec"),-1;this.context||(this.context=new g0);let e=this.units.find(t=>t&&t.getElement()===n);return e||(e=new nA(n,this.context),this.units.push(e)),e.startEchoCancellation(),I.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return pi().name!==Ot.SAFARI}}).prototype,"processExternalMediaAEC",[BR],Object.getOwnPropertyDescriptor(aA.prototype,"processExternalMediaAEC"),aA.prototype),aA);function fj(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function nV(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fj(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):fj(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let S0=window||document;function T0(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!S0)return;let t=Cn._cspEventHandlerPointer;if(t&&e)return void console.error(t,e);let i=r=>{if(!(r&&r.blockedURI&&(Cn.onSecurityPolicyViolation||Cn.getListeners(Ku.SECURITY_POLICY_VIOLATION).length>0)))return;let a=r.blockedURI;B("CSP_DETECTED_HOSTNAME_LIST").some(s=>ee(a).call(a,s))&&(Cn.onSecurityPolicyViolation&&typeof Cn.onSecurityPolicyViolation=="function"&&Cn.onSecurityPolicyViolation(r),Cn.getListeners(Ku.SECURITY_POLICY_VIOLATION).length>0&&Cn.safeEmit(Ku.SECURITY_POLICY_VIOLATION,r))};t&&S0.removeEventListener("securitypolicyviolation",t),(e||n&&typeof n=="function"||Cn.getListeners(Ku.SECURITY_POLICY_VIOLATION).length>0)&&S0.addEventListener("securitypolicyviolation",i),Cn._cspEventHandlerPointer=i}var Ej=Be,MH=Bk,mj=RegExp.prototype,gj=function(n){return n===mj||Ej(mj,n)?MH(n):n.flags},Os=X(gj);function da(n){let e=n.length;for(;--e>=0;)n[e]=0}let gE=256,R0=286,jR=30,b_=15,Vg=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),GR=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),v0=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Sj=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cp=new Array(576);da(cp);let Fd=new Array(60);da(Fd);let A_=new Array(512);da(A_);let I_=new Array(256);da(I_);let Fg=new Array(29);da(Fg);let WR=new Array(jR);function HR(n,e,t,i,r){this.static_tree=n,this.extra_bits=e,this.extra_base=t,this.elems=i,this.max_length=r,this.has_stree=n&&n.length}let y0,aV,sV;function C0(n,e){this.dyn_tree=n,this.max_code=0,this.stat_desc=e}da(WR);let b0=n=>n<256?A_[n]:A_[256+(n>>>7)],KR=(n,e)=>{n.pending_buf[n.pending++]=255&e,n.pending_buf[n.pending++]=e>>>8&255},Hs=(n,e,t)=>{n.bi_valid>16-t?(n.bi_buf|=e<<n.bi_valid&65535,KR(n,n.bi_buf),n.bi_buf=e>>16-n.bi_valid,n.bi_valid+=t-16):(n.bi_buf|=e<<n.bi_valid&65535,n.bi_valid+=t)},Na=(n,e,t)=>{Hs(n,t[2*e],t[2*e+1])},$u=(n,e)=>{let t=0;do t|=1&n,n>>>=1,t<<=1;while(--e>0);return t>>>1},oV=(n,e,t)=>{let i=new Array(16),r,a,s=0;for(r=1;r<=b_;r++)s=s+t[r-1]<<1,i[r]=s;for(a=0;a<=e;a++){let o=n[2*a+1];o!==0&&(n[2*a]=$u(i[o]++,o))}},cV=n=>{let e;for(e=0;e<R0;e++)n.dyn_ltree[2*e]=0;for(e=0;e<jR;e++)n.dyn_dtree[2*e]=0;for(e=0;e<19;e++)n.bl_tree[2*e]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},dV=n=>{n.bi_valid>8?KR(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},lV=(n,e,t,i)=>{let r=2*e,a=2*t;return n[r]<n[a]||n[r]===n[a]&&i[e]<=i[t]},A0=(n,e,t)=>{let i=n.heap[t],r=t<<1;for(;r<=n.heap_len&&(r<n.heap_len&&lV(e,n.heap[r+1],n.heap[r],n.depth)&&r++,!lV(e,i,n.heap[r],n.depth));)n.heap[t]=n.heap[r],t=r,r<<=1;n.heap[t]=i},I0=(n,e,t)=>{let i,r,a,s,o=0;if(n.sym_next!==0)do i=255&n.pending_buf[n.sym_buf+o++],i+=(255&n.pending_buf[n.sym_buf+o++])<<8,r=n.pending_buf[n.sym_buf+o++],i===0?Na(n,r,e):(a=I_[r],Na(n,a+gE+1,e),s=Vg[a],s!==0&&(r-=Fg[a],Hs(n,r,s)),i--,a=b0(i),Na(n,a,t),s=GR[a],s!==0&&(i-=WR[a],Hs(n,i,s)));while(o<n.sym_next);Na(n,256,e)},w0=(n,e)=>{let t=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,a=e.stat_desc.elems,s,o,c,d=-1;for(n.heap_len=0,n.heap_max=573,s=0;s<a;s++)t[2*s]!==0?(n.heap[++n.heap_len]=d=s,n.depth[s]=0):t[2*s+1]=0;for(;n.heap_len<2;)c=n.heap[++n.heap_len]=d<2?++d:0,t[2*c]=1,n.depth[c]=0,n.opt_len--,r&&(n.static_len-=i[2*c+1]);for(e.max_code=d,s=n.heap_len>>1;s>=1;s--)A0(n,t,s);c=a;do s=n.heap[1],n.heap[1]=n.heap[n.heap_len--],A0(n,t,1),o=n.heap[1],n.heap[--n.heap_max]=s,n.heap[--n.heap_max]=o,t[2*c]=t[2*s]+t[2*o],n.depth[c]=(n.depth[s]>=n.depth[o]?n.depth[s]:n.depth[o])+1,t[2*s+1]=t[2*o+1]=c,n.heap[1]=c++,A0(n,t,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((l,h)=>{let _=h.dyn_tree,f=h.max_code,m=h.stat_desc.static_tree,S=h.stat_desc.has_stree,T=h.stat_desc.extra_bits,R=h.stat_desc.extra_base,C=h.stat_desc.max_length,b,N,k,P,U,W,z=0;for(P=0;P<=b_;P++)l.bl_count[P]=0;for(_[2*l.heap[l.heap_max]+1]=0,b=l.heap_max+1;b<573;b++)N=l.heap[b],P=_[2*_[2*N+1]+1]+1,P>C&&(P=C,z++),_[2*N+1]=P,N>f||(l.bl_count[P]++,U=0,N>=R&&(U=T[N-R]),W=_[2*N],l.opt_len+=W*(P+U),S&&(l.static_len+=W*(m[2*N+1]+U)));if(z!==0){do{for(P=C-1;l.bl_count[P]===0;)P--;l.bl_count[P]--,l.bl_count[P+1]+=2,l.bl_count[C]--,z-=2}while(z>0);for(P=C;P!==0;P--)for(N=l.bl_count[P];N!==0;)k=l.heap[--b],k>f||(_[2*k+1]!==P&&(l.opt_len+=(P-_[2*k+1])*_[2*k],_[2*k+1]=P),N--)}})(n,e),oV(t,d,n.bl_count)},O0=(n,e,t)=>{let i,r,a=-1,s=e[1],o=0,c=7,d=4;for(s===0&&(c=138,d=3),e[2*(t+1)+1]=65535,i=0;i<=t;i++)r=s,s=e[2*(i+1)+1],++o<c&&r===s||(o<d?n.bl_tree[2*r]+=o:r!==0?(r!==a&&n.bl_tree[2*r]++,n.bl_tree[32]++):o<=10?n.bl_tree[34]++:n.bl_tree[36]++,o=0,a=r,s===0?(c=138,d=3):r===s?(c=6,d=3):(c=7,d=4))},uV=(n,e,t)=>{let i,r,a=-1,s=e[1],o=0,c=7,d=4;for(s===0&&(c=138,d=3),i=0;i<=t;i++)if(r=s,s=e[2*(i+1)+1],!(++o<c&&r===s)){if(o<d)do Na(n,r,n.bl_tree);while(--o!=0);else r!==0?(r!==a&&(Na(n,r,n.bl_tree),o--),Na(n,16,n.bl_tree),Hs(n,o-3,2)):o<=10?(Na(n,17,n.bl_tree),Hs(n,o-3,3)):(Na(n,18,n.bl_tree),Hs(n,o-11,7));o=0,a=r,s===0?(c=138,d=3):r===s?(c=6,d=3):(c=7,d=4)}},hV=!1,pV=(n,e,t,i)=>{Hs(n,0+(i?1:0),3),dV(n),KR(n,t),KR(n,~t),t&&n.pending_buf.set(n.window.subarray(e,e+t),n.pending),n.pending+=t};var Tj=n=>{hV||((()=>{let e,t,i,r,a,s=new Array(16);for(i=0,r=0;r<28;r++)for(Fg[r]=i,e=0;e<1<<Vg[r];e++)I_[i++]=r;for(I_[i-1]=r,a=0,r=0;r<16;r++)for(WR[r]=a,e=0;e<1<<GR[r];e++)A_[a++]=r;for(a>>=7;r<jR;r++)for(WR[r]=a<<7,e=0;e<1<<GR[r]-7;e++)A_[256+a++]=r;for(t=0;t<=b_;t++)s[t]=0;for(e=0;e<=143;)cp[2*e+1]=8,e++,s[8]++;for(;e<=255;)cp[2*e+1]=9,e++,s[9]++;for(;e<=279;)cp[2*e+1]=7,e++,s[7]++;for(;e<=287;)cp[2*e+1]=8,e++,s[8]++;for(oV(cp,287,s),e=0;e<jR;e++)Fd[2*e+1]=5,Fd[2*e]=$u(e,5);y0=new HR(cp,Vg,257,R0,b_),aV=new HR(Fd,GR,0,jR,b_),sV=new HR(new Array(0),v0,0,19,7)})(),hV=!0),n.l_desc=new C0(n.dyn_ltree,y0),n.d_desc=new C0(n.dyn_dtree,aV),n.bl_desc=new C0(n.bl_tree,sV),n.bi_buf=0,n.bi_valid=0,cV(n)},UH=(n,e,t,i)=>{let r,a,s=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(o=>{let c,d=4093624447;for(c=0;c<=31;c++,d>>>=1)if(1&d&&o.dyn_ltree[2*c]!==0)return 0;if(o.dyn_ltree[18]!==0||o.dyn_ltree[20]!==0||o.dyn_ltree[26]!==0)return 1;for(c=32;c<gE;c++)if(o.dyn_ltree[2*c]!==0)return 1;return 0})(n)),w0(n,n.l_desc),w0(n,n.d_desc),s=(o=>{let c;for(O0(o,o.dyn_ltree,o.l_desc.max_code),O0(o,o.dyn_dtree,o.d_desc.max_code),w0(o,o.bl_desc),c=18;c>=3&&o.bl_tree[2*Sj[c]+1]===0;c--);return o.opt_len+=3*(c+1)+5+5+4,c})(n),r=n.opt_len+3+7>>>3,a=n.static_len+3+7>>>3,a<=r&&(r=a)):r=a=t+5,t+4<=r&&e!==-1?pV(n,e,t,i):n.strategy===4||a===r?(Hs(n,2+(i?1:0),3),I0(n,cp,Fd)):(Hs(n,4+(i?1:0),3),((o,c,d,l)=>{let h;for(Hs(o,c-257,5),Hs(o,d-1,5),Hs(o,l-4,4),h=0;h<l;h++)Hs(o,o.bl_tree[2*Sj[h]+1],3);uV(o,o.dyn_ltree,c-1),uV(o,o.dyn_dtree,d-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,s+1),I0(n,n.dyn_ltree,n.dyn_dtree)),cV(n),i&&dV(n)},xH=(n,e,t)=>(n.pending_buf[n.sym_buf+n.sym_next++]=e,n.pending_buf[n.sym_buf+n.sym_next++]=e>>8,n.pending_buf[n.sym_buf+n.sym_next++]=t,e===0?n.dyn_ltree[2*t]++:(n.matches++,e--,n.dyn_ltree[2*(I_[t]+gE+1)]++,n.dyn_dtree[2*b0(e)]++),n.sym_next===n.sym_end),VH=n=>{Hs(n,2,3),Na(n,256,cp),(e=>{e.bi_valid===16?(KR(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(n)},FH={_tr_init:Tj,_tr_stored_block:pV,_tr_flush_block:UH,_tr_tally:xH,_tr_align:VH},sA=(n,e,t,i)=>{let r=65535&n|0,a=n>>>16&65535|0,s=0;for(;t!==0;){s=t>2e3?2e3:t,t-=s;do r=r+e[i++]|0,a=a+r|0;while(--s);r%=65521,a%=65521}return r|a<<16|0};let oA=new Uint32Array((()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e})());var Ks=(n,e,t,i)=>{let r=oA,a=i+t;n^=-1;for(let s=i;s<a;s++)n=n>>>8^r[255&(n^e[s])];return-1^n},la={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},dp={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:N0,_tr_stored_block:_V,_tr_flush_block:fV,_tr_tally:SE,_tr_align:TE}=FH,{Z_NO_FLUSH:RE,Z_PARTIAL_FLUSH:vE,Z_FULL_FLUSH:BH,Z_FINISH:Dl,Z_BLOCK:Bd,Z_OK:Ys,Z_STREAM_END:zs,Z_STREAM_ERROR:eh,Z_DATA_ERROR:lp,Z_BUF_ERROR:EV,Z_DEFAULT_COMPRESSION:mV,Z_FILTERED:jH,Z_HUFFMAN_ONLY:D0,Z_RLE:P0,Z_FIXED:GH,Z_DEFAULT_STRATEGY:WH,Z_UNKNOWN:HH,Z_DEFLATED:L0}=dp,YR=286,gV=30,KH=19,YH=2*YR+1,zH=15,Bg=258,Go=262,Tc=42,Pl=113,th=666,ih=(n,e)=>(n.msg=la[e],e),yE=n=>2*n-(n>4?9:0),w_=n=>{let e=n.length;for(;--e>=0;)n[e]=0},CE=n=>{let e,t,i,r=n.w_size;e=n.hash_size,i=e;do t=n.head[--i],n.head[i]=t>=r?t-r:0;while(--e);e=r,i=e;do t=n.prev[--i],n.prev[i]=t>=r?t-r:0;while(--e)},bE=(n,e,t)=>(e<<n.hash_shift^t)&n.hash_mask,ps=n=>{let e=n.state,t=e.pending;t>n.avail_out&&(t=n.avail_out),t!==0&&(n.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),n.next_out),n.next_out+=t,e.pending_out+=t,n.total_out+=t,n.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},ea=(n,e)=>{fV(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,e),n.block_start=n.strstart,ps(n.strm)},Hi=(n,e)=>{n.pending_buf[n.pending++]=e},Ur=(n,e)=>{n.pending_buf[n.pending++]=e>>>8&255,n.pending_buf[n.pending++]=255&e},jg=(n,e,t,i)=>{let r=n.avail_in;return r>i&&(r=i),r===0?0:(n.avail_in-=r,e.set(n.input.subarray(n.next_in,n.next_in+r),t),n.state.wrap===1?n.adler=sA(n.adler,e,r,t):n.state.wrap===2&&(n.adler=Ks(n.adler,e,r,t)),n.next_in+=r,n.total_in+=r,r)},k0=(n,e)=>{let t,i,r=n.max_chain_length,a=n.strstart,s=n.prev_length,o=n.nice_match,c=n.strstart>n.w_size-Go?n.strstart-(n.w_size-Go):0,d=n.window,l=n.w_mask,h=n.prev,_=n.strstart+Bg,f=d[a+s-1],m=d[a+s];n.prev_length>=n.good_match&&(r>>=2),o>n.lookahead&&(o=n.lookahead);do if(t=e,d[t+s]===m&&d[t+s-1]===f&&d[t]===d[a]&&d[++t]===d[a+1]){a+=2,t++;do;while(d[++a]===d[++t]&&d[++a]===d[++t]&&d[++a]===d[++t]&&d[++a]===d[++t]&&d[++a]===d[++t]&&d[++a]===d[++t]&&d[++a]===d[++t]&&d[++a]===d[++t]&&a<_);if(i=Bg-(_-a),a=_-Bg,i>s){if(n.match_start=e,s=i,i>=o)break;f=d[a+s-1],m=d[a+s]}}while((e=h[e&l])>c&&--r!=0);return s<=n.lookahead?s:n.lookahead},Gg=n=>{let e=n.w_size,t,i,r;do{if(i=n.window_size-n.lookahead-n.strstart,n.strstart>=e+(e-Go)&&(n.window.set(n.window.subarray(e,e+e-i),0),n.match_start-=e,n.strstart-=e,n.block_start-=e,n.insert>n.strstart&&(n.insert=n.strstart),CE(n),i+=e),n.strm.avail_in===0)break;if(t=jg(n.strm,n.window,n.strstart+n.lookahead,i),n.lookahead+=t,n.lookahead+n.insert>=3)for(r=n.strstart-n.insert,n.ins_h=n.window[r],n.ins_h=bE(n,n.ins_h,n.window[r+1]);n.insert&&(n.ins_h=bE(n,n.ins_h,n.window[r+3-1]),n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<Go&&n.strm.avail_in!==0)},Wg=(n,e)=>{let t,i,r,a=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,s=0,o=n.strm.avail_in;do{if(t=65535,r=n.bi_valid+42>>3,n.strm.avail_out<r||(r=n.strm.avail_out-r,i=n.strstart-n.block_start,t>i+n.strm.avail_in&&(t=i+n.strm.avail_in),t>r&&(t=r),t<a&&(t===0&&e!==Dl||e===RE||t!==i+n.strm.avail_in)))break;s=e===Dl&&t===i+n.strm.avail_in?1:0,_V(n,0,0,s),n.pending_buf[n.pending-4]=t,n.pending_buf[n.pending-3]=t>>8,n.pending_buf[n.pending-2]=~t,n.pending_buf[n.pending-1]=~t>>8,ps(n.strm),i&&(i>t&&(i=t),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+i),n.strm.next_out),n.strm.next_out+=i,n.strm.avail_out-=i,n.strm.total_out+=i,n.block_start+=i,t-=i),t&&(jg(n.strm,n.strm.output,n.strm.next_out,t),n.strm.next_out+=t,n.strm.avail_out-=t,n.strm.total_out+=t)}while(s===0);return o-=n.strm.avail_in,o&&(o>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=o&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-o,n.strm.next_in),n.strstart),n.strstart+=o,n.insert+=o>n.w_size-n.insert?n.w_size-n.insert:o),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),s?4:e!==RE&&e!==Dl&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(r=n.window_size-n.strstart,n.strm.avail_in>r&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,r+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),r>n.strm.avail_in&&(r=n.strm.avail_in),r&&(jg(n.strm,n.window,n.strstart,r),n.strstart+=r,n.insert+=r>n.w_size-n.insert?n.w_size-n.insert:r),n.high_water<n.strstart&&(n.high_water=n.strstart),r=n.bi_valid+42>>3,r=n.pending_buf_size-r>65535?65535:n.pending_buf_size-r,a=r>n.w_size?n.w_size:r,i=n.strstart-n.block_start,(i>=a||(i||e===Dl)&&e!==RE&&n.strm.avail_in===0&&i<=r)&&(t=i>r?r:i,s=e===Dl&&n.strm.avail_in===0&&t===i?1:0,_V(n,n.block_start,t,s),n.block_start+=t,ps(n.strm)),s?3:1)},M0=(n,e)=>{let t,i;for(;;){if(n.lookahead<Go){if(Gg(n),n.lookahead<Go&&e===RE)return 1;if(n.lookahead===0)break}if(t=0,n.lookahead>=3&&(n.ins_h=bE(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),t!==0&&n.strstart-t<=n.w_size-Go&&(n.match_length=k0(n,t)),n.match_length>=3)if(i=SE(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=bE(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=bE(n,n.ins_h,n.window[n.strstart+1]);else i=SE(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(i&&(ea(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,e===Dl?(ea(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(ea(n,!1),n.strm.avail_out===0)?1:2},AE=(n,e)=>{let t,i,r;for(;;){if(n.lookahead<Go){if(Gg(n),n.lookahead<Go&&e===RE)return 1;if(n.lookahead===0)break}if(t=0,n.lookahead>=3&&(n.ins_h=bE(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,t!==0&&n.prev_length<n.max_lazy_match&&n.strstart-t<=n.w_size-Go&&(n.match_length=k0(n,t),n.match_length<=5&&(n.strategy===jH||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){r=n.strstart+n.lookahead-3,i=SE(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=r&&(n.ins_h=bE(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,i&&(ea(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(i=SE(n,0,n.window[n.strstart-1]),i&&ea(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(i=SE(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,e===Dl?(ea(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(ea(n,!1),n.strm.avail_out===0)?1:2};function Rc(n,e,t,i,r){this.good_length=n,this.max_lazy=e,this.nice_length=t,this.max_chain=i,this.func=r}let Qc=[new Rc(0,0,0,0,Wg),new Rc(4,4,8,4,M0),new Rc(4,5,16,8,M0),new Rc(4,6,32,32,M0),new Rc(4,4,16,16,AE),new Rc(8,16,32,32,AE),new Rc(8,16,128,128,AE),new Rc(8,32,128,256,AE),new Rc(32,128,258,1024,AE),new Rc(32,258,258,4096,AE)];function cA(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=L0,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*YH),this.dyn_dtree=new Uint16Array(2*(2*gV+1)),this.bl_tree=new Uint16Array(2*(2*KH+1)),w_(this.dyn_ltree),w_(this.dyn_dtree),w_(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(zH+1),this.heap=new Uint16Array(2*YR+1),w_(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*YR+1),w_(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let dA=n=>{if(!n)return 1;let e=n.state;return!e||e.strm!==n||e.status!==Tc&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Pl&&e.status!==th?1:0},zR=n=>{if(dA(n))return ih(n,eh);n.total_in=n.total_out=0,n.data_type=HH;let e=n.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?Tc:Pl,n.adler=e.wrap===2?0:1,e.last_flush=-2,N0(e),Ys},SV=n=>{let e=zR(n);return e===Ys&&(t=>{t.window_size=2*t.w_size,w_(t.head),t.max_lazy_match=Qc[t.level].max_lazy,t.good_match=Qc[t.level].good_length,t.nice_match=Qc[t.level].nice_length,t.max_chain_length=Qc[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0})(n.state),e},TV=(n,e,t,i,r,a)=>{if(!n)return eh;let s=1;if(e===mV&&(e=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),r<1||r>9||t!==L0||i<8||i>15||e<0||e>9||a<0||a>GH||i===8&&s!==1)return ih(n,eh);i===8&&(i=9);let o=new cA;return n.state=o,o.strm=n,o.status=Tc,o.wrap=s,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=r+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<r+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=e,o.strategy=a,o.method=t,SV(n)};var Rj=(n,e)=>{if(dA(n)||e>Bd||e<0)return n?ih(n,eh):eh;let t=n.state;if(!n.output||n.avail_in!==0&&!n.input||t.status===th&&e!==Dl)return ih(n,n.avail_out===0?EV:eh);let i=t.last_flush;if(t.last_flush=e,t.pending!==0){if(ps(n),n.avail_out===0)return t.last_flush=-1,Ys}else if(n.avail_in===0&&yE(e)<=yE(i)&&e!==Dl)return ih(n,EV);if(t.status===th&&n.avail_in!==0)return ih(n,EV);if(t.status===Tc&&t.wrap===0&&(t.status=Pl),t.status===Tc){let r=L0+(t.w_bits-8<<4)<<8,a=-1;if(a=t.strategy>=D0||t.level<2?0:t.level<6?1:t.level===6?2:3,r|=a<<6,t.strstart!==0&&(r|=32),r+=31-r%31,Ur(t,r),t.strstart!==0&&(Ur(t,n.adler>>>16),Ur(t,65535&n.adler)),n.adler=1,t.status=Pl,ps(n),t.pending!==0)return t.last_flush=-1,Ys}if(t.status===57){if(n.adler=0,Hi(t,31),Hi(t,139),Hi(t,8),t.gzhead)Hi(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),Hi(t,255&t.gzhead.time),Hi(t,t.gzhead.time>>8&255),Hi(t,t.gzhead.time>>16&255),Hi(t,t.gzhead.time>>24&255),Hi(t,t.level===9?2:t.strategy>=D0||t.level<2?4:0),Hi(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(Hi(t,255&t.gzhead.extra.length),Hi(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(n.adler=Ks(n.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69;else if(Hi(t,0),Hi(t,0),Hi(t,0),Hi(t,0),Hi(t,0),Hi(t,t.level===9?2:t.strategy>=D0||t.level<2?4:0),Hi(t,3),t.status=Pl,ps(n),t.pending!==0)return t.last_flush=-1,Ys}if(t.status===69){if(t.gzhead.extra){let r=t.pending,a=(65535&t.gzhead.extra.length)-t.gzindex;for(;t.pending+a>t.pending_buf_size;){let o=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+o),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>r&&(n.adler=Ks(n.adler,t.pending_buf,t.pending-r,r)),t.gzindex+=o,ps(n),t.pending!==0)return t.last_flush=-1,Ys;r=0,a-=o}let s=new Uint8Array(t.gzhead.extra);t.pending_buf.set(s.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending+=a,t.gzhead.hcrc&&t.pending>r&&(n.adler=Ks(n.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=73}if(t.status===73){if(t.gzhead.name){let r,a=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(n.adler=Ks(n.adler,t.pending_buf,t.pending-a,a)),ps(n),t.pending!==0)return t.last_flush=-1,Ys;a=0}r=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,Hi(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>a&&(n.adler=Ks(n.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=91}if(t.status===91){if(t.gzhead.comment){let r,a=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(n.adler=Ks(n.adler,t.pending_buf,t.pending-a,a)),ps(n),t.pending!==0)return t.last_flush=-1,Ys;a=0}r=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,Hi(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>a&&(n.adler=Ks(n.adler,t.pending_buf,t.pending-a,a))}t.status=103}if(t.status===103){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(ps(n),t.pending!==0))return t.last_flush=-1,Ys;Hi(t,255&n.adler),Hi(t,n.adler>>8&255),n.adler=0}if(t.status=Pl,ps(n),t.pending!==0)return t.last_flush=-1,Ys}if(n.avail_in!==0||t.lookahead!==0||e!==RE&&t.status!==th){let r=t.level===0?Wg(t,e):t.strategy===D0?((a,s)=>{let o;for(;;){if(a.lookahead===0&&(Gg(a),a.lookahead===0)){if(s===RE)return 1;break}if(a.match_length=0,o=SE(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,o&&(ea(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,s===Dl?(ea(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(ea(a,!1),a.strm.avail_out===0)?1:2})(t,e):t.strategy===P0?((a,s)=>{let o,c,d,l,h=a.window;for(;;){if(a.lookahead<=Bg){if(Gg(a),a.lookahead<=Bg&&s===RE)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(d=a.strstart-1,c=h[d],c===h[++d]&&c===h[++d]&&c===h[++d])){l=a.strstart+Bg;do;while(c===h[++d]&&c===h[++d]&&c===h[++d]&&c===h[++d]&&c===h[++d]&&c===h[++d]&&c===h[++d]&&c===h[++d]&&d<l);a.match_length=Bg-(l-d),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(o=SE(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(o=SE(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),o&&(ea(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,s===Dl?(ea(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(ea(a,!1),a.strm.avail_out===0)?1:2})(t,e):Qc[t.level].func(t,e);if(r!==3&&r!==4||(t.status=th),r===1||r===3)return n.avail_out===0&&(t.last_flush=-1),Ys;if(r===2&&(e===vE?TE(t):e!==Bd&&(_V(t,0,0,!1),e===BH&&(w_(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),ps(n),n.avail_out===0))return t.last_flush=-1,Ys}return e!==Dl?Ys:t.wrap<=0?zs:(t.wrap===2?(Hi(t,255&n.adler),Hi(t,n.adler>>8&255),Hi(t,n.adler>>16&255),Hi(t,n.adler>>24&255),Hi(t,255&n.total_in),Hi(t,n.total_in>>8&255),Hi(t,n.total_in>>16&255),Hi(t,n.total_in>>24&255)):(Ur(t,n.adler>>>16),Ur(t,65535&n.adler)),ps(n),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Ys:zs)},qH=(n,e)=>{let t=e.length;if(dA(n))return eh;let i=n.state,r=i.wrap;if(r===2||r===1&&i.status!==Tc||i.lookahead)return eh;if(r===1&&(n.adler=sA(n.adler,e,t,0)),i.wrap=0,t>=i.w_size){r===0&&(w_(i.head),i.strstart=0,i.block_start=0,i.insert=0);let c=new Uint8Array(i.w_size);c.set(e.subarray(t-i.w_size,t),0),e=c,t=i.w_size}let a=n.avail_in,s=n.next_in,o=n.input;for(n.avail_in=t,n.next_in=0,n.input=e,Gg(i);i.lookahead>=3;){let c=i.strstart,d=i.lookahead-2;do i.ins_h=bE(i,i.ins_h,i.window[c+3-1]),i.prev[c&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=c,c++;while(--d);i.strstart=c,i.lookahead=2,Gg(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,n.next_in=s,n.input=o,n.avail_in=a,i.wrap=r,Ys},lA={deflateInit:(n,e)=>TV(n,e,L0,15,8,WH),deflateInit2:TV,deflateReset:SV,deflateResetKeep:zR,deflateSetHeader:(n,e)=>dA(n)||n.state.wrap!==2?eh:(n.state.gzhead=e,Ys),deflate:Rj,deflateEnd:n=>{if(dA(n))return eh;let e=n.state.status;return n.state=null,e===Pl?ih(n,lp):Ys},deflateSetDictionary:qH,deflateInfo:"pako deflate (from Nodeca project)"};let uA=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var U0={assign:function(n){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let i in t)uA(t,i)&&(n[i]=t[i])}}return n},flattenChunks:n=>{let e=0;for(let i=0,r=n.length;i<r;i++)e+=n[i].length;let t=new Uint8Array(e);for(let i=0,r=0,a=n.length;i<a;i++){let s=n[i];t.set(s,r),r+=s.length}return t}};let hA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{hA=!1}let qR=new Uint8Array(256);for(let n=0;n<256;n++)qR[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;qR[254]=qR[254]=1;var O_={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,r,a,s=n.length,o=0;for(r=0;r<s;r++)t=n.charCodeAt(r),(64512&t)==55296&&r+1<s&&(i=n.charCodeAt(r+1),(64512&i)==56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),o+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(o),a=0,r=0;a<o;r++)t=n.charCodeAt(r),(64512&t)==55296&&r+1<s&&(i=n.charCodeAt(r+1),(64512&i)==56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),t<128?e[a++]=t:t<2048?(e[a++]=192|t>>>6,e[a++]=128|63&t):t<65536?(e[a++]=224|t>>>12,e[a++]=128|t>>>6&63,e[a++]=128|63&t):(e[a++]=240|t>>>18,e[a++]=128|t>>>12&63,e[a++]=128|t>>>6&63,e[a++]=128|63&t);return e},buf2string:(n,e)=>{let t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,r,a=new Array(2*t);for(r=0,i=0;i<t;){let s=n[i++];if(s<128){a[r++]=s;continue}let o=qR[s];if(o>4)a[r++]=65533,i+=o-1;else{for(s&=o===2?31:o===3?15:7;o>1&&i<t;)s=s<<6|63&n[i++],o--;o>1?a[r++]=65533:s<65536?a[r++]=s:(s-=65536,a[r++]=55296|s>>10&1023,a[r++]=56320|1023&s)}}return((s,o)=>{if(o<65534&&s.subarray&&hA)return String.fromCharCode.apply(null,s.length===o?s:s.subarray(0,o));let c="";for(let d=0;d<o;d++)c+=String.fromCharCode(s[d]);return c})(a,r)},utf8border:(n,e)=>{(e=e||n.length)>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(192&n[t])==128;)t--;return t<0||t===0?e:t+qR[n[t]]>e?t:e}},XR=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let RV=Object.prototype.toString,{Z_NO_FLUSH:vj,Z_SYNC_FLUSH:XH,Z_FULL_FLUSH:JH,Z_FINISH:ZH,Z_OK:x0,Z_STREAM_END:V0,Z_DEFAULT_COMPRESSION:QH,Z_DEFAULT_STRATEGY:$H,Z_DEFLATED:e3}=dp;function F0(n){this.options=U0.assign({level:QH,method:e3,chunkSize:16384,windowBits:15,memLevel:8,strategy:$H},n||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new XR,this.strm.avail_out=0;let t=lA.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==x0)throw new Error(la[t]);if(e.header&&lA.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?O_.string2buf(e.dictionary):RV.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,t=lA.deflateSetDictionary(this.strm,i),t!==x0)throw new Error(la[t]);this._dict_set=!0}}function B0(n,e){let t=new F0(e);if(t.push(n,!0),t.err)throw t.msg||la[t.err];return t.result}F0.prototype.push=function(n,e){let t=this.strm,i=this.options.chunkSize,r,a;if(this.ended)return!1;for(a=e===~~e?e:e===!0?ZH:vj,typeof n=="string"?t.input=O_.string2buf(n):RV.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;)if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(a===XH||a===JH)&&t.avail_out<=6)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else{if(r=lA.deflate(t,a),r===V0)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),r=lA.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===x0;if(t.avail_out!==0){if(a>0&&t.next_out>0)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else if(t.avail_in===0)break}else this.onData(t.output)}return!0},F0.prototype.onData=function(n){this.chunks.push(n)},F0.prototype.onEnd=function(n){n===x0&&(this.result=U0.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var t3={deflate:B0};let j0=16209;var G0=function(n,e){let t,i,r,a,s,o,c,d,l,h,_,f,m,S,T,R,C,b,N,k,P,U,W,z,Q=n.state;t=n.next_in,W=n.input,i=t+(n.avail_in-5),r=n.next_out,z=n.output,a=r-(e-n.avail_out),s=r+(n.avail_out-257),o=Q.dmax,c=Q.wsize,d=Q.whave,l=Q.wnext,h=Q.window,_=Q.hold,f=Q.bits,m=Q.lencode,S=Q.distcode,T=(1<<Q.lenbits)-1,R=(1<<Q.distbits)-1;e:do{f<15&&(_+=W[t++]<<f,f+=8,_+=W[t++]<<f,f+=8),C=m[_&T];t:for(;;){if(b=C>>>24,_>>>=b,f-=b,b=C>>>16&255,b===0)z[r++]=65535&C;else{if(!(16&b)){if(!(64&b)){C=m[(65535&C)+(_&(1<<b)-1)];continue t}if(32&b){Q.mode=16191;break e}n.msg="invalid literal/length code",Q.mode=j0;break e}N=65535&C,b&=15,b&&(f<b&&(_+=W[t++]<<f,f+=8),N+=_&(1<<b)-1,_>>>=b,f-=b),f<15&&(_+=W[t++]<<f,f+=8,_+=W[t++]<<f,f+=8),C=S[_&R];i:for(;;){if(b=C>>>24,_>>>=b,f-=b,b=C>>>16&255,!(16&b)){if(!(64&b)){C=S[(65535&C)+(_&(1<<b)-1)];continue i}n.msg="invalid distance code",Q.mode=j0;break e}if(k=65535&C,b&=15,f<b&&(_+=W[t++]<<f,f+=8,f<b&&(_+=W[t++]<<f,f+=8)),k+=_&(1<<b)-1,k>o){n.msg="invalid distance too far back",Q.mode=j0;break e}if(_>>>=b,f-=b,b=r-a,k>b){if(b=k-b,b>d&&Q.sane){n.msg="invalid distance too far back",Q.mode=j0;break e}if(P=0,U=h,l===0){if(P+=c-b,b<N){N-=b;do z[r++]=h[P++];while(--b);P=r-k,U=z}}else if(l<b){if(P+=c+l-b,b-=l,b<N){N-=b;do z[r++]=h[P++];while(--b);if(P=0,l<N){b=l,N-=b;do z[r++]=h[P++];while(--b);P=r-k,U=z}}}else if(P+=l-b,b<N){N-=b;do z[r++]=h[P++];while(--b);P=r-k,U=z}for(;N>2;)z[r++]=U[P++],z[r++]=U[P++],z[r++]=U[P++],N-=3;N&&(z[r++]=U[P++],N>1&&(z[r++]=U[P++]))}else{P=r-k;do z[r++]=z[P++],z[r++]=z[P++],z[r++]=z[P++],N-=3;while(N>2);N&&(z[r++]=z[P++],N>1&&(z[r++]=z[P++]))}break}}break}}while(t<i&&r<s);N=f>>3,t-=N,f-=N<<3,_&=(1<<f)-1,n.next_in=t,n.next_out=r,n.avail_in=t<i?i-t+5:5-(t-i),n.avail_out=r<s?s-r+257:257-(r-s),Q.hold=_,Q.bits=f};let W0=15,H0=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),i3=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),r3=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),n3=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pA=(n,e,t,i,r,a,s,o)=>{let c=o.bits,d,l,h,_,f,m,S=0,T=0,R=0,C=0,b=0,N=0,k=0,P=0,U=0,W=0,z=null,Q=new Uint16Array(16),he=new Uint16Array(16),Ge,xe,qe,ot=null;for(S=0;S<=W0;S++)Q[S]=0;for(T=0;T<i;T++)Q[e[t+T]]++;for(b=c,C=W0;C>=1&&Q[C]===0;C--);if(b>C&&(b=C),C===0)return r[a++]=20971520,r[a++]=20971520,o.bits=1,0;for(R=1;R<C&&Q[R]===0;R++);for(b<R&&(b=R),P=1,S=1;S<=W0;S++)if(P<<=1,P-=Q[S],P<0)return-1;if(P>0&&(n===0||C!==1))return-1;for(he[1]=0,S=1;S<W0;S++)he[S+1]=he[S]+Q[S];for(T=0;T<i;T++)e[t+T]!==0&&(s[he[e[t+T]]++]=T);if(n===0?(z=ot=s,m=20):n===1?(z=H0,ot=i3,m=257):(z=r3,ot=n3,m=0),W=0,T=0,S=R,f=a,N=b,k=0,h=-1,U=1<<b,_=U-1,n===1&&U>852||n===2&&U>592)return 1;for(;;){Ge=S-k,s[T]+1<m?(xe=0,qe=s[T]):s[T]>=m?(xe=ot[s[T]-m],qe=z[s[T]-m]):(xe=96,qe=0),d=1<<S-k,l=1<<N,R=l;do l-=d,r[f+(W>>k)+l]=Ge<<24|xe<<16|qe|0;while(l!==0);for(d=1<<S-1;W&d;)d>>=1;if(d!==0?(W&=d-1,W+=d):W=0,T++,--Q[S]==0){if(S===C)break;S=e[t+s[T]]}if(S>b&&(W&_)!==h){for(k===0&&(k=b),f+=R,N=S-k,P=1<<N;N+k<C&&(P-=Q[N+k],!(P<=0));)N++,P<<=1;if(U+=1<<N,n===1&&U>852||n===2&&U>592)return 1;h=W&_,r[h]=b<<24|N<<16|f-a|0}}return W!==0&&(r[f+W]=S-k<<24|64<<16|0),o.bits=b,0};let{Z_FINISH:JR,Z_BLOCK:yj,Z_TREES:K0,Z_OK:up,Z_STREAM_END:Hg,Z_NEED_DICT:a3,Z_STREAM_ERROR:Ll,Z_DATA_ERROR:jd,Z_MEM_ERROR:vV,Z_BUF_ERROR:Cj,Z_DEFLATED:bj}=dp,_A=16180,Kg=16190,kl=16191,rh=16192,fA=16194,ZR=16199,Yg=16200,QR=16206,Yn=16209,ta=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function Aj(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let zg=n=>{if(!n)return 1;let e=n.state;return!e||e.strm!==n||e.mode<_A||e.mode>16211?1:0},IE=n=>{if(zg(n))return Ll;let e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=1&e.wrap),e.mode=_A,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,up},yV=n=>{if(zg(n))return Ll;let e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,IE(n)},CV=(n,e)=>{let t;if(zg(n))return Ll;let i=n.state;return e<0?(t=0,e=-e):(t=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Ll:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,yV(n))},bV=(n,e)=>{if(!n)return Ll;let t=new Aj;n.state=t,t.strm=n,t.window=null,t.mode=_A;let i=CV(n,e);return i!==up&&(n.state=null),i},Y0,EA,z0=!0,Ij=n=>{if(z0){Y0=new Int32Array(512),EA=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(pA(1,n.lens,0,288,Y0,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;pA(2,n.lens,0,32,EA,0,n.work,{bits:5}),z0=!1}n.lencode=Y0,n.lenbits=9,n.distcode=EA,n.distbits=5},wj=(n,e,t,i)=>{let r,a=n.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(e.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>i&&(r=i),a.window.set(e.subarray(t-i,t-i+r),a.wnext),(i-=r)?(a.window.set(e.subarray(t-i,t),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};var Oj=(n,e)=>{let t,i,r,a,s,o,c,d,l,h,_,f,m,S,T,R,C,b,N,k,P,U,W=0,z=new Uint8Array(4),Q,he,Ge=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(zg(n)||!n.output||!n.input&&n.avail_in!==0)return Ll;t=n.state,t.mode===kl&&(t.mode=rh),s=n.next_out,r=n.output,c=n.avail_out,a=n.next_in,i=n.input,o=n.avail_in,d=t.hold,l=t.bits,h=o,_=c,U=up;e:for(;;)switch(t.mode){case _A:if(t.wrap===0){t.mode=rh;break}for(;l<16;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(2&t.wrap&&d===35615){t.wbits===0&&(t.wbits=15),t.check=0,z[0]=255&d,z[1]=d>>>8&255,t.check=Ks(t.check,z,2,0),d=0,l=0,t.mode=16181;break}if(t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&d)<<8)+(d>>8))%31){n.msg="incorrect header check",t.mode=Yn;break}if((15&d)!==bj){n.msg="unknown compression method",t.mode=Yn;break}if(d>>>=4,l-=4,P=8+(15&d),t.wbits===0&&(t.wbits=P),P>15||P>t.wbits){n.msg="invalid window size",t.mode=Yn;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=512&d?16189:kl,d=0,l=0;break;case 16181:for(;l<16;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(t.flags=d,(255&Os(t))!==bj){n.msg="unknown compression method",t.mode=Yn;break}if(57344&Os(t)){n.msg="unknown header flags set",t.mode=Yn;break}t.head&&(t.head.text=d>>8&1),512&Os(t)&&4&t.wrap&&(z[0]=255&d,z[1]=d>>>8&255,t.check=Ks(t.check,z,2,0)),d=0,l=0,t.mode=16182;case 16182:for(;l<32;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}t.head&&(t.head.time=d),512&Os(t)&&4&t.wrap&&(z[0]=255&d,z[1]=d>>>8&255,z[2]=d>>>16&255,z[3]=d>>>24&255,t.check=Ks(t.check,z,4,0)),d=0,l=0,t.mode=16183;case 16183:for(;l<16;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}t.head&&(t.head.xflags=255&d,t.head.os=d>>8),512&Os(t)&&4&t.wrap&&(z[0]=255&d,z[1]=d>>>8&255,t.check=Ks(t.check,z,2,0)),d=0,l=0,t.mode=16184;case 16184:if(1024&Os(t)){for(;l<16;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}t.length=d,t.head&&(t.head.extra_len=d),512&Os(t)&&4&t.wrap&&(z[0]=255&d,z[1]=d>>>8&255,t.check=Ks(t.check,z,2,0)),d=0,l=0}else t.head&&(t.head.extra=null);t.mode=16185;case 16185:if(1024&Os(t)&&(f=t.length,f>o&&(f=o),f&&(t.head&&(P=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(a,a+f),P)),512&Os(t)&&4&t.wrap&&(t.check=Ks(t.check,i,f,a)),o-=f,a+=f,t.length-=f),t.length))break e;t.length=0,t.mode=16186;case 16186:if(2048&Os(t)){if(o===0)break e;f=0;do P=i[a+f++],t.head&&P&&t.length<65536&&(t.head.name+=String.fromCharCode(P));while(P&&f<o);if(512&Os(t)&&4&t.wrap&&(t.check=Ks(t.check,i,f,a)),o-=f,a+=f,P)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=16187;case 16187:if(4096&Os(t)){if(o===0)break e;f=0;do P=i[a+f++],t.head&&P&&t.length<65536&&(t.head.comment+=String.fromCharCode(P));while(P&&f<o);if(512&Os(t)&&4&t.wrap&&(t.check=Ks(t.check,i,f,a)),o-=f,a+=f,P)break e}else t.head&&(t.head.comment=null);t.mode=16188;case 16188:if(512&Os(t)){for(;l<16;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(4&t.wrap&&d!==(65535&t.check)){n.msg="header crc mismatch",t.mode=Yn;break}d=0,l=0}t.head&&(t.head.hcrc=Os(t)>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=kl;break;case 16189:for(;l<32;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}n.adler=t.check=ta(d),d=0,l=0,t.mode=Kg;case Kg:if(t.havedict===0)return n.next_out=s,n.avail_out=c,n.next_in=a,n.avail_in=o,t.hold=d,t.bits=l,a3;n.adler=t.check=1,t.mode=kl;case kl:if(e===yj||e===K0)break e;case rh:if(t.last){d>>>=7&l,l-=7&l,t.mode=QR;break}for(;l<3;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}switch(t.last=1&d,d>>>=1,l-=1,3&d){case 0:t.mode=16193;break;case 1:if(Ij(t),t.mode=ZR,e===K0){d>>>=2,l-=2;break e}break;case 2:t.mode=16196;break;case 3:n.msg="invalid block type",t.mode=Yn}d>>>=2,l-=2;break;case 16193:for(d>>>=7&l,l-=7&l;l<32;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if((65535&d)!=(d>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Yn;break}if(t.length=65535&d,d=0,l=0,t.mode=fA,e===K0)break e;case fA:t.mode=16195;case 16195:if(f=t.length,f){if(f>o&&(f=o),f>c&&(f=c),f===0)break e;r.set(i.subarray(a,a+f),s),o-=f,a+=f,c-=f,s+=f,t.length-=f;break}t.mode=kl;break;case 16196:for(;l<14;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(t.nlen=257+(31&d),d>>>=5,l-=5,t.ndist=1+(31&d),d>>>=5,l-=5,t.ncode=4+(15&d),d>>>=4,l-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Yn;break}t.have=0,t.mode=16197;case 16197:for(;t.have<t.ncode;){for(;l<3;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}t.lens[Ge[t.have++]]=7&d,d>>>=3,l-=3}for(;t.have<19;)t.lens[Ge[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,Q={bits:t.lenbits},U=pA(0,t.lens,0,19,t.lencode,0,t.work,Q),t.lenbits=Q.bits,U){n.msg="invalid code lengths set",t.mode=Yn;break}t.have=0,t.mode=16198;case 16198:for(;t.have<t.nlen+t.ndist;){for(;W=t.lencode[d&(1<<t.lenbits)-1],T=W>>>24,R=W>>>16&255,C=65535&W,!(T<=l);){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(C<16)d>>>=T,l-=T,t.lens[t.have++]=C;else{if(C===16){for(he=T+2;l<he;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(d>>>=T,l-=T,t.have===0){n.msg="invalid bit length repeat",t.mode=Yn;break}P=t.lens[t.have-1],f=3+(3&d),d>>>=2,l-=2}else if(C===17){for(he=T+3;l<he;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}d>>>=T,l-=T,P=0,f=3+(7&d),d>>>=3,l-=3}else{for(he=T+7;l<he;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}d>>>=T,l-=T,P=0,f=11+(127&d),d>>>=7,l-=7}if(t.have+f>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Yn;break}for(;f--;)t.lens[t.have++]=P}}if(t.mode===Yn)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Yn;break}if(t.lenbits=9,Q={bits:t.lenbits},U=pA(1,t.lens,0,t.nlen,t.lencode,0,t.work,Q),t.lenbits=Q.bits,U){n.msg="invalid literal/lengths set",t.mode=Yn;break}if(t.distbits=6,t.distcode=t.distdyn,Q={bits:t.distbits},U=pA(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,Q),t.distbits=Q.bits,U){n.msg="invalid distances set",t.mode=Yn;break}if(t.mode=ZR,e===K0)break e;case ZR:t.mode=Yg;case Yg:if(o>=6&&c>=258){n.next_out=s,n.avail_out=c,n.next_in=a,n.avail_in=o,t.hold=d,t.bits=l,G0(n,_),s=n.next_out,r=n.output,c=n.avail_out,a=n.next_in,i=n.input,o=n.avail_in,d=t.hold,l=t.bits,t.mode===kl&&(t.back=-1);break}for(t.back=0;W=t.lencode[d&(1<<t.lenbits)-1],T=W>>>24,R=W>>>16&255,C=65535&W,!(T<=l);){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(R&&!(240&R)){for(b=T,N=R,k=C;W=t.lencode[k+((d&(1<<b+N)-1)>>b)],T=W>>>24,R=W>>>16&255,C=65535&W,!(b+T<=l);){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}d>>>=b,l-=b,t.back+=b}if(d>>>=T,l-=T,t.back+=T,t.length=C,R===0){t.mode=16205;break}if(32&R){t.back=-1,t.mode=kl;break}if(64&R){n.msg="invalid literal/length code",t.mode=Yn;break}t.extra=15&R,t.mode=16201;case 16201:if(t.extra){for(he=t.extra;l<he;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}t.length+=d&(1<<t.extra)-1,d>>>=t.extra,l-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=16202;case 16202:for(;W=t.distcode[d&(1<<t.distbits)-1],T=W>>>24,R=W>>>16&255,C=65535&W,!(T<=l);){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(!(240&R)){for(b=T,N=R,k=C;W=t.distcode[k+((d&(1<<b+N)-1)>>b)],T=W>>>24,R=W>>>16&255,C=65535&W,!(b+T<=l);){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}d>>>=b,l-=b,t.back+=b}if(d>>>=T,l-=T,t.back+=T,64&R){n.msg="invalid distance code",t.mode=Yn;break}t.offset=C,t.extra=15&R,t.mode=16203;case 16203:if(t.extra){for(he=t.extra;l<he;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}t.offset+=d&(1<<t.extra)-1,d>>>=t.extra,l-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Yn;break}t.mode=16204;case 16204:if(c===0)break e;if(f=_-c,t.offset>f){if(f=t.offset-f,f>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Yn;break}f>t.wnext?(f-=t.wnext,m=t.wsize-f):m=t.wnext-f,f>t.length&&(f=t.length),S=t.window}else S=r,m=s-t.offset,f=t.length;f>c&&(f=c),c-=f,t.length-=f;do r[s++]=S[m++];while(--f);t.length===0&&(t.mode=Yg);break;case 16205:if(c===0)break e;r[s++]=t.length,c--,t.mode=Yg;break;case QR:if(t.wrap){for(;l<32;){if(o===0)break e;o--,d|=i[a++]<<l,l+=8}if(_-=c,n.total_out+=_,t.total+=_,4&t.wrap&&_&&(n.adler=t.check=Os(t)?Ks(t.check,r,_,s-_):sA(t.check,r,_,s-_)),_=c,4&t.wrap&&(Os(t)?d:ta(d))!==t.check){n.msg="incorrect data check",t.mode=Yn;break}d=0,l=0}t.mode=16207;case 16207:if(t.wrap&&Os(t)){for(;l<32;){if(o===0)break e;o--,d+=i[a++]<<l,l+=8}if(4&t.wrap&&d!==(4294967295&t.total)){n.msg="incorrect length check",t.mode=Yn;break}d=0,l=0}t.mode=16208;case 16208:U=Hg;break e;case Yn:U=jd;break e;case 16210:return vV;default:return Ll}return n.next_out=s,n.avail_out=c,n.next_in=a,n.avail_in=o,t.hold=d,t.bits=l,(t.wsize||_!==n.avail_out&&t.mode<Yn&&(t.mode<QR||e!==JR))&&wj(n,n.output,n.next_out,_-n.avail_out),h-=n.avail_in,_-=n.avail_out,n.total_in+=h,n.total_out+=_,t.total+=_,4&t.wrap&&_&&(n.adler=t.check=Os(t)?Ks(t.check,r,_,n.next_out-_):sA(t.check,r,_,n.next_out-_)),n.data_type=t.bits+(t.last?64:0)+(t.mode===kl?128:0)+(t.mode===ZR||t.mode===fA?256:0),(h===0&&_===0||e===JR)&&U===up&&(U=Cj),U},N_={inflateReset:yV,inflateReset2:CV,inflateResetKeep:IE,inflateInit:n=>bV(n,15),inflateInit2:bV,inflate:Oj,inflateEnd:n=>{if(zg(n))return Ll;let e=n.state;return e.window&&(e.window=null),n.state=null,up},inflateGetHeader:(n,e)=>{if(zg(n))return Ll;let t=n.state;return 2&t.wrap?(t.head=e,e.done=!1,up):Ll},inflateSetDictionary:(n,e)=>{let t=e.length,i,r,a;return zg(n)?Ll:(i=n.state,i.wrap!==0&&i.mode!==Kg?Ll:i.mode===Kg&&(r=1,r=sA(r,e,t,0),r!==i.check)?jd:(a=wj(n,e,t,t),a?(i.mode=16210,vV):(i.havedict=1,up)))},inflateInfo:"pako inflate (from Nodeca project)"},D_=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let Nj=Object.prototype.toString,{Z_NO_FLUSH:Dj,Z_FINISH:s3,Z_OK:mA,Z_STREAM_END:qg,Z_NEED_DICT:gA,Z_STREAM_ERROR:AV,Z_DATA_ERROR:Pj,Z_MEM_ERROR:Lj}=dp;function q0(n){this.options=U0.assign({chunkSize:65536,windowBits:15,to:""},n||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||n&&n.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new XR,this.strm.avail_out=0;let t=N_.inflateInit2(this.strm,e.windowBits);if(t!==mA)throw new Error(la[t]);if(this.header=new D_,N_.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=O_.string2buf(e.dictionary):Nj.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=N_.inflateSetDictionary(this.strm,e.dictionary),t!==mA)))throw new Error(la[t])}function X0(n,e){let t=new q0(e);if(t.push(n),t.err)throw t.msg||la[t.err];return t.result}q0.prototype.push=function(n,e){let t=this.strm,i=this.options.chunkSize,r=this.options.dictionary,a,s,o;if(this.ended)return!1;for(s=e===~~e?e:e===!0?s3:Dj,Nj.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),a=N_.inflate(t,s),a===gA&&r&&(a=N_.inflateSetDictionary(t,r),a===mA?a=N_.inflate(t,s):a===Pj&&(a=gA));t.avail_in>0&&a===qg&&t.state.wrap>0&&n[t.next_in]!==0;)N_.inflateReset(t),a=N_.inflate(t,s);switch(a){case AV:case Pj:case gA:case Lj:return this.onEnd(a),this.ended=!0,!1}if(o=t.avail_out,t.next_out&&(t.avail_out===0||a===qg))if(this.options.to==="string"){let c=O_.utf8border(t.output,t.next_out),d=t.next_out-c,l=O_.buf2string(t.output,c);t.next_out=d,t.avail_out=i-d,d&&t.output.set(t.output.subarray(c,c+d),0),this.onData(l)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(a!==mA||o!==0){if(a===qg)return a=N_.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},q0.prototype.onData=function(n){this.chunks.push(n)},q0.prototype.onEnd=function(n){n===mA&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=U0.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var o3={inflate:X0};let{deflate:c3}=t3,{inflate:d3}=o3;var l3=c3,u3=d3,kj=(function(n){return n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE",n})(kj||{});class Mj{constructor(){F(this,"_sequence",0),F(this,"_startTime",Date.now()),F(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){let t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let o=new Uint8Array(4);o.set([1,0,0,0]);let c={id:0,length:4,data:o.buffer},d={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[c]};t.commonPacketHeader.extension=1,t.extension=d,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;B("SHOW_DATASTREAM2_LOG")&&I.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));let i=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(i),a=new DataView(i),s=0;if(a.setUint16(s,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),s+=2,a.setUint32(s,t.commonPacketHeader.sequence,!0),s+=4,a.setUint16(s,t.commonStreamHeader,!0),s+=2,t.extension){let o=this.serializeExtension(t.extension);r.set(new Uint8Array(o),s),s+=o.byteLength}if(r.set(new Uint8Array(t.payload),s),s+=t.payload.byteLength,s!==t.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);let t=new DataView(e),i=0,r=t.getUint16(i,!0);i+=2;let a={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(i+2,!0)<<16|t.getUint16(i,!0)},s,o;if(i+=4,B("SHOW_DATASTREAM2_LOG")&&I.debug("receive data header: ".concat(JSON.stringify(a))),t.getUint16(i,!0),i+=2,a.extension){o=this.deserializeExtension(e.slice(i)),i+=2+o.length,s=e.slice(i);let c=!1;if(o.datas.length>0){let d=o.datas.find(l=>l.id===0);d&&(c=(1&new DataView(d.data).getUint32(0,!0))==1)}s=c?this.decompress(s):s}else s=e.slice(8);return s}serializeExtension(e){let{profile:t,length:i,datas:r}=e,a=new ArrayBuffer(i+2),s=new Uint8Array(a),o=new DataView(a),c=0;if(o.setUint8(c++,t),o.setUint8(c++,i),r.forEach(d=>{t?(o.setUint8(c++,d.id),o.setUint8(c++,d.length),s.set(new Uint8Array(d.data),c),c+=d.data.byteLength):(o.setUint8(c++,d.id|d.length<<4),s.set(new Uint8Array(d.data),c),c+=d.data.byteLength)}),c!==i+2)throw Error("serialize extension error, is ".concat(c,"!==").concat(i+2));return a}deserializeExtension(e){let t=new DataView(e),i=0,r=t.getUint8(i);i++;let a=t.getUint8(i);i++;let s=r===kj.TWO_BYTE,o=[],c=new DataView(e,2),d=0;for(;d<a;){let l=0,h=0,_=new ArrayBuffer(0);s?(l=c.getUint8(d),d++,h=c.getUint8(d),d++):(l=15&c.getUint8(d),h=c.getUint8(d)>>4,d++),h>0&&(_=c.buffer.slice(d+2,d+2+h),d+=_.byteLength),o.push({id:l,length:h,data:_})}if(d!==a)throw Error("parse error");return{profile:r,length:a,datas:o}}decompress(e){return u3(new Uint8Array(e))}compress(e){return l3(new Uint8Array(e))}}let h3={name:"DataStream",create:(n,e)=>{let t=e?new UB(n):new X4(n);return t.useDataStream(new Mj),t}};class p3 extends Sr{constructor(e,t,i){super(),F(this,"ws",void 0),F(this,"requestId",1),F(this,"heartBeatTimer",void 0),F(this,"joinInfo",void 0),F(this,"clientId",void 0),F(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),F(this,"onClose",r=>{this.emit("close"),this.dispose()}),F(this,"onMessage",r=>{let a=JSON.parse(r.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=e,this.clientId=t,this.ws=new Pg("cross-channel-".concat(this.clientId),i),this.ws.on(_t.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(_t.CONNECTED,this.onOpen),this.ws.on(_t.ON_MESSAGE,this.onMessage),this.ws.on(_t.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new se((t,i)=>{let r=window.setTimeout(()=>{i(new J(M.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,a=>{window.clearTimeout(r),a.state&&a.state!==0?i(new J(M.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new J(M.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new J(M.WS_DISCONNECT);let t=()=>new se((s,o)=>{this.ws.once(_t.CLOSED,()=>o(new J(M.WS_ABORT))),this.ws.once(_t.CONNECTED,s)});this.ws.state!=="connected"&&await t();let i=this.sendMessage(e),r=new se((s,o)=>{let c=()=>{o(new J(M.WS_ABORT))};this.ws.once(_t.RECONNECTING,c),this.ws.once(_t.CLOSED,c),this.once("req_".concat(i),s),va(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(_t.RECONNECTING,c),this.ws.off(_t.CLOSED,c),o(new J(M.TIMEOUT,"cross channel ws request timeout"))})}),a=await r;if(!a||a.code!==200)throw new J(M.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(e){this.ws.removeAllListeners(_t.REQUEST_NEW_URLS),this.ws.on(_t.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class _3 extends Sr{set state(e){e!==this._state&&(e!==oa.RELAY_STATE_FAILURE&&(this.errorCode=Ja.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,i,r,a){super(),F(this,"joinInfo",void 0),F(this,"sid",void 0),F(this,"clientId",void 0),F(this,"cancelToken",mr.CancelToken.source()),F(this,"workerToken",void 0),F(this,"requestId",0),F(this,"signal",void 0),F(this,"prevChannelMediaConfig",void 0),F(this,"httpRetryConfig",void 0),F(this,"_resolution",void 0),F(this,"_state",oa.RELAY_STATE_IDLE),F(this,"errorCode",Ja.RELAY_OK),F(this,"onStatus",s=>{I.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(s))),s&&s.command&&(s.command==="onAudioPacketReceived"&&this.emit("event",Kn.PACKET_RECEIVED_AUDIO_FROM_SRC),s.command==="onVideoPacketReceived"&&this.emit("event",Kn.PACKET_RECEIVED_VIDEO_FROM_SRC),s.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Ja.SRC_TOKEN_EXPIRED,this.state=oa.RELAY_STATE_FAILURE),s.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Ja.DEST_TOKEN_EXPIRED,this.state=oa.RELAY_STATE_FAILURE))}),F(this,"onReconnect",async()=>{I.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Kn.NETWORK_DISCONNECTED),this.state=oa.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(s=>{this.state!==oa.RELAY_STATE_IDLE&&(I.error("auto restart channel media relay failed",s.toString()),this.errorCode=Ja.SERVER_CONNECTION_LOST,this.state=oa.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=Mi(),this.signal=new p3(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=a}async startChannelMediaRelay(e){if(this.state!==oa.RELAY_STATE_IDLE)throw new J(M.INVALID_OPERATION);this.state=oa.RELAY_STATE_CONNECTING,await this.connect(),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){throw t.data&&t.data.serverResponse&&t.data.serverResponse.command==="SetSourceChannel"?new J(M.CROSS_CHANNEL_FAILED_JOIN_SRC):t.data&&t.data.serverResponse&&t.serverResponse.command==="SetDestChannelStatus"?new J(M.CROSS_CHANNEL_FAILED_JOIN_DEST):t.data&&t.data.serverResponse&&t.serverResponse.command==="StartPacketTransfer"?new J(M.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==oa.RELAY_STATE_RUNNING)throw new J(M.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==oa.RELAY_STATE_RUNNING)throw new J(M.INVALID_OPERATION);let t=this.genMessage(As.SetVideoProfile);await this.signal.request(t),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),I.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=oa.RELAY_STATE_IDLE,this.dispose()}dispose(){I.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mr.CancelToken.source(),this.state=oa.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await ij(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Kn.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let t=this.genMessage(As.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let i=this.genMessage(As.SetSdkProfile,e);await this.signal.request(i),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let r=this.genMessage(As.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Kn.PACKET_JOINED_SRC_CHANNEL),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let a=this.genMessage(As.SetSourceUserId,e);await this.signal.request(a),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let s=this.genMessage(As.SetDestChannel,e);await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Kn.PACKET_JOINED_DEST_CHANNEL),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let o=this.genMessage(As.StartPacketTransfer,e);await this.signal.request(o),this.emit("event",Kn.PACKET_SENT_TO_DEST_CHANNEL),this.state=oa.RELAY_STATE_RUNNING,I.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let t=this.genMessage(As.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",Kn.PACKET_UPDATE_DEST_CHANNEL),I.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(As.StopPacketTransfer);await this.signal.request(e),I.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let i=[],r=[],a=[];this.requestId+=1;let s={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:dc,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};s.sdkVersion==="4.24.0"&&(s.sdkVersion="0.0.1");let o=null,c=null;switch(e){case As.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case As.SetSourceChannel:if(c=t&&t.getSrcChannelMediaInfo(),!c)throw new J(M.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c.channelName,token:c.token||this.joinInfo.appId},s;case As.SetSourceUserId:if(c=t&&t.getSrcChannelMediaInfo(),!c)throw new J(M.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceUserId",uid:c.uid+""},s;case As.SetDestChannel:if(o=t&&t.getDestChannelMediaInfo(),!o)throw new J(M.UNEXPECTED_ERROR,"can not find dest config");return o.forEach(d=>{i.push(d.channelName),r.push(d.uid+""),a.push(d.token||this.joinInfo.appId)}),s.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:a},s;case As.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case As.Reconnect:return s.clientRequest={command:"Reconnect"},s;case As.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case As.UpdateDestChannel:if(o=t&&t.getDestChannelMediaInfo(),!o)throw new J(M.UNEXPECTED_ERROR,"can not find dest config");return o.forEach(d=>{i.push(d.channelName),r.push(d.uid+""),a.push(d.token||this.joinInfo.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:a},s;case As.SetVideoProfile:s.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s}}let f3={name:"ChannelMediaRelay",create:function(n){return new _3(n.joinInfo,n.clientId,n.websocketRetryConfig||Yr,n.httpRetryConfig||Yr,n.resolution)}};function Uj(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function $R(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Uj(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Uj(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class SA extends Sr{constructor(e,t,i,r){super(),F(this,"spec",void 0),F(this,"token",void 0),F(this,"websocket",void 0),F(this,"pingpongTimer",void 0),F(this,"reconnectMode","retry"),F(this,"serviceMode",void 0),F(this,"reqId",0),F(this,"commandReqId",0),F(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),F(this,"handleWebSocketMessage",a=>{if(!a.data)return;let s=JSON.parse(a.data);s.requestId?this.emit("@".concat(s.requestId,"-").concat(s.sid),s):(Te.workerEvent(this.spec.sid,{actionType:"status",serverCode:s.code,workerType:this.serviceMode===Cl.TRANSCODE?1:2}),this.emit(lE.PUBLISH_STREAM_STATUS,s))}),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new Pg("live-streaming",i),this.websocket.on(_t.CONNECTED,this.handleWebSocketOpen),this.websocket.on(_t.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(_t.REQUEST_NEW_URLS,(a,s)=>{kn(this,lE.REQUEST_NEW_ADDRESS).then(a).catch(s)}),this.websocket.on(_t.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);let a=this.commandReqId,s=this.reqId;if(!s||!this.websocket)throw new J(M.UNEXPECTED_ERROR);let o=$R({command:e,sdkVersion:dc==="4.24.0"?"0.0.1":dc,seq:s,requestId:s,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if(this.websocket.state==="closed")throw new J(M.WS_DISCONNECT);let c=()=>new se((_,f)=>{this.websocket.once(_t.CLOSED,()=>f(new J(M.WS_ABORT))),this.websocket.once(_t.CONNECTED,_)});this.websocket.state!=="connected"&&await c(),o.clientRequest&&(o.clientRequest.workerToken=this.token);let d=new se((_,f)=>{let m=()=>{f(new J(M.WS_ABORT))};this.websocket.once(_t.RECONNECTING,m),this.websocket.once(_t.CLOSED,m),this.once("@".concat(s,"-").concat(this.spec.sid),S=>{_(S)})});r&&Te.workerEvent(this.spec.sid,$R($R({},r),{},{requestId:a,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));let l=Date.now();this.websocket.sendMessage(o);let h=null;try{h=await d}catch(_){if(this.websocket.state==="closed")throw _;return await c(),await this.request(e,t,i)}return r&&Te.workerEvent(this.spec.sid,$R($R({},r),{},{requestId:a,actionType:"response",payload:JSON.stringify(h.serverResponse),serverCode:h.code,success:h.code===200,responseTime:Date.now()-l})),h.code!==200&&this.handleResponseError(h),h}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e=dc==="4.24.0"?"0.0.1":dc;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Sn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void I.warning("live stream response already exists stream");case Sn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Sn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Sn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new J(M.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Sn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new J(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new J(M.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Sn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t=new J(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(lE.WARNING,t,e.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t=new J(M.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(lE.WARNING,t,e.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new J(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new J(M.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Sn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t=new J(M.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(lE.WARNING,t,e.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new J(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Sn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new J(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Sn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new J(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sn.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new J(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new J(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new J(M.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Yh)},6e3)}}function xj(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function _o(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?xj(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):xj(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Wo extends Sr{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yr,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Yr;super(),F(this,"onLiveStreamWarning",void 0),F(this,"onLiveStreamError",void 0),F(this,"spec",void 0),F(this,"retryTimeout",1e4),F(this,"connection",void 0),F(this,"httpRetryConfig",void 0),F(this,"wsRetryConfig",void 0),F(this,"streamingTasks",new Map),F(this,"isStartingStreamingTask",!1),F(this,"taskMutex",new xa("live-streaming")),F(this,"cancelToken",mr.CancelToken.source()),F(this,"transcodingConfig",void 0),F(this,"uapResponse",void 0),F(this,"lastTaskId",1),F(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=t}async setTranscodingConfig(e){let t=_o(_o({},SU),e);t.videoCodecProfile!==66&&t.videoCodecProfile!==77&&t.videoCodecProfile!==100&&(I.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(s=>_o(_o(_o({},h_),s),{},{zOrder:s.zOrder?s.zOrder+1:1}))),(function(s){zi(s.width)||Bt(s.width,"config.width",0,1e4),zi(s.height)||Bt(s.height,"config.height",0,1e4),zi(s.videoBitrate)||Bt(s.videoBitrate,"config.videoBitrate",1,1e6),zi(s.videoFrameRate)||Bt(s.videoFrameRate,"config.videoFrameRate"),zi(s.lowLatency)||_e(s.lowLatency,"config.lowLatency"),zi(s.audioSampleRate)||gr(s.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),zi(s.audioBitrate)||Bt(s.audioBitrate,"config.audioBitrate",1,128),zi(s.audioChannels)||gr(s.audioChannels,"config.audioChannels",[1,2,3,4,5]),zi(s.videoGop)||Bt(s.videoGop,"config.videoGop"),zi(s.videoCodecProfile)||gr(s.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),zi(s.userCount)||Bt(s.userCount,"config.userCount",0,17),zi(s.backgroundColor)||Bt(s.backgroundColor,"config.backgroundColor",0,16777215),zi(s.userConfigExtraInfo)||Zn(s.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),s.transcodingUsers&&!zi(s.transcodingUsers)&&(rn(s.transcodingUsers,"config.transcodingUsers"),s.transcodingUsers.forEach((o,c)=>{Dg(o.uid),zi(o.x)||Bt(o.x,"transcodingUser[".concat(c,"].x"),0,1e4),zi(o.y)||Bt(o.y,"transcodingUser[".concat(c,"].y"),0,1e4),zi(o.width)||Bt(o.width,"transcodingUser[".concat(c,"].width"),0,1e4),zi(o.height)||Bt(o.height,"transcodingUser[".concat(c,"].height"),0,1e4),zi(o.zOrder)||Bt(o.zOrder-1,"transcodingUser[".concat(c,"].zOrder"),0,100),zi(o.alpha)||Bt(o.alpha,"transcodingUser[".concat(c,"].alpha"),0,1,!1)})),zi(s.watermark)||Pb(s.watermark,"watermark"),zi(s.backgroundImage)||Pb(s.backgroundImage,"backgroundImage"),s.images&&!zi(s.images)&&(rn(s.images,"config.images"),s.images.forEach((o,c)=>{Pb(o,"images[".concat(c,"]"))}))})(t);let i=[];t.images&&i.push(...t.images.map(s=>_o(_o(_o({},gU),s),{},{zOrder:255}))),t.backgroundImage&&(i.push(_o(_o(_o({},gU),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(i.push(_o(_o(_o({},gU),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=i,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(s=>_o({},s)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);let r=(t.userConfigs||[]).map(s=>typeof s.uid=="number"?se.resolve(s.uid):HU(s.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await se.all(r)).forEach((s,o)=>{t.userConfigs&&t.userConfigs[o]&&(t.userConfigs[o].uid=s)}),this.transcodingConfig=t,this.connection)try{var a;let s=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(tn(a=this.streamingTasks).call(a)).map(o=>o.taskId).join("#")});I.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(s.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(s){if(!s.data||!s.data.retry)throw s;s.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(o=>{I.warning("[".concat(this.spec.clientId,"] live streaming receive error"),s.toString(),"try to republish",o.url),this.startLiveStreamingTask(o.url,o.mode,s).then(()=>{I.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(o.url," success"))}).catch(c=>{I.error("[".concat(this.spec.clientId,"] live streaming republish failed"),o.url,c.toString()),this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})})}}async startLiveStreamingTask(e,t,i){if(!this.transcodingConfig&&t===Cl.TRANSCODE)throw new J(M.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};I.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));let a=await this.taskMutex.lock();if(!this.connection&&i)return void a();if(this.streamingTasks.get(e)&&!i)return a(),new J(M.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(o){throw a(),o}switch(t){case Cl.TRANSCODE:r.transcodingConfig=_o({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let s=this.lastTaskId++;try{let o=new se((d,l)=>{va(this.retryTimeout).then(()=>{if(i)return l(i);let h=this.statusError.get(e);return h?(this.statusError.delete(e),l(h)):void 0})}),c=await se.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===Cl.TRANSCODE?1:2,requestByUser:!i,tid:s.toString()}),o]);this.isStartingStreamingTask=!1,I.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(c.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:s}),a()}catch(o){if(a(),this.isStartingStreamingTask=!1,!o.data||!o.data.retry||i)throw o;return o.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,o)):await this.startLiveStreamingTask(e,t,o)}}stopLiveStreamingTask(e){return new se((t,i)=>{let r=this.streamingTasks.get(e);if(!r||!this.connection)return new J(M.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let a=r.mode;r.abortTask=()=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:a===Cl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(s=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(s.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(i)})}resetAllTask(){var e;let t=Array.from(tn(e=this.streamingTasks).call(e));this.terminate();for(let i of t)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=mr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new J(M.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await kn(this,Jh.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new SA(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(lE.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(lE.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(lE.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new J(M.UNEXPECTED_ERROR,"can not get new live streaming address list"));kn(this,Jh.REQUEST_WORKER_MANAGER_LIST,e).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(r)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){let t=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(t),r=e.reason;switch(e.code){case Sn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let s=new J(M.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return I.error(s.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,s);if(!this.isStartingStreamingTask)return;this.statusError.set(t,s)}case Sn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let s=new J(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,s)}case Sn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();let s=Array.from(tn(a=this.streamingTasks).call(a));for(let o of s)o.abortTask?o.abortTask():(I.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",o.url),this.startLiveStreamingTask(o.url,o.mode,new J(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{I.debug("[".concat(this.spec.clientId,"] republish live stream success"),o.url)}).catch(c=>{I.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(o.url,c)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}let E3={name:"LiveStreaming",create:function(n){return new Wo(n.joinInfo,n.websocketRetryConfig||Yr,n.httpRetryConfig||Yr)}};function m3(n){let e=wV();return(function(t,i){let r=t.appId;r!==void 0&&(Ri(i,10),nh(i,r));let a=t.cid;a!==void 0&&(Ri(i,16),Ri(i,a));let s=t.cname;s!==void 0&&(Ri(i,26),nh(i,s));let o=t.deviceId;o!==void 0&&(Ri(i,34),nh(i,o));let c=t.elapse;c!==void 0&&(Ri(i,40),Ii(i,c));let d=t.fileSize;d!==void 0&&(Ri(i,48),Ii(i,Qa(d)));let l=t.height;l!==void 0&&(Ri(i,56),Ii(i,Qa(l)));let h=t.jpg;h!==void 0&&(Ri(i,66),Ri(i,h.length),(function(xt,fe){let $=Jg(xt,fe.length);xt.bytes.set(fe,$)})(i,h));let _=t.networkType;_!==void 0&&(Ri(i,72),Ii(i,Qa(_)));let f=t.osType;f!==void 0&&(Ri(i,80),Ii(i,Qa(f)));let m=t.requestId;m!==void 0&&(Ri(i,90),nh(i,m));let S=t.sdkVersion;S!==void 0&&(Ri(i,98),nh(i,S));let T=t.sequence;T!==void 0&&(Ri(i,104),Ii(i,Qa(T)));let R=t.sid;R!==void 0&&(Ri(i,114),nh(i,R));let C=t.timestamp;C!==void 0&&(Ri(i,120),Ii(i,C));let b=t.uid;b!==void 0&&(Ri(i,128),Ri(i,b));let N=t.vid;N!==void 0&&(Ri(i,136),Ri(i,N));let k=t.width;k!==void 0&&(Ri(i,144),Ii(i,Qa(k)));let P=t.service;P!==void 0&&(Ri(i,152),Ri(i,P));let U=t.callbackData;U!==void 0&&(Ri(i,162),nh(i,U));let W=t.jpgEncryption;W!==void 0&&(Ri(i,168),Ri(i,W));let z=t.requestType;z!==void 0&&(Ri(i,176),Ri(i,z));let Q=t.scorePorn;Q!==void 0&&(Ri(i,185),TA(i,Q));let he=t.scoreSexy;he!==void 0&&(Ri(i,193),TA(i,he));let Ge=t.scoreNeutral;Ge!==void 0&&(Ri(i,201),TA(i,Ge));let xe=t.scene;xe!==void 0&&(Ri(i,208),Ri(i,xe));let qe=t.ossFilePrefix;qe!==void 0&&(Ri(i,218),nh(i,qe));let ot=t.serviceVendor;if(ot!==void 0)for(let xt of ot){Ri(i,226);let fe=wV();T3(xt,fe),Ri(i,fe.limit),hp(i,fe),Bj(fe)}})(n,e),(function(t){let i=t.bytes,r=t.limit;return i.length===r?i:i.subarray(0,r)})(e)}function g3(n){return(function(t){let i={};e:for(;!J0(t);){let r=Ml(t);switch(r>>>3){case 0:break e;case 1:i.code=Ml(t);break;case 2:i.msg=Z0(t,Ml(t));break;case 3:{let a=R3(t);i.data=S3(t),t.limit=a;break}default:Vj(t,7&r)}}return i})({bytes:e=n,offset:0,limit:e.length});var e}function S3(n){let e={};e:for(;!J0(n);){let t=Ml(n);switch(t>>>3){case 0:break e;case 1:e.requestId=Z0(n,Ml(n));break;case 2:e.requestType=Ml(n)>>>0;break;case 3:e.scorePorn=Q0(n);break;case 4:e.scoreSexy=Q0(n);break;case 5:e.scoreNeutral=Q0(n);break;case 6:e.requestScene=Ml(n)>>>0;break;case 7:e.scene=Ml(n)>>>0;break;default:Vj(n,7&t)}}return e}function T3(n,e){let t=n.service;t!==void 0&&(Ri(e,8),Ri(e,t));let i=n.vendor;i!==void 0&&(Ri(e,16),Ri(e,i));let r=n.token;r!==void 0&&(Ri(e,26),nh(e,r));let a=n.callbackUrl;a!==void 0&&(Ri(e,34),nh(e,a))}function R3(n){let e=Ml(n),t=n.limit;return n.limit=n.offset+e,t}function Vj(n,e){switch(e){case 0:for(;128&jj(n););break;case 2:OV(n,Ml(n));break;case 5:OV(n,4);break;case 1:OV(n,8);break;default:throw new Error("Unimplemented type: "+e)}}let Fj=new Float32Array(1);new Uint8Array(Fj.buffer);let IV=new Float64Array(1),qs=new Uint8Array(IV.buffer);function Qa(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let Xg=[];function wV(){let n=Xg.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function Bj(n){Xg.push(n)}function OV(n,e){if(n.offset+e>n.limit)throw new Error("Skip past limit");n.offset+=e}function J0(n){return n.offset>=n.limit}function Jg(n,e){let t=n.bytes,i=n.offset,r=n.limit,a=i+e;if(a>t.length){let s=new Uint8Array(2*a);s.set(t),n.bytes=s}return n.offset=a,a>r&&(n.limit=a),i}function wE(n,e){let t=n.offset;if(t+e>n.limit)throw new Error("Read past limit");return n.offset+=e,t}function Z0(n,e){let t=wE(n,e),i=String.fromCharCode,r=n.bytes,a="�",s="";for(let o=0;o<e;o++){let c,d,l,h,_=r[o+t];128&_?(224&_)==192?o+1>=e?s+=a:(c=r[o+t+1],(192&c)!=128?s+=a:(h=(31&_)<<6|63&c,h<128?s+=a:(s+=i(h),o++))):(240&_)==224?o+2>=e?s+=a:(c=r[o+t+1],d=r[o+t+2],(49344&(c|d<<8))!=32896?s+=a:(h=(15&_)<<12|(63&c)<<6|63&d,h<2048||h>=55296&&h<=57343?s+=a:(s+=i(h),o+=2))):(248&_)==240?o+3>=e?s+=a:(c=r[o+t+1],d=r[o+t+2],l=r[o+t+3],(12632256&(c|d<<8|l<<16))!=8421504?s+=a:(h=(7&_)<<18|(63&c)<<12|(63&d)<<6|63&l,h<65536||h>1114111?s+=a:(h-=65536,s+=i(55296+(h>>10),56320+(1023&h)),o+=3))):s+=a:s+=i(_)}return s}function nh(n,e){let t=e.length,i=0;for(let s=0;s<t;s++){let o=e.charCodeAt(s);o>=55296&&o<=56319&&s+1<t&&(o=(o<<10)+e.charCodeAt(++s)-56613888),i+=o<128?1:o<2048?2:o<65536?3:4}Ri(n,i);let r=Jg(n,i),a=n.bytes;for(let s=0;s<t;s++){let o=e.charCodeAt(s);o>=55296&&o<=56319&&s+1<t&&(o=(o<<10)+e.charCodeAt(++s)-56613888),o<128?a[r++]=o:(o<2048?a[r++]=o>>6&31|192:(o<65536?a[r++]=o>>12&15|224:(a[r++]=o>>18&7|240,a[r++]=o>>12&63|128),a[r++]=o>>6&63|128),a[r++]=63&o|128)}}function hp(n,e){let t=Jg(n,e.limit),i=n.bytes,r=e.bytes;for(let a=0,s=e.limit;a<s;a++)i[a+t]=r[a]}function jj(n){return n.bytes[wE(n,1)]}function NV(n,e){let t=Jg(n,1);n.bytes[t]=e}function Q0(n){let e=wE(n,8),t=n.bytes;return qs[0]=t[e++],qs[1]=t[e++],qs[2]=t[e++],qs[3]=t[e++],qs[4]=t[e++],qs[5]=t[e++],qs[6]=t[e++],qs[7]=t[e++],IV[0]}function TA(n,e){let t=Jg(n,8),i=n.bytes;IV[0]=e,i[t++]=qs[0],i[t++]=qs[1],i[t++]=qs[2],i[t++]=qs[3],i[t++]=qs[4],i[t++]=qs[5],i[t++]=qs[6],i[t++]=qs[7]}function Ml(n){let e,t=0,i=0;do e=jj(n),t<32&&(i|=(127&e)<<t),t+=7;while(128&e);return i}function Ri(n,e){for(e>>>=0;e>=128;)NV(n,127&e|128),e>>>=7;NV(n,e)}function Ii(n,e){let t=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,a=r===0?i===0?t<16384?t<128?1:2:t<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,s=Jg(n,a),o=n.bytes;switch(a){case 10:o[s+9]=r>>>7&1;case 9:o[s+8]=a!==9?128|r:127&r;case 8:o[s+7]=a!==8?i>>>21|128:i>>>21&127;case 7:o[s+6]=a!==7?i>>>14|128:i>>>14&127;case 6:o[s+5]=a!==6?i>>>7|128:i>>>7&127;case 5:o[s+4]=a!==5?128|i:127&i;case 4:o[s+3]=a!==4?t>>>21|128:t>>>21&127;case 3:o[s+2]=a!==3?t>>>14|128:t>>>14&127;case 2:o[s+1]=a!==2?t>>>7|128:t>>>7&127;case 1:o[s]=a!==1?128|t:127&t}}function P_(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}let Gj=new Map([["moderation",1],["supervise",2]]);class v3 extends Sr{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(Lr.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Pn(t=e.map(i=>Gj.get(i)||0)).call(t,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),F(this,"name","AgoraRTCVideoContentInspect"),F(this,"_connectionState",it.CONNECTING),F(this,"_innerConnectionState",void 0),F(this,"sequence",0),F(this,"inspectStartTime",void 0),F(this,"workerManagerConnection",void 0),F(this,"workerConnection",void 0),F(this,"workerMessageLengthLimit",void 0),F(this,"inspectIntervalMinimum",void 0),F(this,"qualityRatio",void 0),F(this,"_connectInfo",void 0),F(this,"_cancelTokenSource",mr.CancelToken.source()),F(this,"_retryConfig",void 0),F(this,"wmSequence",0),F(this,"inspectInterval",void 0),F(this,"inspectTimer",null),F(this,"ossFilePrefix",void 0),F(this,"extraInfo",void 0),F(this,"_inspectType",void 0),F(this,"_inspectMode",void 0),F(this,"_quality",1),F(this,"qualityTimer",null),F(this,"_inspectId",void 0),F(this,"_needWorkUrlOnly",!1),F(this,"inspectImage",()=>{if(this.connectionState!==it.CONNECTED)throw new J(M.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===it.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ht(5,"inspect-"),this.workerMessageLengthLimit=B("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=B("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=B("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Pg("worker-manager-"+this._inspectId,Yr),this.on(Lr.STATE_CHANGE,(t,i)=>{this._innerConnectionState=t,I.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ba[t]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Pg("worker-"+this._inspectId,Yr),this.handleWorkerEvents()}async init(e,t){this.emit(Lr.STATE_CHANGE,ba.CONNECT_AP),this._connectInfo=e;let i=this._cancelTokenSource.token;return this._retryConfig=t,new se((r,a)=>{this.on(Lr.CONNECTION_STATE_CHANGE,(s,o)=>{o===it.CONNECTED&&r()}),this.requestAP(e,i,t).then(s=>{this.connectWorkerManager(s)}).catch(s=>{a(s)})})}async requestAP(e,t,i){let r=B("WEBCS_DOMAIN").map(o=>"https://".concat(o,"/api/v1")),a=await(function(o,c,d,l){let{appId:h,areaCode:_,cname:f,sid:m,token:S,uid:T}=c;CR++;let R="image_moderation_api",C={service_name:R,json_body:JSON.stringify({appId:h,areaCode:_,cname:f,command:"allocateEdge",requestId:CR,seq:CR,sid:m,token:S,ts:Date.now(),uid:T+""})},b,N,k=o[0];return Od(async()=>{b=Date.now();let P=await kd(k,{data:C,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(N=Date.now()-b,P.code!==0){let Q=new J(M.UNEXPECTED_RESPONSE,"image inspect ap error, code"+P.code,{retry:!0,responseTime:N});throw I.error(Q.toString()),Q}let U=JSON.parse(P.json_body);if(U.code!==200){let Q=new J(M.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(U.code,", reason: ").concat(U.reason),{code:U.code,responseTime:N});throw I.error(Q.toString()),Q}if(!U.servers||!Array.isArray(U.servers)||U.servers.length===0){let Q=new J(M.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:U.code,responseTime:N});throw I.error(Q.toString()),Q}let W=B("VIDEO_INSPECT_WORKER_MANAGER_HOST"),z=B("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:U.servers.map(Q=>{let{address:he,wss:Ge}=Q;if(he&&Ge)return"wss://".concat(he.replace(/\./g,"-"),".").concat(W,":").concat(z||Ge)}).filter(Q=>!!Q),workerToken:U.workerToken,vid:U.vid,responseTime:N}},(P,U)=>(Te.apworkerEvent(m,{success:!0,sc:200,serviceName:R,responseDetail:JSON.stringify(P.addressList),firstSuccess:U===0,responseTime:N,serverIp:o[U%o.length]}),!1),(P,U)=>(Te.apworkerEvent(m,{success:!1,sc:P.data&&P.data.code||200,serviceName:R,responseTime:N,serverIp:o[U%o.length]}),!!(P.code!==M.OPERATION_ABORTED&&P.code!==M.UNEXPECTED_RESPONSE||P.data&&P.data.retry)&&(k=o[(U+1)%o.length],!0)),l)})(r,e,t,i);this.emit(Lr.STATE_CHANGE,ba.AP_CONNECTED);let{addressList:s}=a;return this.wmSequence++,s}async connectWorkerManager(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=t,this.emit(Lr.STATE_CHANGE,ba.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(_t.CONNECTED,async()=>{this.emit(Lr.STATE_CHANGE,ba.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(_t.CLOSED,()=>{this._innerConnectionState<ba.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(_t.FAILED,()=>{this._innerConnectionState<ba.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(_t.RECONNECTING,()=>{this._innerConnectionState<ba.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(_t.ON_MESSAGE,async e=>{this.emit(Lr.STATE_CHANGE,ba.GET_WORKER_MANAGER_RESPONSE);let t=this.workerManagerConnection.url;this.workerManagerConnection.close();let i=JSON.parse(e.data);if(i.code!==200)throw I.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new J(M.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&t))throw I.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new J(M.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{let r=B("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=t.replace(/:\d+\/?$/,":".concat(r));this.emit(Lr.STATE_CHANGE,ba.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(Lr.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(_t.WILL_RECONNECT,(e,t,i)=>{i(e)}),this.workerManagerConnection.on(_t.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(_t.CONNECTED,async()=>{this.emit(Lr.STATE_CHANGE,ba.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=it.CONNECTED}),this.workerConnection.on(_t.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let i=g3(new Uint8Array(e.data));if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&I.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Lr.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var t;let r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=Pn(t=Object.keys(r)).call(t,(o,c)=>r[o]>r[c]?o:c,"porn"),s=Object.keys(r).find(o=>o===a);this.emit(Lr.INSPECT_RESULT,s)}else this.emit(Lr.INSPECT_RESULT,void 0,new J(M.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Lr.INSPECT_RESULT,void 0,new J(M.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else I.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Lr.INSPECT_RESULT,void 0,new J(M.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(_t.CLOSED,()=>{this.connectionState=it.CLOSED}),this.workerConnection.on(_t.FAILED,()=>{this.connectionState=it.CLOSED}),this.workerConnection.on(_t.RECONNECTING,()=>{this.connectionState=this.connectionState===it.CONNECTED?it.RECONNECTING:it.CONNECTING}),this.workerConnection.on(_t.WILL_RECONNECT,(e,t,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(_t.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(Lr.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{t(i)})})}async requestToInspectImage(){this.sequence++;let e=fi(this,Lr.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Lr.INSPECT_RESULT,void 0,new J(M.INVALID_OPERATION,"Only the track being played can be inspected"));let i=await this.generateRequestData(e,t);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Lr.INSPECT_RESULT,void 0,new J(M.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:i,cname:r,cid:a,vid:s,sid:o,uid:c}=t,d=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),h=await kB(l,i,r),_=this.sequence+"-"+a+"-"+c+"-"+d+"-"+Ht(12,""),f={appId:i,cid:a,cname:r,deviceId:"",elapse:(m=Number(d-this.inspectStartTime),{low:m|=0,high:m>>31,unsigned:m>=0}),fileSize:h.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:h,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.0",sequence:this.sequence,sid:o,timestamp:FR(d),uid:c,vid:s,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var m;this.extraInfo===void 0&&delete f.callbackData,this.ossFilePrefix===void 0&&delete f.ossFilePrefix;let S=m3(f);if(S.byteLength<this.workerMessageLengthLimit){if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let T=(function(R){for(var C=1;C<arguments.length;C++){var b=arguments[C]!=null?arguments[C]:{};C%2?P_(Object(b),!0).forEach(function(N){F(R,N,b[N])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(b)):P_(Object(b)).forEach(function(N){Object.defineProperty(R,N,Object.getOwnPropertyDescriptor(b,N))})}return R})({},f);delete T.jpg,I.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(T))}return S}{let T=this.quality*this.qualityRatio;return this.quality=T,await this.generateRequestData(e,{appId:i,cname:r,cid:a,vid:s,sid:o,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=it.CLOSED,this.emit(Lr.STATE_CHANGE,ba.CLOSED)}}let y3={name:"ContentInspect",create:function(n){let{config:e}=n;return(function(t){if(!t)throw new J(M.INVALID_PARAMS,"inspectConfig is necessary.");if(!t.inspectType||!Array.isArray(t.inspectType))throw new J(M.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let i=[...new Set(t.inspectType)];i.forEach(r=>{var a;if(!ee(a=["supervise","moderation"]).call(a,r))throw new J(M.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),t.inspectType=i}if(t&&t.extraInfo&&t.extraInfo.length>1024)throw new J(M.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(e),new v3(e)}};var Wj=X(bn.Object.getOwnPropertySymbols),Hj=dt,C3=Kl.indexOf,b3=Zd,DV=ha([].indexOf),$0=!!DV&&1/DV([1],1,-0)<0;Hj({target:"Array",proto:!0,forced:$0||!b3("indexOf")},{indexOf:function(n){var e=arguments.length>1?arguments[1]:void 0;return $0?DV(this,n,e)||0:C3(this,n,e)}});var Kj=Bn("Array","indexOf"),A3=Be,I3=Kj,PV=Array.prototype,LV=function(n){var e=n.indexOf;return n===PV||A3(PV,n)&&e===PV.indexOf?I3:e},Yj=X(LV);function zj(n,e){if(n==null)return{};var t,i,r=(function(s,o){if(s==null)return{};var c={};for(var d in s)if({}.hasOwnProperty.call(s,d)){if(Yj(o).call(o,d)!==-1)continue;c[d]=s[d]}return c})(n,e);if(Wj){var a=Wj(n);for(i=0;i<a.length;i++)t=a[i],Yj(e).call(e,t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}let qj=class{get localCapabilities(){return cr(this._localCapabilities)}get rtpCapabilities(){return cr(this._rtpCapabilities)}get candidates(){return cr(this._candidates)}get iceParameters(){return cr(this._iceParameters)}get dtlsParameters(){return cr(this._dtlsParameters)}constructor(n){F(this,"sessionDesc",void 0),F(this,"_localCapabilities",void 0),F(this,"_rtpCapabilities",void 0),F(this,"_candidates",void 0),F(this,"_iceParameters",void 0),F(this,"_dtlsParameters",void 0),F(this,"setup",void 0),F(this,"currentMidIndex",void 0),F(this,"cname","o/i14u9pJrxRKAsu"),F(this,"firefoxSsrcMidMap",new Map),n=cr(n);let{remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:r,localCapabilities:a,direction:s,setup:o,videoCodec:c,audioCodec:d}=n,l;this.setup=o,l=s===Dt.RECEIVE_ONLY?lo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):lo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=t,this._localCapabilities=a;let h=s===Dt.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_=s===Dt.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,f=s===Dt.RECEIVE_ONLY?r.send.videoCodecs:tp(ze.VIDEO,h,_,c),m=s===Dt.RECEIVE_ONLY?r.send.audioCodecs:tp(ze.AUDIO,h,_,d);for(let S of l.mediaDescriptions)S.attributes.iceUfrag=e.iceUfrag,S.attributes.icePwd=e.icePwd,S.attributes.fingerprints=t.fingerprints,S.attributes.candidates=i,S.attributes.setup=this.setup,S.media.mediaType==="application"&&(S.attributes.sctpPort="5000"),S.media.mediaType==="video"&&(S.media.fmts=f.map(T=>T.payloadType.toString(10)),S.attributes.payloads=f,S.attributes.extmaps=h.videoExtensions),S.media.mediaType==="audio"&&(S.media.fmts=m.map(T=>T.payloadType.toString(10)),S.attributes.payloads=m,S.attributes.extmaps=h.audioExtensions,f_(S));this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return ya(this.sessionDesc)}hasMid(n){return Array.isArray(n)?n.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===n)}send(n,e,t,i,r){t=t.replace(/ /g,"-");let{ssrcs:a,ssrcGroups:s}=TR(e,this.cname,B("SYNC_GROUP")?t:void 0),o=this.findPreloadMediaDesc(a);if(o){if(jr()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,o.attributes.mid),r&&(r.twcc||r.remb)){let c=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(o,r),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{let c=this.findAvailableMediaIndex(n,a,i),d;return c===-1?(d=this.createOrRecycleSendMedia(n,a,s,"sendonly",i,r),this.updateBundleMids()):(d=cr(this.sessionDesc.mediaDescriptions[c]),d.attributes.direction="sendonly",d.attributes.ssrcs=a,d.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(d,r)),jr()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,d.attributes.mid),{needExchangeSDP:!0,mid:d.attributes.mid}}}stopSending(n){let e=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&n.indexOf(t.attributes.mid)!==-1);if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(t=>{t.attributes.ssrcs=[]}),this.updateBundleMids()}receive(n,e,t){let i=[];return n.forEach(r=>{let a=r._mediaStreamTrack.kind,s=this.findAvailableRecvMediaIndex(a),o,c=!1;s===-1?(c=!0,o=this.createOrRecycleRecvMedia(r,[],"recvonly",e,t),this.updateBundleMids()):(o=cr(this.sessionDesc.mediaDescriptions[s]),o.attributes.direction="recvonly"),i.push({mid:o.attributes.mid,needCreateTransceiver:c})}),i}stopReceiving(n){let e=this.sessionDesc.mediaDescriptions.filter(t=>n.indexOf(t.attributes.mid)!==-1);if(e.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(t=>{t.media.port="0",t.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(n){let{foundation:e,protocol:t,address:i,port:r,type:a,relatedAddress:s,relatedPort:o,priority:c}=new RTCIceCandidate(n),d={foundation:e??"",componentId:"1",transport:t??"",priority:c?c+"":"",connectionAddress:i??"",port:r?r+"":"",type:a?a+"":"",relAddr:s??"",relPort:o?o+"":"",extension:{}};this.candidates.some(l=>l.priority===d.priority&&l.connectionAddress===d.connectionAddress&&l.port===d.port)||(this._candidates.push(d),this.sessionDesc.mediaDescriptions.forEach(l=>{l.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(n,e,t,i,r){let a=n._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,o=tp(a,s,this.localCapabilities.send,a===ze.AUDIO?r:i),c=a===ze.VIDEO?s.videoExtensions:s.audioExtensions,d="".concat(++this.currentMidIndex),l={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:t,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};l=this.mungRecvMediaDsec(l,n);let h=this.findFirstClosedMedia(a);if(h){let _=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[_]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}muteRemote(n){let e=this.sessionDesc.mediaDescriptions.filter(t=>ee(n).call(n,t.attributes.mid||""));if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(t=>{t.attributes.direction="inactive"})}unmuteRemote(n){let e=this.sessionDesc.mediaDescriptions.filter(t=>ee(n).call(n,t.attributes.mid||""));if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(t=>{t.attributes.direction="recvonly"})}findAvailableMediaIndex(n,e,t){return this.sessionDesc.mediaDescriptions.findIndex(i=>{let r=i.media.mediaType===n&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(jr()){if(r){let a=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return r&&i.attributes.mid===t})}findAvailableRecvMediaIndex(n){return this.sessionDesc.mediaDescriptions.findIndex(e=>{let t=e.media.mediaType===n&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&t})}predictReceivingMids(n){let e=[];for(let t=0;t<n;t++)e.push((this.currentMidIndex+t+1).toString(10));return e}restartICE(n){n=cr(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=n.iceUfrag,e.attributes.icePwd=n.icePwd})}createOrRecycleSendMedia(n,e,t,i,r,a){let s=this.rtpCapabilities.send,o=n===ze.VIDEO?s.videoCodecs:s.audioCodecs,c=n===ze.VIDEO?s.videoExtensions:s.audioExtensions;jr()&&(r="".concat(++this.currentMidIndex));let d={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:t,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};d=this.mungSendMediaDesc(d,a);let l=this.findFirstClosedMedia(n);if(l){let h=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[h]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}mungRecvMediaDsec(n,e,t){let i=cr(n);return pE(i),ep(i,e),jb(i,e),zO(i),Gb(i,t,this.localCapabilities.send),i}mungSendMediaDesc(n,e){let t=cr(n);return Gb(t,e,this.localCapabilities.recv),f_(t),t}updateRecvMedia(n,e){let t=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===n);if(t!==-1){let i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[t],e);this.sessionDesc.mediaDescriptions[t]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>n.media.port!=="0").map(n=>n.attributes.mid)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(e=>{var t;return((t=e.attributes)===null||t===void 0||(t=t.ssrcs[0])===null||t===void 0?void 0:t.ssrcId)===n[0].ssrcId})}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(e=>jr()?e.media.port==="0"&&e.media.mediaType===n:e.media.port==="0")}},Xj=["sdp"];var lr;function nr(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function L_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?nr(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):nr(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let k_=(lr=class rN extends TU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return(e=(t=this.peerConnection.getReceivers()[0])===null||t===void 0||(t=t.transport)===null||t===void 0?void 0:t.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,t,i){super(e,t),F(this,"direction",void 0),F(this,"name",void 0),F(this,"store",void 0),F(this,"spec",void 0),F(this,"peerConnection",void 0),F(this,"initialOffer",void 0),F(this,"transport",void 0),F(this,"statsFilter",void 0),F(this,"localCandidateCount",0),F(this,"_isInRestartIce",!1),F(this,"mutex",void 0),F(this,"onLocalCandidate",void 0),F(this,"remoteSDP",void 0),F(this,"pendingCandidates",[]),F(this,"localCapabilities",void 0),F(this,"isReady",!1),F(this,"restartCnt",0),F(this,"curTurnServerIndex",0),this.store=t,this.spec=e,this.mutex=new xa("P2PConnection-mutex",t.clientId),this.peerConnection=new RTCPeerConnection(rN.resolvePCConfiguration(e,t.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Dt.SEND_ONLY,this.name=this.direction===Dt.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=R1(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{let t=await wU();if(this.localCapabilities=Ec(t),e){let{sdp:i}=e,r=zj(e,Xj),a=(function(){let l={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},h=SR(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ld(h,l,"videoExtensions",_,f,m),Ld(h,l,"videoCodecs",_,f,m),Ld(h,l,"audioExtensions",_,f,m),Ld(h,l,"audioCodecs",_,f,m),B("RAISE_H264_BASELINE_PRIORITY")){let S=m.videoCodecs.findIndex(T=>T.rtpMap&&T.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&T.fmtp&&T.fmtp.parameters["profile-level-id"]==="42001f");if(S!==-1){let T=m.videoCodecs.findIndex(R=>R.rtpMap&&R.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(T<S){I.debug("raising H264 baseline profile priority");let R=m.videoCodecs[S];m.videoCodecs.splice(S,1),m.videoCodecs.splice(T,0,R)}T!==-1&&B("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(R=>!(R.rtpMap&&R.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&R.fmtp&&R.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:_,recv:f,sendrecv:m}})({},{},i);this.remoteSDP=new qj({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let o=bl(s.sdp);await this.peerConnection.setLocalDescription(s);let c=await OU({},{},s.sdp);this.localCapabilities=Ec(c);let d=this.peerConnection.getTransceivers()[0];return d!=null&&d.receiver&&d.receiver.transport&&this.tryBindTransportEvents(d.receiver.transport),L_(L_({},o),{},{sdp:s.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=bl(i.sdp);return this.initialOffer=i,L_(L_({},r),{},{sdp:i.sdp})}}catch(t){throw new L(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:t,iceParameters:i,dtlsParameters:r}=e,a=await OU({},{},t);this.remoteSDP=new qj({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let s=this.peerConnection.getTransceivers()[0];s!=null&&s.sender&&s.sender.transport&&this.tryBindTransportEvents(s.sender.transport)}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(t=>{this.peerConnection.addIceCandidate(t)}),this.pendingCandidates=[])}catch(t){throw new L(M.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(t.toString()))}}send(e,t,i){var r=this;return cc(function*(){let a=yield di(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let s=[],o=r.remoteSDP.receive(e,t,i);e.forEach((T,R)=>{if(o[R].needCreateTransceiver){let C=r.peerConnection.addTransceiver(T._mediaStreamTrack,{direction:"sendonly"});s.push(C),T._updateRtpTransceiver(C)}else{let C=r.peerConnection.getTransceivers().find(b=>b.mid===o[R].mid);if(!C)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(o[R].mid));s.push(C),T._updateRtpTransceiver(C)}}),jr()&&B("SIMULCAST")===!0&&(yield di(r.applySimulcastForFirefox(s,e)));let c=o.map(T=>T.mid),d=yield di(r.peerConnection.createOffer()),l=r.mungSendOfferSDP(d.sdp,e,c),h=lo(l),_=c.map(T=>{let R=h.mediaDescriptions.find(C=>C.attributes.mid===T);if(!R)throw new Error("Cannot extract ssrc from mediaDescription.");return __(R,B("USE_PUB_RTX"))}),f=s.map((T,R)=>{let C=c[R];return{localSSRC:_[R],id:C}});yield di(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));try{yield f}catch(T){let R=r.remoteSDP.toString();throw yield di(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield di(r.peerConnection.setRemoteDescription({type:"answer",sdp:R})),yield di(r.stopSending(c,!0)),T}yield di(r.applySimulcastEncodings(s,e)),yield di(r.applySendEncodings(s,e));let m=r.remoteSDP.toString();return r.logSDPExchange(l,"offer","local","send")?.(m),yield di(r.setRemoteDescription({type:"answer",sdp:m})),s.map((T,R)=>{let C=c[R];return{localSSRC:_[R],id:C}})}catch(s){throw s instanceof L?s:new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{a()}})()}async stopSending(e,t){let i=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getTransceivers().filter(c=>e.indexOf(c.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(c=>{var d;c.direction="inactive",(d=c.stop)===null||d===void 0||d.call(c)});let a=await this.peerConnection.createOffer(),s=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);let o=this.remoteSDP.toString();s?.(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,t,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:a,needExchangeSDP:s}=this.remoteSDP.send(e,t,i,r);if(s){let c=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});let l=await this.peerConnection.createAnswer(),h=this.mungReceiveAnswerSDP(l.sdp,a,e);d?.(h||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:h}),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));let o=this.peerConnection.getTransceivers().find(c=>c.mid===a);if(!o||o.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,mid:o.mid,transceiver:o}}catch(a){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async mockReceive(e,t,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:a,needExchangeSDP:s}=this.remoteSDP.send(e,t,i,r);if(s){let o=this.remoteSDP.toString(),c=this.logSDPExchange(o,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:o});let d=await this.peerConnection.createAnswer(),l=this.mungReceiveAnswerSDP(d.sdp,a,e);c?.(l||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:l}),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(a){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();i?.(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===a_.Auto&&(this.store.p2pTransport=a_.SdRtn,Nt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(rN.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Nt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(rN.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;let t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:i}=bl(t.sdp);return this.store.descriptionStart(),this.direction===Dt.SEND_ONLY&&await this.peerConnection.setLocalDescription(t),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Dt.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let t=await this.peerConnection.createAnswer();if(!t.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:i}=bl(t.sdp);return await this.peerConnection.setLocalDescription(t),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let a=this.remoteSDP.toString(),s=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),s?.(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new L(M.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){let i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(t)?jr()||await this.applySimulcastEncodings(i,[t]):await this.applySendEncodings(i,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let i=this.peerConnection.getTransceivers().find(r=>r.mid===t);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let t=e[0].transport.iceTransport,{local:i,remote:r}=t.getSelectedCandidatePair();return{local:L_(L_({},El),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:L_(L_({},El),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;ee(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var t;e.candidate.candidate&&((t=this.onLocalCandidate)===null||t===void 0||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r={iceServers:[]};var a;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Oi(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...rN.turnServerConfigToIceServers(e.turnServer.servers,t,i)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...rN.turnServerConfigToIceServers(e.turnServer.serversFromGateway,t,i)),ee(a=[a_.Relay,a_.SdRtn]).call(a,t)&&(r.iceTransportPolicy="relay"),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(r.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Nt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),I.debug("P2PConnection p2pTransport is ".concat(t)),r}static turnServerConfigToIceServers(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=[],a=e.filter(o=>o.tcpport);I.debug("P2PConnection turnServers is ".concat(a,", current index is ").concat(i));let s=a.length>i?a[i]:a[0];switch(t){case a_.SdRtn:let o=e.filter(d=>{var l;return ee(l=d.username).call(l,"glb:")&&d.turnServerURL==d.turnServerURL}),c=o.length>i?o[i]:o[0];c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(Yu(c.turnServerURL),":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Yu(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;case a_.Relay:s&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Yu(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}));break;default:s&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Yu(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"stun:".concat(s.turnServerURL,":").concat(s.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};let t=e.iceTransport;t&&(t.onstatechange=()=>{let i=e?.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){let{local:i,remote:r}=t.getSelectedCandidatePair()||{};if(i&&r){let a=i.address+":"+i.port,s=r.address+":"+r.port;I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Xc(a)),", remote ").concat(JSON.stringify(Xc(s))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var i;if(t||(t=this.peerConnection.getSenders().find(l=>l.track===e._mediaStreamTrack)),!t)return I.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Nt().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let r={},a={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var s;let{bitrateMax:l,frameRate:h,scaleResolutionDownBy:_}=e._encoderConfig;l&&(a.maxBitrate=1e3*l),ee(s=e._hints).call(s,Oe.LOW_STREAM)&&(h&&(a.maxFramerate=po(h)),_&&_>=1&&(a.scaleResolutionDownBy=_))}if(B("DSCP_TYPE")&&xu()){var o;let l=B("DSCP_TYPE");ee(o=["very-low","low","medium","high"]).call(o,l)&&(a.networkPriority=l)}let c=t.getParameters(),d=(i=c.encodings)===null||i===void 0?void 0:i[0];jr()&&!d&&(r.encodings=[a]),d&&Object.assign(d,a),Object.assign(c,r),I.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await t.setParameters(c)}async applySendEncodings(e,t){try{if(!Nt().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){let r=e[i],a=t[i];a instanceof Ai&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,r.sender)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,i){let r=lo(e);return t.forEach((a,s)=>{let o=i[s],c=r.mediaDescriptions.find(d=>d.attributes.mid===o);c&&(ep(c,a),Wb(c,a,this.store.codec))}),ya(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let c=0;c<e.length;c++){var i,r,a,s,o;let d=e[c],l=t[c];if(l instanceof Ai&&!ee(i=l._hints).call(i,Oe.LOW_STREAM)&&(r=l._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=l._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(s=l._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=l._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1&&this.store.codec==="vp8"){let h={},_={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];let f=d.sender.getParameters();await d.sender.setParameters(Object.assign(f,h))}}}async applySimulcastEncodings(e,t){if(!jr()&&e.length===t.length)for(let i=0;i<e.length;i++){let r=t[i];if(r instanceof Ai&&this.isVP8Simulcast(r)){let a=e[i],s={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];let c=a.sender.getParameters();await a.sender.setParameters(Object.assign(c,s))}}}isVP8Simulcast(e){var t,i,r,a,s;return!!(e instanceof Ai&&B("SIMULCAST")&&this.store.codec==="vp8"&&!ee(t=e._hints).call(t,Oe.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((s=e._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1)}logSDPExchange(e,t,i,r){if(B("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(s=>{s.direction="inactive"});let i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);let a=this.remoteSDP.toString();r?.(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async s=>{s.direction="sendonly"});let i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);let a=this.remoteSDP.toString();r?.(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}async getRemoteSSRC(e,t){var i;if(t=t??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var r;return((r=lo(t).mediaDescriptions.find(s=>s.attributes.mid===e))===null||r===void 0?void 0:r.attributes.ssrcs)?.[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),ee(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,i){let r=lo(e),a=r.mediaDescriptions.find(s=>s.attributes.mid===t);return a&&i===ze.AUDIO&&a.media.mediaType==="audio"&&f_(a),ya(r)}},$e(lr.prototype,"establish",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"establish"),lr.prototype),$e(lr.prototype,"connect",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"connect"),lr.prototype),$e(lr.prototype,"receive",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"receive"),lr.prototype),$e(lr.prototype,"mockReceive",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"mockReceive"),lr.prototype),$e(lr.prototype,"stopReceiving",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"stopReceiving"),lr.prototype),$e(lr.prototype,"restartICE",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"restartICE"),lr.prototype),$e(lr.prototype,"close",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"close"),lr.prototype),$e(lr.prototype,"updateEncoderConfig",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"updateEncoderConfig"),lr.prototype),$e(lr.prototype,"updateSendParameters",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"updateSendParameters"),lr.prototype),$e(lr.prototype,"replaceTrack",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"replaceTrack"),lr.prototype),$e(lr.prototype,"muteLocal",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"muteLocal"),lr.prototype),$e(lr.prototype,"unmuteLocal",[Gd],Object.getOwnPropertyDescriptor(lr.prototype,"unmuteLocal"),lr.prototype),lr);function Gd(n,e,t){let i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){let r=this.mutex,a=await r.lock("From P2PConnection.".concat(e));try{for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return await i.apply(this,o)}finally{a()}},t}let Ga=(function(n){return n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY",n})({});var Ul,kV,MV,UV,xV,VV,FV,BV,jV,GV,WV,Cr;function br(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function RA(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?br(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):br(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let eN=(Ul=ah(Ga.SEND_ONLY),kV=ah(Ga.SEND_ONLY),MV=ah(),UV=ah(Ga.RECEIVE_ONLY),xV=ah(Ga.RECEIVE_ONLY),VV=ah(Ga.RECEIVE_ONLY),FV=ah(Ga.RECEIVE_ONLY),BV=ah(Ga.RECEIVE_ONLY),jV=ah(Ga.RECEIVE_ONLY),GV=ah(),WV=ah(Ga.RECEIVE_ONLY),Cr=class extends Sr{get state(){return this._state}set state(n){let e=this._state;this._state=n,this.emit(Ue.StateChange,e,this._state)}constructor(n,e){super(),F(this,"isPlanB",!1),F(this,"store",void 0),F(this,"statsUploader",void 0),F(this,"sendConnection",void 0),F(this,"recvConnection",void 0),F(this,"localTrackMap",new Map),F(this,"remoteUserMap",new Map),F(this,"localDataChannels",[]),F(this,"pendingLocalTracks",[]),F(this,"pendingRemoteTracks",[]),F(this,"statsCollector",void 0),F(this,"dtlsFailedCount",0),F(this,"sendMutex",void 0),F(this,"recvMutex",void 0),F(this,"_state",Ee.Disconnected),F(this,"_restartStates",["disconnected","failed"]),F(this,"reconnectInterval",void 0),F(this,"uploadUnplinkStarted",!1),F(this,"uploadDownlinkStarted",!1),F(this,"uplinkStateUploadInterval",void 0),F(this,"downlinkStatsUploadInterval",void 0),F(this,"handleMuteLocalTrack",async(t,i,r)=>{let a=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ee.Connected)return void r(new L(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let c=this.filterTobeMutedTracks(t);if(c.length===0)return void i();let d=c.find(f=>f[0]==="videoLowTrack");d&&d[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(c.map(f=>{let[,{id:m}]=f;return m}));let l=!1;var s,o;t.trackMediaType==="video"?l=!((s=this.localTrackMap.get(Ae.LocalAudioTrack))===null||s===void 0||!s.track._muted):l=((o=this.localTrackMap.get(Ae.LocalVideoTrack))===null||o===void 0?void 0:o.id)===void 0;let h=this.createMuteMessage(c);await zt(this,Ue.RequestMuteLocal,h);let _=t.trackMediaType==="video"?Pd.MUTE_LOCAL_VIDEO:Pd.MUTE_LOCAL_AUDIO;await zt(this,Ue.RequestP2PMuteLocal,{action:_,message:h,isMuteAll:l}),i()}catch(c){r(c)}finally{a()}}),F(this,"handleUnmuteLocalTrack",async(t,i,r)=>{let a=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ee.Connected)return void r(new L(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let s=this.filterTobeUnmutedTracks(t);if(s.length===0)return void i();await this.sendConnection.unmuteLocal(s.map(d=>{let[,{id:l}]=d;return l}));let o=this.createUnmuteMessage(s),c=t.trackMediaType==="video"?Pd.UNMUTE_LOCAL_VIDEO:Pd.UNMUTE_LOCAL_AUDIO;await zt(this,Ue.RequestP2PMuteLocal,{action:c,message:o}),i()}catch(s){r(s)}finally{a()}}),F(this,"handleUpdateVideoEncoder",async(t,i,r,a)=>{let s;typeof a=="boolean"&&a||(s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let c=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==t||this.state!==Ee.Connected)return void i();let{id:d,track:l}=c;d&&(await this.sendConnection.updateSendParameters(d,l),await this.sendConnection.updateEncoderConfig(d,l),this.emit(Ue.UpdateVideoEncoder,l)),i()}catch(c){r(c)}finally{var o;(o=s)===null||o===void 0||o()}}),F(this,"handleUpdateVideoSendParameters",async(t,i,r)=>{let a=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let s=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.sendConnection||!s||s.track!==t||this.state!==Ee.Connected)return void i();let{id:o,track:c}=s;o&&await this.sendConnection.updateSendParameters(o,c),i()}catch(s){r(s)}finally{a()}}),F(this,"handleReplaceTrack",async(t,i,r,a)=>{let s;I.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),typeof a=="boolean"&&a||(s=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var o;let d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return t===h});if(!this.sendConnection||!d||d[1].id===void 0||this.state!==Ee.Connected)return void i();if(await((o=this.sendConnection)===null||o===void 0?void 0:o.replaceTrack(t,d[1].id)),d[0]===Ae.LocalVideoTrack&&Nt().supportDualStreamEncoding){let l=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(l){let h=t._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=h,l.track._originMediaStreamTrack=h,await new se((_,f)=>{this.handleReplaceTrack(l.track,_,f,!0)})}}i()}catch(d){r(d)}finally{var c;(c=s)===null||c===void 0||c()}}),F(this,"handleGetLocalVideoStats",t=>{t(this.statsCollector.getLocalVideoTrackStats())}),F(this,"handleGetLocalAudioStats",t=>{t(this.statsCollector.getLocalAudioTrackStats())}),F(this,"handleGetRemoteVideoStats",t=>this.statsCollector.getRemoteVideoTrackStats(t.uid)[t.uid]),F(this,"handleGetRemoteAudioStats",t=>this.statsCollector.getRemoteAudioTrackStats(t.uid)[t.uid]),this.store=n,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new ex(n),this.bindStatsUploaderEvents(),this.sendMutex=new xa("P2PChannel2-send-mutex",n.clientId),this.recvMutex=new xa("P2PChannel2-recv-mutex",n.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(t=>{t&&(t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))})},B("ICE_RESTART_INTERVAL"))}async startP2PConnection(n,e){throw new L(M.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(n){throw new L(M.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(n,e){let t;try{if(e){this.recvConnection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),t=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new k_(n,this.store,Dt.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Ee.New,this.sendConnection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),t=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new k_(n,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{t&&t()}}async p2pConnect(n){if(!this.sendConnection)throw new L(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(n),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ee.Connected}async addRemoteCandidate(n,e){if(e===Dt.RECEIVE_ONLY){if(!this.sendConnection)throw new L(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(n)}else{if(!this.recvConnection)throw new L(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(n)}}publish(n,e,t){var i=this;return cc(function*(){let r=yield di(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Ee.Connected){i.throwIfTrackTypeNotMatch(n);let d=n.filter(l=>i.pendingLocalTracks.indexOf(l)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(d))}i.store.pubId=i.store.pubId+1,Ia.markPublishStart(i.store.clientId,i.store.pubId);let a=i.filterTobePublishedTracks(n,e,t);if(a.length===0)return void(yield di(i.tryToUnmuteAudio(n)));a.forEach(d=>{let{track:l,type:h}=d,_=Date.now();i.store.publish(l.getTrackId(),h===Ae.LocalAudioTrack?"audio":"video",_)}),i.bindLocalTrackEvents(a);let s=yield di(i.sendConnection.send(a.map(d=>{let{track:l}=d;return l}),i.store.codec,i.store.audioCodec)),o=(yield di(s.next())).value,c=i.createGatewayPublishMessage(a,o);try{yield c}catch(d){throw s.throw(d),d?.code===M.WS_ABORT&&a.forEach(l=>{let{track:h}=l;i.pendingLocalTracks.indexOf(h)===-1&&i.pendingLocalTracks.push(h)}),i.unbindLocalTrackEvents(a),d}yield di(s.next()),a.forEach(d=>{let{type:l}=d;i.statsCollector.addLocalStats(l)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(a,o),a.forEach(d=>{let{track:l,type:h}=d,_=Date.now();i.store.publish(l.getTrackId(),h===Ae.LocalAudioTrack?"audio":"video",void 0,_)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(n){if(!this.sendConnection||this.state!==Ee.Connected)return void(n.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!ee(n).call(n,r)));let e=this.filterTobeUnpublishedTracks(n);if(e.length===0)return;let t=e.find(r=>r[0]==="videoLowTrack");t&&t[1].track.close();let i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:a}]=r;return a})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[a,{track:s}]=r;return{type:a,track:s}})),e.forEach(r=>{let[a]=r;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ee.Connected)return t&&t[1].track.close(),i;n.forEach(r=>{let a=this.pendingLocalTracks.indexOf(r);a!==-1&&this.pendingLocalTracks.splice(a,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let n=()=>{let e=[],t=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a,ssrcs:s}]=i,o={stream_type:n0(a,r),ssrcs:s};a._muted||!a._enabled?e.push(o):t.push(o)}),e.length>0&&e.forEach(i=>{zt(this,Ue.RequestMuteLocal,[i])}),t.length>0&&t.forEach(i=>{zt(this,Ue.RequestUnmuteLocal,[i])})};n(),this.uplinkStateUploadInterval=window.setInterval(()=>{n()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(n){return cc(function*(){throw new L(M.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(I.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await kn(this,Ue.RequestRePublish,this.pendingLocalTracks),this.emit(Ue.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new L(M.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(n,e,t,i){var r;if(!this.recvConnection)throw new L(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(n))!==null&&r!==void 0&&r.has(e))return;let{track:a,mid:s,transceiver:o}=await this.recvConnection.receive(e,[{ssrcId:t}],String(n.uid),i);e===ze.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(a):(n._audioTrack=new Wu(a,n.uid,n._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),o&&n._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoSSRC=t,n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(a):(n._videoTrack=new Og(a,n.uid,n._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),o&&n._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(n,n._videoTrack));let c=this.remoteUserMap.get(n);c?c.set(e,s):this.remoteUserMap.set(n,new Map([[e,s]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let d=this.pendingRemoteTracks.findIndex(l=>{let{user:h,kind:_}=l;return h.uid===n.uid&&e===_});d!==-1&&(this.pendingRemoteTracks.splice(d,1),this.emit(Ue.MediaReconnectEnd,n.uid))}async mockSubscribe(n,e,t,i){if(!this.recvConnection)throw new L(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:t}],String(n.uid),i)}async unsubscribe(n,e,t){let i=this.pendingRemoteTracks.filter(a=>{let{user:s,kind:o}=a;return e!==void 0?s.uid===n.uid&&e===o:s.uid===n.uid});if(i.forEach(a=>{let s=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(s,1)}),this.recvConnection||t||i.forEach(a=>{let{kind:s}=a;var o;if(s===ze.AUDIO)(o=n._audioTrack)===null||o===void 0||o._destroy(),n._audioTrack=void 0;else if(s===ze.VIDEO){var c;(c=n._videoTrack)===null||c===void 0||c._destroy(),n._videoTrack=void 0}}),!this.recvConnection)return;let r=this.filterTobeUnSubscribedTracks(n,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(a=>{let[,{id:s}]=a;return s})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(a=>{let[s,{kind:o}]=a;var c,d;if(o===ze.VIDEO&&s._videoSSRC&&((c=this.recvConnection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===ze.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),t||((d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0);else if(o===ze.AUDIO){var l;this.unbindRemoteTrackEvents(s._audioTrack),!t&&((l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0)}}),r.forEach(a=>{let[,{kind:s}]=a;zt(this,Ue.RequestP2PMuteRemote,s)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let n=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,t]=e;[ze.VIDEO,ze.AUDIO].forEach(i=>{t.has(i)?zt(this,Ue.RequestP2PUnmuteRemote,i):zt(this,Ue.RequestP2PMuteRemote,i)})});n(),this.downlinkStatsUploadInterval=window.setInterval(()=>{n()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(n){throw new L(M.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(n){throw new L(M.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(n){throw new L(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(n){throw new L(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(n,e){if(!this.recvConnection)return;let t=this.remoteUserMap.get(n);if(!t)return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid,"."));if(!t.get(e))return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid," media type ").concat(e,"."));let i=e===ze.VIDEO?n._videoSSRC:n._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(n,e){return this.unmuteRemoteNoLock(n,e)}async unmuteRemoteNoLock(n,e){if(!this.recvConnection)return;let t=this.remoteUserMap.get(n);if(!t)return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid,"."));t.get(e)||I.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(e,"."))}getAllTracks(n){let e=this.localTrackMap.get(Ae.LocalAudioTrack);if(e?.track instanceof Un){let t=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==Ae.LocalAudioTrack}).filter(i=>{let[r]=i;return!(n&&r===Ae.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(t.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[i]=t;return!(n&&i===Ae.LocalVideoLowTrack)}).map(t=>{let[,{track:i}]=t;return i})}reportPublishEvent(n,e,t,i,r){if(n){let s=this.localTrackMap.get(Ae.LocalAudioTrack),o=i?this.localTrackMap.get(Ae.LocalVideoLowTrack):this.localTrackMap.get(Ae.LocalVideoTrack);Te.publish(this.store.sessionId,{eventElapse:Ia.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:e,audioName:s?.track.getTrackLabel(),videoName:o?.track.getTrackLabel(),screenshare:o?.track._hints.indexOf(Oe.SCREEN_TRACK)!==-1,audio:!!s,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;t||(t=[]);let s=t.find(c=>c instanceof Ti),o=i?(a=this.localTrackMap.get(Ae.LocalVideoTrack))===null||a===void 0?void 0:a.track:t.find(c=>c instanceof Ai);Te.publish(this.store.sessionId,{eventElapse:Ia.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:e,audioName:s?.getTrackLabel(),videoName:o?.getTrackLabel(),screenshare:o?._hints.indexOf(Oe.SCREEN_TRACK)!==-1,audio:!!s,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(n,e,t,i){let r=i===ze.VIDEO?t._videoSSRC:t._audioSSRC;r&&Te.subscribe(this.store.sessionId,{succ:n,ec:e,video:i===ze.VIDEO,audio:i===ze.AUDIO,peerid:t.uid,subscribeRequestid:i===ze.VIDEO?t._videoSSRC:t._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ia.measureFromSubscribeStart(this.store.clientId,r)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new xa("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new xa("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let n=this.localTrackMap.get(Ae.LocalAudioTrack);if(n?.track instanceof Un){if(n.track.trackList.length>0){let e=n.track;n.track.trackList.forEach(t=>{e.removeAudioTrack(t)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ee.Disconnected}getStats(n){var e,t;return n?(t=this.recvConnection)===null||t===void 0?void 0:t.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(n){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){let n=this.localTrackMap.get(Ae.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){let n=this.localTrackMap.get(Ae.LocalVideoTrack);if(n)return{width:n.track.videoWidth||0,height:n.track.videoHeight||0}}getEncoderConfig(n){let e=this.localTrackMap.get(n);return e&&e.track instanceof Ai||e&&e.track instanceof Ti?e.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,e){if(!n)return this.remoteUserMap.size>0;let t=this.remoteUserMap.get(n);return!!t&&(!e||t.has(e))}async hasRemoteMediaWithLock(n,e){if(!n)return this.remoteUserMap.size>0;let t=this.remoteUserMap.get(n);return!!t&&(!e||t.has(e))}getRemoteMedia(n){var e;let t=Array.from(Lo(e=this.remoteUserMap).call(e)).find(i=>i.uid===n);return t?{audioTrack:t.audioTrack,audioSSRC:t._audioSSRC,videoTrack:t.videoTrack,videoSSRC:t._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(t=>{let[i]=t;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}),e=this.localTrackMap.get(Ae.LocalAudioTrack);return e&&n.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=vt(n).call(n,(t,i)=>t.level-i.level),n}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(I.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ee.Reconnecting,B("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[e]=n;var t;e._videoTrack&&e._videoTrack._player&&((t=e._videoTrack._player.getVideoElement())===null||t===void 0||t.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(n=>{var e;let[t,{track:i}]=n;switch(t){case Ae.LocalVideoTrack:ee(e=i._hints).call(e,Oe.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case Ae.LocalAudioTrack:i instanceof Un?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case Ae.LocalVideoLowTrack:}}),this.emit(Ue.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[e,t]=n;Array.from(Lo(t).call(t)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Ue.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),I.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(n,e){for(let t of this.pendingRemoteTracks){let{user:i,kind:r}=t;if((n instanceof g_?n.uid:n)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(n,e){this.hasPendingRemoteMedia(n,e)||this.pendingRemoteTracks.push({user:n,kind:e})}async restartICE(n,e){let t,i;if(n===Dt.SEND_ONLY){if(!this.sendConnection)throw new L(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");t=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new L(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");t=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){let r=await i.restartICE(e);return i.isInRestartIce=!1,r}{let r=await i.restartICE();if(r){let a=await kn(this,Ue.RequestP2PRestartICE,{direction:Dt.RECEIVE_ONLY,iceParameter:r});await i.restartICE(a),i.isInRestartIce=!1}}}finally{t()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let n=this.sendConnection.getStats(),e=this.localTrackMap.get(Ae.LocalVideoTrack),t=this.localTrackMap.get(Ae.LocalAudioTrack),i=n.videoSend.find(f=>{var m;return f.ssrc===(e==null||(m=e.ssrcs)===null||m===void 0?void 0:m[0].ssrcId)}),r=n.audioSend.find(f=>{var m;return f.ssrc===(t==null||(m=t.ssrcs)===null||m===void 0?void 0:m[0].ssrcId)});if(!i||!r)return 1;let a=fi(this,Ue.NeedSignalRTT),s=i?i.rttMs:void 0,o=r?r.rttMs:void 0,c=s&&o?(s+o)/2:s||o,d=(c&&a?(c+a)/2:c||a)||0,l=100*n.sendPacketLossRate*.7/50+.3*d/1500,h=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,_=e?.track;if(_&&_._encoderConfig&&_._hints.indexOf(Oe.SCREEN_TRACK)===-1){let f=_._encoderConfig.bitrateMax,m=n.bitrate.actualEncoded;if(f&&m){let S=(1e3*f-m)/(1e3*f);return BB[S<.15?0:S<.3?1:S<.45?2:S<.6?3:4][h]}}return h}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let n=this.recvConnection.getStats(),e=0;return Array.from(this.remoteUserMap.entries()).forEach(t=>{let[i]=t,r=i._audioSSRC,a=i._videoSSRC,s=n.audioRecv.find(m=>m.ssrc===r),o=n.videoRecv.find(m=>m.ssrc===a);if(!s&&!o)return void(e+=1);let c=fi(this,Ue.NeedSignalRTT),d=n.rtt,l=(d&&c?(d+c)/2:d||c)||0,h=s?s.jitterMs:void 0,_=n.recvPacketLossRate,f=.7*_*100/50+.3*l/1500;h&&(f=.6*_*100/50+.2*l/1500+.2*h/400),e+=f<.1?1:f<.17?2:f<.36?3:f<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(n){return new se((e,t)=>{this.handleMuteLocalTrack(n,e,t)})}filterTobePublishedTracks(n,e,t){let i=[],r=Nt(),a=this.getAllTracks();n=t_(n=n.filter(c=>a.indexOf(c)===-1));let s=!1,o=!1;for(let c of n){if(c instanceof Ai&&(this.localTrackMap.has(Ae.LocalVideoTrack)||s?new L(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:c,type:Ae.LocalVideoTrack}),s=!0),e)){let d=this.getLowVideoTrack(c,t);i.push({track:d,type:Ae.LocalVideoLowTrack})}if(c instanceof Ti){let d=this.localTrackMap.get(Ae.LocalAudioTrack);if(d){if(!(d.track instanceof Un))throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");d.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(o){let l=i.find(h=>{let{type:_}=h;return _===Ae.LocalAudioTrack});if(!(l.track instanceof Un))throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(c)}else{if(!r.webAudioMediaStreamDest||c instanceof Un||c._bypassWebAudio)i.push({track:c,type:Ae.LocalAudioTrack});else{let l=new Un;l.addAudioTrack(c),i.push({track:l,type:Ae.LocalAudioTrack})}o=!0}}}return i}filterTobeUnpublishedTracks(n){let e=[],t=this.getAllTracks();n=t_(n=n.filter(i=>t.indexOf(i)!==-1));for(let i of n){if(i instanceof Ti){let r=this.localTrackMap.get(Ae.LocalAudioTrack);if(!r)continue;r.track instanceof Un?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([Ae.LocalAudioTrack,r]),r.track.close())):e.push([Ae.LocalAudioTrack,r])}if(i instanceof Ai){let r=this.localTrackMap.get(Ae.LocalVideoTrack);if(!r)continue;e.push([Ae.LocalVideoTrack,r]);let a=this.localTrackMap.get(Ae.LocalVideoLowTrack);a&&e.push([Ae.LocalVideoLowTrack,a])}}return e}bindLocalTrackEvents(n){n.forEach(e=>{let{track:t,type:i}=e;switch(i){case Ae.LocalVideoTrack:t.addListener(Je.GET_STATS,this.handleGetLocalVideoStats),t.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case Ae.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(n,e){n instanceof Un?n.trackList.forEach(t=>{t.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Je.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(Je.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||n.addListener(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:i}]=e;return{track:i,type:t}})),n.forEach(e=>{let{track:t,type:i}=e;switch(i){case Ae.LocalVideoTrack:t.off(Je.GET_STATS,this.handleGetLocalVideoStats),t.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case Ae.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(n){n instanceof Un?n.trackList.forEach(e=>{e.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Je.GET_STATS,this.handleGetLocalAudioStats),e.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(Je.GET_STATS,this.handleGetLocalAudioStats),n.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,e){e instanceof Og&&e.addListener(Je.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(n))}),e instanceof Wu&&e.addListener(Je.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(Je.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[e,t]=n;t.has(ze.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),t.has(ze.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(n,e){return n.map((t,i)=>{var r;let a,{track:s,type:o}=t;switch(o){case Ae.LocalAudioTrack:a=Ni.Audio;break;case Ae.LocalVideoTrack:a=ee(r=s._hints).call(r,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High;break;case Ae.LocalVideoLowTrack:a=Ni.Low}return{kind:o===Ae.LocalAudioTrack?ze.AUDIO:ze.VIDEO,stream_type:a,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:s.muted||!s.enabled}})}createGatewayUnpublishMessage(n){return n.map(e=>{var t;let i,[r,{track:a,ssrcs:s,id:o}]=e;switch(r){case Ae.LocalVideoTrack:i=ee(t=a._hints).call(t,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High;break;case Ae.LocalAudioTrack:i=Ni.Audio;break;case Ae.LocalVideoLowTrack:i=Ni.Low}return{stream_type:i,ssrcs:s,mid:o}})}assignLocalTracks(n,e){n.forEach((t,i)=>{let{track:r,type:a}=t;this.localTrackMap.set(a,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(n){n.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(n){n.onConnectionStateChange=async e=>{var t;I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(n.name,".onConnectionStateChange(").concat(e,")")),this.emit(Ue.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(n.isInRestartIce=!1),ee(t=this._restartStates).call(t,e)&&!n.isInRestartIce&&(e==="disconnected"&&await va(800),n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))},n.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Te.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Gt.TRACER}).onSuccess(),this.emit(Ue.IceConnectionStateChange,e)},n.onICETransportStateChange=e=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},n.onDTLSTransportStateChange=e=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},n.onDTLSTransportError=e=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},n.onFirstAudioDecoded=e=>{var t;let i=Array.from(Lo(t=this.remoteUserMap).call(t)).find(a=>a._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(js.FIRST_FRAME_DECODED),Te.firstRemoteFrame(this.store.sessionId,Hn.FIRST_AUDIO_DECODE,qt.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Ia.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=e=>{var t;let i=Array.from(Lo(t=this.remoteUserMap).call(t)).find(r=>r._audioSSRC===e);i&&Te.firstRemoteFrame(this.store.sessionId,Hn.FIRST_AUDIO_RECEIVED,qt.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Ia.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(e,t,i)=>{this.reportVideoFirstFrameDecoded(e,t,i)},n.onFirstVideoReceived=e=>{var t;let i=Array.from(Lo(t=this.remoteUserMap).call(t)).find(r=>r._videoSSRC===e);i&&Te.firstRemoteFrame(this.store.sessionId,Hn.FIRST_VIDEO_RECEIVED,qt.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Ia.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(e,t)=>{let i=e.candidateType==="relay",r=t.candidateType==="relay";t.candidateType!=="unknown"&&i===r||this.emit(Ue.ConnectionTypeChange,i),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Qh(t))," -> ").concat(JSON.stringify(Qh(e)),")"))},n.onSelectedRemoteCandidateChanged=(e,t)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Qh(t))," -> ").concat(JSON.stringify(Qh(e)),")"))},n.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},n.onLocalCandidate=e=>{this.emit(Ue.LocalCandidate,{candidate:e,direction:n.direction})}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.onLocalCandidate=void 0}async handleDisconnect(n){let e=n===Dt.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,I.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),n===Dt.SEND_ONLY?this.restartICE(n):kn(this,Ue.RequestP2PRestartICE,{direction:Dt.SEND_ONLY}))}filterTobeMutedTracks(n){let e=[];if(this.getAllTracks().indexOf(n)===-1)return e;let t=this.localTrackMap.get(Ae.LocalAudioTrack);if(n instanceof Ti&&t?.track instanceof Un)return t.track.isActive||e.push([Ae.LocalAudioTrack,t]),e;let i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return n===a});if(i&&(e.push(i),i[0]===Ae.LocalVideoTrack)){let r=this.localTrackMap.get(Ae.LocalVideoLowTrack);r&&e.push([Ae.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(n){let e=[],t=this.localTrackMap.get(Ae.LocalAudioTrack);if(n instanceof Ti&&t?.track instanceof Un)return t.track.isActive&&e.push([Ae.LocalAudioTrack,t]),e;let i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return n===a});if(i)if(i[0]===Ae.LocalVideoTrack){e.push(i);let r=this.localTrackMap.get(Ae.LocalVideoLowTrack);r&&e.push([Ae.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(n){return n.map(e=>{var t;let i,[r,{track:a,ssrcs:s,id:o}]=e;switch(r){case Ae.LocalAudioTrack:i=Ni.Audio;break;case Ae.LocalVideoTrack:i=ee(t=a._hints).call(t,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High;break;case Ae.LocalVideoLowTrack:i=Ni.Low}return{stream_type:i,ssrcs:s,mid:o}})}createUnmuteMessage(n){return n.map(e=>{var t;let i,[r,{track:a,ssrcs:s,id:o}]=e;switch(r){case Ae.LocalAudioTrack:i=Ni.Audio;break;case Ae.LocalVideoTrack:i=ee(t=a._hints).call(t,Oe.SCREEN_TRACK)?Ni.Screen:Ni.High;break;case Ae.LocalVideoLowTrack:i=Ni.Low}return{stream_type:i,ssrcs:s,mid:o}})}filterTobeUnSubscribedTracks(n,e){let t=[],i=this.remoteUserMap.get(n);if(!i)return t;if(e){let r=i.get(e);if(!r)return t;t.push([n,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[a,s]=r;t.push([n,{kind:a,id:s}])});return t}createUnsubscribeMessage(n){let e=[];return n.forEach(t=>{let[i,{kind:r,id:a}]=t;switch(r){case ze.VIDEO:return void(i._videoSSRC&&e.push({stream_type:ze.VIDEO,ssrcId:i._videoSSRC}));case ze.AUDIO:return void(i._audioSSRC&&e.push({stream_type:ze.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(n){n.forEach(e=>{let[t,{kind:i}]=e,r=this.remoteUserMap.get(t);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(n){let e=this.localTrackMap.get(Ae.LocalVideoTrack),t=this.localTrackMap.get(Ae.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(n.uplink),await new se((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),t&&n.low_stream_uplink&&(await t.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}),await new se((i,r)=>{this.handleUpdateVideoEncoder(t.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let n=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return n!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(n){for(let e=0;e<n.length;e++)if(n[e]instanceof Ti){let t=this.filterTobeUnmutedTracks(n[e]);if(t.length===0)continue;let i=this.createUnmuteMessage(t);return void await zt(this,Ue.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=n=>this.getStats(n),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(n=>{let[,{ssrcs:e}]=n;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,e)=>this.emit(Ue.RequestUpload,n,e),this.statsUploader.requestUploadStats=n=>this.emit(Ue.RequestUploadStats,n),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await va(ln(this.dtlsFailedCount,Yr)),this.emit(Ue.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ae.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof Ai)}throwIfTrackTypeNotMatch(n){if(n.filter(e=>e instanceof Ai).length>1)throw new L(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(e=>e instanceof Ti).length>1&&(n.some(e=>e instanceof Ti&&e._bypassWebAudio)||!Nt().webAudioMediaStreamDest))throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let e of n){if(e instanceof Ai&&this.pendingLocalTracks.some(t=>t instanceof Ai))throw new L(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Ti&&this.pendingLocalTracks.some(t=>t instanceof Ti)&&(!Nt().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(t=>t instanceof Ti&&t._bypassWebAudio)))throw new L(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,e){let t=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nt().supportDualStreamEncoding,i=RA(RA({},{width:160,height:120,framerate:15,bitrate:50}),e),r;r=t?n._mediaStreamTrack.clone():Is(n,i);let a=Ht(8,"track-low-"),s=new Ai(r,RA(RA({},t&&{scaleResolutionDownBy:YO(i,n)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return s.on(Ag.TRANSCEIVER_UPDATED,o=>{n._updateRtpTransceiver(o,Ui.LOW_STREAM)}),s._hints.push(Oe.LOW_STREAM),n.addListener(Je.NEED_CLOSE,()=>{s.close()}),s}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(n,e,t,i){var r;let a=Array.from(Lo(r=this.remoteUserMap).call(r)).find(s=>s._videoSSRC===n);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());let s=this.store.keyMetrics,o=s.subscribe.find(c=>c.userId===a.uid&&c.type==="video");Te.firstRemoteVideoDecode(this.store.sessionId,Hn.FIRST_VIDEO_DECODE,qt.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:t,subscribeElapse:Ia.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:o?.subscribeEnd||0,subscriberStart:o?.subscribeStart||0,videoAddNotify:o?.streamAdded||0,state:i?1:0})}}async remoteMediaSsrcChanged(n,e,t){if(!this.recvConnection)return!1;let i=this.remoteUserMap.get(n);if(!i)return!1;let r=i.get(e);if(!r)return!1;let a=await this.recvConnection.getRemoteSSRC(r);return a!==void 0&&a!==t}isPreSubScribe(n){return!1}async publishDataChannel(n){throw new L(M.NOT_SUPPORTED)}async unpublishDataChannel(n){throw new L(M.NOT_SUPPORTED)}async subscribeDataChannel(n,e){throw new L(M.NOT_SUPPORTED)}async unsubscribeDataChannel(n,e){throw new L(M.NOT_SUPPORTED)}hasPendingRemoteDataChannel(n,e){throw new L(M.NOT_SUPPORTED)}setPendingRemoteDataChannel(n,e){throw new L(M.NOT_SUPPORTED)}async preConnect(n){throw new L(M.NOT_SUPPORTED)}getEstablishParams(){throw new L(M.NOT_SUPPORTED)}async reSubscribe(n){throw new L(M.NOT_SUPPORTED)}reportVideoFirstFrameRender(n){}async updateVideoStreamParameter(n,e){throw new L(M.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[e,{track:t}]=n;e===Ae.LocalVideoLowTrack?t._updateRtpTransceiver(void 0,Ui.LOW_STREAM):t._updateRtpTransceiver(void 0)})}},$e(Cr.prototype,"p2pConnect",[Ul],Object.getOwnPropertyDescriptor(Cr.prototype,"p2pConnect"),Cr.prototype),$e(Cr.prototype,"unpublish",[kV],Object.getOwnPropertyDescriptor(Cr.prototype,"unpublish"),Cr.prototype),$e(Cr.prototype,"unpublishLowStream",[MV],Object.getOwnPropertyDescriptor(Cr.prototype,"unpublishLowStream"),Cr.prototype),$e(Cr.prototype,"subscribe",[UV],Object.getOwnPropertyDescriptor(Cr.prototype,"subscribe"),Cr.prototype),$e(Cr.prototype,"mockSubscribe",[xV],Object.getOwnPropertyDescriptor(Cr.prototype,"mockSubscribe"),Cr.prototype),$e(Cr.prototype,"unsubscribe",[VV],Object.getOwnPropertyDescriptor(Cr.prototype,"unsubscribe"),Cr.prototype),$e(Cr.prototype,"muteRemote",[FV],Object.getOwnPropertyDescriptor(Cr.prototype,"muteRemote"),Cr.prototype),$e(Cr.prototype,"unmuteRemote",[BV],Object.getOwnPropertyDescriptor(Cr.prototype,"unmuteRemote"),Cr.prototype),$e(Cr.prototype,"hasRemoteMediaWithLock",[jV],Object.getOwnPropertyDescriptor(Cr.prototype,"hasRemoteMediaWithLock"),Cr.prototype),$e(Cr.prototype,"disconnectForReconnect",[GV],Object.getOwnPropertyDescriptor(Cr.prototype,"disconnectForReconnect"),Cr.prototype),$e(Cr.prototype,"remoteMediaSsrcChanged",[WV],Object.getOwnPropertyDescriptor(Cr.prototype,"remoteMediaSsrcChanged"),Cr.prototype),Cr);function ah(n){return function(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];switch(n){case Ga.SEND_ONLY:{let c=await this.sendMutex.lock("From P2PChannel2.".concat(t));try{return await r.apply(this,s)}finally{c()}}case Ga.RECEIVE_ONLY:{let c=await this.recvMutex.lock("From P2PChannel2.".concat(t));try{return await r.apply(this,s)}finally{c()}}default:{let c=await this.sendMutex.lock("From P2PChannel2.".concat(t)),d=await this.recvMutex.lock("From P2PChannel2.".concat(t));try{return await r.apply(this,s)}finally{c(),d()}}}},i}}class fo extends Sr{constructor(e,t){super(),F(this,"signal",void 0),F(this,"token",void 0),F(this,"tokenTimeout",void 0),F(this,"tokenInterval",void 0),F(this,"_sequence",0),F(this,"userMap",new Map),F(this,"encoder",new TextEncoder),this.signal=e,this.token=t;let i=()=>{this.signal.connectionState===He.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*B("P2P_TOKEN_INTERVAL"))};i()}async send(e,t,i,r,a){var s;if(this.userMap.size===0)return;let o=Array.from(tn(s=this.userMap).call(s))[0].token;typeof t!="string"&&(t=JSON.stringify(t)),r=r??Ht(6,""),a=a??this._sequence++;let c={_id:r,_type:e,_seq:a,_message:t,token:"".concat(this.token,"_").concat(o)};B("SHOW_P2P_LOG")&&I.debug("send message",c,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(c)).forEach(l=>{this.signal.request(Ne.DATA_STREAM,{payload:xc(this.encoder.encode(l))})});let d=new se((l,h)=>{let _=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),f),this.off("res-@".concat(r),S),this.off(Mr.ABORT,m),I.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?h(new L(M.INVALID_REMOTE_USER)):h(new L(M.TIMEOUT))},B("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),f=()=>{_&&window.clearTimeout(_),this.off(Mr.ABORT,m),i&&l()},m=()=>{_&&window.clearTimeout(_),this.off("res-@".concat(r,"_ack"),f),this.off("res-@".concat(r),S),h(new L(M.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(Mr.ABORT,m),this.once("res-@".concat(r,"_ack"),f);let S=(R,C)=>{T=!0,_&&window.clearTimeout(_),this.off("res-@".concat(r,"_ack"),f),this.off(Mr.ABORT,m),R==="success"?l(C):h(new L(M.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))},T=!1;i||(this.once("res-@".concat(r),S),va(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{T||I.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(c))}))});try{return await d}catch(l){if(l.code===M.TIMEOUT)return await this.send(e,t,i,r,a);throw l}}onMessage(e){var t;let{_uid:i}=e,r,a=this.userMap.get(i);if(a)r=a.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==kr.CHECK)return;let{token:d}=e;r=new Map,a={uid:i,isStart:!0,token:d,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,a),this.signal.emit($t.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var s;let{id:d,total:l}=e,h=(s=r.get(d))!==null&&s!==void 0?s:[];if(h.push(e),r.has(d)||r.set(d,h),h.length!==l)return;{let _=vt(h).call(h,(f,m)=>f.index-m.index).map(f=>f.payload).join("");r.delete(d),(e=JSON.parse(_))._uid=i}}let{_type:o,token:c}=e;if(ee(t=[kr.ACK,kr.CHECK]).call(t,o))return o===kr.CHECK&&this.handleCheckToken(a,c),void this.receiveMessage(e);c==="".concat(a.token,"_").concat(this.token)?this.handleReceivedMessage(e):I.debug('Receive unexpected message", '.concat(c,", cur_token: ").concat(a.token,"_").concat(this.token),e)}check(){let e={_id:Ht(6,""),token:this.token,_type:kr.CHECK};B("SHOW_P2P_LOG")&&I.debug("send message",e),this.signal.request(Ne.DATA_STREAM,{payload:xc(this.encoder.encode(JSON.stringify(e)))})}ack(e){let t={_id:e,_type:kr.ACK,token:this.token};B("SHOW_P2P_LOG")&&I.debug("send message",t),this.signal.request(Ne.DATA_STREAM,{payload:xc(this.encoder.encode(JSON.stringify(t)))})}response(e,t,i){this.send(kr.RESPONSE,JSON.stringify({success:!i,message:t}),!0,e)}handleReceivedMessage(e){let t=()=>{this.userMap.forEach(d=>{let{receivedMessagesMap:l,nextExpectedSequenceNumber:h}=d;for(;l.has(h);){let _=l.get(h);l.delete(h),this.receiveMessage(_),d.nextExpectedSequenceNumber++}})};if(!e)return void t();let{_uid:i,_seq:r}=e,a=this.userMap.get(i),{receivedMessagesMap:s,isStart:o,nextExpectedSequenceNumber:c}=a;if(r<c)return this.ack(e._id),void I.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));s.set(r,e),o&&r===c&&(this.receiveMessage(e),s.delete(c),a.nextExpectedSequenceNumber++,t())}receiveMessage(e){let{_id:t,_type:i,_message:r,_uid:a}=e;if(B("SHOW_P2P_LOG")&&I.debug("receive message",e),t){let s;switch(e._type!==kr.ACK&&(r&&(s=JSON.parse(r)),this.ack(e._id)),e._type){case kr.CANDIDATE:case kr.CONTROL:this.signal.emit(i,s,a);break;case kr.PUBLISH:case kr.UNPUBLISH:case kr.RESTART_ICE:case kr.CALL:s.uid=a,kn(this.signal,i,s).then(o=>{this.response(e._id,o)}).catch(()=>{this.response(e._id,void 0,!0)});break;case kr.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case kr.RESPONSE:{let{success:o,message:c}=s;this.emit("res-@".concat(t),o?"success":"failed",c);break}}}}splitMessage(e){if(e.length<fo.MAX_MESSAGE_SIZE)return[e];let t=[],{remoteToken:i}=JSON.parse(e),r=Ht(6,""),a=0,s=800,o=Math.ceil(e.length/s);for(;e.length>0;){a++;let c={id:r,index:a,total:o,payload:e.slice(0,s),token:"".concat(this.token,"_").concat(i)};JSON.stringify(c).length>fo.MAX_MESSAGE_SIZE?s-=50:(t.push(c),e=e.slice(s))}return t.map(c=>JSON.stringify(c))}handleCheckToken(e,t){return e.token!==t?(I.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{I.debug("token timeout, ".concat(t)),this.reset(e.uid)},B("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let e=await kn(this.signal,kr.CALL,void 0),t=await this.send(kr.CALL,e);this.signal.emit(et.P2P_CONNECTION,t,!0)}async reset(e,t){let i=this.userMap.get(e);i&&(this.emit(Mr.ABORT),this.signal.emit($t.ON_USER_OFFLINE,{uid:i.uid,reason:hE.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(I.debug("change local token from ".concat(t," to ").concat(t)),this.token=Ht(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Mr.ABORT)}}F(fo,"MAX_SIZE",1),F(fo,"MAX_MESSAGE_SIZE",1024);class Zg extends Sr{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===He.CONNECTED?this.emit(et.WS_CONNECTED):e===He.RECONNECTING?this.emit(et.WS_RECONNECTING,this._websocketReconnectReason):e===He.CLOSED&&this.emit(et.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),F(this,"_disconnectedReason",void 0),F(this,"_websocketReconnectReason",void 0),F(this,"_connectionState",He.CLOSED),F(this,"reconnectToken",void 0),F(this,"p2pToken",void 0),F(this,"websocket",void 0),F(this,"openConnectionTime",void 0),F(this,"clientId",void 0),F(this,"lastMsgTime",Date.now()),F(this,"uploadCache",[]),F(this,"uploadCacheInterval",void 0),F(this,"rttRolling",new ub(5)),F(this,"pingpongTimer",void 0),F(this,"pingpongTimeoutCount",0),F(this,"joinResponse",void 0),F(this,"multiIpOption",void 0),F(this,"initError",void 0),F(this,"spec",void 0),F(this,"store",void 0),F(this,"_external_signal",void 0),F(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(et.ON_BINARY_DATA,i.data);let r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){let a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case $t.ON_DATA_STREAM:return void this.handleDataStream(r._message);case $t.MUTE_AUDIO:case $t.MUTE_VIDEO:case $t.ON_P2P_LOST:case $t.ON_USER_ONLINE:return;case $t.ON_USER_OFFLINE:let{uid:a}=r._message;return I.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(r._type,r._message),r._type===$t.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===$t.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Vi.UID_BANNED);break;case 15:this.close(Vi.IP_BANNED);break;case 16:this.close(Vi.CHANNEL_BANNED)}if(r._type===$t.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case nt.ERR_LICENSE_MISSING:this.close(Vi.LICENSE_MISSING);break;case nt.ERR_LICENSE_EXPIRED:this.close(Vi.LICENSE_EXPIRED);break;case nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Vi.LICENSE_MINUTES_EXCEEDED);break;case nt.ERR_LICENSE_PERIOD_INVALID:this.close(Vi.LICENSE_PERIOD_INVALID);break;case nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Vi.LICENSE_MULTIPLE_SDK_SERVICE);break;case nt.ERR_LICENSE_ILLEGAL:this.close(Vi.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new KO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===He.CONNECTED&&this.reconnect("retry",yt.OFFLINE)}),this.p2pToken=Ht(6,""),this._external_signal=new fo(this,this.p2pToken)}async request(e,t,i,r){let a=Ht(6,""),s={_id:a,_type:e,_message:t},o=this.websocket.connectionID,c=()=>new se((m,S)=>{if(this.connectionState===He.CONNECTED)return m();let T=()=>{this.off(et.WS_CLOSED,R),m()},R=()=>{this.off(et.WS_CONNECTED,T),S(new L(M.WS_ABORT))};this.once(et.WS_CONNECTED,T),this.once(et.WS_CLOSED,R)});if(this.connectionState!==He.CONNECTING&&this.connectionState!==He.RECONNECTING||e===Ne.JOIN||e===Ne.REJOIN||await c(),this.websocket.sendMessage(s,!0),r)return;let d=new se((m,S)=>{let T=!1,R=(b,N)=>{T=!0,m({isSuccess:b==="success",message:N||{}}),this.off(et.WS_CLOSED,C),this.off(et.WS_RECONNECTING,C),this.emit(et.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),R);let C=()=>{S(new L(M.WS_ABORT,"type: ".concat(e))),this.off(et.WS_CLOSED,C),this.off(et.WS_RECONNECTING,C),this.off("res-@".concat(a),R)};this.once(et.WS_CLOSED,C),this.once(et.WS_RECONNECTING,C),va(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==o||T||(I.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(et.REQUEST_TIMEOUT,e,t))})}),l=null;try{l=await d}catch(m){if(this.connectionState===He.CLOSED||e===Ne.LEAVE)throw new L(M.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?m.throw():e===Ne.JOIN||e===Ne.REJOIN?null:(await c(),await this.request(e,t))}if(l.isSuccess)return l.message;let h=Number(l.message.error_code||l.message.code),_=Lb(h),f=new L(M.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(l.message.error_str),{code:h,data:l.message,desc:_.desc});return _.action==="success"?l.message:(I.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(h,", message: ").concat(_.desc,", action: ").concat(_.action)),h===nt.ERR_TOO_MANY_BROADCASTERS?((e===Ne.JOIN||e===Ne.REJOIN)&&(this.initError=f,this.close()),f.throw()):_.action==="failed"?f.throw():_.action==="quit"?(this.initError=f,this.close(),f.throw()):(h===nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yt.MULTI_IP)):this.reconnect(_.action,yt.SERVER_ERROR),e===Ne.JOIN||e===Ne.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new se(i=>{let r=a=>{(!t||t(a))&&(this.off(e,r),i(a))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Et.WRTC_STATS,t)}upload(e,t){let i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{let r=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==He.CONNECTED)return;let a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let i={_type:e,_message:t};this.websocket.sendMessage(i)}async sendExtensionMessage(e,t,i){return await this._external_signal.send(e,t,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new se((t,i)=>{this.once(et.WS_CONNECTED,()=>t(this.joinResponse)),this.once(et.WS_CLOSED,()=>i(this.initError||new L(M.WS_ABORT))),this.connectionState=He.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Vi.LEAVE,this.connectionState=He.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ht(6,""),this._external_signal.clear(),this._external_signal=new fo(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(et.ABORT_P2P_EXECUTION);let e=await kn(this,et.REQUEST_JOIN_INFO),t=await this.request(Ne.JOIN,e);if(!t)return this.emit(et.REPORT_JOIN_GATEWAY,M.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(et.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=He.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){return!1}handleDataStream(e){try{var t;let i=Uc(e.payload),r=new TextDecoder().decode(i),a=JSON.parse(r);"total"in a&&"id"in a||ee(t=Object.values(kr)).call(t,a._type)?(a._uid=e.uid,this._external_signal.onMessage(a)):this.emit($t.ON_DATA_STREAM,e)}catch{this.emit($t.ON_DATA_STREAM,e)}}handleNotification(e){I.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Lb(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Vi.UID_BANNED),void this.close()):void this.reconnect(t.action,yt.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=B("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(I.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yt.TIMEOUT):this.request(Ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-t;this.rttRolling.add(i),B("REPORT_STATS")&&this.send(Ne.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,e=>{this.emit(et.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=He.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Vi.NETWORK_ERROR,this.connectionState=He.CLOSED}),this.websocket.on(_t.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===He.CONNECTED?this.connectionState=He.RECONNECTING:this.connectionState=He.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(e,t,i)=>{e!=="retry"?(I.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):I.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(et.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof L&&e.code===M.UNEXPECTED_RESPONSE&&e.data.code===nt.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",yt.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yt.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(_t.REQUEST_NEW_URLS,(e,t)=>{kn(this,et.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let w3={name:"P2PChannel",create:function(n){let{store:e,statsCollector:t}=n;return new eN(e,t)},createSubmodule:function(n){let{store:e,spec:t}=n;return new Zg(t,e)}};function Jj(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function HV(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Jj(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Jj(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Zj{constructor(e){F(this,"sessionDesc",void 0),F(this,"localCapabilities",void 0),F(this,"rtpCapabilities",void 0),F(this,"candidates",void 0),F(this,"_originCandidates",void 0),F(this,"iceParameters",void 0),F(this,"dtlsParameters",void 0),F(this,"setup",void 0),F(this,"currentMidIndex",void 0),F(this,"cname",void 0),e=cr(e);let{iceParameters:t,dtlsParameters:i,candidates:r,rtpCapabilities:a,setup:s,localCapabilities:o,sdkCodec:c,cname:d}=e,l=lo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=r,this._originCandidates=cr(r),this.iceParameters=t,this.dtlsParameters=i,this.setup=s,this.localCapabilities=o,this.cname=d;for(let h=0;h<l.mediaDescriptions.length;h++){let _=l.mediaDescriptions[h];if(_.attributes.iceUfrag=t.iceUfrag,_.attributes.icePwd=t.icePwd,_.attributes.fingerprints=i.fingerprints,_.attributes.candidates=r,_.attributes.setup=s,_.media.mediaType==="video"){_.media.fmts=a.videoCodecs.map(S=>S.payloadType.toString(10));let f=a.videoCodecs.filter(S=>{var T,R;return(T=S.rtpMap)===null||T===void 0?void 0:ee(R=T.encodingName.toLowerCase()).call(R,c)}),m=a.videoCodecs.filter(S=>!ee(f).call(f,S));_.attributes.payloads=[...f,...m],_.attributes.extmaps=a.videoExtensions}_.media.mediaType==="audio"&&(_.media.fmts=a.audioCodecs.map(f=>f.payloadType.toString(10)),_.attributes.payloads=a.audioCodecs,_.attributes.extmaps=a.audioExtensions),l.mediaDescriptions[h]=this.mungMediaDesc(_)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return ya(this.sessionDesc)}send(e,t,i){let{ssrcs:r,ssrcGroups:a}=TR(t,this.cname),s=this.sessionDesc.mediaDescriptions.find(d=>e===ze.VIDEO?d.media.mediaType==="video":d.media.mediaType==="audio"),o=r[0].attributes.label,c=r[0].attributes.mslabel;return s.attributes.ssrcs=s.attributes.ssrcs.concat(r),s.attributes.ssrcGroups=s.attributes.ssrcGroups.concat(a),{id:o,mslabel:c}}batchSend(e){return e.map(t=>{let{kind:i,ssrcMsg:r}=t;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(t=>{let i=[],r=[],a=[];t.attributes.ssrcs.forEach(s=>{ee(e).call(e,s.attributes.label||"")?a.push(s):i.push(s)}),t.attributes.ssrcGroups.forEach(s=>{var o;ee(o=a.map(c=>c.ssrcId)).call(o,s.ssrcIds[0])||r.push(s)}),t.attributes.ssrcs=i,t.attributes.ssrcGroups=r})}mute(e){let t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,i){e.forEach((r,a)=>{let s=r._mediaStreamTrack,o=this.sessionDesc.mediaDescriptions.findIndex(d=>d.attributes.mid===s.kind),c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],r);this.sessionDesc.mediaDescriptions[o]=c})}stopReceiving(e){}updateCandidates(e){let t=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(t.forEach(r=>{i.push(HV(HV({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),t.length!==0){switch(e){case Me.TCP_RELAY:this.candidates=i;break;case Me.UDP_TCP_RELAY:case Me.RELAY:this.candidates=[...t,...i];break;default:this.candidates=t}for(let r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=cr(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}mungRecvMediaDsec(e,t){let i=cr(e);return ep(i,t),jb(i,t),i}updateRecvMedia(e,t){let i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,i){let r=this.sessionDesc.mediaDescriptions.find(s=>e===ze.VIDEO?s.attributes.mid==="video":s.attributes.mid==="audio");if(r){let s=r.attributes.ssrcs.find(o=>o.attributes.label===t);var a;s&&(s.attributes.label=i,(a=s.attributes.msid)===null||a===void 0||a.replace(t,i))}}mungMediaDesc(e){let t=cr(e);return pE(t),(function(i){let r=i.attributes.extmaps.find(a=>Fb(a.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(a=>{let s=a.rtcpFeedbacks.findIndex(o=>o.type==="transport-cc");s!==-1&&a.rtcpFeedbacks.splice(s,1)})})(t),t}getSSRC(e){for(let t of this.sessionDesc.mediaDescriptions)for(let i of t.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var Ji;function Ki(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function vA(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ki(Object(t),!0).forEach(function(i){F(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ki(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let tN=(Ji=class XV extends RU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return ee(t=Object.keys(bt)).call(t,e)}))]}constructor(e,t){super(e,t),F(this,"store",void 0),F(this,"peerConnection",void 0),F(this,"remoteSDP",void 0),F(this,"initialOffer",void 0),F(this,"statsFilter",void 0),F(this,"useRTX",!1),F(this,"localCapabilities",void 0),F(this,"localCandidateCount",0),F(this,"allCandidatesReceived",!1),F(this,"establishPromise",void 0),F(this,"mutex",void 0),this.store=t,this.mutex=new xa("P2PConnection-mutex",t.clientId),this.peerConnection=new RTCPeerConnection(XV.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=R1(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=bl(e.sdp),i=SR(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,vA(vA({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new L(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Zj(vA(vA({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new L(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var i=this;return cc(function*(){let r=yield di(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let a=e.map(_=>i.peerConnection.addTrack(_._mediaStreamTrack)),s=yield di(i.peerConnection.createOffer()),o=lo(s.sdp),c=e.map(_=>{let f=_._mediaStreamTrack,m=o.mediaDescriptions.find(S=>S.attributes.mid===f.kind);if(!m)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(S,T,R){let C=S.attributes.ssrcs.filter(N=>N.attributes.label===T),b=S.attributes.ssrcGroups;if(C.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(b&&C.length>1){let N=b.find(k=>k.ssrcIds.indexOf(C[0].ssrcId)!==-1);return N?[{ssrcId:N.ssrcIds[0],rtx:R?N.ssrcIds[1]:void 0}]:[{ssrcId:C[0].ssrcId}]}return[{ssrcId:C[0].ssrcId}]})(m,f.id,i.useRTX)}),d;try{d=yield c}catch(_){throw a.forEach(f=>{dn()&&f.replaceTrack(null),i.peerConnection.removeTrack(f)}),_}let l=i.mungSendOfferSDP(s.sdp,e);i.remoteSDP.receive(e,t,d);let h=i.remoteSDP.toString();return yield di(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield di(i.applySendEncodings(a,e)),yield di(i.peerConnection.setRemoteDescription({type:"answer",sdp:h})),e.map((_,f)=>{let m=_._mediaStreamTrack.id;return{localSSRC:c[f],id:m}})}catch(a){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getSenders().filter(a=>{var s;return e.indexOf(((s=a.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(a=>{dn()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});let i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(t.toString()))}}async receive(e,t,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{id:a,mslabel:s}=this.remoteSDP.send(e,t,r),o=new se((l,h)=>{let _=setTimeout(()=>{h(new Error("Cannot receive track, id: ".concat(a)))},1e4),f=m=>{let S=pi();if((S.name==="Safari"&&Number(S.version)===11||Ci())&&m.track.id!==a&&m.streams[0].id===s){var T;let R=m.streams[0].getTracks()[0];return(T=this.remoteSDP)===null||T===void 0||T.updateTrackLabel(e,a,m.track.id),this.peerConnection.removeEventListener("track",f),clearTimeout(_),void l(R)}if(m.track.id===a)return this.peerConnection.removeEventListener("track",f),clearTimeout(_),void l(m.track)};this.peerConnection.addEventListener("track",f)}),c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});let d=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(d),{track:await o,id:a}}catch(a){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(i=>{if(dn()&&i.track)i.track.enabled=!1;else{let r=i.getParameters();r.encodings.forEach(a=>a.active=!1),i.setParameters(r)}})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter(a=>{var s;return e.indexOf(((s=a.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async a=>{if(dn()&&a.track)a.track.enabled=!0;else{let s=a.getParameters();s.encodings.forEach(o=>o.active=!0),await a.setParameters(s)}});let i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return cc(function*(){let i=yield di(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let r=Nt().supportPCSetConfiguration;if(e===Me.RELAY&&!r)return;if(r){let d=t.peerConnection.getConfiguration(),l=e===Me.RELAY?"relay":"all";d.iceTransportPolicy!==l&&(I.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(d.iceTransportPolicy,"] to [").concat(l,"]")),d.iceTransportPolicy=l,t.peerConnection.setConfiguration(d))}e!==Me.RELAY&&t.remoteSDP.updateCandidates(e);let a=yield di(t.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let s=bl(a.sdp),{remoteIceParameters:o}=yield s.iceParameters;t.remoteSDP.restartICE(o);let c=t.remoteSDP.toString();yield di(t.peerConnection.setLocalDescription(a)),yield di(t.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(r){I.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);let a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new L(M.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){let i=this.peerConnection.getSenders().filter(r=>{var a;return((a=r.track)===null||a===void 0?void 0:a.id)===e});i.length===1&&await this.applySendEncodings(i,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let i=this.peerConnection.getSenders().find(r=>{var a;return((a=r.track)===null||a===void 0?void 0:a.id)===t});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new L(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new L(M.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){let t={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Oi(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...XV.turnServerConfigToIceServers(e.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...XV.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),t}static turnServerConfigToIceServers(e){let t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var i;if(t||(t=this.peerConnection.getSenders().find(d=>{var l;return((l=d.track)===null||l===void 0?void 0:l.id)===e._mediaStreamTrack.id})),!t)return I.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Nt().supportSetRtpSenderParameters)return I.warn("Browser not support set rtp-sender parameters");let r={},a={};if(e instanceof Ai)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(B("DSCP_TYPE")&&xu()){var s;let d=B("DSCP_TYPE");ee(s=["very-low","low","medium","high"]).call(s,d)&&(a.networkPriority=d)}let o=t.getParameters(),c=(i=o.encodings)===null||i===void 0?void 0:i[0];c&&Object.assign(c,a),Object.assign(o,r),I.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(o.encodings))),await t.setParameters(o)}async applySendEncodings(e,t){try{if(!Nt().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){let r=e[i],a=t[i];r&&a&&await this.updateRtpSenderEncodings(a,r)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){let i=lo(e);return t.forEach((r,a)=>{let s=r._mediaStreamTrack,o=i.mediaDescriptions.find(c=>c.attributes.mid===s.kind);o&&ep(o,r)}),ya(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let t=this.remoteSDP.batchSend(e).map((a,s)=>{let{id:o,mslabel:c}=a,{kind:d}=e[s];return new se((l,h)=>{let _=setTimeout(()=>{h(new Error("Cannot receive track, id: ".concat(o)))},1e4),f=m=>{let S=pi();if(S.name==="Safari"&&Number(S.version)===11&&m.track.id!==o&&m.streams[0].id===c){var T;let R=m.streams[0].getTracks()[0];return(T=this.remoteSDP)===null||T===void 0||T.updateTrackLabel(d,o,m.track.id),this.peerConnection.removeEventListener("track",f),clearTimeout(_),void l({track:R,id:o})}if(m.track.id===o)return this.peerConnection.removeEventListener("track",f),clearTimeout(_),void l({track:m.track,id:o})};this.peerConnection.addEventListener("track",f)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await se.all(t)}catch(t){throw new L(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async getRemoteSSRC(e){return this.remoteSDP?this.remoteSDP.getSSRC(e)?.[0].ssrcId:void 0}setConfiguration(e){if(Nt().supportPCSetConfiguration){let t=XV.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}},$e(Ji.prototype,"connect",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"connect"),Ji.prototype),$e(Ji.prototype,"stopSending",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"stopSending"),Ji.prototype),$e(Ji.prototype,"receive",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"receive"),Ji.prototype),$e(Ji.prototype,"stopReceiving",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"stopReceiving"),Ji.prototype),$e(Ji.prototype,"muteRemote",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"muteRemote"),Ji.prototype),$e(Ji.prototype,"unmuteRemote",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"unmuteRemote"),Ji.prototype),$e(Ji.prototype,"muteLocal",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"muteLocal"),Ji.prototype),$e(Ji.prototype,"unmuteLocal",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"unmuteLocal"),Ji.prototype),$e(Ji.prototype,"close",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"close"),Ji.prototype),$e(Ji.prototype,"updateEncoderConfig",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"updateEncoderConfig"),Ji.prototype),$e(Ji.prototype,"updateSendParameters",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"updateSendParameters"),Ji.prototype),$e(Ji.prototype,"replaceTrack",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"replaceTrack"),Ji.prototype),$e(Ji.prototype,"getRemoteSSRC",[Wd],Object.getOwnPropertyDescriptor(Ji.prototype,"getRemoteSSRC"),Ji.prototype),Ji);function Wd(n,e,t){let i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){let r=this.mutex,a=await r.lock("Locking from P2PConnection.".concat(e));try{for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return await i.apply(this,o)}finally{a()}},t}let Hd={name:"PlanBConnection",create:function(n){let{store:e,spec:t}=n;return new tN(t,e)}},O3={interceptLocalAudioFrame:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nt().supportWebRTCEncodedTransform)return void I.warning("browser not support audio encoded transform");if(oR.has(n)||!n.track)return;let t={track:n.track};if(_l()){if(!n.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let r=null;try{r=n.createEncodedStreams()}catch(s){return void I.error("create audio-encoded-streams error",s&&s.message)}let a=new TransformStream({transform(s,o){t.controller||(t.controller=o),n.track&&n.track.id!==t.track.id&&(I.debug("audio track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i));let c=e.metadata&&e.metadata();c?(function(d,l){let{chunk:h,controller:_}=l,f=d_.METADATA;h.data=(function(m,S,T){let R=T.byteLength,C=R+bb+VO,b=xO+Cb+C,N=new ArrayBuffer(m.byteLength+b),k=new DataView(N);k.setUint8(0,yb),k.setUint16(1,C),k.setUint8(3,S),k.setUint16(4,R);for(let U=0;U<R;U++)k.setUint8(6+U,T[U]);let P=new Uint8Array(k.buffer);return P.set(new Uint8Array(m),b),P.buffer})(h.data,f,d),_.enqueue(h)})(c,{chunk:s,controller:o}):o.enqueue(s)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if(dn()){if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");let r=UO(),a=new MessageChannel;await new se(o=>r.onmessage=c=>{c.data==="registered"&&o(void 0)});let s=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:a.port2},[a.port2]);n.transform=s,await new se(o=>r.onmessage=c=>{c.data==="started"&&o(void 0)}),a.port1.onmessage=o=>{var c;if(o.data.transformed&&n.track&&((c=n.track)===null||c===void 0?void 0:c.id)!==t.track.id)I.debug("audio track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i);else if(o.data.getMetadata){let d=e.metadata&&e.metadata();d&&a.port1.postMessage({metadata:d})}},t.worker=r}function i(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",i)}let r=oR.get(n);if(r){oR.delete(n);try{var a,s;(a=r.controller)===null||a===void 0||a.terminate(),(s=r.worker)===null||s===void 0||s.terminate()}catch(o){I.warning(o&&o.message)}}}oR.set(n,t),n.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nt().supportWebRTCEncodedTransform)return void I.warning("browser not support audio encoded transform");if(wb.has(n))return;let t={track:n.track,onMetadata:e.onMetadata,onPts:e.onPts};if(_l()&&!Ci()){if(!n.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");tO(Ot.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=n.createEncodedStreams()}catch(s){return void I.error("create audio-encoded-streams error",s&&s.message)}let a=new TransformStream({transform(s,o){t.controller||(t.controller=o),n.track&&n.track.id!==t.track.id&&(I.debug("audio track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i)),e.enableTopn?(function(c,d,l){var h;let _=qh(new DataView(d.data));if(!_)return l.enqueue(d);let f=c.track.id;GO.set(f,c.track);let m=(h=_.tlv.find(N=>N.tag===d_.AUDIO_LEVEL))===null||h===void 0?void 0:h.value,S=0;typeof m=="number"&&(S=127-m);let T=Math.round(Math.pow(10,S/60)-1),{selected:R,speaker:C}=(function(N,k){let P=lR.get(N);if(P||(P=(function(U){let W=new VB;return lR.set(U,W),Vo||(Vo=new oU(B("TOPN_SILENCE_THRESHOLD")||500),Vo.on("ActiveSpeakerChanged",z=>{z!=null&&(Yc=z)})),Vo.addSpeakers([W]),W})(N)),lR.size<=Ab)return{selected:!0,speaker:P};if(!Vo)throw new Error("no active speaker detector");return Vo.levelChanged(P.id,k),oE=Vo.loudest.map(U=>U.id),Yc&&!ee(oE).call(oE,Yc)&&oE.length>=Ab&&oE.pop(),{selected:ee(oE).call(oE,P.id)||P.id===Yc,speaker:P}})(c,T),b=(function(N,k,P){let U=ho.get(N)||new BO(N,k);return U.score=P,ho.set(N,U),(function(W){if(zc.set(W,!0),!jO)return void(jO=Date.now());let z=Date.now();z-jO>1e3&&(zc.get(W)?zc.set(W,!1):(Ib(W),zc.delete(W)),jO=z)})(N),U})(f,c.track,C.energyScore);b.addSample(R),b.active&&(d.data=_.frame.buffer,l.enqueue(d))})(n,s,o):e.enableMetadata||e.enablePts?(function(c,d,l,h){let _=new DataView(c.data),f=_.getUint8(0),m;if(128&f&&f!==71){let R=(function(C){if(C.byteLength<=0)return[];let b=[],N=0;for(;N<C.byteLength;){let P=(128&C.getUint8(N))>>7,U=127&C.getUint8(N);if(!(P&&N+4<=C.byteLength)){N++;break}{let W=C.getUint32(N,!1),z=(16776192&W)>>10,Q=1023&W;b.push({pt:U,ts_offset:z,length:Q,data:new Uint8Array}),N+=4}}let k=C.byteLength-N;for(let P of b){if(P.length>k)return console.warn("Broken red payload"),[];P.length>0&&(P.data=new Uint8Array(C.buffer,C.byteOffset+N,P.length),N+=P.length,k-=P.length)}if(k>0){let P={pt:b.length>0?b[b.length-1].pt:0,ts_offset:0,length:k,data:new Uint8Array(C.buffer,C.byteOffset+N,k)};b.push(P)}return b})(_);if(R.length>0){let C=(function(b){let N=0;for(let U=0;U<b.length;U++)N+=U<b.length-1?4:1,N+=b[U].length;let k=new Uint8Array(N),P=0;for(let U=0;U<b.length;U++)if(U<b.length-1){let W=(2147483648|(127&b[U].pt)<<24|(262143&b[U].ts_offset)<<10|1023&b[U].length)>>>0;k[P++]=W>>24&255,k[P++]=W>>16&255,k[P++]=W>>8&255,k[P++]=255&W}else k[P++]=127&b[U].pt;for(let U of b)k.set(U.data,P),P+=U.length;return k})(R.map(b=>{let N=new Uint8Array(b.length);N.set(b.data);let k=qh(new DataView(N.buffer));return k!=null&&k.frame&&(b.data=k?.frame),m=k,b}));c.data=C.buffer}}else m=qh(_),m&&(c.data=m.frame.buffer);if(d.enqueue(c),!m)return;let S=m.tlv.find(R=>R.tag===d_.METADATA);S&&l&&S.value instanceof Uint8Array&&l(S.value);let T=m.tlv.find(R=>R.tag===d_.AUDIO_64_BIT_PTS);T&&h&&T.value instanceof Uint8Array&&T.value.length==8&&h(new DataView(T.value.buffer).getBigUint64(0,!0))})(s,o,e.onMetadata,e.onPts):o.enqueue(s)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");let r=UO(),a=new MessageChannel;await new se(o=>r.onmessage=c=>{c.data==="registered"&&o(void 0)});let s=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:a.port2},[a.port2]);n.transform=s,await new se(o=>r.onmessage=c=>{c.data==="started"&&o(void 0)}),a.port1.onmessage=o=>{var c;o.data.transformed&&n.track&&((c=n.track)===null||c===void 0?void 0:c.id)!==t.track.id?(I.debug("audio track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i)):o.data.metadata&&t.onMetadata?t.onMetadata(o.data.metadata):o.data.pts&&t.onPts&&t.onPts(o.data.pts)},t.worker=r}function i(){n.track.removeEventListener("ended",i),(function(r){let a=wb.get(r);if(a){(function(c){let d=lR.get(c);d&&(lR.delete(c),Vo&&(Vo.removeSpeakers([d]),lR.size===0&&(Vo.destroy(),Vo=null)))})(r),Ib(r.track.id),wb.delete(r);try{var s,o;(s=a.controller)===null||s===void 0||s.terminate(),(o=a.worker)===null||o===void 0||o.terminate()}catch(c){I.warning(c&&c.message)}}})(n)}wb.set(n,t),n.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(n,e){if(!Nt().supportWebRTCEncodedTransform)return void I.warning("browser not support video encoded transform");if(Nb.has(n)||!n.track)return;let t={track:n.track};if(_l()){if(!n.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let r=null;try{r=n.createEncodedStreams()}catch(o){return void I.error("create video-encoded-streams error",o&&o.message)}let a=[];e.on("sei-to-send",o=>{a.push(o)});let s=new TransformStream({transform(o,c){t.controller||(t.controller=c),n.track&&n.track.id!==t.track.id&&(I.debug("video track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i));let d=lU(new Uint8Array(o.data)),l=a.shift();if(l){let h=(function(_,f,m){switch(m){case cU:return(function(S,T){let R=dU(T),C=R.length,b=Math.floor(C/255),N=C%255,k=new Uint8Array(6+b+1+C+S.byteLength);k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=6,k[5]=101;let P=0;for(;P<b;)k[6+P]=255,P++;return k[6+P]=N,P++,k.set(R,6+P),k.set(new Uint8Array(S),6+P+C),k.buffer})(_,f);case Ob:return(function(S,T){let R=dU(T),C=R.length,b=Math.floor(C/255),N=C%255,k=new Uint8Array(7+b+1+C+1+S.byteLength);k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=78,k[5]=1,k[6]=101;let P=0;for(;P<b;)k[7+P]=255,P++;return k[7+P]=N,P++,k.set(R,7+P),P+=C,k[7+P]=128,P++,k.set(new Uint8Array(S),7+P),k.buffer})(_,f);default:return null}})(o.data,l,d);h&&(o.data=h)}c.enqueue(o)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else{if(!dn())return;{if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");let r=UO(),a=new MessageChannel;await new se(o=>r.onmessage=c=>{c.data==="registered"&&o(void 0)});let s=new RTCRtpScriptTransform(r,{name:"sei-tx",port:a.port2},[a.port2]);n.transform=s,await new se(o=>r.onmessage=c=>{c.data==="started"&&o(void 0)}),e.on("sei-to-send",o=>{a.port1.postMessage({sei:o})}),a.port1.onmessage=o=>{var c;o.data.transformed&&n.track&&((c=n.track)===null||c===void 0?void 0:c.id)!==t.track.id&&(I.debug("video track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i))},t.worker=r}}function i(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",i)}let r=Nb.get(n);if(r){Nb.delete(n);try{var a,s;(a=r.controller)===null||a===void 0||a.terminate(),(s=r.worker)===null||s===void 0||s.terminate()}catch(o){I.warning(o&&o.message)}}}Nb.set(n,t),n.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nt().supportWebRTCEncodedTransform)return void I.warning("browser not support video encoded transform");if(!n.track)return;if(cE.has(n)){let r=cE.get(n);return void(r&&(r.onSei=e.onSei))}let t={track:n.track,onSei:e.onSei};if(_l()){if(!n.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let r=null;try{r=n.createEncodedStreams()}catch(s){return void I.error("create video-encoded-streams error",s&&s.message)}let a=new TransformStream({transform(s,o){t.controller||(t.controller=o),n.track&&n.track.id!==t.track.id&&(I.debug("video track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i));let c=(function(d,l){switch(l){case cU:return(function(h){let _=new DataView(h.data),f=0;for(;f+4<h.data.byteLength;){if(_.getUint8(f+0)===0&&_.getUint8(f+1)===0&&_.getUint8(f+2)===0&&_.getUint8(f+3)===1&&_.getUint8(f+4)===6){let m=f+6,S=0,T=0;for(;(T=_.getUint8(m++))===255;)S+=255;S+=T;let R=WO(h.data,m,S);return new Uint8Array(R)}f++}return null})(d);case Ob:return(function(h){let _=new DataView(h.data),f=0;for(;f+5<h.data.byteLength;){if(_.getUint8(f+0)===0&&_.getUint8(f+1)===0&&_.getUint8(f+2)===0&&_.getUint8(f+3)===1&&_.getUint8(f+4)===78&&_.getUint8(f+5)===1&&_.getUint8(f+6)===101){let m=f+7,S=0,T=0;for(;(T=_.getUint8(m++))===255;)S+=255;S+=T;let R=WO(h.data,m,S);return new Uint8Array(R)}f++}return null})(d);default:return null}})(s,lU(new Uint8Array(s.data)));c&&t.onSei&&t.onSei(c),o.enqueue(s)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if(dn()){if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");let r=UO(),a=new MessageChannel;await new se(o=>r.onmessage=c=>{c.data==="registered"&&o(void 0)});let s=new RTCRtpScriptTransform(r,{name:"sei-rx",port:a.port2},[a.port2]);n.transform=s,await new se(o=>r.onmessage=c=>{c.data==="started"&&o(void 0)}),a.port1.onmessage=o=>{var c;o.data.transformed&&n.track&&((c=n.track)===null||c===void 0?void 0:c.id)!==t.track.id?(I.debug("video track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i)):o.data.sei&&t.onSei&&t.onSei(o.data.sei)},t.worker=r}function i(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",i)}(function(r){let a=cE.get(r);if(a){cE.delete(r);try{var s,o;(s=a.controller)===null||s===void 0||s.terminate(),(o=a.worker)===null||o===void 0||o.terminate()}catch(c){I.warning(c&&c.message)}}})(n)}cE.set(n,t),n.track.addEventListener("ended",i)}},N3={name:"InterceptFrame",create:()=>O3};gO(),Ct("PROCESS_ID","process-".concat(Ht(8,""),"-").concat(Ht(4,""),"-").concat(Ht(4,""),"-").concat(Ht(4,""),"-").concat(Ht(12,""))),(function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void I.error("Error loading sdk config",e.message)}if(n)try{let e=JSON.parse(window.atob(n)),t=Date.now();I.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(dr,i)){let{value:r,expires:a}=e[i];if(a&&a<=t)return;ml[i]=r,dr[i]=r}})}catch(e){I.error("Error loading mutableParamsCache: ".concat(n),e.message)}})(),Array.isArray(ml.AREAS)&&ml.AREAS.length>0&&JO(ml.AREAS,!0);let Qj=(n,e,t)=>{I.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(e))),Ct(n,e,t)};m_(f3,!1),m_(E3,!1),m_(pj,!1),m_(y3,!1),m_(h3,!1),m_(w3,!1),m_(Hd,!1),m_(N3,!1);let Cn=(function(n){let e=new Sr,t=n,i={getListeners:e.getListeners.bind(e),on:(r,a)=>((function(s,o){s===Ku.SECURITY_POLICY_VIOLATION&&T0(o,!0)})(r,a),e.on.bind(e)(r,a)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return nV(nV({},t),i)})({__TRACK_LIST__:s_,VERSION:dc,BUILD:fb,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Qj,getParameter:B,getSupportedCodec:async function(){let n={audio:[],video:[]};try{let e=new RTCPeerConnection,t=await(async function(i){let r;return Nt().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r})(e);if(!t)return n;e.close(),e=null,n=(function(i){let r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r})(t)}catch(e){throw new J(M.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return n},checkSystemRequirements:function(){let n=Te.reportApiInvoke(null,{name:Jr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Gt.TRACER}),e=!1;try{let a=window.RTCPeerConnection,s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,o=window.WebSocket;e=!!(a&&s&&o),e&&sO()&&Tg(75)&&new a().close()}catch(a){return I.error("check system requirement failed: ",a),!1}let t=!1,i=pi();i.name===Ot.CHROME&&Number(i.version)>=58&&(pl.engine.name!=="WebKit"||(function(){let a=pi();if(sb()){if(a.os===Br.MAC_OS)return!0;if(a.os===Br.IOS){let s=pl.os.version&&pl.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1})())&&(t=!0),(i.name===Ot.FIREFOX&&Number(i.version)>=56||i.name===Ot.OPERA&&Number(i.version)>=45||i.name===Ot.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(Ci()||Id())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||wd()||pi().name===Ot.QQ)&&(t=!0),I.debug("checkSystemRequirements, api:",e,"browser",t);let r=e&&t;return n.onSuccess(r),r},getDevices:function(n){return bs.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return bs.getRecordingDevices(n)},getCameras:function(n){return bs.getCamerasDevices(n)},getElectronScreenSources:NB,getPlaybackDevices:function(n){return bs.getSpeakers(n)},createClient:function(){var n;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},t=Ht(5,"client-"),i=Te.reportApiInvoke(null,{id:t,name:Jr.CREATE_CLIENT,options:[e],tag:Gt.TRACER});try{(function(r){gr(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),gr(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&gr(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Zn(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&qT(r.turnServer),r.httpRetryConfig!==void 0&&Tr(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&Tr(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(u1(16,0)||rO(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",I.debug("browser not support vp9, force use vp8")),Ct("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new Nl(Vd(Vd({forceWaitGatewayResponse:!0},e),{},{role:ee(n=["rtc","p2p"]).call(n,e.mode)?"host":e.role||"audience"}),t)},createCameraVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=B("CAMERA_CAPTURE_CONFIG"),t=Ht(8,"track-cam-"),i=Te.reportApiInvoke(null,{id:t,tag:Gt.TRACER,name:Jr.CREATE_CAM_VIDEO_TRACK,options:[Qi({},n),e]});e&&(n.encoderConfig=e);let r=Tb(n),a=null;I.info("start create camera video track with config",JSON.stringify(n),"trackId",t);try{a=(await hc({video:r},t)).getVideoTracks()[0]||null}catch(o){throw i.onError(o),o}if(!a){let o=new L(M.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(o),o.throw(I)}if(n.optimizationMode&&sR(t,a,n,gl(n.encoderConfig)),B("USE_STANDARD_BITRATE_DEFAULT")){let o=gl(n.encoderConfig);n.encoderConfig=o,delete o.bitrateMax,delete o.bitrateMin}let s=new Xi(a,n,r,n.scalabiltyMode?rR(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,t);return i.onSuccess(s.getTrackId()),I.info("create camera video success, trackId:",t),s},createCustomVideoTrack:function(n){let e=Ht(8,"track-cus-"),t=Te.reportApiInvoke(null,{id:e,tag:Gt.TRACER,name:Jr.CREATE_CUSTOM_VIDEO_TRACK,options:[n]});B("USE_STANDARD_BITRATE_DEFAULT")&&(delete n.bitrateMax,delete n.bitrateMin);let i=new Ai(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?rR(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,e,[Oe.CUSTOM_TRACK]);return t.onSuccess(i.getTrackId()),I.info("create custom video track success with config",n,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",t=typeof e=="object"?(function(_){return Rb(_)})(e):void 0;t&&(e="auto");let i=Ht(8,"track-scr-v-"),r=Te.reportApiInvoke(null,{id:i,tag:Gt.TRACER,name:Jr.CREATE_SCREEN_VIDEO_TRACK,options:[Qi({},n),e]});n.encoderConfig?typeof n.encoderConfig=="string"||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";let a=(function(_){let f={};_.screenSourceType&&(f.mediaSource=_.screenSourceType),_.extensionId&&_l()&&(f.extensionId=_.extensionId);let{displaySurface:m,selfBrowserSurface:S,surfaceSwitching:T,systemAudio:R,preferCurrentTab:C}=_;(Jn(107)||ob(107)||db(93))&&(m&&(gr(m,"displaySurface",["browser","window","monitor"]),f.displaySurface=m),S?(gr(S,"selfBrowserSurface",["exclude","include"]),f.selfBrowserSurface=S):f.selfBrowserSurface="include",T&&(gr(T,"surfaceSwitching",["exclude","include"]),f.surfaceSwitching=T)),(Jn(105)||ob(105)||db(91))&&R&&(gr(R,"systemAudio",["exclude","include"]),f.systemAudio=R),(Jn(94)||ob(94)||db(80))&&C&&(f.preferCurrentTab=!0),_.electronScreenSourceId&&(f.sourceId=_.electronScreenSourceId);let b=_.encoderConfig?Gc(_.encoderConfig):null;return f.mandatory={chromeMediaSource:"desktop",maxWidth:b?b.width:void 0,maxHeight:b?b.height:void 0},b&&(b.frameRate&&(typeof b.frameRate=="number"?(f.mandatory.maxFrameRate=b.frameRate,f.mandatory.minFrameRate=b.frameRate):(f.mandatory.maxFrameRate=b.frameRate.max||b.frameRate.ideal||b.frameRate.exact||void 0,f.mandatory.minFrameRate=b.frameRate.min||b.frameRate.ideal||b.frameRate.exact||void 0),f.frameRate=b.frameRate),b.width&&(f.width=b.width),b.height&&(f.height=b.height)),f})(n),s=null,o=null,c=Nt();if(!c.supportShareAudio&&e==="enable"){let _=new L(M.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(_),_.throw(I)}I.info("start create screen video track with config",n,"withAudio",e,"trackId",i);let d=c.supportShareAudio&&e!=="disable";try{let _=await hc({screen:a,screenAudio:d?t||!0:void 0},i);s=_.getVideoTracks()[0]||null,o=_.getAudioTracks()[0]||null}catch(_){throw r.onError(_),_}if(!s){let _=new L(M.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(_),_.throw(I)}if(!o&&e==="enable"){s&&s.stop();let _=new L(M.SHARE_AUDIO_NOT_ALLOWED);return r.onError(_),_.throw(I)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(sR(i,s,n,n.encoderConfig&&Gc(n.encoderConfig)||void 0),n.encoderConfig&&typeof n.encoderConfig!="string"&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));let l=new Ai(s,n.encoderConfig?Gc(n.encoderConfig):{},n.scalabiltyMode?rR(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,i,[Oe.SCREEN_TRACK]);if(!o)return r.onSuccess(l.getTrackId()),I.info("create screen video track success","video:",l.getTrackId()),l;let h=new Ti(o,void 0,Ht(8,"track-scr-a-"),!1);return r.onSuccess([l.getTrackId(),h.getTrackId()]),I.info("create screen video track success","video:",l.getTrackId(),"audio:",h.getTrackId()),[l,h]},createMicrophoneAndCameraTracks:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=B("CAMERA_CAPTURE_CONFIG"),i=Ht(8,"track-mic-"),r=Ht(8,"track-cam-"),a=Te.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:Gt.TRACER,name:Jr.CREATE_MIC_AND_CAM_TRACKS,options:[n,e,t]});t&&(e.encoderConfig=t);let s=Tb(e),o=M1(n),c=null,d=null;I.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(e)));try{let _=await hc({audio:o,video:s},"".concat(i,"-").concat(r));c=_.getAudioTracks()[0],d=_.getVideoTracks()[0]}catch(_){throw a.onError(_),_}if(!c||!d){let _=new L(M.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(_),_.throw(I)}if(e.optimizationMode&&sR(r,d,e,gl(e.encoderConfig)),B("USE_STANDARD_BITRATE_DEFAULT")){let _=gl(e.encoderConfig);e.encoderConfig=_,delete _.bitrateMax,delete _.bitrateMin}let l=new yr(c,n,o,i),h=new Xi(d,e,s,e.scalabiltyMode?rR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return a.onSuccess([l.getTrackId(),h.getTrackId()]),I.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[l,h]},createMicrophoneAudioTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Ht(8,"track-mic-"),t=Te.reportApiInvoke(null,{id:e,tag:Gt.TRACER,name:Jr.CREATE_MIC_AUDIO_TRACK,options:[n]}),i=M1(n),r=null;I.info("start create microphone audio track with config",JSON.stringify(n),"trackId",e);try{r=(await hc({audio:i},e)).getAudioTracks()[0]||null}catch(s){throw t.onError(s),s}if(!r){let s=new L(M.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(s),s.throw(I)}let a=new yr(r,n,i,e);return t.onSuccess(a.getTrackId()),I.info("create microphone audio track success, trackId:",e),a},createCustomAudioTrack:function(n){let e=Ht(8,"track-cus-"),t=Te.reportApiInvoke(null,{id:e,tag:Gt.TRACER,name:Jr.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),i=new Ti(n.mediaStreamTrack,n.encoderConfig?vO(n.encoderConfig):{},e,!1);return I.info("create custom audio track success with config",n,"trackId",i.getTrackId()),t.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(n){var e;let{cacheOnlineFile:t,encoderConfig:i}=n,{source:r}=n,a={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:t,encoderConfig:i},s=Ht(8,"track-buf-"),o=Te.reportApiInvoke(null,{id:s,tag:Gt.TRACER,name:Jr.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(B("DISABLE_WEBAUDIO"))throw new L(M.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");I.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",s);let c=r;if(!(r instanceof AudioBuffer))try{r=await(async function(h,_){let f=null;if(typeof h=="string"){let S=MB.get(h);if(S)return I.debug("use cached audio resource: ",h),S;try{f=(await Od(()=>mr.get(h,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(T){throw new L(M.FETCH_AUDIO_FILE_FAILED,T.toString())}}else f=await new se((S,T)=>{let R=new FileReader;R.onload=C=>{C.target?S(C.target.result):T(new L(M.READ_LOCAL_AUDIO_FILE_ERROR))},R.onerror=()=>{T(new L(M.READ_LOCAL_AUDIO_FILE_ERROR))},R.readAsArrayBuffer(h)});let m=await(function(S){let T=Li();return new se((R,C)=>{T.decodeAudioData(S,b=>{R(b)},b=>{C(new L(M.DECODE_AUDIO_FILE_FAILED,b.toString()))})})})(f);return typeof h=="string"&&_&&MB.set(h,m),m})(r,t)}catch(h){return o.onError(h),h.throw(I)}let d=new xn(r),l=new vb(c,d,i?vO(i):{},s);return I.info("create buffer source audio track success, trackId:",s),o.onSuccess(l.getTrackId()),l},setAppType:function(n){if(I.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw I.debug("Invalid appType"),new J(M.INVALID_PARAMS,"invalid app type",n);Ct("APP_TYPE",Math.floor(n))},setLogLevel:function(n){I.setLogLevel(n)},enableLogUpload:function(){B("USE_NEW_LOG")?Ct("UPLOAD_LOG",!0):I.enableLogUpload()},disableLogUpload:function(){B("USE_NEW_LOG")?Ct("UPLOAD_LOG",!1):I.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new AR},checkAudioTrackIsActive:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,t=Te.reportApiInvoke(null,{tag:Gt.TRACER,name:Jr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(n instanceof Ti||n instanceof Wu)){let c=new J(M.INVALID_TRACK,"the parameter is not a audio track");return t.onError(c),c.throw()}e&&e<1e3&&(e=1e3);let i=n instanceof Ti?n.getTrackLabel():"remote_track",r=n.getVolumeLevel(),a=r,s=r,o=Date.now();return new se(c=>{let d=setInterval(()=>{let l=n.getVolumeLevel();a=l>a?l:a,s=l<s?l:s;let h=a-s>1e-4,_=Date.now()-o;if(h||_>e){clearInterval(d);let f=h,m={duration:_,deviceLabel:i,maxVolumeLevel:a,result:f};I.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(m))),t.onSuccess(m),c(f)}},200)})},checkVideoTrackIsActive:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,t=Te.reportApiInvoke(null,{tag:Gt.TRACER,name:Jr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(n instanceof Ai||n instanceof Og)){let h=new J(M.INVALID_TRACK,"the parameter is not a video track");return t.onError(h),h.throw()}e&&e<1e3&&(e=1e3);let i=n instanceof Ai?n.getTrackLabel():"remote_track",r=n.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(dn()||sb())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([r]),a.play();let s=document.createElement("canvas");s.width=160,s.height=120;let o=0,c=0;try{let h=Date.now();o=await(function(_,f,m,S){let T,R=0,C=null;return new se((b,N)=>{function k(){R>S&&T&&(T(),b(R));let P=m.getContext("2d");if(!P){let z=new J(M.UNEXPECTED_ERROR,"can not get canvas 2d context.");return I.error(z.toString()),void N(z)}P.drawImage(_,0,0,160,120);let U=P.getImageData(0,0,m.width,m.height),W=Math.floor(U.data.length/3);if(C){for(let z=0;z<W;z+=3)if(U.data[z]!==C[z])return R+=1,void(C=U.data);C=U.data}else C=U.data}setTimeout(()=>{T&&(T(),b(R))},f),T=Sb(()=>{k()},30)})})(a,e,s,4),c=Date.now()-h}catch(h){throw t.onError(h),h}wH===Ot.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;let d=o>4,l={duration:c,changedPicNum:o,deviceLabel:i,result:d};return I.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l))),t.onSuccess(l),d},setArea:JO,audioElementPlayCenter:uo,resumeAudioContext:function(){uo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(n){kH.processExternalMediaAEC(n)},registerExtensions:function(n){let e=B("PLUGIN_INFO")||[];n.forEach(t=>{"name"in t&&!ee(e).call(e,t.name)&&e.push(t.name);let i=t;i.__registered__=!0,i.logger.hookLog=I.extLog,i.reporter.hookApiInvoke=Te.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=B(r)})}),Qj("PLUGIN_INFO",e)},ChannelMediaRelayError:Ja,ChannelMediaRelayEvent:Kn,ChannelMediaRelayState:oa,RemoteStreamFallbackType:q4,RemoteStreamType:nR,ConnectionDisconnectedReason:Vi,AudienceLatencyLevelType:EB,AREAS:Lt,preload:async function(n,e,t,i){return u0(n,e,t,i)}});return Object.defineProperties(Cn,{onAudioAutoplayFailed:{get:()=>xo.onAudioAutoplayFailed,set:n=>{xo.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>xo.onAutoplayFailed,set:n=>{xo.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Cn._onSecurityPolicyViolation,set(n){Cn._onSecurityPolicyViolation=n,T0(n)}},__CLIENT_LIST__:{get:()=>B("SHOW_GLOBAL_CLIENT_LIST")?dE:[]}}),bs.on(Bu.CAMERA_DEVICE_CHANGED,n=>{I.info("camera device changed",JSON.stringify(n)),Cn.onCameraChanged&&Cn.onCameraChanged(n),Cn.safeEmit(Ku.CAMERA_CHANGED,n)}),bs.on(Bu.RECORDING_DEVICE_CHANGED,n=>{I.info("microphone device changed",JSON.stringify(n)),Cn.onMicrophoneChanged&&Cn.onMicrophoneChanged(n),Cn.safeEmit(Ku.MICROPHONE_CHANGED,n)}),bs.on(Bu.PLAYOUT_DEVICE_CHANGED,n=>{I.debug("playout device changed",JSON.stringify(n)),Cn.onPlaybackDeviceChanged&&Cn.onPlaybackDeviceChanged(n),Cn.safeEmit(Ku.PLAYBACK_DEVICE_CHANGED,n)}),uo.onAutoplayFailed=()=>{I.info("detect audio element autoplay failed"),xo.onAudioAutoplayFailed&&xo.onAudioAutoplayFailed()},li.on("autoplay-failed",()=>{I.info("detect webaudio autoplay failed"),xo.onAudioAutoplayFailed&&xo.onAudioAutoplayFailed(),Cn.safeEmit(Ku.AUTOPLAY_FAILED)}),li.on(sa.STATE_CHANGE,(n,e)=>{I.info("audio context state changed: ".concat(e," => ").concat(n)),Cn.onAudioContextStateChanged&&Cn.onAudioContextStateChanged(n,e),Cn.safeEmit(Ku.AUDIO_CONTEXT_STATE_CHANGED,n,e)}),Kr.on(cs.NETWORK_STATE_CHANGE,(n,e)=>{I.info("[network-indicator] network state changed, ".concat(e," => ").concat(n))}),window&&(window.__ARTC__=Cn),Cn})}),H8={};e2(H8,{AgoraRTCProvider:()=>z8,AgoraRTCReactError:()=>Kd,AgoraRTCScreenShareProvider:()=>u2,LocalAudioTrack:()=>tK,LocalUser:()=>I2,LocalVideoTrack:()=>r8,RemoteAudioTrack:()=>aK,RemoteUser:()=>oK,RemoteVideoTrack:()=>sK,TrackBoundary:()=>C2,VERSION:()=>N2,default:()=>D2,useAutoPlayAudioTrack:()=>t8,useAutoPlayVideoTrack:()=>e8,useClientEvent:()=>c2,useConnectionState:()=>p2,useCurrentUID:()=>_2,useIsConnected:()=>sN,useJoin:()=>X8,useLocalCameraTrack:()=>Q8,useLocalMicrophoneTrack:()=>Z8,useLocalScreenTrack:()=>v2,useNetworkQuality:()=>f2,usePublish:()=>J8,useRTCClient:()=>U_,useRTCScreenShareClient:()=>h2,useRemoteAudioTracks:()=>$8,useRemoteUserTrack:()=>G3,useRemoteUsers:()=>eK,useRemoteVideoTracks:()=>T2,useTrackEvent:()=>d2,useVolumeLevel:()=>m2});var i2=AA(IA());function ed(x,Y,q){return x.on(Y,q),()=>x.off(Y,q)}function r2(x){try{return x()}catch(Y){console.error(Y)}}function wA(x){return()=>x.forEach(r2)}function n2(x,Y){let q=setInterval(x,Y);return()=>clearInterval(q)}function sG(x,Y){let q=setTimeout(x,Y);return()=>clearTimeout(q)}function Q3(){let x,Y,q;function K(){if(Y){let de=Y;Y=void 0,de()}}async function X(){if(q){let de=q;q=void 0;try{await de()}catch(Re){console.error(Re)}}}async function re(de){x=!0,await X();try{q=await de()}catch(Re){console.error(Re)}x=!1,K()}async function pe(){x=!0,await X(),x=!1,K()}function Pe(de){x?Y=()=>re(de):re(de)}function ge(){x?Y=pe:pe()}return{run:Pe,dispose:ge}}var oG=typeof document<"u"?ve.useLayoutEffect:ve.useEffect;function a2(x){return x!=null&&typeof x.then=="function"}function ev(){let x=ve.useRef(!1);return ve.useEffect(()=>(x.current=!1,()=>{x.current=!0}),[]),x}function s2(){let x=ev();function Y(q,K){return new Promise(async(X,re)=>{try{let pe=await q;x.current||X(pe)}catch(pe){x.current?K&&K(pe):re(pe)}})}return ve.useCallback(Y,[x])}function K8(x){let Y=s2(),[q,K]=ve.useState();return oG(()=>{a2(x)?Y(x).then(K):K(x)},[x,Y]),q}function OA(x,Y){let q=ve.useRef();ve.useEffect(()=>{let{run:K,dispose:X}=q.current||=Q3();return K(x),X},Y)}function o2(x,Y){let q=x.split("."),K=Y.split("."),X=Math.max(q.length,K.length);for(let re=0;re<X;re++){let pe=parseInt(q[re]||"0"),Pe=parseInt(K[re]||"0");if(pe>Pe)return 1;if(pe<Pe)return-1}return 0}function c2(x,Y,q){let K=ve.useRef(q);oG(()=>{K.current=q},[q]),ve.useEffect(()=>{if(x)return ed(x,Y,(...X)=>{K.current&&K.current(...X)})},[Y,x])}function d2(x,Y,q){let K=ve.useRef(q);oG(()=>{K.current=q},[q]),ve.useEffect(()=>{if(x)return ed(x,Y,(...X)=>{K.current&&K.current(...X)})},[Y,x])}var Y8=ve.createContext(null);function z8({client:x,children:Y}){return It.jsx(Y8.Provider,{value:x,children:Y})}function l2(x){let Y=ve.useContext(Y8);return x||Y}function U_(x){let Y=l2(x);if(!Y)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return Y}var q8=ve.createContext(null);function u2({client:x,children:Y}){return It.jsx(q8.Provider,{value:x,children:Y})}function h2(x){let Y=ve.useContext(q8);return x||Y}function p2(x){let Y=U_(x),[q,K]=ve.useState(Y?Y.connectionState:"DISCONNECTED");return ve.useEffect(()=>{if(Y){K(Y.connectionState);let X;return wA([ed(Y,"connection-state-change",re=>{X?.(),re==="CONNECTED"?X=sG(()=>K(re),0):K(re)}),()=>X?.()])}else K("DISCONNECTED")},[Y]),q}function sN(x){let Y=U_(x),[q,K]=ve.useState(Y?Y.connectionState==="CONNECTED":!1);return ve.useEffect(()=>{if(Y){K(Y.connectionState==="CONNECTED");let X;return wA([ed(Y,"connection-state-change",re=>{X?.(),X=sG(()=>K(re==="CONNECTED"),0)}),()=>X?.()])}else K(!1)},[Y]),q}function _2(x){let Y=U_(x),[q,K]=ve.useState(Y?.uid);return ve.useEffect(()=>{if(Y)return ed(Y,"connection-state-change",X=>{if(X==="CONNECTED")return sG(()=>K(Y.uid),0);X==="DISCONNECTED"&&K(void 0)})},[Y]),q}var Kd=class extends Error{rtcMethod;rtcError;name="AgoraRTCReactException";constructor(x,Y){typeof Y=="string"?super(Y):super(Y.message),this.rtcMethod=x,this.rtcError=Y}log(x){console[x](this)}};function X8(x,Y=!0,q){let K=U_(q),X=sN(q),re=ve.useRef(),[pe,Pe]=ve.useState(!1),[ge,de]=ve.useState(0),[Re,ye]=ve.useState(null),Be=ev();return OA(async()=>{if(Be.current||(ye(null),de(0),Pe(!1)),Y&&K){try{Be.current||Pe(!0);let{appid:ke,channel:Ve,token:Fe,uid:ht}=typeof x=="function"?await x():x,At=await K.join(ke,Ve,Fe,ht);Be.current||de(At)}catch(ke){console.error(ke),Be.current||ye(new Kd("IAgoraRTCClient.join",ke))}Be.current||Pe(!1);let ct=re.current||=Q3();return wA([()=>{ct.dispose()},()=>{ct.run(()=>K.unpublish(K.localTracks))},()=>{for(let ke of K.localTracks)ke.isPlaying&&ke.stop(),ke.close();ct.run(()=>K.leave())}])}},[Y,q]),{data:ge,isLoading:pe,isConnected:X,error:Re}}var T8=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function f2(x){let Y=U_(x),[q,K]=ve.useState(T8);return ve.useEffect(()=>{if(Y)return ed(Y,"network-quality",X=>K({uplinkNetworkQuality:X.uplinkNetworkQuality,downlinkNetworkQuality:X.downlinkNetworkQuality,delay:Y.getRTCStats().RTT??0}));K(T8())},[Y]),q}var E2=AA(IA());function J8(x,Y=!0,q){let K=U_(q),X=sN(q),re=ve.useRef([]),[pe,Pe]=ve.useState(!1),[ge,de]=ve.useState(null),Re=ev();return OA(async()=>{if(Re.current||(Pe(!1),de(null)),!K||!X||!Y)return;let ye=x.filter(Boolean),Be=Ve=>{let Fe=o2(E2.default.VERSION,"4.18.2")>=0;return Fe||new Kd("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),Fe?K.mode!=="live"||K.role!=="audience":!0},ct=Ve=>re.current.some(Fe=>Fe&&Fe.getTrackId()===Ve.getTrackId()),ke=Ve=>Be()&&Ve.enabled&&Y&&!ct(Ve);for(let Ve=0;Ve<ye.length;Ve++){let Fe=ye[Ve];if(Fe&&ke(Fe)){await K.unpublish(re.current.filter(ht=>ht?.trackMediaType===Fe.trackMediaType));try{Re.current||Pe(!0),await K.publish(Fe)}catch(ht){console.error(ht),Re.current||de(new Kd("IAgoraRTCClient.publish",ht))}Re.current||Pe(!1)}}re.current=ye},[X,Y,K,x]),{isLoading:pe,error:ge}}function m2(x){let[Y,q]=ve.useState(0);return ve.useEffect(()=>{if(x)return n2(()=>{q(x.getVolumeLevel())},1e3)},[x]),Y}var g2=AA(IA());function Z8(x=!0,Y={ANS:!0,AEC:!0}){let[q,K]=ve.useState(null),[X,re]=ve.useState(!1),[pe,Pe]=ve.useState(null),ge=ev();return OA(async()=>{if(ge.current||(re(!1),Pe(null)),x&&!q){try{ge.current||re(!0);let de=await g2.default.createMicrophoneAudioTrack(Y);ge.current||K(de)}catch(de){console.error(de),ge.current||Pe(new Kd("IAgoraRTC.createMicrophoneAudioTrack",de))}ge.current||re(!1)}},[x]),{localMicrophoneTrack:q,isLoading:X,error:pe}}var S2=AA(IA());function Q8(x=!0,Y){let[q,K]=ve.useState(null),[X,re]=ve.useState(!1),[pe,Pe]=ve.useState(null),ge=ev();return OA(async()=>{if(ge.current||(re(!1),Pe(null)),x&&!q){try{ge.current||re(!0);let de=await S2.default.createCameraVideoTrack(Y);ge.current||K(de)}catch(de){console.error(de),ge.current||Pe(new Kd("IAgoraRTC.createCameraVideoTrack",de))}ge.current||re(!1)}},[x]),{localCameraTrack:q,isLoading:X,error:pe}}function $8(x,Y){let q=U_(Y),[K,X]=ve.useState([]),re=sN(),pe=ve.useRef([]),[Pe,ge]=ve.useState(!1),[de,Re]=ve.useState(null),ye=ev();return OA(async()=>{if(ye.current||Re(null),!Array.isArray(x)||!re)return;let Be=async Ve=>{if(!Ve.audioTrack&&x.some(({uid:Fe})=>Ve.uid===Fe)){try{ye.current||ge(!0),await q.subscribe(Ve,"audio")}catch(Fe){console.error(Fe),ye.current||Re(new Kd("IAgoraRTCClient.subscribe",Fe))}Ve.audioTrack&&!pe.current.some(Fe=>Fe.getUserId()===Ve.uid)&&pe.current.push(Ve.audioTrack),pe.current=pe.current.map(Fe=>Ve.audioTrack&&Fe.getUserId()===Ve.uid&&Fe.getTrackId()!==Ve.audioTrack.getTrackId()?Ve.audioTrack:Fe),ye.current||(X([...pe.current]),ge(!1))}},ct=async Ve=>{if(x.some(({uid:Fe})=>Ve.uid===Fe)){ye.current||(pe.current=pe.current.filter(Fe=>Fe.getUserId()!==Ve.uid),X([...pe.current]));try{ye.current||ge(!0),await q.unsubscribe(Ve,"audio")}catch(Fe){console.error(Fe),ye.current||Re(new Kd("IAgoraRTCClient.unsubscribe",Fe))}ye.current||ge(!1)}};x.map(Ve=>{!Ve.audioTrack&&Ve.hasAudio&&Be(Ve)});let ke=[];for(let Ve=0;Ve<pe.current.length;Ve++){let Fe=pe.current[Ve];if(!x.some(ht=>ht.uid===Fe.getUserId())){let ht=q.remoteUsers.find(At=>At.uid===Fe.getUserId());ht&&ke.push({user:ht,mediaType:"audio"}),pe.current.splice(Ve,1),Ve--}}if(ke.length>0){try{ye.current||ge(!0),await q.massUnsubscribe(ke)}catch(Ve){console.error(Ve),ye.current||Re(new Kd("IAgoraRTCClient.massUnsubscribe",Ve))}ye.current||(X(pe.current.slice()),ge(!1))}return wA([ed(q,"user-published",(Ve,Fe)=>{x.find(ht=>ht.uid===Ve.uid)&&Fe==="audio"&&Be(Ve)}),ed(q,"user-unpublished",(Ve,Fe)=>{x.find(ht=>ht.uid===Ve.uid)&&Fe==="audio"&&ct(Ve)})])},[re,q,x]),{audioTracks:K,isLoading:Pe,error:de}}function T2(x,Y){let q=U_(Y),[K,X]=ve.useState([]),re=sN(),pe=ve.useRef([]),[Pe,ge]=ve.useState(!1),[de,Re]=ve.useState(null),ye=ev();return OA(async()=>{if(ye.current||Re(null),!Array.isArray(x)||!re)return;let Be=async Ve=>{if(!Ve.videoTrack&&x.some(({uid:Fe})=>Ve.uid===Fe)){try{ye.current||ge(!0),await q.subscribe(Ve,"video")}catch(Fe){console.error(Fe),ye.current||Re(new Kd("IAgoraRTCClient.subscribe",Fe))}Ve.videoTrack&&!pe.current.some(Fe=>Fe.getUserId()===Ve.uid)&&pe.current.push(Ve.videoTrack),pe.current=pe.current.map(Fe=>Ve.videoTrack&&Fe.getUserId()===Ve.uid&&Fe.getTrackId()!==Ve.videoTrack.getTrackId()?Ve.videoTrack:Fe),ye.current||(X([...pe.current]),ge(!1))}},ct=async Ve=>{if(x.some(({uid:Fe})=>Ve.uid===Fe)){ye.current||(pe.current=pe.current.filter(Fe=>Fe.getUserId()!==Ve.uid),X([...pe.current]));try{ye.current||ge(!0),await q.unsubscribe(Ve,"video")}catch(Fe){console.error(Fe),ye.current||Re(new Kd("IAgoraRTCClient.unsubscribe",Fe))}ye.current||ge(!1)}};x.map(Ve=>{!Ve.videoTrack&&Ve.hasVideo&&Be(Ve)});let ke=[];for(let Ve=0;Ve<pe.current.length;Ve++){let Fe=pe.current[Ve];if(!x.some(ht=>ht.uid===Fe.getUserId())){let ht=q.remoteUsers.find(At=>At.uid===Fe.getUserId());ht&&ke.push({user:ht,mediaType:"video"}),pe.current.splice(Ve,1),Ve--}}if(ke.length>0){try{ye.current||ge(!0),await q.massUnsubscribe(ke)}catch(Ve){console.error(Ve),ye.current||Re(new Kd("IAgoraRTCClient.massUnsubscribe",Ve))}ye.current||(X(pe.current.slice()),ge(!1))}return wA([ed(q,"user-published",(Ve,Fe)=>{x.find(ht=>ht.uid===Ve.uid)&&Fe==="video"&&Be(Ve)}),ed(q,"user-unpublished",(Ve,Fe)=>{x.find(ht=>ht.uid===Ve.uid)&&Fe==="video"&&ct(Ve)})])},[re,q,x]),{videoTracks:K,isLoading:Pe,error:de}}function G3(x,Y,q){let K=U_(q),X=Y==="audio"?"audioTrack":"videoTrack",[re,pe]=ve.useState(x&&x[X]),Pe=sN(),ge=ve.useRef(),[de,Re]=ve.useState(!1),[ye,Be]=ve.useState(null);return ve.useEffect(()=>{if(!x||!Pe)return;let ct=!1;ct||Be(null);let ke=Y==="audio"?"hasAudio":"hasVideo",Ve=x.uid,Fe=async(kt,Ar)=>{if(kt[X]&&K.remoteUsers.some(({uid:oi})=>kt.uid===oi))try{ct||Re(!0),await K.unsubscribe(kt,Ar)}catch(oi){ct||Be(new Kd("IAgoraRTCClient.unsubscribe",oi)),console.error(oi)}ct||(pe(void 0),Re(!1))},ht=async(kt,Ar)=>{try{!kt[X]&&K.remoteUsers.some(({uid:oi})=>kt.uid===oi)&&(ct||Re(!0),await K.subscribe(kt,Ar)),ct||pe(kt[X])}catch(oi){ct||Be(new Kd("IAgoraRTCClient.subscribe",oi)),console.error(oi)}ct||Re(!1)},At=ge.current||=Q3();return!x[X]&&x[ke]?At.run(()=>ht(x,Y)):pe(x[X]),wA([()=>{ct=!0,At.dispose()},ed(K,"user-published",(kt,Ar)=>{kt.uid===Ve&&Ar===Y&&At.run(()=>ht(kt,Y))}),ed(K,"user-unpublished",(kt,Ar)=>{kt.uid===Ve&&Ar===Y&&At.run(()=>Fe(kt,Y))})])},[Pe,K,x,Y,X]),{track:re,isLoading:de,error:ye}}function eK(x){let Y=U_(x),[q,K]=ve.useState(Y?Y.remoteUsers:[]);return ve.useEffect(()=>{if(Y){let X=()=>K(Y.remoteUsers.slice());return wA([ed(Y,"user-joined",X),ed(Y,"user-left",X),ed(Y,"user-published",X),ed(Y,"user-unpublished",X)])}},[Y]),q}var R2=AA(IA());function v2(x=!0,Y,q){let[K,X]=ve.useState(null),[re,pe]=ve.useState(!1),[Pe,ge]=ve.useState(null),de=ev();return OA(async()=>{if(de.current||(pe(!1),ge(null)),x&&!K){try{de.current||pe(!0);let Re=await R2.default.createScreenVideoTrack(Y,q);de.current||X(Re)}catch(Re){console.error(Re),de.current||ge(new Kd("IAgoraRTC.createScreenVideoTrack",Re))}de.current||pe(!1)}},[x]),{screenTrack:K,isLoading:re,error:Pe}}function y2(){let x=new Map,Y=1500;return{onMount:q=>{let K=x.get(q);K&&(K(),x.delete(q))},onUnmount:q=>{let K=x.get(q);K&&K(),x.set(q,sG(()=>{q.isPlaying&&q.stop(),x.delete(q)},Y))},dispose:()=>{for(let[q,K]of x)q.isPlaying&&q.stop(),K&&K();x.clear()}}}var $3=ve.createContext(void 0);function C2({children:x}){let[Y]=ve.useState(y2);return ve.useEffect(()=>Y.dispose,[Y]),It.jsx($3.Provider,{value:Y,children:x})}function e8(x,Y,q,K){let X=ve.useContext($3);ve.useEffect(()=>{if(x)return K&&Y?x.play(K,q||void 0):x.stop(),X?(X.onMount(x),()=>X.onUnmount(x)):()=>{x.isPlaying&&x.stop()}},[x,K,Y,X,q])}function t8(x,Y){let q=ve.useContext($3);oG(()=>{if(x)return Y?x.play():x.stop(),q?(q.onMount(x),()=>q.onUnmount(x)):()=>{x.isPlaying&&x.stop()}},[x,Y,q])}function tK({track:x,play:Y=!1,volume:q,disabled:K,muted:X,children:re}){let pe=K8(x);return t8(pe,Y),ve.useEffect(()=>{pe&&q!=null&&pe.setVolume(q)},[pe,q]),ve.useEffect(()=>{pe&&K!=null&&pe.setEnabled(!K).catch(console.warn)},[K,pe]),ve.useEffect(()=>{pe&&X!=null&&pe.setMuted(X).catch(console.warn)},[X,pe]),re?It.jsx(It.Fragment,{children:re}):null}var iK={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},rK={width:"100%",height:"100%"},i8={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},cG=(x,Y)=>ve.useMemo(()=>({...x,...Y}),[x,Y]);function r8({track:x,play:Y,disabled:q,muted:K,style:X,videoPlayerConfig:re,...pe}){let Pe=cG(rK,X),[ge,de]=ve.useState(null),Re=K8(x);return e8(Re,Y,re,ge),ve.useEffect(()=>{Re&&q!=null&&Re.setEnabled(!q).catch(console.warn)},[q,Re]),ve.useEffect(()=>{Re&&K!=null&&Re.setMuted(K).catch(console.warn)},[K,Re]),It.jsx("div",{...pe,ref:de,style:Pe})}var b2={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},A2={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function nK({cover:x}){return It.jsx("div",{style:i8,children:typeof x=="string"?It.jsxs(It.Fragment,{children:[It.jsx("div",{style:{...b2,backgroundImage:`url(${x})`}}),It.jsx("img",{src:x,style:A2})]}):x()})}function I2({micOn:x,cameraOn:Y,audioTrack:q,videoTrack:K,playAudio:X,playVideo:re,volume:pe,cover:Pe,children:ge,style:de,...Re}){let ye=cG(iK,de);return re=re??!!Y,X=X??!!x,It.jsxs("div",{...Re,style:ye,children:[It.jsx(r8,{disabled:!Y,play:re,track:K}),It.jsx(tK,{disabled:!x,play:X,track:q,volume:pe}),Pe&&!Y&&It.jsx(nK,{cover:Pe}),It.jsx("div",{style:i8,children:ge})]})}function aK({track:x,play:Y=!1,playbackDeviceId:q,volume:K,children:X}){return t8(x,Y),ve.useEffect(()=>{x&&q!=null&&x.setPlaybackDevice(q).catch(console.warn)},[x,q]),ve.useEffect(()=>{x&&K!=null&&x.setVolume(K)},[x,K]),X?It.jsx(It.Fragment,{children:X}):null}function sK({track:x,play:Y,style:q,videoPlayerConfig:K,...X}){let re=cG(rK,q),[pe,Pe]=ve.useState(null);return e8(x,Y,K,pe),It.jsx("div",{...X,ref:Pe,style:re})}function oK({user:x,playVideo:Y,playAudio:q,playbackDeviceId:K,volume:X,cover:re,style:pe,children:Pe,videoPlayerConfig:ge,...de}){let Re=cG(iK,pe),{track:ye}=G3(x,"video"),{track:Be}=G3(x,"audio");return Y=Y??x?.hasVideo,q=q??x?.hasAudio,It.jsxs("div",{...de,style:Re,children:[It.jsx(sK,{play:Y,track:ye,videoPlayerConfig:ge}),It.jsx(aK,{play:q,playbackDeviceId:K,track:Be,volume:X}),re&&!Y&&It.jsx(nK,{cover:re}),It.jsx("div",{style:i8,children:Pe})]})}var w2=AA(IA()),O2=class{appType=1001;constructor(){w2.default.setAppType(this.appType)}};new O2;var N2="2.5.0";t2(H8,AA(IA()));var D2=i2.default;const P2="b998849d5d5b47d6a6616efb913ec97a",R8="testchannel",L2=zY.createClient({mode:"rtc",codec:"vp8"}),k2=()=>{const{userType:x}=XK(),Y=Y3();return It.jsx(z8,{client:L2,children:It.jsx(M2,{userType:x,navigate:Y})})},M2=({userType:x,navigate:Y})=>{const[q,K]=ve.useState(!1),[X,re]=ve.useState(!1),[pe,Pe]=ve.useState(!1),ge=null,de=x==="userA"?1:2,{isLoading:Re,isConnected:ye}=X8({appid:P2,channel:R8,token:ge,uid:de}),{localCameraTrack:Be}=Q8(!pe),{localMicrophoneTrack:ct}=Z8(!X);J8([ct,Be]);const ke=eK(),{audioTracks:Ve}=$8(ke);ve.useEffect(()=>{Ve.map(kt=>kt.play())},[Ve]),ve.useEffect(()=>{K(ye)},[ye]);const Fe=()=>{re(!X)},ht=()=>{Pe(!pe)},At=()=>{Y("/")};return It.jsxs("div",{className:"video-call-container",children:[It.jsxs("div",{className:"video-call-header",children:[It.jsxs("h2",{children:["Video Call - ",x==="userA"?"User A":"User B"]}),It.jsxs("p",{children:["Channel: ",R8]}),Re&&It.jsx("p",{children:"Joining..."}),q&&It.jsx("p",{className:"status-connected",children:"Connected"})]}),It.jsxs("div",{className:"video-container",children:[It.jsxs("div",{className:"video-player local-video",children:[It.jsxs("div",{className:"video-label",children:["You (",x==="userA"?"User A":"User B",")"]}),Be&&!pe?It.jsx(r8,{track:Be,play:!0,style:{width:"100%",height:"100%"}}):It.jsx("div",{className:"video-placeholder",children:It.jsx("p",{children:"Camera Off"})})]}),It.jsxs("div",{className:"video-player remote-video",children:[It.jsxs("div",{className:"video-label",children:["Remote User ",ke.length>0?ke[0].uid===1?"(User A)":"(User B)":"(Waiting...)"]}),ke.length>0?It.jsx(oK,{user:ke[0],style:{width:"100%",height:"100%"}}):It.jsx("div",{className:"video-placeholder",children:It.jsx("p",{children:"Waiting for remote user to join..."})})]})]}),It.jsxs("div",{className:"controls",children:[It.jsx("button",{className:`control-button ${X?"muted":""}`,onClick:Fe,children:X?"🔇 Unmute":"🎤 Mute"}),It.jsx("button",{className:`control-button ${pe?"video-off":""}`,onClick:ht,children:pe?"📹 Turn On Video":"📵 Turn Off Video"}),It.jsx("button",{className:"control-button leave-button",onClick:At,children:"📞 Leave Call"})]}),It.jsxs("div",{className:"call-info",children:[It.jsxs("p",{children:[It.jsx("strong",{children:"Connected Users:"})," ",q?ke.length+1:0]}),It.jsxs("p",{children:[It.jsx("strong",{children:"Your UID:"})," ",de]}),ke.length>0&&It.jsxs("p",{children:[It.jsx("strong",{children:"Remote UID:"})," ",ke[0].uid]})]})]})};function U2(){return It.jsx(LY,{children:It.jsx("div",{className:"App",children:It.jsxs(lY,{children:[It.jsx(B3,{path:"/",element:It.jsx(WY,{})}),It.jsx(B3,{path:"/call/:userType",element:It.jsx(k2,{})})]})})})}SK.createRoot(document.getElementById("root")).render(It.jsx(uK.StrictMode,{children:It.jsx(U2,{})}));
